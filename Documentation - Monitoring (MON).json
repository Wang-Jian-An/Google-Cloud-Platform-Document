{"title": "Documentation - Monitoring (MON)", "url": "https://cloud.google.com/distributed-cloud/hosted/docs/latest/gdch/overview", "abstract": "# Documentation - Monitoring (MON)\n| 0     | 1                                           |\n|:-------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Audit log source | Observability audit logger Kubernetes audit logs                                |\n| Audited operations | Run PromQL queries using the user interface of the monitoring instance Run PromQL queries using the HTTP API Perform dashboard CRUD operations Perform alert CRUD operations |\n", "content": "## Run PromQL queries using the user interface of the monitoring instance\n| 0    | 1   |\n|:-----------------|:-------------|\n| Audit log source | Proxy server |\n| Log type   | Data plane |\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')                 |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------|\n| User or service identity              | user                    | For example, \"user\":{ \"identity\":\"fop-cluster-admin@example.com\", \"issuer\":\"https://ais-core.org-1.zone1.google.gdch.test\" }   |\n| Target (Fields and values that call the API)         | resource                   | For example, \"resource\": \"/infra-obs/grafana/api/ds/query\"                    |\n| Action (Fields containing the performed operation)        | action                   | Possible values: \"action\": \"QUERY\" \"action\": \"CREATE\" \"action\": \"READ\" \"action\": \"UPDATE\" \"action\": \"DELETE\" \"action\": \"CREATE/UPDATE\" |\n| Event timestamp                | time                    | For example, \"time\": \"2022-12-05T14:39:15.713354008Z\"                     |\n| Source of action                | sourceIPs _gdch_service_name              | For example, \"sourceIPs\":[ \"10.253.166.214\", \"127.0.0.6\" ], \"_gdch_service_name\":\"grafana\"           |\n| Outcome                  | response                   | For example, \"response\": \"Successful: 200 OK\"                       |\n| Other fields                 | description                  | The description value contains the complete query. For more information. see the Example log.           |\n**Example log**\n```\n{\u00a0 \"resource\":\"/infra-obs/grafana/api/ds/query\",\u00a0 \"response\":\"Successful: 200 OK\",\u00a0 \"_gdch_service_tenant\":\"infra-obs\",\u00a0 \"sourceIPs\":[\u00a0 \u00a0 \"10.253.166.214\",\u00a0 \u00a0 \"127.0.0.6\"\u00a0 ],\u00a0 \"_gdch_namespace\":\"infra-obs-obs-system\",\u00a0 \"userAgent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:107.0) Gecko/20100101 Firefox/107.0\",\u00a0 \"time\":\"2022-12-05T14:39:15.713354008Z\",\u00a0 \"auditID\":\"6bba5ff1-97d9-4bf8-92af-4f63049448cf\",\u00a0 \"numBytesSent\":1821,\u00a0 \"action\":\"QUERY\",\u00a0 \"_gdch_service_name\":\"grafana\",\u00a0 \"numBytesReceived\":2827,\u00a0 \"description\":\"{\u00a0 \u00a0 \u00a0 \\\"queries\\\":[{\u00a0 \u00a0 \u00a0 \\\"refId\\\":\\\"A\\\",\u00a0 \u00a0 \u00a0 \\\"expr\\\":\\\"{container=\\\\\\\"grafana-proxy-server\\\\\\\"},\u00a0 \u00a0 \u00a0 \\\"queryType\\\":\\\"range\\\",\u00a0 \u00a0 \u00a0 \\\"datasource\\\":{\\\"uid\\\":\\\"P982945308D3682D1\\\",\\\"type\\\":\\\"loki\\\"},\u00a0 \u00a0 \u00a0 \\\"key\\\":\\\"Q-c63373da-dec2-49c3-aa6c-4e5ba07ec8de-0\\\",\u00a0 \u00a0 \u00a0 \\\"editorMode\\\":\\\"builder\\\",\u00a0 \u00a0 \u00a0 \\\"maxLines\\\":1000,\u00a0 \u00a0 \u00a0 \\\"legendFormat\\\":\\\"\\\",\u00a0 \u00a0 \u00a0 \\\"datasourceId\\\":2,\u00a0 \u00a0 \u00a0 \\\"intervalMs\\\":1000,\u00a0 \u00a0 \u00a0 \\\"maxDataPoints\\\":2493\u00a0 \u00a0 }],\u00a0 \u00a0 \\\"range\\\":{\u00a0 \u00a0 \u00a0 \\\"from\\\":\\\"2022-12-05T13:39:15.461Z\\\",\u00a0 \u00a0 \u00a0 \\\"to\\\":\\\"2022-12-05T14:39:15.461Z\\\",\u00a0 \u00a0 \u00a0 \\\"raw\\\":{\\\"from\\\":\\\"now-1h\\\",\\\"to\\\":\\\"now\\\"}\u00a0 \u00a0 },\u00a0 \u00a0 \\\"from\\\":\\\"1670247555461\\\",\u00a0 \u00a0 \\\"to\\\":\\\"1670251155461\\\"\u00a0 }\",\u00a0 \"user\":{\u00a0 \u00a0 \"identity\":\"fop-cluster-admin@example.com\",\u00a0 \u00a0 \"issuer\":\"https://ais-core.org-1.zone1.google.gdch.test\"\u00a0 },\u00a0 \"_gdch_cluster\":\"org-1-admin\",\u00a0 \"_gdch_fluentbit_pod\":\"anthos-audit-logs-forwarder-whltm\"}\n```\n## Run PromQL queries using the HTTP API\n| 0    | 1   |\n|:-----------------|:-------------|\n| Audit log source | Proxy server |\n| Log type   | Data plane |\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')                 |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------|\n| User or service identity              | user                    | For example, \"user\":{ \"issuer\":\"https://ais-core.org-1.zone1.google.gdch.test\", \"identity\":\"fop-cluster-admin@example.com\" }   |\n| Target (Fields and values that call the API)         | resource                   | For example, \"resource\":\"/alertmanager/api/v2/alerts/groups?silenced=false&inhibited=false&active=true\"        |\n| Action (Fields containing the performed operation)        | action                   | Possible values: \"action\": \"QUERY\" \"action\": \"CREATE\" \"action\": \"READ\" \"action\": \"UPDATE\" \"action\": \"DELETE\" \"action\": \"CREATE/UPDATE\" |\n| Event timestamp                | time                    | For example, \"time\": \"2022-12-05T18:20:50.616925009Z\"                     |\n| Source of action                | sourceIPs _gdch_service_name              | For example, \"sourceIPs\":[ \"10.200.0.1\", \"127.0.0.6\" ], \"_gdch_service_name\":\"cortex\"            |\n| Outcome                  | response                   | For example, \"response\": \"Successful: 200 OK\"                       |\n| Other fields                 | Not applicable                 | Not applicable                               |\n**Example log**\n```\n{\u00a0 \"user\":{\u00a0 \u00a0 \"issuer\":\"https://ais-core.org-1.zone1.google.gdch.test\",\u00a0 \u00a0 \"identity\":\"fop-cluster-admin@example.com\"\u00a0 },\u00a0 \"_gdch_service_tenant\":\"infra-obs\",\u00a0 \"_gdch_service_name\":\"cortex\",\u00a0 \"resource\":\"/alertmanager/api/v2/alerts/groups?silenced=false&inhibited=false&active=true\",\u00a0 \"time\":\"2022-12-05T18:20:50.616925009Z\",\u00a0 \"action\":\"READ\",\u00a0 \"numBytesReceived\":2376,\u00a0 \"sourceIPs\":[\u00a0 \u00a0 \"10.200.0.1\",\u00a0 \u00a0 \"127.0.0.6\"\u00a0 ],\u00a0 \"_gdch_namespace\":\"obs-system\",\u00a0 \"userAgent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:107.0) Gecko/20100101 Firefox/107.0\",\u00a0 \"numBytesSent\":173,\u00a0 \"auditID\":\"8451a7b3-77f9-4878-9308-641b55a83865\",\u00a0 \"response\":\"Successful: 200 OK\",\u00a0 \"_gdch_cluster\":\"org-1-admin\",\u00a0 \"_gdch_fluentbit_pod\":\"anthos-audit-logs-forwarder-2wqxp\"}\n```\n## Perform dashboard CRUD operations\n| 0    | 1      |\n|:-----------------|:----------------------|\n| Audit log source | Kubernetes audit logs |\n| Log type   | Control plane   |\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')                                                                                          |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| User or service identity              | user                    | For example, \"user\":{ \"extra\":{ \"authentication.kubernetes.io/pod-name\":[\"fleet-admin-controller-875778d98-dnkj2\"], \"authentication.kubernetes.io/pod-uid\":[\"caa4df7a-ae04-458e-a616-1c6893ce6e46\"] }, \"username\":\"system:serviceaccount:gpc-system:fleet-admin-controller\", \"groups\":[ \"system:serviceaccounts\", \"system:serviceaccounts:gpc-system\", \"system:authenticated\" ], \"uid\":\"0b93d757-e3be-440a-b18a-4a2b524de156\" } |\n| Target (Fields and values that call the API)         | requestURI objectRef                | For example, \"requestURI\":\"/apis/observability.gdc.goog/v1/namespaces/alice-obs-system/dashboards\", \"objectRef\":{ \"apiVersion\":\"v1\", \"apiGroup\":\"observability.gdc.goog\", \"resource\":\"dashboards\", \"namespace\":\"alice-obs-system\" }                                                 |\n| Action (Fields containing the performed operation)        | verb                    | Possible values: \"verb\": \"create\" \"verb\": \"delete\" \"verb\": \"get\" \"verb\": \"list\" \"verb\": \"patch\" \"verb\": \"update\" \"verb\": \"watch\"                                                                           |\n| Event timestamp                | requestReceivedTimestamp               | For example, \"requestReceivedTimestamp\": \"2022-12-05T15:36:24.980257Z\"                                                                                          |\n| Source of action                | sourceIPs _gdch_service_name              | For example, \"sourceIPs\":[\"10.253.166.100\"], \"_gdch_service_name\":\"apiserver\"                                                                                        |\n| Outcome                  | responseStatus                 | For example, \"responseStatus\":{ \"code\":201, \"metadata\":{} }                                                                                            |\n| Other fields                 | Not applicable                 | Not applicable                                                                                                        |\n**Example log**\n```\n{\u00a0 \"user\":{\u00a0 \u00a0 \"extra\":{\u00a0 \u00a0 \u00a0 \"authentication.kubernetes.io/pod-name\":[\"fleet-admin-controller-875778d98-dnkj2\"],\u00a0 \u00a0 \u00a0 \"authentication.kubernetes.io/pod-uid\":[\"caa4df7a-ae04-458e-a616-1c6893ce6e46\"]\u00a0 \u00a0 },\u00a0 \u00a0 \"username\":\"system:serviceaccount:gpc-system:fleet-admin-controller\",\u00a0 \u00a0 \"groups\":[\u00a0 \u00a0 \u00a0 \"system:serviceaccounts\",\u00a0 \u00a0 \u00a0 \"system:serviceaccounts:gpc-system\",\u00a0 \u00a0 \u00a0 \"system:authenticated\"\u00a0 \u00a0 ],\u00a0 \u00a0 \"uid\":\"0b93d757-e3be-440a-b18a-4a2b524de156\"\u00a0 },\u00a0 \"kind\":\"Event\",\u00a0 \"_gdch_fluentbit_pod\":\"anthos-audit-logs-forwarder-2wqxp\",\u00a0 \"apiVersion\":\"audit.k8s.io/v1\",\u00a0 \"_gdch_cluster\":\"org-1-admin\",\u00a0 \"level\":\"Metadata\",\u00a0 \"stageTimestamp\":\"2022-12-05T15:36:24.980257Z\",\u00a0 \"auditID\":\"a060d80a-4a47-4490-a859-5d3ccff36d3d\",\u00a0 \"requestReceivedTimestamp\":\"2022-12-05T15:36:24.980257Z\",\u00a0 \"userAgent\":\"fleet-admin-cm/v0.0.0 (linux/amd64) kubernetes/$Format\",\u00a0 \"stage\":\"RequestReceived\",\u00a0 \"requestURI\":\"/apis/observability.gdc.goog/v1/namespaces/alice-obs-system/dashboards\",\u00a0 \"objectRef\":{\u00a0 \u00a0 \"apiVersion\":\"v1\",\u00a0 \u00a0 \"apiGroup\":\"observability.gdc.goog\",\u00a0 \u00a0 \"resource\":\"dashboards\",\u00a0 \u00a0 \"namespace\":\"alice-obs-system\"\u00a0 },\u00a0 \"verb\":\"create\",\u00a0 \"sourceIPs\":[\"10.253.166.100\"],\u00a0 \"_gdch_service_name\":\"apiserver\"}\n```\n## Perform alert CRUD operations\n| 0    | 1      |\n|:-----------------|:----------------------|\n| Audit log source | Kubernetes audit logs |\n| Log type   | Control plane   |\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')                                                             |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| User or service identity              | user                    | For example, \"user\":{ \"username\":\"kubernetes-admin\", \"groups\":[ \"system:masters\", \"system:authenticated\" ] }                                                 |\n| Target (Fields and values that call the API)         | requestURI objectRef                | For example, \"requestURI\":\"/apis/monitoring.gdc.goog/v1/namespaces/alice/monitoringrules?fieldManager=kubectl-client-side-apply&fieldValidation=Strict\", \"objectRef\":{ \"apiVersion\":\"v1\", \"apiGroup\":\"monitoring.gdc.goog\", \"name\":\"obs-test-alert-sequel\", \"namespace\":\"alice\", \"resource\":\"monitoringrules\" } |\n| Action (Fields containing the performed operation)        | verb                    | Possible values: \"verb\": \"create\" \"verb\": \"delete\" \"verb\": \"get\" \"verb\": \"list\" \"verb\": \"patch\" \"verb\": \"update\" \"verb\": \"watch\"                                              |\n| Event timestamp                | requestReceivedTimestamp               | For example, \"requestReceivedTimestamp\": \"2022-12-05T16:28:50.619659Z\"                                                            |\n| Source of action                | sourceIPs _gdch_service_name              | For example, \"sourceIPs\":[\"10.200.0.6\"], \"_gdch_service_name\":\"apiserver\"                                                           |\n| Outcome                  | responseStatus                 | For example, \"responseStatus\":{ \"code\":201, \"metadata\":{} }                                                              |\n| Other fields                 | Not applicable                 | Not applicable                                                                          |\n**Example log**\n```\n{\u00a0 \"level\":\"Metadata\",\u00a0 \"sourceIPs\":[\u00a0 \u00a0 \"10.200.0.6\"\u00a0 ],\u00a0 \"auditID\":\"753c3370-d3a5-4717-b84e-00fd56883fc4\",\u00a0 \"requestURI\":\"/apis/monitoring.gdc.goog/v1/namespaces/alice/monitoringrules?fieldManager=kubectl-client-side-apply&fieldValidation=Strict\",\u00a0 \"apiVersion\":\"audit.k8s.io/v1\",\u00a0 \"_gdch_fluentbit_pod\":\"anthos-audit-logs-forwarder-fgkth\",\u00a0 \"user\":{\u00a0 \u00a0 \"username\":\"kubernetes-admin\",\u00a0 \u00a0 \"groups\":[\u00a0 \u00a0 \u00a0 \"system:masters\",\u00a0 \u00a0 \u00a0 \"system:authenticated\"\u00a0 \u00a0 ]\u00a0 },\u00a0 \"userAgent\":\"kubectl/v1.25.4 (linux/amd64) kubernetes/872a965\",\u00a0 \"verb\":\"create\",\u00a0 \"stage\":\"ResponseComplete\",\u00a0 \"stageTimestamp\":\"2022-12-05T16:28:50.636050Z\",\u00a0 \"_gdch_cluster\":\"org-1-admin\",\u00a0 \"objectRef\":{\u00a0 \u00a0 \"apiVersion\":\"v1\",\u00a0 \u00a0 \"apiGroup\":\"monitoring.gdc.goog\",\u00a0 \u00a0 \"name\":\"obs-test-alert-sequel\",\u00a0 \u00a0 \"namespace\":\"alice\",\u00a0 \u00a0 \"resource\":\"monitoringrules\"\u00a0 },\u00a0 \"responseStatus\":{\u00a0 \u00a0 \"code\":201,\u00a0 \u00a0 \"metadata\":{}\u00a0 },\u00a0 \"kind\":\"Event\",\u00a0 \"annotations\":{\u00a0 \u00a0 \"authorization.k8s.io/reason\":\"\",\u00a0 \u00a0 \"authorization.k8s.io/decision\":\"allow\"\u00a0 },\u00a0 \"requestReceivedTimestamp\":\"2022-12-05T16:28:50.619659Z\",\u00a0 \"_gdch_service_name\":\"apiserver\"}\n```", "guide": "Documentation"}