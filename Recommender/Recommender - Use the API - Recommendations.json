{"title": "Recommender - Use the API - Recommendations", "url": "https://cloud.google.com/recommender/docs/use-api", "abstract": "# Recommender - Use the API - Recommendations\n# Use the API - Recommendations\nThis page explains how to view and manage [recommendations](/recommender/docs/key-concepts#recommendations) in Recommender using [gcloud commands](/sdk/gcloud/reference/recommender) or the [REST API](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations) .\nA typical recommendation interaction with the Recommender API is:\n- [List recommendations](#list_recommendations) currently available for a specific recommender.\n- Mark a recommendation that you intend to apply as [claimed](#mark_a_recommendation_as_claimed_or_dismissed) , or mark a recommendation that you don't intend to apply as [dismissed](#mark_a_recommendation_as_claimed_or_dismissed) .\n- [Apply the recommendation](#applying_recommendations) using`gcloud`commands or REST API calls specific to the resource type (for example, IAM roles or Compute Engine VM instances).\n- Mark the recommendation as [succeeded or failed](#changing_the_state_of_a_recommendation) .\nNote that only recommendations retrieved through the API can be interacted with via the API or [BigQuery Export](/bq-export/export-recommendations-to-bq) .\nFor information about changing the state of recommendations in the Google Cloud console, refer to the documentation for [Recommendation Hub](/recommender/docs/recommendation-hub/identify-configuration-problems) or for the appropriate [recommender](/recommender/docs/recommenders) .\n**Warning:** Before applying recommendations in the Google Cloud console or using the API, ensure that impacts are assessed by a reviewer. The reviewer should have the knowledge to assess impacts identified in recommendations, as well as impacts specific to your infrastructure and business. Applying recommendations without proper assessment could result in unexpected changes, such as issues with system performance, poor reliability, or loss of required permissions. If you choose to apply recommendations without human review, ensure that you have set up a rollback process before making any changes.\n", "content": "## Set the default project\nSet the default project if you haven't done so already:\n```\ngcloud config set project PROJECT_ID\n```\nwhere is the ID of your project.\n## Set environment variables\nSet environment variables for Recommender interactions:\n```\nPROJECT=TARGET_PROJECT_ID\nLOCATION=LOCATION_ID\nRECOMMENDER=RECOMMENDER_ID\n```\nwhere:\n- is the project whose recommendations you want to list. This can be a different project than your current project.- For`gcloud`commands, you must use the project ID\n- For API requests, you can use the project number or project ID. Project number is recommended.\nThe project number is returned in responses from both the API and `gcloud` commands.\n- is the Google Cloud [location](/compute/docs/regions-zones) where resources associated with the recommendations are located (for example, `global` or `us-central1-a` ).\n- is the fully-qualified [recommender ID](/recommender/docs/recommenders#recommenders) (for example, `google.compute.instance.MachineTypeRecommender` ).\nSee [Recommenders](/recommender/docs/recommenders) for a table of links to information about each recommender, including supported locations and recommender IDs.\n## Set permissions\nYou must have permissions to access recommendations in the target project.\n- For requesters who include a [billing project](/sdk/gcloud/reference#--billing-project) in their request. The project used in the request must be in good standing, and the user must have a role in the project that contains the`serviceusage.services.use`permission. The **Service Usage Consumer** role contains the required permission.\n- Each recommender requires specific permissions. See [Recommenders](/recommender/docs/recommenders) for a table of links to information about each recommender, including the required permissions.\n**Note:** If you use the [x-goog-user-project header](/storage/docs/xml-api/reference-headers#xgooguserproject) or [userProject query string parameter](/storage/docs/xml-api/reference-headers#userProject) in your request, you must have `serviceusage.services.use` permission for the project ID that you specify, in addition to the normal IAM permissions required to make the request.\n## List recommendations\nTo list recommendations in the target project:\nEnter the following:\n```\ngcloud recommender recommendations list \\\n --project=${PROJECT} \\\n --location=${LOCATION} \\\n --recommender=${RECOMMENDER} \\\n --format=FORMAT\n```\nwhere is a supported `gcloud` [output format](/sdk/gcloud/reference/topic/formats) (for example, `json` ).\nFor example:\n```\ngcloud recommender recommendations list \\\n --project=example-project \\\n --location=us-central1-a \\\n --recommender=google.compute.instance.MachineTypeRecommender \\\n --format=json\n```\nEnter the following:\n```\ncurl \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: ${PROJECT}\" \\\n \"https://recommender.googleapis.com/v1/projects/${PROJECT}/locations/${LOCATION}/recommenders/${RECOMMENDER}/recommendations\"\n```\nFor example:\n```\ncurl \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: example-project\" \\\n \"https://recommender.googleapis.com/v1/projects/example-project/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations\"\n```\nThis operation outputs the current VM instance sizing recommendations in the target project as a list of [Recommendation](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations#resource:-recommendation) entities in the specified format.\nThe output is similar to the following:\n```\n[ {\n \"content\": {\n  \"operationGroups\": [  {\n   \"operations\": [   {\n    \"action\": \"test\",\n    \"path\": \"/machineType\",\n    \"resource\": \"//compute.googleapis.com/projects/example-project/zones/us-central1-a/instances/instance-1\",\n    \"resourceType\": \"compute.googleapis.com/Instance\",\n    \"valueMatcher\": {\n    \"matchesPattern\": \".*zones/us-central1-a/machineTypes/n1-standard-4\"\n    }\n   },\n   {\n    \"action\": \"replace\",\n    \"path\": \"/machineType\",\n    \"resource\": \"//compute.googleapis.com/projects/example-project/zones/us-central1-a/instances/instance-1\",\n    \"resourceType\": \"compute.googleapis.com/Instance\",\n    \"value\": \"zones/us-central1-a/machineTypes/custom-2-5120\"\n   }\n   ]\n  }\n  ]\n },\n \"description\": \"Save cost by changing machine type from n1-standard-4 to custom-2-5120.\",\n \"etag\": \"\\\"280b34810bba8a1a\\\"\",\n \"lastRefreshTime\": \"2019-06-28T06:49:21Z\",\n \"name\": \"projects/32428390823/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/a523ff7e-ed03-4143-a3a5-5b396b99cba9\",\n \"primaryImpact\": { ... },\n \"stateInfo\": {\n  \"state\": \"ACTIVE\"\n },\n \"recommenderSubtype\": \"CHANGE_MACHINE_TYPE\"\n }\n]\n```\nNote that the returned recommendations include the following fields:\n- A `name` field in the following format:```\nprojects/PROJECT_ID/locations/LOCATION/recommenders/RECOMMENDER_ID/recommendations/RECOMMENDATION_ID\n```where uniquely identifies the recommendation\n- An `etag` field that is associated with the current recommendation state.\nWhen you reference a recommendation using subsequent `gcloud` commands or REST API calls, you reference both the recommendation ID and etag, which makes sure that any operations are performed only if the recommendation has not been modified since you last retrieved it.\n## Mark a recommendation as claimed or dismissed\nYou can mark a recommendation as claimed to indicate that you intend to apply the recommended changes to the associated resource. When a recommendation is claimed, your user name is assigned as the actor for the recommendation, and Recommender does not update the recommendation with newer content.\nYou can mark a recommendation as dismissed to indicate that you do not intend to apply the recommended changes to the associated resource or that you do not want to continue to see the recommendation. When a recommendation is dismissed, it will no longer appear as an ACTIVE recommendation. Recommender may continue to update the recommendation with newer content.\nTo mark a recommendation as claimed or dismissed:\nEnter the following:\n```\ngcloud recommender recommendations STATE_CHANGE \\\n RECOMMENDATION_ID \\\n --project=${PROJECT} \\\n --location=${LOCATION} \\\n --recommender=${RECOMMENDER} \\\n --etag=etag \\\n --state-metadata=STATE_METADATA\n --format=FORMAT\n```\nWhere:- is the status you want to mark to a recommendation. Valid values are:- `mark-claimed`to mark the recommendation as claimed.\n- `mark-dismissed`to mark the recommendation as dismissed.\n- is the ID of a recommendation that you retrieved from a previous call to list recommendations\n- is the returned etag representing the recommendation state\n- is an optional metadata about the operation. Specify the metadata as a comma-separated list of=pairs. This option is available when you mark a recommendation as claimed, succeeded, or failed.\nFor example:\n```\ngcloud recommender recommendations mark-claimed \\\n a523ff7e-ed03-4143-a3a5-5b396b99cba9 \\\n --project=example-project \\\n --location=us-central1-a \\\n --recommender=google.compute.instance.MachineTypeRecommender \\\n --etag='\"280b34810bba8a1a\"' \\\n --state-metadata=priority=high,tracking_number=12345\n --format=json\n```\nEnter the following:\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: ${PROJECT}\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/${PROJECT}/locations/${LOCATION}/recommenders/${RECOMMENDER}/recommendations/RECOMMENDATION_ID:STATE_CHANGE \\\n<< EOM\n{\n \"etag\": \"etag\",\n \"stateMetadata\": STATE_METADATA\n}\nEOM\n```\nwhere:- is the status you want to mark to a recommendation. Valid values are:- `mark-claimed`to mark the recommendation as claimed.\n- `mark-dismissed`to mark the recommendation as dismissed.\n- is the ID of a recommendation that you retrieved from a previous call to list recommendations\n- is the returned etag representing the recommendation state\n- is an optional field with additional metadata about the operation. Specify the metadata as`key:value`pairs. This field is available when you mark a recommendation as claimed, succeeded, or failed.\nFor example:\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: example-project\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/example-project/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/8f20d509-83d2-45d2-8152-1b8d5d7d5831:markClaimed \\\n<< EOM\n{\n \"etag\": \"\\\"280b34810bba8a1a\\\"\"\n \"stateMetadata\": {\n \"priority\" : \"high\",\n \"tracking_number\": \"12345\"\n }\n}\nEOM\n```\nThis operation returns the [Recommendation](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations#resource:-recommendation) entity in the specified format after the operation has taken place.\nThe output is similar to the following:\n```\n{\n \"content\": {\n \"operationGroups\": [ ... ]\n },\n \"description\": \"Save cost by changing machine type from n1-standard-4 to custom-2-5120.\",\n \"etag\": \"\\\"5e3a63cccf1e0964\\\"\",\n \"lastRefreshTime\": \"2019-06-28T06:49:21Z\",\n \"name\": \"projects/32428390823/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/a523ff7e-ed03-4143-a3a5-5b396b99cba9\",\n \"primaryImpact\": { ... },\n \"stateInfo\": {\n \"state\": \"CLAIMED\"\n }\n}\n```\nNote that the value of the `state` field has changed to `CLAIMED` .\n## Applying recommendations\nAfter you have marked a recommendation as claimed, you can apply the recommendation using `gcloud` commands or REST API calls that are specific to the resource type.\nFor example, to change the size of a VM instance in response to a recommendation from the VM instance sizing recommender, you use Compute Engine [gcloud commands](/sdk/gcloud/reference/compute/instances) or calls to the Compute Engine [REST API](/compute/docs/reference/rest/v1) .\nWhen you perform these operations, you identify the target resource using the value of the `resource` field in the `OperationsGroup` array in the returned [Recommendation](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations#resource:-recommendation) entity. This field is in the following format:\n```\n//API_NAME/RESOURCE_PATH\n```\nFor example:\n```\n//compute.googleapis.com/projects/example-project/zones/us-central1-a/instances/instance-1\"\n```\n## Changing the state of a recommendation\nAfter you have applied a recommendation, you can mark it as succeeded or failed.\nTo mark a recommendation as succeeded:\nEnter the following:\n```\ngcloud recommender recommendations STATE_CHANGE \\\n RECOMMENDATION_ID \\\n --project=${PROJECT} \\\n --location=${LOCATION} \\\n --recommender=${RECOMMENDER} \\\n --etag=etag \\\n --state-metadata=priority=high,tracking_number=12345\n --format=FORMAT\n```\nWhere- is the change you want to make to a recommendation. Valid values are:- `mark-succeeded`to mark the recommendation as succeeded.\n- `mark-failed`to mark the recommendation as failed.\n- is optional metadata about the operation. Specify the metadata as a common-separated list of=pairs. This option is available when you mark a recommendation as claimed, succeeded, or failed.\nFor example:\n```\ngcloud recommender recommendations mark-succeeded \\\n a523ff7e-ed03-4143-a3a5-5b396b99cba9 \\\n --project=example-project \\\n --location=us-central1-a \\\n --recommender=google.compute.instance.MachineTypeRecommender \\\n --etag='\"5e3a63cccf1e0964\"' \\\n --state-metadata=priority=high,tracking_number=12345\n --format=json\n```\nEnter the following\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: ${PROJECT}\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/${PROJECT}/locations/${LOCATION}/recommenders/${RECOMMENDER}/recommendations/RECOMMENDATION_ID:STATE_CHANGE \\\n<< EOM\n{\n \"etag\": \"etag\"\n \"stateMetadata\": STATE_METADATA\n}\nEOM\n```\nwhere:- is the ID of a recommendation that you retrieved from a previous call to list recommendations\n- is the change you want to make to a recommendation. Valid values are:- `markSucceeded`to mark the recommendation as succeeded.\n- `markFailed`to mark the recommendation as failed.\n- is the returned etag representing the recommendation state\n- is an optional field with additional metadata about the operation. Specify the metadata as`key:value`pairs. This field is available when you mark a recommendation as claimed, succeeded, or failed.\nFor example:\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: example-project\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/example-project/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/8f20d509-83d2-45d2-8152-1b8d5d7d5831:markSucceeded \\\n<< EOM\n{\n \"etag\": \"\\\"280b34810bba8a1a\\\"\"\n \"stateMetadata\": {\n \"priority\" : \"high\",\n \"tracking_number\": \"12345\"\n }\n}\nEOM\n```\nThis operation returns the [Recommendation](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations#resource:-recommendation) entity in the specified format after the operation has taken place.\nThe output is similar to the following:\n```\n{\n \"content\": {\n \"operationGroups\": [ ... ]\n },\n \"description\": \"Save cost by changing machine type from n1-standard-4 to custom-2-5120.\",\n \"etag\": \"\\\"5e3a63cccf1e053c\\\"\",\n \"lastRefreshTime\": \"2019-06-28T06:49:21Z\",\n \"name\": \"projects/32428390823/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/a523ff7e-ed03-4143-a3a5-5b396b99cba9\",\n \"primaryImpact\": { ... },\n \"stateInfo\": {\n \"state\": \"SUCCEEDED\",\n \"stateMetadata\": {\n  \"priority\" : \"high\",\n  \"tracking_number\": \"12345\"\n }\n }\n}\n```\nNote that the value of the `state` field has changed to `SUCCEEDED` .", "guide": "Recommender"}