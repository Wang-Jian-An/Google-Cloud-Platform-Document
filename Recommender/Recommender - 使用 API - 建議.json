{"title": "Recommender - \u4f7f\u7528 API - \u5efa\u8b70", "url": "https://cloud.google.com/recommender/docs/use-api?hl=zh-cn", "abstract": "# Recommender - \u4f7f\u7528 API - \u5efa\u8b70\n# \u4f7f\u7528 API - \u5efa\u8b70\n\u672c\u9801\u9762\u4ecb\u7d39\u77ad\u5982\u4f55\u5728 Recommender \u4e2d\u4f7f\u7528 [gcloud \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/recommender?hl=zh-cn) \u6216 [REST API](https://cloud.google.com/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations?hl=zh-cn) \u67e5\u770b\u548c\u7ba1\u7406 [\u5efa\u8b70](https://cloud.google.com/recommender/docs/key-concepts?hl=zh-cn#recommendations) \u3002\n\u8207 Recommender API \u4ea4\u4e92\u7684\u5178\u578b\u5efa\u8b70\u662f\uff1a\n- \u5217\u51fa\u7576\u524d\u9069\u7528\u65bc\u7279\u5b9a Recommender \u7684 [\u5efa\u8b70](#list_recommendations) \u3002\n- \u5c07\u60a8\u6253\u7b97\u61c9\u7528\u7684\u5efa\u8b70\u6a19\u8a18\u7232 [\u5df2\u4f54\u7528](#mark_a_recommendation_as_claimed_or_dismissed) \uff0c\u6216\u8005\u5c07\u60a8\u4e0d\u6253\u7b97\u61c9\u7528\u7684\u5efa\u8b70\u6a19\u8a18\u7232 [\u5df2\u5ffd\u7565](#mark_a_recommendation_as_claimed_or_dismissed) \n- \u4f7f\u7528\u7279\u5b9a\u65bc\u8cc7\u6e90\u985e\u578b\uff08\u4f8b\u5982 IAM \u89d2\u8272\u6216 Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\uff09\u7684`gcloud`\u547d\u4ee4\u6216 REST API \u8abf\u7528 [\u63a1\u7d0d\u5efa\u8b70](#applying_recommendations) \n- \u5c07\u5efa\u8b70\u6a19\u8a18\u7232 [\u6210\u529f\u6216\u5931\u6557](#changing_the_state_of_a_recommendation) \n\u8acb\u6ce8\u610f\uff0c\u53ea\u6709\u901a\u904e API \u6aa2\u7d22\u7684\u5efa\u8b70\u624d\u80fd\u901a\u904e API \u6216 [BigQuery Export](https://cloud.google.com/bq-export/export-recommendations-to-bq?hl=zh-cn) \u9032\u884c\u4ea4\u4e92\u3002\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u66f4\u6539\u5efa\u8b70\u7684\u72c0\u614b\uff0c\u8acb\u53c3\u95b1 [Recommendation Hub](https://cloud.google.com/recommender/docs/recommendation-hub/identify-configuration-problems?hl=zh-cn) \u6216\u76f8\u61c9\u7684 [Recommender](https://cloud.google.com/recommender/docs/recommenders?hl=zh-cn) \u7684\u6587\u6a94\u3002\n**\u8b66\u544a** \uff1a\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u63a1\u7528\u5efa\u8b70\u6216\u4f7f\u7528 API \u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u5be9\u8988\u4eba\u54e1\u8a55\u4f30\u4e86\u5f71\u97ff\u3002\u5be9\u8988\u8005\u61c9\u5177\u5099\u76f8\u95dc\u77e5\u8b58\uff0c\u4ee5\u8a55\u4f30\u5efa\u8b70\u4e2d\u78ba\u5b9a\u7684\u5f71\u97ff\u4ee5\u53ca\u7279\u5b9a\u65bc\u60a8\u7684\u57fa\u790e\u8a2d\u65bd\u548c\u696d\u52d9\u7684\u5f71\u97ff\u3002\u5728\u6c92\u6709\u9032\u884c\u9069\u7576\u8a55\u4f30\u7684\u60c5\u6cc1\u4e0b\u61c9\u7528\u5efa\u8b70\u53ef\u80fd\u6703\u5c0e\u81f4\u610f\u5916\u7684\u66f4\u6539\uff0c\u4f8b\u5982\u7cfb\u7d71\u6027\u80fd\u554f\u984c\u3001\u53ef\u9760\u6027\u4e0d\u4f73\u6216\u7f3a\u5c11\u6240\u9700\u6b0a\u9650\u7b49\u3002\u5982\u679c\u60a8\u9078\u64c7\u5728\u6c92\u6709\u4eba\u5de5\u5be9\u8988\u7684\u60c5\u6cc1\u4e0b\u61c9\u7528\u5efa\u8b70\uff0c\u8acb\u52d9\u5fc5\u5148\u8a2d\u7f6e\u56de\u6efe\u904e\u7a0b\uff0c\u518d\u9032\u884c\u66f4\u6539\u3002\n", "content": "## \u8a2d\u7f6e\u9ed8\u8a8d\u9805\u76ee\n\u8a2d\u7f6e\u9ed8\u8a8d\u9805\u76ee\uff08\u5982\u679c\u5c1a\u672a\u8a2d\u7f6e\uff09\uff1a\n```\ngcloud config set project PROJECT_ID\n```\n\u5176\u4e2d \u662f\u9805\u76ee ID\u3002\n## \u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\n\u7232 Recommender \u4e92\u52d5\u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\uff1a\n```\nPROJECT=TARGET_PROJECT_ID\nLOCATION=LOCATION_ID\nRECOMMENDER=RECOMMENDER_ID\n```\n\u5176\u4e2d\uff1a\n- \u662f\u8981\u5217\u51fa\u5176\u5efa\u8b70\u7684\u9805\u76ee\u3002\u8a72\u9805\u76ee\u53ef\u4ee5\u662f\u7576\u524d\u9805\u76ee\u4ee5\u5916\u7684\u9805\u76ee\u3002- \u5c0d\u65bc`gcloud`\u547d\u4ee4\uff0c\u60a8\u5fc5\u9808\u4f7f\u7528\u9805\u76ee ID\n- \u5c0d\u65bc API \u8acb\u6c42\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u9805\u76ee\u7de8\u865f\u6216\u9805\u76ee ID\u3002\u5efa\u8b70\u4f7f\u7528\u9805\u76ee\u7de8\u865f\u3002\n\u9805\u76ee\u7de8\u865f\u5728 API \u548c `gcloud` \u547d\u4ee4\u8fd4\u56de\u7684\u97ff\u61c9\u4e2d\u8fd4\u56de\u3002\n- \u662f\u8207\u5efa\u8b70\u95dc\u806f\u7684\u8cc7\u6e90\u6240\u5728\u7684 Google Cloud [\u4f4d\u7f6e](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn) \uff08\u4f8b\u5982 `global` \u6216 `us-central1-a` \uff09\n- \u662f\u5b8c\u5168\u9650\u5b9a\u7684 [Recommender ID](https://cloud.google.com/recommender/docs/recommenders?hl=zh-cn#recommenders) \uff08\u4f8b\u5982 `google.compute.instance.MachineTypeRecommender` \uff09\u3002\n\u8acb\u53c3\u95b1 [Recommender](https://cloud.google.com/recommender/docs/recommenders?hl=zh-cn) \uff0c\u7372\u53d6\u6bcf\u500b Recommender\uff08\u5305\u62ec\u652f\u6301\u7684\u4f4d\u7f6e\u548c Recommender ID\uff09\u76f8\u95dc\u4fe1\u606f\u7684\u93c8\u63a5\u8868\u3002\n## \u8a2d\u7f6e\u6b0a\u9650\n\u60a8\u5fc5\u9808\u64c1\u6709\u8a2a\u554f\u76ee\u6a19\u9805\u76ee\u4e2d\u5efa\u8b70\u7684\u6b0a\u9650\u3002\n- \u5c0d\u65bc\u5728\u8acb\u6c42\u4e2d\u5305\u542b [\u7d50\u7b97\u9805\u76ee](https://cloud.google.com/sdk/gcloud/reference?hl=zh-cn#--billing-project) \u7684\u8acb\u6c42\u8005\u3002\u8acb\u6c42\u4e2d\u4f7f\u7528\u7684\u9805\u76ee\u5fc5\u9808\u4fe1\u8b7d\u826f\u597d\uff0c\u4e26\u4e14\u7528\u6236\u5728\u9805\u76ee\u4e2d\u5fc5\u9808\u5177\u6709\u89d2\u8272\uff0c\u6b64\u89d2\u8272\u5305\u542b`serviceusage.services.use`\u6b0a\u9650\u3002 **Service Usage Consumer** \u89d2\u8272\u5305\u542b\u6240\u9700\u7684\u6b0a\u9650\u3002\n- \u6bcf\u500b Recommender \u90fd\u9700\u8981\u7279\u5b9a\u6b0a\u9650\u3002\u8acb\u53c3\u95b1 [Recommender](https://cloud.google.com/recommender/docs/recommenders?hl=zh-cn) \uff0c\u7372\u53d6\u6bcf\u500b Recommender\uff08\u5305\u62ec\u6240\u9700\u6b0a\u9650\uff09\u76f8\u95dc\u4fe1\u606f\u7684\u93c8\u63a5\u8868\u3002\n**\u6ce8\u610f** \uff1a\u5982\u8981\u5728\u8acb\u6c42\u4e2d\u4f7f\u7528 [x-goog-user-project \u6a19\u982d](https://cloud.google.com/storage/docs/xml-api/reference-headers?hl=zh-cn#xgooguserproject) \u6216 [userProject \u67e5\u8a62\u5b57\u7b26\u4e32\u53c3\u6578](https://cloud.google.com/storage/docs/xml-api/reference-headers?hl=zh-cn#userProject) \uff0c\u9664\u4e86\u767c\u51fa\u8acb\u6c42\u6240\u9700\u7684\u666e\u901a IAM \u6b0a\u9650\uff0c\u9084\u5fc5\u9808\u64c1\u6709\u6307\u5b9a\u9805\u76ee ID \u7684 `serviceusage.services.use` \u6b0a\u9650\u3002\n## \u5217\u51fa\u5efa\u8b70\n\u8981\u5217\u51fa\u76ee\u6a19\u9805\u76ee\u4e2d\u7684\u5efa\u8b70\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\ngcloud recommender recommendations list \\\n --project=${PROJECT} \\\n --location=${LOCATION} \\\n --recommender=${RECOMMENDER} \\\n --format=FORMAT\n```\n\u5176\u4e2d\uff0c \u662f\u53d7\u652f\u6301\u7684 `gcloud` [\u8f38\u51fa\u683c\u5f0f](https://cloud.google.com/sdk/gcloud/reference/topic/formats?hl=zh-cn) \uff08\u4f8b\u5982 `json` \uff09\u3002\n\u4f8b\u5982\uff1a\n```\ngcloud recommender recommendations list \\\n --project=example-project \\\n --location=us-central1-a \\\n --recommender=google.compute.instance.MachineTypeRecommender \\\n --format=json\n```\n\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\ncurl \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: ${PROJECT}\" \\\n \"https://recommender.googleapis.com/v1/projects/${PROJECT}/locations/${LOCATION}/recommenders/${RECOMMENDER}/recommendations\"\n```\n\u4f8b\u5982\uff1a\n```\ncurl \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: example-project\" \\\n \"https://recommender.googleapis.com/v1/projects/example-project/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations\"\n```\n\u6b64\u64cd\u4f5c\u6703\u5c07\u76ee\u6a19\u9805\u76ee\u4e2d\u7684\u7576\u524d\u5bb9\u91cf\u5efa\u8b70\u8f38\u51fa\u7232\u63a1\u7528\u6307\u5b9a\u683c\u5f0f\u7684 [Recommendation](https://cloud.google.com/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations?hl=zh-cn#resource:-recommendation) \u5be6\u9ad4\u5217\u8868\u3002\n\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a\n```\n[ {\n \"content\": {\n  \"operationGroups\": [  {\n   \"operations\": [   {\n    \"action\": \"test\",\n    \"path\": \"/machineType\",\n    \"resource\": \"//compute.googleapis.com/projects/example-project/zones/us-central1-a/instances/instance-1\",\n    \"resourceType\": \"compute.googleapis.com/Instance\",\n    \"valueMatcher\": {\n    \"matchesPattern\": \".*zones/us-central1-a/machineTypes/n1-standard-4\"\n    }\n   },\n   {\n    \"action\": \"replace\",\n    \"path\": \"/machineType\",\n    \"resource\": \"//compute.googleapis.com/projects/example-project/zones/us-central1-a/instances/instance-1\",\n    \"resourceType\": \"compute.googleapis.com/Instance\",\n    \"value\": \"zones/us-central1-a/machineTypes/custom-2-5120\"\n   }\n   ]\n  }\n  ]\n },\n \"description\": \"Save cost by changing machine type from n1-standard-4 to custom-2-5120.\",\n \"etag\": \"\\\"280b34810bba8a1a\\\"\",\n \"lastRefreshTime\": \"2019-06-28T06:49:21Z\",\n \"name\": \"projects/32428390823/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/a523ff7e-ed03-4143-a3a5-5b396b99cba9\",\n \"primaryImpact\": { ... },\n \"stateInfo\": {\n  \"state\": \"ACTIVE\"\n },\n \"recommenderSubtype\": \"CHANGE_MACHINE_TYPE\"\n }\n]\n```\n\u8acb\u6ce8\u610f\uff0c\u8fd4\u56de\u7684\u5efa\u8b70\u5305\u62ec\u4ee5\u4e0b\u5b57\u6bb5\uff1a\n- \u63a1\u7528\u4ee5\u4e0b\u683c\u5f0f\u7684 `name` \u5b57\u6bb5\uff1a```\nprojects/PROJECT_ID/locations/LOCATION/recommenders/RECOMMENDER_ID/recommendations/RECOMMENDATION_ID\n```\u5176\u4e2d\uff0c \u552f\u4e00\u6a19\u8b58\u5efa\u8b70\n- \u8207\u7576\u524d\u5efa\u8b70\u72c0\u614b\u95dc\u806f\u7684 `etag` \u5b57\u6bb5\u3002\n\u7576\u60a8\u4f7f\u7528\u5f8c\u7e8c\u7684 `gcloud` \u547d\u4ee4\u6216 REST API \u8abf\u7528\u5f15\u7528\u5efa\u8b70\u6642\uff0c\u8acb\u540c\u6642\u5f15\u7528\u5efa\u8b70 ID \u548c Etag\uff0c\u4ee5\u78ba\u4fdd\u53ea\u6709\u5728\u4e0a\u6b21\u6aa2\u7d22\u5efa\u8b70\u5f8c\u6c92\u6709\u4efb\u4f55\u66f4\u6539\u7684\u60c5\u6cc1\u4e0b\u57f7\u884c\u6240\u6709\u64cd\u4f5c\u3002\n## \u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u6216\u5df2\u5ffd\u7565\n\u60a8\u53ef\u4ee5\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\uff0c\u4ee5\u8868\u793a\u60a8\u6253\u7b97\u5c07\u5efa\u8b70\u7684\u66f4\u6539\u61c9\u7528\u65bc\u95dc\u806f\u7684\u8cc7\u6e90\u3002\u7576\u5efa\u8b70\u88ab\u4f54\u7528\u5f8c\uff0c\u60a8\u7684\u7528\u6236\u540d\u5c07\u88ab\u6307\u5b9a\u7232\u5efa\u8b70\u7684\u57f7\u884c\u8005\uff0c\u4e14 Recommender \u5c07\u4e0d\u518d\u4f7f\u7528\u65b0\u5167\u5bb9\u66f4\u65b0\u5efa\u8b70\u3002\n\u60a8\u53ef\u4ee5\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u5ffd\u7565\uff0c\u4ee5\u8868\u793a\u60a8\u4e0d\u6253\u7b97\u5c07\u5efa\u8b70\u7684\u66f4\u6539\u61c9\u7528\u65bc\u95dc\u806f\u7684\u8cc7\u6e90\uff0c\u6216\u8005\u60a8\u4e0d\u60f3\u7e7c\u7e8c\u770b\u5230\u8a72\u5efa\u8b70\u3002\u5ffd\u7565\u4e00\u689d\u5efa\u8b70\u5f8c\uff0c\u5b83\u5c07\u4e0d\u518d\u986f\u793a\u7232\u201c\u6709\u6548\u201d\u5efa\u8b70\u3002Recommender \u53ef\u80fd\u6703\u7e7c\u7e8c\u4f7f\u7528\u8f03\u65b0\u5167\u5bb9\u4f86\u66f4\u65b0\u5efa\u8b70\u3002\n\u5982\u9700\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u6216\u5df2\u5ffd\u7565\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\ngcloud recommender recommendations STATE_CHANGE \\\n RECOMMENDATION_ID \\\n --project=${PROJECT} \\\n --location=${LOCATION} \\\n --recommender=${RECOMMENDER} \\\n --etag=etag \\\n --state-metadata=STATE_METADATA\n --format=FORMAT\n```\n\u5176\u4e2d\uff1a- \u662f\u60a8\u8981\u7232\u5efa\u8b70\u6a19\u8a18\u7684\u72c0\u614b\u3002\u6709\u6548\u503c\u5305\u62ec\uff1a- `mark-claimed`\u53ef\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u3002\n- `mark-dismissed`\u53ef\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u5ffd\u7565\u3002\n- \u662f\u5f9e\u4e0a\u4e00\u6b21\u5217\u51fa\u5efa\u8b70\u8abf\u7528\u4e2d\u6aa2\u7d22\u5230\u7684\u5efa\u8b70 ID\n- \u662f\u8fd4\u56de\u7684\u8868\u793a\u5efa\u8b70\u72c0\u614b\u7684 ETag\n- \u662f\u8a72\u64cd\u4f5c\u7684\u53ef\u9078\u5143\u6578\u64da\u3002\u5c07\u5143\u6578\u64da\u6307\u5b9a\u7232\u4ee5\u82f1\u6587\u9017\u865f\u5206\u9694\u7684=\u5c0d\u5217\u8868\u3002\u5982\u679c\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u3001\u6210\u529f\u6216\u5931\u6557\uff0c\u5247\u6b64\u9078\u9805\u53ef\u7528\u3002\n\u4f8b\u5982\uff1a\n```\ngcloud recommender recommendations mark-claimed \\\n a523ff7e-ed03-4143-a3a5-5b396b99cba9 \\\n --project=example-project \\\n --location=us-central1-a \\\n --recommender=google.compute.instance.MachineTypeRecommender \\\n --etag='\"280b34810bba8a1a\"' \\\n --state-metadata=priority=high,tracking_number=12345\n --format=json\n```\n\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: ${PROJECT}\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/${PROJECT}/locations/${LOCATION}/recommenders/${RECOMMENDER}/recommendations/RECOMMENDATION_ID:STATE_CHANGE \\\n<< EOM\n{\n \"etag\": \"etag\",\n \"stateMetadata\": STATE_METADATA\n}\nEOM\n```\n\u5176\u4e2d\uff1a- \u662f\u60a8\u8981\u7232\u5efa\u8b70\u6a19\u8a18\u7684\u72c0\u614b\u3002\u6709\u6548\u503c\u5305\u62ec\uff1a- `mark-claimed`\u53ef\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u3002\n- `mark-dismissed`\u53ef\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u5ffd\u7565\u3002\n- \u662f\u5f9e\u4e0a\u4e00\u6b21\u5217\u51fa\u5efa\u8b70\u8abf\u7528\u4e2d\u6aa2\u7d22\u5230\u7684\u5efa\u8b70 ID\n- \u662f\u8fd4\u56de\u7684\u8868\u793a\u5efa\u8b70\u72c0\u614b\u7684 ETag\n- \u662f\u95dc\u65bc\u64cd\u4f5c\u7684\u5176\u4ed6\u5143\u6578\u64da\u7684\u53ef\u9078\u5b57\u6bb5\u3002\u5c07\u5143\u6578\u64da\u6307\u5b9a\u7232`key:value`\u5c0d\u3002\u5982\u679c\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u3001\u6210\u529f\u6216\u5931\u6557\uff0c\u5247\u6b64\u5b57\u6bb5\u53ef\u7528\u3002\n\u4f8b\u5982\uff1a\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: example-project\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/example-project/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/8f20d509-83d2-45d2-8152-1b8d5d7d5831:markClaimed \\\n<< EOM\n{\n \"etag\": \"\\\"280b34810bba8a1a\\\"\"\n \"stateMetadata\": {\n \"priority\" : \"high\",\n \"tracking_number\": \"12345\"\n }\n}\nEOM\n```\n\u6b64\u64cd\u4f5c\u5b8c\u6210\u5f8c\uff0c\u6703\u4ee5\u6307\u5b9a\u7684\u683c\u5f0f\u8fd4\u56de [Recommendation](https://cloud.google.com/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations?hl=zh-cn#resource:-recommendation) \u5be6\u9ad4\u3002\n\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a\n```\n{\n \"content\": {\n \"operationGroups\": [ ... ]\n },\n \"description\": \"Save cost by changing machine type from n1-standard-4 to custom-2-5120.\",\n \"etag\": \"\\\"5e3a63cccf1e0964\\\"\",\n \"lastRefreshTime\": \"2019-06-28T06:49:21Z\",\n \"name\": \"projects/32428390823/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/a523ff7e-ed03-4143-a3a5-5b396b99cba9\",\n \"primaryImpact\": { ... },\n \"stateInfo\": {\n \"state\": \"CLAIMED\"\n }\n}\n```\n\u8acb\u6ce8\u610f\uff0c `state` \u5b57\u6bb5\u7684\u503c\u5df2\u66f4\u6539\u7232 `CLAIMED` \u3002\n## \u63a1\u7d0d\u5efa\u8b70\n\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7279\u5b9a\u65bc\u8cc7\u6e90\u985e\u578b\u7684 `gcloud` \u547d\u4ee4\u6216 REST API \u8abf\u7528\u4f86\u63a1\u7d0d\u5efa\u8b70\u3002\n\u4f8b\u5982\uff0c\u82e5\u8981\u66f4\u6539\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u5927\u5c0f\u4f86\u97ff\u61c9\u865b\u64ec\u6a5f\u5be6\u4f8b\u5bb9\u91cf Recommender \u7684\u5efa\u8b70\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Compute Engine [gcloud \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/instances?hl=zh-cn) \u6216\u8abf\u7528 Compute Engine [REST API](https://cloud.google.com/compute/docs/reference/rest/v1?hl=zh-cn) \u3002\n\u57f7\u884c\u9019\u4e9b\u64cd\u4f5c\u6642\uff0c\u8acb\u4f7f\u7528\u8fd4\u56de\u7684 [Recommendation](https://cloud.google.com/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations?hl=zh-cn#resource:-recommendation) \u5be6\u9ad4\u7684 `OperationsGroup` \u6578\u7d44\u4e2d `resource` \u5b57\u6bb5\u7684\u503c\u6a19\u8b58\u76ee\u6a19\u8cc7\u6e90\u3002\u6b64\u5b57\u6bb5\u63a1\u7528\u4ee5\u4e0b\u683c\u5f0f\uff1a\n```\n//API_NAME/RESOURCE_PATH\n```\n\u4f8b\u5982\uff1a\n```\n//compute.googleapis.com/projects/example-project/zones/us-central1-a/instances/instance-1\"\n```\n## \u66f4\u6539\u5efa\u8b70\u7684\u72c0\u614b\n\u5728\u63a1\u7d0d\u5efa\u8b70\u5f8c\uff0c\u60a8\u53ef\u4ee5\u5c07\u5176\u6a19\u8a18\u7232\u6210\u529f\u6216\u5931\u6557\u3002\n\u5982\u8981\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u6210\u529f\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\ngcloud recommender recommendations STATE_CHANGE \\\n RECOMMENDATION_ID \\\n --project=${PROJECT} \\\n --location=${LOCATION} \\\n --recommender=${RECOMMENDER} \\\n --etag=etag \\\n --state-metadata=priority=high,tracking_number=12345\n --format=FORMAT\n```\nWhere- \u662f\u60a8\u8981\u5c0d\u5efa\u8b70\u9032\u884c\u7684\u66f4\u6539\u3002\u6709\u6548\u503c\u5305\u62ec\uff1a- `mark-succeeded`\u53ef\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u6210\u529f\u3002\n- `mark-failed`\u53ef\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5931\u6557\u3002\n- \u662f\u8a72\u64cd\u4f5c\u7684\u53ef\u9078\u5143\u6578\u64da\u3002\u5c07\u5143\u6578\u64da\u6307\u5b9a\u7232=\u5c0d\u7684\u5e38\u898b\u5206\u9694\u5217\u8868\u3002\u5982\u679c\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u3001\u6210\u529f\u6216\u5931\u6557\uff0c\u5247\u6b64\u9078\u9805\u53ef\u7528\u3002\n\u4f8b\u5982\uff1a\n```\ngcloud recommender recommendations mark-succeeded \\\n a523ff7e-ed03-4143-a3a5-5b396b99cba9 \\\n --project=example-project \\\n --location=us-central1-a \\\n --recommender=google.compute.instance.MachineTypeRecommender \\\n --etag='\"5e3a63cccf1e0964\"' \\\n --state-metadata=priority=high,tracking_number=12345\n --format=json\n```\n\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: ${PROJECT}\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/${PROJECT}/locations/${LOCATION}/recommenders/${RECOMMENDER}/recommendations/RECOMMENDATION_ID:STATE_CHANGE \\\n<< EOM\n{\n \"etag\": \"etag\"\n \"stateMetadata\": STATE_METADATA\n}\nEOM\n```\n\u5176\u4e2d\uff1a- \u662f\u5f9e\u4e0a\u4e00\u6b21\u5217\u51fa\u5efa\u8b70\u8abf\u7528\u4e2d\u6aa2\u7d22\u5230\u7684\u5efa\u8b70 ID\n- \u662f\u60a8\u8981\u5c0d\u5efa\u8b70\u9032\u884c\u7684\u66f4\u6539\u3002\u6709\u6548\u503c\u5305\u62ec\uff1a- `markSucceeded`\u53ef\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u6210\u529f\u3002\n- `markFailed`\u53ef\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5931\u6557\u3002\n- \u662f\u8fd4\u56de\u7684\u8868\u793a\u5efa\u8b70\u72c0\u614b\u7684 ETag\n- \u662f\u95dc\u65bc\u64cd\u4f5c\u7684\u5176\u4ed6\u5143\u6578\u64da\u7684\u53ef\u9078\u5b57\u6bb5\u3002\u5c07\u5143\u6578\u64da\u6307\u5b9a\u7232`key:value`\u5c0d\u3002\u5982\u679c\u5c07\u5efa\u8b70\u6a19\u8a18\u7232\u5df2\u4f54\u7528\u3001\u6210\u529f\u6216\u5931\u6557\uff0c\u5247\u6b64\u5b57\u6bb5\u53ef\u7528\u3002\n\u4f8b\u5982\uff1a\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: example-project\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/example-project/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/8f20d509-83d2-45d2-8152-1b8d5d7d5831:markSucceeded \\\n<< EOM\n{\n \"etag\": \"\\\"280b34810bba8a1a\\\"\"\n \"stateMetadata\": {\n \"priority\" : \"high\",\n \"tracking_number\": \"12345\"\n }\n}\nEOM\n```\n\u6b64\u64cd\u4f5c\u5b8c\u6210\u5f8c\uff0c\u6703\u4ee5\u6307\u5b9a\u7684\u683c\u5f0f\u8fd4\u56de [Recommendation](https://cloud.google.com/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations?hl=zh-cn#resource:-recommendation) \u5be6\u9ad4\u3002\n\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a\n```\n{\n \"content\": {\n \"operationGroups\": [ ... ]\n },\n \"description\": \"Save cost by changing machine type from n1-standard-4 to custom-2-5120.\",\n \"etag\": \"\\\"5e3a63cccf1e053c\\\"\",\n \"lastRefreshTime\": \"2019-06-28T06:49:21Z\",\n \"name\": \"projects/32428390823/locations/us-central1-a/recommenders/google.compute.instance.MachineTypeRecommender/recommendations/a523ff7e-ed03-4143-a3a5-5b396b99cba9\",\n \"primaryImpact\": { ... },\n \"stateInfo\": {\n \"state\": \"SUCCEEDED\",\n \"stateMetadata\": {\n  \"priority\" : \"high\",\n  \"tracking_number\": \"12345\"\n }\n }\n}\n```\n\u8acb\u6ce8\u610f\uff0c `state` \u5b57\u6bb5\u7684\u503c\u5df2\u66f4\u6539\u7232 `SUCCEEDED` \u3002", "guide": "Recommender"}