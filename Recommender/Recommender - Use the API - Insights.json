{"title": "Recommender - Use the API - Insights", "url": "https://cloud.google.com/recommender/docs/insights/use-api", "abstract": "# Recommender - Use the API - Insights\n# Use the API - Insights\nThis page explains how to view and manage [insights](/recommender/docs/insights/using-insights#insights) in Recommender using [gcloud commands](/sdk/gcloud/reference/recommender) or the [REST API](/recommender/docs/reference/rest/v1/projects.locations.insightTypes.insights) .\nA typical insight interaction with the Recommender API is:\n- [List insights](#list_insights) currently available for a specific insight type\n- Mark an insight that you intend to take action on as [accepted](#mark_an_insight_as_accepted) \nFor information about changing the state of insights in the Google Cloud console, refer to the documentation for the [Recommendation Hub](/recommender/docs/recommendation-hub/identify-configuration-problems) or for the appropriate [insight type](/recommender/docs/insights/insight-types) .\n", "content": "## Set the default project\nSet the default project if you haven't done so already:\n```\ngcloud config set project PROJECT_ID\n```\nwhere is the ID of your project.\n## Set environment variables\nSet environment variables for Recommender interactions:\n```\nPROJECT=TARGET_PROJECT_ID\nLOCATION=LOCATION_ID\nINSIGHT_TYPE=INSIGHT_TYPE_ID\n```\nwhere:\n- is the project whose insights you want to list. This can be a different project than your current project.- For`gcloud`commands, you must use the project ID\n- For API requests, you can use the project number or project ID. Project number is recommended.\nThe project number is returned in responses from both the API and `gcloud` commands.\n- is the Google Cloud [location](/compute/docs/regions-zones) where resources associated with the insights are located (for example, `global` or `us-central1-a` ).\n- is the fully-qualified [insight type ID](/recommender/docs/insights/insight-types) (for example, `google.iam.policy.Insight` ).\nSee [Insight types](/recommender/docs/insights/insight-types) for a table of links to information about each insight type, including supported locations and insight type IDs.\n## Set permissions\nYou must have permissions to access insights in the target project.\n- For requesters who include a [billing project](/sdk/gcloud/reference#--billing-project) in their request. The project used in the request must be in good standing, and the user must have a role in the project that contains the`serviceusage.services.use`permission. The **Service Usage Consumer** role contains the required permission.\n- Each insight type requires specific permissions. See [Insight types](/recommender/docs/insights/insight-types) for a table of links to information about each insight type, including the required permissions.\n**Note:** If you use the [x-goog-user-project header](/storage/docs/xml-api/reference-headers#xgooguserproject) or [userProject query string parameter](/storage/docs/xml-api/reference-headers#userProject) in your request, you must have `serviceusage.services.use` permission for the project ID that you specify, in addition to the normal IAM permissions required to make the request.\n## List insights\nTo list insights in the target project:\nEnter the following:\n```\ngcloud recommender insights list \\\n --project=${PROJECT} \\\n --location=${LOCATION} \\\n --insight-type=${INSIGHT_TYPE} \\\n --format=FORMAT\n```\nwhere is a supported `gcloud` [output format](/sdk/gcloud/reference/topic/formats) (for example, `json` ).\nFor example:\n```\ngcloud recommender insights list \\\n --project=example-project \\\n --location=global \\\n --insight-type=google.iam.policy.Insight \\\n --format=json\n```\nEnter the following:\n```\ncurl \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: ${PROJECT}\" \\\n \"https://recommender.googleapis.com/v1/projects/${PROJECT}/locations/${LOCATION}/insightTypes/${INSIGHT_TYPE}/insights\"\n```\nFor example:\n```\ncurl \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: example-project\" \\\n \"https://recommender.googleapis.com/v1/projects/example-project/locations/us-central1-a/insightTypes/google.iam.policy.Insight/insights\"\n```\nThis operation outputs the current IAM policy insights in the target project as a list of [Insight](/recommender/docs/reference/rest/v1/projects.locations.insightTypes.insights#resource:-insight) entities in the specified format.\nThe output is similar to the following:\n```\n[ {\n \"category\": \"SECURITY\",\n \"content\": {\n  \"condition\": {\n  \"description\": \"\",\n  \"expression\": \"\",\n  \"location\": \"\",\n  \"title\": \"\"\n  },\n  \"exercisedPermissions\": [],\n  \"inferredPermissions\": [],\n  \"member\": \"user:my-service-account@example-project.iam.gserviceaccount.com\",\n  \"role\": \"roles/iam.securityReviewer\"\n },\n \"description\": \"0 permission checks were authorized by this policy binding tuple.\",\n \"etag\": \"\\\"45f4e2c63f6952e8\\\"\",\n \"insightSubtype\": \"PERMISSIONS_USAGE\",\n \"lastRefreshTime\": \"2020-03-06T08:00:00Z\",\n \"name\": \"projects/32428390823/locations/global/insightTypes/google.iam.policy.Insight/insights/a523ff7e-ed03-4143-a3a5-5b396b99cba9\",\n \"observationPeriod\": \"7776000s\",\n \"stateInfo\": {\n  \"state\": \"ACTIVE\",\n },\n \"targetResources\": [  \"//cloudresourcemanager.googleapis.com/projects/32428390823\"\n ],\n }\n]\n```\nNote that the returned insights include the following fields:\n- A `name` field in the following format:```\nprojects/PROJECT_ID/locations/LOCATION/insightTypes/INSIGHT_TYPE_ID/insights/INSIGHT_ID\n```where uniquely identifies the insight\n- An `etag` field that is associated with the current insight state.\nWhen you reference an insight using subsequent `gcloud` commands or REST API calls, you reference both the insight ID and etag, which makes sure that any operations are performed only if the insight has not been modified since you last retrieved it.\n## Mark an insight as accepted\nYou can mark an insight as accepted to indicate that you intend to take or have taken an action on an associated resource based on the information provided in the insight. When an insight is accepted, your user name is assigned as the actor for the insight, and Recommender will not update the insight with newer content.\nTo mark an insight as accepted:\nEnter the following:\n```\ngcloud recommender insights mark-accepted \\\n INSIGHT_ID \\\n --project=${PROJECT} \\\n --location=${LOCATION} \\\n --insight-type=${INSIGHT_TYPE} \\\n --etag=etag \\\n --state-metadata=STATE_METADATA\n --format=FORMAT\n```\nwhere:- is the ID of an insight retrieved from a previous call to list insights\n- is the returned etag representing the insight state\n- is an optional metadata about the operation. Specify the metadata as a comma-separated list of=pairs.\nFor example:\n```\ngcloud recommender insights mark-accepted \\\n a523ff7e-ed03-4143-a3a5-5b396b99cba9 \\\n --project=example-project \\\n --location=global \\\n --insight-type=google.iam.policy.Insight \\\n --etag='\"280b34810bba8a1a\"' \\\n --state-metadata=priority=high,tracking_number=12345\n --format=json\n```\nEnter the following:\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: ${PROJECT}\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/${PROJECT}/locations/${LOCATION}/insightTypes/${INSIGHT_TYPE}/insights/INSIGHT_ID:markAccepted \\\n<< EOM\n{\n \"etag\": \"etag\",\n \"stateMetadata\": STATE_METADATA\n}\nEOM\n```\nwhere:- is the ID of an insight retrieved from a previous call to list insights\n- is the returned etag representing the insight state\n- is an optional field with additional metadata about the operation. Specify the metadata as`key:value`pairs.\nFor example:\n```\ncurl -X POST \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: example-project\" \\\n --data-binary @- \\\n https://recommender.googleapis.com/v1/projects/example-project/locations/global/insightTypes/google.iam.policy.Insight/insights/a523ff7e-ed03-4143-a3a5-5b396b99cba9:markAccepted \\\n<< EOM\n{\n \"etag\": \"\\\"280b34810bba8a1a\\\"\"\n \"stateMetadata\": {\n \"priority\" : \"high\",\n \"tracking_number\": \"12345\"\n }\n}\nEOM\n```\nThis operation returns the [Insight](/recommender/docs/reference/rest/v1/projects.locations.insightTypes.insights#resource:-insight) entity in the specified format after the operation has taken place.\nThe output is similar to the following:\n```\n{\n \"category\": \"SECURITY\",\n \"content\": { ... },\n \"description\": \"0 permission checks were authorized by this policy binding tuple.\",\n \"etag\": \"\\\"356ae51165729f38\\\"\",\n \"insightSubtype\": \"PERMISSIONS_USAGE\",\n \"lastModifiedUser\": \"admin123@example-project.iam.gserviceaccount.com\",\n \"lastRefreshTime\": \"2020-03-06T08:00:00Z\",\n \"name\": \"projects/32428390823/locations/global/insightTypes/google.iam.policy.Insight/insights/a523ff7e-ed03-4143-a3a5-5b396b99cba9\",\n \"observationPeriod\": \"7776000s\",\n \"stateInfo\": {\n \"state\": \"ACCEPTED\",\n \"stateMetadata\": {\n  \"priority\" : \"high\",\n  \"tracking_number\": \"12345\"\n }\n },\n \"targetResources\": [ \"//cloudresourcemanager.googleapis.com/projects/32428390823\"\n ],\n \"userLastUpdateTime\": \"2020-03-31T20:57:50.509855Z\"\n}\n```\nNote that the value of the `state` field has changed to `ACCEPTED` .", "guide": "Recommender"}