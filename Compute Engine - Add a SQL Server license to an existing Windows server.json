{"title": "Compute Engine - Add a SQL Server license to an existing Windows server", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Add a SQL Server license to an existing Windows server\nCompute Engine lets you install SQL Server on Windows virtual machines (VM) instances and use pay-as-you-go (PAYG) licenses. This document describes how you can perform the following:\n- [Add SQL Server license metadata to a boot disk](#add-sql-server-license) \n- [Obtain SQL Server media and install SQL Server](#obtain-sql-server-media) \n- [Apply a SQL server product key to a Compute Engine VM instance](#apply-sql-server-product-key) ", "content": "## Billing\nAfter adding a license string to the Windows VM's boot disk, you are billed according to the pricing of [SQL Server images](/compute/disks-image-pricing#sql_server_pricing) .\n## Limitations\n- You can only add PAYG licenses for the following editions of SQL Server:- SQL Server Web edition\n- SQL Server Standard edition\n- SQL Server Enterprise edition\n## Add a SQL Server license\nSQL Server license metadata on a boot disk allows Google Cloud to accurately track, bill, and report on SQL Server license usage. This metadata is required when using PAYG SQL Server licenses. Add a SQL Server license to an existing boot disk using the following procedure:\n**Caution:** After you add a license to a VM, you cannot remove the license from the VM.\n- Identify the license you want to add to a VM. For SQL Server, the license needs to match both the version and edition you want to run. For the list of valid SQL Server license strings, see the **License strings** tab in the [operating system details for SQL Server](/compute/docs/images/os-details#sql_server) document.\n- Stop the VM:```\ngcloud compute instances stop VM_NAME\n```Replace `` with the name of the VM instance to stop.\n- Identify the boot disk:```\ngcloud compute instances describe VM_NAME\n```Replace `` with the name of the VM.\n- Verify that the output is similar to the following:```\ndisks:\n- autoDelete: true\n boot: true\n deviceName: BOOT_DISK_NAME\n diskSizeGb: '20'\n guestOsFeatures:\n - type: UEFI_COMPATIBLE\n index: 0\n interface: SCSI\n kind: compute#attachedDisk\n licenses:\n - BOOT_DISK_LICENSE_STRING\n mode: READ_WRITE\n source: https://www.googleapis.com/compute/v1/projects/PROJECT_NAME/zones/ZONE/disks/BOOT_DISK_NAME\n type: PERSISTENT\n```\n- Detach the boot disk:```\ngcloud compute instances detach-disk VM_NAME --disk=BOOT_DISK_NAME\n```Replace the following:- ``: the name of the VM\n- ``: the name of the boot disk\n- Clone the boot disk and add the additional license:```\ngcloud compute disks create CLONED_BOOT_DISK_NAME \\\n --licenses=SQL_SERVER_LICENSE \\\n --source-disk=BOOT_DISK_NAME \\\n --source-disk-zone=BOOT_DISK_ZONE \\\n --zone=CLONED_BOOT_DISK_ZONE\n```Replace the following:- ``: the name you want to give the cloned book disk\n- ``: the SQL Server license you want to add to the boot disk\n- ``: the name of the source boot disk that you want to clone\n- ``: the zone of the source boot disk\n- ``: the zone in which you want to create the cloned boot disk\n- Verify that the new disk has the correct license:```\ngcloud compute disks describe CLONED_BOOT_DISK_NAME \\\n --zone=CLONED_BOOT_DISK_ZONE\n```Replace the following:- ``: the name of the cloned book disk\n- ``: the zone of the cloned boot disk\n- Attach the new disk as the boot disk for the VM instance:```\ngcloud compute instances attach-disk VM_NAME \\\n --disk=CLONED_BOOT_DISK_NAME\n --boot\n```Replace the following:- ``: the name of the VM instance to which you want to attach the cloned boot disk\n- ``: the name of the cloned book disk\n- Verify that the VM's boot disk is the new cloned disk with SQL Server licensing.```\ngcloud compute instances describe VM_NAME\n```Replace `` with the name of the VM.\n- Start the VM instance.```\ngcloud compute instances start VM_NAME\n```Replace `` with the name of the VM.\n- (Optional) When you are sure that you don't want to revert back to the earlier boot disk, you can delete the disk.```\ngcloud compute disks delete BOOT_DISK_NAME \\\n --zone=BOOT_DISK_ZONE\n```Replace the following:- ``: the name of the boot disk that you want to delete\n- ``: the zone of the boot disk\n## Obtain the SQL Server media and install SQL Server\nTo obtain the SQL Server installation media and copy it to a Compute Engine VM boot disk, do the following:\n- Create a new disk containing the SQL Server installation media using any version of SQL server (for example, 2019 Enterprise):```\ngcloud compute disks create SQL_SERVER_MEDIA_DISK_NAME \\\n --image-family=sql-ent-2019-win-2022 \\\n --image-project=windows-sql-cloud \\\n --zone=SQL_SERVER_ZONE\n```Replace the following:- ``: the name of the SQL Server media disk that you want to create\n- ``: the zone in which you want to create the SQL Server media disk\n- Attach the disk to any existing Compute Engine VM instance:```\ngcloud compute instances attach-disk VM_INSTANCE_NAME \\\n --disk=SQL_SERVER_MEDIA_DISK_NAME\n --zone=SQL_SERVER_ZONE\n```Replace the following:- ``: the name of the VM instance to which you want to attach the SQL Server media disk\n- ``: the name of the SQL Server media disk\n- ``: the zone of the VM instance\nAfter the SQL Server media disk is attached to a VM instance, on your Windows machine, open the **Disk Management** page to see if the disk has a drive letter assigned to it. If not, right-click on the disk and select **Online** to bring it online. The SQL Server media disk is now the `D:` drive on the **Disk Management** page and in Windows Explorer.\n- Ensure the boot disk of your VM instance has at least 5 GB of free disk space and copy the SQL Server media to your boot disk:```\nrobocopy /mir d:\\sql_server_install\\ c:\\sql_server_install\n```\n- Detach the SQL Server media disk from the VM instance:```\ngcloud compute instances detach-disk VM_INSTANCE_NAME \\\n --disk=SQL_SERVER_MEDIA_DISK_NAME\n```Replace the following:- ``: the name of the VM instance you from which you want to detach the SQL Server media disk\n- ``: the name of the SQL Server media disk that you want to detach from the VMFor more information, see [Microsoft SQL Server installation guide](https://learn.microsoft.com/en-us/sql/database-engine/install-windows/install-sql-server?view=sql-server-ver16#sql-server-installation) .\n## Apply a SQL server product key to a Compute Engine VM instance\nIn order to upgrade the SQL Server installation media, you must obtain and apply a new product key to the Compute Engine VM instance on which the SQL Server is installed. To obtain the product key and upgrade the SQL Server installation media, do the following:\n- Obtain the product key from the SQL Server installation media:```\nC:\\> type C:\\sql_server_install\\x64\\DefaultSetup.ini\n```\n- Apply the product key and upgrade the SQL Server installation media. For more information, see [Upgrade to a different edition of SQL Server](https://learn.microsoft.com/en-us/sql/database-engine/install-windows/upgrade-to-a-different-edition-of-sql-server-setup?view=sql-server-ver16) .## What's next\n- [Learn about licenses](/compute/docs/licenses/about) \n- [View the SQL Server tutorials](/compute/docs/tutorials#sql-server) \n- [View the supported editions of SQL Server](/compute/docs/images/os-details#sql_server)", "guide": "Compute Engine"}