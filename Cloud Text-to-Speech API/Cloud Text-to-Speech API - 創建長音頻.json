{"title": "Cloud Text-to-Speech API - \u5275\u5efa\u9577\u97f3\u983b", "url": "https://cloud.google.com/text-to-speech/docs/create-audio-text-long-audio-synthesis?hl=zh-cn", "abstract": "# Cloud Text-to-Speech API - \u5275\u5efa\u9577\u97f3\u983b\n# \u5275\u5efa\u9577\u97f3\u983b\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them **    \u9810\u89bd     ** \u672c\u7522\u54c1\u6216\u529f\u80fd\u9808\u9075\u5b88 [\u670d\u52d9\u5c08\u7528\u689d\u6b3e](https://cloud.google.com/terms/service-terms?hl=zh-cn#1) \u7684\u201c\u901a\u7528\u670d\u52d9\u689d\u6b3e\u201d\u90e8\u5206\u4e2d\u7684\u201c\u975e\u6b63\u5f0f\u7248\u7522\u54c1\u689d\u6b3e\u201d\u3002 \u6b63\u5f0f\u767c\u4f48\u524d\u7522\u54c1\u548c\u529f\u80fd\u201c\u6309\u539f\u6a23\u201d\u63d0\u4f9b\uff0c\u53ef\u80fd\u50c5\u63d0\u4f9b\u6709\u9650\u652f\u6301\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u767c\u4f48\u968e\u6bb5\u8aaa\u660e](https://cloud.google.com/products?hl=zh-cn#product-launch-stages) \u3002\n\u672c\u6587\u6a94\u5c07\u5f15\u5c0e\u60a8\u5b8c\u6210\u5408\u6210\u9577\u97f3\u983b\u7684\u904e\u7a0b\u3002\u9577\u97f3\u983b\u5408\u6210\u5728\u8f38\u5165\u4e0a\u7570\u6b65\u5408\u6210\u6700\u591a 100 \u842c\u500b\u5b57\u7bc0\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Text-to-Speech \u4e2d\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u8acb\u95b1\u8b80 [Text-to-Speech \u57fa\u790e\u77e5\u8b58](https://cloud.google.com/text-to-speech/docs/basics?hl=zh-cn) \u3002", "content": "## \u6e96\u5099\u5de5\u4f5c\u60a8\u5fc5\u9808\u5148\u5b8c\u6210\u4ee5\u4e0b\u64cd\u4f5c\uff0c\u7136\u5f8c\u624d\u80fd\u5411 Text-to-Speech API \u767c\u9001\u8acb\u6c42\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e96\u5099\u5de5\u4f5c](https://cloud.google.com/text-to-speech/docs/before-you-begin?hl=zh-cn) \u9801\u9762\u3002\n- \u5728 GCP \u9805\u76ee\u4e0a\u5553\u7528 Text-to-Speech\u3002- \u78ba\u4fdd\u5df2\u7232 Text-to-Speech \u5553\u7528\u7d50\u7b97\u529f\u80fd\u3002\n- \u78ba\u4fdd\u60a8\u5177\u6709\u8f38\u51fa GCS \u5b58\u5132\u6876\u7684\u4ee5\u4e0b [Identity and Access Management (IAM) \u89d2\u8272](https://cloud.google.com/storage/docs/access-control/iam-roles?hl=zh-cn#standard-roles) \u3002- Storage Object Creator\n- Storage Object Viewer\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them [\u5b89\u88dd](https://cloud.google.com/sdk/docs/install?hl=zh-cn) Google Cloud CLI\uff0c\u7136\u5f8c\u901a\u904e\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4 [\u521d\u59cb\u5316](https://cloud.google.com/sdk/docs/initializing?hl=zh-cn) Google Cloud CLI\uff1a```\ngcloud init\n```\n## \u4f7f\u7528\u547d\u4ee4\u884c\u5c07\u6587\u5b57\u5408\u6210\u7232\u9577\u97f3\u983b\u60a8\u53ef\u4ee5\u901a\u904e\u5411 `https://texttospeech.googleapis.com/v1beta1/projects/{$project_number}/locations/global:synthesizeLongAudio` \u7aef\u9ede\u767c\u51fa HTTP POST \u8acb\u6c42\uff0c\u5c07\u9577\u6587\u672c\u8f49\u63db\u7232\u97f3\u983b\u3002 \u5728 POST \u547d\u4ee4\u6b63\u6587\u4e2d\uff0c\u6307\u5b9a\u4ee5\u4e0b\u5b57\u6bb5\u3002\n\u2022 `voice` \uff1a\u8981\u5408\u6210\u7684\u8a9e\u97f3\u985e\u578b\u3002\n\u2022 `input.text` \uff1a\u8981\u5408\u6210\u7684\u6587\u672c\u3002\n\u2022 `audioConfig` \uff1a\u8981\u5275\u5efa\u7684\u97f3\u983b\u985e\u578b\u3002\n\u2022 **output_gcs_uri** \uff1aGCS \u8f38\u51fa\u6587\u4ef6\u8def\u5f91\uff0c\u683c\u5f0f\u7232\u201cgs://bucket_name/file_name.wav\u201d\u3002\n\u2022 **parent** \uff1a\u7236\u7d1a\u8def\u5f91\uff0c\u683c\u5f0f\u7232\u201cprojects/{\u60a8\u7684\u9805\u76ee\u7de8\u865f}/locations/{\u60a8\u7684\u9805\u76ee\u4f4d\u7f6e}\u201d\u3002\n\u8f38\u5165\u6700\u591a\u53ef\u5305\u542b 1MB \u5b57\u7b26\uff0c\u78ba\u5207\u9650\u5236\u56e0\u4e0d\u540c\u7684\u8f38\u5165\u800c\u7570\u3002- \u5728\u7528\u65bc\u904b\u884c\u5408\u6210\u7684\u9805\u76ee\u4e0b\u5275\u5efa\u4e00\u500b Google Cloud Storage \u5b58\u5132\u6876\u3002\u78ba\u4fdd\u7528\u65bc\u904b\u884c\u5408\u6210\u7684\u670d\u52d9\u8cec\u865f\u64c1\u6709\u5c0d\u8f38\u51fa GCS \u5b58\u5132\u6876\u7684\u8b80\u5beb\u6b0a\u9650\u3002\n- \u5728\u547d\u4ee4\u884c\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u4f7f\u7528 Text-to-Speech \u5f9e\u6587\u672c\u5408\u6210\u97f3\u983b\u3002\u8a72\u547d\u4ee4\u4f7f\u7528 `gcloud auth application-default print-access-token` \u547d\u4ee4\u6aa2\u7d22\u8acb\u6c42\u7684\u6388\u6b0a\u4ee4\u724c\u3002\u78ba\u4fdd\u904b\u884c GET \u64cd\u4f5c\u7684\u670d\u52d9\u8cec\u865f\u5177\u6709 [Text-to-Speech Editor \u89d2\u8272](https://cloud.google.com/text-to-speech/access-control?hl=zh-cn) \u3002HTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://texttospeech.googleapis.com/v1beta1/projects/12345/locations/global:synthesizeLongAudio\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"parent\": \"projects/12345/locations/global\",\n \"audio_config\":{\n  \"audio_encoding\":\"LINEAR16\"\n },\n \"input\":{\n  \"text\":\"hello\"\n },\n \"voice\":{\n  \"language_code\":\"en-us\",\n  \"name\":\"en-us-Standard-A\"\n },\n \"output_gcs_uri\": \"gs://bucket_name/file_name.wav\"\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"23456\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.texttospeech.v1beta1.SynthesizeLongAudioMetadata\",\n \"progressPercentage\": 0,\n \"startTime\": \"2022-12-20T00:46:56.296191037Z\",\n \"lastUpdateTime\": \"2022-12-20T00:46:56.296191037Z\"\n },\n \"done\": false\n}\n```- REST \u547d\u4ee4\u7684 JSON \u8f38\u51fa\u5305\u542b `name` \u5b57\u6bb5\u4e2d\u9577\u6642\u9593\u904b\u884c\u7684\u64cd\u4f5c\u7684\u540d\u7a31\u3002\u5728\u547d\u4ee4\u884c\u57f7\u884c\u4e0b\u9762\u7684 REST \u8acb\u6c42\uff0c\u4ee5\u67e5\u8a62\u9577\u6642\u9593\u904b\u884c\u7684\u64cd\u4f5c\u7684\u72c0\u614b\u3002\u78ba\u4fdd\u904b\u884c GET \u64cd\u4f5c\u7684\u670d\u52d9\u8cec\u865f\u8207\u7528\u65bc\u5408\u6210\u7684\u8cec\u865f\u4f4d\u65bc\u540c\u4e00\u9805\u76ee\u4e2d\u3002HTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://texttospeech.googleapis.com/v1beta1/projects/12345/locations/global/operations/23456\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/12345/locations/global/operations/23456\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.texttospeech.v1beta1.SynthesizeLongAudioMetadata\",\n \"progressPercentage\": 100\n },\n \"done\": true\n}\n```- \u67e5\u8a62\u5728\u7d66\u5b9a\u9805\u76ee\u4e0b\u904b\u884c\u7684\u6240\u6709\u64cd\u4f5c\u7684\u5217\u8868\uff0c\u4e26\u57f7\u884c\u4e0b\u9762\u7684 REST \u8acb\u6c42\u3002\u78ba\u4fdd\u904b\u884c LIST \u64cd\u4f5c\u7684\u670d\u52d9\u8cec\u865f\u8207\u7528\u65bc\u5408\u6210\u7684\u8cec\u865f\u4f4d\u65bc\u540c\u4e00\u9805\u76ee\u4e2d\u3002HTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://texttospeech.googleapis.com/v1beta1/projects/12345/locations/global/operations\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"operations\": [ {\n  \"name\": \"12345\",\n  \"done\": false\n },\n {\n  \"name\": \"23456\",\n  \"done\": false\n }\n ],\n \"nextPageToken\": \"\"\n}\n```- \u9577\u6642\u9593\u904b\u884c\u7684\u64cd\u4f5c\u6210\u529f\u5b8c\u6210\u5f8c\uff0c\u5728 `output_gcs_uri` \u5b57\u6bb5\u7684\u7d66\u5b9a\u5b58\u5132\u6876 URI \u4e2d\u627e\u5230\u8f38\u51fa\u97f3\u983b\u6587\u4ef6\u3002\u5982\u679c\u64cd\u4f5c\u672a\u6210\u529f\u5b8c\u6210\uff0c\u8acb\u4f7f\u7528 GET REST \u547d\u4ee4\u627e\u5230\u932f\u8aa4\uff0c\u66f4\u6b63\u932f\u8aa4\uff0c\u7136\u5f8c\u518d\u6b21\u767c\u51fa RPC\u3002\n## \u4f7f\u7528\u5ba2\u6236\u7aef\u5eab\u5c07\u6587\u5b57\u5408\u6210\u7232\u9577\u97f3\u983b\n### \u5b89\u88dd\u5ba2\u6236\u7aef\u5eab\u5728\u5b89\u88dd\u5eab\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u5df2\u7d93 [\u7232 Python \u958b\u767c\u6e96\u5099\u597d\u74b0\u5883](https://cloud.google.com/python/docs/setup?hl=zh-cn) \u3002\n```\npip install --upgrade google-cloud-texttospeech\n```\n### \u5275\u5efa\u97f3\u983b\u6578\u64da\u60a8\u53ef\u4ee5\u4f7f\u7528 Text-to-Speech \u4f86\u5275\u5efa\u5408\u6210\u4eba\u985e\u8a9e\u97f3\u7684\u9577\u97f3\u983b\u6587\u4ef6\u3002\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u78bc\u5728 GCS \u5b58\u5132\u6876\u4e2d\u5275\u5efa\u9577\u97f3\u983b\u6587\u4ef6\u3002\u5728\u904b\u884c\u8a72\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u5df2\u7d93 [\u7232 Python \u958b\u767c\u6e96\u5099\u597d\u74b0\u5883](https://cloud.google.com/python/docs/setup?hl=zh-cn) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/python-docs-samples/blob/HEAD/texttospeech/snippets/long_audio_quickstart.py) \n```\n# Copyright 2023 Google LLC\n## Licensed under the Apache License, Version 2.0 (the \"License\");# you may not use this file except in compliance with the License.# You may obtain a copy of the License at\n## \u00a0 \u00a0 \u00a0http://www.apache.org/licenses/LICENSE-2.0\n## Unless required by applicable law or agreed to in writing, software# distributed under the License is distributed on an \"AS IS\" BASIS,# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.# See the License for the specific language governing permissions and# limitations under the License.from google.cloud import texttospeechdef synthesize_long_audio(project_id, location, output_gcs_uri):\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 Synthesizes long input, writing the resulting audio to `output_gcs_uri`.\u00a0 \u00a0 Example usage: synthesize_long_audio('12345', 'us-central1', 'gs://{BUCKET_NAME}/{OUTPUT_FILE_NAME}.wav')\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 # TODO(developer): Uncomment and set the following variables\u00a0 \u00a0 # project_id = 'YOUR_PROJECT_ID'\u00a0 \u00a0 # location = 'YOUR_LOCATION'\u00a0 \u00a0 # output_gcs_uri = 'YOUR_OUTPUT_GCS_URI'\u00a0 \u00a0 client = texttospeech.TextToSpeechLongAudioSynthesizeClient()\u00a0 \u00a0 input = texttospeech.SynthesisInput(\u00a0 \u00a0 \u00a0 \u00a0 text=\"Test input. Replace this with any text you want to synthesize, up to 1 million bytes long!\"\u00a0 \u00a0 )\u00a0 \u00a0 audio_config = texttospeech.AudioConfig(\u00a0 \u00a0 \u00a0 \u00a0 audio_encoding=texttospeech.AudioEncoding.LINEAR16\u00a0 \u00a0 )\u00a0 \u00a0 voice = texttospeech.VoiceSelectionParams(\u00a0 \u00a0 \u00a0 \u00a0 language_code=\"en-US\", name=\"en-US-Standard-A\"\u00a0 \u00a0 )\u00a0 \u00a0 parent = f\"projects/{project_id}/locations/{location}\"\u00a0 \u00a0 request = texttospeech.SynthesizeLongAudioRequest(\u00a0 \u00a0 \u00a0 \u00a0 parent=parent,\u00a0 \u00a0 \u00a0 \u00a0 input=input,\u00a0 \u00a0 \u00a0 \u00a0 audio_config=audio_config,\u00a0 \u00a0 \u00a0 \u00a0 voice=voice,\u00a0 \u00a0 \u00a0 \u00a0 output_gcs_uri=output_gcs_uri,\u00a0 \u00a0 )\u00a0 \u00a0 operation = client.synthesize_long_audio(request=request)\u00a0 \u00a0 # Set a deadline for your LRO to finish. 300 seconds is reasonable, but can be adjusted depending on the length of the input.\u00a0 \u00a0 # If the operation times out, that likely means there was an error. In that case, inspect the error, and try again.\u00a0 \u00a0 result = operation.result(timeout=300)\u00a0 \u00a0 print(\u00a0 \u00a0 \u00a0 \u00a0 \"\\nFinished processing, check your GCS bucket to find your audio file! Printing what should be an empty result: \",\u00a0 \u00a0 \u00a0 \u00a0 result,\u00a0 \u00a0 )\n```\n## \u6e05\u7406\u7232\u907f\u514d\u7522\u751f\u4e0d\u5fc5\u8981\u7684 Google Cloud Platform \u8cbb\u7528\uff0c\u8acb\u4f7f\u7528 [Google Cloud \u63a7\u5236\u6aaf](https://console.cloud.google.com/?hl=zh-cn) \u522a\u9664\u60a8\u4e0d\u9700\u8981\u7684\u9805\u76ee\u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u5982\u9700\u8a73\u7d30\u77ad\u89e3 Cloud Text-to-Speech\uff0c\u8acb\u95b1\u8b80 [\u57fa\u790e\u77e5\u8b58](https://cloud.google.com/text-to-speech/docs/basics?hl=zh-cn) \u3002\n- \u67e5\u770b\u53ef\u7528\u65bc\u5408\u6210\u8a9e\u97f3\u7684 [\u53ef\u7528\u8a9e\u97f3](https://cloud.google.com/text-to-speech/docs/voices?hl=zh-cn) \u5217\u8868\u3002", "guide": "Cloud Text-to-Speech API"}