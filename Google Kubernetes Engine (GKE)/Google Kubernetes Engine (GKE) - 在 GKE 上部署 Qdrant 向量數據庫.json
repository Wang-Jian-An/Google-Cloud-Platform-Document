{"title": "Google Kubernetes Engine (GKE) - \u5728 GKE \u4e0a\u90e8\u7f72 Qdrant \u5411\u91cf\u6578\u64da\u5eab", "url": "https://cloud.google.com/kubernetes-engine/docs/tutorials/deploy-qdrant?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u5728 GKE \u4e0a\u90e8\u7f72 Qdrant \u5411\u91cf\u6578\u64da\u5eab\n\u672c\u6307\u5357\u4ecb\u7d39\u5982\u4f55\u5728 Google Kubernetes Engine (GKE) \u4e0a\u90e8\u7f72 [Qdrant](https://qdrant.tech/documentation/) \u5411\u91cf\u6578\u64da\u5eab\u96c6\u7fa3\u3002\n [](https://cloud.google.com/discover/what-is-a-vector-database?hl=zh-cn) \u5411\u91cf\u6578\u64da\u5eab\u662f\u5c08\u9580\u7528\u65bc\u7ba1\u7406\u548c\u641c\u7d22\u5927\u578b\u9ad8\u7dad\u5411\u91cf\u96c6\u5408\u7684\u6578\u64da\u5b58\u5132\u5340\u3002\u9019\u4e9b\u5411\u91cf\u8868\u793a\u6587\u672c\u3001\u5716\u7247\u3001\u97f3\u983b\u3001\u8996\u983b\u7b49\u6578\u64da\u6216\u4efb\u4f55\u53ef\u4ee5\u6578\u5b57\u7de8\u78bc\u7684\u6578\u64da\u3002\u8207\u4f9d\u8cf4\u65bc\u5b8c\u5168\u5339\u914d\u7684\u50b3\u7d71\u6578\u64da\u5eab\u4e0d\u540c\uff0c\u5411\u91cf\u6578\u64da\u5eab\u5c08\u6ce8\u65bc\u5728\u5927\u91cf\u6578\u64da\u96c6\u4e2d\u67e5\u627e\u76f8\u4f3c\u9805\u6216\u8b58\u5225\u6a21\u5f0f\u3002\u9019\u4e9b\u7279\u6027\u4f7f\u5f97 Qdrant \u975e\u5e38\u9069\u5408\u5404\u7a2e\u61c9\u7528\uff0c\u5305\u62ec\u795e\u7d93\u7db2\u7d61\u6216\u57fa\u65bc\u8a9e\u7fa9\u7684\u5339\u914d\u3001\u5206\u9762\u641c\u7d22\u7b49\u3002Qdrant \u4e0d\u50c5\u53ef\u7528\u4f5c\u5411\u91cf\u6578\u64da\u5eab\uff0c\u9084\u53ef\u7528\u4f5c\u5411\u91cf\u76f8\u4f3c\u5ea6\u641c\u7d22\u5f15\u64ce\u3002\n\u672c\u6559\u7a0b\u9069\u7528\u65bc\u60f3\u8981\u5728 GKE \u4e0a\u90e8\u7f72 Qdrant \u6578\u64da\u5eab\u96c6\u7fa3\u7684\u96f2\u5e73\u81fa\u7ba1\u7406\u54e1\u3001\u96f2\u67b6\u69cb\u5e2b\u3001\u6a5f\u5668\u5b78\u7fd2\u5de5\u7a0b\u5e2b\u548c MLOps (DevOps) \u5c08\u696d\u4eba\u54e1\u3002", "content": "## \u512a\u52e2Qdrant \u5177\u6709\u4ee5\u4e0b\u512a\u52e2\uff1a- \u5305\u542b\u7528\u65bc\u5404\u7a2e\u7de8\u7a0b\u8a9e\u8a00\u7684\u5927\u91cf\u5eab\uff0c\u4ee5\u53ca\u53ef\u8207\u5176\u4ed6\u670d\u52d9\u96c6\u6210\u7684\u958b\u653e\u5f0f API\u3002\n- \u6a6b\u5411\u64f4\u7e2e\u4ee5\u53ca\u5c0d\u5206\u7247\u548c\u8907\u88fd\u7684\u652f\u6301\uff0c\u53ef\u7c21\u5316\u64f4\u7e2e\u548c\u9ad8\u53ef\u7528\u6027\u3002\n- \u5bb9\u5668\u548c Kubernetes \u652f\u6301\uff0c\u53ef\u8b93\u60a8\u5728\u73fe\u4ee3\u96f2\u539f\u751f\u74b0\u5883\u4e2d\u9032\u884c\u90e8\u7f72\u548c\u7ba1\u7406\u3002\n- \u5177\u6709 [\u9ad8\u7d1a\u904e\u6ffe](https://qdrant.tech/documentation/concepts/filtering/) \u529f\u80fd\u7684\u9748\u6d3b\u8f09\u8377\uff0c\u53ef\u7cbe\u78ba\u5b9a\u88fd\u641c\u7d22\u689d\u4ef6\u3002\n- [\u4e0d\u540c\u7684\u91cf\u5316\u9078\u9805](https://qdrant.tech/documentation/guides/quantization/) \u548c\u5176\u4ed6\u512a\u5316\uff0c\u4ee5\u964d\u4f4e\u57fa\u790e\u8a2d\u65bd\u8cbb\u7528\u4e26\u63d0\u9ad8\u6027\u80fd\u3002\n## \u76ee\u6a19\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u5b78\u7fd2\u5982\u4f55\uff1a- \u7232 Qdrant \u898f\u5283\u548c\u90e8\u7f72 GKE \u57fa\u790e\u8a2d\u65bd\u3002\n- \u90e8\u7f72 [StatefulHA](https://cloud.google.com/kubernetes-engine/docs/how-to/stateful-ha?hl=zh-cn) \u904b\u7b97\u7b26\u4ee5\u78ba\u4fdd Qdrant \u9ad8\u53ef\u7528\u6027\u3002\n- \u90e8\u7f72\u4e26\u914d\u7f6e Qdrant \u96c6\u7fa3\u3002\n- \u4e0a\u50b3\u6f14\u793a\u6578\u64da\u96c6\u4e26\u904b\u884c\u7c21\u55ae\u7684\u641c\u7d22\u67e5\u8a62\u3002\n- \u6536\u96c6\u6307\u6a19\u4e26\u904b\u884c\u4fe1\u606f\u4e2d\u5fc3\u3002\n## \u90e8\u7f72\u67b6\u69cb\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u7232 Qdrant \u90e8\u7f72\u9ad8\u53ef\u7528\u6027\u5340\u57df\u7d1a GKE \u96c6\u7fa3\uff0c\u5176\u4e2d\u591a\u500b Kubernetes \u7bc0\u9ede\u5206\u4f48\u5728\u591a\u500b\u53ef\u7528\u5340\u4e2d\u3002\u6b64\u8a2d\u7f6e\u6709\u52a9\u65bc\u78ba\u4fdd\u5bb9\u932f\u3001\u53ef\u4f38\u7e2e\u6027\u548c\u5730\u7406\u5197\u9918\u3002\u9019\u6a23\u53ef\u652f\u6301\u6efe\u52d5\u66f4\u65b0\u548c\u7dad\u8b77\uff0c\u540c\u6642\u63d0\u4f9b SLA \u4ee5\u4fdd\u8b49\u6b63\u5e38\u904b\u884c\u6642\u9593\u548c\u53ef\u7528\u6027\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5340\u57df\u7d1a\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/regional-clusters?hl=zh-cn) \u3002\n\u672c\u6559\u7a0b\u4f7f\u7528 Qdrant \u63d0\u4f9b\u7684\u5340\u57df\u6c38\u4e45\u6027\u78c1\u76e4 (RePD) \u5b58\u5132\u985e\u578b\u3002RePD \u53ef\u4ee5\u8de8\u4e00\u500b\u5340\u57df\u5167\u7684\u5169\u500b\u53ef\u7528\u5340\u540c\u6b65\u8907\u88fd\u6578\u64da\u3002\u5229\u7528\u6301\u4e45\u5316\u6578\u64da\uff0c\u7cfb\u7d71\u53ef\u4ee5\u986f\u8457\u6e1b\u5c11\u5176\u6062\u5fa9\u6642\u9593\u76ee\u6a19 (RTO)\u3002\n\u7576\u7bc0\u9ede\u7121\u6cd5\u8a2a\u554f\u6642\uff0c\u8a72\u7bc0\u9ede\u4e0a\u7684 Pod \u4e0d\u6703\u7acb\u5373\u91cd\u65b0\u8abf\u5ea6\u3002\u5c0d\u65bc\u4f7f\u7528 StatefulSet \u7684 Pod\uff0c\u53ef\u80fd\u9700\u8981 8 \u5206\u9418\u4ee5\u4e0a\u624d\u80fd\u522a\u9664\u61c9\u7528 Pod \u4e26\u5c07\u5176\u91cd\u65b0\u8abf\u5ea6\u5230\u65b0\u7bc0\u9ede\u3002\n\u7232\u4e86\u89e3\u6c7a\u6b64\u554f\u984c\uff0cStatefulHA \u904b\u7b97\u7b26\u5c07\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u901a\u904e\u4f7f\u7528\u201c`.forceDeleteStrategy`:`AfterNodeUnreachable`\u201d\u8a2d\u7f6e\u8655\u7406\u6545\u969c\u5207\u63db\u8a2d\u7f6e\u4e26\u7e2e\u77ed\u6062\u5fa9\u6642\u9593\u3002\n- \u78ba\u4fdd StatefulSet \u61c9\u7528\u6b63\u5728\u4f7f\u7528 RePD\u3002\n- \u4f7f\u7528\u61c9\u90e8\u7f72\u5728 Qdrant \u6240\u5728\u7684\u547d\u540d\u7a7a\u9593\u4e2d\u7684\u81ea\u5b9a\u7fa9 [HighAvailabilityApplication](https://cloud.google.com/kubernetes-engine/docs/reference/crds/highavailabilityapplication?hl=zh-cn) \u8cc7\u6e90\u64f4\u5c55 GKE\u3002\u9019\u4f7f StatefulHA \u904b\u7b97\u7b26\u80fd\u5920\u76e3\u63a7\u548c\u97ff\u61c9\u6545\u969c\u5207\u63db\u4e8b\u4ef6\u3002\nQdrant \u5c07\u6578\u64da\u5b58\u5132\u5728\u7531 [\u5206\u7247](https://qdrant.tech/documentation/guides/distributed_deployment/#sharding) \u548c [\u8907\u88fd\u56e0\u5b50](https://qdrant.tech/documentation/guides/distributed_deployment/#replication) \u7d44\u6210\u7684 [\u96c6\u5408](https://qdrant.tech/documentation/concepts/collections/) \u4e2d\u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cQdrant \u5275\u5efa\u7684\u96c6\u5408\u8907\u88fd\u56e0\u5b50\u7232 1\uff0c\u5206\u7247\u6578\u91cf\u7b49\u65bc\u7bc0\u9ede\u6578\u3002\n\u672c\u6307\u5357\u5c07\u5f15\u5c0e\u60a8\u5275\u5efa\u4e00\u500b\u5305\u542b\u66f4\u591a\u5206\u7247\u6578\u91cf\u4e14\u8907\u88fd\u56e0\u5b50\u7232 2 \u7684\u96c6\u5408\uff0c\u4ee5\u63d0\u9ad8\u53ef\u9760\u6027\u548c\u5bb9\u932f\u80fd\u529b\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5c07\u5206\u7247\u6578\u91cf\u8a2d\u7f6e\u7232 6 \u4e26\u5c07\u8907\u88fd\u56e0\u5b50\u8a2d\u7f6e\u7232 2\uff0c\u5247\u6703\u7372\u5f97 12 \u500b\u7269\u7406\u5206\u7247\uff08\u5206\u4f48\u5728\u4e0d\u540c\u53ef\u7528\u5340\u7684 Qdrant \u7bc0\u9ede\u4e2d\uff09\u3002\n### \u67b6\u69cb\u5716\u4e0b\u5716\u986f\u793a\u4e86\u5728 GKE \u96c6\u7fa3\u4e2d\u7684\u591a\u500b\u7bc0\u9ede\u548c\u53ef\u7528\u5340\u4e0a\u904b\u884c\u7684 Qdrant \u96c6\u7fa3\uff1a\u5728\u6b64\u67b6\u69cb\u4e2d\uff0cQdrant `StatefulSet` \u90e8\u7f72\u5728\u4e09\u500b\u4e0d\u540c\u53ef\u7528\u5340\u7684\u4e09\u500b\u7bc0\u9ede\u4e0a\u3002- \u901a\u904e\u5728 Helm \u5716\u8868\u503c\u6587\u4ef6\u4e2d\u914d\u7f6e\u5fc5\u9700\u7684 Pod [\u89aa\u548c\u6027\u898f\u5247](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity) \u548c [\u62d3\u64b2\u5206\u4f48\u9650\u5236](https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/) \uff0c\u60a8\u53ef\u4ee5\u63a7\u5236 GKE \u5728\u7bc0\u9ede\u4e4b\u9593\u5206\u767c Pod \u7684\u65b9\u5f0f\u3002\n- \u5982\u679c\u4e00\u500b\u53ef\u7528\u5340\u767c\u751f\u6545\u969c\uff0cGKE \u6703\u6839\u64da\u63a8\u85a6\u7684\u914d\u7f6e\u5728\u65b0\u7bc0\u9ede\u4e0a\u91cd\u65b0\u8abf\u5ea6 Pod\u3002\n\u7232\u4e86\u5be6\u73fe\u6578\u64da\u6301\u4e45\u6027\uff0c\u672c\u6559\u7a0b\u4e2d\u7684\u67b6\u69cb\u5177\u6709\u4ee5\u4e0b\u7279\u5fb5\uff1a- \u5b83\u4f7f\u7528 [\u5340\u57df](https://cloud.google.com/compute/docs/disks/about-regional-persistent-disk?hl=zh-cn) SSD \u78c1\u76e4\uff08\u81ea\u5b9a\u7fa9`regional-pd` [StorageClass](https://cloud.google.com/kubernetes-engine/docs/how-to/persistent-volumes/gce-pd-csi-driver?hl=zh-cn#create_a_storageclass) \uff09\u4f86\u4fdd\u7559\u6578\u64da\u3002\u6211\u5011 [\u5efa\u8b70](https://cloud.google.com/compute/docs/disks/performance?hl=zh-cn) \u5c07\u5340\u57df SSD \u78c1\u76e4\u7528\u65bc\u6578\u64da\u5eab\uff0c\u56e0\u7232\u5176\u5ef6\u9072\u6642\u9593\u77ed\u3001IOPS \u9ad8\u3002\n- \u6240\u6709\u78c1\u76e4\u6578\u64da\u90fd\u5728\u5340\u57df\u4e2d\u7684\u4e3b\u8981\u53ef\u7528\u5340\u548c\u6b21\u8981\u53ef\u7528\u5340\u4e4b\u9593\u8907\u88fd\uff0c\u5f9e\u800c\u63d0\u9ad8\u5c0d\u6f5b\u5728\u53ef\u7528\u5340\u6545\u969c\u7684\u5bb9\u5fcd\u5ea6\u3002\n## \u8cbb\u7528\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Google Cloud \u7684\u4ee5\u4e0b\u6536\u8cbb\u7d44\u4ef6\uff1a- [GKE](https://cloud.google.com/kubernetes-engine/pricing?hl=zh-cn) \n- [Google Cloud Managed Service for Prometheus](https://cloud.google.com/stackdriver/pricing?hl=zh-cn#mgd-prometheus-pricing-summary) \n- [Backup for GKE](https://cloud.google.com/backup-disaster-recovery/pricing?hl=zh-cn) \n\u60a8\u53ef\u4f7f\u7528 [\u50f9\u683c\u8a08\u7b97\u5668](https://cloud.google.com/products/calculator?hl=zh-cn) \u6839\u64da\u60a8\u7684\u9810\u8a08\u4f7f\u7528\u60c5\u6cc1\u4f86\u4f30\u7b97\u8cbb\u7528\u3002 \nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5b8c\u6210\u672c\u6587\u6a94\u4e2d\u63cf\u8ff0\u7684\u4efb\u52d9\u5f8c\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u522a\u9664\u6240\u5275\u5efa\u7684\u8cc7\u6e90\u4f86\u907f\u514d\u7e7c\u7e8c\u8a08\u8cbb\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e05\u7406](#clean-up) \u3002## \u6e96\u5099\u5de5\u4f5c\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 [Cloud Shell](https://cloud.google.com/shell/docs?hl=zh-cn) \u904b\u884c\u547d\u4ee4\u3002Cloud Shell \u662f\u4e00\u7a2e shell \u74b0\u5883\uff0c\u7528\u65bc\u7ba1\u7406\u8a17\u7ba1\u5728 Google Cloud \u4e0a\u7684\u8cc7\u6e90\u3002\u5b83\u9810\u88dd\u4e86 [Google Cloud CLI](https://cloud.google.com/sdk/gcloud?hl=zh-cn) \u3001 [kubectl](https://kubernetes.io/docs/reference/kubectl/) \u3001 [Helm](https://helm.sh/) \u548c [Terraform](https://cloud.google.com/docs/terraform?hl=zh-cn) \u547d\u4ee4\u884c\u5de5\u5177\u3002\u5982\u679c\u60a8\u4e0d\u4f7f\u7528 Cloud Shell\uff0c\u5247\u5fc5\u9808\u5b89\u88dd Google Cloud CLI\u3002- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5411\u60a8\u7684 Google \u8cec\u865f\u6388\u4e88\u89d2\u8272\u3002\u5c0d\u4ee5\u4e0b\u6bcf\u500b IAM \u89d2\u8272\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e00\u6b21\uff1a `role/storage.objectViewer\u3001roles/container.admin\u3001roles/iam.serviceAccountAdmin\u3001roles/compute.admin\u3001roles/gkebackup.admin\u3001roles/monitoring.viewer````\ngcloud projects add-iam-policy-binding PROJECT_ID --member=\"user:EMAIL_ADDRESS\" --role=ROLE\n```- \u5c07``\u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\n- \u5c07``\u66ff\u63db\u7232\u60a8\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\u3002\n- \u5c07``\u66ff\u63db\u7232\u6bcf\u500b\u89d2\u8272\u3002## \u8a2d\u7f6e\u60a8\u7684\u74b0\u5883\u5982\u9700\u4f7f\u7528 Cloud Shell \u8a2d\u7f6e\u60a8\u7684\u74b0\u5883\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a- \u7232\u60a8\u7684\u9805\u76ee\u3001\u5340\u57df\u548c Kubernetes \u96c6\u7fa3\u8cc7\u6e90\u524d\u7db4\u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\uff1a\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u8acb\u4f7f\u7528 `us-central1` \u5340\u57df\u5275\u5efa\u90e8\u7f72\u8cc7\u6e90\u3002```\nexport PROJECT_ID=PROJECT_IDexport KUBERNETES_CLUSTER_PREFIX=qdrantexport REGION=us-central1\n```- \u5c07``\u66ff\u63db\u7232\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\n- \u6aa2\u67e5 Helm \u7684\u7248\u672c\uff1a```\nhelm version\n```\u66f4\u65b0\u7248\u672c\uff08\u5982\u679c\u4f4e\u65bc 3.13\uff09\uff1a```\ncurl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n```\n- \u5f9e GitHub \u514b\u9686\u793a\u4f8b\u4ee3\u78bc\u5eab\uff1a```\ngit clone https://github.com/GoogleCloudPlatform/kubernetes-engine-samples\n```\n- \u8f49\u5230 `qdrant` \u76ee\u9304\u4ee5\u958b\u59cb\u5275\u5efa\u90e8\u7f72\u8cc7\u6e90\uff1a```\ncd kubernetes-engine-samples/databases/qdrant\n```\n## \u5275\u5efa\u96c6\u7fa3\u57fa\u790e\u67b6\u69cb\u672c\u90e8\u5206\u6d89\u53ca\u904b\u884c Terraform \u8173\u672c\u4f86\u5275\u5efa\u53ef\u7528\u6027\u9ad8\u7684\u5c08\u7528\u5340\u57df\u7d1a GKE \u96c6\u7fa3\uff0c\u4ee5\u90e8\u7f72 Qdrant \u6578\u64da\u5eab\u3002\n\u60a8\u53ef\u4ee5\u9078\u64c7\u4f7f\u7528 [\u6a19\u6e96\u96c6\u7fa3\u6216 Autopilot \u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/choose-cluster-mode?hl=zh-cn) \u90e8\u7f72 Qdrant\u3002\u6bcf\u7a2e\u985e\u578b\u90fd\u6709\u81ea\u5df1\u7684\u512a\u52e2\u548c\u4e0d\u540c\u7684\u50f9\u683c\u6a21\u5f0f\u3002\u6a19\u6e96\u96c6\u7fa3\u63d0\u4f9b\u5b8c\u5168\u81ea\u5b9a\u7fa9\u7684\u7bc0\u9ede\uff0c\u5177\u6709 SSH \u8a2a\u554f\u548c Cloud TPU \u652f\u6301\uff0c\u800c Autopilot \u96c6\u7fa3\u5247\u81ea\u52d5\u9810\u914d\u3002\n\u4e0b\u5716\u5c55\u793a\u4e86\u90e8\u7f72\u5728\u4e09\u500b\u4e0d\u540c\u53ef\u7528\u5340\u4e2d\u7684 Autopilot \u5340\u57df\u7d1a GKE \u96c6\u7fa3\u3002\u82e5\u8981\u90e8\u7f72\u96c6\u7fa3\u57fa\u790e\u8a2d\u65bd\uff0c\u8acb\u5728 Cloud Shell \u4e2d\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\nexport GOOGLE_OAUTH_ACCESS_TOKEN=$(gcloud auth print-access-token)terraform -chdir=terraform/gke-autopilot initterraform -chdir=terraform/gke-autopilot apply \\-var project_id=${PROJECT_ID} \\-var region=${REGION} \\-var cluster_prefix=${KUBERNETES_CLUSTER_PREFIX}\n```\n\u4ee5\u4e0b\u8b8a\u91cf\u6703\u5728\u904b\u884c\u6642\u88ab\u66ff\u63db\uff1a- `GOOGLE_OAUTH_ACCESS_TOKEN`\uff1a\u66ff\u63db\u7232`gcloud auth print-access-token`\u547d\u4ee4\u6aa2\u7d22\u7684\u8a2a\u554f\u4ee4\u724c\uff0c\u4ee5\u5c0d\u8207\u5404\u7a2e Google Cloud API \u7684\u4e92\u52d5\u9032\u884c\u8eab\u4efd\u9a57\u8b49\n- `PROJECT_ID`\u3001`REGION`\u548c`KUBERNETES_CLUSTER_PREFIX`\u662f\u5728 [\u8a2d\u7f6e\u74b0\u5883](#environment) \u90e8\u5206\u4e2d\u5b9a\u7fa9\u7684\u74b0\u5883\u8b8a\u91cf\uff0c\u5206\u914d\u7d66\u60a8\u8981\u5275\u5efa\u7684 Autopilot \u96c6\u7fa3\u7684\u65b0\u76f8\u95dc\u8b8a\u91cf\u3002\n\u51fa\u73fe\u63d0\u793a\u6642\uff0c\u8acb\u8f38\u5165 `yes` \u3002\n\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\n...\nApply complete! Resources: 9 added, 0 changed, 0 destroyed.\nOutputs:\nkubectl_connection_command = \"gcloud container clusters get-credentials qdrant-cluster --region us-central1\"\n```\nTerraform \u6703\u5275\u5efa\u4ee5\u4e0b\u8cc7\u6e90\uff1a- Kubernetes \u7bc0\u9ede\u7684\u81ea\u5b9a\u7fa9 VPC \u7db2\u7d61\u548c\u5c08\u7528\u5b50\u7db2\u3002\n- \u7528\u65bc\u901a\u904e\u7db2\u7d61\u5730\u5740\u8f49\u63db (NAT) \u8a2a\u554f\u4e92\u806f\u7db2\u7684 Cloud Router \u8def\u7531\u5668\u3002\n- \u5c08\u7528 GKE \u96c6\u7fa3\uff08\u5728`us-central1`\u5340\u57df\u4e2d\uff09\u3002\n- \u5177\u6709\u96c6\u7fa3\u7684\u65e5\u8a8c\u8a18\u9304\u548c\u76e3\u63a7\u6b0a\u9650\u7684`ServiceAccount`\u3002\n- Google Cloud Managed Service for Prometheus \u914d\u7f6e\uff0c\u7528\u65bc\u96c6\u7fa3\u76e3\u63a7\u548c\u63d0\u9192\u3002\n\u4e0b\u5716\u986f\u793a\u4e86\u90e8\u7f72\u5728\u4e09\u500b\u4e0d\u540c\u53ef\u7528\u5340\u4e2d\u7684\u6a19\u6e96\u5c08\u7528\u5340\u57df\u7d1a GKE \u96c6\u7fa3\u3002\u82e5\u8981\u90e8\u7f72\u96c6\u7fa3\u57fa\u790e\u8a2d\u65bd\uff0c\u8acb\u5728 Cloud Shell \u4e2d\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\nexport GOOGLE_OAUTH_ACCESS_TOKEN=$(gcloud auth print-access-token)terraform -chdir=terraform/gke-standard initterraform -chdir=terraform/gke-standard apply \\-var project_id=${PROJECT_ID} \\-var region=${REGION} \\-var cluster_prefix=${KUBERNETES_CLUSTER_PREFIX}\n```\n\u4ee5\u4e0b\u8b8a\u91cf\u6703\u5728\u904b\u884c\u6642\u88ab\u66ff\u63db\uff1a- `GOOGLE_OAUTH_ACCESS_TOKEN`\u88ab`gcloud auth print-access-token`\u547d\u4ee4\u6aa2\u7d22\u5230\u7684\u8a2a\u554f\u4ee4\u724c\u66ff\u63db\u6210\u4e86\u7528\u65bc\u5c0d\u8207\u5404\u7a2e Google Cloud API \u4ea4\u4e92\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u7684\u8a2a\u554f\u4ee4\u724c\u3002\n- `PROJECT_ID`\u3001`REGION`\u548c`KUBERNETES_CLUSTER_PREFIX`\u662f\u5728 [\u8a2d\u7f6e\u74b0\u5883](#environment) \u90e8\u5206\u4e2d\u5b9a\u7fa9\u7684\u74b0\u5883\u8b8a\u91cf\uff0c\u5206\u914d\u7d66\u60a8\u8981\u5275\u5efa\u7684\u6a19\u6e96\u96c6\u7fa3\u7684\u65b0\u76f8\u95dc\u8b8a\u91cf\u3002\n\u51fa\u73fe\u63d0\u793a\u6642\uff0c\u8acb\u8f38\u5165 `yes` \u3002\u5b8c\u6210\u9019\u4e9b\u547d\u4ee4\u4e26\u4f7f\u96c6\u7fa3\u986f\u793a\u5c31\u7dd2\u72c0\u614b\u53ef\u80fd\u9700\u8981\u5e7e\u5206\u9418\u6642\u9593\u3002\n\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\n...\nApply complete! Resources: 10 added, 0 changed, 0 destroyed.\nOutputs:\nkubectl_connection_command = \"gcloud container clusters get-credentials qdrant-cluster --region us-central1\"\n```\nTerraform \u6703\u5275\u5efa\u4ee5\u4e0b\u8cc7\u6e90\uff1a- Kubernetes \u7bc0\u9ede\u7684\u81ea\u5b9a\u7fa9 VPC \u7db2\u7d61\u548c\u5c08\u7528\u5b50\u7db2\u3002\n- \u7528\u65bc\u901a\u904e\u7db2\u7d61\u5730\u5740\u8f49\u63db (NAT) \u8a2a\u554f\u4e92\u806f\u7db2\u7684 Cloud Router \u8def\u7531\u5668\u3002\n- \u4f4d\u65bc`us-central1`\u5340\u57df\u4e26\u4e14\u5553\u7528\u4e86\u81ea\u52d5\u64f4\u7e2e\u529f\u80fd\u7684\u5c08\u7528 GKE \u96c6\u7fa3\uff08\u6bcf\u500b\u53ef\u7528\u5340\u4e00\u500b\u5230\u5169\u500b\u7bc0\u9ede\uff09\u3002\n- \u5177\u6709\u96c6\u7fa3\u7684\u65e5\u8a8c\u8a18\u9304\u548c\u76e3\u63a7\u6b0a\u9650\u7684`ServiceAccount`\u3002\n- Google Cloud Managed Service for Prometheus \u914d\u7f6e\uff0c\u7528\u65bc\u96c6\u7fa3\u76e3\u63a7\u548c\u63d0\u9192\u3002### \u9023\u63a5\u5230\u96c6\u7fa3\u914d\u7f6e `kubectl` \u4ee5\u63d0\u53d6\u6191\u64da\u4e26\u8207\u65b0 GKE \u96c6\u7fa3\u901a\u4fe1\uff1a\n```\ngcloud container clusters get-credentials \\\u00a0 \u00a0 ${KUBERNETES_CLUSTER_PREFIX}-cluster --region ${REGION}\n```## \u5c07 Qdrant \u6578\u64da\u5eab\u90e8\u7f72\u5230\u60a8\u7684\u96c6\u7fa3\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u6703\u4f7f\u7528 [Helm \u5716\u8868](https://github.com/qdrant/qdrant-helm) \u5c07 Qdrant \u6578\u64da\u5eab\uff08 [\u5206\u4f48\u5f0f\u6a21\u5f0f](https://qdrant.tech/documentation/guides/distributed_deployment/) \uff09\u548c\u6709\u72c0\u614b HA \u904b\u7b97\u7b26\u90e8\u7f72\u5230 GKE \u96c6\u7fa3\u3002\n\u90e8\u7f72\u6703\u5275\u5efa\u4e00\u500b\u5177\u6709\u4ee5\u4e0b\u914d\u7f6e\u7684 GKE \u96c6\u7fa3\uff1a- Qdrant \u7bc0\u9ede\u7684\u4e09\u500b\u526f\u672c\u3002\n- \u5df2\u914d\u7f6e\u5bb9\u5fcd\u3001\u7bc0\u9ede\u89aa\u548c\u6027\u548c\u62d3\u64b2\u5206\u4f48\u7d04\u675f\uff0c\u4ee5\u78ba\u4fdd\u5728 Kubernetes \u7bc0\u9ede\u4e4b\u9593\u6b63\u78ba\u5206\u4f48\u3002\u9019\u6703\u5229\u7528\u7bc0\u9ede\u6c60\u548c\u4e0d\u540c\u7684\u53ef\u7528\u5340\u3002\n- \u9810\u914d\u4e86\u5177\u6709 SSD \u78c1\u76e4\u985e\u578b\u7684 RePD \u5377\u4ee5\u9032\u884c\u6578\u64da\u5b58\u5132\u3002\n- \u6709\u72c0\u614b HA \u904b\u7b97\u7b26\u7528\u65bc\u7ba1\u7406\u6545\u969c\u5207\u63db\u904e\u7a0b\u4e26\u78ba\u4fdd\u9ad8\u53ef\u7528\u6027\u3002\n- \u5c0d\u65bc\u8eab\u4efd\u9a57\u8b49\uff0c\u6578\u64da\u5eab\u6703\u5275\u5efa\u4e00\u500b\u5305\u542b API \u5bc6\u9470\u7684 Kubernetes Secret\u3002\n\u5982\u9700\u4f7f\u7528 Helm \u5716\u8868\u90e8\u7f72 Qdrant \u6578\u64da\u5eab\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a- \u4f7f\u7528 Helm \u5716\u8868\u90e8\u7f72\u6709\u72c0\u614b HA \u904b\u7b97\u7b26\uff1a```\nVERSION=0.1.5REPO=\"gke-release\"mkdir ha-operatorgsutil cp gs://$REPO/ha-controller/$VERSION/ha-controller-helm.tar.gz ./ha-operatortar xvf ./ha-operator/ha-controller-helm.tar.gz --directory=ha-operator/helm upgrade -i ha-operator ./ha-operator/helm-chart \\--namespace ha-operator \\--create-namespace \\--set image.repository=\"$REPO\" \\--set image.tag=\"$VERSION\" \\--set useWorkloadSeparation=false\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nRelease \"ha-operator\" does not exist. Installing it now.\nNAME: ha-operator\nLAST DEPLOYED: Thu Nov 30 15:34:18 2023\nNAMESPACE: ha-operator\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\n```\n- \u5148\u6dfb\u52a0 Qdrant \u6578\u64da\u5eab Helm \u5716\u8868\u4ee3\u78bc\u5eab\uff0c\u7136\u5f8c\u624d\u80fd\u5c07\u5176\u90e8\u7f72\u5230\u60a8\u7684 GKE \u96c6\u7fa3\uff1a```\nhelm repo add qdrant https://qdrant.github.io/qdrant-helm\n```\n- \u7232\u6578\u64da\u5eab\u5275\u5efa\u547d\u540d\u7a7a\u9593 `qdrant` \uff1a```\nkubectl create ns qdrant\n```\n- \u61c9\u7528\u6e05\u55ae\u4ee5\u5275\u5efa\u5340\u57df\u6c38\u4e45\u6027 SSD \u78c1\u76e4 `StorageClass` \uff1a```\nkubectl apply -n qdrant -f manifests/01-regional-pd/regional-pd.yaml\n````regional-pd.yaml` \u6e05\u55ae\u63cf\u8ff0\u4e86\u6c38\u4e45\u6027 SSD \u78c1\u76e4 `StorageClass` \uff1a [  databases/qdrant/manifests/01-regional-pd/regional-pd.yaml ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/01-regional-pd/regional-pd.yaml) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/01-regional-pd/regional-pd.yaml) ```\napiVersion: storage.k8s.io/v1kind: StorageClassallowVolumeExpansion: truemetadata:\u00a0 name: ha-regionalparameters:\u00a0 replication-type: regional-pd\u00a0 type: pd-ssd\u00a0 availability-class: regional-hard-failoverprovisioner: pd.csi.storage.gke.ioreclaimPolicy: RetainvolumeBindingMode: WaitForFirstConsumer\n```\n- \u4f7f\u7528 Helm \u90e8\u7f72\u5177\u6709 `metrics` Sidecar \u914d\u7f6e\u548c Qdrant \u96c6\u7fa3\u7684 Kubernetes configmap\uff1a```\nkubectl apply -n qdrant -f manifests/03-prometheus-metrics/metrics-cm.yamlhelm install qdrant-database qdrant/qdrant -n qdrant \\-f manifests/02-values-file/values.yaml\n````metrics-cm.yaml` \u6e05\u55ae\u63cf\u8ff0\u4e86 `metrics` Sidecar `ConfigMap` \uff1a [  databases/qdrant/manifests/03-prometheus-metrics/metrics-cm.yaml ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/03-prometheus-metrics/metrics-cm.yaml) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/03-prometheus-metrics/metrics-cm.yaml) ```\napiVersion: v1kind: ConfigMapmetadata:\u00a0 name: nginx-confdata:\u00a0 default.conf.template: |\u00a0 \u00a0 server {\u00a0 \u00a0 \u00a0 listen 80;\u00a0 \u00a0 \u00a0 location / {\u00a0 \u00a0 \u00a0 \u00a0 proxy_pass http://localhost:6333/metrics;\u00a0 \u00a0 \u00a0 \u00a0 proxy_http_version 1.1;\u00a0 \u00a0 \u00a0 \u00a0 proxy_set_header Host $http_host;\u00a0 \u00a0 \u00a0 \u00a0 proxy_set_header api-key ${QDRANT_APIKEY};\u00a0 \u00a0 \u00a0 \u00a0 proxy_set_header X-Forwarded-For $remote_addr;\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\n````values.yaml` \u6e05\u55ae\u63cf\u8ff0\u4e86 Qdrant \u96c6\u7fa3\u914d\u7f6e\uff1a [  databases/qdrant/manifests/02-values-file/values.yaml ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/02-values-file/values.yaml) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/02-values-file/values.yaml) ```\nreplicaCount: 3config:\u00a0 cluster:\u00a0 \u00a0 enabled: true\u00a0 storage:\u00a0 \u00a0 optimizers:\u00a0 \u00a0 \u00a0 deleted_threshold: 0.5\u00a0 \u00a0 \u00a0 vacuum_min_vector_number: 1500\u00a0 \u00a0 \u00a0 default_segment_number: 2\u00a0 \u00a0 \u00a0 max_segment_size_kb: null\u00a0 \u00a0 \u00a0 memmap_threshold_kb: null\u00a0 \u00a0 \u00a0 indexing_threshold_kb: 25000\u00a0 \u00a0 \u00a0 flush_interval_sec: 5\u00a0 \u00a0 \u00a0 max_optimization_threads: 1livenessProbe:\u00a0 enabled: true\u00a0 initialDelaySeconds: 60resources:\u00a0 limits:\u00a0 \u00a0 cpu: \"2\"\u00a0 \u00a0 memory: 4Gi\u00a0 requests:\u00a0 \u00a0 cpu: \"1\"\u00a0 \u00a0 memory: 4Gitolerations:\u00a0 - key: \"app.stateful/component\"\u00a0 \u00a0 operator: \"Equal\"\u00a0 \u00a0 value: \"qdrant\"\u00a0 \u00a0 effect: NoScheduleaffinity:\u00a0 nodeAffinity:\u00a0 \u00a0 preferredDuringSchedulingIgnoredDuringExecution:\u00a0 \u00a0 - weight: 1\u00a0 \u00a0 \u00a0 preference:\u00a0 \u00a0 \u00a0 \u00a0 matchExpressions:\u00a0 \u00a0 \u00a0 \u00a0 - key: \"app.stateful/component\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 operator: In\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 values:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 - \"qdrant\"topologySpreadConstraints:\u00a0 - maxSkew: 1\u00a0 \u00a0 topologyKey: \"topology.kubernetes.io/zone\"\u00a0 \u00a0 whenUnsatisfiable: ScheduleAnyway\u00a0 \u00a0 labelSelector:\u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 app.kubernetes.io/name: qdrant\u00a0 \u00a0 \u00a0 \u00a0 app.kubernetes.io/instance: qdrantpodDisruptionBudget:\u00a0 enabled: true\u00a0 maxUnavailable: 1persistence:\u00a0 accessModes: [\"ReadWriteOnce\"]\u00a0 size: 10Gi\u00a0 storageClassName: ha-regionalapiKey: truesidecarContainers:\u00a0 - name: metrics\u00a0 \u00a0 image: nginx:1.25\u00a0 \u00a0 resources:\u00a0 \u00a0 \u00a0 requests:\u00a0 \u00a0 \u00a0 \u00a0 memory: \"128Mi\"\u00a0 \u00a0 \u00a0 \u00a0 cpu: \"250m\"\u00a0 \u00a0 \u00a0 limits:\u00a0 \u00a0 \u00a0 \u00a0 memory: \"128Mi\"\u00a0 \u00a0 \u00a0 \u00a0 cpu: \"500m\"\u00a0 \u00a0 ports:\u00a0 \u00a0 - containerPort: 80\u00a0 \u00a0 env:\u00a0 \u00a0 - name: QDRANT_APIKEY\u00a0 \u00a0 \u00a0 valueFrom:\u00a0 \u00a0 \u00a0 \u00a0 secretKeyRef:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name: qdrant-database-apikey\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 key: api-key\u00a0 \u00a0 volumeMounts:\u00a0 \u00a0 \u00a0 \u00a0 - name: nginx-conf\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 mountPath: /etc/nginx/templates/default.conf.template\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 subPath: default.conf.template\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 readOnly: trueadditionalVolumes:\u00a0 - name: nginx-conf\u00a0 \u00a0 configMap:\u00a0 \u00a0 \u00a0 name: nginx-conf\u00a0 \u00a0 \u00a0 items:\u00a0 \u00a0 \u00a0 \u00a0 - key: default.conf.template\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 path: default.conf.template \n```\u6b64\u914d\u7f6e\u6703\u5553\u7528\u96c6\u7fa3\u6a21\u5f0f\uff0c\u5141\u8a31\u60a8\u8a2d\u7f6e\u9ad8\u53ef\u7528\u6027\u548c\u5206\u4f48\u5f0f Qdrant \u96c6\u7fa3\u3002\n- \u6aa2\u67e5\u90e8\u7f72\u72c0\u614b\uff1a```\nhelm ls -n qdrant\n```\u5982\u679c `qdrant` \u6578\u64da\u5eab\u6210\u529f\u90e8\u7f72\uff0c\u5247\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME NAMESPACE  REVISION  UPDATED         STATUS   CHART   APP VERSION\nqdrant-database qdrant   1    2024-02-06 20:21:15.737307567 +0000 UTC deployed  qdrant-0.7.6 v1.7.4\n```\n- \u7b49\u5f85 GKE \u5553\u52d5\u6240\u9700\u5de5\u4f5c\u8ca0\u8f09\uff1a```\nkubectl wait pods -l app.kubernetes.io/instance=qdrant-database --for condition=Ready --timeout=300s -n qdrant\n```\u6b64\u547d\u4ee4\u53ef\u80fd\u9700\u8981\u5e7e\u5206\u9418\u6642\u9593\u624d\u80fd\u6210\u529f\u5b8c\u6210\u3002\n- GKE \u5553\u52d5\u5de5\u4f5c\u8ca0\u8f09\u5f8c\uff0c\u9a57\u8b49 GKE \u662f\u5426\u5df2\u5275\u5efa Qdrant \u5de5\u4f5c\u8ca0\u8f09\uff1a```\nkubectl get pod,svc,statefulset,pdb,secret -n qdrant\n```\n- \u5553\u52d5 Qdrant \u7684 `HighAvailabilityApplication` (HAA) \u8cc7\u6e90\uff1a```\nkubectl apply -n qdrant -f manifests/01-regional-pd/ha-app.yaml\n````ha-app.yaml` \u6e05\u55ae\u63cf\u8ff0\u4e86 `HighAvailabilityApplication` \u8cc7\u6e90\uff1a [  databases/qdrant/manifests/01-regional-pd/ha-app.yaml ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/01-regional-pd/ha-app.yaml) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/01-regional-pd/ha-app.yaml) ```\nkind: HighAvailabilityApplicationapiVersion: ha.gke.io/v1alpha1metadata:\u00a0 name: qdrant-ha-app\u00a0 namespace: qdrantspec:\u00a0 resourceSelection:\u00a0 \u00a0 type: \"Selector\"\u00a0 \u00a0 resourceKind: StatefulSet\u00a0 \u00a0 selector:\u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 app.kubernetes.io/instance: \"qdrant-database\"\u00a0 policy:\u00a0 \u00a0 storageSettings:\u00a0 \u00a0 \u00a0 requireRegionalStorage: true\u00a0 \u00a0 failoverSettings:\u00a0 \u00a0 \u00a0 forceDeleteStrategy: AfterNodeUnreachable\u00a0 \u00a0 \u00a0 afterNodeUnreachable:\u00a0 \u00a0 \u00a0 \u00a0 afterNodeUnreachableSeconds: 20 # 60 seconds total\n```\u7cfb\u7d71\u6703\u7232 Qdrant \u96c6\u7fa3\u5275\u5efa\u4ee5\u4e0b GKE \u8cc7\u6e90\uff1a- \u63a7\u5236\u4e09\u500b Pod \u526f\u672c\u7684 Qdrant`StatefulSet`\u3002\n- `A PodDisruptionBudget`\uff0c\u78ba\u4fdd\u6700\u591a\u96bb\u6709\u4e00\u500b\u4e0d\u53ef\u7528\u7684\u526f\u672c\u3002\n- `qdrant-database`Service\uff0c\u516c\u958b\u7bc0\u9ede\u4e4b\u9593\u7684\u5165\u7ad9\u9023\u63a5\u548c\u8907\u88fd\u7684 Qdrant \u7aef\u53e3\u3002\n- `qdrant-database-headless`Service\uff0c\u63d0\u4f9b\u6b63\u5728\u904b\u884c\u7684 Qdrant Pod \u7684\u5217\u8868\u3002\n- \u6709\u52a9\u65bc\u5b89\u5168\u7684\u6578\u64da\u5eab\u9023\u63a5\u7684`qdrant-database-apikey`Secret\u3002\n- \u6709\u72c0\u614b HA \u904b\u7b97\u7b26 Pod \u548c`HighlyAvailableApplication`\u8cc7\u6e90\uff0c\u4e3b\u52d5\u76e3\u63a7 Qdrant \u61c9\u7528\u3002`HighlyAvailableApplication`\u8cc7\u6e90\u5b9a\u7fa9\u4e86\u8981\u61c9\u7528\u65bc Qdrant \u7684\u6545\u969c\u5207\u63db\u898f\u5247\u3002\n- \u5982\u9700\u6aa2\u67e5\u6545\u969c\u5207\u63db\u898f\u5247\u662f\u5426\u5df2\u61c9\u7528\uff0c\u8acb\u63cf\u8ff0\u8cc7\u6e90\u4e26\u78ba\u8a8d `Status: Message: Application is protected` \u3002```\nkubectl describe highavailabilityapplication qdrant-ha-app -n qdrant\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nStatus:\nConditions:\n Last Transition Time: 2023-11-30T09:54:52Z\n Message:    Application is protected\n Observed Generation: 1\n Reason:    ApplicationProtected\n Status:    True\n Type:     Protected\n```\n## \u4e0a\u50b3\u6578\u64da\u96c6\u4e26\u904b\u884c\u641c\u7d22\u67e5\u8a62Qdrant \u4ee5\u96c6\u5408\u7684\u5f62\u5f0f\u7d44\u7e54\u5411\u91cf\u548c\u8f09\u8377\u3002\u5411\u91cf\u5d4c\u5165\u662f\u4e00\u7a2e\u5c07\u5b57\u8a5e\u6216\u5be6\u9ad4\u8868\u793a\u7232\u6578\u503c\u5411\u91cf\u4e26\u540c\u6642\u4fdd\u6301\u5176\u8a9e\u7fa9\u95dc\u4fc2\u7684\u6280\u8853\u3002\u9019\u5c0d\u65bc\u76f8\u4f3c\u5ea6\u641c\u7d22\u975e\u5e38\u91cd\u8981\uff0c\u56e0\u7232\u5b83\u53ef\u4ee5\u6839\u64da\u542b\u7fa9\u800c\u975e\u5b8c\u5168\u5339\u914d\u4f86\u67e5\u627e\u76f8\u4f3c\u5ea6\uff0c\u4f7f\u641c\u7d22\u548c\u63a8\u85a6\u7cfb\u7d71\u7b49\u4efb\u52d9\u66f4\u6709\u6548\u3001\u66f4\u7cbe\u7d30\u3002\n\u672c\u90e8\u5206\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528\u5b98\u65b9 [Qdrant \u5ba2\u6236\u7aef](https://github.com/qdrant/qdrant-client)  [\u5c07\u5411\u91cf\u4e0a\u50b3](https://qdrant.tech/articles/fastembed/) \u5230\u65b0\u7684 Qdrant [\u96c6\u5408](https://qdrant.tech/documentation/concepts/collections/) \uff0c\u4ee5\u53ca\u5982\u4f55\u904b\u884c\u7c21\u55ae\u641c\u7d22\u67e5\u8a62\u3002\n\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 CSV \u6587\u4ef6\u4e2d\u7684\u6578\u64da\u96c6\uff0c\u8a72\u6587\u4ef6\u5305\u542b\u4e0d\u540c\u985e\u578b\u7684\u5716\u66f8\u5217\u8868\u3002Qdrant \u5c07\u5145\u7576\u641c\u7d22\u5f15\u64ce\uff0c\u60a8\u5275\u5efa\u7684 Pod \u5c07\u5145\u7576\u67e5\u8a62 Qdrant \u6578\u64da\u5eab\u7684\u5ba2\u6236\u7aef\u3002- \u5275\u5efa `books-dataset` \u548c `demo-app` ConfigMap \u4e26\u904b\u884c\u5ba2\u6236\u7aef Pod \u4ee5\u8207\u60a8\u7684 Qdrant \u96c6\u7fa3\u9032\u884c\u4ea4\u4e92\uff1a```\nkubectl create -n qdrant configmap books-dataset --from-file=manifests/04-qdrant-client/dataset.csvkubectl create -n qdrant configmap demo-app --from-file=manifests/04-qdrant-client/app.pykubectl apply -n qdrant -f manifests/04-qdrant-client/client-pod.yaml\n```- \u4e4b\u524d\u5275\u5efa\u7684\u540d\u7232`qdrant-apikey`\u7684 Secret \u6703\u4f5c\u7232\u540d\u7232`APIKEY`\u7684\u74b0\u5883\u8b8a\u91cf\u88dd\u8f09\u5230\u5ba2\u6236\u7aef Pod \u4e0a\u3002\n- `books-dataset`ConfigMap \u5305\u542b\u4e00\u500b`csv`\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u7528\u65bc Qdrant \u96c6\u5408\u7684\u5716\u66f8\u6578\u64da\n- `demo-app`ConfigMap \u5305\u542b\u7528\u65bc\u5f9e`books-dataset`\u5275\u5efa Qdrant \u96c6\u5408\u7684 Python \u4ee3\u78bc\u3002\n`client-pod.yaml` \u6e05\u55ae\u63cf\u8ff0\u4e86 `qdrant-client` pod\uff1a [  databases/qdrant/manifests/04-qdrant-client/client-pod.yaml ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/client-pod.yaml) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/client-pod.yaml) ```\napiVersion: v1kind: Podmetadata:\u00a0 name: qdrant-client\u00a0 annotations:\u00a0 \u00a0 cluster-autoscaler.kubernetes.io/safe-to-evict: \"true\"spec:\u00a0 restartPolicy: Never\u00a0 containers:\u00a0 - name: qdrant-client\u00a0 \u00a0 image: python:3.11-slim-bookworm\u00a0 \u00a0 command: [\"sleep\", \"3600\"]\u00a0 \u00a0 resources:\u00a0 \u00a0 \u00a0 requests:\u00a0 \u00a0 \u00a0 \u00a0 memory: \"3500Mi\"\u00a0 \u00a0 \u00a0 \u00a0 cpu: \"500m\"\u00a0 \u00a0 \u00a0 limits:\u00a0 \u00a0 \u00a0 \u00a0 memory: \"3500Mi\"\u00a0 \u00a0 \u00a0 \u00a0 cpu: \"1\"\u00a0 \u00a0 env:\u00a0 \u00a0 - name: APIKEY\u00a0 \u00a0 \u00a0 valueFrom:\u00a0 \u00a0 \u00a0 \u00a0 secretKeyRef:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name: qdrant-database-apikey\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 key: api-key\u00a0 \u00a0 volumeMounts:\u00a0 \u00a0 - name: books-dataset\u00a0 \u00a0 \u00a0 mountPath: /usr/local/dataset\u00a0 \u00a0 - name: script-volume\u00a0 \u00a0 \u00a0 mountPath: /usr/local/script\u00a0 volumes:\u00a0 - name: books-dataset\u00a0 \u00a0 configMap:\u00a0 \u00a0 \u00a0 name: books-dataset\u00a0 - name: script-volume\u00a0 \u00a0 configMap:\u00a0 \u00a0 \u00a0 name: demo-app\n```\n- \u7b49\u5f85 GKE \u5553\u52d5\u5ba2\u6236\u7aef pod\uff1a```\nkubectl wait pod qdrant-client --for=condition=Ready --timeout=300s -n qdrant\n```\n- \u5728\u5ba2\u6236\u7aef Pod \u6e96\u5099\u5c31\u7dd2\u5f8c\uff0c\u9023\u63a5\u5230\u5ba2\u6236\u7aef Pod\uff1a```\nkubectl exec -it qdrant-client -n qdrant -- /bin/bash\n```\n- \u5275\u5efa\u865b\u64ec\u74b0\u5883\uff1a```\npython -m venv venvsource venv/bin/activate\n```\n- \u5b89\u88dd\u652f\u6301 [fastembed](https://github.com/qdrant/fastembed) \u7684 Qdrant \u5ba2\u6236\u7aef\uff0c\u4ee5\u6d88\u9664\u5c0d\u5916\u90e8\u6a21\u578b\u90e8\u7f72\u670d\u52d9\u7684\u4f9d\u8cf4\uff1a```\npip install qdrant-client[fastembed]\n```\n- \u904b\u884c `app.py` Python \u8173\u672c\u4ee5\u4e0a\u50b3\u548c\u67e5\u8a62\u6578\u64da\u96c6\uff1a```\npython usr/local/script/app.py \"drama about people and unhappy love\"\n````app.py` \u8173\u672c\u5c07\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5c0e\u5165\u6240\u9700\u7684 Python \u548c Qdrad \u5eab\uff1a\n [  databases/qdrant/manifests/04-qdrant-client/app.py ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/app.py) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/app.py) ```\nfrom qdrant_client import QdrantClientfrom qdrant_client.http import modelsimport osimport sysimport csv\n```- \u5f9e CSV \u52a0\u8f09\u6578\u64da\uff1a\u8b80\u53d6`dataset.csv`\u6587\u4ef6\uff0c\u4ee5\u4fbf\u5c07\u6578\u64da\u63d2\u5165 Qdrant \u96c6\u5408\u3002\n [  databases/qdrant/manifests/04-qdrant-client/app.py ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/app.py) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/app.py) ```\nbooks = [*csv.DictReader(open('/usr/local/dataset/dataset.csv'))]\n```- \u5275\u5efa Qdrant \u96c6\u5408\u4e26\u63d2\u5165\u6578\u64da\uff1a\u5efa\u7acb\u8207 Qdrant \u7684\u9023\u63a5\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232`my_books`\u7684\u65b0\u96c6\u5408\uff0c\u4e26\u5c07\u5716\u66f8\u6578\u64da\u4e0a\u50b3\u5230`my_books`\u3002\n [  databases/qdrant/manifests/04-qdrant-client/app.py ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/app.py) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/app.py) ```\n# Add my_books to the collectionqdrant.add(collection_name=\"my_books\", documents=documents, metadata=metadata, ids=ids, parallel=2)\n```- \u67e5\u8a62 Qdrant \u6578\u64da\u5eab\uff1a\u904b\u884c\u6709\u95dc`drama about people and unhappy love`\u7684\u641c\u7d22\u67e5\u8a62\u4e26\u986f\u793a\u7d50\u679c\u3002\n [  databases/qdrant/manifests/04-qdrant-client/app.py ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/app.py) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/04-qdrant-client/app.py) ```\nresults = qdrant.query(\u00a0 \u00a0 collection_name=\"my_books\",\u00a0 \u00a0 query_text=query_string,\u00a0 \u00a0 limit=2,)for result in results:\u00a0 \u00a0 print(\"Title:\", result.metadata[\"title\"], \"\\nAuthor:\", result.metadata[\"author\"])\u00a0 \u00a0 print(\"Description:\", result.metadata[\"document\"], \"Published:\", result.metadata[\"publishDate\"], \"\\nScore:\", result.score)\u00a0 \u00a0 print(\"-----\")\n```\u6b64\u67e5\u8a62\u5c0d Qdrant \u4e2d\u7684 `my_books` \u96c6\u5408\u57f7\u884c\u8a9e\u7fa9\u641c\u7d22\uff0c\u6aa2\u7d22\u6700\u591a\u5169\u500b\u5177\u6709\u8207\u67e5\u8a62\u6587\u672c\u76f8\u95dc\u6700\u9ad8\u5339\u914d\u5f97\u5206\u7684\u7d50\u679c\u3002\u5b83\u5c07\u8f38\u51fa\u7531\u4e00\u884c\u77ed\u5283\u7dda\u5206\u9694\u7684\u6bcf\u500b\u7d50\u679c\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a- `Title`\uff1a\u66f8\u540d\n- `Author`\uff1a\u5716\u66f8\u4f5c\u8005\n- `Description`\uff1a\u5b58\u5132\u5728\u6587\u6a94\u7684`description`\u5143\u6578\u64da\u5b57\u6bb5\u4e2d\n- `Published`\uff1a\u5716\u66f8\u51fa\u7248\u65e5\u671f\n- `Score`\uff1aQdrant \u7684\u76f8\u95dc\u6027\u5f97\u5206\n\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nTitle: Romeo and Juliet\nAuthor: William Shakespeare, Paul Werstine (Editor), Barbara A. Mowat (Editor), Paavo Emil Cajander (Translator)\nDescription: In Romeo and Juliet, Shakespeare creates a violent world, in which two young people fall in love. It is not simply that their families disapprove; the Montagues and the Capulets are engaged in a blood feud.In this death-filled setting, the movement from love at first sight to the lovers' final union in death seems almost inevitable. And yet, this play set in an extraordinary world has become the quintessential story of young love. In part because of its exquisite language, it is easy to respond as if it were about all young lovers. Published: 01/01/04\nScore: 0.8935013\n----Title: The Unbearable Lightness of Being\nAuthor: Milan Kundera, Michael Henry Heim (Translator)\nDescription: In The Unbearable Lightness of Being, Milan Kundera tells the story of a young woman in love with a man torn between his love for her and his incorrigible womanizing and one of his mistresses and her humbly faithful lover. This magnificent novel juxtaposes geographically distant places, brilliant and playful reflections, and a variety of styles, to take its place as perhaps the major achievement of one of the world's truly great writers. Published: 10/27/09\nScore: 0.8931863\n----\n```\n- \u9000\u51fa Python \u8173\u672c\uff1a```\nexit()\n```\n- \u9000\u51fa\u5ba2\u6236\u7aef\uff1a```\nexit\n```\n## \u67e5\u770b\u96c6\u7fa3\u7684 Prometheus \u6307\u6a19GKE \u96c6\u7fa3\u914d\u7f6e\u4e86 [Google Cloud Managed Service for Prometheus](https://cloud.google.com/stackdriver/docs/managed-prometheus?hl=zh-cn) \uff0c\u53ef\u8b93\u60a8\u6536\u96c6 Prometheus \u683c\u5f0f\u7684\u6307\u6a19\u3002\u8a72\u670d\u52d9\u63d0\u4f9b\u4e86\u76e3\u63a7\u548c\u63d0\u9192\u7684\u5168\u8a17\u7ba1\u5f0f\u89e3\u6c7a\u65b9\u6848\uff0c\u5141\u8a31\u6536\u96c6\u3001\u5b58\u5132\u548c\u5206\u6790\u4f86\u81ea\u96c6\u7fa3\u53ca\u5176\u61c9\u7528\u7684\u6307\u6a19\u3002\n\u4e0b\u5716\u5c55\u793a\u4e86 Prometheus \u5982\u4f55\u6536\u96c6\u96c6\u7fa3\u7684\u6307\u6a19\uff1a\u5716\u4e2d\u7684 GKE \u5c08\u7528\u96c6\u7fa3\u5305\u542b\u4ee5\u4e0b\u7d44\u4ef6\uff1a- \u516c\u958b\u8def\u5f91`/`\u548c\u7aef\u53e3`80`\u4e0a\u6307\u6a19\u7684 Qdrant Pod\u3002\u9019\u4e9b\u6307\u6a19\u7531\u540d\u7232`metrics`\u7684 sidecar \u5bb9\u5668\u63d0\u4f9b\u3002\n- \u57fa\u65bc Prometheus \u7684\u6536\u96c6\u5668\uff0c\u7528\u65bc\u8655\u7406\u4f86\u81ea Qdrant Pod \u7684\u6307\u6a19\u3002\n- \u5c07\u6307\u6a19\u767c\u9001\u5230 Cloud Monitoring \u7684 PodMonitoring \u8cc7\u6e90\u3002\n\u5982\u9700\u5c0e\u51fa\u548c\u67e5\u770b\u6307\u6a19\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a- \u5275\u5efa [PodMonitoring](https://cloud.google.com/stackdriver/docs/managed-prometheus/setup-managed?hl=zh-cn#gmp-pod-monitoring) \u8cc7\u6e90\uff0c\u4ee5\u6309 `labelSelector` \u722c\u53d6\u6307\u6a19\uff1a```\nkubectl apply -n qdrant -f manifests/03-prometheus-metrics/pod-monitoring.yaml\n````pod-monitoring.yaml` \u6e05\u55ae\u63cf\u8ff0\u4e86 `PodMonitoring` \u8cc7\u6e90\uff1a [  databases/qdrant/manifests/03-prometheus-metrics/pod-monitoring.yaml ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/03-prometheus-metrics/pod-monitoring.yaml) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/databases/qdrant/manifests/03-prometheus-metrics/pod-monitoring.yaml) ```\napiVersion: monitoring.googleapis.com/v1kind: PodMonitoringmetadata:\u00a0 name: qdrantspec:\u00a0 selector:\u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 app: qdrant\u00a0 \u00a0 \u00a0 app.kubernetes.io/instance: qdrant-database\u00a0 endpoints:\u00a0 - port: 80\u00a0 \u00a0 interval: 30s\u00a0 \u00a0 path: / \n```\n- \u4f7f\u7528 `dashboard.json` \u4e2d\u5b9a\u7fa9\u7684\u914d\u7f6e [\u5275\u5efa Cloud Monitoring \u4fe1\u606f\u4e2d\u5fc3](https://cloud.google.com/sdk/gcloud/reference/monitoring/dashboards/create?hl=zh-cn) \uff1a```\ngcloud --project \"${PROJECT_ID}\" monitoring dashboards create --config-from-file monitoring/dashboard.json\n```\n- \u547d\u4ee4\u6210\u529f\u904b\u884c\u5f8c\uff0c\u8f49\u5230 Cloud Monitoring [\u4fe1\u606f\u4e2d\u5fc3](https://cloud.google.com/monitoring/dashboards?hl=zh-cn) \uff1a [\u8f49\u5230\u201c\u4fe1\u606f\u4e2d\u5fc3\u6982\u89bd\u201d](https://console.cloud.google.com/monitoring/dashboards?hl=zh-cn) \n- \u5f9e\u4fe1\u606f\u4e2d\u5fc3\u5217\u8868\u4e2d\uff0c\u6253\u958b `Qdrant Overview` \u4fe1\u606f\u4e2d\u5fc3\u3002\u6536\u96c6\u548c\u986f\u793a\u6307\u6a19\u53ef\u80fd\u9700\u8981 1-2 \u5206\u9418\u6642\u9593\u3002\u4fe1\u606f\u4e2d\u5fc3\u6703\u986f\u793a\u95dc\u9375\u6307\u6a19\u7684\u8a08\u6578\uff1a- \u96c6\u5408\n- \u5d4c\u5165\u5f0f\u5411\u91cf\n- \u5f85\u8655\u7406\u7684\u64cd\u4f5c\n- \u6b63\u5728\u904b\u884c\u7684\u7bc0\u9ede## \u5099\u4efd\u96c6\u7fa3\u914d\u7f6e\u85c9\u52a9 [Backup for GKE](https://cloud.google.com/kubernetes-engine/docs/add-on/backup-for-gke/concepts/backup-for-gke?hl=zh-cn) \u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u7232\u6574\u500b GKE \u96c6\u7fa3\u914d\u7f6e\uff08\u5305\u62ec\u5df2\u90e8\u7f72\u7684\u5de5\u4f5c\u8ca0\u8f09\u53ca\u5176\u6578\u64da\uff09\u5b89\u6392\u5b9a\u671f\u5099\u4efd\u3002\n\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u7232 GKE \u96c6\u7fa3\u914d\u7f6e\u5099\u4efd\u65b9\u6848\uff0c\u4ee5\u5728\u6bcf\u5929\u51cc\u6668 3 \u9ede\u5c0d\u6240\u6709\u5de5\u4f5c\u8ca0\u8f09\uff08\u5305\u62ec Secret \u548c\u5377\uff09\u57f7\u884c\u5099\u4efd\u3002\u7232\u78ba\u4fdd\u9ad8\u6548\u5b58\u5132\u7ba1\u7406\uff0c\u4e09\u5929\u524d\u7684\u5099\u4efd\u6703\u88ab\u81ea\u52d5\u522a\u9664\u3002\n\u5982\u9700\u914d\u7f6e [\u5099\u4efd\u65b9\u6848](https://cloud.google.com/kubernetes-engine/docs/add-on/backup-for-gke/how-to/backup-plan?hl=zh-cn#gcloud) \uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a- \u7232\u96c6\u7fa3\u5553\u7528 Backup for GKE \u529f\u80fd\uff1a```\ngcloud container clusters update ${KUBERNETES_CLUSTER_PREFIX}-cluster \\--project=${PROJECT_ID} \\--region=${REGION} \\--update-addons=BackupRestore=ENABLED\n```\n- \u7232\u96c6\u7fa3\u4e2d\u7684\u6240\u6709\u547d\u540d\u7a7a\u9593\u5275\u5efa\u5177\u6709\u6bcf\u65e5\u6642\u9593\u8868\u7684\u5099\u4efd\u65b9\u6848\uff1a```\ngcloud beta container backup-restore backup-plans create ${KUBERNETES_CLUSTER_PREFIX}-cluster-backup \\--project=${PROJECT_ID} \\--location=${REGION} \\--cluster=\"projects/${PROJECT_ID}/locations/${REGION}/clusters/${KUBERNETES_CLUSTER_PREFIX}-cluster\" \\--all-namespaces \\--include-secrets \\--include-volume-data \\--cron-schedule=\"0 3 * * *\" \\--backup-retain-days=3\n```\u8a72\u547d\u4ee4\u5728\u904b\u884c\u6642\u4f7f\u7528\u76f8\u95dc\u7684\u74b0\u5883\u8b8a\u91cf\u3002\u96c6\u7fa3\u540d\u7a31\u7684\u683c\u5f0f\u76f8\u5c0d\u65bc\u60a8\u7684\u9805\u76ee\u548c\u5340\u57df\uff0c\u5982\u4e0b\u6240\u793a\uff1a```\nprojects/PROJECT_ID/locations/REGION/clusters/CLUSTER_NAME\n```\u51fa\u73fe\u63d0\u793a\u6642\uff0c\u8f38\u5165 `y.` \u3002\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nCreate request issued for: [qdrant-cluster-backup]\nWaiting for operation [projects/PROJECT_ID/locations/us-central1/operations/operation-1706528750815-610142ffdc9ac-71be4a05-f61c99fc] to complete...\u2839\n```\u6b64\u64cd\u4f5c\u53ef\u80fd\u9700\u8981\u5e7e\u5206\u9418\u624d\u80fd\u6210\u529f\u5b8c\u6210\u3002\u57f7\u884c\u5b8c\u6210\u5f8c\uff0c\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nCreated backup plan [qdrant-cluster-backup].\n```\n- \u60a8\u53ef\u4ee5\u5728 Backup for GKE \u63a7\u5236\u6aaf\u4e2d\u770b\u5230\u65b0\u5275\u5efa\u7684\u5099\u4efd\u65b9\u6848 `qdrant-cluster-backup` \u3002 [\u8f49\u5230 Backup for GKE](https://console.cloud.google.com/kubernetes/backups/backupPlans?hl=zh-cn) \n\u82e5\u8981\u6062\u5fa9\u5df2\u4fdd\u5b58\u7684\u5099\u4efd\u914d\u7f6e\uff0c\u8acb\u53c3\u95b1 [\u6062\u5fa9\u5099\u4efd](https://cloud.google.com/kubernetes-engine/docs/add-on/backup-for-gke/how-to/restore?hl=zh-cn) \u3002## \u6e05\u7406\u7232\u907f\u514d\u56e0\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u8cc7\u6e90\u5c0e\u81f4\u60a8\u7684 Google Cloud \u8cec\u865f\u7522\u751f\u8cbb\u7528\uff0c\u8acb\u522a\u9664\u5305\u542b\u9019\u4e9b\u8cc7\u6e90\u7684\u9805\u76ee\uff0c\u6216\u8005\u4fdd\u7559\u9805\u76ee\u4f46\u522a\u9664\u5404\u500b\u8cc7\u6e90\u3002\n### \u522a\u9664\u9805\u76ee\u7232\u4e86\u907f\u514d\u7522\u751f\u8cbb\u7528\uff0c\u6700\u7c21\u55ae\u7684\u65b9\u6cd5\u662f\u522a\u9664\u60a8\u7232\u672c\u6559\u7a0b\u5275\u5efa\u7684\u9805\u76ee\u3002Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them **\u8b66\u544a** \uff1a\u522a\u9664\u9805\u76ee\u6703\u7522\u751f\u4ee5\u4e0b\u5f71\u97ff- **\u9805\u76ee\u4e2d\u7684\u6240\u6709\u5167\u5bb9\u90fd\u6703\u88ab\u522a\u9664\u3002** \u5982\u679c\u60a8\u5c07\u73fe\u6709\u9805\u76ee\u7528\u65bc\u672c\u6587\u6a94\u4e2d\u7684\u4efb\u52d9\uff0c\u5247\u522a\u9664\u8a72\u9805\u76ee\u5f8c\uff0c\u9084\u5c07\u522a\u9664\u60a8\u5df2\u5728\u8a72\u9805\u76ee\u4e2d\u5b8c\u6210\u7684\u4efb\u4f55\u5176\u4ed6\u5de5\u4f5c\u3002\n- **\u81ea\u5b9a\u7fa9\u9805\u76ee ID \u4e1f\u5931\u3002** \u5275\u5efa\u6b64\u9805\u76ee\u6642\uff0c\u60a8\u53ef\u80fd\u5275\u5efa\u4e86\u8981\u5728\u5c07\u4f86\u4f7f\u7528\u7684\u81ea\u5b9a\u7fa9\u9805\u76ee ID\u3002\u8981\u4fdd\u7559\u4f7f\u7528\u8a72\u9805\u76ee ID \u7684\u7db2\u5740\uff08\u4f8b\u5982`appspot.com`\u7db2\u5740\uff09\uff0c\u8acb\u522a\u9664\u9805\u76ee\u5167\u7684\u6240\u9078\u8cc7\u6e90\uff0c\u800c\u4e0d\u662f\u522a\u9664\u6574\u500b\u9805\u76ee\u3002\n\u5982\u679c\u60a8\u6253\u7b97\u63a2\u7d22\u591a\u500b\u67b6\u69cb\u3001\u6559\u7a0b\u6216\u5feb\u901f\u5165\u9580\uff0c\u5247\u91cd\u8907\u4f7f\u7528\u9805\u76ee\u53ef\u4ee5\u5e6b\u52a9\u60a8\u907f\u514d\u8d85\u51fa\u9805\u76ee\u914d\u984d\u9650\u5236\u3002\n\u522a\u9664 Google Cloud \u9805\u76ee\uff1a\n```\ngcloud projects delete PROJECT_ID\n```\n\u5982\u679c\u60a8\u522a\u9664\u4e86\u9805\u76ee\uff0c\u5247\u8868\u793a\u60a8\u7684\u6e05\u7406\u5df2\u5b8c\u6210\u3002\u5982\u679c\u60a8\u6c92\u6709\u522a\u9664\u9805\u76ee\uff0c\u60a8\u53ef\u4ee5\u7e7c\u7e8c\u522a\u9664\u5404\u500b\u8cc7\u6e90\u3002\n### \u522a\u9664\u5404\u500b\u8cc7\u6e90\n- \u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\u3002```\nexport PROJECT_ID=${PROJECT_ID}export KUBERNETES_CLUSTER_PREFIX=qdrantexport REGION=us-central1\n```\n- \u904b\u884c `terraform destroy` \u547d\u4ee4\uff1a```\nexport GOOGLE_OAUTH_ACCESS_TOKEN=$(gcloud auth print-access-token)terraform \u00a0-chdir=terraform/FOLDER destroy \\-var project_id=${PROJECT_ID} \\-var region=${REGION} \\-var cluster_prefix=${KUBERNETES_CLUSTER_PREFIX}\n```\u5c07 `` \u66ff\u63db\u7232 `gke-autopilot` \u6216 `gke-standard` \uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc [\u60a8\u5275\u5efa\u7684 GKE \u96c6\u7fa3\u7684\u985e\u578b](#create-cluster) \u3002\u51fa\u73fe\u63d0\u793a\u6642\uff0c\u8acb\u8f38\u5165 `yes` \u3002\n- \u67e5\u627e\u6240\u6709\u672a\u639b\u63a5\u7684\u78c1\u76e4\uff1a```\nexport disk_list=$(gcloud compute disks list --filter=\"-users:* AND labels.name=${KUBERNETES_CLUSTER_PREFIX}-cluster\" --format \"value[separator=|](name,region)\")\n```\n- \u522a\u9664\u78c1\u76e4\uff1a```\nfor i in $disk_list; do\u00a0disk_name=$(echo $i| cut -d'|' -f1)\u00a0disk_region=$(echo $i| cut -d'|' -f2|sed 's|.*/||')\u00a0echo \"Deleting $disk_name\"\u00a0gcloud compute disks delete $disk_name --region $disk_region --quietdone\n```\n- \u522a\u9664 GitHub \u4ee3\u78bc\u5eab\uff1a```\nrm -r ~/kubernetes-engine-samples/\n```\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u63a2\u7d22 [Qdrant \u958b\u6e90](https://github.com/qdrant/qdrant) \u8edf\u4ef6\u3002\n- \u8a66\u7528 [Qdrant \u904b\u7b97\u7b26](https://github.com/ganochenkodg/qdrant-operator) \uff0c\u8a72\u904b\u7b97\u7b26\u63d0\u4f9b\u4e86 [API \u5bc6\u9470\u7ba1\u7406](https://github.com/ganochenkodg/qdrant-operator/blob/main/docs/authentication.md) \u529f\u80fd\u3001TLS \u652f\u6301\uff08\u5e36 [\u8b49\u66f8\u7ba1\u7406](https://github.com/ganochenkodg/qdrant-operator/blob/main/docs/tls.md) \u529f\u80fd\uff09\u548c [\u5099\u4efd\u5b89\u6392](https://github.com/ganochenkodg/qdrant-operator/blob/main/docs/backup-restore.md) \u529f\u80fd\u3002\n- \u77ad\u89e3 [\u5728 GKE \u4e0a\u90e8\u7f72\u6578\u64da\u5eab\u7684\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/kubernetes-engine/docs/concepts/database-options?hl=zh-cn) \u3002\n- \u63a2\u7d22\u7528\u65bc [\u4f7f\u7528 GKE \u904b\u884c\u6578\u64da\u5bc6\u96c6\u578b\u5de5\u4f5c\u8ca0\u8f09](https://cloud.google.com/kubernetes-engine/docs/integrations/data?hl=zh-cn) \u7684\u89e3\u6c7a\u65b9\u6848\u3002", "guide": "Google Kubernetes Engine (GKE)"}