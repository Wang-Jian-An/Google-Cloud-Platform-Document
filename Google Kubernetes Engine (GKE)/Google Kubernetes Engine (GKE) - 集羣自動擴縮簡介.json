{"title": "Google Kubernetes Engine (GKE) - \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u7c21\u4ecb", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u7c21\u4ecb\n\u672c\u9801\u9762\u4ecb\u7d39 Google Kubernetes Engine (GKE) \u5982\u4f55\u6839\u64da\u5de5\u4f5c\u8ca0\u8f09\u9700\u6c42\u81ea\u52d5\u8abf\u6574 Standard \u96c6\u7fa3\u7684\u7bc0\u9ede\u6c60\u5927\u5c0f\u3002 \u7576\u9700\u6c42\u8f03\u9ad8\u6642\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u5c07\u7bc0\u9ede\u6dfb\u52a0\u5230\u7bc0\u9ede\u6c60\u4e2d\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u914d\u7f6e\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\uff0c\u8acb\u53c3\u95b1 [\u81ea\u52d5\u64f4\u7e2e\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-autoscaler?hl=zh-cn) \u3002\n\u85c9\u52a9 Autopilot \u96c6\u7fa3\uff0c\u60a8\u7121\u9700\u64d4\u5fc3\u9810\u914d\u7bc0\u9ede\u6216\u7bc0\u9ede\u6c60\uff0c\u56e0\u7232\u7bc0\u9ede\u6c60\u901a\u904e [\u7bc0\u9ede\u81ea\u52d5\u9810\u914d](https://cloud.google.com/kubernetes-engine/docs/how-to/node-auto-provisioning?hl=zh-cn) \u81ea\u52d5 \u9810\u914d\uff1b\u4e26\u81ea\u52d5\u64f4\u7e2e\u4ee5\u6eff\u8db3\u5de5\u4f5c\u8ca0\u8f09\u7684\u8981\u6c42\u3002\n", "content": "## \u7232\u4f55\u4f7f\u7528\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\nGKE \u7684 \u6703\u6839\u64da\u5de5\u4f5c\u8ca0\u8f09\u7684\u9700\u6c42\u81ea\u52d5\u8abf\u6574\u7d66\u5b9a\u7bc0\u9ede\u6c60\u4e2d\u7684\u7bc0\u9ede\u6578\u91cf\u3002\u7576\u9700\u6c42\u8f03\u4f4e\u6642\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u5c07\u7bc0\u9ede\u6c60\u7e2e\u6e1b\u5230\u60a8\u6307\u5b9a\u7684\u6700\u5c0f\u5927\u5c0f\u3002\u9019\u6a23\u53ef\u4ee5\u5728\u60a8\u9700\u8981\u6642\u63d0\u9ad8\u5de5\u4f5c\u8ca0\u8f09\u7684\u53ef\u7528\u6027\uff0c\u540c\u6642\u63a7\u5236\u8cbb\u7528\u3002\u60a8\u4e0d\u9700\u8981\u624b\u52d5\u6dfb\u52a0\u6216\u79fb\u9664\u7bc0\u9ede\uff0c\u4e5f\u4e0d\u9700\u8981\u904e\u5ea6\u9810\u914d\u7bc0\u9ede\u6c60\u3002\u60a8\u53ea\u9700\u6307\u5b9a\u7bc0\u9ede\u6c60\u7684\u6700\u5c0f\u5927\u5c0f\u548c\u6700\u5927\u5927\u5c0f\u5373\u53ef\uff0c\u5176\u4ed6\u64cd\u4f5c\u90fd\u662f\u81ea\u52d5\u57f7\u884c\u7684\u3002\n\u5728\u7cfb\u7d71\u81ea\u52d5\u64f4\u7e2e\u96c6\u7fa3\u6642\uff0c\u5982\u679c\u522a\u9664\u6216\u79fb\u52d5\u8cc7\u6e90\uff0c\u5247\u5de5\u4f5c\u8ca0\u8f09\u53ef\u80fd\u6703\u66ab\u6642\u4e2d\u65b7\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5de5\u4f5c\u8ca0\u8f09\u5305\u542b\u5177\u6709\u55ae\u500b\u526f\u672c\u7684\u63a7\u5236\u5668\uff0c\u5247\u5728\u522a\u9664\u8a72\u526f\u672c\u7684 Pod \u7684\u7576\u524d\u7bc0\u9ede\u6642\uff0c\u7cfb\u7d71\u53ef\u80fd\u6703\u5c07\u6b64 Pod \u91cd\u65b0\u8abf\u5ea6\u5230\u5176\u4ed6\u7bc0\u9ede\u4e0a\u3002\u5553\u7528\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u4e4b\u524d\uff0c\u8acb\u8a2d\u8a08\u597d\u5de5\u4f5c\u8ca0\u8f09\u4ee5\u5bb9\u5fcd\u6f5b\u5728\u7684\u4e2d\u65b7\u6216\u78ba\u4fdd\u95dc\u9375\u7684 Pod \u4e0d\u6703\u4e2d\u65b7\u3002\n**\u6ce8\u610f** \uff1a\u5982\u9700\u63d0\u9ad8\u5de5\u4f5c\u8ca0\u8f09\u5c0d\u4e2d\u65b7\u7684\u5bb9\u5fcd\u5ea6\uff0c\u8acb\u8003\u616e\u4f7f\u7528\u5177\u6709\u591a\u500b\u526f\u672c\u7684\u63a7\u5236\u5668\uff08\u4f8b\u5982 Deployment\uff09\u90e8\u7f72\u5de5\u4f5c\u8ca0\u8f09\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u6620\u50cf\u6d41\u5f0f\u50b3\u8f38](https://cloud.google.com/kubernetes-engine/docs/how-to/image-streaming?hl=zh-cn) \u529f\u80fd\u63d0\u9ad8\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7684\u6027\u80fd\uff0c\u8a72\u529f\u80fd\u53ef\u9060\u7a0b\u6d41\u5f0f\u50b3\u8f38\u7b26\u5408\u689d\u4ef6\u7684\u5bb9\u5668\u6620\u50cf\u6240\u9700\u7684\u6620\u50cf\u6578\u64da\uff0c\u540c\u6642\u5728\u672c\u5730\u7de9\u5b58\u6620\u50cf\u4ee5\u5141\u8a31\u65b0\u7bc0\u9ede\u4e0a\u7684\u5de5\u4f5c\u8ca0\u8f09\u80fd\u5920\u4ee5\u66f4\u5feb\u7684\u901f\u5ea6\u5553\u52d5\u3002\n## \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7684\u5de5\u4f5c\u539f\u7406\n\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u4ee5\u6bcf\u500b\u7bc0\u9ede\u6c60\u7232\u55ae\u4f4d\u9032\u884c\u64f4\u7e2e\u3002\u914d\u7f6e\u5177\u6709\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7684\u7bc0\u9ede\u6c60\u6642\uff0c\u60a8\u9700\u8981\u6307\u5b9a\u7bc0\u9ede\u6c60\u7684\u6700\u5c0f\u5927\u5c0f\u548c\u6700\u5927\u5927\u5c0f\u3002\n\u901a\u904e\u5728\u81ea\u52d5\u64f4\u7e2e\u5668\u7684\u5e95\u5c64 Compute Engine [\u8a17\u7ba1\u5be6\u4f8b\u7d44 (MIG)](https://cloud.google.com/compute/docs/instance-groups?hl=zh-cn#managed_instance_groups) \u4e2d\u6dfb\u52a0\u6216\u79fb\u9664\u865b\u64ec\u6a5f (VM) \u5be6\u4f8b\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u81ea\u52d5\u589e\u5927\u6216\u6e1b\u5c0f\u7bc0\u9ede\u6c60\u7684\u5927\u5c0f\u3002\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u6839\u64da\u5728\u8a72\u7bc0\u9ede\u6c60\u7684\u7bc0\u9ede\u4e0a\u904b\u884c\u7684 Pod \u7684\u8cc7\u6e90\u8acb\u6c42\uff08\u800c\u4e0d\u662f\u5be6\u969b\u8cc7\u6e90\u5229\u7528\u7387\uff09\u505a\u51fa\u9019\u4e9b\u64f4\u7e2e\u6c7a\u7b56\u3002\u5b83\u6703\u5b9a\u671f\u6aa2\u67e5 Pod \u548c\u7bc0\u9ede\u7684\u72c0\u614b\uff0c\u4e26\u57f7\u884c\u76f8\u61c9\u7684\u64cd\u4f5c\uff1a\n- \u5982\u679c\u7531\u65bc\u7bc0\u9ede\u6c60\u4e2d\u7684\u7bc0\u9ede\u4e0d\u8db3\u800c\u7121\u6cd5\u8abf\u5ea6 Pod\uff0c\u5247\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u6dfb\u52a0\u7bc0\u9ede\uff08\u6700\u591a\u6dfb\u52a0\u5230\u7bc0\u9ede\u6c60\u7684\u6700\u5927\u5927\u5c0f\uff09\u3002\n- \u5982\u679c\u7bc0\u9ede\u5229\u7528\u4e0d\u8db3\uff0c\u4e26\u4e14\u7cfb\u7d71\u5728\u7bc0\u9ede\u6c60\u4e2d\u7684\u7bc0\u9ede\u6e1b\u5c11\u7684\u5047\u8a2d\u4e0b\u4ecd\u53ef\u4ee5\u8abf\u5ea6\u6240\u6709 Pod\uff0c\u5247\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u79fb\u9664\u7bc0\u9ede\uff08\u6700\u591a\u79fb\u9664\u5230\u7bc0\u9ede\u6c60\u7684\u6700\u5c0f\u5927\u5c0f\uff09\u3002\u5982\u679c\u7bc0\u9ede\u4e0a\u6709 Pod \u7121\u6cd5\u79fb\u52d5\u5230\u96c6\u7fa3\u4e2d\u7684\u5176\u4ed6\u7bc0\u9ede\uff0c\u5247\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u4e0d\u6703\u5617\u8a66\u7e31\u5411\u7e2e\u5bb9\u8a72\u7bc0\u9ede\u3002\u5982\u679c Pod \u53ef\u4ee5\u79fb\u52d5\u5230\u5176\u4ed6\u7bc0\u9ede\uff0c\u4f46\u7cfb\u7d71\u4e0d\u80fd\u5728\u8d85\u6642\u671f\u9650\uff08\u76ee\u524d\u7232 10 \u5206\u9418\uff09\u5f8c\u6b63\u5e38\u6392\u7a7a\u7bc0\u9ede\uff0c\u5247\u7bc0\u9ede\u6703\u88ab\u5f37\u5236\u7d42\u6b62\u3002GKE \u96c6\u7fa3\u7121\u6cd5\u914d\u7f6e\u5bec\u9650\u671f\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u7e31\u5411\u7e2e\u5bb9\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u8acb\u53c3\u95b1 [\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6587\u6a94](https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#how-does-scale-down-work) \u3002\n\u5982\u679c\u60a8\u7684 Pod \u8acb\u6c42\u7684\u8cc7\u6e90\u592a\u5c11\uff08\u6216\u8005\u6c92\u6709\u66f4\u6539\u53ef\u80fd\u4e0d\u5920\u7684\u9ed8\u8a8d\u503c\uff09\uff0c\u4e26\u4e14\u7bc0\u9ede\u51fa\u73fe\u77ed\u7f3a\u60c5\u6cc1\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u4e0d\u6703\u7cfe\u6b63\u6b64\u60c5\u6cc1\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u7232\u6240\u6709\u5de5\u4f5c\u8ca0\u8f09\u767c\u51fa\u986f\u5f0f\u8cc7\u6e90\u8acb\u6c42\uff0c\u5e6b\u52a9\u78ba\u4fdd\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u5118\u53ef\u80fd\u6e96\u78ba\u5730\u5de5\u4f5c\u3002\n**\u6ce8\u610f** \uff1a\u8acb\u52ff\u7232\u96c6\u7fa3\u7bc0\u9ede\u5553\u7528 [\u91dd\u5c0d\u8a17\u7ba1\u5be6\u4f8b\u7d44\u7684 Compute Engine \u81ea\u52d5\u64f4\u7e2e\u529f\u80fd](https://cloud.google.com/compute/docs/autoscaler?hl=zh-cn) \u3002GKE \u7684\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7368\u7acb\u65bc Compute Engine \u81ea\u52d5\u64f4\u7e2e\u529f\u80fd\u3002\u9019\u53ef\u80fd\u5c0e\u81f4\u7bc0\u9ede\u6c60\u7121\u6cd5\u64f4\u7e2e\uff0c\u56e0\u7232 Compute Engine \u81ea\u52d5\u64f4\u7e2e\u5668\u5c07\u8207 GKE \u7684\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u885d\u7a81\u3002\n### \u64cd\u4f5c\u689d\u4ef6\n\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u5728\u8abf\u6574\u7bc0\u9ede\u6c60\u7684\u5927\u5c0f\u6642\u6703\u505a\u51fa\u4ee5\u4e0b\u5047\u8a2d\uff1a\n- \u6240\u6709\u8907\u88fd\u7684 Pod \u90fd\u53ef\u4ee5\u5728\u5176\u4ed6\u7bc0\u9ede\u4e0a\u91cd\u5553\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u77ed\u66ab\u7684\u4e2d\u65b7\u3002\u5982\u679c\u60a8\u7684\u670d\u52d9\u7121\u6cd5\u5bb9\u5fcd\u4e2d\u65b7\uff0c\u5247\u4e0d\u5efa\u8b70\u4f7f\u7528\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u3002\n- \u7528\u6236\u6216\u7ba1\u7406\u54e1\u4e0d\u6703\u4ee5\u624b\u52d5\u65b9\u5f0f\u7ba1\u7406\u7bc0\u9ede\uff1b\u56e0\u6b64\u64f4\u7e2e\u5668\u53ef\u4ee5\u66ff\u63db\u60a8\u57f7\u884c\u7684\u4efb\u4f55\u624b\u52d5\u7bc0\u9ede\u7ba1\u7406\u64cd\u4f5c\u3002\n- \u55ae\u500b\u7bc0\u9ede\u6c60\u4e2d\u7684\u6240\u6709\u7bc0\u9ede\u90fd\u5177\u6709\u4e00\u7d44\u76f8\u540c\u7684\u6a19\u7c64\u3002\n- \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u7a0b\u5e8f\u6703\u8003\u616e\u5404\u500b\u6c60\u4e2d\u5be6\u4f8b\u985e\u578b\u7684\u76f8\u5c0d\u8cbb\u7528\uff0c\u4e26\u5617\u8a66\u64f4\u5c55\u5118\u53ef\u80fd\u4fbf\u5b9c\u7684\u7bc0\u9ede\u6c60\u3002\u5305\u542b [Spot \u865b\u64ec\u6a5f](https://cloud.google.com/kubernetes-engine/docs/concepts/spot-vms?hl=zh-cn) \u7684\u7bc0\u9ede\u6c60\u6240\u7bc0\u7701\u7684\u8cbb\u7528\u5df2\u8003\u616e\u5728\u5167\u3002\n- \u5728\u8abf\u5ea6 Pod \u4e4b\u524d\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u8003\u616e init \u5bb9\u5668\u8acb\u6c42\u3002Init \u5bb9\u5668\u8acb\u6c42\u53ef\u4ee5\u4f7f\u7528\u7bc0\u9ede\u4e0a\u53ef\u7528\u7684\u4efb\u4f55\u672a\u5206\u914d\u8cc7\u6e90\uff0c\u9019\u53ef\u80fd\u6703\u963b\u6b62 Pod \u8abf\u5ea6\u3002\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u9075\u5faa\u7684\u8acb\u6c42\u8a08\u7b97\u898f\u5247\u8207 Kubernetes \u4f7f\u7528\u7684\u898f\u5247\u76f8\u540c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 init \u5bb9\u5668](https://kubernetes.io/docs/concepts/workloads/pods/init-containers/#resources) \u3002\n- \u672a\u8ddf\u8e64\u521d\u59cb\u96c6\u7fa3\u6216\u7bc0\u9ede\u6c60\u5275\u5efa\u5f8c\u624b\u52d5\u6dfb\u52a0\u7684\u6a19\u7c64\u3002\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u7a0b\u5e8f\u5275\u5efa\u7684\u7bc0\u9ede\u5728\u5275\u5efa\u7bc0\u9ede\u6c60\u6642\u5206\u914d\u6709\u4f7f\u7528`--node-labels`\u6307\u5b9a\u7684\u6a19\u7c64\u3002\n- \u5728 GKE 1.21 \u7248\u6216\u66f4\u65e9\u7248\u672c\u4e2d\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u8003\u616e\u4f7f\u7528\u7bc0\u9ede\u6c60\u4e2d\u73fe\u6709\u7bc0\u9ede\u7684\u6c61\u9ede\u4fe1\u606f\u4f86\u8868\u793a\u6574\u500b\u7bc0\u9ede\u6c60\u3002\u5f9e GKE 1.22 \u7248\u958b\u59cb\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u5c07\u96c6\u7fa3\u548c\u7bc0\u9ede\u6c60\u4e2d\u73fe\u6709\u7bc0\u9ede\u7684\u4fe1\u606f\u7d44\u5408\u5728\u4e00\u8d77\u3002\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u6aa2\u6e2c\u624b\u52d5\u7bc0\u9ede\u66f4\u6539\u548c\u7bc0\u9ede\u6c60\u66f4\u6539\uff0c\u4ee5\u9032\u884c\u64f4\u5bb9\u3002\n### \u8de8\u5730\u5340\u4fdd\u6301\u5e73\u8861\n\u5982\u679c\u60a8\u7684\u7bc0\u9ede\u6c60\u5305\u542b\u5177\u6709\u76f8\u540c\u5be6\u4f8b\u985e\u578b\u7684\u591a\u500b\u4ee3\u7ba1\u5f0f\u5be6\u4f8b\u7d44\uff0c\u5247\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u5617\u8a66\u5728\u64f4\u5bb9\u6642 \u4fdd\u6301\u9019\u4e9b\u4ee3\u7ba1\u5f0f\u5be6\u4f8b\u7d44\u7684\u5927\u5c0f\u5e73\u8861\u3002\u9019\u6709\u52a9\u65bc\u9632\u6b62\u7bc0\u9ede\u5728\u7bc0\u9ede\u6c60\u591a\u500b\u53ef\u7528\u5340\u7684\u4ee3\u7ba1\u5f0f\u5be6\u4f8b\u7d44\u4e2d\u5206\u4f48\u4e0d\u5747\u52fb\u3002GKE \u5728\u7e2e\u5bb9\u6642\u4e0d\u6703\u8003\u616e\u81ea\u52d5\u64f4\u7e2e\u653f\u7b56\u3002\n**\u6ce8\u610f** \uff1a\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u7a0b\u5e8f\u5728\u7e31\u5411\u64f4\u5bb9\u4e8b\u4ef6\u671f\u9593\u50c5\u8de8\u5730\u5340\u9032\u884c\u5e73\u8861\u3002\u7121\u8ad6\u7bc0\u9ede\u6c60\u4e2d\u5e95\u5c64\u8a17\u7ba1\u5be6\u4f8b\u7d44\u7684\u76f8\u5c0d\u5927\u5c0f\u5982\u4f55\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u7a0b\u5e8f\u90fd\u6703\u7e2e\u6e1b\u672a\u5145\u5206\u5229\u7528\u7684\u7bc0\u9ede\uff0c\u9019\u53ef\u80fd\u5c0e\u81f4\u7bc0\u9ede\u5728\u5404\u5730\u5340\u5206\u4f48\u4e0d\u5747\u52fb\u3002\n\u5f9e GKE 1.24.1-gke.800 \u7248\u958b\u59cb\uff0c\u60a8\u53ef\u4ee5\u66f4\u6539 GKE \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7684\u4f4d\u7f6e\u653f\u7b56\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u4f7f\u7528\u4ee5\u4e0b\u4efb\u4f55\u503c\u6307\u5b9a `location_policy` \u6a19\u8a8c\u4f86\u63a7\u5236\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7684\u5206\u4f48\u653f\u7b56\uff1a\n- `BALANCED`\uff1a\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u8003\u616e Pod \u8981\u6c42\u4ee5\u53ca\u6bcf\u500b\u53ef\u7528\u5340\u7684\u8cc7\u6e90\u53ef\u7528\u6027\u3002\u9019\u4e0d\u4fdd\u8b49\u985e\u4f3c\u7684\u7bc0\u9ede\u7d44\u5177\u6709\u5b8c\u5168\u76f8\u540c\u7684\u5927\u5c0f\uff0c\u56e0\u7232\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u8003\u616e\u8a31\u591a\u56e0\u7d20\uff0c\u5305\u62ec\u7d66\u5b9a\u53ef\u7528\u5340\u7684\u53ef\u7528\u5bb9\u91cf\u4ee5\u53ca\u89f8\u767c\u64f4\u5bb9\u7684 Pod \u7684\u53ef\u7528\u5340\u89aa\u548c\u6027\u3002\n- `ANY`\uff1a\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u512a\u5148\u5229\u7528\u672a\u4f7f\u7528\u7684\u9810\u7559\u4e26\u8003\u616e\u53ef\u7528\u8cc7\u6e90\u7684\u7576\u524d\u9650\u5236\u689d\u4ef6\u3002 \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Spot \u865b\u64ec\u6a5f\uff0c\u6216\u8005\u60f3\u8981\u4f7f\u7528\u53ef\u7528\u5340\u4e4b\u9593\u4e0d\u76f8\u7b49\u7684\u865b\u64ec\u6a5f\u9810\u7559\uff0c\u5247\u5efa\u8b70\u4f7f\u7528\u6b64\u653f\u7b56\u3002\u5f9e GKE 1.27 \u7248\u958b\u59cb\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u5728\u9032\u884c\u7e31\u5411\u64f4\u5bb9\u6c7a\u7b56\u6642\u59cb\u7d42\u6703\u8003\u616e [\u9810\u7559](https://cloud.google.com/compute/docs/instances/reservations-overview?hl=zh-cn) \u3002\u5728\u9078\u64c7\u7e31\u5411\u64f4\u5bb9\u7684\u7bc0\u9ede\u6c60\u6642\uff0c\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u512a\u5148\u9078\u64c7\u5177\u6709\u5339\u914d\u7684\u672a\u4f7f\u7528\u9810\u7559\u7684\u7bc0\u9ede\u6c60\uff0c\u5373\u4f7f\u8a72\u7bc0\u9ede\u6c60\u4e0d\u662f\u6700\u9ad8\u6548\u7684\u7bc0\u9ede\u6c60\u4e5f\u662f\u5982\u6b64\u3002\u6b64\u5916\uff0c\u5728\u5c0d\u591a\u53ef\u7528\u5340\u7e31\u5411\u64f4\u5bb9\u9032\u884c\u8ca0\u8f09\u5747\u8861\u6642\uff0c\u59cb\u7d42\u512a\u5148\u4f7f\u7528\u672a\u4f7f\u7528\u7684\u9810\u7559\u3002\n\u5c0d\u65bc [Spot \u865b\u64ec\u6a5f](https://cloud.google.com/kubernetes-engine/docs/concepts/spot-vms?hl=zh-cn) \u7bc0\u9ede\u6c60\uff0c\u9ed8\u8a8d\u7684\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u5206\u4f48\u653f\u7b56\u7232 `ANY` \u3002\u5728\u6b64\u653f\u7b56\u4e2d\uff0cSpot \u865b\u64ec\u6a5f\u88ab\u6436\u4f54\u7684\u98a8\u96aa\u8f03\u4f4e\u3002\n\u5c0d\u65bc\u975e\u6436\u4f54\u5f0f [\u7bc0\u9ede\u6c60](https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools?hl=zh-cn) \uff0c\u9ed8\u8a8d\u7684\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u5206\u4f48\u653f\u7b56\u7232 `BALANCED` \u3002\n### \u6700\u5c0f\u548c\u6700\u5927\u7bc0\u9ede\u6c60\u5927\u5c0f\n\u5275\u5efa\u65b0\u7684\u7bc0\u9ede\u6c60\u6642\uff0c\u60a8\u53ef\u4ee5\u7232\u96c6\u7fa3\u4e2d\u7684\u6bcf\u500b\u7bc0\u9ede\u6c60\u6307\u5b9a\u6700\u5c0f\u548c\u6700\u5927\u5927\u5c0f\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u5728\u9019\u4e9b\u64f4\u7e2e\u9650\u5236\u7bc4\u570d\u5167\u505a\u51fa\u91cd\u65b0\u64f4\u7e2e\u6c7a\u7b56\u3002\u5982\u9700\u66f4\u65b0\u6700\u5c0f\u5927\u5c0f\uff0c\u8acb\u5728\u6307\u5b9a\u65b0\u7684\u6700\u5c0f\u503c\u5f8c\uff0c\u624b\u52d5\u5c07\u96c6\u7fa3\u5927\u5c0f\u8abf\u6574\u7232\u65b0\u7684\u9650\u5236\u7bc4\u570d\u5167\u7684\u5927\u5c0f\u3002\u7136\u5f8c\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u6839\u64da\u65b0\u7684\u9650\u5236\u689d\u4ef6\u505a\u51fa\u91cd\u65b0\u64f4\u7e2e\u6c7a\u7b56\u3002\n| \u7576\u524d\u7bc0\u9ede\u6c60\u5927\u5c0f    | \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u64cd\u4f5c            | \u64f4\u7e2e\u9650\u5236\u689d\u4ef6       |\n|:---------------------------|:-----------------------------------------------------------------|:-------------------------------------|\n| \u4f4e\u65bc\u60a8\u6307\u5b9a\u7684\u6700\u5c0f\u503c   | \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u7e31\u5411\u64f4\u5bb9\u4ee5\u9810\u914d\u5f85\u8655\u7406\u7684 Pod\u3002\u7e31\u5411\u7e2e\u5bb9\u529f\u80fd\u5df2\u505c\u7528\u3002 | \u7bc0\u9ede\u6c60\u4e0d\u6703\u7e31\u5411\u7e2e\u5bb9\u5230\u4f4e\u65bc\u60a8\u6307\u5b9a\u7684\u503c\u3002 |\n| \u5728\u60a8\u6307\u5b9a\u7684\u5927\u5c0f\u4e0b\u9650\u548c\u4e0a\u9650\u5167 | \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u53ef\u6839\u64da\u9700\u6c42\u9032\u884c\u7e31\u5411\u64f4\u5bb9\u6216\u7e31\u5411\u7e2e\u5bb9\u3002     | \u7bc0\u9ede\u6c60\u6703\u4fdd\u6301\u5728\u60a8\u6307\u5b9a\u7684\u5927\u5c0f\u9650\u5236\u5167\u3002 |\n| \u5927\u65bc\u60a8\u6307\u5b9a\u7684\u4e0a\u9650   | \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u50c5\u7e31\u5411\u7e2e\u5bb9\u53ef\u4ee5\u5b89\u5168\u79fb\u9664\u7684\u7bc0\u9ede\u3002\u7e31\u5411\u64f4\u5bb9\u529f\u80fd\u5df2\u505c\u7528\u3002 | \u7bc0\u9ede\u6c60\u4e0d\u6703\u64f4\u5bb9\u5230\u8d85\u904e\u60a8\u6307\u5b9a\u7684\u503c\u3002  |\n\u5728 Standard \u96c6\u7fa3\u4e0a\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7d55\u4e0d\u6703\u5c07\u96c6\u7fa3\u81ea\u52d5\u7e2e\u5bb9\u81f3\u96f6\u500b\u7bc0\u9ede\u3002 \u96c6\u7fa3\u4e2d\u5fc5\u9808\u59cb\u7d42\u6709\u4e00\u500b\u6216\u591a\u500b\u7bc0\u9ede\u4f86\u904b\u884c\u7cfb\u7d71 Pod\u3002\u6b64\u5916\uff0c\u5982\u679c\u7531\u65bc\u624b\u52d5\u79fb\u9664\u7bc0\u9ede\u800c\u5c0e\u81f4\u7576\u524d\u7bc0\u9ede\u6578\u7232\u96f6\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u548c\u7bc0\u9ede\u81ea\u52d5\u9810\u914d\u529f\u80fd\u53ef\u4ee5\u5f9e\u96f6\u7bc0\u9ede\u96c6\u7fa3\u9032\u884c\u64f4\u5bb9\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u81ea\u52d5\u64f4\u7e2e\u5668\u6c7a\u7b56\uff0c\u8acb\u53c3\u95b1 [\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u9650\u5236](#limitations) \u3002\n### \u81ea\u52d5\u64f4\u7e2e\u9650\u5236\n\u60a8\u53ef\u4ee5\u8a2d\u7f6e\u5728\u64f4\u7e2e\u7bc0\u9ede\u6c60\u6642\u8981\u4f7f\u7528\u7684\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7684\u6700\u5c0f\u548c\u6700\u5927\u7bc0\u9ede\u6578\u3002\u4f7f\u7528 `--min-nodes` \u548c `--max-nodes` \u6a19\u8a8c\u8a2d\u7f6e\u6bcf\u500b\u53ef\u7528\u5340\u7684\u7bc0\u9ede\u6578\u4e0b\u9650\u548c\u4e0a\u9650\n\u5f9e GKE 1.24 \u7248\u958b\u59cb\uff0c\u60a8\u53ef\u4ee5\u5c0d\u65b0\u96c6\u7fa3\u4f7f\u7528 `--total-min-nodes` \u548c `--total-max-nodes` \u6a19\u8a8c\u3002\u9019\u4e9b\u6a19\u8a8c\u8a2d\u7f6e\u6240\u6709\u53ef\u7528\u5340\u4e2d\u7bc0\u9ede\u6c60\u5167\u7bc0\u9ede\u7e3d\u6578\u7684\u4e0b\u9650\u548c\u4e0a\u9650\u3002\n**\u7bc0\u9ede\u6578\u4e0b\u9650\u548c\u4e0a\u9650\u793a\u4f8b**\n\u4ee5\u4e0b\u547d\u4ee4\u6703\u5275\u5efa\u4e00\u500b\u81ea\u52d5\u64f4\u7e2e\u7684 [\u591a\u53ef\u7528\u5340\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters?hl=zh-cn#multi-zonal_clusters) \uff0c\u8a72\u96c6\u7fa3\u6700\u521d\u5728 3 \u500b\u53ef\u7528\u5340\u4e2d\u6709 6 \u500b\u7bc0\u9ede\uff0c\u6bcf\u500b\u53ef\u7528\u5340\u81f3\u5c11\u6709 1 \u500b\u7bc0\u9ede\uff0c\u6700\u591a\u6709 4 \u500b\u7bc0\u9ede\uff1a\n```\ngcloud container clusters create example-cluster \\\n --num-nodes=2 \\\n --zone=us-central1-a \\\n --node-locations=us-central1-a,us-central1-b,us-central1-f \\\n --enable-autoscaling --min-nodes=1 --max-nodes=4\n```\n\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u96c6\u7fa3\u7684\u7e3d\u5927\u5c0f\u53ef\u4ee5\u4ecb\u65bc 3 \u5230 12 \u500b\u7bc0\u9ede\u4e4b\u9593\uff0c\u9019\u4e9b\u7bc0\u9ede\u5206\u4f48\u5728\u4e09\u500b\u53ef\u7528\u5340\u3002\u5982\u679c\u5176\u4e2d\u67d0\u500b\u53ef\u7528\u5340\u51fa\u73fe\u6545\u969c\uff0c\u5247\u96c6\u7fa3\u7684\u7e3d\u5927\u5c0f\u53ef\u80fd\u4ecb\u65bc 2 \u5230 8 \u500b\u7bc0\u9ede\u4e4b\u9593\u3002\n**\u7bc0\u9ede\u7e3d\u6578\u793a\u4f8b**\n\u4ee5\u4e0b\u547d\u4ee4\uff08\u5728 GKE 1.24 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u4e2d\u63d0\u4f9b\uff09\u6703\u5275\u5efa\u4e00\u500b\u81ea\u52d5\u64f4\u7e2e\u7684 [\u591a\u53ef\u7528\u5340\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters?hl=zh-cn#multi-zonal_clusters) \uff0c\u8a72\u96c6\u7fa3\u6700\u521d\u5728 3 \u500b\u53ef\u7528\u5340\u4e2d\u6709 6 \u500b\u7bc0\u9ede\uff0c\u6240\u6709\u53ef\u7528\u5340\u4e2d\u7bc0\u9ede\u6c60\u5167\u7684\u7bc0\u9ede\u7e3d\u6578\u4e0d\u5f97\u5c0f\u65bc 3 \u548c\u5927\u65bc 12\uff1a\n```\ngcloud container clusters create example-cluster \\\n --num-nodes=2 \\\n --zone=us-central1-a \\\n --node-locations=us-central1-a,us-central1-b,us-central1-f \\\n --enable-autoscaling --total-min-nodes=3 --total-max-nodes=12\n```\n\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u96c6\u7fa3\u7684\u7e3d\u5927\u5c0f\u4ecb\u65bc 3 \u5230 12 \u500b\u7bc0\u9ede\u4e4b\u9593\uff0c\u7121\u8ad6\u9019\u4e9b\u7bc0\u9ede\u5728\u5404\u500b\u53ef\u7528\u5340\u4e4b\u9593\u7684\u5206\u4f48\u5982\u4f55\u3002\n### \u81ea\u52d5\u64f4\u7e2e\u914d\u7f6e\u6587\u4ef6\n\u6c7a\u5b9a\u4f55\u6642\u79fb\u9664\u7bc0\u9ede\u6642\uff0c\u9700\u8981\u5728\u63d0\u9ad8\u8cc7\u6e90\u5229\u7528\u7387\u6216\u53ef\u7528\u6027\u4e4b\u9593\u9032\u884c\u6b0a\u8861\u53d6\u6368\u3002\u79fb\u9664\u4f7f\u7528\u7387\u904e\u4f4e\u7684\u7bc0\u9ede\u53ef\u4ee5\u63d0\u9ad8\u96c6\u7fa3\u5229\u7528\u7387\uff0c\u4f46\u65b0\u7684\u5de5\u4f5c\u8ca0\u8f09\u53ef\u80fd\u9700\u8981\u7b49\u5f85\u91cd\u65b0\u9810\u914d\u8cc7\u6e90\u624d\u80fd\u904b\u884c\u3002\n\u60a8\u53ef\u4ee5\u6307\u5b9a\u5728\u505a\u51fa\u6b64\u985e\u6c7a\u5b9a\u6642\u4f7f\u7528\u54ea\u7a2e\u81ea\u52d5\u64f4\u7e2e\u914d\u7f6e\u6587\u4ef6\u3002 \u53ef\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u5305\u62ec\uff1a\n- `balanced`\uff1aStandard \u96c6\u7fa3\u7684\u9ed8\u8a8d\u914d\u7f6e\u6587\u4ef6\u3002`balanced`\u914d\u7f6e\u6587\u4ef6\u4e0d\u9069\u7528\u65bc Autopilot \u96c6\u7fa3\u3002\n- `optimize-utilization`\uff1a\u512a\u5148\u63d0\u9ad8\u5229\u7528\u7387\uff0c\u800c\u975e\u5728\u96c6\u7fa3\u4e2d\u4fdd\u7559\u7a7a\u9592\u8cc7\u6e90\u3002\u5553\u7528\u6b64\u914d\u7f6e\u6587\u4ef6\u5f8c\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u66f4\u4e3b\u52d5\u5730\u7e2e\u6e1b\u96c6\u7fa3\u3002GKE \u53ef\u4ee5\u79fb\u9664\u66f4\u591a\u7bc0\u9ede\uff0c\u4e26\u66f4\u5feb\u5730\u79fb\u9664\u7bc0\u9ede\u3002GKE \u9996\u9078\u5728\u5df2\u5177\u6709\u9ad8 CPU\u3001\u5167\u5b58\u6216 GPU \u5206\u914d\u7684\u7bc0\u9ede\u4e2d\u8abf\u5ea6 Pod\u3002\u7136\u800c\uff0c\u5176\u4ed6\u56e0\u7d20\u4e5f\u6703 [\u5f71\u97ff\u8abf\u5ea6](https://kubernetes.io/docs/reference/scheduling/config/#scheduling-plugins) \uff0c\u4f8b\u5982\u5c6c\u65bc\u540c\u4e00 Deployment\u3001StatefulSet \u6216 Service \u7684 Pod \u8de8\u7bc0\u9ede\u5206\u4f48\u3002\n`optimize-utilization` \u81ea\u52d5\u64f4\u7e2e\u914d\u7f6e\u6587\u4ef6\u53ef\u5e6b\u52a9\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u8b58\u5225\u548c\u79fb\u9664\u672a\u5145\u5206\u5229\u7528\u7684\u7bc0\u9ede\u3002\u7232\u4e86\u5be6\u73fe\u6b64\u512a\u5316\uff0cGKE \u5c07 Pod \u898f\u7bc4\u4e2d\u7684\u8abf\u5ea6\u7a0b\u5e8f\u540d\u7a31\u8a2d\u7f6e\u7232 `gke.io/optimize-utilization-scheduler` \u3002\u6307\u5b9a\u81ea\u5b9a\u7fa9\u8abf\u5ea6\u7a0b\u5e8f\u7684 Pod \u4e0d\u53d7\u5f71\u97ff\u3002\n\u4ee5\u4e0b\u547d\u4ee4\u53ef\u5728\u73fe\u6709\u96c6\u7fa3\u4e2d\u5553\u7528 `optimize-utilization` \u81ea\u52d5\u64f4\u7e2e\u914d\u7f6e\u6587\u4ef6\uff1a\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --autoscaling-profile optimize-utilization\n```\n### \u8003\u616e Pod \u5b89\u6392\u548c\u4e2d\u65b7\n\u9032\u884c\u7e2e\u6e1b\u6642\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u9075\u5faa\u5c0d Pod \u8a2d\u7f6e\u7684\u5b89\u6392\u548c\u522a\u9664\u898f\u5247\u3002\u9019\u4e9b\u9650\u5236\u53ef\u4ee5\u9632\u6b62\u81ea\u52d5\u64f4\u7e2e\u5668\u522a\u9664\u7bc0\u9ede\u3002\u5982\u679c\u7bc0\u9ede\u5305\u542b\u6eff\u8db3\u4ee5\u4e0b\u4efb\u610f\u689d\u4ef6\u7684 Pod\uff0c\u5247\u53ef\u4ee5\u963b\u6b62\u522a\u9664\u8a72\u7bc0\u9ede\uff1a\n- Pod \u7684 [\u76f8\u4f3c\u6027\u6216\u53cd\u76f8\u4f3c\u6027](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity) \u898f\u5247\u963b\u6b62\u91cd\u65b0\u5b89\u6392\u3002\n- Pod \u4e0d\u53d7 [\u63a7\u5236\u5668](https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/#pods-and-controllers) \uff08\u5982 Deployment\u3001StatefulSet\u3001Job \u6216 ReplicaSet\uff09\u7ba1\u7406\u3002\n- Pod \u5177\u6709\u672c\u5730\u5b58\u5132\u7a7a\u9593\uff0cGKE \u63a7\u5236\u5e73\u9762\u7248\u672c\u4f4e\u65bc 1.22\u3002\u5728\u5177\u6709\u63a7\u5236\u5e73\u9762\u7248\u672c 1.22 \u6216\u66f4\u9ad8\u7248\u672c\u7684 GKE \u96c6\u7fa3\u4e2d\uff0c\u5177\u6709\u672c\u5730\u5b58\u5132\u7a7a\u9593\u7684 Pod \u4e0d\u518d\u963b\u6b62\u7e2e\u5bb9\u3002\n- \u8a72 Pod \u5177\u6709`\"cluster-autoscaler.kubernetes.io/safe-to-evict\": \"false\"`\u8a3b\u89e3\u3002\n- \u7bc0\u9ede\u7684\u522a\u9664\u5c07\u8d85\u51fa\u914d\u7f6e\u7684 [PodDisruptionBudget](https://kubernetes.io/docs/concepts/workloads/pods/disruptions/#how-disruption-budgets-work) \u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u4ee5\u53ca\u5982\u4f55\u9632\u6b62\u4e2d\u65b7\uff0c\u8acb\u53c3\u95b1 [\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u5e38\u898b\u554f\u984c\u89e3\u7b54](https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md) \u4e2d\u7684\u4ee5\u4e0b\u554f\u984c\uff1a\n- [\u7e2e\u6e1b\u7684\u5de5\u4f5c\u539f\u7406\u662f\u4ec0\u9ebc\uff1f](https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#how-does-scale-down-work) \n- [\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u662f\u5426\u53ef\u4ee5\u5728\u7e2e\u6e1b\u6642\u4f7f\u7528 PodDisruptionBudget\uff1f](https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#does-ca-work-with-poddisruptionbudget-in-scale-down) \n- [\u54ea\u4e9b\u985e\u578b\u7684 Pod \u53ef\u4ee5\u963b\u6b62\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u79fb\u9664\u7bc0\u9ede\uff1f](https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#what-types-of-pods-can-prevent-ca-from-removing-a-node) \n### \u5728 GKE \u4e2d\u81ea\u52d5\u64f4\u7e2e TPU\nGKE \u652f\u6301\u5f35\u91cf\u8655\u7406\u55ae\u5143 (TPU) \u4f86\u52a0\u901f\u6a5f\u5668\u5b78\u7fd2\u5de5\u4f5c\u8ca0\u8f09\u3002 [\u55ae\u4e3b\u6a5f TPU \u5207\u7247\u7bc0\u9ede\u6c60](https://cloud.google.com/kubernetes-engine/docs/concepts/tpus?hl=zh-cn#node_pool) \u548c [\u591a\u4e3b\u6a5f TPU \u5207\u7247\u7bc0\u9ede\u6c60](https://cloud.google.com/kubernetes-engine/docs/concepts/tpus?hl=zh-cn#node_pool) \u90fd\u652f\u6301\u81ea\u52d5\u64f4\u7e2e\u548c\u81ea\u52d5\u9810\u914d\u3002\n\u901a\u904e\u5728 GKE \u96c6\u7fa3\u4e0a\u4f7f\u7528 [--enable-autoprovisioning](https://cloud.google.com/sdk/gcloud/reference/container/clusters/update?hl=zh-cn#--enable-autoprovisioning) \u6a19\u8a8c\uff0cGKE \u53ef\u4ee5\u5275\u5efa\u6216\u522a\u9664\u5177\u6709 TPU \u7248\u672c\u548c\u62d3\u64b2\u7684\u55ae\u4e3b\u6a5f\u6216\u591a\u4e3b\u6a5f TPU \u5207\u7247\u7bc0\u9ede\u6c60\uff0c\u4ee5\u6eff\u8db3\u5f85\u8655\u7406\u5de5\u4f5c\u8ca0\u8f09\u7684\u8981\u6c42\u3002\n\u4f7f\u7528 [--enable-autoscaling](https://cloud.google.com/sdk/gcloud/reference/container/node-pools/create?hl=zh-cn#--enable-autoscaling) \u6642\uff0cGKE \u6703\u6839\u64da\u7bc0\u9ede\u6c60\u7684\u985e\u578b\u64f4\u7e2e\u7bc0\u9ede\u6c60\uff0c\u5982\u4e0b\u6240\u793a\uff1a\n- \u55ae\u4e3b\u6a5f TPU \u5207\u7247\u7bc0\u9ede\u6c60\uff1aGKE \u6703\u5728\u73fe\u6709\u7bc0\u9ede\u6c60\u4e2d\u6dfb\u52a0\u6216\u79fb\u9664 TPU \u7bc0\u9ede\u3002\u7bc0\u9ede\u6c60\u53ef\u4ee5\u5305\u542b\u96f6\u5230\u7bc0\u9ede\u6c60\u6700\u5927\u5927\u5c0f\uff08\u7531 [--max-nodes](https://cloud.google.com/sdk/gcloud/reference/container/node-pools/create?hl=zh-cn#--max-nodes) \u548c [--total-max-nodes](https://cloud.google.com/sdk/gcloud/reference/container/node-pools/create?hl=zh-cn#--total-max-nodes) \u6a19\u8a8c\u78ba\u5b9a\uff09\u4e4b\u9593\u7684\u4efb\u610f\u6578\u91cf\u7684 TPU \u7bc0\u9ede\u3002\u7576\u7bc0\u9ede\u6c60\u64f4\u7e2e\u6642\uff0c\u7bc0\u9ede\u6c60\u4e2d\u7684\u6240\u6709 TPU \u7bc0\u9ede\u5177\u6709\u76f8\u540c\u7684\u6a5f\u5668\u985e\u578b\u548c\u62d3\u64b2\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5275\u5efa\u55ae\u4e3b\u6a5f TPU \u5207\u7247\u7bc0\u9ede\u6c60\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u7bc0\u9ede\u6c60](https://cloud.google.com/kubernetes-engine/docs/how-to/tpus?hl=zh-cn#single-host) \u3002\n- \u591a\u4e3b\u6a5f TPU \u5207\u7247\u7bc0\u9ede\u6c60\uff1aGKE \u4ee5\u539f\u5b50\u65b9\u5f0f\u5c07\u7bc0\u9ede\u6c60\u5f9e\u96f6\u64f4\u5bb9\u5230\u6eff\u8db3 TPU \u62d3\u64b2\u6240\u9700\u7684\u7bc0\u9ede\u6578\u3002\u4f8b\u5982\uff0c\u5c0d\u65bc\u6a5f\u5668\u985e\u578b\u7232 `ct5lp-hightpu-4t` \u4e14\u62d3\u64b2\u7232 `16x16` \u7684 TPU \u7bc0\u9ede\u6c60\uff0c\u7bc0\u9ede\u6c60\u5305\u542b 64 \u500b\u7bc0\u9ede\u3002GKE \u81ea\u52d5\u64f4\u7e2e\u5668\u53ef\u78ba\u4fdd\u6b64\u7bc0\u9ede\u6c60\u6b63\u597d\u5305\u542b 0 \u500b\u6216 64 \u500b\u7bc0\u9ede\u3002\u7e2e\u5bb9\u6642\uff0cGKE \u6703\u9010\u51fa\u6240\u6709\u8abf\u5ea6\u7684 Pod\uff0c\u4e26\u5c07\u6574\u500b\u7bc0\u9ede\u6c60\u6392\u7a7a\u7232\u96f6\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5275\u5efa\u591a\u4e3b\u6a5f TPU \u5207\u7247\u7bc0\u9ede\u6c60\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u7bc0\u9ede\u6c60](https://cloud.google.com/kubernetes-engine/docs/how-to/tpus?hl=zh-cn#multi-host) \u3002\n### \u66f4\u591a\u4fe1\u606f\n\u60a8\u53ef\u4ee5\u5728 [\u958b\u653e\u6e90\u4ee3\u78bc Kubernetes \u9805\u76ee\u4e2d\u7684\u81ea\u52d5\u64f4\u7e2e\u5e38\u898b\u554f\u984c\u89e3\u7b54](https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md) \u4e2d\u8a73\u7d30\u77ad\u89e3\u96c6\u7fa3\u81ea\u52d5\u8abf\u7bc0\u7a0b\u5e8f\u3002\n## \u9650\u5236\n\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u5177\u6709\u4ee5\u4e0b\u9650\u5236\uff1a\n- \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u76ee\u524d\u4e0d\u652f\u6301 [\u672c\u5730 PersistentVolume](https://cloud.google.com/kubernetes-engine/docs/how-to/persistent-volumes/local-ssd?hl=zh-cn) \u3002\n- \u5728 1.24.5-gke.600 \u4e4b\u524d\u7684 GKE \u63a7\u5236\u5e73\u9762\u7248\u672c\u4e2d\uff0c\u7576 pod \u8acb\u6c42\u81e8\u6642\u5b58\u5132\u6642\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u4e0d\u652f\u6301\u5c0d\u4f7f\u7528 [\u672c\u5730 SSD \u4f5c\u7232\u81e8\u6642\u5b58\u5132](https://cloud.google.com/kubernetes-engine/docs/how-to/persistent-volumes/local-ssd?hl=zh-cn#creating_a_node_pool_using_ephemeral_storage_on_local_ssds) \u7684\u7bc0\u9ede\u7232\u96f6\u7684\u7bc0\u9ede\u6c60\u9032\u884c\u7e31\u5411\u64f4\u5bb9\u3002\n- \u96c6\u7fa3\u5927\u5c0f\u9650\u5236\uff1a\u6700\u591a 15,000 \u500b\u7bc0\u9ede\u3002\u904b\u884c\u6b64\u898f\u6a21\u7684\u96c6\u7fa3\u6642\uff0c\u8acb\u8003\u616e\u5176\u4ed6 [\u96c6\u7fa3\u9650\u5236](https://cloud.google.com/kubernetes-engine/quotas?hl=zh-cn#limits_per_cluster) \u548c\u6211\u5011\u7684 [\u6700\u4f73\u505a\u6cd5](https://cloud.google.com/kubernetes-engine/docs/best-practices/scalability?hl=zh-cn) \u3002\n- \u9032\u884c\u7e2e\u6e1b\u6642\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u4fdd\u7559 10 \u5206\u9418\u7684\u6b63\u5e38\u7d42\u6b62\u6642\u9593\u6bb5\uff0c\u4ee5\u4fbf\u5c07\u7bc0\u9ede\u7684 Pod \u91cd\u65b0\u8abf\u5ea6\u5230\u5176\u4ed6\u7bc0\u9ede\u4e0a\uff0c\u7136\u5f8c\u518d\u5f37\u5236\u7d42\u6b62\u8a72\u7bc0\u9ede\u3002\n- \u6709\u6642\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u7121\u6cd5\u5b8c\u5168\u7e2e\u6e1b\uff0c\u7e2e\u6e1b\u5f8c\u9084\u6703\u6709\u984d\u5916\u7bc0\u9ede\u5b58\u5728\u3002\u7576\u6240\u9700\u7684\u7cfb\u7d71 Pod \u88ab\u5b89\u6392\u5230\u5176\u4ed6\u7bc0\u9ede\u4e0a\u6642\u6703\u767c\u751f\u9019\u7a2e\u60c5\u6cc1\uff0c\u56e0\u7232\u6c92\u6709\u4efb\u4f55\u89f8\u767c\u5668\u9069\u7528\u65bc\u4efb\u4f55\u9019\u4e9b\u79fb\u52d5\u5230\u5176\u4ed6\u7bc0\u9ede\u7684 Pod\u3002\u8acb\u53c3\u95b1 [\u6211\u6709\u4e00\u4e9b\u5229\u7528\u7387\u8f03\u4f4e\u7684\u7bc0\u9ede\uff0c\u4f46\u5b83\u5011\u6c92\u6709\u88ab\u7e2e\u6e1b\u3002\u7232\u4ec0\u9ebc\uff1f](https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#i-have-a-couple-of-nodes-with-low-utilization-but-they-are-not-scaled-down-why) \u3002 \u8981\u89e3\u6c7a\u6b64\u9650\u5236\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e [Pod \u4e2d\u65b7\u9810\u7b97](https://kubernetes.io/docs/concepts/workloads/pods/disruptions/) \u3002\n- \u4e0d\u652f\u6301\u4f7f\u7528\u66f4\u6539\u7684 [\u904e\u6ffe\u689d\u4ef6](https://kubernetes.io/docs/concepts/scheduling-eviction/scheduling-framework/#filter) \u9032\u884c\u7684\u81ea\u5b9a\u7fa9\u8abf\u5ea6\u3002\n- \u5982\u679c Pod \u7684 [PriorityClass](https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass) \u503c\u4f4e\u65bc`-10`\uff0c\u5247\u7bc0\u9ede\u4e0d\u6703\u7e31\u5411\u64f4\u5bb9\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u5982\u4f55\u4f7f\u7528 Pod \u512a\u5148\u7d1a\u548c\u6436\u4f54\uff1f](https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#how-does-cluster-autoscaler-work-with-pod-priority-and-preemption) \n- \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u53ef\u80fd\u6c92\u6709\u8db3\u5920\u7684\u672a\u5206\u914d IP \u5730\u5740\u7a7a\u9593\u4f86\u7528\u65bc\u6dfb\u52a0\u65b0\u7bc0\u9ede\u6216 Pod\uff0c\u5f9e\u800c\u5c0e\u81f4\u7e31\u5411\u64f4\u5bb9\u5931\u6557\uff08\u7531 [eventResult \u4e8b\u4ef6](https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-autoscaler-visibility?hl=zh-cn#eventresult-event) \u6307\u793a\uff0c\u5176\u539f\u56e0\u7232`scale.up.error.ip.space.exhausted`\uff09\u3002\u60a8\u53ef\u4ee5\u901a\u904e [\u64f4\u5c55\u4e3b\u8981\u5b50\u7db2](https://cloud.google.com/vpc/docs/create-modify-vpc-networks?hl=zh-cn#expand-subnet) \u7232\u7bc0\u9ede\u6dfb\u52a0\u66f4\u591a IP \u5730\u5740\uff0c\u6216\u4f7f\u7528 [\u4e0d\u9023\u7e8c\u7684\u591a Pod CIDR](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-pod-cidr?hl=zh-cn) \u7232 Pod \u6dfb\u52a0\u65b0\u7684 IP \u5730\u5740\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Pod \u6c92\u6709\u8db3\u5920\u7684\u53ef\u7528 IP \u5730\u5740\u7a7a\u9593](https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=zh-cn#not_enough_space) \u3002## \u5df2\u77e5\u554f\u984c\n- \u5728 1.22 \u4e4b\u524d\u7684 GKE \u63a7\u5236\u5e73\u9762\u7248\u672c\u4e2d\uff0cGKE \u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u6703\u505c\u6b62\u5c0d\u7a7a\uff08\u96f6\u7bc0\u9ede\uff09\u96c6\u7fa3\u7684\u6240\u6709\u7bc0\u9ede\u6c60\u9032\u884c\u64f4\u5bb9\u3002GKE 1.22 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u4e0d\u6703\u51fa\u73fe\u6b64\u884c\u7232\u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- [\u77ad\u89e3\u5982\u4f55\u81ea\u52d5\u64f4\u7e2e\u7bc0\u9ede](https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-autoscaler?hl=zh-cn) \u3002\n- [\u77ad\u89e3\u5982\u4f55\u81ea\u52d5\u5347\u7d1a\u7bc0\u9ede](https://cloud.google.com/kubernetes-engine/docs/how-to/node-auto-upgrades?hl=zh-cn) \u3002\n- [\u77ad\u89e3\u5982\u4f55\u81ea\u52d5\u4fee\u5fa9\u7bc0\u9ede](https://cloud.google.com/kubernetes-engine/docs/how-to/node-auto-repair?hl=zh-cn) \u3002\n- [\u77ad\u89e3\u5982\u4f55\u7e2e\u77ed\u65b0\u7bc0\u9ede\u4e0a\u7684\u6620\u50cf\u62c9\u53d6\u6642\u9593](https://cloud.google.com/kubernetes-engine/docs/how-to/image-streaming?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}