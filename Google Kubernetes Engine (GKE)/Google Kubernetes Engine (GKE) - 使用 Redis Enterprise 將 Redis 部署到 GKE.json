{"title": "Google Kubernetes Engine (GKE) - \u4f7f\u7528 Redis Enterprise \u5c07 Redis \u90e8\u7f72\u5230 GKE", "url": "https://cloud.google.com/kubernetes-engine/docs/tutorials/stateful-workloads/enterprise-redis?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u4f7f\u7528 Redis Enterprise \u5c07 Redis \u90e8\u7f72\u5230 GKE\n\u672c\u6307\u5357\u4ecb\u7d39\u5982\u4f55\u5c07 [Redis Enterprise](https://redis.io/docs/about/redis-enterprise/) \u90e8\u7f72\u5230 Google Kubernetes Engine (GKE) \u96c6\u7fa3\u3002\n [Redis](https://redis.io/) \u662f\u4e00\u500b\u958b\u6e90\u5167\u5b58\u4e2d NoSQL \u6578\u64da\u5eab\uff0c\u4e3b\u8981\u7528\u65bc\u7de9\u5b58\u3002\u5b83\u5177\u6709\u5167\u7f6e\u7684\u8907\u88fd\u529f\u80fd\u3001Lua \u8173\u672c\u3001LRU \u9010\u51fa\u3001\u4e8b\u52d9\u3001\u78c1\u76e4\u6301\u4e45\u6027\u548c\u9ad8\u53ef\u7528\u6027\u3002\nRedis Enterprise \u662f\u4e00\u7a2e\u4f01\u696d\u7d1a\u89e3\u6c7a\u65b9\u6848\uff0c\u64f4\u5c55\u4e86 Redis \u958b\u6e90\u4e26\u7c21\u5316\u4e86\u7ba1\u7406\uff0c\u5305\u62ec\u5730\u7406\u4f4d\u7f6e\u8907\u88fd\u7684\u6578\u64da\u5206\u4f48\u3001\u904b\u71df\u541e\u5410\u91cf\u7684\u7dda\u6027\u64f4\u7e2e\u3001\u6578\u64da\u5206\u5c64\u3001\u9ad8\u7d1a\u5b89\u5168\u529f\u80fd\u7b49\u3002\nRedis Enterprise \u7232\u6bcf\u7a2e\u90e8\u7f72\u9078\u9805\u63d0\u4f9b\u4e0d\u540c\u7684\u50f9\u683c\uff0c\u5305\u62ec\uff1a [\u8edf\u4ef6](https://console.cloud.google.com/marketplace/product/redislabs-public/redis-enterprise?hl=zh-cn) \u3001 [\u96f2](https://console.cloud.google.com/marketplace/product/redis-marketplace-isaas/redis-enterprise-cloud-flexible-plan?hl=zh-cn) \u6216 [\u6df7\u5408\u96f2\u548c\u591a\u96f2](https://redis.com/redis-enterprise-cloud/pricing/) \u3002\n\u672c\u6307\u5357\u9069\u7528\u65bc\u6709\u610f\u5728 Google Kubernetes Engine (GKE) \u4e0a\u90e8\u7f72 Redis Enterprise \u7684\u5e73\u81fa\u7ba1\u7406\u54e1\u3001\u96f2\u67b6\u69cb\u5e2b\u548c\u5c08\u696d\u904b\u71df\u4eba\u54e1\u3002\n **\u6ce8\u610f** \uff1aRedis Enterprise Software \u6839\u64da [Redis Enterprise \u8a31\u53ef](https://redis.com/software-subscription-agreement/) \u5206\u767c\uff0c\u4e26\u4e14\u8a31\u53ef\u9650\u5236\u8981\u6c42\u7528\u6236\u5728 30 \u5929 [\u8a66\u7528](https://redis.com/legal/redis-software-trial-terms/) \u5f8c\u5fc5\u9808\u64c1\u6709\u6709\u6548\u7684\u8a02\u95b1\u624d\u80fd\u7e7c\u7e8c\u4f7f\u7528 Redis Enterprise\u3002\n", "content": "## \u76ee\u6a19\n- \u7232 Redis \u898f\u5283\u548c\u90e8\u7f72 GKE \u57fa\u790e\u67b6\u69cb\n- \u90e8\u7f72 Redis Enterprise Operator\n- \u90e8\u7f72 Redis Enterprise \u96c6\u7fa3\n- \u5275\u5efa Redis Enterprise \u6578\u64da\u5eab\n- \u6f14\u793a\u6578\u64da\u5eab\u8eab\u4efd\u9a57\u8b49\n## \u512a\u52e2Redis Enterprise \u5177\u6709\u4ee5\u4e0b\u512a\u52e2\uff1a- \u4e00\u7a2e Kubernetes \u539f\u751f\u65b9\u6cd5\uff0c\u7528\u65bc\u7ba1\u7406 Redis Enterprise \u96c6\u7fa3 (REC) \u751f\u547d\u9031\u671f\u548c Redis Enterprise \u6578\u64da\u5eab (REDB)\n- \u5728\u55ae\u500b Kubernetes Pod \u4e2d\u5171\u7f6e\u591a\u500b Redis \u6578\u64da\u5eab\uff0c\u63d0\u9ad8\u8cc7\u6e90\u5229\u7528\u7387\n- \u901a\u904e\u8655\u7406\u65e5\u5e38\u7dad\u8b77\u4efb\u52d9\uff08\u5982\u4fee\u88dc\u548c\u5347\u7d1a\uff09\u6e1b\u5c11\u904b\u71df\u958b\u92b7\n- \u652f\u6301\u4f86\u81ea\u79c1\u6709\u5bb9\u5668\u8a3b\u518a\u8868\uff08\u4f8b\u5982 Artifact Registry\uff09\u7684 Redis \u8edf\u4ef6\u6620\u50cf\uff0c\u4ee5\u589e\u5f37\u5bb9\u5668\u7684\u5b89\u5168\u6027\u548c\u53ef\u7528\u6027\n- \u652f\u6301 Google Cloud Managed Service for Prometheus\uff0c\u4ee5\u5be6\u73fe\u6578\u64da\u5eab\u76e3\u63a7\u548c\u53ef\u89c0\u6e2c\u6027\n- \u589e\u5f37\u7684\u5b89\u5168\u529f\u80fd\uff0c\u4f8b\u5982\u52a0\u5bc6\u3001\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\u4ee5\u53ca\u8207 Kubernetes RBAC\uff08\u57fa\u65bc\u89d2\u8272\u7684\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\uff09\u7684\u96c6\u6210\n- \u9ad8\u7d1a\u8eab\u4efd\u9a57\u8b49\u65b9\u6cd5\uff0c\u5305\u62ec LDAP \u548c\u7b2c\u4e09\u65b9\u6191\u64da\u7ba1\u7406\u5668\uff08\u5982 Vault\uff09\n- \u80fd\u5920 [\u914d\u7f6e\u9810\u5b9a\u5099\u4efd](https://docs.redis.com/latest/rs/databases/import-export/schedule-backups/) \n### \u90e8\u7f72\u67b6\u69cbRedis Enterprise \u7ba1\u7406\u4ee5\u4e0b Kubernetes \u8cc7\u6e90\uff1a- Enterprise \u96c6\u7fa3\u53ca\u5176\u5728 StatefulSet \u4e2d\u7684\u914d\u7f6e\u3002\u8a72\u96c6\u7fa3\u7531\u5b89\u88dd\u4e86 Redis \u8edf\u4ef6\u5305\u7684 Redis \u7bc0\u9ede (Pod) \u7d44\u6210\u3002\u9019\u4e9b\u7bc0\u9ede\u5177\u6709\u904b\u884c\u9032\u7a0b\uff0c\u4ee5\u78ba\u4fdd\u7bc0\u9ede\u5c6c\u65bc\u96c6\u7fa3\u3002\u6bcf\u500b\u7bc0\u9ede\u90fd\u63d0\u4f9b\u4e00\u500b\u5bb9\u5668\u4f86\u904b\u884c\u591a\u500b\u6578\u64da\u5eab\u5be6\u4f8b\uff08\u5206\u7247\uff09\u3002\u96d6\u7136 Kubernetes \u6700\u4f73\u5be6\u8e10\u8072\u660e Pod \u61c9\u4ee3\u8868\u4e00\u500b\u5177\u6709\u4e00\u500b\u5bb9\u5668\u7684\u61c9\u7528\uff0c\u4f46 Redis Enterprise \u6703\u5c07\u591a\u500b Redis \u6578\u64da\u5eab\u90e8\u7f72\u5230\u55ae\u500b\u5bb9\u5668\u4e2d\u3002\u6b64\u65b9\u6cd5\u53ef\u4ee5\u63d0\u9ad8\u8cc7\u6e90\u5229\u7528\u7387\u3001\u6027\u80fd\u548c\u7db2\u7d61\u541e\u5410\u91cf\u3002\u6bcf\u500b\u5bb9\u5668\u9084\u5177\u6709\u4e00\u500b\u96f6\u5ef6\u9072\u4ee3\u7406\uff0c\u7528\u65bc\u5c07\u6d41\u91cf\u8def\u7531\u5230\u5bb9\u5668\u5167\u7684\u7279\u5b9a Redis \u6578\u64da\u5eab\u9032\u7a0b\u4e26\u9032\u884c\u7ba1\u7406\u3002\n- `RedisEnterpriseDatabase`(REDB) \u81ea\u5b9a\u7fa9\u8cc7\u6e90\uff0c\u8868\u793a\u5728 REC \u4e2d\u5275\u5efa\u7684 Redis \u6578\u64da\u5eab\u5be6\u4f8b\n- \u5c07 REDB \u5be6\u4f8b\u7528\u4f5c\u6578\u64da\u5eab\u7aef\u9ede\u7684 Kubernetes Service\n- \u540d\u7232 Service Rigger \u7684\u63a7\u5236\u5668 Pod\uff0c\u7528\u65bc\u5728\u5275\u5efa\u6216\u522a\u9664\u6578\u64da\u5eab\u6642\u5275\u5efa\u548c\u522a\u9664\u6578\u64da\u5eab\u7aef\u9ede\n\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07 REC \u90e8\u7f72\u5230\u5c08\u7528\u547d\u540d\u7a7a\u9593\uff0c\u4f75\u7232\u61c9\u7528\u90e8\u7f72\u4f7f\u7528\u55ae\u7368\u7684\u547d\u540d\u7a7a\u9593\u4ee5\u5275\u5efa [\u4e00\u5c0d\u591a](https://docs.redis.com/latest/kubernetes/deployment/deployment-options/#single-rec-and-multiple-namespaces-one-to-many) \u90e8\u7f72\uff0c\u5f9e\u800c\u5be6\u73fe\u66f4\u597d\u7684\u9694\u96e2\u3002\n\u4e0b\u5716\u4ecb\u7d39\u4e86 Redis Enterprise \u7d44\u4ef6\u53ca\u5176\u4e92\u9023\u65b9\u5f0f\uff1a\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u5c0d Redis Enterprise \u96c6\u7fa3\u9032\u884c\u914d\u7f6e\uff0c\u4f7f\u5176\u5177\u5099\u9ad8\u53ef\u7528\u6027\u3002\u7232\u6b64\uff0cREC \u9700\u8981\u5947\u6578\u500b\u7bc0\u9ede\u4ee5\u53ca\u81f3\u5c11\u4e09\u500b\u7bc0\u9ede\u3002\u60a8\u9084\u5c07\u8a2d\u7f6e\u89aa\u548c\u6027\u3001\u53cd\u89aa\u548c\u6027\u898f\u5247\u548c\u7bc0\u9ede\u6c61\u9ede\uff0c\u4ee5\u78ba\u4fdd\u6bcf\u500b Redis \u7bc0\u9ede\u90fd\u653e\u7f6e\u5728\u4e0d\u540c\u7684 Kubernetes \u7bc0\u9ede\u4e2d\uff0c\u4e26\u4e14 Redis \u7bc0\u9ede\u5747\u52fb\u5206\u4f48\u5728\u6574\u500b Kubernetes \u96c6\u7fa3\u4e2d\u3002\n\u4f7f\u7528\u591a\u500b\u7bc0\u9ede\u548c\u53ef\u7528\u5340\u5c0d\u65bc\u5be6\u73fe\u9ad8\u53ef\u7528\u6027 GKE \u96c6\u7fa3\u81f3\u95dc\u91cd\u8981\uff0c\u539f\u56e0\u5982\u4e0b\uff1a- **\u5bb9\u932f\u6027** \uff1a\u591a\u500b\u7bc0\u9ede\u5728\u6574\u500b\u96c6\u7fa3\u4e2d\u5206\u914d\u5de5\u4f5c\u8ca0\u8f09\uff0c\u78ba\u4fdd\u67d0\u500b\u7bc0\u9ede\u767c\u751f\u6545\u969c\u6642\uff0c\u5176\u4ed6\u7bc0\u9ede\u53ef\u4ee5\u63a5\u7ba1\u4efb\u52d9\uff0c\u5f9e\u800c\u9632\u6b62\u7522\u751f\u505c\u6a5f\u6642\u9593\u548c\u767c\u751f\u670d\u52d9\u4e2d\u65b7\u3002\n- **\u53ef\u4f38\u7e2e\u6027** \uff1a\u64c1\u6709\u591a\u500b\u7bc0\u9ede\u53ef\u4ee5\u6839\u64da\u9700\u8981\u6dfb\u52a0\u6216\u79fb\u9664\u7bc0\u9ede\uff0c\u5f9e\u800c\u5be6\u73fe\u6a6b\u5411\u64f4\u7e2e\uff0c\u78ba\u4fdd\u6700\u4f73\u8cc7\u6e90\u5206\u914d\u4e26\u9069\u61c9\u589e\u52a0\u7684\u6d41\u91cf\u6216\u5de5\u4f5c\u8ca0\u8f09\u9700\u6c42\u3002\n- **\u9ad8\u53ef\u7528\u6027** \uff1a\u5728\u5340\u57df\u5167\u4f7f\u7528\u591a\u500b\u53ef\u7528\u5340\u53ef\u78ba\u4fdd\u5197\u9918\uff0c\u4e26\u6700\u5927\u9650\u5ea6\u5730\u964d\u4f4e\u55ae\u9ede\u6545\u969c\u98a8\u96aa\u3002\u5982\u679c\u6574\u500b\u53ef\u7528\u5340\u767c\u751f\u670d\u52d9\u4e2d\u65b7\uff0c\u5247\u96c6\u7fa3\u53ef\u4ee5\u7e7c\u7e8c\u5728\u5176\u4ed6\u53ef\u7528\u5340\u4e2d\u904b\u884c\uff0c\u5f9e\u800c\u4fdd\u6301\u670d\u52d9\u53ef\u7528\u6027\u3002\n- **\u5730\u7406\u4f4d\u7f6e\u5197\u9918** \uff1a\u901a\u904e\u8b93\u7bc0\u9ede\u8de8\u8d8a\u5404\u500b\u5340\u57df\uff0c\u96c6\u7fa3\u7684\u6578\u64da\u548c\u670d\u52d9\u53ef\u5206\u4f48\u5728\u4e0d\u540c\u5730\u7406\u4f4d\u7f6e\uff0c\u5f9e\u800c\u9632\u7bc4\u81ea\u7136\u707d\u5bb3\u3001\u96fb\u529b\u4e2d\u65b7\u6216\u53ef\u80fd\u5f71\u97ff\u55ae\u500b\u53ef\u7528\u5340\u7684\u5176\u4ed6\u672c\u5730\u4e2d\u65b7\u3002\n- **\u6efe\u52d5\u66f4\u65b0\u548c\u7dad\u8b77** \uff1a\u901a\u904e\u4f7f\u7528\u591a\u500b\u7bc0\u9ede\uff0c\u60a8\u53ef\u4ee5\u5c0d\u55ae\u500b\u7bc0\u9ede\u57f7\u884c\u6efe\u52d5\u66f4\u65b0\u548c\u7dad\u8b77\uff0c\u800c\u4e0d\u6703\u5f71\u97ff\u96c6\u7fa3\u7684\u6574\u9ad4\u53ef\u7528\u6027\u3002\u9019\u6a23\u53ef\u78ba\u4fdd\u670d\u52d9\u4e0d\u4e2d\u65b7\uff0c\u540c\u6642\u60a8\u80fd\u5920\u57f7\u884c\u5fc5\u8981\u7684\u66f4\u65b0\u4e26\u7121\u7e2b\u61c9\u7528\u88dc\u4e01\u3002\n- **\u670d\u52d9\u7b49\u7d1a\u5354\u8b70 (SLA)** \uff1aGoogle Cloud \u7232\u591a\u53ef\u7528\u5340\u90e8\u7f72\u63d0\u4f9b\u670d\u52d9\u7b49\u7d1a\u5354\u8b70\uff0c\u4fdd\u8b49\u6700\u4f4e\u7d1a\u5225\u7684\u6b63\u5e38\u904b\u884c\u6642\u9593\u548c\u53ef\u7528\u6027\u3002\n## \u8cbb\u7528\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Google Cloud \u7684\u4ee5\u4e0b\u6536\u8cbb\u7d44\u4ef6\uff1a- [Compute Engine](https://cloud.google.com/compute/disks-image-pricing?hl=zh-cn) \n- [GKE](https://cloud.google.com/kubernetes-engine/pricing?hl=zh-cn) \n- [Google Cloud Managed Service for Prometheus](https://cloud.google.com/stackdriver/docs/managed-prometheus?hl=zh-cn) \n\u60a8\u53ef\u4f7f\u7528 [\u50f9\u683c\u8a08\u7b97\u5668](https://cloud.google.com/products/calculator?hl=zh-cn) \u6839\u64da\u60a8\u7684\u9810\u8a08\u4f7f\u7528\u60c5\u6cc1\u4f86\u4f30\u7b97\u8cbb\u7528\u3002 \nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5b8c\u6210\u672c\u6587\u6a94\u4e2d\u63cf\u8ff0\u7684\u4efb\u52d9\u5f8c\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u522a\u9664\u6240\u5275\u5efa\u7684\u8cc7\u6e90\u4f86\u907f\u514d\u7e7c\u7e8c\u8a08\u8cbb\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e05\u7406](#clean-up) \u3002## \u6e96\u5099\u5de5\u4f5c- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5411\u60a8\u7684 Google \u8cec\u865f\u6388\u4e88\u89d2\u8272\u3002\u5c0d\u4ee5\u4e0b\u6bcf\u500b IAM \u89d2\u8272\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e00\u6b21\uff1a `roles/compute.securityAdmin, roles/compute.viewer, roles/container.clusterAdmin, roles/container.admin, roles/iam.serviceAccountAdmin, roles/iam.serviceAccountUser````\ngcloud projects add-iam-policy-binding PROJECT_ID --member=\"user:EMAIL_ADDRESS\" --role=ROLE\n```- \u5c07``\u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\n- \u5c07``\u66ff\u63db\u7232\u60a8\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\u3002\n- \u5c07``\u66ff\u63db\u7232\u6bcf\u500b\u89d2\u8272\u3002\n### \u8a2d\u7f6e\u60a8\u7684\u74b0\u5883\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 [Cloud Shell](https://cloud.google.com/shell?hl=zh-cn) \u4f86\u7ba1\u7406 Google Cloud \u4e0a\u8a17\u7ba1\u7684\u8cc7\u6e90\u3002Cloud Shell \u9810\u5b89\u88dd\u6709\u672c\u6559\u7a0b\u6240\u9700\u7684\u8edf\u4ef6\uff0c\u5305\u62ec [kubectl](https://kubernetes.io/docs/reference/kubectl/) \u3001 [gcloud CLI](https://cloud.google.com/sdk/gcloud?hl=zh-cn) \u548c [Terraform](https://cloud.google.com/docs/terraform?hl=zh-cn) \u3002\n\u5982\u9700\u4f7f\u7528 Cloud Shell \u8a2d\u7f6e\u60a8\u7684\u74b0\u5883\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a- \u9ede\u64ca [Google Cloud \u63a7\u5236\u6aaf](https://console.cloud.google.com/?hl=zh-cn) \u4e2d\u7684 **\u6fc0\u6d3b Cloud Shell** \uff0c\u5f9e Google Cloud \u63a7\u5236\u6aaf\u5553\u52d5 Cloud Shell \u6703\u8a71\u3002\u6b64\u64cd\u4f5c\u6703\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5e95\u90e8\u7a97\u683c\u4e2d\u5553\u52d5\u6703\u8a71\u3002\n- \u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\uff1a```\nexport PROJECT_ID=PROJECT_ID\nexport KUBERNETES_CLUSTER_PREFIX=redis\nexport REGION=us-central1\n```\u66ff\u63db `` \uff1a\u60a8\u7684 Google Cloud [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifying_projects) \u3002\n- \u514b\u9686 GitHub \u4ee3\u78bc\u5eab\uff1a```\ngit clone https://github.com/GoogleCloudPlatform/kubernetes-engine-samples\n```\n- \u5207\u63db\u5230\u5de5\u4f5c\u76ee\u9304\uff1a```\ncd kubernetes-engine-samples/databases/redis-enterprise-operator\n```\n## \u5275\u5efa\u96c6\u7fa3\u57fa\u790e\u67b6\u69cb\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u904b\u884c Terraform \u8173\u672c\u4ee5\u5275\u5efa\u53ef\u7528\u6027\u9ad8\u7684\u5c08\u7528\u5340\u57df\u7d1a GKE \u96c6\u7fa3\u548c VPC\u3002\n\u4e0b\u5716\u986f\u793a\u4e86\u90e8\u7f72\u5728\u4e09\u500b\u4e0d\u540c\u53ef\u7528\u5340\u4e2d\u7684\u5c08\u7528\u5340\u57df\u7d1a Standard GKE \u96c6\u7fa3\uff1a\u82e5\u8981\u90e8\u7f72\u6b64\u57fa\u790e\u67b6\u69cb\uff0c\u8acb\u5f9e Cloud Shell \u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\n\u00a0 cd terraform/gke-standard\u00a0 export GOOGLE_OAUTH_ACCESS_TOKEN=$(gcloud auth print-access-token)\u00a0 terraform init\u00a0 terraform apply -var project_id=${PROJECT_ID} \u00a0 \\\u00a0 \u00a0 -var region=${REGION} \u00a0\\\u00a0 \u00a0 -var cluster_prefix=${KUBERNETES_CLUSTER_PREFIX}\n```\n\u51fa\u73fe\u63d0\u793a\u6642\uff0c\u8acb\u8f38\u5165 `yes` \u3002\u5b8c\u6210\u6b64\u547d\u4ee4\u4e26\u4f7f\u96c6\u7fa3\u986f\u793a\u5c31\u7dd2\u72c0\u614b\u53ef\u80fd\u9700\u8981\u5e7e\u5206\u9418\u6642\u9593\u3002\nTerraform \u6703\u5275\u5efa\u4ee5\u4e0b\u8cc7\u6e90\uff1a- Kubernetes \u7bc0\u9ede\u7684 VPC \u7db2\u7d61\u548c\u5c08\u7528\u5b50\u7db2\n- \u7528\u65bc\u901a\u904e NAT \u8a2a\u554f\u4e92\u806f\u7db2\u7684\u8def\u7531\u5668\n- \u5c08\u7528 GKE \u96c6\u7fa3\uff08\u5728`us-central1`\u5340\u57df\u4e2d\uff09\n- \u4e00\u500b\u5553\u7528\u4e86\u81ea\u52d5\u64f4\u7e2e\u529f\u80fd\u7684\u7bc0\u9ede\u6c60\uff08\u6bcf\u500b\u53ef\u7528\u5340\u4e00\u500b\u5230\u5169\u500b\u7bc0\u9ede\uff0c\u6bcf\u500b\u53ef\u7528\u5340\u6700\u5c11\u4e00\u500b\u7bc0\u9ede\uff09\n\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\n...\nApply complete! Resources: 14 added, 0 changed, 0 destroyed.\n...\n```\n### \u9023\u63a5\u5230\u96c6\u7fa3\u4f7f\u7528 Cloud Shell\uff0c\u914d\u7f6e `kubectl` \u4ee5\u8207\u96c6\u7fa3\u901a\u4fe1\uff1a\n```\ngcloud container clusters get-credentials ${KUBERNETES_CLUSTER_PREFIX}-cluster --region ${REGION}\n```## \u5c07 Redis Enterprise Operator \u90e8\u7f72\u5230\u60a8\u7684\u96c6\u7fa3\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u9700\u8981\u5c07 [Redis Enterprise Operator](https://docs.redis.com/latest/kubernetes/architecture/operator) \u90e8\u7f72\u5230 Kubernetes \u96c6\u7fa3\u3002- \u7232 REC \u53ca\u5176\u61c9\u7528\u5275\u5efa\u547d\u540d\u7a7a\u9593\uff1a```\nkubectl create namespace rec-nskubectl create namespace application\n```\n- \u7232\u547d\u540d\u7a7a\u9593\u6dfb\u52a0\u6a19\u7c64\uff1a```\nkubectl label namespace rec-ns connection=rediskubectl label namespace application connection=redis\n```\n- \u7372\u53d6\u6700\u65b0\u7248\u672c\u7684 Redis Enterprise Operator \u8edf\u4ef6\u5305\uff1a```\nVERSION=`curl --silent https://api.github.com/repos/RedisLabs/redis-enterprise-k8s-docs/releases/latest | grep tag_name | awk -F'\"' '{print $4}'`\n```\n- \u5b89\u88dd Redis Enterprise Operator\uff1a```\nkubectl apply -n rec-ns -f https://raw.githubusercontent.com/RedisLabs/redis-enterprise-k8s-docs/$VERSION/bundle.yaml\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nrole.rbac.authorization.k8s.io/redis-enterprise-operator created\nrolebinding.rbac.authorization.k8s.io/redis-enterprise-operator created\nserviceaccount/redis-enterprise-operator created\nservice/admission created\ncustomresourcedefinition.apiextensions.k8s.io/redisenterpriseclusters.app.redislabs.com created\ncustomresourcedefinition.apiextensions.k8s.io/redisenterprisedatabases.app.redislabs.com created\ncustomresourcedefinition.apiextensions.k8s.io/redisenterpriseremoteclusters.app.redislabs.com created\ncustomresourcedefinition.apiextensions.k8s.io/redisenterpriseactiveactivedatabases.app.redislabs.com created\ndeployment.apps/redis-enterprise-operator created\n```\n## \u90e8\u7f72 Redis Enterprise \u96c6\u7fa3\n- \u5c07\u6e05\u55ae\u61c9\u7528\u5230\u60a8\u7684\u96c6\u7fa3\uff1a```\nkubectl apply -n rec-ns -f manifests/01-basic-cluster/rec.yaml\n```\u6b64\u547d\u4ee4\u53ef\u80fd\u9700\u8981\u5e7e\u5206\u9418\u624d\u80fd\u5b8c\u6210\u3002\n- \u6aa2\u67e5 REC \u90e8\u7f72\u7684\u72c0\u614b\uff1a```\nkubectl get rec -n rec-ns\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME \u00a0 \u00a0 \u00a0NODES \u00a0 VERSION \u00a0 \u00a0STATE \u00a0 \u00a0 SPEC STATUS \u00a0 LICENSE STATE \u00a0 SHARDS LIMIT \u00a0 LICENSE EXPIRATION DATE \u00a0 AGEgke-rec \u00a0 3 \u00a0 \u00a0 \u00a0 7.2.4-52 \u00a0 Running \u00a0 Valid \u00a0 \u00a0 \u00a0 \u00a0 Valid \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 4 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a02023-09-29T20:15:32Z \u00a0 \u00a0 \u00a04m7s\n```\u7576 `STATE` \u7232 `RUNNING` \u6642\uff0c\u8868\u793a\u96c6\u7fa3\u5df2\u6e96\u5099\u5c31\u7dd2\u3002\n## \u53ef\u9078\uff1a\u914d\u7f6e\u51c6\u5165\u63a7\u5236\u5668\u60a8\u53ef\u4ee5\u9078\u64c7\u6027\u5730\u5728\u90e8\u7f72\u6642\u7232\u6578\u64da\u5eab\u9a57\u8b49\u914d\u7f6e\u57fa\u790e\u8a2d\u65bd\u3002- \u8a2d\u7f6e\u51c6\u5165\u63a7\u5236\u5668\u4e26\u6aa2\u67e5\u51c6\u5165 tls Secret \u662f\u5426\u5b58\u5728\uff1a```\nkubectl get secret admission-tls -n rec-ns\n```\n- \u7372\u53d6\u8b49\u66f8\uff1a```\nexport CERT=$(kubectl get secret admission-tls -n rec-ns -o jsonpath='{.data.cert}')\n```\n- \u5c07\u8b49\u66f8\u8907\u88fd\u5230 `webhook.yaml` \u6587\u4ef6\u4e2d\uff1a```\nsed -i -e 's/CRT/'$CERT'/g' manifests/01-basic-cluster/webhook.yaml\n```\n- \u90e8\u7f72\u9a57\u8b49 webhook\uff1a```\nsed -i -e 's/CRT/'$CERT'/g' manifests/01-basic-cluster/webhook.yaml\n```\u51c6\u5165\u63a7\u5236\u5668\u6703\u5728\u5df2\u52a0\u6a19\u7c64\u7684\u547d\u540d\u7a7a\u9593\u4e0a\u9a57\u8b49\u6578\u64da\u5eab\u8a9e\u6cd5\u3002\n- \u901a\u904e\u5275\u5efa\u975e\u529f\u80fd\u6027\u6578\u64da\u5eab\u4f86\u9a57\u8b49\u51c6\u5165\u63a7\u5236\u5668\uff1a```\nkubectl apply -n rec-ns -f - << EOFapiVersion: app.redislabs.com/v1alpha1kind: RedisEnterpriseDatabasemetadata:\u00a0 name: redis-enterprise-databasespec:\u00a0 evictionPolicy: illegalEOF\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nError from server: error when creating \"STDIN\": admission webhook \"redisenterprise.admission.redislabs\" denied the request: 'illegal' is an invalid value for 'eviction_policy'. Possible values are ['volatile-lru', 'volatile-ttl', 'volatile-random', 'allkeys-lru', 'allkeys-random', 'noeviction', 'volatile-lfu', 'allkeys-lfu']\n```\n## \u5275\u5efa\u547d\u540d\u7a7a\u9593\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cRedis Enterprise Operator \u7121\u6b0a\u5728\u5176\u81ea\u5df1\u7684\u547d\u540d\u7a7a\u9593\u4e4b\u5916\u57f7\u884c\u64cd\u4f5c\u3002\u5982\u9700\u5141\u8a31 Redis Enterprise Operator \u5728\u5176\u4ed6\u547d\u540d\u7a7a\u9593\u4e2d\u5275\u5efa REDB \u548c\u6578\u64da\u5eab\u7aef\u9ede\uff0c\u60a8\u5fc5\u9808\u914d\u7f6e RBAC\u3002- \u5728\u61c9\u7528\u547d\u540d\u7a7a\u9593\u4e2d\u61c9\u7528\u76f8\u61c9\u7684\u89d2\u8272\u548c\u89d2\u8272\u7d81\u5b9a\uff1a```\nkubectl apply -f manifests/01-basic-cluster/role.yaml -n applicationkubectl apply -f manifests/01-basic-cluster/role-binding.yaml -n application\n```\n- \u5728 `rec-ns` \u547d\u540d\u7a7a\u9593\u4e2d\u5275\u5efa\u96c6\u7fa3\u89d2\u8272\u548c\u96c6\u7fa3\u89d2\u8272\u7d81\u5b9a\uff1a```\nkubectl apply -n rec-ns -f manifests/01-basic-cluster/cluster_role.yamlkubectl apply -n rec-ns -f manifests/01-basic-cluster/cluster_role_binding.yaml\n```\n- \u4fee\u6539 REC ConfigMap \u4ee5\u6dfb\u52a0\u5c0d\u61c9\u7528\u547d\u540d\u7a7a\u9593\u7684\u63a7\u5236\uff1a```\nkubectl patch ConfigMap/operator-environment-config --type merge -p '{\"data\": {\"REDB_NAMESPACES_LABEL\": \"connection=redis\"}}' -n rec-ns\n```\u6a19\u8a18\u7232 ConfigMap \u7684\u6bcf\u500b\u547d\u540d\u7a7a\u9593\u5747\u6703\u9032\u884c\u4fee\u88dc\u3002\n- \u6aa2\u67e5 `rec-ns` \u547d\u540d\u7a7a\u9593\u7684 Redis \u57fa\u790e\u8a2d\u65bd\u4e2d\u7684\u8cc7\u6e90\u7684\u72c0\u614b\uff1a```\nkubectl get pod,deploy,svc,rec,statefulset,cm,secrets -n rec-ns\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME            READY STATUS RESTARTS  AGE\npod/gke-rec-0         2/2  Running 0    172m\npod/gke-rec-1         2/2  Running 0    171m\npod/gke-rec-2         2/2  Running 0    168m\npod/gke-rec-services-rigger-5f885f59dc-gc79g  1/1  Running 0    172m\npod/redis-enterprise-operator-6668ccd8dc-kx29z 2/2  Running 2 (5m58s ago) 5h\nNAME          READY UP-TO-DATE AVAILABLE AGE\ndeployment.apps/gke-rec-services-rigger  1/1  1   1   172m\ndeployment.apps/redis-enterprise-operator 1/1  1   1   5h\nNAME     TYPE  CLUSTER-IP EXTERNAL-IP PORT(S)    AGE\nservice/admission  ClusterIP 10.52.11.13 <none>  443/TCP    5h\nservice/gke-rec  ClusterIP 10.52.5.44 <none>  9443/TCP,8001/TCP 172m\nservice/gke-rec-prom ClusterIP None   <none>  8070/TCP   172m\nservice/gke-rec-ui  ClusterIP 10.52.3.29 <none>  8443/TCP   172m\nNAME            NODES VERSION STATE  SPEC STATUS LICENSE STATE SHARDS LIMIT LICENSE EXPIRATION DATE AGE\nredisenterprisecluster.app.redislabs.com/gke-rec 3  7.2.4-52 Running Valid   Valid   4    2023-10-05T11:07:20Z  172m\nNAME      READY AGE\nstatefulset.apps/gke-rec 3/3  172m\nNAME         DATA AGE\nconfigmap/gke-rec-bulletin-board  1  172m\nconfigmap/gke-rec-health-check   5  172m\nconfigmap/kube-root-ca.crt    1  5h2m\nconfigmap/operator-environment-config 1  5h\nNAME     TYPE  DATA AGE\nsecret/admission-tls Opaque 2  5h\nsecret/gke-rec   Opaque 2  172m\n```\n## \u90e8\u7f72 Redis Enterprise \u6578\u64da\u5eab\n- \u5728\u61c9\u7528\u547d\u540d\u7a7a\u9593\u4e2d\u5275\u5efa Redis Enterprise \u6578\u64da\u5eab\uff1a```\nkubectl apply -f manifests/01-basic-cluster/a-rdb.yaml -n application\n```\n- \u6aa2\u67e5 REDB \u72c0\u614b\uff1a```\nkubectl get redb --all-namespaces\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAMESPACE  NAME  VERSION PORT CLUSTER SHARDS STATUS SPEC STATUS AGE\napplication app-db 7.2.0  12999 gke-rec 1  active Valid   15s\n```\n- \u9a57\u8b49\u6bcf\u500b REDB \u7684 Service \u662f\u5426\u6b63\u5728\u904b\u884c\uff1a```\nkubectl get svc --all-namespaces\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAMESPACE  NAME  TYPE   CLUSTER-IP EXTERNAL-IP       PORT(S) AGE\napplication app-db ExternalName <none>  redis-12999.rec-ns.svc.cluster.local 12999/TCP 72m\n```\n- \u9a57\u8b49 Secret \u662f\u5426\u5df2\u5275\u5efa\uff1a```\nkubectl get secrets -n application\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME   TYPE  DATA AGE\nredb-app-db Opaque 3  96m\n```\n## \u4f7f\u7528\u5bc6\u78bc\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u60a8\u53ef\u4ee5\u5728\u61c9\u7528\u547d\u540d\u7a7a\u9593\u4e2d\u4f7f\u7528\u5177\u6709 `redis-cli` \u7684 Pod \u9023\u63a5\u5230 REDB\u3002\u5ba2\u6236\u7aef pod \u4f7f\u7528\u61c9\u7528\u547d\u540d\u7a7a\u9593 (REDB) \u4e2d\u53ef\u7528\u7684 Secret \u4f86\u5efa\u7acb\u9023\u63a5\u3002\n\u4f7f\u7528\u81ea\u5b9a\u7fa9\u8cc7\u6e90 REDB \u5275\u5efa\u7684\u6578\u64da\u5eab\u50c5\u652f\u6301 [\u4e0d\u4f7f\u7528 ACL \u7684\u5bc6\u78bc\u8eab\u4efd\u9a57\u8b49](https://docs.redis.com/latest/kubernetes/reference/db-options/#databasesecretnamehttpsgithubcomredislabsredis-enterprise-k8s-docsblobmasterredis_enterprise_database_apimdredisenterprisedatabasespec) \u3002- \u5275\u5efa\u5ba2\u6236\u7aef Pod\uff1a```\nkubectl apply -n application -f manifests/03-auth/client_pod.yaml\n```\n- \u9023\u63a5\u5230\u5ba2\u6236\u7aef Pod\uff1a```\nkubectl exec -n application -i -t redis-client -c redis-client -- /bin/sh\n```\n- \u9023\u63a5\u5230\u6578\u64da\u5eab\uff1a```\nredis-cli -h $SERVICE -p $PORT --pass $PASS\n```\n- \u5275\u5efa\u5bc6\u9470\uff1a```\nSET mykey \"Hello World\"\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nOK\n```\n- \u7372\u53d6\u5bc6\u9470\uff1a```\nGET mykey\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\n\"Hello World\"\n```\n- \u9000\u51fa Pod shell```\nexit\n```\n## \u77ad\u89e3 Prometheus \u5982\u4f55\u6536\u96c6 Redis \u96c6\u7fa3\u7684\u6307\u6a19\u4e0b\u5716\u5c55\u793a\u4e86 Prometheus \u6307\u6a19\u6536\u96c6\u7684\u5de5\u4f5c\u539f\u7406\uff1a\u5728\u8a72\u5716\u4e2d\uff0cGKE \u5c08\u7528\u96c6\u7fa3\u5305\u542b\uff1a- Redis Pod\uff0c\u7528\u65bc\u6536\u96c6\u8def\u5f91`/`\u548c\u7aef\u53e3`8070`\u7684\u6307\u6a19\n- \u57fa\u65bc Prometheus \u7684\u6536\u96c6\u5668\uff0c\u7528\u65bc\u8655\u7406 Redis Pod \u4e2d\u7684\u6307\u6a19\n- \u5c07\u6307\u6a19\u767c\u9001\u5230 Cloud Monitoring \u7684`PodMonitoring`\u8cc7\u6e90\nRedis Enterprise Operator \u4ee5 Prometheus \u683c\u5f0f\u516c\u958b\u96c6\u7fa3\u6307\u6a19\u3002- \u5275\u5efa metrics-proxy Deployment\uff1a```\nkubectl apply -n rec-ns -f manifests/02-prometheus-metrics/metrics-proxy.yaml\n```\u7531\u65bc\u8a72 Operator \u50c5\u63d0\u4f9b\u5177\u6709\u81ea\u7c3d\u540d\u8b49\u66f8\u7684 HTTPS \u7aef\u9ede\uff0c\u4e26\u4e14 `PodMonitoring` \u8cc7\u6e90\u4e0d\u652f\u6301\u505c\u7528 TLS \u8b49\u66f8\u9a57\u8b49\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5c07 `metrics-proxy` Pod \u7528\u4f5c\u6b64\u7aef\u9ede\u7684\u53cd\u5411\u4ee3\u7406\uff0c\u4ee5\u5728 HTTP \u7aef\u53e3\u4e0a\u516c\u958b\u6307\u6a19\u3002\n- \u5275\u5efa [PodMonitoring](https://cloud.google.com/stackdriver/docs/managed-prometheus/setup-managed?hl=zh-cn#gmp-pod-monitoring) \u8cc7\u6e90\uff0c\u4ee5\u6309 `labelSelector` \u722c\u53d6\u6307\u6a19\uff1a```\nkubectl apply -n rec-ns -f manifests/02-prometheus-metrics/pod-monitoring.yaml\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **GKE \u96c6\u7fa3\u4fe1\u606f\u4e2d\u5fc3** \u9801\u9762\u3002 [\u8f49\u5230 GKE \u96c6\u7fa3\u4fe1\u606f\u4e2d\u5fc3](https://console.cloud.google.com/monitoring/dashboards/resourceList/gmp_gke_cluster?hl=zh-cn) \u4fe1\u606f\u4e2d\u5fc3\u986f\u793a\u975e\u96f6\u6307\u6a19\u63d0\u53d6\u7387\u3002\n### \u5275\u5efa\u4fe1\u606f\u4e2d\u5fc3\u60a8\u53ef\u4ee5\u901a\u904e\u5275\u5efa\u4fe1\u606f\u4e2d\u5fc3\u4f86\u67e5\u770b\u6307\u6a19\u3002- \u5275\u5efa\u4fe1\u606f\u4e2d\u5fc3\uff1a```\ngcloud --project \"${PROJECT_ID}\" monitoring dashboards create --config-from-file monitoring/dashboard.json\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nCreated [f4efbe4e-2605-46b4-9910-54b13d29b3be].\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **\u4fe1\u606f\u4e2d\u5fc3** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u4fe1\u606f\u4e2d\u5fc3\u201d](https://console.cloud.google.com/monitoring/dashboards?hl=zh-cn) \n- \u6253\u958b **Redis Enterprise \u96c6\u7fa3\u4fe1\u606f\u4e2d\u5fc3** \u3002\u4fe1\u606f\u4e2d\u5fc3\u53ef\u80fd\u9700\u8981\u5e7e\u5206\u9418\u6642\u9593\u624d\u80fd\u5b8c\u6210\u81ea\u52d5\u9810\u914d\u3002\n### \u9a57\u8b49\u5c0e\u51fa\u7684\u6307\u6a19\u5982\u9700\u9a57\u8b49\u6307\u6a19\uff0c\u8acb\u5275\u5efa\u65b0\u6578\u64da\u5eab\u4e26\u6aa2\u67e5\u6307\u6a19\u3002- \u6253\u958b **Redis Enterprise \u96c6\u7fa3\u4fe1\u606f\u4e2d\u5fc3** \u3002\n- \u5275\u5efa\u4e00\u500b\u984d\u5916\u7684 Redis \u6578\u64da\u5eab\uff1a```\nkubectl apply -n rec-ns -f manifests/02-prometheus-metrics/c-rdb.yaml\n```\u4fe1\u606f\u4e2d\u5fc3\u4e0a\u7684 **\u6578\u64da\u5eab\u8a08\u6578** \u61c9\u66f4\u65b0\u3002\n- \u5275\u5efa\u5ba2\u6236\u7aef pod \u4ee5\u9023\u63a5\u5230\u65b0\u6578\u64da\u5eab\uff1a```\nkubectl apply -n rec-ns -f manifests/02-prometheus-metrics/client_pod.yaml\n```\n- \u9023\u63a5\u5230\u5ba2\u6236\u7aef Pod \u4e26\u6e96\u5099\u8b8a\u91cf\uff1a```\nkubectl exec -it redis-client-c -n rec-ns -- /bin/bash\n```\n- \u4f7f\u7528 `redis-cli` \u5de5\u5177\u5275\u5efa\u65b0\u5bc6\u9470\uff1a```\nfor i in {1..50}; do \\\u00a0 redis-cli -h $SERVICE -p $PORT -a $PASS \\\u00a0 --no-auth-warning SET mykey-$i \"myvalue-$i\"; \\done\n```\n- \u5237\u65b0\u9801\u9762\uff0c\u60a8\u6703\u89c0\u5bdf\u5230\u5716\u8868\u5df2\u66f4\u65b0\u7232\u986f\u793a\u5be6\u969b\u6578\u64da\u5eab\u72c0\u614b\u3002\n- \u9000\u51fa Pod shell```\nexit\n```\n## \u6e05\u7406\n### \u522a\u9664\u9805\u76ee\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- **\u8b66\u544a** \uff1a\u522a\u9664\u9805\u76ee\u6703\u7522\u751f\u4ee5\u4e0b\u5f71\u97ff- **\u9805\u76ee\u4e2d\u7684\u6240\u6709\u5167\u5bb9\u90fd\u6703\u88ab\u522a\u9664\u3002** \u5982\u679c\u60a8\u5c07\u73fe\u6709\u9805\u76ee\u7528\u65bc\u672c\u6587\u6a94\u4e2d\u7684\u4efb\u52d9\uff0c\u5247\u522a\u9664\u8a72\u9805\u76ee\u5f8c\uff0c\u9084\u5c07\u522a\u9664\u60a8\u5df2\u5728\u8a72\u9805\u76ee\u4e2d\u5b8c\u6210\u7684\u4efb\u4f55\u5176\u4ed6\u5de5\u4f5c\u3002\n- **\u81ea\u5b9a\u7fa9\u9805\u76ee ID \u4e1f\u5931\u3002** \u5275\u5efa\u6b64\u9805\u76ee\u6642\uff0c\u60a8\u53ef\u80fd\u5275\u5efa\u4e86\u8981\u5728\u5c07\u4f86\u4f7f\u7528\u7684\u81ea\u5b9a\u7fa9\u9805\u76ee ID\u3002\u8981\u4fdd\u7559\u4f7f\u7528\u8a72\u9805\u76ee ID \u7684\u7db2\u5740\uff08\u4f8b\u5982`appspot.com`\u7db2\u5740\uff09\uff0c\u8acb\u522a\u9664\u9805\u76ee\u5167\u7684\u6240\u9078\u8cc7\u6e90\uff0c\u800c\u4e0d\u662f\u522a\u9664\u6574\u500b\u9805\u76ee\u3002\n\u5982\u679c\u60a8\u6253\u7b97\u63a2\u7d22\u591a\u500b\u67b6\u69cb\u3001\u6559\u7a0b\u6216\u5feb\u901f\u5165\u9580\uff0c\u5247\u91cd\u8907\u4f7f\u7528\u9805\u76ee\u53ef\u4ee5\u5e6b\u52a9\u60a8\u907f\u514d\u8d85\u51fa\u9805\u76ee\u914d\u984d\u9650\u5236\u3002\n- \u522a\u9664 Google Cloud \u9805\u76ee\uff1a\n- ```\ngcloud projects delete PROJECT_ID\n```\n### \u522a\u9664\u5404\u500b\u8cc7\u6e90\n- \u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\u3002```\nexport PROJECT_ID=${PROJECT_ID}export KUBERNETES_CLUSTER_PREFIX=redisexport REGION=us-central1\n```\n- \u904b\u884c `terraform destroy` \u547d\u4ee4\uff1a```\nexport GOOGLE_OAUTH_ACCESS_TOKEN=$(gcloud auth print-access-token)cd terraform/gke-standardterraform destroy -var project_id=${PROJECT_ID} \u00a0 \\\u00a0 -var region=${REGION} \u00a0\\\u00a0 -var cluster_prefix=${KUBERNETES_CLUSTER_PREFIX}\n```\u51fa\u73fe\u63d0\u793a\u6642\uff0c\u8acb\u8f38\u5165 `yes` \u3002\n- \u67e5\u627e\u6240\u6709\u672a\u639b\u63a5\u7684\u78c1\u76e4\uff1a```\nexport disk_list=$(gcloud compute disks list --filter=\"-users:* AND labels.name=${KUBERNETES_CLUSTER_PREFIX}-cluster\" --format \"value[separator=|](name,zone)\")\n```\n- \u522a\u9664\u78c1\u76e4\uff1a```\nfor i in $disk_list; do\u00a0 disk_name=$(echo $i| cut -d'|' -f1)\u00a0 disk_zone=$(echo $i| cut -d'|' -f2|sed 's|.*/||')\u00a0 echo \"Deleting $disk_name\"\u00a0 gcloud compute disks delete $disk_name --zone $disk_zone --quietdone\n```\n- \u522a\u9664 GitHub \u4ee3\u78bc\u5eab\uff1a```\nrm -r ~/kubernetes-engine-samples/\n```\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u63a2\u7d22\u6709\u95dc Google Cloud \u7684\u53c3\u8003\u67b6\u69cb\u3001\u5716\u8868\u548c\u6700\u4f73\u505a\u6cd5\u3002\u67e5\u770b\u6211\u5011\u7684 [Cloud Architecture Center](https://cloud.google.com/architecture?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}