{"title": "Google Kubernetes Engine (GKE) - \u5728 GKE Standard \u7bc0\u9ede\u6c60\u4e2d\u904b\u884c GPU", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/gpus?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u5728 GKE Standard \u7bc0\u9ede\u6c60\u4e2d\u904b\u884c GPU\n\u672c\u9801\u9762\u4ecb\u7d39\u77ad\u5982\u4f55\u5728 Google Kubernetes Engine (GKE) Standard \u96c6\u7fa3\u7684 [\u7bc0\u9ede](https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture?hl=zh-cn#nodes) \u4e2d\u4f7f\u7528 NVIDIA\u00ae \u5716\u5f62\u8655\u7406\u5668 (GPU) \u786c\u4ef6\u52a0\u901f\u5668\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 GKE \u4e2d\u7684 GPU\uff0c\u8acb\u53c3\u95b1 [GKE \u4e2d\u7684 GPU \u7c21\u4ecb](https://cloud.google.com/kubernetes-engine/docs/concepts/gpus?hl=zh-cn) \u3002\n\u60a8\u9084\u53ef\u4ee5\u76f4\u63a5\u5728 Autopilot Pod \u4e2d\u4f7f\u7528 GPU\u3002\u5982\u9700\u67e5\u770b\u76f8\u95dc\u8aaa\u660e\uff0c\u8acb\u53c3\u95b1 [\u5728 Autopilot \u4e2d\u90e8\u7f72 GPU \u5de5\u4f5c\u8ca0\u8f09](https://cloud.google.com/kubernetes-engine/docs/how-to/autopilot-gpus?hl=zh-cn) \u3002\n", "content": "## \u6982\u89bd\n\u5229\u7528 GKE\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa\u914d\u5099\u4e86 NVIDIA Tesla\u00ae [K80](https://www.nvidia.com/en-gb/data-center/tesla-k80/) \u3001 [P100](http://www.nvidia.com/object/tesla-p100.html) \u3001 [P4](http://images.nvidia.com/content/pdf/tesla/184457-Tesla-P4-Datasheet-NV-Final-Letter-Web.pdf) \u3001 [V100](https://www.nvidia.com/en-us/data-center/tesla-v100/) \u3001 [T4](https://www.nvidia.com/en-us/data-center/tesla-t4/) \u3001 [L4](https://www.nvidia.com/en-us/data-center/l4/) \u548c [A100](https://www.nvidia.com/en-us/data-center/a100/) GPU \u7684 [\u7bc0\u9ede\u6c60](https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools?hl=zh-cn) \u3002GPU \u63d0\u4f9b\u7684\u8a08\u7b97\u80fd\u529b\u53ef\u7528\u65bc\u5b8c\u6210\u6df1\u5ea6\u5b78\u7fd2\u4efb\u52d9\uff0c\u5982\u5716\u7247\u8b58\u5225\u3001\u81ea\u7136\u8a9e\u8a00\u8655\u7406\uff0c\u4ee5\u53ca\u8996\u983b\u8f49\u78bc\u548c\u5716\u7247\u8655\u7406\u7b49\u5176\u4ed6\u8a08\u7b97\u5bc6\u96c6\u578b\u4efb\u52d9\u3002\n**\u6ce8\u610f** \uff1a\u5982\u9700\u8a73\u7d30\u77ad\u89e3 GPU \u7528\u4f8b\uff0c\u8acb\u53c3\u95b1 Google Cloud \u7684 [GPU](https://cloud.google.com/gpu?hl=zh-cn) \u9801\u9762\u3002\n\u5982\u679c\u60a8\u7684\u5de5\u4f5c\u8ca0\u8f09\u53ef\u4ee5\u5bb9\u5fcd\u983b\u7e41\u7684\u7bc0\u9ede\u4e2d\u65b7\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5c07 GPU \u7528\u65bc [Spot \u865b\u64ec\u6a5f](https://cloud.google.com/kubernetes-engine/docs/concepts/spot-vms?hl=zh-cn) \u3002\u4f7f\u7528 Spot \u865b\u64ec\u6a5f\u53ef\u964d\u4f4e\u904b\u884c GPU \u7684\u8cbb\u7528\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5c07 Spot \u865b\u64ec\u6a5f\u8207 GPU \u7bc0\u9ede\u6c60\u642d\u914d\u4f7f\u7528](https://cloud.google.com/kubernetes-engine/docs/concepts/spot-vms?hl=zh-cn#spot-vms-gpus) \u3002\n## \u6e96\u5099\u5de5\u4f5c\n\u5728\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u57f7\u884c\u4ee5\u4e0b\u4efb\u52d9\uff1a\n- \u5553\u7528 Google Kubernetes Engine API\u3002\n- [  \u5553\u7528 Google Kubernetes Engine API ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com&hl=zh-cn) \n- \u5982\u679c\u60a8\u8981\u4f7f\u7528 Google Cloud CLI \u57f7\u884c\u6b64\u4efb\u52d9\uff0c\u8acb [\u5b89\u88dd](https://cloud.google.com/sdk/docs/install?hl=zh-cn) \u4e26 [\u521d\u59cb\u5316](https://cloud.google.com/sdk/docs/initializing?hl=zh-cn) gcloud CLI\u3002 \u5982\u679c\u60a8\u4e4b\u524d\u5b89\u88dd\u4e86 gcloud CLI\uff0c\u8acb\u904b\u884c`gcloud components update`\u4ee5\u7372\u53d6\u6700\u65b0\u7248\u672c\u3002 **\u6ce8\u610f** \uff1a\u5c0d\u65bc\u73fe\u6709 gcloud CLI \u5b89\u88dd\uff0c\u8acb\u52d9\u5fc5\u8a2d\u7f6e`compute/region`\u548c`compute/zone` [\u5c6c\u6027](https://cloud.google.com/sdk/docs/properties?hl=zh-cn#setting_properties) \u3002\u901a\u904e\u8a2d\u7f6e\u9ed8\u8a8d\u4f4d\u7f6e\uff0c\u60a8\u53ef\u4ee5\u907f\u514d gcloud CLI \u4e2d\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a`One of [--zone, --region] must be supplied: Please specify location`\u3002\n### \u4f7f\u7528\u8981\u6c42\nGKE \u4e0a\u7684 GPU \u5177\u6709\u4ee5\u4e0b\u8981\u6c42\uff1a\n- **Kubernetes \u7248\u672c** \uff1a\u5c0d\u65bc\u4f7f\u7528 [Container-Optimized OS](https://cloud.google.com/kubernetes-engine/docs/concepts/node-images?hl=zh-cn) \u7bc0\u9ede\u6620\u50cf\u7684\u7bc0\u9ede\u6c60\uff0cGPU \u7bc0\u9ede\u9069\u7528\u65bc GKE [\u7248\u672c](https://cloud.google.com/kubernetes-engine/versioning-and-upgrades?hl=zh-cn#available_versions) 1.9 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u5c0d\u65bc\u4f7f\u7528 Ubuntu \u7bc0\u9ede\u6620\u50cf\u7684\u7bc0\u9ede\u6c60\uff0cGPU \u7bc0\u9ede\u9069\u7528\u65bc GKE \u7248\u672c 1.11.3 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- **GPU \u914d\u984d** \uff1a\u60a8\u5fc5\u9808\u5728\u6240\u9700\u5730\u5340\u64c1\u6709 [Compute Engine GPU \u914d\u984d](https://cloud.google.com/compute/quotas?hl=zh-cn#gpu_quota) \u624d\u80fd\u5275\u5efa GPU \u7bc0\u9ede\u3002\u5982\u9700\u78ba\u4fdd\u9805\u76ee\u4e2d\u6709\u5145\u8db3\u7684 GPU \u914d\u984d\uff0c\u8acb\u53c3\u95b1 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 [\u914d\u984d](https://console.cloud.google.com/iam-admin/quotas?hl=zh-cn) \u3002\u5982\u679c\u60a8\u9700\u8981\u984d\u5916\u7684 GPU \u914d\u984d\uff0c\u5247\u5fc5\u9808\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d [\u7533\u8acb GPU \u914d\u984d](#gpu_quota) \u3002\u5982\u679c\u60a8\u5df2\u6709\u7d50\u7b97\u8cec\u865f\uff0c\u5247\u5728\u60a8\u63d0\u4ea4\u7533\u8acb\u5f8c\uff0c\u60a8\u7684\u9805\u76ee\u61c9\u8a72\u6703\u81ea\u52d5\u7372\u5f97\u914d\u984d\u3002 **\u6ce8\u610f** \uff1a\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u514d\u8cbb\u8a66\u7528\u8cec\u865f\u4e0d\u6703\u7372\u5f97 GPU \u914d\u984d\u3002\n- **NVIDIA GPU \u9a45\u52d5\u7a0b\u5e8f** \uff1a\u5275\u5efa\u96c6\u7fa3\u6216\u7bc0\u9ede\u6c60\u6642\uff0c\u60a8\u53ef\u4ee5\u6307\u793a GKE \u6839\u64da\u60a8\u7684 GKE \u7248\u672c\u81ea\u52d5\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u5982\u679c\u60a8\u4e0d\u6307\u793a GKE \u81ea\u52d5\u5b89\u88dd GPU \u9a45\u52d5\u7a0b\u5e8f\uff0c\u5247\u5fc5\u9808 [\u624b\u52d5\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f](#installing_drivers) \u3002 \n- **A100 GPU** \uff1a\u53ea\u6709 [a2 \u6a5f\u5668\u985e\u578b](https://cloud.google.com/compute/docs/accelerator-optimized-machines?hl=zh-cn#a2-vms) \u652f\u6301 A100 GPU\uff0c\u4e26\u4e14\u9700\u8981 GKE 1.18.6-gke.3504 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u3002 \u60a8\u5fc5\u9808\u78ba\u4fdd\u5e95\u5c64 A2 \u6a5f\u5668\u985e\u578b\u6709\u8db3\u5920\u7684\u914d\u984d\u4f86\u4f7f\u7528 A100 GPU\u3002\n- **L4 GPU** \uff1a- \u60a8\u5fc5\u9808\u4f7f\u7528 GKE 1.22.17-gke.5400 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- \u60a8\u9078\u64c7\u7684 GKE \u7248\u672c\u5fc5\u9808\u5728 Container-Optimized OS \u4e2d\u5305\u542b NVIDIA \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c 525 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u5982\u679c\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c 525 \u6216\u66f4\u9ad8\u7248\u672c\u4e0d\u662f GKE \u7248\u672c\u4e2d\u7684\u9ed8\u8a8d\u7248\u672c\u6216\u6700\u65b0\u7248\u672c\uff0c\u5247\u5fc5\u9808\u5728\u7bc0\u9ede\u4e0a [\u624b\u52d5\u5b89\u88dd](#installing_drivers) \u53d7\u652f\u6301\u7684\u9a45\u52d5\u7a0b\u5e8f\u3002\n### \u9650\u5236\n\u5728\u4f7f\u7528 GKE \u4e0a\u7684 GPU \u4e4b\u524d\uff0c\u8acb\u6ce8\u610f\u4ee5\u4e0b\u9650\u5236\uff1a\n- \u60a8\u7121\u6cd5\u5c07 GPU \u6dfb\u52a0\u5230\u73fe\u6709\u7bc0\u9ede\u6c60\u3002\n- \u5728\u7dad\u8b77\u4e8b\u4ef6\u671f\u9593\uff0cGPU \u7bc0\u9ede\u7121\u6cd5\u9032\u884c [\u5be6\u6642\u9077\u79fb](https://cloud.google.com/compute/docs/instances/live-migration?hl=zh-cn#gpusmaintenance) \u3002\n- \u53ef\u4ee5\u4f7f\u7528\u7684 GPU \u985e\u578b\u53d6\u6c7a\u65bc\u6a5f\u5668\u7cfb\u5217\uff0c\u5982\u4e0b\u6240\u793a\uff1a- [A2 \u6a5f\u5668\u7cfb\u5217](https://cloud.google.com/compute/docs/accelerator-optimized-machines?hl=zh-cn#a2-vms) \uff1aA100 GPU\u3002\n- [G2 \u6a5f\u5668\u7cfb\u5217](https://cloud.google.com/compute/docs/accelerator-optimized-machines?hl=zh-cn#g2-vms) \uff1aL4 GPU\u3002\n- [N1 \u6a5f\u5668\u7cfb\u5217](https://cloud.google.com/compute/docs/machine-types?hl=zh-cn#n1_machine_types) \uff1a\u9664 A100 \u548c L4 \u4e4b\u5916\u7684\u6240\u6709 GPU\u3002\n\u60a8\u61c9\u8a72\u78ba\u4fdd\u60a8\u7684\u9805\u76ee\u4e2d\u6709\u8db3\u5920\u7684\u914d\u984d\u7528\u65bc\u8207\u60a8\u9078\u64c7\u7684 GPU \u985e\u578b\u548c\u6578\u91cf\u5c0d\u61c9\u7684\u6a5f\u5668\u7cfb\u5217\u3002\n- Windows Server \u7bc0\u9ede\u6c60\u4e0d\u652f\u6301 GPU\u3002\n- \u5728 GKE 1.22 \u5230 1.25 \u7248\u672c\u4e2d\uff0c\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e\u5668\u50c5\u652f\u6301\u5c0d L4 GPU \u7684\u7bc0\u9ede\u9032\u884c\u57fa\u672c\u7e31\u5411\u64f4\u5bb9\u548c\u7e2e\u5bb9\u3002\u6b64\u9650\u5236\u4e0d\u9069\u7528\u65bc GKE 1.26 \u53ca\u66f4\u9ad8\u7248\u672c\u3002\n### \u662f\u5426\u7a7a\u9592\nGPU \u50c5\u5728\u7279\u5b9a [\u5340\u57df\u548c\u53ef\u7528\u5340](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn) \u53ef\u7528\u3002\u7576\u60a8 [\u7533\u8acb GPU \u914d\u984d](#request_quota) \u6642\uff0c\u8acb\u8003\u616e\u8981\u5728\u54ea\u4e9b\u5340\u57df\u904b\u884c\u96c6\u7fa3\u3002\n\u5982\u9700\u67e5\u770b\u9069\u7528\u5340\u57df\u548c\u53ef\u7528\u5340\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [Compute Engine \u4e0a\u7684 GPU](https://cloud.google.com/compute/docs/gpus?hl=zh-cn) \u3002\n\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 Google Cloud CLI \u67e5\u770b\u60a8\u7684\u53ef\u7528\u5340\u4e2d\u53ef\u7528\u7684 GPU\u3002\u5982\u9700\u67e5\u770b\u6bcf\u500b\u53ef\u7528\u5340\u652f\u6301\u7684\u6240\u6709 GPU \u52a0\u901f\u5668\u985e\u578b\u7684\u5217\u8868\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ngcloud compute accelerator-types list\n```\n### \u50f9\u683c\n\u5982\u9700\u77ad\u89e3 GPU \u50f9\u683c\u4fe1\u606f\uff0c\u8acb\u53c3\u95b1 Google Cloud GPU \u9801\u9762\u4e0a\u7684 [\u50f9\u683c\u8868](https://cloud.google.com/compute/gpus-pricing?hl=zh-cn) \u3002\n## GPU \u914d\u984d\n\u60a8\u7684 GPU \u914d\u984d\u662f\u53ef\u5728 [Google Cloud \u9805\u76ee](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy?hl=zh-cn#projects) \u4e2d\u904b\u884c\u7684 GPU \u7684\u7e3d\u6578\u3002\u8981\u5275\u5efa\u4f7f\u7528 GPU \u7684\u96c6\u7fa3\uff0c\u60a8\u7684\u9805\u76ee\u5fc5\u9808\u64c1\u6709\u8db3\u5920\u7684 GPU \u914d\u984d\u3002\n\u60a8\u7684 GPU \u914d\u984d\u81f3\u5c11\u61c9\u8a72\u7b49\u65bc\u60a8\u6253\u7b97\u5728\u96c6\u7fa3\u4e2d\u904b\u884c\u7684 GPU \u7684\u7e3d\u6578\u3002\u5982\u679c\u60a8\u5553\u7528 [\u96c6\u7fa3\u81ea\u52d5\u64f4\u7e2e](https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler?hl=zh-cn) \u529f\u80fd\uff0c\u5247\u7533\u8acb\u7684 GPU \u914d\u984d\u81f3\u5c11\u61c9\u8a72\u7b49\u65bc\u96c6\u7fa3\u7684\u6700\u5927\u7bc0\u9ede\u6578\u4e58\u4ee5\u6bcf\u500b\u7bc0\u9ede\u7684 GPU \u6578\u6240\u5f97\u7684\u503c\u3002\n\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5275\u5efa\u4e00\u500b\u5305\u542b\u4e09\u500b\u7bc0\u9ede\u7684\u96c6\u7fa3\uff0c\u6bcf\u500b\u7bc0\u9ede\u904b\u884c\u5169\u500b GPU\uff0c\u5247\u60a8\u7684\u9805\u76ee\u81f3\u5c11\u9700\u8981\u516d\u500b GPU \u914d\u984d\u3002\n### \u7533\u8acb GPU \u914d\u984d\n\u5982\u9700\u7533\u8acb GPU \u914d\u984d\uff0c\u8acb\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u7533\u8acb\u914d\u984d\uff0c\u8acb\u53c3\u95b1 Compute Engine \u6587\u6a94\u4e2d\u7684 [GPU \u914d\u984d](https://cloud.google.com/compute/resource-usage?hl=zh-cn#gpu_quota) \u3002\n\u5982\u9700\u641c\u7d22 GPU \u914d\u984d\u4e26\u63d0\u4ea4\u914d\u984d\u7533\u8acb\uff0c\u8acb\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\uff1a\n- \u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 IAM \u548c\u7ba1\u7406 **\u914d\u984d** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u914d\u984d\u201d](https://console.cloud.google.com/iam-admin/quotas?hl=zh-cn) \n- \u5728 **\u904e\u6ffe\u689d\u4ef6** \u6846\u4e2d\uff0c\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u9078\u64c7 **\u914d\u984d** \u5c6c\u6027\uff0c\u8f38\u5165 [GPU \u6a21\u578b](https://cloud.google.com/compute/docs/gpus?hl=zh-cn#nvidia_gpus_for_compute_workloads) \u7684\u540d\u7a31\uff0c\u7136\u5f8c\u6309 **Enter** \u9375\u3002\n- \uff08\u53ef\u9078\uff09\u5982\u9700\u61c9\u7528\u66f4\u9ad8\u7d1a\u7684\u904e\u6ffe\u689d\u4ef6\u4f86\u7e2e\u5c0f\u7d50\u679c\u7bc4\u570d\uff0c\u8acb\u9078\u64c7 **\u7dad\u5ea6\uff08\u5982\u4f4d\u7f6e\uff09** \u5c6c\u6027\uff0c\u6dfb\u52a0 [\u60a8\u6b63\u5728\u4f7f\u7528\u7684\u5340\u57df\u6216\u53ef\u7528\u5340](https://cloud.google.com/compute/docs/gpus/gpu-regions-zones?hl=zh-cn) \u7684\u540d\u7a31\uff0c\u7136\u5f8c\u6309 **Enter** \u9375\u3002\n- \u5f9e GPU \u914d\u984d\u5217\u8868\u4e2d\uff0c\u9078\u64c7\u8981\u66f4\u6539\u7684\u914d\u984d\u3002\n- \u9ede\u64ca **\u4fee\u6539\u914d\u984d** \u3002\u7cfb\u7d71\u6703\u6253\u958b\u7533\u8acb\u8868\u55ae\u3002\n- \u586b\u5beb\u6bcf\u500b\u914d\u984d\u7533\u8acb\u7684 **\u65b0\u914d\u984d\u4e0a\u9650** \u5b57\u6bb5\u3002\n- \u5728 **\u7533\u8acb\u8aaa\u660e** \u5b57\u6bb5\u4e2d\uff0c\u586b\u5beb\u6709\u95dc\u60a8\u7684\u7533\u8acb\u7684\u8a73\u7d30\u4fe1\u606f\u3002\n- \u9ede\u64ca **\u4e0b\u4e00\u6b65** \u3002\n- \u5728 **\u66ff\u63db\u78ba\u8a8d** \u5c0d\u8a71\u6846\u4e2d\uff0c\u9ede\u64ca **\u78ba\u8a8d** \u3002\n- \u5728 **\u8a73\u7d30\u806f\u7e6b\u4fe1\u606f** \u5c4f\u5e55\u4e2d\uff0c\u8f38\u5165\u60a8\u7684\u59d3\u540d\u548c\u96fb\u8a71\u865f\u78bc\uff0c\u4f9b\u5be9\u6279\u4eba\u7528\u4f86\u5b8c\u6210\u914d\u984d\u66f4\u6539\u8acb\u6c42\u3002\n- \u9ede\u64ca **\u63d0\u4ea4\u8acb\u6c42** \u3002\n- \u60a8\u6703\u6536\u5230\u78ba\u8a8d\u96fb\u5b50\u90f5\u4ef6\u4ee5\u8ddf\u8e64\u914d\u984d\u66f4\u6539\u3002## \u904b\u884c GPU\n\u5982\u9700\u5728 GKE Standard \u96c6\u7fa3\u4e2d\u904b\u884c GPU\uff0c\u8acb\u5275\u5efa\u639b\u63a5\u4e86 GPU \u7684\u7bc0\u9ede\u6c60\u3002\u7576\u60a8\u5c07 GPU \u7bc0\u9ede\u6c60\u6dfb\u52a0\u5230\u5df2\u904b\u884c\u975e GPU \u7bc0\u9ede\u6c60\u7684\u73fe\u6709\u96c6\u7fa3\u6642\uff0cGKE \u6703\u81ea\u52d5\u7232 GPU \u7bc0\u9ede [\u6dfb\u52a0](https://cloud.google.com/kubernetes-engine/docs/how-to/node-taints?hl=zh-cn) \u4ee5\u4e0b\u7bc0\u9ede\u6c61\u9ede\uff1a\n- **\u9375** \uff1a`nvidia.com/gpu`\n- **\u6548\u679c** \uff1a`NoSchedule`\n**\u6ce8\u610f** \uff1a\u53ea\u6709\u96c6\u7fa3\u4e2d\u5b58\u5728\u975e GPU \u7bc0\u9ede\u6c60\u6642\uff0cGKE \u7e94\u6703\u6dfb\u52a0\u6b64\u6c61\u9ede\u3002\u5982\u679c\u60a8\u5411\u6240\u6709\u73fe\u6709\u7bc0\u9ede\u6c60\u90fd\u662f GPU \u7bc0\u9ede\u6c60\u7684\u96c6\u7fa3\u6dfb\u52a0 GPU \u7bc0\u9ede\u6c60\uff0c\u6216\u8005\u5982\u679c\u60a8\u5275\u5efa\u4e00\u500b\u9ed8\u8a8d\u7bc0\u9ede\u6c60\u639b\u63a5\u4e86 GPU \u7684\u65b0\u96c6\u7fa3\uff0c\u5247\u4e0a\u8ff0\u6c61\u9ede **\u4e0d\u6703** \u6dfb\u52a0\u5230 GPU \u7bc0\u9ede\u3002\u5982\u679c\u60a8\u65e5\u5f8c\u5411\u96c6\u7fa3\u6dfb\u52a0\u975e GPU \u7bc0\u9ede\u6c60\uff0c\u5247 GKE **\u4e0d\u6703** \u4ee5\u8ffd\u6eaf\u65b9\u5f0f\u5c07\u6b64\u6c61\u9ede\u61c9\u7528\u65bc\u73fe\u6709 GPU \u7bc0\u9ede\u3002\n\u6b64\u5916\uff0cGKE \u901a\u904e\u904b\u884c [ExtendedResourceToleration](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#extendedresourcetoleration) \u51c6\u5165\u63a7\u5236\u5668\u81ea\u52d5\u5c07\u76f8\u61c9\u7684\u5bb9\u5fcd\u8a2d\u7f6e\u61c9\u7528\u65bc\u8acb\u6c42 GPU \u7684 Pod\u3002\n\u6b64\u64cd\u4f5c\u6703\u5c0e\u81f4\u5728 GPU \u7bc0\u9ede\u4e0a\u50c5\u8abf\u5ea6\u8acb\u6c42 GPU \u7684 Pod\uff0c\u9019\u6a23\u53ef\u5be6\u73fe\u66f4\u9ad8\u6548\u7684\u81ea\u52d5\u64f4\u7e2e\uff1a\u5982\u679c\u6c92\u6709\u8db3\u5920\u7684 Pod \u8acb\u6c42 GPU\uff0c\u5247 GPU \u7bc0\u9ede\u53ef\u4ee5\u5feb\u901f\u7e2e\u6e1b\u3002\n\u7232\u4e86\u5728 GKE \u4e0a\u63d0\u9ad8 GPU \u7684\u6210\u672c\u6548\u76ca\u3001\u53ef\u9760\u6027\u548c\u53ef\u7528\u6027\uff0c\u6211\u5011\u5efa\u8b70\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5275\u5efa\u55ae\u7368\u7684 GPU \u7bc0\u9ede\u6c60\u3002\u5c0d\u65bc\u6bcf\u500b\u7bc0\u9ede\u6c60\uff0c\u5c07\u7bc0\u9ede\u4f4d\u7f6e\u9650\u5236\u7232\u53ef\u4f7f\u7528 GPU \u7684\u53ef\u7528\u5340\u3002\n- \u5728\u6bcf\u500b\u7bc0\u9ede\u6c60\u4e2d\u5553\u7528\u81ea\u52d5\u64f4\u7e2e\u3002\n- \u4f7f\u7528\u5340\u57df\u7d1a\u96c6\u7fa3\u8de8\u5340\u57df\u4e2d\u7684\u53ef\u7528\u5340\u8907\u88fd Kubernetes \u63a7\u5236\u5e73\u9762\uff0c\u5f9e\u800c\u63d0\u9ad8\u53ef\u7528\u6027\u3002\n- \u6307\u793a GKE \u81ea\u52d5\u5728\u7bc0\u9ede\u6c60\u4e0a\u5b89\u88dd\u9ed8\u8a8d\u6216\u6700\u65b0 GPU \u9a45\u52d5\u7a0b\u5e8f\uff0c\u9019\u6a23\u60a8\u5c31\u7121\u9700\u624b\u52d5\u5b89\u88dd\u548c\u7ba1\u7406\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\n### \u5275\u5efa GPU \u7bc0\u9ede\u6c60\n\u5982\u9700\u5728\u73fe\u6709\u96c6\u7fa3\u4e2d\u5275\u5efa\u55ae\u7368\u7684 GPU \u7bc0\u9ede\u6c60\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u6216 Google Cloud CLI\u3002\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 Terraform \u9810\u914d GKE \u96c6\u7fa3\u548c GPU \u7bc0\u9ede\u6c60\u3002\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f gcloud CLI \u6216 Terraform\uff0c\u53ef\u4ee5\u6307\u793a GKE \u81ea\u52d5\u5b89\u88dd\u8207 Container-Optimized OS \u7248\u672c\u5c0d\u61c9\u7684\u9ed8\u8a8d\u6216\u6700\u65b0 NVIDIA \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u5982\u679c\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\uff0c\u5247\u5fc5\u9808\u5728\u5275\u5efa\u7bc0\u9ede\u6c60\u5f8c\u624b\u52d5\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f\u3002\n\u8981\u5728\u96c6\u7fa3\u4e2d\u5275\u5efa\u5177\u6709 GPU \u7684\u7bc0\u9ede\u6c60\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ngcloud container node-pools create POOL_NAME \\\u00a0 --accelerator type=GPU_TYPE,count=AMOUNT,gpu-driver-version=DRIVER_VERSION \\\u00a0 [--machine-type MACHINE_TYPE] \\\u00a0 --region COMPUTE_REGION --cluster CLUSTER_NAME \\\u00a0 --node-locations COMPUTE_ZONE1[,COMPUTE_ZONE2] \\\u00a0 [--num-nodes NUM_NODES] \\\u00a0 [--enable-autoscaling \\\u00a0 \u00a0--min-nodes MIN_NODES \\\u00a0 \u00a0--max-nodes MAX_NODES]\n```\n\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u60a8\u7232\u7bc0\u9ede\u6c60\u9078\u64c7\u7684\u540d\u7a31\u3002\n- ``\uff1aGPU \u985e\u578b\u3002\u53ef\u4ee5\u662f\u4e0b\u5217\u9078\u9805\u4e4b\u4e00\uff1a\n- `nvidia-tesla-k80`\n- `nvidia-tesla-p100`\n- `nvidia-tesla-p4`\n- `nvidia-tesla-v100`\n- `nvidia-tesla-t4`\n- `nvidia-tesla-a100`\n- `nvidia-a100-80gb`\n- `nvidia-l4`\n- `` \uff1a\u8981\u5b89\u88dd\u7684 NVIDIA \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u53ef\u4ee5\u662f\u4e0b\u5217\u9078\u9805\u4e4b\u4e00\uff1a- `default`\uff1a\u7232\u60a8\u7684 GKE \u7248\u672c\u5b89\u88dd\u9ed8\u8a8d\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\n- `latest`\uff1a\u7232\u60a8\u7684 GKE \u7248\u672c\u5b89\u88dd\u6700\u65b0\u53ef\u7528\u7684\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u50c5\u9069\u7528\u65bc\u4f7f\u7528 Container-Optimized OS \u7684\u7bc0\u9ede\u3002\n- `disabled`\uff1a\u8df3\u904e\u81ea\u52d5\u9a45\u52d5\u7a0b\u5e8f\u5b89\u88dd\u3002\u5275\u5efa\u7bc0\u9ede\u6c60\u5f8c\uff0c\u60a8 **\u5fc5\u9808** [\u624b\u52d5\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f](#installing_drivers) \u3002 \u5982\u679c\u60a8\u7701\u7565`gpu-driver-version`\uff0c\u5247\u9019\u662f\u9ed8\u8a8d\u9078\u9805\u3002\n **\u6ce8\u610f** \uff1a `gpu-driver-version` \u9078\u9805\u50c5\u9069\u7528\u65bc GKE 1.27.2-gke.1200 \u7248\u53ca\u66f4\u9ad8\u7248\u672c\u3002\u5728\u65e9\u671f\u7248\u672c\u4e2d\uff0c\u8acb\u7701\u7565\u6b64\u6a19\u8a8c\u4e26\u5728\u5275\u5efa\u7bc0\u9ede\u6c60\u5f8c [\u624b\u52d5\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f](#installing_drivers) \u3002\u5982\u679c\u60a8\u5c07\u73fe\u6709\u96c6\u7fa3\u6216\u7bc0\u9ede\u6c60\u5347\u7d1a\u5230\u6b64\u7248\u672c\u6216\u66f4\u9ad8\u7248\u672c\uff0cGKE \u6703\u81ea\u52d5\u5b89\u88dd\u8207 GKE \u7248\u672c\u5c0d\u61c9\u7684\u9ed8\u8a8d\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\uff0c\u9664\u975e\u60a8\u5728\u958b\u59cb\u5347\u7d1a\u6642\u6307\u5b9a\u4e0d\u540c\u7684\u7248\u672c\u3002\n- `` \uff1a\u8981\u639b\u63a5\u5230\u7bc0\u9ede\u6c60\u4e2d\u7bc0\u9ede\u7684 GPU \u6578\u91cf\u3002\n- `` \uff1a\u7bc0\u9ede\u7684 Compute Engine \u6a5f\u5668\u985e\u578b\u3002\u5728 `GPU_TYPE` \u7232 `nvidia-tesla-a100` \u6216 `nvidia-a100-80gb` \uff08\u53ea\u80fd\u4f7f\u7528 [A2 \u6a5f\u5668\u985e\u578b](https://cloud.google.com/compute/docs/accelerator-optimized-machines?hl=zh-cn#a2-vms) \uff09\u6216\u8005 `GPU_TYPE` \u7232 `nvidia-l4` \uff08\u53ea\u80fd\u4f7f\u7528 [G2 \u6a5f\u5668\u985e\u578b](https://cloud.google.com/compute/docs/accelerator-optimized-machines?hl=zh-cn#g2-vms) \uff09\u6642\u5fc5\u9700\u3002\u5c0d\u65bc\u6240\u6709\u5176\u4ed6 GPU\uff0c\u6b64\u6a19\u8a8c\u662f\u53ef\u9078\u7684\u3002\n- `` \uff1a\u96c6\u7fa3\u7684 Compute Engine \u5340\u57df\uff0c\u4f8b\u5982 `us-central1` \u3002\u9078\u64c7\u4e00\u500b\u5340\u57df\uff0c\u8a72\u5340\u57df\u81f3\u5c11\u6709\u4e00\u500b\u63d0\u4f9b\u8acb\u6c42\u7684 GPU \u7684\u53ef\u7528\u5340\u3002\n- `` \uff1a\u8981\u5728\u5176\u4e2d\u5275\u5efa\u7bc0\u9ede\u6c60\u7684\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- `` `,` `` `,[...]` \uff1aGKE \u5728\u5176\u4e2d\u5275\u5efa GPU \u7bc0\u9ede\u7684\u7279\u5b9a [\u53ef\u7528\u5340](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#available) \u3002\u53ef\u7528\u5340\u5fc5\u9808\u8207\u96c6\u7fa3\u4f4d\u65bc\u540c\u4e00\u5340\u57df\uff0c\u7531 `--region` \u6a19\u8a8c\u6307\u5b9a\u3002\u60a8\u5b9a\u7fa9\u7684 GPU \u985e\u578b\u5fc5\u9808\u5728\u6bcf\u500b\u6240\u9078\u53ef\u7528\u5340\u4e2d [\u53ef\u7528](#availability) \u3002\u6211\u5011\u5efa\u8b70\u60a8\u5728\u5275\u5efa\u7bc0\u9ede\u6c60\u6642\u59cb\u7d42\u4f7f\u7528 `--node-locations` \u6a19\u8a8c\uff0c\u4ee5\u6307\u5b9a\u5305\u542b\u6240\u8acb\u6c42 GPU \u7684\u4e00\u500b\u6216\u591a\u500b\u53ef\u7528\u5340\u3002\n- `` \uff1a\u8981\u5275\u5efa\u7684\u521d\u59cb\u7bc0\u9ede\u6578\u3002\n- `` \uff1a\u4efb\u4f55\u6642\u5019\u7bc0\u9ede\u6c60\u4e2d\u6bcf\u500b\u53ef\u7528\u5340\u7684\u7bc0\u9ede\u6578\u4e0b\u9650\u3002\u50c5\u7576\u4f7f\u7528 `--enable-autoscaling` \u6a19\u8a8c\u6642\uff0c\u6b64\u503c\u624d\u76f8\u95dc\u3002\n- `` \uff1a\u4efb\u4f55\u6642\u5019\u7bc0\u9ede\u6c60\u4e2d\u6bcf\u500b\u53ef\u7528\u5340\u7684\u7bc0\u9ede\u6578\u4e0a\u9650\u3002\u50c5\u7576\u4f7f\u7528 `--enable-autoscaling` \u6a19\u8a8c\u6642\uff0c\u6b64\u503c\u624d\u76f8\u95dc\u3002\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u547d\u4ee4\u6703\u5728\u5340\u57df\u7d1a\u96c6\u7fa3 `p100-cluster` \u4e2d\u5275\u5efa\u4e00\u500b\u9ad8\u53ef\u7528\u6027\u81ea\u52d5\u64f4\u7e2e\u7bc0\u9ede\u6c60 `p100` \uff0c\u6bcf\u500b\u7bc0\u9ede\u6709\u5169\u500b P100 GPU\u3002GKE \u6703\u81ea\u52d5\u5728\u9019\u4e9b\u7bc0\u9ede\u4e0a\u5b89\u88dd\u9ed8\u8a8d\u9a45\u52d5\u7a0b\u5e8f\u3002\n```\ngcloud container node-pools create p100 \\\u00a0 --accelerator type=nvidia-tesla-p100,count=2,gpu-driver-version=default \\\u00a0 --region us-central1 --cluster p100-cluster \\\u00a0 --node-locations us-central1-c \\\u00a0 --num-nodes 3 --min-nodes 0 --max-nodes 5 --enable-autoscaling\n```\n\u5982\u9700\u5275\u5efa\u5177\u6709 GPU \u7684\u7bc0\u9ede\u6c60\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a- \u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **Google Kubernetes Engine** \u9801\u9762\u3002 [\u524d\u5f80 Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list?hl=zh-cn) \n- \u5728\u96c6\u7fa3\u5217\u8868\u4e2d\uff0c\u9ede\u64ca\u60a8\u8981\u4fee\u6539\u7684\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \u9ede\u64ca **\u6dfb\u52a0\u7bc0\u9ede\u6c60** \u3002\n- \uff08\u53ef\u9078\uff09\u5728 **\u7bc0\u9ede\u6c60\u8a73\u60c5** \u9801\u9762\u4e0a\uff0c\u9078\u4e2d **\u5553\u7528\u81ea\u52d5\u64f4\u7e2e** \u8907\u9078\u6846\u3002\n- \u6839\u64da\u9700\u8981\u914d\u7f6e\u60a8\u7684\u7bc0\u9ede\u6c60\u3002\n- \u5728\u5c0e\u822a\u7a97\u683c\u4e2d\uff0c\u9078\u64c7 **\u7bc0\u9ede** \u3002\n- \u5728 **\u6a5f\u5668\u914d\u7f6e** \u4e0b\uff0c\u9ede\u64ca **GPU** \u3002\n- \u9078\u64c7\u8981\u5728\u6bcf\u500b\u7bc0\u9ede\u4e0a\u904b\u884c\u7684 **GPU \u985e\u578b** \u548c **GPU \u6578\u91cf** \u3002\n- \u95b1\u8b80\u8b66\u544a\uff0c\u7136\u5f8c\u9078\u64c7 **\u6211\u77ad\u89e3\u9019\u4e9b\u9650\u5236** \u3002\n- \u9ede\u64ca **\u5275\u5efa** \u3002\n\u5275\u5efa\u7bc0\u9ede\u6c60\u5f8c\uff0c\u60a8\u5fc5\u9808\u624b\u52d5\u5b89\u88dd GPU \u9a45\u52d5\u7a0b\u5e8f\u3002\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u8acb\u53c3\u95b1 [\u624b\u52d5\u5b89\u88dd NVIDIA GPU \u9a45\u52d5\u7a0b\u5e8f](#installing_drivers) \u3002\n\u60a8\u53ef\u4ee5\u901a\u904e [Terraform \u6a21\u584a](https://github.com/terraform-google-modules/terraform-google-kubernetes-engine) \u5275\u5efa\u4e00\u500b\u4f7f\u7528\u5177\u6709 GPU \u7684 Terraform \u7684\u5340\u57df\u7d1a\u96c6\u7fa3\u3002- \u901a\u904e\u5728 `variables.tf` \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u584a\u4f86\u8a2d\u7f6e Terraform \u8b8a\u91cf\uff1a```\nvariable \"project_id\" {\u00a0 default \u00a0 \u00a0 = PROJECT_ID\u00a0 description = \"the gcp_name_short project where GKE creates the cluster\"}variable \"region\" {\u00a0 default \u00a0 \u00a0 = CLUSTER_REGION\u00a0 description = \"the gcp_name_short region where GKE creates the cluster\"}variable \"zone\" {\u00a0 default \u00a0 \u00a0 = \"COMPUTE_ZONE1,COMPUTE_ZONE2\"\u00a0 description = \"the GPU nodes zone\"}variable \"cluster_name\" {\u00a0 default \u00a0 \u00a0 = \"CLUSTER_NAME\"\u00a0 description = \"the name of the cluster\"}variable \"gpu_type\" {\u00a0 default \u00a0 \u00a0 = \"GPU_TYPE\"\u00a0 description = \"the GPU accelerator type\"}variable \"gpu_driver_version\" {\u00a0 default = \"DRIVER_VERSION\"\u00a0 description = \"the NVIDIA driver version to install\"}\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u60a8\u7684\u9805\u76ee ID\u3002\n- ``\uff1aGKE \u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u96c6\u7fa3\u7684 [\u8a08\u7b97\u5340\u57df](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#available) \u3002\n- `` `,` `` `,[...]`\uff1aGKE \u5728\u5176\u4e2d\u5275\u5efa GPU \u7bc0\u9ede\u7684\u7279\u5b9a [\u53ef\u7528\u5340](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#available) \u3002\u53ef\u7528\u5340\u5fc5\u9808\u5728`region`\u8b8a\u91cf\u6307\u5b9a\u7684\u5340\u57df\u5167\u3002\u9019\u4e9b\u53ef\u7528\u5340\u5fc5\u9808\u5177\u6709\u60a8\u5b9a\u7fa9\u7684 GPU \u985e\u578b\u3002\u5982\u9700\u77ad\u89e3\u54ea\u4e9b\u53ef\u7528\u5340\u5177\u6709 GPU\uff0c\u8acb\u53c3\u95b1 [\u53ef\u7528\u6027](#availability) \u3002\u5728\u5275\u5efa GPU \u7bc0\u9ede\u6c60\u6642\uff0c\u61c9\u4f7f\u7528`node_locations`\u8b8a\u91cf\u4f86\u6307\u5b9a\u5305\u542b\u6240\u8acb\u6c42 GPU \u7684\u4e00\u500b\u6216\u591a\u500b\u53ef\u7528\u5340\u3002\n- `` \uff1aGPU \u985e\u578b\u3002\u53ef\u4ee5\u662f\u4e0b\u5217\u9078\u9805\u4e4b\u4e00\uff1a- `nvidia-tesla-k80`\n- `nvidia-tesla-p100`\n- `nvidia-tesla-p4`\n- `nvidia-tesla-v100`\n- `nvidia-tesla-t4`\n- `nvidia-tesla-a100`\n- `nvidia-a100-80gb`\n- `nvidia-l4`\n- `` \uff1aGKE \u81ea\u52d5\u5b89\u88dd\u7684 GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u6b64\u5b57\u6bb5\u662f\u53ef\u9078\u5b57\u6bb5\u3002 \u652f\u6301\u4ee5\u4e0b\u503c\uff1a- `INSTALLATION_DISABLED`\uff1a\u505c\u7528 GPU \u9a45\u52d5\u7a0b\u5e8f\u81ea\u52d5\u5b89\u88dd\u3002 \u60a8 **\u5fc5\u9808** \u624b\u52d5\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f\u624d\u80fd\u904b\u884c GPU\u3002\n- `DEFAULT`\uff1a\u81ea\u52d5\u5b89\u88dd\u8207\u7bc0\u9ede\u64cd\u4f5c\u7cfb\u7d71\u7248\u672c\u5c0d\u61c9\u7684\u9ed8\u8a8d\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\n- `LATEST`\uff1a\u81ea\u52d5\u5b89\u88dd\u7bc0\u9ede\u64cd\u4f5c\u7cfb\u7d71\u7248\u672c\u53ef\u7528\u7684\u6700\u65b0\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u5982\u679c\u7701\u7565\u6b64\u5b57\u6bb5\uff0cGKE \u4e0d\u6703\u81ea\u52d5\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f\u3002\u4f7f\u7528\u7bc0\u9ede\u81ea\u52d5\u9810\u914d\u529f\u80fd\u7684\u7bc0\u9ede\u6c60\u4e0d\u652f\u6301\u6b64\u5b57\u6bb5\u3002\u5982\u9700\u624b\u52d5\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f\uff0c\u8acb\u53c3\u95b1\u672c\u6587\u6a94\u4e2d\u7684 [\u624b\u52d5\u5b89\u88dd NVIDIA GPU \u9a45\u52d5\u7a0b\u5e8f](#installing_drivers) \u3002\n- \u5c07\u4ee5\u4e0b\u584a\u6dfb\u52a0\u5230 Terraform \u914d\u7f6e\u4e2d\uff1a```\nprovider \"google\" {\u00a0 project = var.project_id\u00a0 region \u00a0= var.region}resource \"google_container_cluster\" \"ml_cluster\" {\u00a0 name \u00a0 \u00a0 = var.cluster_name\u00a0 location = var.region\u00a0 node_locations = [var.zone]}resource \"google_container_node_pool\" \"gpu_pool\" {\u00a0 name \u00a0 \u00a0 \u00a0 = google_container_cluster.ml_cluster.name\u00a0 location \u00a0 = var.region\u00a0 cluster \u00a0 \u00a0= google_container_cluster.ml_cluster.name\u00a0 node_count = 3\u00a0 autoscaling {\u00a0 \u00a0 total_min_node_count = \"1\"\u00a0 \u00a0 total_max_node_count = \"5\"\u00a0 }\u00a0 management {\u00a0 \u00a0 auto_repair \u00a0= \"true\"\u00a0 \u00a0 auto_upgrade = \"true\"\u00a0 }\u00a0 node_config {\u00a0 \u00a0 oauth_scopes = [\u00a0 \u00a0 \u00a0 \"https://www.googleapis.com/auth/logging.write\",\u00a0 \u00a0 \u00a0 \"https://www.googleapis.com/auth/monitoring\",\u00a0 \u00a0 \u00a0 \"https://www.googleapis.com/auth/devstorage.read_only\",\u00a0 \u00a0 \u00a0 \"https://www.googleapis.com/auth/trace.append\",\u00a0 \u00a0 \u00a0 \"https://www.googleapis.com/auth/service.management.readonly\",\u00a0 \u00a0 \u00a0 \"https://www.googleapis.com/auth/servicecontrol\",\u00a0 \u00a0 ]\u00a0 \u00a0 labels = {\u00a0 \u00a0 \u00a0 env = var.project_id\u00a0 \u00a0 }\u00a0 \u00a0 guest_accelerator {\u00a0 \u00a0 \u00a0 type \u00a0= var.gpu_type\u00a0 \u00a0 \u00a0 count = 1\u00a0 \u00a0 \u00a0 gpu_driver_installation_config {\u00a0 \u00a0 \u00a0 \u00a0 gpu_driver_version = var.gpu_driver_version\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 \u00a0 image_type \u00a0 = \"cos_containerd\"\u00a0 \u00a0 machine_type = \"n1-standard-1\"\u00a0 \u00a0 tags \u00a0 \u00a0 \u00a0 \u00a0 = [\"gke-node\", \"${var.project_id}-gke\"]\u00a0 \u00a0 disk_size_gb = \"30\"\u00a0 \u00a0 disk_type \u00a0 \u00a0= \"pd-standard\"\u00a0 \u00a0 metadata = {\u00a0 \u00a0 \u00a0 disable-legacy-endpoints = \"true\"\u00a0 \u00a0 }\u00a0 }}\n```\nTerraform \u6703\u8abf\u7528 Google Cloud API\uff0c\u4ee5\u8a2d\u7f6e\u4e00\u500b\u5305\u542b\u4f7f\u7528 GPU \u7684\u7bc0\u9ede\u6c60\u7684\u65b0\u96c6\u7fa3\u3002\u7bc0\u9ede\u6c60\u6700\u521d\u6709\u4e09\u500b\u7bc0\u9ede\uff0c\u4e26\u4e14\u5553\u7528\u4e86\u81ea\u52d5\u64f4\u7e2e\u529f\u80fd\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Terraform\uff0c\u8acb\u53c3\u95b1 [google_container_node_pool \u8cc7\u6e90\u898f\u7bc4](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster) \u3002\n **\u6ce8\u610f** \uff1a\u8acb\u79fb\u9664\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b9a\u7fa9\u7684\u6240\u6709\u8cc7\u6e90\uff0c\u4ee5\u514d\u7522\u751f\u4efb\u4f55\u984d\u5916\u8cbb\u7528\uff1a `terraform destroy` \u3002\n\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 GPU \u5275\u5efa\u65b0\u96c6\u7fa3\uff0c\u4e26\u4f7f\u7528 [--node-locations](https://cloud.google.com/sdk/gcloud/reference/container/clusters/create?hl=zh-cn#--node-locations) \u6a19\u8a8c\u6307\u5b9a\u53ef\u7528\u5340\u3002\u4e0d\u904e\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u5728\u73fe\u6709\u96c6\u7fa3\u4e2d\u5275\u5efa\u55ae\u7368\u7684 GPU \u7bc0\u9ede\u6c60\uff0c\u5982\u672c\u90e8\u5206\u6240\u793a\u3002\n### \u624b\u52d5\u5b89\u88dd NVIDIA GPU \u9a45\u52d5\u7a0b\u5e8f\n\u5982\u679c\u60a8\u5728\u5275\u5efa GPU \u7bc0\u9ede\u6c60\u6642\u9078\u64c7\u4e86\u505c\u7528\u81ea\u52d5\u8a2d\u5099\u9a45\u52d5\u7a0b\u5e8f\u5b89\u88dd\uff0c\u6216\u8005\u5982\u679c\u4f7f\u7528\u7684 GKE \u7248\u672c\u4f4e\u65bc\u81ea\u52d5\u5b89\u88dd\u652f\u6301\u7684\u6700\u4f4e\u7248\u672c\uff0c\u5247\u5fc5\u9808\u624b\u52d5\u5728\u7bc0\u9ede\u4e0a\u5b89\u88dd\u517c\u5bb9\u7684 NVIDIA GPU \u9a45\u52d5\u7a0b\u5e8f\u3002Google \u63d0\u4f9b\u4e86\u4e00\u500b DaemonSet\uff0c\u53ef\u61c9\u7528\u65bc\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f\u3002\u5728\u4f7f\u7528 Container-Optimized OS \u7684 GPU \u7bc0\u9ede\u4e0a\uff0c\u60a8\u9084\u53ef\u4ee5\u9078\u64c7\u9ed8\u8a8d GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u6216\u66f4\u65b0\u7248\u672c\u3002\n\u6211\u5011\u5efa\u8b70\u60a8\u5118\u53ef\u80fd\u4f7f\u7528\u81ea\u52d5\u9a45\u52d5\u7a0b\u5e8f\u5b89\u88dd\uff0c\u65b9\u6cd5\u662f\u5728\u5275\u5efa\u6a19\u6e96\u96c6\u7fa3\u6642\u5728 `--accelerator` \u6a19\u8a8c\u4e2d\u6307\u5b9a `gpu-driver-version` \u9078\u9805\u3002\u5982\u679c\u60a8\u5df2\u5728 **2023 \u5e74 1 \u6708 25 \u65e5\u6216\u4e4b\u524d** \u4f7f\u7528\u5b89\u88dd DaemonSet \u4f86\u624b\u52d5\u5b89\u88dd GPU \u9a45\u52d5\u7a0b\u5e8f\uff0c\u60a8\u53ef\u80fd\u7372\u53d6\u91cd\u65b0\u61c9\u7528 DaemonSet \u4ee5\u7372\u5f97\u5ffd\u7565\u4f7f\u7528\u81ea\u52d5\u9a45\u52d5\u7a0b\u5e8f\u5b89\u88dd\u7684\u7bc0\u9ede\u7684\u7248\u672c\u3002\n**\u6ce8\u610f** \uff1a\u5982\u9700\u904b\u884c\u5b89\u88dd DaemonSet\uff0cGPU \u7bc0\u9ede\u6c60\u9700\u8981\u4f7f\u7528 `https://www.googleapis.com/auth/devstorage.read_only` \u7bc4\u570d\u8207 `gcr.io` ( [Container Registry](https://cloud.google.com/container-registry?hl=zh-cn) ) \u9032\u884c\u901a\u4fe1\u3002\u5982\u679c\u6c92\u6709\u6b64\u7bc4\u570d\uff0c\u5247\u4e0b\u8f09 DaemonSet \u6e05\u55ae\u5c07\u5931\u6557\u3002\u6b64\u7bc4\u570d\u662f\u9ed8\u8a8d [\u7bc4\u570d](https://cloud.google.com/sdk/gcloud/reference/container/clusters/create?hl=zh-cn#--scopes) \u4e4b\u4e00\uff0c\u901a\u5e38\u5728\u60a8\u5275\u5efa\u96c6\u7fa3\u6642\u6dfb\u52a0\u3002\n\u4ee5\u4e0b\u8aaa\u660e\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528 Terraform \u5728 Container-Optimized OS (COS) \u548c Ubuntu \u7bc0\u9ede\u4e0a\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f\u3002\n\u8981\u90e8\u7f72 [DaemonSet](https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/cos/daemonset-preloaded.yaml) \u7684\u5b89\u88dd\u4e26\u5b89\u88dd\u9ed8\u8a8d\u7684 GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\nkubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/cos/daemonset-preloaded.yaml\n```\n\u6216\u8005\uff0c\u5982\u9700\u5b89\u88dd\u8f03\u65b0\u7684 GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\uff08\u8acb\u53c3\u95b1\u4e0b\u8868\uff09\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\nkubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/cos/daemonset-preloaded-latest.yaml\n```\n\u5b89\u88dd\u9700\u8981\u5e7e\u79d2\u9418\u624d\u80fd\u5b8c\u6210\u3002\u5b89\u88dd\u5b8c\u6210\u5f8c\uff0cNVIDIA GPU \u8a2d\u5099\u63d2\u4ef6\u901a\u904e Kubernetes API \u986f\u793a NVIDIA GPU \u5bb9\u91cf\u3002\n\u6bcf\u500b\u7248\u672c\u7684 Container-Optimized OS \u6620\u50cf\u90fd\u81f3\u5c11\u6709\u4e00\u500b\u53d7\u652f\u6301\u7684 NVIDIA GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u5982\u9700\u77ad\u89e3\u9ed8\u8a8d\u652f\u6301\u7684\u7248\u672c\uff0c\u8acb\u53c3\u95b1\u4e3b\u8981 Container-Optimized OS LTS \u91cc\u7a0b\u7891\u7684 [\u7248\u672c\u8aaa\u660e](https://cloud.google.com/container-optimized-os/docs/release-notes?hl=zh-cn) \u3002\n\u4e0b\u8868\u5217\u51fa\u4e86\u6bcf\u500b GKE \u7248\u672c\u4e2d\u53ef\u7528\u7684\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\uff1a\n| GKE \u7248\u672c | NVIDIA \u9a45\u52d5\u7a0b\u5e8f     |\n|-----------:|:---------------------------------|\n|  1.26 | R470\uff08\u9ed8\u8a8d\uff09\u3001R510 \u6216 R525  |\n|  1.25 | R470\uff08\u9ed8\u8a8d\uff09\u3001R510 \u6216 R525  |\n|  1.24 | R470\uff08\u9ed8\u8a8d\uff09\u3001R510 \u6216 R525  |\n|  1.23 | R450\uff08\u9ed8\u8a8d\uff09\u3001R470\u3001R510 \u6216 R525 |\n|  1.22 | R450\uff08\u9ed8\u8a8d\uff09\u3001R470\u3001R510 \u6216 R525 |\n|  1.21 | R450\uff08\u9ed8\u8a8d\uff09\u3001R470 \u6216 R510  |\n|  1.2 | R450\uff08\u9ed8\u8a8d\uff09\u3001R470    |\n **\u6ce8\u610f** \uff1aR510 \u53ef\u5728 [2022-R24](https://cloud.google.com/kubernetes-engine/docs/release-notes?hl=zh-cn#October_05_2022) \u6216\u66f4\u9ad8\u7248\u672c\u7684 GKE \u7248\u672c\u4e2d\u4f7f\u7528\u3002\n **\u6ce8\u610f** \uff1a\u5c0d\u65bc Ubuntu \u7bc0\u9ede\uff0cGPU \u652f\u6301\u9700\u8981\u4f7f\u7528 v1.11.3 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n\u5982\u9700\u7232 NVIDIA L4 GPU \u4e4b\u5916\u7684\u6240\u6709 GPU \u90e8\u7f72\u5b89\u88dd [DaemonSet](https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/ubuntu/daemonset-preloaded.yaml) \uff0c **** \u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\nkubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/ubuntu/daemonset-preloaded.yaml\n```\n\u5b89\u88dd\u9700\u8981\u5e7e\u79d2\u9418\u624d\u80fd\u5b8c\u6210\u3002\u5b89\u88dd\u5b8c\u6210\u5f8c\uff0cNVIDIA GPU \u8a2d\u5099\u63d2\u4ef6\u901a\u904e Kubernetes API \u986f\u793a NVIDIA GPU \u5bb9\u91cf\u3002\n\u5c0d\u65bc NVIDIA L4 GPU\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88dd `R525` \u9a45\u52d5\u7a0b\u5e8f\uff1a\n```\nkubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/ubuntu/daemonset-preloaded-R525.yaml\n```\n\u4e0b\u8868\u5217\u51fa\u4e86\u6bcf\u500b GKE \u7248\u672c\u4e2d\u53ef\u7528\u7684\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\uff1a\n| GKE \u7248\u672c | NVIDIA \u9a45\u52d5\u7a0b\u5e8f |\n|-----------:|:------------------|\n|  1.27 | R470    |\n|  1.26 | R470    |\n|  1.25 | R470    |\n|  1.24 | R470    |\n|  1.23 | R470    |\n|  1.22 | R450    |\n|  1.21 | R450    |\n|  1.2 | R450    |\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Terraform \u6839\u64da\u7bc0\u9ede\u985e\u578b\u5b89\u88dd\u9ed8\u8a8d\u7684 GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u5728\u9019\u5169\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u60a8\u90fd\u5fc5\u9808\u914d\u7f6e [kubectl_manifest Terraform \u8cc7\u6e90\u985e\u578b](https://registry.terraform.io/providers/alekc/kubectl/latest/docs/resources/kubectl_manifest) \u3002- \u5982\u9700\u5b89\u88dd [DaemonSet on COS](https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/cos/daemonset-preloaded.yaml) \uff0c\u8acb\u5728 Terraform \u914d\u7f6e\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u584a\uff1a```\n\u00a0 data \"http\" \"nvidia_driver_installer_manifest\" {\u00a0 \u00a0 url = \"https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/cos/daemonset-preloaded.yaml\"\u00a0 }\u00a0 resource \"kubectl_manifest\" \"nvidia_driver_installer\" {\u00a0 \u00a0 yaml_body = data.http.nvidia_driver_installer_manifest.body\u00a0 }\n```\n- \u5982\u9700\u5b89\u88dd [DaemonSet on Ubuntu](https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/ubuntu/daemonset-preloaded.yaml) \uff0c\u8acb\u5728 Terraform \u914d\u7f6e\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u584a\uff1a```\n\u00a0 data \"http\" \"nvidia_driver_installer_manifest\" {\u00a0 \u00a0 url = \"https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/ubuntu/daemonset-preloaded.yaml\"\u00a0 }\u00a0 resource \"kubectl_manifest\" \"nvidia_driver_installer\" {\u00a0 \u00a0 yaml_body = data.http.nvidia_driver_installer_manifest.body\u00a0 }\n```## \u5c07\u7bc0\u9ede\u81ea\u52d5\u9810\u914d\u8207 GPU \u642d\u914d\u4f7f\u7528\n\u5c07\u7bc0\u9ede\u81ea\u52d5\u9810\u914d\u8207 GPU \u642d\u914d\u4f7f\u7528\u6642\uff0c\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u81ea\u52d5\u9810\u914d\u7684\u7bc0\u9ede\u6c60\u6c92\u6709\u8db3\u5920\u7684\u7bc4\u570d\u4f86\u5b89\u88dd\u9a45\u52d5\u7a0b\u5e8f\u3002\u5982\u9700\u6388\u4e88\u6240\u9700\u7684\u7bc4\u570d\uff0c\u8acb\u4fee\u6539\u7bc0\u9ede\u81ea\u52d5\u9810\u914d\u7684\u9ed8\u8a8d\u7bc4\u570d\uff0c\u4ee5\u6dfb\u52a0 `logging.write` \u3001 `monitoring` \u3001 `devstorage.read_only` \u548c `compute` \uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\u3002\n**\u6ce8\u610f** \uff1a\u60a8\u4e0d\u80fd\u4f7f\u7528 `gpu-driver-version` \u6a19\u8a8c\u5728\u81ea\u52d5\u9810\u914d\u7684\u7bc0\u9ede\u6c60\u4e2d\u5553\u7528\u9a45\u52d5\u7a0b\u5e8f\u81ea\u52d5\u5b89\u88dd\u529f\u80fd\u3002\u53ea\u6709\u624b\u52d5\u5275\u5efa\u7684\u7bc0\u9ede\u6c60\u624d\u652f\u6301\u9a45\u52d5\u7a0b\u5e8f\u81ea\u52d5\u5b89\u88dd\u529f\u80fd\u3002\n```\ngcloud container clusters update CLUSTER_NAME --enable-autoprovisioning \\\u00a0 \u00a0 --min-cpu=1 --max-cpu=10 --min-memory=1 --max-memory=32 \\\u00a0 \u00a0 --autoprovisioning-scopes=https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring,https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/compute\n```\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u81ea\u52d5\u9810\u914d\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528\u7bc0\u9ede\u81ea\u52d5\u9810\u914d](https://cloud.google.com/kubernetes-engine/docs/how-to/node-auto-provisioning?hl=zh-cn) \u3002\n## \u914d\u7f6e Pod \u4f7f\u7528 GPU\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u8cc7\u6e90\u9650\u5236](https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/) \u4f86\u914d\u7f6e Pod\uff0c\u4ee5\u4f7f\u7528 GPU\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u9375\u503c\u5c0d\u5728 [Pod \u898f\u7bc4](https://v1-25.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#podspec-v1-core) \u4e2d\u6307\u5b9a\u8cc7\u6e90\u9650\u5236\n- **\u9375** \uff1a`nvidia.com/gpu`\n- **\u503c** \uff1a\u8981\u4f7f\u7528\u7684 GPU \u6578\u91cf\n**\u6ce8\u610f** \uff1a\u4e0d\u652f\u6301\u5c07 `alpha.kubernetes.io/nvidia-gpu` \u7528\u4f5c GKE \u4e2d\u7684\u8cc7\u6e90\u540d\u7a31\u3002\u8acb\u6539\u7232\u5c07 `nvidia.com/gpu` \u7528\u4f5c\u8cc7\u6e90\u540d\u7a31\u3002\n\u4ee5\u4e0b\u793a\u4f8b\u986f\u793a\u4e86\u4f7f\u7528 GPU \u7684 Pod \u898f\u7bc4\uff1a\n```\napiVersion: v1\nkind: Pod\nmetadata:\n name: my-gpu-pod\nspec:\n containers:\n - name: my-gpu-container\n image: nvidia/cuda:11.0.3-runtime-ubuntu20.04\n command: [\"/bin/bash\", \"-c\", \"--\"]\n args: [\"while true; do sleep 600; done;\"]\n resources:\n  limits:\n  nvidia.com/gpu: 2\n```\n## \u4f7f\u7528\u591a\u7a2e GPU \u985e\u578b\n\u5982\u679c\u6bcf\u500b\u96c6\u7fa3\u8981\u4f7f\u7528\u591a\u7a2e GPU \u52a0\u901f\u5668\u985e\u578b\uff0c\u90a3\u9ebc\u60a8\u5fc5\u9808\u5275\u5efa\u591a\u500b\u7bc0\u9ede\u6c60\uff0c\u6bcf\u500b\u7bc0\u9ede\u6c60\u90fd\u5177\u6709\u5404\u81ea\u7684\u52a0\u901f\u5668\u985e\u578b\u3002 GKE \u5c07\u7279\u6709\u7684 [\u7bc0\u9ede\u9078\u64c7\u5668](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector) \u9644\u52a0\u5230 GPU \u7bc0\u9ede\uff0c\u4ee5\u5e6b\u52a9\u60a8\u5c07 GPU \u5de5\u4f5c\u8ca0\u8f09\u7f6e\u65bc\u5177\u6709\u7279\u5b9a GPU \u985e\u578b\u7684\u7bc0\u9ede\u4e0a\uff1a\n- **\u9375** \uff1a`cloud.google.com/gke-accelerator`\n- **\u503c** \uff1a`nvidia-tesla-k80`\u3001`nvidia-tesla-p100`\u3001`nvidia-tesla-p4`\u3001`nvidia-tesla-v100`\u3001`nvidia-tesla-t4`\u3001`nvidia-tesla-a100`\u3001`nvidia-a100-80gb`\u6216`nvidia-l4`\u3002\n\u60a8\u53ef\u4ee5\u5c07\u6b64\u7bc0\u9ede\u9078\u64c7\u5668\u6dfb\u52a0\u5230\u5de5\u4f5c\u8ca0\u8f09\u7684 Pod \u898f\u7bc4\u4e2d\uff0c\u4ee5\u5b9a\u4f4d\u7279\u5b9a\u7684 GPU \u985e\u578b\u3002\u4f8b\u5982\uff1a\n```\napiVersion: v1\nkind: Pod\nmetadata:\n name: my-gpu-pod\nspec:\n containers:\n - name: my-gpu-container\n image: nvidia/cuda:11.0.3-runtime-ubuntu20.04\n command: [\"/bin/bash\", \"-c\", \"--\"]\n args: [\"while true; do sleep 600; done;\"]\n resources:\n  limits:\n  nvidia.com/gpu: 2\n nodeSelector:\n cloud.google.com/gke-accelerator: nvidia-tesla-k80\n```\n## \u95dc\u65bc NVIDIA CUDA-X \u5eab\n[CUDA](https://developer.nvidia.com/cuda-zone) \u662f NVIDIA \u7684\u4e26\u884c\u8a08\u7b97\u5e73\u81fa\u548c GPU \u7684\u7de8\u7a0b\u6a21\u578b\u3002\u5982\u9700\u4f7f\u7528 CUDA \u61c9\u7528\uff0c\u60a8\u4f7f\u7528\u7684\u6620\u50cf\u5fc5\u9808\u5177\u6709\u5eab\u3002\u5982\u9700\u6dfb\u52a0 NVIDIA CUDA-X \u5eab\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u4efb\u4e00\u65b9\u6cd5\uff1a\n- **\u5efa\u8b70\uff1a** \u4f7f\u7528\u9810\u88dd\u4e86 NVIDIA CUDA-X \u5eab\u7684\u6620\u50cf\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 [Deep Learning Containers](https://cloud.google.com/deep-learning-containers/docs/overview?hl=zh-cn) \u3002 \u9019\u4e9b\u5bb9\u5668\u9810\u5b89\u88dd\u4e86\u95dc\u9375\u6578\u64da\u79d1\u5b78\u6846\u67b6\u3001NVIDIA CUDA-X \u5eab\u548c\u5de5\u5177\u3002\u6216\u8005\uff0c [NVIDIA CUDA \u6620\u50cf](https://hub.docker.com/r/nvidia/cuda) \u50c5\u5305\u542b NVIDIA CUDA-X \u5eab\u3002\n- \u69cb\u5efa\u4e26\u4f7f\u7528\u60a8\u81ea\u5df1\u7684\u6620\u50cf\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u8acb\u5728\u5bb9\u5668\u898f\u7bc4\u7684`LD_LIBRARY_PATH`\u74b0\u5883\u8b8a\u91cf\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u503c\uff1a- `/usr/local/cuda-` `` `/lib64`\uff1aNVIDIA CUDA-X \u5eab\u5728\u7bc0\u9ede\u4e0a\u7684\u4f4d\u7f6e\u3002\u5c07``\u66ff\u63db\u7232\u60a8\u4f7f\u7528\u7684 CUDA-X \u6620\u50cf\u7248\u672c\u3002\u67d0\u4e9b\u7248\u672c\u9084\u5728`/usr/local/nvidia/bin`\u4e2d\u5305\u542b\u8abf\u8a66\u5be6\u7528\u7a0b\u5e8f\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [DockerHub \u4e0a\u7684 NVIDIA CUDA \u6620\u50cf](https://hub.docker.com/r/nvidia/cuda) \u3002\n- `/usr/local/nvidia/lib64`\uff1aNVIDIA \u8a2d\u5099\u9a45\u52d5\u7a0b\u5e8f\u7684\u4f4d\u7f6e\u3002\u5982\u9700\u67e5\u770b\u60a8\u7684 CUDA \u7248\u672c\u6240\u9700\u7684\u6700\u4f4e GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\uff0c\u8acb\u53c3\u95b1 [CUDA \u5de5\u5177\u5305\u548c\u517c\u5bb9\u9a45\u52d5\u7a0b\u5e8f\u7248\u672c](https://docs.nvidia.com/deploy/cuda-compatibility/index.html#binary-compatibility__table-toolkit-driver) \u3002\u78ba\u4fdd\u7bc0\u9ede\u4e0a\u904b\u884c\u7684 GKE \u88dc\u4e01\u7a0b\u5e8f\u7248\u672c\u5305\u542b\u8207\u60a8\u9078\u64c7\u7684 CUDA \u7248\u672c\u517c\u5bb9\u7684 GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u3002\u5982\u9700\u67e5\u770b\u8207 GKE \u7248\u672c\u95dc\u806f\u7684 GPU \u9a45\u52d5\u7a0b\u5e8f\u7248\u672c\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [GKE \u7576\u524d\u7248\u672c\u8868](https://cloud.google.com/kubernetes-engine/docs/release-notes?hl=zh-cn#current_versions) \u4e2d\u93c8\u63a5\u7684\u76f8\u61c9 Container-Optimized OS \u9801\u9762\u3002\n## \u76e3\u63a7 GPU \u7bc0\u9ede\n\u5982\u679c\u60a8\u7684 GKE \u96c6\u7fa3\u5553\u7528\u4e86 [\u7cfb\u7d71\u6307\u6a19](https://cloud.google.com/stackdriver/docs/solutions/gke/managing-metrics?hl=zh-cn#system-metrics) \uff0c\u5247 [Cloud Monitoring](https://cloud.google.com/monitoring/docs?hl=zh-cn) \u4e2d\u63d0\u4f9b\u4ee5\u4e0b\u6307\u6a19\u4f86\u76e3\u63a7 GPU \u5de5\u4f5c\u8ca0\u8f09\u7684\u6027\u80fd\uff1a\n- **\u5de5\u4f5c\u9031\u671f (container/accelerator/duty_cycle)** \uff1a\u52a0\u901f\u5668\u6d3b\u8e8d\u8655\u7406\u7684\u6642\u9593\u4f54\u904e\u53bb\u7684\u63a1\u6a23\u9031\u671f\uff0810 \u79d2\uff09\u7684\u767e\u5206\u6bd4\u3002\u4ecb\u65bc 1 \u5230 100 \u4e4b\u9593\u3002\n- **\u5167\u5b58\u7528\u91cf (container/accelerator/memory_used)** \uff1a\u5df2\u5206\u914d\u7684\u52a0\u901f\u5668\u5167\u5b58\u91cf\uff08\u4ee5\u5b57\u7bc0\u7232\u55ae\u4f4d\uff09\u3002\n- **\u5167\u5b58\u5bb9\u91cf (container/accelerator/memory_total)** \uff1a\u52a0\u901f\u5668\u5167\u5b58\u7e3d\u91cf\uff08\u4ee5\u5b57\u7bc0\u7232\u55ae\u4f4d\uff09\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u76e3\u63a7\u96c6\u7fa3\u53ca\u5176\u8cc7\u6e90\uff0c\u8acb\u53c3\u95b1 [Monitoring](https://cloud.google.com/monitoring/kubernetes-engine?hl=zh-cn) \u3002\n### \u67e5\u770b\u7528\u91cf\u6307\u6a19\n\u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 **\u5de5\u4f5c\u8ca0\u8f09** \u4fe1\u606f\u4e2d\u5fc3\u5167\u67e5\u770b\u5de5\u4f5c\u8ca0\u8f09 GPU \u7528\u91cf\u6307\u6a19\u3002\n\u5982\u9700\u67e5\u770b\u5de5\u4f5c\u8ca0\u8f09 GPU \u7528\u91cf\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a\n- \u9032\u5165 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **\u5de5\u4f5c\u8ca0\u8f09** \u9801\u9762\u3002 [\u9032\u5165\u201c\u5de5\u4f5c\u8ca0\u8f09\u201d](https://console.cloud.google.com/kubernetes/workload/overview?hl=zh-cn) \n- \u9078\u64c7\u5de5\u4f5c\u8ca0\u8f09\u3002\n\u201c\u5de5\u4f5c\u8ca0\u8f09\u201d\u4fe1\u606f\u4e2d\u5fc3\u6703\u986f\u793a GPU \u5167\u5b58\u7528\u91cf\u548c\u5bb9\u91cf\u4ee5\u53ca GPU \u5de5\u4f5c\u9031\u671f\u7684\u5716\u8868\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [\u8a73\u7d30\u77ad\u89e3\u7bc0\u9ede\u6c60](https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools?hl=zh-cn) \u3002\n- [\u77ad\u89e3\u5982\u4f55\u91dd\u5c0d\u60a8\u7684\u7bc0\u9ede\u4f7f\u7528\u6eff\u8db3\u6700\u4f4e\u8981\u6c42\u7684 CPU \u5e73\u81fa](https://cloud.google.com/kubernetes-engine/docs/how-to/min-cpu-platform?hl=zh-cn) \u3002\n- [\u77ad\u89e3\u5982\u4f55\u4f7f\u7528 Docker \u5275\u5efa\u548c\u8a2d\u7f6e\u672c\u5730\u6df1\u5ea6\u5b78\u7fd2\u5bb9\u5668](https://cloud.google.com/deep-learning-containers/docs/getting-started-local?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}