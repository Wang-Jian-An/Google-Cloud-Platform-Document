{"title": "Google Kubernetes Engine (GKE) - \u5728\u5347\u7d1a\u5230 GKE 1.29 \u7248\u4e4b\u524d\u78ba\u4fdd TLS \u8b49\u66f8\u7684\u517c\u5bb9\u6027", "url": "https://cloud.google.com/kubernetes-engine/docs/deprecations/sha1-1-29?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u5728\u5347\u7d1a\u5230 GKE 1.29 \u7248\u4e4b\u524d\u78ba\u4fdd TLS \u8b49\u66f8\u7684\u517c\u5bb9\u6027\n\u904b\u884c 1.29 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684 GKE \u96c6\u7fa3\u4e0d\u652f\u6301\u4f7f\u7528 [SHA-1 \u7b97\u6cd5](https://en.wikipedia.org/wiki/SHA-1) \u7c3d\u540d\u7684\u50b3\u8f38\u5c64\u5b89\u5168\u5354\u8b70 (TLS) \u8b49\u66f8\u3002\u7232\u4e86\u9632\u6b62\u60a8\u7684\u96c6\u7fa3\u53d7\u5230\u5f71\u97ff\uff0c\u60a8\u9700\u8981\u5148\u5c07 [webhook](https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#configure-admission-webhooks-on-the-fly) \u548c [\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668](https://kubernetes.io/docs/tasks/extend-kubernetes/configure-aggregation-layer/#contacting-the-extension-apiserver) \u5f8c\u7aef\u7684\u4e0d\u517c\u5bb9\u8b49\u66f8\u66ff\u63db\u7232\u4f7f\u7528 [\u517c\u5bb9\u7684\u7c3d\u540d\u7b97\u6cd5](#compatible-signing-algorithms) \u7684\u8b49\u66f8\uff0c\u7136\u5f8c\u518d\u5c07\u96c6\u7fa3\u5347\u7d1a\u5230 1.29 \u7248\u3002\n#", "content": "## \u6b64\u79fb\u9664\u884c\u7232\u5c0d\u96c6\u7fa3\u7684\u5f71\u97ff\nGKE \u5728\u6aa2\u6e2c\u5230\u96c6\u7fa3\u6240\u4f7f\u7528\u7684\u8b49\u66f8\u8207 1.29 \u7248\u4e0d\u517c\u5bb9\u6642\uff0c\u6703 [\u66ab\u505c\u81ea\u52d5\u5347\u7d1a](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#how_kubernetes_deprecations_work_with) \u3002\u5728\u5c07\u8b49\u66f8\u66ff\u63db\u7232\u4f7f\u7528 [\u517c\u5bb9\u7684\u7c3d\u540d\u7b97\u6cd5](#compatible-signing-algorithms) \u7684\u8b49\u66f8\u6216\u662f 1.28 \u7248 [\u670d\u52d9\u7d42\u6b62](https://cloud.google.com/kubernetes-engine/docs/release-schedule?hl=zh-cn) \u4e4b\u5f8c\uff0cGKE \u6703\u7e7c\u7e8c\u9032\u884c\u81ea\u52d5\u5347\u7d1a\u3002\n\u5982\u679c\u60a8\u5728\u5347\u7d1a\u5230 1.29 \u7248\u4e4b\u524d\u672a\u66ff\u63db\u4e0d\u517c\u5bb9\u7684\u8b49\u66f8\uff0c\u5247\u60a8\u7684\u96c6\u7fa3\u53ef\u80fd\u6703\u9047\u5230\u4ee5\u4e0b\u554f\u984c\uff1a\n- \u4f7f\u7528\u901a\u904e SHA-1 \u7b97\u6cd5\u7c3d\u540d\u7684 TLS \u8b49\u66f8\u7684 GKE webhook \u5f8c\u7aef\u6703\u7531\u65bc\u8eab\u4efd\u9a57\u8b49\u5931\u6557\u800c\u505c\u6b62\u5de5\u4f5c\u3002\u5c0d\u65bc\u8207\u4f7f\u7528\u4e0d\u517c\u5bb9\u8b49\u66f8\u7684 webhook \u901a\u4fe1\u7684 Kubernetes \u63a7\u5236\u5e73\u9762\uff0cwebhook \u8abf\u7528\u6703\u5931\u6557\u3002\u6839\u64da\u60a8\u7684\u914d\u7f6e\uff0c\u5c24\u5176\u662f\u5728\u4f7f\u7528\u51c6\u5165 webhook \u6642\uff0c\u7121\u6cd5\u806f\u7e6b webhook \u53ef\u80fd\u6703\u963b\u6b62\u96c6\u7fa3\u4e0a\u7684\u8cc7\u6e90\u5275\u5efa\uff08\u4f8b\u5982 Pod \u5275\u5efa\uff09\uff0c\u9019\u53ef\u80fd\u5f88\u5bb9\u6613\u9020\u6210\u4e2d\u65b7\u3002\n- \u8abf\u7528\u7531\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668\u63d0\u4f9b\u670d\u52d9\u7684 API \u7684\u64cd\u4f5c\u6703\u5931\u6557\u3002## Kubernetes \u7232\u4ec0\u9ebc\u79fb\u9664\u6b64\u529f\u80fd\nGKE \u904b\u884c\u7684\u662f\u958b\u6e90 Kubernetes\uff0c\u5b83\u4f7f\u7528 [kube-apiserver \u7d44\u4ef6](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/) \uff0c\u901a\u904e TLS \u806f\u7e6b\u60a8\u7684 webhook \u548c\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668\u5f8c\u7aef\u3002kube-apiserver \u7d44\u4ef6\u662f\u4f7f\u7528 Go \u7de8\u7a0b\u8a9e\u8a00\u7de8\u5beb\u7684\u3002\n\u5f9e Go 1.18 \u7248\u958b\u59cb\uff0cGo \u958b\u59cb [\u62d2\u7d55\u4f7f\u7528 SHA-1 \u7b97\u6cd5\u7c3d\u540d\u7684 TLS \u8b49\u66f8](https://go.dev/doc/go1.18#sha1) \uff0c\u4f46\u7559\u4e0b\u4e86\u4e00\u500b\u8abf\u8a66\u958b\u95dc `x509sha1=1` \u4f86\u7528\u65bc\u5553\u7528\u820a\u884c\u7232\uff0c\u5f9e\u800c\u7c21\u5316\u9077\u79fb\u904e\u7a0b\u3002GKE 1.24 \u7248\u662f\u4f7f\u7528 Go 1.18 \u7248\u69cb\u5efa\u7684\u7b2c\u4e00\u500b\u7248\u672c\u3002Kubernetes \u7684 GKE \u69cb\u5efa\u5728 1.29 \u7248\u4e4b\u524d\u4e00\u76f4\u5553\u7528\u6b64\u8abf\u8a66\u958b\u95dc\u3002\u6b64\u958b\u95dc\u5c07 [\u5728 Go 1.24 \u7248\u4e2d\u79fb\u9664](https://github.com/golang/go/issues/62048) \u3002GKE 1.29 \u7248\u5728\u69cb\u5efa Kubernetes \u6642\u505c\u7528\u4e86\u6b64\u958b\u95dc\uff0c\u4ee5\u4fbf\u7232\u5c07\u4f86 Go \u79fb\u9664\u6b64\u8abf\u8a66\u958b\u95dc\u505a\u597d\u6e96\u5099\u3002\u5728 GKE \u5c07\u60a8\u7684\u96c6\u7fa3\u5347\u7d1a\u5230 1.29 \u7248\u4e4b\u5f8c\uff0c\u5f9e\u96c6\u7fa3\u7684\u63a7\u5236\u5e73\u9762\u8abf\u7528\u96c6\u7fa3\u4e2d\u63d0\u4f9b\u7528 SHA-1 \u7b97\u6cd5\u7c3d\u540d\u7684 TLS \u8b49\u66f8\u7684 webhook \u6216\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668\u7684\u64cd\u4f5c\u6703\u5931\u6557\u3002\n## \u8b58\u5225\u53d7\u5f71\u97ff\u7684\u96c6\u7fa3\nGKE \u6703\u76e3\u63a7\u96c6\u7fa3\uff0c\u4e26\u4f7f\u7528 [Recommender \u670d\u52d9](https://cloud.google.com/recommender/docs/overview?hl=zh-cn) \u901a\u904e\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\u63d0\u4f9b\u6307\u5c0e\u4fe1\u606f\uff0c\u4ee5\u8b58\u5225\u6eff\u8db3\u4ee5\u4e0b\u689d\u4ef6\u7684\u96c6\u7fa3\uff1a\u5176 webhook \u6216\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668\u5f8c\u7aef\u4f7f\u7528\u901a\u904e SHA-1 \u7b97\u6cd5\u7c3d\u540d\u7684 TLS \u8b49\u66f8\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u65e5\u8a8c\u4f86\u8b58\u5225\u5f9e\u96c6\u7fa3\u8abf\u7528\u53d7\u5f71\u97ff\u5f8c\u7aef\u7684\u64cd\u4f5c\u3002\n### \u5982\u4f55\u7372\u53d6\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\n\u5c0d\u65bc\u904b\u884c 1.24 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa3\uff0c\u8acb\u6309\u7167\u8aaa\u660e [\u67e5\u770b\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70](https://cloud.google.com/kubernetes-engine/docs/deprecations/viewing-deprecation-insights-and-recommendations?hl=zh-cn#view-insights-recs) \u3002 \u60a8\u53ef\u4ee5\u4f7f\u7528 gcloud CLI \u6216 Recommender API \u7372\u53d6\u5206\u6790\u6d1e\u898b\uff0c\u4e26\u4f7f\u7528\u5b50\u985e\u578b `DEPRECATION_K8S_SHA_1_CERTIFICATE` \u9032\u884c\u904e\u6ffe\u3002\n### \u5982\u4f55\u7372\u53d6\u65e5\u8a8c\n\u5c0d\u65bc\u5728 [\u5553\u7528\u4e86](https://cloud.google.com/stackdriver/docs/solutions/gke/installing?hl=zh-cn#installing) Cloud Logging \u7684\u60c5\u6cc1\u4e0b\u904b\u884c 1.24 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa3\uff0cGKE \u63d0\u4f9b [Cloud Audit Logs \u65e5\u8a8c](https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging?hl=zh-cn#viewing_your_projects_admin_activity_log) \u4f86\u8b58\u5225\u5f9e\u96c6\u7fa3\u8abf\u7528\u53d7\u5f71\u97ff\u5f8c\u7aef\u7684\u64cd\u4f5c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u904e\u6ffe\u689d\u4ef6\u4f86\u641c\u7d22\u65e5\u8a8c\uff1a\n```\nlogName =~ \"projects/.*/logs/cloudaudit.googleapis.com%2Factivity\"\nresource.type = \"k8s_cluster\"\noperation.producer = \"k8s.io\"\n\"insecure-sha1.invalid-cert.kubernetes.io\"\n```\n\u5be9\u8988\u65e5\u8a8c\u5305\u62ec\u53d7\u5f71\u97ff\u5f8c\u7aef\u7684\u4e3b\u6a5f\u540d\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u89e3\u8b80\u7d50\u679c\uff0c\u8acb\u53c3\u95b1\u4e0b\u4e00\u90e8\u5206\u3002\n## \u5f9e\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\u4e2d\u89e3\u8b80\u6307\u5c0e\u4fe1\u606f\n\u5efa\u8b70\u5305\u62ec\u53d7\u5f71\u97ff\u5f8c\u7aef\u7684\u4e3b\u6a5f\u540d\u4ee5\u53ca\u5b83\u662f webhook \u9084\u662f\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668\u3002\u5f15\u7528\u96c6\u7fa3\u4e2d\u7684 Service \u7684\u4e3b\u6a5f\u540d\u9075\u5faa `<service-name>.<namespace>.svc` \u683c\u5f0f\u3002\n\u5982\u679c\u53d7\u5f71\u97ff\u5f8c\u7aef\u8b49\u66f8\u4f86\u81ea webhook \u670d\u52d9\u5668\uff0c\u5247\u4e3b\u6a5f\u540d\u53ef\u4ee5\u662f\u96c6\u7fa3\u4e2d\u7684 Service\uff0c\u4e5f\u53ef\u4ee5\u662f\u7db2\u5740\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u806f\u7e6b webhook](https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#contacting-the-webhook) \u3002\n\u5982\u679c\u53d7\u5f71\u97ff\u8b49\u66f8\u4f86\u81ea\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668\uff0c\u5247\u4e3b\u6a5f\u540d\u662f\u96c6\u7fa3\u4e2d\u7684 Service\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u806f\u7e6b\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668](https://kubernetes.io/docs/tasks/extend-kubernetes/configure-aggregation-layer/#contacting-the-extension-apiserver) \u3002\n\u5728\u8b58\u5225\u51fa\u53d7\u5f71\u97ff\u7684\u5f8c\u7aef\u4e4b\u5f8c\uff0c\u8acb\u6309\u7167\u8aaa\u660e [\u6aa2\u67e5 Service \u7684\u8b49\u66f8](#inspect-cert-service) \u6216 [\u6aa2\u67e5\u7db2\u5740\u5f8c\u7aef\u7684\u8b49\u66f8](#inspect-url-backend) \uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u985e\u578b\u3002\n\u5982\u679c\u60a8\u7684\u96c6\u7fa3\u5728\u904e\u53bb 30 \u5929\u5167\u672a\u8abf\u7528\u4f7f\u7528\u53d7\u5f71\u97ff\u8b49\u66f8\u7684\u670d\u52d9\u5668\uff0c\u60a8\u4e0d\u6703\u770b\u5230\u4efb\u4f55\u5efa\u8b70\u3002\n\u8acb\u53c3\u95b1\u4ee5\u4e0b\u793a\u4f8b\u5efa\u8b70\u5217\u8868\uff1a\n```\nRECOMMENDATION_ID      PRIMARY_IMPACT_CATEGORY RECOMMENDATION_STATE LAST_REFRESH_TIME    PRIORITY RECOMMENDER_SUBTYPE    DESCRIPTION\n26bfcb32-6f2a-407c-874f-8cf55b3af912 RELIABILITY    ACTIVE    2024-02-15T01:09:04.454456273Z P2  DEPRECATION_K8S_SHA_1_CERTIFICATE Update the webhook and/or extension API servers that use certificates signed with SHA-1 algorithm to use certificates with compatible signing algorithms prior to upgrading the cluster to version 1.29. [Learn more](https://cloud.google.com/kubernetes-engine/docs/deprecations/sha1-1-29#mitigate_the_risk_of_upgrading_to_129).\n```\n\u5982\u9700\u7372\u53d6\u96c6\u7fa3\u548c Service \u7684\u8a73\u7d30\u4fe1\u606f\uff0c\u8acb [\u63cf\u8ff0\u5efa\u8b70](https://cloud.google.com/kubernetes-engine/docs/how-to/optimize-with-recommenders?hl=zh-cn#view-insights-recs) \u3002 `default` \u547d\u540d\u7a7a\u9593\u4e2d\u540d\u7232 `example-webhook` \u7684 Service \u7684\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\nassociatedInsights:\n- insight: projects/<CLUSTER_PROJECT_NUMBER>/locations/<CLUSTER_LOCATION>/insightTypes/google.container.DiagnosisInsight/insights/d76887a8-9eed-41a0-9459-d49dee43455e\ncontent:\n overview:\n featureDeprecationRecommendation:\n - featureName: x.509_certificate_signature_algorithm\n  featureReplacementValue: algorithm [compatible with GKE v1.29](https://cloud.google.com/kubernetes-engine/docs/deprecations/sha1-1-29#compatible-signing-algorithms)\n  featureValue: SHA1\n  stopServingVersion: '1.29'\n  targetType: hostname\n  targetValue: example-webhook.default.svc\n targetClusters:\n - clusterId: 3be916a554724c79a2314c8baee3fd57cf1c39df1ad34c3daf291db701b6d541\n  clusterUri: //container.googleapis.com/projects/<CLUSTER_PROJECT_NUMBER>/locations/<CLUSTER_LOCATION>/clusters/<CLUSTER_NAME>\ndescription: Update the webhook and/or extension API servers that use certificates\n signed with SHA-1 algorithm to use certificates with compatible signing algorithms\n prior to upgrading the cluster to version 1.29. [Learn more](https://cloud.google.com/kubernetes-engine/docs/deprecations/sha1-1-29#mitigate_the_risk_of_upgrading_to_129).\netag: '\"ad50aac8278951d5\"'\nlastRefreshTime: '2024-02-15T01:09:04.454456273Z'\nname: projects/<CLUSTER_PROJECT_NUMBER>/locations/<CLUSTER_LOCATION>/recommenders/google.container.DiagnosisRecommender/recommendations/26bfcb32-6f2a-407c-874f-8cf55b3af912\nprimaryImpact:\n category: RELIABILITY\n reliabilityProjection:\n risks:\n - SERVICE_DISRUPTION\npriority: P2\nrecommenderSubtype: DEPRECATION_K8S_SHA_1_CERTIFICATE\nstateInfo:\n state: ACTIVE\ntargetResources:\n- //container.googleapis.com/projects/<CLUSTER_PROJECT_NUMBER>/locations/<CLUSTER_LOCATION>/clusters/<CLUSTER_NAME>\n```\n### \u6aa2\u67e5 Service \u7684\u8b49\u66f8\nwebhook \u548c\u64f4\u5c55\u7a0b\u5e8f API \u670d\u52d9\u5668\u5747\u53ef\u7531 Service \u63d0\u4f9b\u652f\u6301\u3002\n\u5728\u8b58\u5225\u51fa\u8981\u6aa2\u67e5\u7684\u76f8\u95dc\u5f8c\u7aef Service \u4e4b\u5f8c\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u6aa2\u67e5\u6bcf\u500b Service \u7684\u8b49\u66f8\uff0c\u4ee5\u6aa2\u67e5\u54ea\u4e9b\u8b49\u66f8\u4f7f\u7528 SHA-1 \u7b97\u6cd5\u4e26\u9700\u8981\u66f4\u65b0\u3002\n- \u627e\u5230\u8a72 Service \u7684\u9078\u64c7\u5668\u548c\u76ee\u6a19\u7aef\u53e3\uff1a```\nkubectl describe service --namespace=NAMESPACE SERVICE_NAME\n```\u5c07 `` \u548c `` \u66ff\u63db\u7232\u4f86\u81ea `targetValue` \u7684\u503c\u3002\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nName: example-service\nNamespace: default\nLabels: run=nginx\nSelector: run=nginx\nType: ClusterIP\nIP: 172.21.xxx.xxx\nPort: 443\nTargetPort: 444\n```\u6b64\u8f38\u51fa\u8868\u660e `example-service` \u5177\u6709\u9078\u64c7\u5668 `run=nginx` \u548c\u76ee\u6a19\u7aef\u53e3 `444` \u3002 **\u6ce8\u610f** \uff1a\u672a\u5305\u542b `TargetPort` \u6642\uff0c\u5b83\u662f\u8207 `Port` \u5b57\u6bb5\u76f8\u540c\u7684\u503c\u3002\n- \u627e\u5230\u8207\u9078\u64c7\u5668\u5339\u914d\u7684 Pod\uff1a```\nkubectl get pods --namespace=NAMESPACE --selector=run=nginx\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0READY \u00a0 STATUS \u00a0 \u00a0RESTARTS \u00a0 AGEexample-pod \u00a0 1/1 \u00a0 \u00a0 Running \u00a0 0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a021m\n```\u6b64\u8f38\u51fa\u8868\u660e\u5339\u914d\u7684 Pod \u7232 `example-pod` \u3002\n- \u8a2d\u7f6e\u5f9e\u60a8\u7684 `kubectl` localhost \u5230 Pod \u7684\u7aef\u53e3\u8f49\u767c\uff1a **\u6ce8\u610f** \uff1a\u9019\u4e9b\u5f8c\u7e8c\u547d\u4ee4\u4f7f\u7528\u7aef\u53e3 `8888` \uff0c\u4f46\u60a8\u53ef\u4ee5\u9078\u64c7\u5176\u4ed6\u7aef\u53e3\uff0c\u56e0\u7232\u6b64\u7aef\u53e3\u662f\u4efb\u610f\u9078\u64c7\u7684\u3002```\nkubectl port-forward --namespace=NAMESPACE pods/example-pod 8888:SERVICE_TARGET_PORT &\n```\u5c07 `` \u66ff\u63db\u7232\u4f86\u81ea Service \u7684 `TargetPort` \u503c\u3002\u5982\u679c\u672a\u5305\u542b `TargetPort` \uff0c\u5247\u4f7f\u7528 `Port` \u503c\u3002\n- \u4f7f\u7528 `openssl` \u986f\u793a Service \u4f7f\u7528\u7684\u8b49\u66f8\uff1a```\nopenssl s_client -connect localhost:8888 </dev/null | openssl x509 -noout -text\n```\u6b64\u793a\u4f8b\u8f38\u51fa\u986f\u793a\u4f7f\u7528 [SHA-256 \u7b97\u6cd5](https://en.wikipedia.org/wiki/SHA-2) \u7c3d\u540d\u7684\u6709\u6548\u8b49\u66f8\uff1a```\nCertificate:\n Data:\n  ...\n  Signature Algorithm: sha256WithRSAEncryption\n...\n Signature Algorithm: sha256WithRSAEncryption\n```\u6b64\u793a\u4f8b\u8f38\u51fa\u986f\u793a\u4f7f\u7528 SHA-1 \u7b97\u6cd5\u7c3d\u540d\u7684\u7121\u6548\u8b49\u66f8\uff1a```\nCertificate:\n Data:\n  ...\n  Signature Algorithm: sha1WithRSAEncryption\n...\n Signature Algorithm: sha1WithRSAEncryption\n```\u5982\u679c\u8b49\u66f8\u5177\u6709\u985e\u4f3c\u8f38\u51fa\uff0c\u60a8\u5fc5\u9808\u66f4\u65b0\u8b49\u66f8\u4ee5\u4f7f\u7528 [\u517c\u5bb9\u7684\u7c3d\u540d\u7b97\u6cd5](#compatible-signing-algorithms) \u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528 `certificate.k8s.io` API \u7ba1\u7406\u96c6\u7fa3\u4e2d\u7684 TLS \u8b49\u66f8\uff0c\u5247\u53ef\u4ee5\u6309\u7167\u8aaa\u660e [\u5275\u5efa\u8b49\u66f8\u7c64\u540d\u8acb\u6c42](https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster/#create-a-certificate-signing-request) \u3002\u5982\u9700\u6e05\u7406\u5728\u5f8c\u81fa\u904b\u884c\u7684\u7aef\u53e3\u8f49\u767c\uff0c\u8acb\u627e\u5230\u8a72\u9032\u7a0b\u4e26\u7d42\u6b62\u5b83\u3002\n- \u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u5217\u51fa\u6b63\u5728\u904b\u884c\u7684\u9032\u7a0b\uff1a```\njobs\n```\u67e5\u770b\u8f38\u51fa\u4ee5\u7372\u53d6\u8981\u7d42\u6b62\u7684\u9032\u7a0b\u7684 ID\uff1a```\n[1]+ Running     kubectl port-forward pods/example-pod 8888:444 &\n```\u6b64\u793a\u4f8b\u8f38\u51fa\u8868\u660e\u9032\u7a0b ID \u7232 `1` \u3002\n- \u7d42\u6b62\u8a72\u9032\u7a0b\uff08\u5728\u547d\u4ee4\u4e2d\u66ff\u63db `` \uff09\uff1a```\nkill %PROCESS_ID\n```\u8acb\u53c3\u95b1\u4ee5\u4e0b\u8f38\u51fa\uff1a```\n[1]+ Terminated    kubectl port-forward pods/example 8888:444\n```\u6b64\u793a\u4f8b\u8f38\u51fa\u986f\u793a\u9032\u7a0b\u5df2\u7d42\u6b62\u3002\n### \u6aa2\u67e5\u7db2\u5740\u5f8c\u7aef\u7684\u8b49\u66f8\n\u5982\u679c webhook \u4f7f\u7528 `url` \u5f8c\u7aef\uff0c\u8acb\u76f4\u63a5\u9023\u63a5\u5230\u7db2\u5740\u4e2d\u6307\u5b9a\u7684\u4e3b\u6a5f\u540d\u3002\u4f8b\u5982\uff0c\u5982\u679c\u7db2\u5740\u7232 `https://example.com:123/foo/bar` \uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b `openssl` \u547d\u4ee4\u986f\u793a\u5f8c\u7aef\u4f7f\u7528\u7684\u8b49\u66f8\uff1a\n```\nopenssl s_client -connect example.com:123 </dev/null | openssl x509 -noout -text\n```\n\u6b64\u793a\u4f8b\u8f38\u51fa\u986f\u793a\u4f7f\u7528 [SHA-256 \u7b97\u6cd5](https://en.wikipedia.org/wiki/SHA-2) \u7c3d\u540d\u7684\u6709\u6548\u8b49\u66f8\uff1a\n```\nCertificate:\n Data:\n  ...\n  Signature Algorithm: sha256WithRSAEncryption\n...\n Signature Algorithm: sha256WithRSAEncryption\n```\n\u6b64\u793a\u4f8b\u8f38\u51fa\u986f\u793a\u4f7f\u7528 SHA-1 \u7b97\u6cd5\u7c3d\u540d\u7684\u7121\u6548\u8b49\u66f8\uff1a\n```\nCertificate:\n Data:\n  ...\n  Signature Algorithm: sha1WithRSAEncryption\n...\n Signature Algorithm: sha1WithRSAEncryption\n```\n\u5982\u679c\u8b49\u66f8\u5177\u6709\u985e\u4f3c\u8f38\u51fa\uff0c\u60a8\u5fc5\u9808\u66f4\u65b0\u8b49\u66f8\u4ee5\u4f7f\u7528 [\u517c\u5bb9\u7684\u7c3d\u540d\u7b97\u6cd5](#compatible-signing-algorithms) \u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528 `certificate.k8s.io` API \u7ba1\u7406\u96c6\u7fa3\u4e2d\u7684 TLS \u8b49\u66f8\uff0c\u5247\u53ef\u4ee5\u6309\u7167\u8aaa\u660e [\u5275\u5efa\u8b49\u66f8\u7c64\u540d\u8acb\u6c42](https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster/#create-a-certificate-signing-request) \u3002\n## \u964d\u4f4e\u5347\u7d1a\u5230 1.29 \u7248\u7684\u98a8\u96aa\n\u5728\u8b58\u5225\u51fa\u53d7\u5f71\u97ff\u7684\u96c6\u7fa3\u53ca\u5176\u4f7f\u7528\u901a\u904e SHA-1 \u7b97\u6cd5\u7c3d\u540d\u7684\u8b49\u66f8\u7684\u5f8c\u7aef Service \u4e4b\u5f8c\uff0c\u60a8\u5fc5\u9808\u5728\u5c07\u96c6\u7fa3\u5347\u7d1a\u5230 1.29 \u7248\u4e4b\u524d\uff0c\u66f4\u65b0 Service \u4ee5\u4f7f\u7528\u5177\u6709 [\u517c\u5bb9\u7684\u7c3d\u540d\u7b97\u6cd5](#compatible-signing-algorithms) \u7684\u8b49\u66f8\u3002\n\u53d7\u5f71\u97ff\u7684\u96c6\u7fa3\u7531 GKE \u81ea\u52d5\u6aa2\u6e2c\uff0c [\u4e0d\u6703\u81ea\u52d5\u5347\u7d1a](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#auto-upgrade-pause) \u5230 1.29 \u7248\uff0c\u76f4\u5230\u4e0d\u518d\u4f7f\u7528\u4e0d\u517c\u5bb9\u7684\u8b49\u66f8\u6216 1.28 \u7248 [\u670d\u52d9\u7d42\u6b62](https://cloud.google.com/kubernetes-engine/docs/release-schedule?hl=zh-cn) \u3002 \u4e00\u65e6 1.28 \u7248\u670d\u52d9\u7d42\u6b62\uff0c\u96c6\u7fa3\u4fbf\u6703\u81ea\u52d5\u5347\u7d1a\u5230 1.29 \u7248\u3002\n### \u517c\u5bb9\u7684\u7c3d\u540d\u7b97\u6cd5\nGKE 1.29 \u7248\u8207 Go x509 \u8edf\u4ef6\u5305\u4e2d\u652f\u6301\u7684\u7b97\u6cd5\u517c\u5bb9\u3002\u9019\u5305\u62ec\u4ee5\u4e0b\u7b97\u6cd5\uff1a\n- `SHA256WithRSA`\n- `SHA384WithRSA`\n- `SHA512WithRSA`\n- `ECDSAWithSHA256`\n- `ECDSAWithSHA384`\n- `ECDSAWithSHA512`\n- `SHA256WithRSAPSS`\n- `SHA384WithRSAPSS`\n- `SHA512WithRSAPSS`\n- `PureEd25519`\n\u5982\u9700\u67e5\u627e\u53ef\u7528\u7b97\u6cd5\uff0c\u8acb\u67e5\u770b [x509.go \u6e90\u6587\u4ef6](https://go.dev/src/crypto/x509/x509.go) \u4e26\u641c\u7d22 `UnknownSignatureAlgorithm SignatureAlgorithm = iota` \u3002Go x509 \u8edf\u4ef6\u5305\u652f\u6301\u7684\u7b97\u6cd5\u6703\u5728\u5305\u542b\u4e0a\u8ff0\u641c\u7d22\u5167\u5bb9\u7684 `const` \u584a\u4e2d\u5217\u51fa\u3002\u5982\u9700\u67e5\u627e\u4e0d\u652f\u6301\u7684\u4e0d\u5b89\u5168\u7c3d\u540d\u7b97\u6cd5\uff0c\u8acb\u5728\u8a72\u6587\u4ef6\u4e2d\u641c\u7d22 `InsecureAlgorithmError` \u7684\u4f7f\u7528\u60c5\u6cc1\u3002\n## \u8cc7\u6e90\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6b64\u8b8a\u5316\uff0c\u8acb\u53c3\u95b1\u4ee5\u4e0b\u8cc7\u6e90\uff1a\n- Go 1.18 [\u7248\u672c\u8aaa\u660e](https://go.dev/doc/go1.18#sha1) \n- Go 1.24 [x509sha1 \u8abf\u8a66\u958b\u95dc\u79fb\u9664](https://golang.org/doc/go1.15#commonname) \n- Go x509 [\u652f\u6301\u7684\u7b97\u6cd5](https://go.dev/src/crypto/x509/x509.go)", "guide": "Google Kubernetes Engine (GKE)"}