{"title": "Google Kubernetes Engine (GKE) - Optimize your usage of GKE with insights and recommendations", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/optimize-with-recommenders", "abstract": "# Google Kubernetes Engine (GKE) - Optimize your usage of GKE with insights and recommendations\nWith Google Kubernetes Engine (GKE), you can receive prescriptive guidance for how to optimize your clusters.\nGKE monitors your clusters and if there are potential optimizations, guidance is delivered through [Recommender](/recommender/docs/overview) , a Google Cloud service that generates insights and recommendations for using resources on Google Cloud. For GKE, Recommenders deliver two types of information:\n- Anexplains that GKE detected your cluster usage can be optimized in some way.\n- Aexplains how to optimize your cluster usage.\nGKE delivers this information in the Google Cloud console and you can also find it with the Google Cloud CLI and the Recommender API. GKE provides Recommenders for topics including:\n- **Deprecations:** Mitigate exposure to deprecated Kubernetes features or APIs.\n- **Operations and connectivity:** Fix issues related to control plane and node connectivity, and IP address utilization.\n- **Cost optimization:** Implement cost-optimized configurations and practices. For example, [Identify idle GKE clusters](/kubernetes-engine/docs/how-to/idle-clusters) .\n- **Agones:** Isolate the Agones controller in your cluster.\n- **Disruptions** : Ensure workloads' continuity and recoverability during maintenance.\n- **Webhooks:** Ensure control plane stability when using webhooks.", "content": "## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.\n### Required roles\nEnsure that you have the necessary permissions for Kubernetes insights and recommendations, either with the following [basic roles](/iam/docs/understanding-roles#basic) or [predefined roles](/iam/docs/understanding-roles#predefined) :\n- View insights and recommendations with one of the following roles:- [Viewer](/iam/docs/understanding-roles#basic) \n- [GKE Diagnosis Recommender Viewer](/iam/docs/understanding-roles#recommender.containerDiagnosisViewer) \n- View and update the state of insights and recommendations (for example, [dismiss a recommendation](#dismiss-recommendation) ):- [Editor](/iam/docs/understanding-roles#basic) \n- [Kubernetes Engine Admin](/iam/docs/understanding-roles#container.admin) \n- [Kubernetes Engine Developer](/iam/docs/understanding-roles#container.developer) \n- [GKE Diagnosis Recommender Admin](/iam/docs/understanding-roles#recommender.containerDiagnosisAdmin) \n## View insights and recommendations\nYou can view insights and recommendations with the Google Cloud CLI, in the Google Cloud console, or with the [Recommender API](/recommender/docs/reference/rest) .\n- Go to the **Google Kubernetes Engine** page in the Google Cloud console: [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Check the **Notifications** column for specific clusters to find insights.\n- Click on the insight to reveal more information. In the revealed sidebar panel, you can see details about this insight, including any associated recommendation.\nAn insight typically has a corresponding recommendation. Insights are fetched with [gcloud recommender insights](/sdk/gcloud/reference/recommender/insights) and recommendations are fetched with [gcloud recommender recommendations](/sdk/gcloud/reference/recommender/recommendations) .- View the list of insights for the clusters of a specific zone (for zonal clusters) or a specific region (for regional clusters):```\ngcloud recommender insights list \\\u00a0 \u00a0 --insight-type=google.container.DiagnosisInsight \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT \\\u00a0 \u00a0 --filter=\"insightSubtype:SUBTYPE\"\n```Replace the following:- ``: the Google Cloud project ID for the project where the cluster(s) are located.\n- ``: the exact region or zone of the cluster. For [zonal clusters](/kubernetes-engine/docs/concepts/types-of-clusters#zonal_clusters) , you must provide the exact zone (e.g.`us-central1-c`). For [regional clusters](/kubernetes-engine/docs/concepts/types-of-clusters#regional_clusters) , you must provide the exact region (e.g.`us-central1`).\n- ``: change the output format to YAML. This flag is optional.\n- ``: an [insight subtype](/recommender/docs/insights/using-insights#insight_subtype) , for example,`DEPRECATION_K8S_1_23_CERTIFICATE`. This limits the output to insights of a specified subtype. This flag is optional.\nOr, if you already have an insight ID, you can see details about the insight by running the following command:```\ngcloud recommender insights describe INSIGHT \\\u00a0 \u00a0 --insight-type=google.container.DiagnosisInsight \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT\n```Replace the `` with the value of insight ID, specified at the end of the URL from the `name` field for the insight. **Note:** To view the associated recommendation, save the **recommendation ID** value of the `associatedRecommendations.recommendation` from the command output for Step 2.The output includes additional details about what behavior GKE has detected with your cluster.\n- View the list of recommendations for the clusters of a specific zone (for zonal clusters) or a specific region (for regional clusters): **Note:** Use the `describe` command instead if you already have a **recommendation ID** from Step 1 and want to see a specific recommendation.```\ngcloud recommender recommendations list \\\u00a0 \u00a0 --recommender=google.container.DiagnosisRecommender \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT \\\u00a0 \u00a0 --filter=\"recommenderSubtype:SUBTYPE\"\n```Replace `` with a [recommender subtype](/recommender/docs/key-concepts#recommender_subtype) , for example, `DEPRECATION_K8S_1_23_CERTIFICATE` . This limits the output to recommendations of a specified subtype. This flag is optional.Or, if you already have a recommendation ID, you can view the recommendation by running the following command:```\ngcloud recommender recommendations describe RECOMMENDATION_ID \\\u00a0 \u00a0 --recommender=google.container.DiagnosisRecommender \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT\n```Replace the `` with the saved value of `associatedRecommendations.recommendation` from the command output in Step 1.The output provides guidance on what action you might need to take to optimize your cluster's usage of GKE.\nEach insight has a corresponding recommendation. Insights are fetched with [REST Resource: projects.locations.insightTypes.insights](/recommender/docs/reference/rest/v1/projects.locations.insightTypes.insights) and recommendations are fetched with [REST Resource: projects.locations.recommenders.recommendations](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations) .- View the list of insights for the clusters of a specific zone (for zonal clusters) or a specific region (for regional clusters):```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/insightTypes/google.container.DiagnosisInsight/insights?filter=insightSubtype%20%3D%20SUBTYPE\n```Replace the following:- ``: the Google Cloud project ID for the project where the cluster(s) are located.\n- ``: the exact region or zone of the cluster. For [zonal clusters](/kubernetes-engine/docs/concepts/types-of-clusters#zonal_clusters) , you must provide the exact zone (e.g.`us-central1-c`). For [regional clusters](/kubernetes-engine/docs/concepts/types-of-clusters#regional_clusters) , you must provide the exact region (e.g.`us-central1`).\n- ``: an [insight subtype](/recommender/docs/insights/using-insights#insight_subtype) , for example,`DEPRECATION_K8S_1_23_CERTIFICATE`. This limits the output to insights of a specified subtype. This flag is optional.\nOr, if you already have an insight ID, you can see details about the insight by making the following request:```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/insightTypes/google.container.DiagnosisInsight/insights/INSIGHT\n```Replace the `` with the value of insight ID, specified at the end of the URL from the `name` field for the insight. **Note:** To view the associated recommendation, save the **recommendation ID** value of the `associatedRecommendations.recommendation` from the response body for Step 2.The response body includes details about what behavior GKE has detected with your cluster.\n- View the list of recommendations for the clusters of a specific zone (for zonal clusters) or a specific region (for regional clusters): **Note:** Use the `recommendations.get` request instead if you already have a **recommendation ID** from Step 1 and want to see a specific recommendation.```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/recommenders/google.container.DiagnosisRecommender/recommendations?filter=recommenderSubtype%20%3D%20SUBTYPE\n```Replace `` with a [recommender subtype](/recommender/docs/key-concepts#recommender_subtype) , for example, `DEPRECATION_K8S_1_23_CERTIFICATE` . This limits the output to recommendations of a specified subtype. This flag is optional.Or, if you already have a recommendation ID, you can view the recommendation by making the following request:```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/recommenders/google.container.DiagnosisRecommender/recommendations/RECOMMENDATION_ID\n```Replace the `` with the saved value of `associatedRecommendations.recommendation` from the response body in Step 1.The response body provides guidance on what action you might need to take to optimize your cluster's usage of GKE.## Export insights and recommendations to BigQuery\nYou can use BigQuery to export and analyze insights and recommendations for your entire organization. To learn more, see [Export recommendations to BigQuery](/recommender/docs/bq-export/export-recommendations-to-bq) .\n## Resolve recommendations\nIf you have implemented a recommendation, you can mark the recommendation as resolved in the Google Cloud console. When you mark a recommendation as resolved, it no longer appears to any user in the console. After you resolve the recommendation, if GKE detects the same behavior for this cluster, the Recommender displays the recommendation again. When you resolve a recommendation, it remains discoverable with the Google Cloud CLI and the Recommender API.\nYou might want to mark a recommendation as resolved because, depending on how the Recommender works, you might continue to see the recommendation for some period of time after you have implemented the recommendation.\nTo mark a recommendation as resolved, follow the instructions for [Viewing insights and recommendations](#view-insights-recs) in the Google Cloud console to open the sidebar panel, which has more details. In that panel, click the **Mark as resolved** button.\n## Dismiss or restore recommendations\nIf you don't want to see a recommendation for a cluster in the Google Cloud console anymore, dismiss it. You might do this, for example, if you have assessed the recommendation and you have decided not to implement it.\nIf you dismiss the recommendation, it doesn't appear for any user viewing the cluster in the console. After you dismiss the recommendation, it doesn't appear again even if GKE detects the same behavior.\nWhen you dismiss a recommendation, you only hide it for all users in the console. The recommendation remains discoverable with the Google Cloud CLI and the Recommender API.\n### Dismiss a recommendation\nTo dismiss the recommendation, follow the instructions for [Viewing insights and recommendations](#view-insights-recs) in the Google Cloud console to open the sidebar panel, which has more details. In that panel, click the **Dismiss** button.\n### Restore a dismissed recommendation\nYou can restore a dismissed recommendation by following the instructions for [Restoring a recommendation](/recommender/docs/recommendation-hub/changing-applying-recommendations#restoring_a_recommendation) .\n## What's next\n- Learn more about [Recommenders](/recommender/docs/recommenders)", "guide": "Google Kubernetes Engine (GKE)"}