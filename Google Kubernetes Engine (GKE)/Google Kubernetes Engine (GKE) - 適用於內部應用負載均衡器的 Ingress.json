{"title": "Google Kubernetes Engine (GKE) - \u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/ingress-ilb?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress\n\u672c\u9801\u9762\u4ecb\u7d39\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress \u5728 Google Kubernetes Engine (GKE) \u4e2d\u7684\u5de5\u4f5c\u539f\u7406\u3002\u60a8\u9084\u53ef\u4ee5\u77ad\u89e3\u5982\u4f55 [\u8a2d\u7f6e\u548c\u4f7f\u7528\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress](https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balance-ingress?hl=zh-cn) \u3002\n\u5728 GKE \u4e2d\uff0c\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u662f\u4e00\u500b\u57fa\u65bc\u4ee3\u7406\u7684\u5340\u57df\u7d1a\u7b2c 7 \u5c64\u8ca0\u8f09\u5747\u8861\u5668\uff0c\u53ef\u8b93\u60a8\u5728\u5167\u90e8\u8ca0\u8f09\u5747\u8861 IP \u5730\u5740\u5f8c\u9762\u904b\u884c\u548c\u64f4\u7e2e\u60a8\u7684\u670d\u52d9\u3002\u5728 GKE \u96c6\u7fa3\u4e0a\u5275\u5efa Ingress \u5c0d\u8c61\u5f8c\uff0cGKE [Ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/) \u5c0d\u8c61\u4fbf\u53ef\u7232\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u63d0\u4f9b\u539f\u751f\u652f\u6301\u3002\n\u5982\u9700\u77ad\u89e3\u6709\u95dc\u5728 GKE \u4e2d\u4f7f\u7528 Ingress \u5be6\u73fe\u8ca0\u8f09\u5e73\u8861\u7684\u4e00\u822c\u4fe1\u606f\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 Ingress \u5be6\u73fe HTTP(S) \u8ca0\u8f09\u5e73\u8861](https://cloud.google.com/kubernetes-engine/docs/concepts/ingress?hl=zh-cn) \u3002\n", "content": "## \u4f7f\u7528\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress \u7684\u512a\u52e2\n\u4f7f\u7528\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 GKE Ingress \u5177\u6709\u4ee5\u4e0b\u512a\u52e2\uff1a\n- \u904b\u884c\u9ad8\u5ea6\u53ef\u7528\u4e14\u7531 GKE \u7ba1\u7406\u7684 Ingress \u63a7\u5236\u5668\u3002\n- \u7232\u5167\u90e8\u7684\u670d\u52d9\u9593\u901a\u4fe1\u5be6\u73fe\u8ca0\u8f09\u5e73\u8861\u3002\n- \u901a\u904e [\u7db2\u7d61\u7aef\u9ede\u7d44 (NEG)](https://cloud.google.com/load-balancing/docs/negs?hl=zh-cn) \u5be6\u73fe\u5bb9\u5668\u539f\u751f\u8ca0\u8f09\u5e73\u8861\u3002\n- \u7232\u61c9\u7528\u8def\u7531\u63d0\u4f9b HTTP \u548c HTTPS \u652f\u6301\u3002\n- \u5c0d\u5f48\u6027\u670d\u52d9\u57f7\u884c\u9ad8\u6e96\u78ba\u5ea6\u7684 Compute Engine \u5065\u5eb7\u6aa2\u67e5\u3002\n- \u901a\u904e\u57fa\u65bc Envoy \u7684\u4ee3\u7406\u5be6\u73fe\u6309\u9700\u90e8\u7f72\uff0c\u5f9e\u800c\u6eff\u8db3\u6d41\u91cf\u5bb9\u91cf\u9700\u6c42\u3002## \u5c0d Google Cloud \u529f\u80fd\u7684\u652f\u6301\n\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress \u652f\u6301\u591a\u7a2e\u9644\u52a0\u529f\u80fd\u3002\n- \u4f7f\u7528 Google Cloud \u7684 [\u81ea\u884c\u7ba1\u7406 SSL \u8b49\u66f8](https://cloud.google.com/load-balancing/docs/ssl-certificates?hl=zh-cn) \u3002\u6b64\u529f\u80fd\u50c5\u652f\u6301\u5730\u5340\u7d1a\u8b49\u66f8\u3002\n- \u4f7f\u7528 Kubernetes [Secret](https://kubernetes.io/docs/concepts/configuration/secret/) \u7684\u81ea\u884c\u7ba1\u7406 SSL \u8b49\u66f8\u3002\n- [\u6703\u8a71\u89aa\u548c\u6027](https://cloud.google.com/load-balancing/docs/backend-service?hl=zh-cn#session_affinity) \u548c [\u9023\u63a5\u8d85\u6642](https://cloud.google.com/load-balancing/docs/backend-service?hl=zh-cn#timeout-setting) [BackendService](https://cloud.google.com/load-balancing/docs/backend-service?hl=zh-cn) \u529f\u80fd\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 [BackendConfig](https://cloud.google.com/kubernetes-engine/docs/concepts/backendconfig?hl=zh-cn) \u914d\u7f6e\u9019\u4e9b\u529f\u80fd\u3002## \u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u6240\u9700\u7684\u7db2\u7d61\u74b0\u5883\n**\u91cd\u8981\u63d0\u793a** \uff1a\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress \u8981\u6c42\u60a8\u4f7f\u7528 [NEG](https://cloud.google.com/load-balancing/docs/negs?hl=zh-cn) \u4f5c\u7232\u5f8c\u7aef\u3002\u800c\u4e0d\u80fd\u5c07\u5be6\u4f8b\u7d44\u7528\u4f5c\u5f8c\u7aef\u3002\n\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7232\u60a8\u7684\u7db2\u7d61\u63d0\u4f9b\u4e86\u4e00\u500b\u4ee3\u7406\u6c60\u3002\u4ee3\u7406\u6703\u6839\u64da\u7db2\u5740\u6620\u5c04\u3001BackendService \u7684\u6703\u8a71\u89aa\u548c\u6027\u4ee5\u53ca\u6bcf\u500b\u5f8c\u7aef NEG \u7684\u5e73\u8861\u6a21\u5f0f\u7b49\u56e0\u7d20\uff0c\u8a55\u4f30\u6bcf\u500b HTTP(S) \u8acb\u6c42\u7684\u53bb\u5411\u3002\n\u4e00\u500b\u5340\u57df\u7684\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u4f7f\u7528 VPC \u7db2\u7d61\u4e2d\u8a72\u5340\u57df\u7684 [\u4ee3\u7406\u5c08\u7528\u5b50\u7db2](https://cloud.google.com/load-balancing/docs/proxy-only-subnets?hl=zh-cn) \u7232 Google Cloud \u5275\u5efa\u7684\u6bcf\u500b\u4ee3\u7406\u5206\u914d\u5167\u90e8 IP \u5730\u5740\u3002\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u5206\u914d\u7d66\u8ca0\u8f09\u5747\u8861\u5668\u7684\u8f49\u767c\u898f\u5247\u7684 IP \u5730\u5740\u4f86\u81ea GKE \u5206\u914d\u7684\u7bc0\u9ede\u7684\u5b50\u7db2\u7bc4\u570d\uff0c\u800c\u4e0d\u662f\u4f86\u81ea\u4ee3\u7406\u5c08\u7528\u5b50\u7db2\u3002\u60a8\u9084\u53ef\u4ee5\u5728\u5275\u5efa\u8f49\u767c\u898f\u5247\u6642\u7232\u8f49\u767c\u898f\u5247 [\u624b\u52d5\u6307\u5b9a\u4f86\u81ea\u4efb\u4f55\u5b50\u7db2\u7684 IP \u5730\u5740](https://cloud.google.com/load-balancing/docs/using-forwarding-rules?hl=zh-cn#adding-fr) \u3002\n\u4e0b\u5716\u63d0\u4f9b\u4e86\u4e0a\u4e00\u6bb5\u63cf\u8ff0\u7684\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684\u6d41\u91cf\u6982\u89bd\u3002\n\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\uff1a\n- \u5ba2\u6236\u7aef\u9023\u63a5\u5230\u8ca0\u8f09\u5747\u8861\u5668\u7684\u8f49\u767c\u898f\u5247\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u3002\n- \u4ee3\u7406\u63a5\u6536\u4e26\u7d42\u6b62\u5ba2\u6236\u7aef\u7684\u7db2\u7d61\u9023\u63a5\u3002\n- \u4ee3\u7406\u5efa\u7acb\u8207 NEG \u4e2d\u76f8\u61c9\u7aef\u9ede (pod) \u7684\u9023\u63a5\uff08\u7531\u8ca0\u8f09\u5747\u8861\u5668\u7684\u7db2\u5740\u6620\u5c04\u548c\u5f8c\u7aef\u670d\u52d9\u78ba\u5b9a\uff09\u3002\n\u6bcf\u500b\u4ee3\u7406\u76e3\u807d\u7531\u76f8\u61c9\u8ca0\u8f09\u5e73\u8861\u5668\u7684\u8f49\u767c\u898f\u5247\u6307\u5b9a\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u3002\u5f9e\u4ee3\u7406\u767c\u9001\u5230\u7aef\u9ede\u7684\u6bcf\u500b\u6578\u64da\u5305\u7684\u4f86\u6e90 IP \u5730\u5740\u662f\u5f9e\u4ee3\u7406\u5c08\u7528\u5b50\u7db2\u5206\u914d\u7d66\u8a72\u4ee3\u7406\u7684\u5167\u90e8 IP \u5730\u5740\u3002\n## \u8ca0\u8f09\u5747\u8861\u5668\u8207\u61c9\u7528\u4e4b\u9593\u7684 HTTPS (TLS)\n\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u5145\u7576\u60a8\u7684\u5ba2\u6236\u7aef\u548c\u61c9\u7528\u4e4b\u9593\u7684\u4ee3\u7406\u3002\u5ba2\u6236\u7aef\u53ef\u4ee5\u4f7f\u7528 HTTP \u6216 HTTPS \u8207\u8ca0\u8f09\u5747\u8861\u5668\u4ee3\u7406\u9032\u884c\u901a\u4fe1\u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u5f9e\u8ca0\u8f09\u5747\u8861\u5668\u4ee3\u7406\u5230\u61c9\u7528\u7684\u9023\u63a5\u4f7f\u7528 HTTP\u3002\u4e0d\u904e\uff0c\u5982\u679c\u60a8\u7684\u61c9\u7528\u5728 GKE Pod \u4e2d\u904b\u884c\u4e26\u4e14\u53ef\u4ee5\u63a5\u6536 HTTPS \u8acb\u6c42\uff0c\u60a8\u53ef\u4ee5\u5c07\u8ca0\u8f09\u5747\u8861\u5668\u914d\u7f6e\u7232\u4f7f\u7528 HTTPS \u5c07\u8acb\u6c42\u8f49\u767c\u7d66\u61c9\u7528\u3002\n\u5982\u9700\u914d\u7f6e\u8ca0\u8f09\u5747\u8861\u5668\u548c\u61c9\u7528\u4e4b\u9593\u4f7f\u7528\u7684\u5354\u8b70\uff0c\u8acb\u5728 Service \u6e05\u55ae\u4e2d\u4f7f\u7528 `cloud.google.com/app-protocols` \u8a3b\u91cb\u3002\n\u4ee5\u4e0b Service \u6e05\u55ae\u6307\u5b9a\u4e86\u5169\u500b\u7aef\u53e3\u3002\u8a72\u8a3b\u89e3\u6307\u5b9a\uff0c\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u5728\u5b9a\u4f4d Service \u7684\u7aef\u53e3 80 \u6642\u61c9\u4f7f\u7528 HTTP\uff0c\u5728\u5b9a\u4f4d Service \u7684\u7aef\u53e3 443 \u6642\u61c9\u4f7f\u7528 HTTPS\u3002\n\u60a8\u5fc5\u9808\u5728\u8a72\u8a3b\u91cb\u4e2d\u4f7f\u7528\u7aef\u53e3\u7684 `name` \u5b57\u6bb5\uff1b\u8acb\u52ff\u4f7f\u7528\u5176\u4ed6\u5b57\u6bb5\uff0c\u4f8b\u5982 `targetPort` \u3002\n**\u6ce8\u610f** \uff1a\u7232\u4e86\u9650\u5236\u6f5b\u5728\u7684\u505c\u6a5f\u6642\u9593\uff0c\u5728\u5553\u7528\u6b64\u529f\u80fd\u6642\u8acb\u52ff\u4fee\u6539 Service \u7684\u7aef\u53e3\u540d\u7a31\u3002\u5982\u679c\u60a8\u7684 Service \u7aef\u53e3\u6c92\u6709\u540d\u7a31\uff0c\u8acb\u5728\u8a3b\u91cb\u4e2d\u4f7f\u7528\u7a7a\u7aef\u53e3\u540d\u7a31\u4f5c\u7232\u9375\uff0c\u985e\u4f3c\u65bc `cloud.google.com/app-protocols: '{\"\": \"HTTPS\"}'` \u3002\u5728\u521d\u59cb\u8a2d\u7f6e\u5f8c\u4fee\u6539\u7aef\u53e3\u540d\u7a31\u6216\u8a3b\u91cb\u53ef\u80fd\u6703\u5c0e\u81f4\u61c9\u7528\u505c\u6a5f\n```\napiVersion: v1kind: Servicemetadata:\u00a0 name: my-service\u00a0 annotations:\u00a0 \u00a0 cloud.google.com/app-protocols: '{\"my-https-port\":\"HTTPS\",\"my-http-port\":\"HTTP\"}'spec:\u00a0 type: NodePort\u00a0 selector:\u00a0 \u00a0 app: metrics\u00a0 \u00a0 department: sales\u00a0 ports:\u00a0 - name: my-https-port\u00a0 \u00a0 port: 443\u00a0 \u00a0 targetPort: 8443\u00a0 - name: my-http-port\u00a0 \u00a0 port: 80\u00a0 \u00a0 targetPort: 50001\n```\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [\u77ad\u89e3\u5982\u4f55\u90e8\u7f72\u4ee3\u7406\u5c08\u7528\u5b50\u7db2](https://cloud.google.com/load-balancing/docs/l7-internal/setting-up-l7-internal?hl=zh-cn#configure-a-network) \u3002\n- [\u77ad\u89e3\u9069\u7528\u65bc\u5916\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress](https://cloud.google.com/kubernetes-engine/docs/concepts/ingress-xlb?hl=zh-cn) \u3002\n- [\u77ad\u89e3\u5982\u4f55\u914d\u7f6e\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u7684 Ingress](https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balance-ingress?hl=zh-cn) \u3002\n- [\u95b1\u8b80 GKE \u4e2d\u7684\u7db2\u7d61\u6982\u89bd](https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}