{"title": "Google Kubernetes Engine (GKE) - \u85c9\u52a9 GKE \u5be6\u73fe\u73fe\u4ee3 CI/CD\uff1a\u61c9\u7528\u958b\u767c\u8005\u5de5\u4f5c\u6d41", "url": "https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-developer-workflow?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u85c9\u52a9 GKE \u5be6\u73fe\u73fe\u4ee3 CI/CD\uff1a\u61c9\u7528\u958b\u767c\u8005\u5de5\u4f5c\u6d41\nLast reviewed 2023-09-11 UTC\n\u672c\u6559\u7a0b\u4ecb\u7d39\u77ad\u5982\u4f55\u85c9\u52a9 Google Kubernetes Engine (GKE) \u4f7f\u7528\u73fe\u4ee3\u6301\u7e8c\u96c6\u6210/\u6301\u7e8c\u4ea4\u4ed8 (CI/CD) \u6280\u8853\u4f86\u521d\u59cb\u914d\u7f6e\u65b0\u61c9\u7528\u3001\u7232\u61c9\u7528\u958b\u767c\u529f\u80fd\u4ee5\u53ca\u5c07\u61c9\u7528\u90e8\u7f72\u5230\u751f\u7522\u74b0\u5883\u3002\n\u672c\u6587\u6a94\u662f\u4ee5\u4e0b\u7cfb\u5217\u6587\u7ae0\u4e2d\u7684\u4e00\u7bc7\uff1a- [\u85c9\u52a9 GKE \u5be6\u73fe\u73fe\u4ee3 CI/CD\uff1a\u8edf\u4ef6\u4ea4\u4ed8\u6846\u67b6](https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-user-guide?hl=zh-cn) \n- [\u85c9\u52a9 GKE \u5be6\u73fe\u73fe\u4ee3 CI/CD\uff1a\u69cb\u5efa CI/CD \u7cfb\u7d71](https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-reference-architecture?hl=zh-cn) \uff08\u53c3\u8003\u67b6\u69cb\uff09\n- \u85c9\u52a9 GKE \u4f7f\u7528\u73fe\u4ee3 CI/CD\uff1a\u61c9\u7528\u958b\u767c\u8005\u5de5\u4f5c\u6d41\uff08\u672c\u6587\u6a94\uff09\n\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 [Skaffold](https://skaffold.dev) \u3001 [kustomize](https://github.com/kubernetes-sigs/kustomize#kustomize) \u3001 [Artifact Registry](https://cloud.google.com/artifact-registry?hl=zh-cn) \u3001 [Config Sync](https://cloud.google.com/anthos-config-management/docs/config-sync-overview?hl=zh-cn) \u3001 [Cloud Build](https://cloud.google.com/build?hl=zh-cn) \u548c [Cloud Deploy](https://cloud.google.com/deploy?hl=zh-cn) \u7b49\u5de5\u5177\u4f86\u958b\u767c\u3001\u69cb\u5efa\u548c\u90e8\u7f72\u61c9\u7528\u3002\n\u672c\u6587\u6a94\u9762\u5411\u4f01\u696d\u67b6\u69cb\u5e2b\u548c\u61c9\u7528\u958b\u767c\u8005\uff0c\u4ee5\u53ca IT \u5b89\u5168\u3001DevOps \u548c\u7db2\u7ad9\u53ef\u9760\u6027\u5de5\u7a0b (SRE) \u5718\u968a\u3002\u64c1\u6709\u4e00\u4e9b\u81ea\u52d5\u5316\u90e8\u7f72\u5de5\u5177\u548c\u6d41\u7a0b\u7684\u76f8\u95dc\u7d93\u9a57\u5c0d\u65bc\u7406\u89e3\u672c\u6587\u6a94\u4e2d\u7684\u6982\u5ff5\u5f88\u6709\u7528\u3002", "content": "## \u67b6\u69cb\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u521d\u59cb\u914d\u7f6e\u65b0\u61c9\u7528\u3002\u7136\u5f8c\uff0c\u60a8\u53ef\u4ee5\u958b\u767c\u65b0\u529f\u80fd\uff0c\u4e26\u5728\u958b\u767c\u3001\u9810\u6f14\u548c\u751f\u7522\u74b0\u5883\u4e2d\u90e8\u7f72\u61c9\u7528\u3002 \u53c3\u8003\u67b6\u69cb\u5305\u542b\u4f7f\u7528\u65b0\u6d41\u7a0b\u521d\u59cb\u914d\u7f6e\u548c\u767c\u4f48\u65b0\u61c9\u7528\u6240\u9700\u7684\u57fa\u790e\u67b6\u69cb\u548c\u5de5\u5177\uff1a\u5f9e CI \u7684\u4ee3\u78bc\u5eab\u958b\u59cb\uff0c\u5de5\u4f5c\u6d41\u5305\u62ec\u4ee5\u4e0b\u6b65\u9a5f\uff1a- \u60a8\u53ef\u4ee5\u901a\u904e\u61c9\u7528\u4ee3\u78bc\u5eab\u5171\u4eab\u61c9\u7528\u6e90\u4ee3\u78bc\u3002\n- \u7576\u60a8\u63d0\u4ea4\u4ee3\u78bc\u4e26\u5c07\u5176\u63a8\u9001\u5230\u61c9\u7528\u4ee3\u78bc\u5eab\u6642\uff0c\u5b83\u6703\u81ea\u52d5\u5728 Cloud Build \u4e2d\u89f8\u767c\u6301\u7e8c\u96c6\u6210\u6d41\u6c34\u7dda\u3002CI \u6d41\u7a0b\u5275\u5efa\u5bb9\u5668\u6620\u50cf\u4e26\u5c07\u5176\u63a8\u9001\u5230 Artifact Registry\u3002\n- CI \u6d41\u7a0b\u9084\u6703\u5728 Cloud Deploy \u4e2d\u7232\u61c9\u7528\u5275\u5efa CD \u7248\u672c\u3002\n- CD \u7248\u672c\u4f7f\u7528 `skaffold` \u7232\u958b\u767c\u751f\u6210\u5b8c\u5168\u6e32\u67d3\u7684 kubernetes \u6e05\u55ae\uff0c\u4e26\u5c07\u5176\u90e8\u7f72\u5230\u958b\u767c GKE \u96c6\u7fa3\u4e2d\u3002\n- \u7136\u5f8c\uff0cCD \u7248\u672c\u5f9e\u958b\u767c\u63d0\u5347\u5230\u9810\u6f14\u76ee\u6a19\uff0c\u53ef\u751f\u6210\u5b8c\u5168\u6e32\u67d3\u7684\u9810\u6f14\u6e05\u55ae\u4e26\u5c07\u5176\u90e8\u7f72\u5230\u9810\u6f14 GKE \u96c6\u7fa3\u3002\n- \u7136\u5f8c\uff0cCD \u7248\u672c\u5f9e\u9810\u6f14\u74b0\u5883\u63d0\u5347\u5230\u751f\u7522\u74b0\u5883\uff0c\u53ef\u751f\u6210\u5b8c\u5168\u6e32\u67d3\u7684\u751f\u7522\u6e05\u55ae\u4e26\u5c07\u5176\u90e8\u7f72\u5230\u751f\u7522 GKE \u96c6\u7fa3\u4e2d\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6b64\u5de5\u4f5c\u6d41\u4e2d\u4f7f\u7528\u7684\u5de5\u5177\u548c\u57fa\u790e\u67b6\u69cb\uff0c\u8acb\u53c3\u95b1 [\u201c\u85c9\u52a9 GKE \u4f7f\u7528\u73fe\u4ee3 CI/CD\uff1a\u69cb\u5efa CI/CD \u7cfb\u7d71\u201d](https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-reference-architecture?hl=zh-cn) \u3002## \u76ee\u6a19\n- \u521d\u59cb\u914d\u7f6e\u65b0\u61c9\u7528\u3002\n- \u5728\u958b\u767c\u74b0\u5883\u4e2d\u90e8\u7f72\u61c9\u7528\u3002\n- \u958b\u767c\u65b0\u529f\u80fd\u4e26\u5c07\u5176\u90e8\u7f72\u5230\u958b\u767c\u74b0\u5883\u4e2d\u3002\n- \u5c07\u65b0\u529f\u80fd\u63d0\u5347\u5230\u9810\u6f14\u74b0\u5883\uff0c\u7136\u5f8c\u5c07\u5176\u767c\u4f48\u5230\u751f\u7522\u74b0\u5883\u4e2d\u3002\n- \u6e2c\u8a66\u61c9\u7528\u7684\u5f48\u6027\u3002\n## \u8cbb\u7528\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Google Cloud \u7684\u4ee5\u4e0b\u6536\u8cbb\u7d44\u4ef6\uff1a- [Google Kubernetes Engine](https://cloud.google.com/kubernetes-engine/pricing?hl=zh-cn) \n- \u9069\u7528\u65bc Config Syncyes \u7684 [Google Kubernetes Engine (GKE) \u4f01\u696d\u7248](https://cloud.google.com/kubernetes-engine/pricing?hl=zh-cn) \n- [Artifact Registry](https://cloud.google.com/artifact-registry/pricing?hl=zh-cn) \n- [Cloud Build](https://cloud.google.com/build/pricing?hl=zh-cn) \n- [Cloud Deploy](https://cloud.google.com/deploy/pricing?hl=zh-cn) \n\u60a8\u53ef\u4f7f\u7528 [\u50f9\u683c\u8a08\u7b97\u5668](https://cloud.google.com/products/calculator?hl=zh-cn) \u6839\u64da\u60a8\u7684\u9810\u8a08\u4f7f\u7528\u60c5\u6cc1\u4f86\u4f30\u7b97\u8cbb\u7528\u3002 \nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5b8c\u6210\u672c\u6587\u6a94\u4e2d\u63cf\u8ff0\u7684\u4efb\u52d9\u5f8c\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u522a\u9664\u6240\u5275\u5efa\u7684\u8cc7\u6e90\u4f86\u907f\u514d\u7e7c\u7e8c\u8a08\u8cbb\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e05\u7406](#clean-up) \u3002## \u6e96\u5099\u5de5\u4f5c\n- \u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u90e8\u7f72\u672c\u7cfb\u5217\u6587\u7ae0\u4e2d\u7684 [\u53c3\u8003\u67b6\u69cb](https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-reference-architecture?hl=zh-cn) \u3002\n## \u6e96\u5099\u74b0\u5883\n- \u5982\u679c\u60a8\u8981\u76f4\u63a5\u5f9e [\u85c9\u52a9 GKE \u4f7f\u7528\u73fe\u4ee3 CI/CD\uff1a\u69cb\u5efa CI/CD \u7cfb\u7d71](https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-reference-architecture?hl=zh-cn) \u7e7c\u7e8c\u64cd\u4f5c\uff0c\u8acb\u8f49\u5230\u4e0b\u4e00\u90e8\u5206\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u6709\u4e00\u500b\u65b0\u6703\u8a71\uff0c\u6216\u8005\u6703\u8a71\u5df2\u904e\u671f\uff0c\u8acb\u6253\u958b Cloud Shell \u4e26\u8a2d\u7f6e\u5b89\u88dd\u53c3\u8003\u67b6\u69cb\u57fa\u790e\u67b6\u69cb\u7684\u9805\u76ee\uff1a```\ngcloud config set core/project PROJECT_ID\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\n## \u521d\u59cb\u914d\u7f6e\u65b0\u61c9\u7528\u53c3\u8003\u67b6\u69cb\u5305\u542b\u61c9\u7528\u5de5\u5ee0\u3002\u6b64\u5de5\u5ee0\u662f\u540d\u7232 `application-factory-repo` \u7684 Git \u4ee3\u78bc\u5eab\u548c\u4ee5\u4e0b Cloud Build \u89f8\u767c\u5668\u7684\u96c6\u5408\uff1a- `create-app`\n- `tf-plan`\n- `tf-apply`\n- `create-team`\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u61c9\u7528\u5de5\u5ee0\u5f9e\u5165\u9580\u7d1a\u4ee3\u78bc\u5eab\u521d\u59cb\u914d\u7f6e\u65b0\u61c9\u7528\u3002\u61c9\u7528\u521d\u59cb\u914d\u7f6e\u5305\u62ec\u4ee5\u4e0b\u6b65\u9a5f\uff1a- **\u5275\u5efa\u61c9\u7528\u5b9a\u7fa9** \uff1a\u60a8\u53ef\u4ee5\u5728 Terraform \u6587\u4ef6\u4e2d\u5275\u5efa\u61c9\u7528\u5b9a\u7fa9\uff0c\u4e26\u5c07\u5176\u5b58\u5132\u5728\u5145\u7576\u61c9\u7528\u76ee\u9304\u7684 `application-factory-repo` \u4e2d\u3002\n- **\u5275\u5efa\u61c9\u7528\u57fa\u790e\u67b6\u69cb** \uff1a\u5728\u61c9\u7528\u5b9a\u7fa9\u6587\u4ef6\u4e0a\u904b\u884c Terraform \u4ee5\u5275\u5efa\u61c9\u7528\u57fa\u790e\u67b6\u69cb\u3002\u61c9\u7528\u57fa\u790e\u67b6\u69cb\u5305\u62ec\u4ee5\u4e0b\u7d44\u4ef6\uff1a- \u65b0\u61c9\u7528\u7684 [\u7740\u9678\u5340](https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-reference-architecture?hl=zh-cn#application_landing_zones) \u5305\u62ec\u5728 `acm-gke-infrastructure-repo` \u4ee3\u78bc\u5eab\u4e2d\u5b9a\u7fa9\u547d\u540d\u7a7a\u9593\u3001\u670d\u52d9\u8cec\u865f\u548c\u57fa\u672c\u653f\u7b56\u3002\u7740\u9678\u5340\u50c5\u5728\u521d\u59cb\u914d\u7f6e\u65b0\u61c9\u7528\u6642\u5728\u958b\u767c GKE \u96c6\u7fa3\u4e2d\u5275\u5efa\u3002\u9019\u6a23\u505a\u662f\u7232\u4e86\u53d6\u6d88\u5c4f\u853d\u958b\u767c\u8005\uff0c\u4ee5\u4fbf\u4ed6\u5011\u80fd\u5920\u4f7f\u7528\u958b\u767c\u74b0\u5883\u4e26\u958b\u59cb\u8fed\u4ee3\u3002\u9810\u6f14\u96c6\u7fa3\u548c\u751f\u7522\u96c6\u7fa3\u4e2d\u7684\u7740\u9678\u5340\u901a\u904e GitOps \u65b9\u6cd5\u5275\u5efa\u3002\u672c\u6587\u6a94\u7a0d\u5f8c\u6703\u5728\u60a8\u6e96\u5099\u63d0\u5347\u9019\u4e9b\u96c6\u7fa3\u4e2d\u7684\u7248\u672c\u6642\u6f14\u793a\u6b64\u65b9\u6cd5\u3002\n- \u4f86\u81ea [\u57fa\u790e\u67b6\u69cb\u8d77\u59cb\u4ee3\u78bc\u5eab](https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-reference-architecture?hl=zh-cn#infrastructure_starter_repositories) \u7684\u57fa\u790e\u67b6\u69cb\u4ee3\u78bc\u5eab\uff08\u8a72\u4ee3\u78bc\u5eab\u8a17\u7ba1\u4ee3\u78bc\u4ee5\u5728 Cloud Build \u4e2d\u5275\u5efa CI \u6d41\u6c34\u7dda\u3001\u5728 Cloud Deploy \u4e2d\u5275\u5efa CD \u6d41\u6c34\u7dda\uff09\u4ee5\u53ca\u7528\u65bc\u5b58\u5132\u5de5\u4ef6\u7684 Artifact Registry \u4ee3\u78bc\u5eab\u3002\n- \u57fa\u790e\u67b6\u69cb Cloud Build \u89f8\u767c\u5668\uff0c\u53ef\u63a1\u7528\u57fa\u790e\u67b6\u69cb\u4ee3\u78bc\u5eab\u4e2d\u7684\u4ee3\u78bc\uff0c\u4e26\u6839\u64da\u5176\u5b9a\u7fa9\u5275\u5efa\u8cc7\u6e90\u3002\n- \u4f86\u81ea [\u61c9\u7528\u8d77\u59cb\u4ee3\u78bc\u5eab](https://cloud.google.com/kubernetes-engine/docs/tutorials/modern-cicd-gke-reference-architecture?hl=zh-cn#applications_starter_repositories) \u7684\u61c9\u7528\u4ee3\u78bc\u5eab\uff0c\u7528\u65bc\u8a17\u7ba1\u61c9\u7528\u7684\u6e90\u4ee3\u78bc\u3002\n- **\u5275\u5efa\u61c9\u7528\u7684 CI/CD \u8cc7\u6e90** \uff1a\u60a8\u53ef\u4ee5\u4f7f\u7528\u61c9\u7528\u57fa\u790e\u67b6\u69cb\u7232\u61c9\u7528\u5275\u5efa CI/CD \u8cc7\u6e90\u3002\n **\u6ce8\u610f\uff1a** \u53c3\u8003\u67b6\u69cb\u652f\u6301\u60a8\u81ea\u52d5\u57f7\u884c\u6574\u500b\u61c9\u7528\u521d\u59cb\u914d\u7f6e\u548c\u90e8\u7f72\u6b65\u9a5f\u3002\u672c\u6587\u6a94\u5c07\u8a73\u7d30\u4ecb\u7d39\u9019\u4e9b\u6b65\u9a5f\uff0c\u4ee5\u4fbf\u60a8\u66f4\u597d\u5730\u77ad\u89e3\u67b6\u69cb\u3002\n### \u5275\u5efa\u61c9\u7528\u5b9a\u7fa9\uff1a\u904b\u884c `create-app` \u89f8\u767c\u5668\u4ee5\u5728 `application-factory-repo` \u4e2d\u751f\u6210\u61c9\u7528\u5b9a\u7fa9\u6587\u4ef6\u3002\u5b9a\u7fa9\u6587\u4ef6\u5305\u542b\u5275\u5efa\u61c9\u7528\u6240\u9700\u7684\u8cc7\u6e90\u7684\u8072\u660e\u6027\u5b9a\u7fa9\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 Cloud Build \u9801\u9762\uff1a [\u8f49\u5230 Cloud Build \u9801\u9762](https://console.cloud.google.com/cloud-build/triggers?hl=zh-cn) \n- \u9ede\u64ca **create-app \u89f8\u767c\u5668** \u3002\n- \u9ede\u64ca **\u986f\u793a\u7db2\u5740\u9810\u89bd** \u4ee5\u986f\u793a\u8abf\u7528 webhook \u6240\u9700\u7684\u7db2\u5740\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u901a\u904e\u5c0d\u4e0a\u4e00\u6b65\u4e2d\u7372\u5f97\u7684\u7db2\u5740\u767c\u51fa curl \u8acb\u6c42\u4e26\u5c07\u53c3\u6578\u4f5c\u7232\u8f09\u8377\u50b3\u905e\u7d66\u8a72\u53c3\u6578\u4f86\u8abf\u7528\u89f8\u767c\u5668\u3002```\ncurl \"WEBHOOK_URL\" -d '{\"message\": {\"app\": \"sample\",\"runtime\": \"python\",\"trigger_type\": \"webhook\",\"github_team\": \"\"}}'\n```\u5728\u524d\u9762\u7684\u4ee3\u78bc\u793a\u4f8b\u4e2d\uff1a- \u5c07 `` \u66ff\u63db\u7232\u5f9e\u89f8\u767c\u5668\u7372\u53d6\u7684\u7db2\u5740\u3002\n- `\"app\": \"sample\"` \u6307\u5b9a\u61c9\u7528\u7684\u540d\u7a31\u3002\n- `\"runtime\": \"python\"` \u6307\u793a\u61c9\u7528\u5de5\u5ee0\u4f7f\u7528 Python \u6a21\u677f\u5275\u5efa\u61c9\u7528\u4ee3\u78bc\u5eab\u3002\n- `\"trigger_type\": \"webhook\"` \u6307\u5b9a\u61c9\u7528\u7684 CI/CD \u6d41\u6c34\u7dda\u985e\u578b\u3002\n- `\"github_team\": \"\"` \u662f GitHub \u4e2d\u5c07\u8207\u7232\u61c9\u7528\u5275\u5efa\u7684\u4ee3\u78bc\u5eab\u95dc\u806f\u7684\u5718\u968a\u3002\u60a8\u5c1a\u672a\u5275\u5efa GitHub \u5718\u968a\uff0c\u56e0\u6b64\u8acb\u4ee5\u7a7a\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u50b3\u905e\u3002\n- \u6aa2\u67e5\u6d41\u6c34\u7dda\u4e2d\u662f\u5426\u5b58\u5728 `create-app` \u89f8\u767c\u5668\uff1a [\u8f49\u5230\u201cCloud Build \u6b77\u53f2\u8a18\u9304\u201d\u9801\u9762](https://console.cloud.google.com/cloud-build/builds?hl=zh-cn) \u3002`create-app` \u89f8\u767c\u5668\u6709\u4e00\u500b\u65b0\u6d41\u6c34\u7dda\u3002\u5b8c\u6210\u6b64\u64cd\u4f5c\u5f8c\uff0c\u7cfb\u7d71\u6703\u5728 `application-factory-repo` \u4e2d\u5275\u5efa\u61c9\u7528\u5b9a\u7fa9\u3002\n- \u67e5\u770b\u61c9\u7528\u5b9a\u7fa9\u6587\u4ef6\uff1a- \u5728\u7db2\u7d61\u700f\u89bd\u5668\u4e2d\uff0c\u8f49\u5230 [GitHub](https://github.com/) \u4e26\u767b\u9304\u60a8\u7684\u8cec\u865f\u3002\n- \u9ede\u64ca\u5716\u7247\u5716\u6a19\uff0c\u7136\u5f8c\u9ede\u64ca **Your organizations** \u9078\u64c7\u60a8\u7684\u7d44\u7e54\u3002\n- \u9ede\u64ca\u4ee3\u78bc\u5eab `application-factory-repo` \uff0c\u8f49\u5230\u6587\u4ef6\u593e `apps/python` \uff0c\u7136\u5f8c\u6253\u958b\u7531 `create-app` \u89f8\u767c\u5668\u5275\u5efa\u7684\u540d\u7232 `sample.tf` \u7684\u65b0\u6587\u4ef6\u3002\u6aa2\u67e5\u8a72\u6587\u4ef6\uff0c\u6b64\u6587\u4ef6\u5305\u542b Terraform \u4ee3\u78bc\u4ee5\u5275\u5efa\u65b0\u61c9\u7528\u3002\n### \u5275\u5efa\u61c9\u7528\u57fa\u790e\u67b6\u69cb\uff1a\u73fe\u5728\u60a8\u5df2\u7d93\u5275\u5efa\u4e86\u61c9\u7528\u5b9a\u7fa9\uff0c\u63a5\u4e0b\u4f86\u904b\u884c\u89f8\u767c\u5668 `tf-apply` \u4f86\u5275\u5efa\u61c9\u7528\u57fa\u790e\u67b6\u69cb\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff1a [\u8f49\u5230 Cloud Build \u9801\u9762](https://console.cloud.google.com/cloud-build/triggers?hl=zh-cn) \u3002\u9ede\u64ca `tf-apply` \u89f8\u767c\u5668\u3002\n- \u9ede\u64ca\u201c\u986f\u793a\u7db2\u5740\u9810\u89bd\u201d\uff0c\u4ee5\u986f\u793a\u8abf\u7528 webhook \u6240\u9700\u7684\u7db2\u5740\u3002\n- \u8abf\u7528\u89f8\u767c\u5668\uff1a```\ncurl \"WEBHOOK_URL\" -d '{}'\n```\u5728\u524d\u9762\u7684\u4ee3\u78bc\u793a\u4f8b\u4e2d\uff1a- \u5c07``\u66ff\u63db\u7232\u5f9e\u89f8\u767c\u5668\u7372\u53d6\u7684\u7db2\u5740\u3002\n- \u6aa2\u67e5\u6d41\u6c34\u7dda\u4e2d\u662f\u5426\u5b58\u5728 `tf-apply` \u89f8\u767c\u5668\uff1a [\u8f49\u5230\u201cCloud Build \u6b77\u53f2\u8a18\u9304\u201d\u9801\u9762](https://console.cloud.google.com/cloud-build/builds?hl=zh-cn) \u3002`tf-apply` \u89f8\u767c\u5668\u6709\u4e00\u500b\u65b0\u6d41\u6c34\u7dda\u3002\u7b49\u5f85\u6b64\u904e\u7a0b\u5b8c\u6210\u3002\n\u6b64\u89f8\u767c\u5668\u6703\u5275\u5efa\u61c9\u7528\u57fa\u790e\u67b6\u69cb\u3002\n### \u5be9\u8988\u61c9\u7528\u57fa\u790e\u67b6\u69cb\uff1a\u67e5\u770b\u61c9\u7528\u57fa\u790e\u67b6\u69cb\u7684\u5404\u7a2e\u7d44\u4ef6\u3002\n- \u8f49\u5230 Cloud Shell \u4e26\u8a2d\u7f6e\u9805\u76ee\u3002```\ngcloud config set core/project PROJECT_ID\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\n- \u7372\u53d6\u958b\u767c GKE \u96c6\u7fa3\u7684\u6191\u64da\u3002```\ngcloud container clusters get-credentials gke-dev-us-central1 --zone us-central1-a\n```\n- \u6aa2\u67e5\u61c9\u7528\u7684\u547d\u540d\u7a7a\u9593\u3002\u547d\u540d\u7a7a\u9593\u4ee5\u61c9\u7528\u793a\u4f8b\u547d\u540d\u3002```\nkubectl get namespaces sample\n```\u8f38\u51fa\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME  STATUS AGE\nsample Active 15m\n```\n- \u6aa2\u67e5\u547d\u540d\u7a7a\u9593\u4e2d\u7684\u670d\u52d9\u8cec\u865f\u3002```\nkubectl get serviceaccounts -n sample\n```\u9664\u4e86\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u4e4b\u5916\uff0c\u9084\u6709\u4e00\u500b\u670d\u52d9\u8cec\u865f\u3002\u8f38\u51fa\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME   SECRETS AGE\ndefault  0   15m\nsample-ksa 0   15m\n```\n\u5728\u7db2\u7d61\u700f\u89bd\u5668\u4e2d\uff0c\u8f49\u5230 [GitHub](https://github.com/) \u4e26\u767b\u9304\u60a8\u7684\u8cec\u865f\u3002 \u9ede\u64ca\u7167\u7247\u5716\u6a19\u3002\u7136\u5f8c\u9ede\u64ca `Your organizations` \u3002\u9078\u64c7\u60a8\u7684\u7d44\u7e54\uff0c\u7136\u5f8c\u9ede\u64ca `sample-infra` \u4ee3\u78bc\u5eab\u3002\n\u6b64\u4ee3\u78bc\u5eab\u6709\u56db\u500b\u5206\u652f\uff1a `cicd-trigger` \u3001 `dev` \u3001 `staging` \u548c `prod` \u3002\u5b83\u9084\u5305\u542b\u56db\u500b cicd-trigger\u3001dev\u3001staging \u548c prod \u6587\u4ef6\u593e\u3002\u9ed8\u8a8d\u5206\u652f\u7232 `cicd-trigger` \uff0c\u60a8\u53ef\u4ee5\u5c07\u4ee3\u78bc\u63a8\u9001\u5230\u5176\u4e2d\uff0c\u800c\u5176\u4ed6\u5206\u652f\u5247\u5177\u6709\u4fdd\u8b77\u898f\u5247\uff0c\u56e0\u6b64\u60a8\u7121\u6cd5\u5c07\u4ee3\u78bc\u76f4\u63a5\u63a8\u9001\u5230\u9019\u4e9b\u5206\u652f\u3002\u7232\u4e86\u5c07\u4ee3\u78bc\u63a8\u9001\u5230\u9019\u4e9b\u5206\u652f\uff0c\u60a8\u9700\u8981\u5275\u5efa\u62c9\u53d6\u8acb\u6c42\u3002 `cicd-trigger` \u6587\u4ef6\u593e\u5305\u542b\u7528\u65bc\u7232\u61c9\u7528\u5275\u5efa CI/CD \u8cc7\u6e90\u7684\u4ee3\u78bc\uff0c\u800c `dev` \u3001 `staging` \u548c `prod` \u6587\u4ef6\u593e\u5305\u542b\u7528\u65bc\u7232\u61c9\u7528\u7684\u4e0d\u540c\u74b0\u5883\u5275\u5efa\u57fa\u790e\u67b6\u69cb\u7684\u4ee3\u78bc\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff1a [\u8f49\u5230 Cloud Build \u9801\u9762](https://console.cloud.google.com/cloud-build/triggers?hl=zh-cn) \u6709\u4e00\u500b\u540d\u7232 `deploy-infra-sample` \u7684\u65b0\u89f8\u767c\u5668\u3002\n- \u6b64\u89f8\u767c\u5668\u5df2\u9023\u63a5\u5230\u4ee3\u78bc\u5eab `sample-infra` \uff0c\u56e0\u6b64\u7576\u4ee3\u78bc\u63a8\u9001\u5230\u6b64\u4ee3\u78bc\u5eab\u6642\uff0c\u5c07\u8abf\u7528\u8a72\u89f8\u767c\u5668\u4e26\u78ba\u5b9a\u89f8\u767c\u63a8\u9001\u7684\u5206\u652f\uff0c\u7136\u5f8c\u8f49\u5230\u8a72\u5206\u652f\u4e0a\u7684\u76f8\u61c9\u6587\u4ef6\u593e\uff0c\u4e26\u5728\u8a72\u8655\u904b\u884c Terraform\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4ee3\u78bc\u63a8\u9001\u5230 `cicd-trigger` \u5206\u652f\uff0c\u5247\u89f8\u767c\u5668\u6703\u5728 cicd-trigger \u5206\u652f\u7684 cicd-trigger \u6587\u4ef6\u593e\u4e0a\u904b\u884c Terraform\u3002\u540c\u6a23\uff0c\u7576\u63a8\u9001\u5230 `dev` \u5206\u652f\u6642\uff0c\u89f8\u767c\u5668\u6703\u5728\u958b\u767c\u5206\u652f\u7684\u958b\u767c\u6587\u4ef6\u593e\u4e0a\u904b\u884c Terraform\uff0c\u4f9d\u6b64\u985e\u63a8\u3002\n- \u8f49\u5230 [GitHub](https://github.com/) \u4e26\u62c9\u53d6\u7d44\u7e54\u4e0b\u7684\u4ee3\u78bc\u5eab\u3002\u6709\u4e00\u500b\u540d\u7232`sample`\u7684\u65b0\u4ee3\u78bc\u5eab\u3002\u6b64\u4ee3\u78bc\u5eab\u8a17\u7ba1\u5728`Dockerfile`\u4e2d\u69cb\u5efa\u5bb9\u5668\u7684\u6e90\u4ee3\u78bc\u548c\u6b65\u9a5f\u3001`kustomize`\u914d\u7f6e\uff08\u63cf\u8ff0\u61c9\u7528\u7684\u6240\u9700\u914d\u7f6e\uff09\uff0c\u4ee5\u53ca`skaffold.yaml`\uff08\u5b9a\u7fa9 Cloud Deploy for CD \u8981\u4f7f\u7528\u7684\u90e8\u7f72\u6b65\u9a5f\uff09\u3002\n### \u5275\u5efa\u61c9\u7528 CI/CD \u8cc7\u6e90\u73fe\u5728\u60a8\u5df2\u7d93\u5275\u5efa\u4e86\u61c9\u7528\u7684\u6846\u67b6\uff0c\u63a5\u4e0b\u4f86\u904b\u884c\u89f8\u767c\u5668 `deploy-infra-sample` \u4ee5\u5275\u5efa\u5176 CI/CD \u8cc7\u6e90\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u89f8\u767c\u5668\u7684 webhook \u7db2\u5740\u6216\u5411 Git \u4ee3\u78bc\u5eab `sample-infra` \u63d0\u4ea4\u4f86\u624b\u52d5\u8abf\u7528\u89f8\u767c\u5668\u3002- \u5982\u9700\u8abf\u7528 Cloud Build \u89f8\u767c\u5668\uff0c\u8acb\u5728\u4ee3\u78bc\u5eab\u7684\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u500b\u65b0\u884c\u3002\u7136\u5f8c\uff0c\u63a8\u9001\u66f4\u6539\uff1a- \u5982\u679c\u60a8\u5f9e\u672a\u5728 Cloud Shell \u4e2d\u4f7f\u7528\u904e Git\uff0c\u8acb\u4f7f\u7528\u60a8\u7684\u59d3\u540d\u548c\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\u914d\u7f6e Git\u3002Git \u6839\u64da\u9019\u4e9b\u4fe1\u606f\u78ba\u5b9a\u60a8\u5c31\u662f\u5728 Cloud Shell \u4e2d\u5275\u5efa\u7684\u63d0\u4ea4\u7684\u4f5c\u8005\u672c\u4eba\u3002```\ngit config --global user.email \"GITHUB_EMAIL_ADDRESS\"git config --global user.name \"GITHUB_USERNAME\"\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u8207\u60a8\u7684 GitHub \u8cec\u865f\u95dc\u806f\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\n- ``\uff1a\u8207\u60a8\u7684 GitHub \u8cec\u865f\u95dc\u806f\u7684\u7528\u6236\u540d\n- \u514b\u9686 Git \u4ee3\u78bc\u5eab `sample-infra` \uff1a```\ngit clone https://github.com/GITHUB_ORG/sample-infracd sample-infra\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \u5c07``\u66ff\u63db\u7232\u60a8\u7684 GitHub \u7d44\u7e54\u3002\n\u9ed8\u8a8d\u5206\u652f cicd \u89f8\u767c\u5668\u5df2\u7c3d\u51fa\u3002\n- \u5728 env/cicd-trigger/main.tf \u6587\u4ef6\u4e2d\u6dfb\u52a0\u65b0\u884c\uff0c\u63d0\u4ea4\u66f4\u6539\u4e26\u63a8\u9001\u3002```\n\u00a0 echo \"\" >> env/cicd-trigger/main.tf\n```\n- \u63d0\u4ea4\u4f75\u63a8\u9001\u66f4\u6539\uff1a```\ngit add .git commit -m \"A dummy commit to invoke the infrastrucutre trigger\"git pushcd ..\n```\u63a8\u9001\u66f4\u6539\u5f8c\uff0cCloud Deploy \u89f8\u767c\u5668 `deploy-infra-sample` \u6703\u5553\u52d5\u3002\n- \u76e3\u63a7\u89f8\u767c\u5668\u7684\u72c0\u614b\uff1a [\u8f49\u5230 Cloud Build \u6b77\u53f2\u8a18\u9304\u9801\u9762](https://console.cloud.google.com/cloud-build/builds?hl=zh-cn) \u67e5\u770b\u6d41\u6c34\u7dda\u4e26\u7b49\u5f85\u5176\u5b8c\u6210\u3002\n### \u67e5\u770b\u61c9\u7528 CICD \u8cc7\u6e90\u67e5\u770b\u7232\u61c9\u7528\u5275\u5efa\u7684\u5404\u7a2e CI/CD \u8cc7\u6e90\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff1a [\u8f49\u5230 Cloud Build \u9801\u9762](https://console.cloud.google.com/cloud-build/triggers?hl=zh-cn) \uff0c\u4e26\u67e5\u770b `deploy-app-sample` \u89f8\u767c\u5668\u3002\u9019\u662f CI \u6d41\u6c34\u7dda\u89f8\u767c\u5668\u3002\u8a72\u89f8\u767c\u5668\u5df2\u9023\u63a5\u5230\u61c9\u7528\u4ee3\u78bc\u5eab `sample` \u3002\u63a8\u9001\u5230\u61c9\u7528\u4ee3\u78bc\u5eab\u6642\uff0c\u7cfb\u7d71\u6703\u8abf\u7528\u89f8\u767c\u5668\uff0c\u4e26\u6309\u7167\u89f8\u767c\u5668\u914d\u7f6e\u4e2d\u7684\u5b9a\u7fa9\u57f7\u884c\u69cb\u5efa\u6b65\u9a5f\u3002\u5982\u9700\u67e5\u770b\u89f8\u767c\u5668\u8abf\u7528\u6642\u57f7\u884c\u7684\u6b65\u9a5f\uff0c\u8acb\u9ede\u64ca\u89f8\u767c\u5668\u540d\u7a31\uff0c\u7136\u5f8c\u9ede\u64ca **\u6253\u958b\u7de8\u8f2f\u5668** \u6309\u9215\u3002\n- [\u8f49\u5230 Artifact Registry \u9801\u9762](https://console.cloud.google.com/artifacts?hl=zh-cn) \uff0c\u67e5\u770b\u540d\u7232 `sample` \u7684\u65b0\u4ee3\u78bc\u5eab\u3002\u6b64\u5de5\u4ef6\u4ee3\u78bc\u5eab\u5b58\u5132\u61c9\u7528\u7684\u5de5\u4ef6\u3002\n- [\u8f49\u5230 Cloud Deploy \u6d41\u6c34\u7dda\u9801\u9762](https://console.cloud.google.com/deploy/delivery-pipelines?hl=zh-cn) \uff0c\u67e5\u770b\u540d\u7232 `sample` \u7684\u6d41\u6c34\u7dda\u3002 \u9019\u662f\u5728 GKE \u96c6\u7fa3\u4e0a\u90e8\u7f72\u61c9\u7528\u7684\u6301\u7e8c\u90e8\u7f72\u6d41\u6c34\u7dda\u3002\n## \u5728\u958b\u767c\u74b0\u5883\u4e2d\u90e8\u7f72\u61c9\u7528\u89f8\u767c\u5668 `deploy-app-sample` \u9023\u63a5\u5230\u540d\u7232 `sample` \u7684\u61c9\u7528\u4ee3\u78bc\u5eab\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 webhook \u7db2\u5740\u624b\u52d5\u8abf\u7528\u89f8\u767c\u5668\uff0c\u4e5f\u53ef\u4ee5\u901a\u904e\u63a8\u9001\u81f3\u61c9\u7528\u4ee3\u78bc\u5eab\u4f86\u8abf\u7528\u3002- \u5728\u4ee3\u78bc\u5eab `sample` \u7684\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u500b\u65b0\u884c\uff0c\u7136\u5f8c\u63a8\u9001\u66f4\u6539\u4ee5\u8abf\u7528 Cloud Build \u89f8\u767c\u5668\uff1a- \u514b\u9686 Git \u4ee3\u78bc\u5eab `sample` \uff1a\u5728 Cloud Shell \u4e2d\uff1a```\ngit clone https://github.com/GITHUB_ORG/samplecd sample\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u7684 GitHub \u8a9e\u6cd5\u3002\n- \u5411 `skaffold.yaml` \u6587\u4ef6\u4e2d\u6dfb\u52a0\u65b0\u884c\u3002```\n\u00a0 echo \"\" >> skaffold.yaml\n```\n- \u63d0\u4ea4\u4f75\u63a8\u9001\u66f4\u6539\uff1a```\ngit add .git commit -m \"A dummy commit to invoke CI/CD trigger\"git push\n```\n- \u63a8\u9001\u66f4\u6539\u5f8c\uff0cCloud Deploy \u89f8\u767c\u5668 `deploy-app-sample` \u6703\u5553\u52d5\u3002\n- \u76e3\u63a7\u89f8\u767c\u5668\u7684\u72c0\u614b\uff1a [\u8f49\u5230 Cloud Build \u6b77\u53f2\u8a18\u9304\u9801\u9762](https://console.cloud.google.com/cloud-build/builds?hl=zh-cn) \u67e5\u770b\u6d41\u6c34\u7dda\u4e26\u7b49\u5f85\u5176\u5b8c\u6210\u3002\u89f8\u767c\u5668\u6703\u57f7\u884c\u5176\u914d\u7f6e\u4e2d\u5b9a\u7fa9\u7684\u6b65\u9a5f\u3002\u7b2c\u4e00\u6b65\u662f\u5f9e\u4ee3\u78bc\u5eab `sample` \u4e2d\u7684\u61c9\u7528\u4ee3\u78bc\u69cb\u5efa Docker \u6620\u50cf\u3002\u6700\u5f8c\u4e00\u6b65\u662f\u5553\u52d5\u5c07\u61c9\u7528\u90e8\u7f72\u5230\u958b\u767c GKE \u96c6\u7fa3\u7684 Cloud Deploy \u6d41\u6c34\u7dda\u3002\n- \u6aa2\u67e5\u958b\u767c\u96c6\u7fa3\u4e2d\u7684\u90e8\u7f72\uff1a [\u8f49\u5230 Cloud Deploy \u6d41\u6c34\u7dda\u9801\u9762](https://console.cloud.google.com/deploy/delivery-pipelines?hl=zh-cn) \u3002\u9ede\u64ca `sample` \u6d41\u6c34\u7dda\uff0c\u5df2\u958b\u59cb\u90e8\u7f72\u5230\u958b\u767c GKE \u96c6\u7fa3\u3002\u7b49\u5f85\u6b64\u904e\u7a0b\u5b8c\u6210\u3002\n **\u9a57\u8b49\u61c9\u7528\u5df2\u6210\u529f\u90e8\u7f72** \uff1a- \u7372\u53d6\u958b\u767c\u96c6\u7fa3\u7684\u6191\u64da\u3002```\ngcloud container clusters get-credentials gke-dev-us-central1 --zone us-central1-a\n```\n- \u901a\u904e\u96a7\u9053\u9023\u63a5\u5230 GKE \u96c6\u7fa3\u3002```\ngcloud container clusters get-credentials gke-dev-us-central1 --zone us-central1-a && kubectl port-forward --namespace sample $(kubectl get pod --namespace sample --selector=\"deploy.cloud.google.com/delivery-pipeline-id=sample\" --output jsonpath='{.items[0].metadata.name}') 8080:8080\n```\n- \u5728 Cloud Shell \u5de5\u5177\u6b04\u4e2d\uff0c\u9ede\u64capreview **\u7db2\u9801\u9810\u89bd** \uff0c\u7136\u5f8c\u9ede\u64ca **\u5728\u7aef\u53e3 8080 \u4e0a\u9810\u89bd** \uff1a \u8f38\u51fa\u5982\u4e0b\u6240\u793a\uff1a```\nHello World!\n```\n- \u5728 Cloud Shell \u4e2d\uff0c\u6309 `CTRL+C` \u7d50\u675f\u7aef\u53e3\u8f49\u767c\u3002\n## \u56ae\u61c9\u7528\u6dfb\u52a0\u65b0\u529f\u80fd\u958b\u767c\u65b0\u529f\u80fd\u6642\uff0c\u60a8\u9700\u8981\u5c07\u66f4\u6539\u5feb\u901f\u90e8\u7f72\u5230\u958b\u767c\u74b0\u5883\u4e2d\uff0c\u4ee5\u5c0d\u66f4\u6539\u9032\u884c\u6e2c\u8a66\u548c\u8fed\u4ee3\u3002\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u5728\u61c9\u7528\u4ee3\u78bc\u5eab\u4e2d\u9032\u884c\u66f4\u6539\uff0c\u4e26\u5c07\u5176\u90e8\u7f72\u5230\u958b\u767c\u74b0\u5883\u3002- \u5728 Cloud Shell \u4e2d\uff0c\u5c07\u76ee\u9304\u66f4\u6539\u7232\u5df2\u514b\u9686\u7684 `sample` \u4ee3\u78bc\u5eab\uff1a\n- \u66f4\u65b0\u61c9\u7528\u4ee5\u8f38\u51fa\u5176\u4ed6\u6d88\u606f\uff1a```\n\u00a0 sed -i \"s/Hello World/My new feature/g\" main.py\n```\n- \u63d0\u4ea4\u4f75\u63a8\u9001\u66f4\u6539\uff1a```\ngit add .git commit -m \"Changed the message\"git push\n```\u4ee3\u78bc\u63a8\u9001\u5230 GitHub \u4ee3\u78bc\u5eab\u5f8c\uff0cwebhook \u89f8\u767c\u5668 `deploy-app-sample` \u4fbf\u6703\u5553\u52d5\u3002\n- \u5728 [Cloud Build \u6b77\u53f2\u8a18\u9304\u9801\u9762](https://console.cloud.google.com/cloud-build/builds?hl=zh-cn) \u4e0a\u76e3\u63a7\u89f8\u767c\u5668\u7684\u72c0\u614b\uff0c\u4e26\u7b49\u5f85\u89f8\u767c\u5668\u904b\u884c\u5b8c\u6210\u3002\n- [\u8f49\u5230 Cloud Deploy \u6d41\u6c34\u7dda\u9801\u9762](https://console.cloud.google.com/deploy/delivery-pipelines?hl=zh-cn) \u9ede\u64ca `sample` \u6d41\u6c34\u7dda\uff0c\u5df2\u958b\u59cb\u90e8\u7f72\u5230\u958b\u767c GKE \u96c6\u7fa3\u3002\u7b49\u5f85\u6b64\u904e\u7a0b\u5b8c\u6210\u3002\n **\u9a57\u8b49\u61c9\u7528\u5df2\u6210\u529f\u90e8\u7f72** \uff1a- \u5982\u679c\u60a8\u6253\u958b\u4e86\u65b0\u7684 Cloud Shell\uff0c\u8acb\u7372\u53d6\u958b\u767c\u96c6\u7fa3\u7684\u6191\u64da\uff1a```\ngcloud container clusters get-credentials gke-dev-us-central1 --zone us-central1-a\n```\n- \u901a\u904e\u96a7\u9053\u9023\u63a5\u5230 GKE \u96c6\u7fa3\uff1a```\ngcloud container clusters get-credentials gke-dev-us-central1 --zone us-central1-a && kubectl port-forward --namespace sample $(kubectl get pod --namespace sample --selector=\"deploy.cloud.google.com/delivery-pipeline-id=sample\" --output jsonpath='{.items[0].metadata.name}') 8080:8080\n```\n- \u5728 Cloud Shell \u5de5\u5177\u6b04\u4e2d\uff0c\u9ede\u64capreview **\u7db2\u9801\u9810\u89bd** \uff0c\u7136\u5f8c\u9ede\u64ca **\u5728\u7aef\u53e3 8080 \u4e0a\u9810\u89bd** \uff1a \u8f38\u51fa\u5982\u4e0b\u6240\u793a\uff1a```\nMy new feature!\n```\n- \u5728 Cloud Shell \u4e2d\uff0c\u6309 `CTRL+C` \u7d50\u675f\u7aef\u53e3\u8f49\u767c\u3002\n## \u5c07\u60a8\u7684\u66f4\u6539\u5347\u7d1a\u5230\u9810\u6f14\u96c6\u7fa3\u548c\u751f\u7522\u96c6\u7fa3\u5728\u5c07\u61c9\u7528\u63d0\u5347\u5230\u9810\u6f14\u74b0\u5883\u548c\u751f\u7522\u74b0\u5883\u4e4b\u524d\uff0c\u60a8\u9700\u8981\u5728 GKE \u96c6\u7fa3\u4e2d\u7232\u9019\u4e9b\u74b0\u5883\u5275\u5efa\u61c9\u7528\u7740\u9678\u5340\u3002\u7576\u60a8\u521d\u59cb\u914d\u7f6e\u61c9\u7528\u6642\uff0c\u901a\u904e\u5c07\u4ee3\u78bc\u6dfb\u52a0\u5230\u958b\u767c\u5206\u652f\u4e2d\u7684 `acm-gke-infrastructure-repo` \uff0c\u958b\u767c GKE \u96c6\u7fa3\u6703\u81ea\u52d5\u5275\u5efa\u958b\u767c\u7740\u9678\u5340\u3002\n### \u5728\u9810\u6f14\u548c\u751f\u7522 GKE \u96c6\u7fa3\u4e2d\u5275\u5efa\u7740\u9678\u5340\n- \u5728\u9810\u6f14 GKE \u96c6\u7fa3\u4e2d\u5275\u5efa\u7740\u9678\u5340\uff1a\u60a8\u9700\u8981\u5728 `acm-gke-infrastructure-repo` \u4e2d\u5275\u5efa\u5f9e\u958b\u767c\u5230\u66ab\u5b58\u5206\u652f\u7684 [\u62c9\u53d6\u8acb\u6c42](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests) \u4e26\u5c07\u5176\u5408\u4f75\u3002- \u8f49\u5230 GitHub \u4e26\u904d\u6b77\u4ee3\u78bc\u5eab `acm-gke-infrastructure-repo` \u3002\u9ede\u64ca `Pull requests` \uff0c\u7136\u5f8c\u9ede\u64ca `New pull request` \u6309\u9215\u3002\u5728 **\u57fa\u672c** \u83dc\u55ae\u4e2d\uff0c\u9078\u64c7 **\u66ab\u5b58** \uff0c\u7136\u5f8c\u5728 **\u6bd4\u8f03** \u83dc\u55ae\u4e2d\uff0c\u9078\u64c7 **\u958b\u767c** \u3002\u9ede\u64ca `Create pull request` \u6309\u9215\u3002\n- \u901a\u5e38\uff0c\u6709\u6b0a\u8a2a\u554f\u4ee3\u78bc\u5eab\u7684\u4eba\u54e1\u6703\u5be9\u8988\u66f4\u6539\uff0c\u7136\u5f8c\u5408\u4f75 PR\uff0c\u4ee5\u78ba\u4fdd\u50c5\u5c07\u9810\u671f\u66f4\u6539\u63d0\u5347\u5230\u9810\u6f14\u74b0\u5883\u4e2d\u3002\u7232\u4e86\u8b93\u500b\u4eba\u8a66\u7528\u53c3\u8003\u67b6\u69cb\uff0c\u5206\u652f\u4fdd\u8b77\u898f\u5247\u5df2\u653e\u5bec\uff0c\u4ee5\u4fbf\u4ee3\u78bc\u5eab\u7ba1\u7406\u54e1\u53ef\u4ee5\u7e5e\u904e\u5be9\u8988\u4f75\u5408\u4e26 PR\u3002\u5982\u679c\u60a8\u662f\u4ee3\u78bc\u5eab\u7684\u7ba1\u7406\u54e1\uff0c\u8acb\u5408\u4f75\u62c9\u53d6\u8acb\u6c42\u3002\u5426\u5247\uff0c\u8acb\u8b93\u7ba1\u7406\u54e1\u9032\u884c\u5408\u4f75\u3002\nConfig Sync \u5c07\u5230\u9054\u4ee3\u78bc\u5eab `acm-gke-infrastructure-repo` \u7684\u66ab\u5b58\u5206\u652f\u7684\u66f4\u6539\u540c\u6b65\u5230\u9810\u6f14 GKE \u96c6\u7fa3\uff0c\u8a72\u96c6\u7fa3\u6703\u5c0e\u81f4\u5728\u9810\u6f14 GKE \u96c6\u7fa3\u4e0a\u5275\u5efa\u61c9\u7528\u7684\u7740\u9678\u5340\u3002\n- \u5728\u751f\u7522 GKE \u96c6\u7fa3\u4e2d\u5275\u5efa\u7740\u9678\u5340\uff1a\u60a8\u9700\u8981\u5275\u5efa\u4e00\u500b\u5f9e\u9810\u6f14\u5230\u751f\u7522\u5206\u652f\u7684\u62c9\u53d6\u8acb\u6c42\u4e26\u5c07\u5176\u5408\u4f75\u3002- \u9ede\u64ca `Pull requests` \uff0c\u7136\u5f8c\u9ede\u64ca `New pull request` \u6309\u9215\u3002\u5728 **\u57fa\u672c** \u83dc\u55ae\u4e2d\uff0c\u9078\u64c7 **\u751f\u7522** \uff0c\u5728 **\u6bd4\u8f03** \u83dc\u55ae\u4e2d\uff0c\u9078\u64c7 **\u9810\u6f14** \u3002\u9ede\u64ca `Create pull request` \u6309\u9215\u3002\n- \u5982\u679c\u60a8\u662f\u4ee3\u78bc\u5eab\u7684\u7ba1\u7406\u54e1\uff0c\u8acb\u5408\u4f75\u62c9\u53d6\u8acb\u6c42\u3002\u5426\u5247\uff0c\u8acb\u8b93\u7ba1\u7406\u54e1\u9032\u884c\u5408\u4f75\u3002\nConfig Sync \u5c07\u5230\u9054\u4ee3\u78bc\u5eab `acm-gke-infrastructure-repo` \u7684\u751f\u7522\u5206\u652f\u7684\u66f4\u6539\u540c\u6b65\u5230\u751f\u7522 GKE \u96c6\u7fa3\uff0c\u4ee5\u4f7f\u751f\u7522 GKE \u96c6\u7fa3\u4e0a\u61c9\u7528\u7684\u7740\u9678\u5340\u5275\u5efa\u3002\n### \u5c07\u66f4\u6539\u5f9e\u958b\u767c\u5347\u7d1a\u5230\u9810\u6f14\u73fe\u5728\uff0c\u60a8\u5df2\u5728\u9810\u6f14\u96c6\u7fa3\u548c\u751f\u7522 GKE \u96c6\u7fa3\u4e2d\u7232\u61c9\u7528\u5275\u5efa\u4e86\u7740\u9678\u5340\uff0c\u63a5\u4e0b\u4f86\u53ef\u4ee5\u5c07\u61c9\u7528\u5f9e\u958b\u767c\u74b0\u5883\u63d0\u5347\u5230\u9810\u6f14\u74b0\u5883\u3002- \u67e5\u627e\u6700\u65b0\u7248\u672c\u540d\u7a31\u4e26\u5c07\u5176\u4fdd\u5b58\u7232\u74b0\u5883\u8b8a\u91cf\uff1a```\n\u00a0 export RELEASE=$(gcloud deploy targets describe dev --region=us-central1 --format=\"json\" | jq -r '.\"Active Pipeline\"[0].\"projects/PROJECT_ID/locations/us-central1/deliveryPipelines/sample\".\"Latest release\"' | awk -F '/' '{print $NF}')\u00a0\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\u9a57\u8b49\u662f\u5426\u5df2\u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\uff1a```\n\u00a0 echo $RELEASE\u00a0 \n```\n- \u5728 Cloud Shell \u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u89f8\u767c\u5c07\u7248\u672c\u5f9e\u958b\u767c\u74b0\u5883\u63d0\u5347\u5230\u9810\u6f14\u74b0\u5883\u7684\u6b65\u9a5f\uff1a```\n\u00a0gcloud deploy releases promote --release=$RELEASE --delivery-pipeline=sample \u00a0--region=us-central1 --to-target=staging --quiet\u00a0\n```\n- \u6aa2\u67e5\u9810\u6f14\u90e8\u7f72\uff1a [\u8f49\u5230 Cloud Deploy \u6d41\u6c34\u7dda\u9801\u9762](https://console.cloud.google.com/deploy/delivery-pipelines?hl=zh-cn) \u9ede\u64ca `sample` \u6d41\u6c34\u7dda\uff0c\u5df2\u5553\u52d5\u5230\u9810\u6f14 GKE \u96c6\u7fa3\u7684\u90e8\u7f72\u3002\u7b49\u5f85\u6b64\u904e\u7a0b\u5b8c\u6210\u3002\n- \u9a57\u8b49\u9810\u6f14\u90e8\u7f72\u662f\u5426\u5df2\u6210\u529f\u57f7\u884c\uff1a- \u7372\u53d6\u9810\u6f14\u96c6\u7fa3\u7684\u6191\u64da\uff1a```\ngcloud container clusters get-credentials gke-staging-us-central1 --zone us-central1-a\n```\n- \u901a\u904e\u96a7\u9053\u9023\u63a5\u5230 GKE \u96c6\u7fa3\uff1a```\ngcloud container clusters get-credentials gke-staging-us-central1 --zone us-central1-a && kubectl port-forward --namespace sample $(kubectl get pod --namespace sample --selector=\"deploy.cloud.google.com/delivery-pipeline-id=sample\" --output jsonpath='{.items[0].metadata.name}') 8080:8080\n```\n- \u5728 Cloud Shell \u5de5\u5177\u6b04\u4e2d\uff0c\u9ede\u64capreview **\u7db2\u9801\u9810\u89bd** \uff0c\u7136\u5f8c\u9ede\u64ca **\u5728\u7aef\u53e3 8080 \u4e0a\u9810\u89bd** \uff1a \u8f38\u51fa\u5982\u4e0b\u6240\u793a\uff1a```\nMy new feature!\n```\n- \u5728 Cloud Shell \u4e2d\uff0c\u6309 `CTRL+C` \u7d50\u675f\u7aef\u53e3\u8f49\u767c\u3002\n### \u5c07\u66f4\u6539\u5f9e\u9810\u6f14\u74b0\u5883\u63d0\u5347\u5230\u751f\u7522\u74b0\u5883\u73fe\u5728\uff0c\u5c07\u7248\u672c\u5f9e\u9810\u6f14\u74b0\u5883\u63d0\u5347\u5230\u751f\u7522\u74b0\u5883\u3002\u60a8\u6709\u5169\u500b\u751f\u7522\u96c6\u7fa3\uff0c\u4e26\u4e14 Cloud Deploy \u5206\u5225\u7232\u6bcf\u500b\u96c6\u7fa3\u5275\u5efa\u4e00\u500b\u540d\u7232 prod1 \u548c prod2 \u7684\u76ee\u6a19\u3002- \u5728 Cloud Shell \u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u89f8\u767c\u5c07\u7248\u672c\u5f9e\u9810\u6f14\u74b0\u5883\u63d0\u5347\u5230 prod1 \u96c6\u7fa3\uff1a```\n\u00a0gcloud deploy releases promote --release=$RELEASE --delivery-pipeline=sample \u00a0--region=us-central1 --to-target=prod1 --quiet\u00a0\n```\n- \u767c\u4f48\u5230\u751f\u7522\u96c6\u7fa3\u9700\u8981\u6279\u51c6\uff0c\u56e0\u6b64\u767c\u4f48\u6703\u7b49\u5230\u60a8\u6279\u51c6\u7232\u6b62\u3002\u5982\u9700\u67e5\u770b\u5b83\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a [\u8f49\u5230 Cloud Deploy \u6d41\u6c34\u7dda\u9801\u9762](https://console.cloud.google.com/deploy/delivery-pipelines?hl=zh-cn) \u9ede\u64ca `sample` \u6d41\u6c34\u7dda\u3002\u767c\u4f48\u5230 prod1 \u9700\u8981\u6279\u51c6\uff0c\u4e26\u4e14\u9700\u8981 clouddeploy.Approver \u89d2\u8272\u624d\u80fd\u6279\u51c6\u767c\u4f48\u3002\u7531\u65bc\u60a8\u662f\u9805\u76ee\u7684\u6240\u6709\u8005\uff0c\u56e0\u6b64\u6709\u6b0a\u6279\u51c6\u7248\u672c\u3002\n- \u5c07\u7248\u672c\u6279\u51c6\u5230 prod1\uff1a\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u7372\u53d6\u5f85\u6279\u51c6\u7684\u767c\u4f48\u540d\u7a31\uff0c\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u74b0\u5883\u8b8a\u91cf\u4e2d\uff1a```\n\u00a0export ROLLOUT=$(gcloud deploy targets describe prod1 --region=us-central1 --format=\"json\" | jq -r '.\"Pending Approvals\"[]' | awk -F '/' '{print $NF}')\u00a0\n```\u6279\u51c6\u7248\u672c\uff1a```\n\u00a0gcloud deploy rollouts approve $ROLLOUT --delivery-pipeline=sample --region=us-central1 --release=$RELEASE --quiet\u00a0\n```\n- \u6279\u51c6\u5f8c\uff0cprod1 \u7248\u672c\u5c07\u5553\u52d5\u3002\u5728 [Cloud Deploy \u6d41\u6c34\u7dda\u9801\u9762](https://console.cloud.google.com/deploy/delivery-pipelines?hl=zh-cn) \u4e0a\u76e3\u63a7\u9032\u5ea6\u3002\n- prod1 \u90e8\u7f72\u5b8c\u6210\u5f8c\uff0c\u5553\u52d5 prod2 \u7248\u672c\u3002```\n\u00a0gcloud deploy releases promote --release=$RELEASE --delivery-pipeline=sample \u00a0--region=us-central1 --to-target=prod2 --quiet\u00a0\n```\n- \u767c\u4f48\u5230 prod2 \u4e5f\u9700\u8981\u6279\u51c6\u3002\u6279\u51c6\u767c\u4f48\u5230 prod2 \u96c6\u7fa3\uff1a\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u7372\u53d6\u5f85\u6279\u51c6\u7684\u767c\u4f48\u540d\u7a31\uff0c\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u74b0\u5883\u8b8a\u91cf\u4e2d\uff1a```\n\u00a0export ROLLOUT=$(gcloud deploy targets describe prod2 --region=us-central1 --format=\"json\" | jq -r '.\"Pending Approvals\"[]' | awk -F '/' '{print $NF}')\u00a0\n```\u6279\u51c6\u7248\u672c\uff1a```\n\u00a0gcloud deploy rollouts approve $ROLLOUT --delivery-pipeline=sample --region=us-central1 --release=$RELEASE --quiet\u00a0\n``` **\u6ce8\u610f\uff1a** \u85c9\u52a9 Cloud Deploy\uff0c\u60a8\u53ef\u4ee5\u5728\u591a\u500b GKE \u96c6\u7fa3\u4e2d\u57f7\u884c\u4e26\u884c\u90e8\u7f72\uff0c\u4ee5\u4fbf\u540c\u6642\u90e8\u7f72\u5230\u591a\u500b\u751f\u7522\u96c6\u7fa3\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u8207 Cloud Deploy \u4e26\u884c\u90e8\u7f72](https://cloud.google.com/deploy/docs/parallel?hl=zh-cn) \u3002\n- \u6279\u51c6\u5f8c\uff0cprod2 \u7248\u672c\u5c31\u6703\u5553\u52d5\u3002\u5728 [Cloud Deploy \u6d41\u6c34\u7dda\u9801\u9762](https://console.cloud.google.com/deploy/delivery-pipelines?hl=zh-cn) \u4e0a\u76e3\u63a7\u9032\u5ea6\u3002\n- \u5728 prod1 \u548c prod2 \u4e2d\u7684 Cloud Deploy \u6d41\u6c34\u7dda\u5b8c\u6210\u5f8c\uff0c\u9a57\u8b49\u751f\u7522\u96c6\u7fa3\u4e2d\u7684\u90e8\u7f72\u662f\u5426\u6210\u529f\u3002- \u751f\u7522\u96c6\u7fa3\u4e2d\u5275\u5efa\u4e86 [\u591a\u96c6\u7fa3 Ingress](https://cloud.google.com/kubernetes-engine/docs/concepts/multi-cluster-ingress?hl=zh-cn) \uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8ca0\u8f09\u5747\u8861\u5668\u8a2a\u554f\u751f\u7522\u61c9\u7528\u3002\u6b64\u591a\u96c6\u7fa3 Ingress \u914d\u7f6e\u662f\u4f7f\u7528\u4ee3\u78bc\u5eab `sample` \u4e2d\u7684 YAML \u6587\u4ef6 k8s/prod/mci.yaml \u548c k8s/prod/mcs.yaml \u5275\u5efa\u7684\u3002\u7576\u60a8\u5c07\u8acb\u6c42\u767c\u9001\u5230\u8ca0\u8f09\u5747\u8861\u5668\u7684 IP \u5730\u5740\u6642\uff0c\u591a\u96c6\u7fa3 Ingress \u6703\u5c07\u8acb\u6c42\u8f49\u767c\u5230\u5728\u5169\u500b\u4e0d\u540c GKE \u96c6\u7fa3\u4e2d\u904b\u884c\u7684\u61c9\u7528\u7684\u5169\u500b\u5be6\u4f8b\u4e4b\u4e00\u3002\n- \u5217\u51fa\u8207\u8ca0\u8f09\u5747\u8861\u5668\u95dc\u806f\u7684\u8f49\u767c\u898f\u5247\u4ee5\u67e5\u627e IP \u5730\u5740\u3002```\ngcloud compute forwarding-rules list\n```\n- \u8f38\u51fa\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME: mci-qqxs9x-fw-sample-sample-ingress\nREGION:\nIP_ADDRESS: 34.36.123.118\nIP_PROTOCOL: TCP\nTARGET: mci-qqxs9x-sample-sample-ingress\n```\n- \u6253\u958b\u7db2\u7d61\u700f\u89bd\u5668\u4e26\u5728\u8a72\u7db2\u5740\u4e2d\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nhttp://IP_ADDRESS:80\n```\u5c07 `` \u66ff\u63db\u7232\u8ca0\u8f09\u5747\u8861\u5668\u7684 IP \u5730\u5740\u3002\u8f38\u51fa\u5982\u4e0b\u6240\u793a\uff1a```\nMy new feature!\n```\u9019\u6703\u78ba\u8a8d\u61c9\u7528\u6309\u9810\u671f\u5728\u751f\u7522\u96c6\u7fa3\u4e2d\u9032\u884c\u90e8\u7f72\u3002\n### \u6e2c\u8a66\u61c9\u7528\u7684\u5f48\u6027\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u901a\u904e\u91cd\u5553\u5169\u500b\u751f\u7522 GKE \u96c6\u7fa3\u7684\u7bc0\u9ede\u4e4b\u4e00\u4f86\u6e2c\u8a66\u5728\u751f\u7522\u74b0\u5883\u4e2d\u904b\u884c\u7684\u61c9\u7528\u7684\u5f48\u6027\uff0c\u800c\u4e0d\u6703\u5f71\u97ff\u61c9\u7528\u3002\n\u751f\u7522\u74b0\u5883\u4e2d\u7684\u61c9\u7528\u4f7f\u7528\u591a\u96c6\u7fa3 Ingress\uff0c\u4e26\u4e14\u53ef\u901a\u904e\u8ca0\u8f09\u5747\u8861\u5668 IP \u5730\u5740\u8a2a\u554f\u3002\u7576\u901a\u904e\u8a72 IP \u8a2a\u554f\u61c9\u7528\u6642\uff0c\u591a\u96c6\u7fa3 Ingress \u6703\u5c07\u5176\u8def\u7531\u5230\u5728\u5169\u500b\u4e0d\u540c\u7684 GKE \u96c6\u7fa3\u4e0a\u904b\u884c\u7684\u61c9\u7528\u7684\u5169\u500b\u5be6\u4f8b\u4e4b\u4e00\u3002\u7576\u5176\u4e2d\u4e00\u500b GKE \u96c6\u7fa3\u904b\u884c\u72c0\u6cc1\u4e0d\u4f73\u4e14\u7121\u6cd5\u8a2a\u554f\u5728\u8a72\u96c6\u7fa3\u4e2d\u904b\u884c\u7684\u61c9\u7528\u5be6\u4f8b\u6642\uff0c\u591a\u96c6\u7fa3 Ingress \u6703\u7e7c\u7e8c\u5c07\u6d41\u91cf\u767c\u9001\u5230\u5728\u53e6\u4e00\u500b GKE \u96c6\u7fa3\u4e0a\u904b\u884c\u7684\u61c9\u7528\u7684\u904b\u884c\u72c0\u6cc1\u826f\u597d\u7684\u5be6\u4f8b\u3002\u9019\u4f7f\u6700\u7d42\u7528\u6236\u770b\u4e0d\u5230\u96c6\u7fa3\u4e2d\u65b7\uff0c\u4e26\u4e14\u61c9\u7528\u6703\u6301\u7e8c\u8655\u7406\u8acb\u6c42\u3002\n\u5982\u9700\u6e2c\u8a66\u5f48\u6027\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u627e\u5230\u5728 us-west1 \u4e2d\u904b\u884c\u7684\u751f\u7522 GKE \u96c6\u7fa3\u7684\u7bc0\u9ede\u6c60\u3002```\n\u00a0gcloud container clusters describe gke-prod-us-west1 --zone=us-west1-a --format=json | jq \".nodePools[0].instanceGroupUrls[]\" | tr '\"' ' ' | \u00a0awk -F '/' '{for(i=NF-2; i<=NF; i=i+2) printf (\"%s \",$i); print \u00a0\"\"}'\n```\n- \u8f38\u51fa\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nus-west1-b gke-gke-prod-us-west1-node-pool-01-6ad4e1ed-grp\nus-west1-c gke-gke-prod-us-west1-node-pool-01-98407373-grp\n```\u8f38\u51fa\u6709\u5169\u5217\uff0c\u7b2c\u4e00\u5217\u662f\u53ef\u7528\u5340\uff0c\u7b2c\u4e8c\u5217\u662f\u8207 us-west1 \u5340\u57df\u4e2d\u751f\u7522 GKE \u96c6\u7fa3\u7684\u7bc0\u9ede\u6c60\u95dc\u806f\u7684\u5be6\u4f8b\u7d44\u7684\u540d\u7a31\u3002\n- \u91cd\u5553\u8207\u7bc0\u9ede\u6c60\u5c0d\u61c9\u7684\u5be6\u4f8b\u7d44\uff1a```\n\u00a0gcloud compute instance-groups managed rolling-action restart INSTANCE_GROUP_1 \u00a0--zone=ZONE_1 --max-unavailable=100%\u00a0gcloud compute instance-groups managed rolling-action restart INSTANCE_GROUP_2 \u00a0--zone=ZONE_2 --max-unavailable=100%\n```\u5c07 `` \u66ff\u63db\u7232\u7b2c\u4e00\u500b\u5be6\u4f8b\u7d44\u7684\u540d\u7a31\u3002\u5c07 `` \u66ff\u63db\u7232\u7b2c\u4e00\u500b\u5be6\u4f8b\u7d44\u7684\u53ef\u7528\u5340\u3002\u5c07 `` \u66ff\u63db\u7232\u7b2c\u4e8c\u500b\u5be6\u4f8b\u7d44\u7684\u540d\u7a31\u3002\u5c07 `` \u66ff\u63db\u7232\u7b2c\u4e8c\u500b\u5be6\u4f8b\u7d44\u7684\u53ef\u7528\u5340\u3002\n- \u6aa2\u67e5\u5be6\u4f8b\u7d44\u7684\u72c0\u614b\u3002 [\u8f49\u5230\u201c\u5be6\u4f8b\u7d44\u201d\u9801\u9762](https://console.cloud.google.com/compute/instanceGroups/list?hl=zh-cn) \u5169\u500b\u5be6\u4f8b\u7d44\u6b63\u5728\u91cd\u65b0\u5553\u52d5\uff0c\u800c\u5176\u4ed6\u5be6\u4f8b\u7d44\u5c0d\u5176\u986f\u793a\u7da0\u8272\u5c0d\u52fe\u6a19\u8a18\u3002 \n- \u6253\u958b\u7db2\u7d61\u700f\u89bd\u5668\u4e26\u5728\u8a72\u7db2\u5740\u4e2d\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nhttp://IP_ADDRESS:80\n```\u5c07 `` \u66ff\u63db\u7232\u8ca0\u8f09\u5747\u8861\u5668\u7684 IP \u5730\u5740\u3002\u5373\u4f7f\u5169\u500b GKE \u96c6\u7fa3\u4e2d\u7684\u4e00\u500b\u95dc\u9589\uff0c\u61c9\u7528\u4e5f\u53ef\u7528\uff0c\u8f38\u51fa\u5982\u4e0b\uff1a```\n My new feature!\n \n```\u9019\u8868\u660e\u60a8\u7684\u61c9\u7528\u5177\u5099\u5f48\u6027\u548c\u9ad8\u53ef\u7528\u6027\u3002\n### \u7ba1\u7406\u61c9\u7528\u5f9e\u61c9\u7528\u5de5\u5ee0\u5275\u5efa\u6b64\u61c9\u7528\u6642\uff0c\u60a8\u6703\u7372\u5f97\u8a72\u61c9\u7528\u7684\u55ae\u7368 Git \u4ee3\u78bc\u5eab\u3001\u57fa\u790e\u67b6\u69cb\u548c CI/CD \u6d41\u6c34\u7dda\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u9019\u4e9b\u8cc7\u6e90\u4f86\u90e8\u7f72\u61c9\u7528\u4e26\u6dfb\u52a0\u65b0\u529f\u80fd\u3002\u7232\u4e86\u9032\u4e00\u6b65\u7ba1\u7406\u61c9\u7528\uff0c\u60a8\u53ea\u9700\u8207\u9019\u4e9b Git \u4ee3\u78bc\u5eab\u548c\u6d41\u6c34\u7dda\u9032\u884c\u4ea4\u4e92\uff0c\u800c\u7121\u9700\u66f4\u65b0\u61c9\u7528\u5de5\u5ee0\u3002\u60a8\u53ef\u4ee5\u6839\u64da\u9700\u8981\u81ea\u5b9a\u7fa9\u61c9\u7528\u7684\u6d41\u6c34\u7dda\u548c git \u4ee3\u78bc\u5eab\u3002\u4f5c\u7232\u61c9\u7528\u6240\u6709\u8005\uff0c\u60a8\u53ef\u4ee5\u5b9a\u7fa9\u8ab0\u6709\u6b0a\u8a2a\u554f\u61c9\u7528\u7684\u6d41\u6c34\u7dda\u548c Git \u4ee3\u78bc\u5eab\u4f86\u7ba1\u7406\u8a72\u61c9\u7528\u3002## \u6e05\u7406\u7232\u907f\u514d\u56e0\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u8cc7\u6e90\u5c0e\u81f4\u60a8\u7684 Google Cloud \u8cec\u865f\u7522\u751f\u8cbb\u7528\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u3002\n### \u522a\u9664\u9805\u76ee- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- **\u8b66\u544a** \uff1a\u522a\u9664\u9805\u76ee\u6703\u7522\u751f\u4ee5\u4e0b\u5f71\u97ff- **\u9805\u76ee\u4e2d\u7684\u6240\u6709\u5167\u5bb9\u90fd\u6703\u88ab\u522a\u9664\u3002** \u5982\u679c\u60a8\u5c07\u73fe\u6709\u9805\u76ee\u7528\u65bc\u672c\u6587\u6a94\u4e2d\u7684\u4efb\u52d9\uff0c\u5247\u522a\u9664\u8a72\u9805\u76ee\u5f8c\uff0c\u9084\u5c07\u522a\u9664\u60a8\u5df2\u5728\u8a72\u9805\u76ee\u4e2d\u5b8c\u6210\u7684\u4efb\u4f55\u5176\u4ed6\u5de5\u4f5c\u3002\n- **\u81ea\u5b9a\u7fa9\u9805\u76ee ID \u4e1f\u5931\u3002** \u5275\u5efa\u6b64\u9805\u76ee\u6642\uff0c\u60a8\u53ef\u80fd\u5275\u5efa\u4e86\u8981\u5728\u5c07\u4f86\u4f7f\u7528\u7684\u81ea\u5b9a\u7fa9\u9805\u76ee ID\u3002\u8981\u4fdd\u7559\u4f7f\u7528\u8a72\u9805\u76ee ID \u7684\u7db2\u5740\uff08\u4f8b\u5982`appspot.com`\u7db2\u5740\uff09\uff0c\u8acb\u522a\u9664\u9805\u76ee\u5167\u7684\u6240\u9078\u8cc7\u6e90\uff0c\u800c\u4e0d\u662f\u522a\u9664\u6574\u500b\u9805\u76ee\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u9032\u5165 **\u7ba1\u7406\u8cc7\u6e90** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u7ba1\u7406\u8cc7\u6e90\u201d](https://console.cloud.google.com/iam-admin/projects?hl=zh-cn) \n- \u5728\u9805\u76ee\u5217\u8868\u4e2d\uff0c\u9078\u64c7\u8981\u522a\u9664\u7684\u9805\u76ee\uff0c\u7136\u5f8c\u9ede\u64ca **\u522a\u9664** \u3002\n- \u5728\u5c0d\u8a71\u6846\u4e2d\u8f38\u5165\u9805\u76ee ID\uff0c\u7136\u5f8c\u9ede\u64ca **\u95dc\u9589** \u4ee5\u522a\u9664\u9805\u76ee\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3 [\u8a2d\u7f6e\u8eab\u4efd\u806f\u5408\u7684\u6700\u4f73\u505a\u6cd5](https://cloud.google.com/solutions/migrating-consumer-accounts-to-cloud-identity-or-g-suite-best-practices-federation?hl=zh-cn) \u3002\n- \u95b1\u8b80 [Kubernetes \u548c\u6301\u7e8c\u8edf\u4ef6\u90e8\u7f72\u7684\u6311\u6230](https://cloud.google.com/solutions/addressing-continuous-delivery-challenges-in-a-kubernetes-world?hl=zh-cn) \u3002\n- \u77ad\u89e3 [\u6df7\u5408\u96f2\u548c\u591a\u96f2\u74b0\u5883\u7684\u76e3\u63a7\u548c\u65e5\u8a8c\u8a18\u9304\u6a21\u5f0f](https://cloud.google.com/solutions/hybrid-and-multi-cloud-monitoring-and-logging-patterns?hl=zh-cn) \u3002\n- \u63a2\u7d22\u6709\u95dc Google Cloud \u7684\u53c3\u8003\u67b6\u69cb\u3001\u5716\u8868\u548c\u6700\u4f73\u5be6\u8e10\u3002\u67e5\u770b\u6211\u5011\u7684 [Cloud Architecture Center](https://cloud.google.com/architecture?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}