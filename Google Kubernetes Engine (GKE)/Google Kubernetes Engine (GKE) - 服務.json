{"title": "Google Kubernetes Engine (GKE) - \u670d\u52d9", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u670d\u52d9\n\u672c\u9801\u9762\u4ecb\u7d39\u4e86 Kubernetes [Service](https://kubernetes.io/docs/concepts/services-networking/service/) \u53ca\u5176\u5728 Google Kubernetes Engine (GKE) \u4e2d\u7684\u7528\u6cd5\u3002Service \u5206\u7232\u591a\u7a2e\u4e0d\u540c\u985e\u578b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u5011\u5c07\u4e00\u7d44 [Pod](https://kubernetes.io/docs/concepts/workloads/pods/) \u7aef\u9ede\u5283\u5206\u7232\u55ae\u4e00\u8cc7\u6e90\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5275\u5efa Service\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 Service \u516c\u958b\u61c9\u7528](https://cloud.google.com/kubernetes-engine/docs/how-to/exposing-apps?hl=zh-cn) \u3002\n", "content": "## \u4ec0\u9ebc\u662f Kubernetes Service\uff1f\nService \u7684\u7406\u5ff5\u662f\u5c07\u4e00\u7d44 Pod \u7aef\u9ede\u5283\u5206\u7232\u55ae\u4e00\u8cc7\u6e90\u3002\u60a8\u53ef\u4ee5\u914d\u7f6e\u5404\u7a2e\u65b9\u5f0f\u4f86\u8a2a\u554f\u8a72\u5206\u7d44\u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u60a8\u6703\u7372\u5f97\u7a69\u5b9a\u7684\u96c6\u7fa3 IP \u5730\u5740\uff0c\u96c6\u7fa3\u5167\u90e8\u7684\u5ba2\u6236\u7aef\u53ef\u4ee5\u4f7f\u7528\u8a72 IP \u5730\u5740\u8207 Service \u4e2d\u7684 Pod \u901a\u4fe1\u3002\u5ba2\u6236\u7aef\u5411\u7a69\u5b9a IP \u5730\u5740\u767c\u9001\u8acb\u6c42\uff0c\u7136\u5f8c\u8acb\u6c42\u6703\u88ab\u8def\u7531\u5230 Service \u7684\u5176\u4e2d\u4e00\u500b Pod\u3002\nService \u901a\u904e\u9078\u64c7\u5668\u4f86\u8b58\u5225\u5176\u6210\u54e1 Pod\u3002\u7232\u4f7f Pod \u6210\u7232 Service \u7684\u6210\u54e1\uff0c\u8a72 Pod \u5fc5\u9808\u5177\u6709\u9078\u64c7\u5668\u4e2d\u6307\u5b9a\u7684\u6240\u6709\u6a19\u7c64\u3002 [\u6a19\u7c64](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/) \u662f\u9644\u52a0\u5230\u5c0d\u8c61\u7684\u4efb\u610f\u9375\u503c\u5c0d\u3002\n\u4e0b\u5217 Service \u6e05\u55ae\u6240\u5177\u6709\u7684\u9078\u64c7\u5668\u6307\u5b9a\u4e86\u5169\u7a2e\u6a19\u7c64\u3002 `selector` \u5b57\u6bb5\u6307\u793a\u540c\u6642\u5177\u6709 `app: metrics` \u6a19\u7c64\u548c `department:engineering` \u6a19\u7c64\u7684\u4efb\u4f55 Pod \u90fd\u662f\u8a72 Service \u7684\u6210\u54e1\u3002\n```\napiVersion: v1kind: Servicemetadata:\u00a0 name: my-servicespec:\u00a0 selector:\u00a0 \u00a0 app: metrics\u00a0 \u00a0 department: engineering\u00a0 ports:\u00a0 ...\n```\n## \u7232\u4f55\u8981\u4f7f\u7528 Kubernetes Service\uff1f\n\u5728 Kubernetes \u96c6\u7fa3\u4e2d\uff0c\u6bcf\u500b Pod \u90fd\u5177\u6709\u5167\u90e8 IP \u5730\u5740\u3002\u4f46\u662f\uff0cDeployment \u4e2d\u7684 Pod \u53ef\u4ee5\u96a8\u6642\u52a0\u5165\u548c\u9000\u51fa\uff0c\u800c\u4e14\u5b83\u5011\u7684 IP \u5730\u5740\u4e5f\u4e0d\u662f\u56fa\u5b9a\u7684\u3002\u56e0\u6b64\uff0c\u76f4\u63a5\u4f7f\u7528 Pod IP \u5730\u5740\u6beb\u7121\u610f\u7fa9\u3002\u901a\u904e Service\uff0c\u60a8\u6703\u7372\u5f97\u7a69\u5b9a\u7684 IP \u5730\u5740\uff0c\u8a72 IP \u5730\u5740\u5728 Service \u7684\u751f\u547d\u9031\u671f\u5167\u6709\u6548\uff0c\u5373\u4f7f\u6210\u54e1 Pod \u7684 IP \u5730\u5740\u767c\u751f\u8b8a\u5316\u4e5f\u4ecd\u7136\u6709\u6548\u3002\nService \u9084\u63d0\u4f9b\u8ca0\u8f09\u5e73\u8861\u3002\u5ba2\u6236\u7aef\u6703\u8abf\u7528\u55ae\u500b\u7a69\u5b9a\u7684 IP \u5730\u5740\uff0c\u800c\u4e14\u5ba2\u6236\u7aef\u8acb\u6c42\u5728 Service \u7684\u6210\u54e1 Pod \u4e4b\u9593\u4fdd\u6301\u5e73\u8861\u3002\n## Kubernetes Service \u7684\u985e\u578b\n\u63d0\u4f9b\u4e94\u7a2e\u985e\u578b\u7684 Service\uff1a\n- **ClusterIP\uff08\u9ed8\u8a8d\uff09** \uff1a\u5167\u90e8\u5ba2\u6236\u7aef\u5411\u7a69\u5b9a\u7684\u5167\u90e8 IP \u5730\u5740\u767c\u9001\u8acb\u6c42\u3002\n- **NodePort** \uff1a\u5ba2\u6236\u7aef\u5411\u4f7f\u7528 Service \u6307\u5b9a\u7684\u4e00\u500b\u6216\u591a\u500b `nodePort` \u503c\u7684\u7bc0\u9ede\u7684 IP \u5730\u5740\u767c\u9001\u8acb\u6c42\u3002\n- **LoadBalancer** \uff1a\u5ba2\u6236\u7aef\u5411\u7db2\u7d61\u8ca0\u8f09\u5e73\u8861\u5668\u7684 IP \u5730\u5740\u767c\u9001\u8acb\u6c42\u3002\n- **ExternalName** \uff1a\u5167\u90e8\u5ba2\u6236\u7aef\u4f7f\u7528 Service \u7684 DNS \u540d\u7a31\u4f5c\u7232\u5916\u90e8 DNS \u540d\u7a31\u7684\u5225\u540d\u3002\n- **Headless** \uff1a\u5982\u679c\u60a8\u9700\u8981 Pod \u5206\u7d44\uff0c\u4f46\u4e0d\u9700\u8981\u7a69\u5b9a\u7684 IP \u5730\u5740\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528 [Headless \u670d\u52d9](https://kubernetes.io/docs/concepts/services-networking/service/#headless-services) \u3002\n`NodePort` \u985e\u578b\u662f `ClusterIP` \u985e\u578b\u7684\u64f4\u5c55\u3002\u56e0\u6b64\uff0c `NodePort` \u985e\u578b\u7684 Service \u5177\u6709\u96c6\u7fa3 IP \u5730\u5740\u3002\n`LoadBalancer` \u985e\u578b\u662f `NodePort` \u985e\u578b\u7684\u64f4\u5c55\u3002\u56e0\u6b64\uff0c `LoadBalancer` \u985e\u578b\u7684 Service \u5177\u6709\u96c6\u7fa3 IP \u5730\u5740\u4ee5\u53ca\u4e00\u500b\u6216\u591a\u500b `nodePort` \u503c\u3002\n## ClusterIP \u985e\u578b\u7684 Service\n\u5275\u5efa `ClusterIP` \u985e\u578b\u7684 Service \u6642\uff0cKubernetes \u6703\u5275\u5efa\u4e00\u500b\u7a69\u5b9a\u7684 IP \u5730\u5740\uff0c\u8a72 IP \u5730\u5740\u53ef\u5f9e\u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u8a2a\u554f\u3002\n\u4ee5\u4e0b\u662f ClusterIP \u985e\u578b\u7684 Service \u7684\u6e05\u55ae\uff1a\n```\napiVersion: v1kind: Servicemetadata:\u00a0 name: my-cip-servicespec:\u00a0 selector:\u00a0 \u00a0 app: metrics\u00a0 \u00a0 department: sales\u00a0 type: ClusterIP\u00a0 ports:\u00a0 - protocol: TCP\u00a0 \u00a0 port: 80\u00a0 \u00a0 targetPort: 8080\n```\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `kubectl apply -f [MANIFEST_FILE]` [\u5275\u5efa Service](https://cloud.google.com/kubernetes-engine/docs/how-to/exposing-apps?hl=zh-cn) \u3002\u5275\u5efa\u670d\u52d9\u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 `kubectl get service` \u67e5\u770b\u7a69\u5b9a\u7684 IP \u5730\u5740\uff1a\n```\nNAME    TYPE  CLUSTER-IP  EXTERNAL-IP PORT(S)\nmy-cip-service ClusterIP 10.11.247.213 none   80/TCP\n```\n\u96c6\u7fa3\u4e2d\u7684\u5ba2\u6236\u7aef\u901a\u904e\u4f7f\u7528\u96c6\u7fa3 IP \u5730\u5740\u548c Service \u6e05\u55ae\u7684 `port` \u5b57\u6bb5\u4e2d\u6307\u5b9a\u7684 TCP \u7aef\u53e3\u4f86\u8abf\u7528 Service\u3002\u8acb\u6c42\u5c07\u8f49\u767c\u5230 `targetPort` \u5b57\u6bb5\u4e2d\u6307\u5b9a\u7684 TCP \u7aef\u53e3\u4e0a\u7684\u5176\u4e2d\u4e00\u500b\u6210\u54e1 Pod\u3002\u5c0d\u65bc\u4e0a\u8ff0\u793a\u4f8b\uff0c\u5ba2\u6236\u7aef\u5728 TCP \u7aef\u53e3 80 \u4e0a\u8abf\u7528\u5730\u5740\u7232 `10.11.247.213` \u7684 Service\u3002\u8acb\u6c42\u5c07\u8f49\u767c\u5230 TCP \u7aef\u53e3 8080 \u4e0a\u7684\u5176\u4e2d\u4e00\u500b\u6210\u54e1 Pod\u3002\u6210\u54e1 Pod \u5fc5\u9808\u6709\u4e00\u500b\u5075\u807d TCP \u7aef\u53e3 8080 \u7684\u5bb9\u5668\u3002\u5982\u679c\u6c92\u6709\u5bb9\u5668\u5075\u807d\u7aef\u53e3 8080\uff0c\u5247\u5ba2\u6236\u7aef\u5c07\u770b\u5230\u985e\u4f3c\u65bc\u201c\u9023\u63a5\u5931\u6557\u201d\u6216\u201c\u7121\u6cd5\u8a2a\u554f\u8a72\u7db2\u7ad9\u201d\u7684\u6d88\u606f\u3002\n## NodePort \u985e\u578b\u7684 Service\n\u5275\u5efa `NodePort` \u985e\u578b\u7684 Service \u6642\uff0cKubernetes \u6703\u7232\u60a8\u63d0\u4f9b `nodePort` \u503c\u3002\u7136\u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u7bc0\u9ede\u7684 IP \u5730\u5740\u53ca `nodePort` \u503c\u4f86\u8a2a\u554f Service\u3002\n\u4ee5\u4e0b\u662f `NodePort` \u985e\u578b\u7684 Service \u7684\u6e05\u55ae\uff1a\n```\napiVersion: v1kind: Servicemetadata:\u00a0 name: my-np-servicespec:\u00a0 selector:\u00a0 \u00a0 app: products\u00a0 \u00a0 department: sales\u00a0 type: NodePort\u00a0 ports:\u00a0 - protocol: TCP\u00a0 \u00a0 port: 80\u00a0 \u00a0 targetPort: 8080\n```\n\u5275\u5efa Service \u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 `kubectl get service -o yaml` \u67e5\u770b\u5176\u898f\u7bc4\u4e26\u67e5\u770b `nodePort` \u503c\u3002\n```\nspec:\n clusterIP: 10.11.254.114\n externalTrafficPolicy: Cluster\n ports:\n - nodePort: 32675\n port: 80\n protocol: TCP\n targetPort: 8080\n```\n\u5916\u90e8\u5ba2\u6236\u7aef\u4f7f\u7528\u7bc0\u9ede\u7684\u5916\u90e8 IP \u5730\u5740\u53ca `nodePort` \u6307\u5b9a\u7684 TCP \u7aef\u53e3\u4f86\u8abf\u7528 Service\u3002\u8acb\u6c42\u5c07\u8f49\u767c\u5230 `targetPort` \u5b57\u6bb5\u6307\u5b9a\u7684 TCP \u7aef\u53e3\u4e0a\u7684\u5176\u4e2d\u4e00\u500b\u6210\u54e1 Pod\u3002\n\u4f8b\u5982\uff0c\u5047\u8a2d\u5176\u4e2d\u4e00\u500b\u96c6\u7fa3\u7bc0\u9ede\u7684\u5916\u90e8 IP \u5730\u5740\u662f `203.0.113.2` \u3002\u90a3\u9ebc\uff0c\u5c0d\u65bc\u4e0a\u8ff0\u793a\u4f8b\uff0c\u5916\u90e8\u5ba2\u6236\u7aef\u5728 TCP \u7aef\u53e3 32675 \u4e0a\u8abf\u7528 `203.0.113.2` \u7684 Service\u3002\u8acb\u6c42\u5c07\u8f49\u767c\u5230 TCP \u7aef\u53e3 8080 \u4e0a\u7684\u5176\u4e2d\u4e00\u500b\u6210\u54e1 Pod\u3002\u6210\u54e1 Pod \u5fc5\u9808\u64c1\u6709\u4e00\u500b\u5075\u807d TCP \u7aef\u53e3 8080 \u7684\u5bb9\u5668\u3002\n`NodePort` Service \u985e\u578b\u662f `ClusterIP` Service \u985e\u578b\u7684\u64f4\u5c55\u3002\u56e0\u6b64\uff0c\u5167\u90e8\u5ba2\u6236\u7aef\u53ef\u901a\u904e\u4ee5\u4e0b\u5169\u7a2e\u65b9\u5f0f\u4f86\u8abf\u7528 Service\uff1a\n- \u4f7f\u7528`clusterIP`\u548c`port`\u3002\n- \u4f7f\u7528\u7bc0\u9ede\u7684 IP \u5730\u5740\u548c`nodePort`\u3002\n\u5c0d\u65bc\u67d0\u4e9b\u96c6\u7fa3\u914d\u7f6e\uff0c [\u5916\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668](https://cloud.google.com/load-balancing/docs/https?hl=zh-cn) \u4f7f\u7528 `NodePort` \u985e\u578b\u7684 Service\u3002\n[\u4f7f\u7528 Ingress \u8a2d\u7f6e\u5916\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668](https://cloud.google.com/kubernetes-engine/docs/tutorials/http-balancer?hl=zh-cn)\n\u5916\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\u662f\u4ee3\u7406\u670d\u52d9\u5668\uff0c\u8207\u672c\u4e3b\u984c\u4e2d [LoadBalancer \u985e\u578b\u7684 Service](#services_of_type_loadbalancer) \u4e0b\u4ecb\u7d39\u7684 [\u5916\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668](https://cloud.google.com/load-balancing/docs/network?hl=zh-cn) \u5b8c\u5168\u4e0d\u540c\u3002\n**\u6ce8\u610f** \uff1a\u60a8\u53ef\u4ee5\u81ea\u884c\u6307\u5b9a `nodePort` \u503c\uff08\u7bc4\u570d\u4ecb\u65bc 30000-32767 \u4e4b\u9593\uff09\u3002\u4f46\u662f\uff0c\u6700\u597d\u7701\u7565\u8a72\u5b57\u6bb5\uff0c\u8b93 Kubernetes \u7232\u60a8\u5206\u914d `nodePort` \u3002\u9019\u6a23\u505a\u6709\u52a9\u65bc\u907f\u514d Service \u4e4b\u9593\u51fa\u73fe\u885d\u7a81\u3002\n## LoadBalancer \u985e\u578b\u7684 Service\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 LoadBalancer \u985e\u578b\u7684 Service\uff0c\u8acb\u53c3\u95b1 [LoadBalancer Service \u6982\u5ff5](https://cloud.google.com/kubernetes-engine/docs/concepts/service-load-balancer?hl=zh-cn) \u3002\n## ExternalName \u985e\u578b\u7684 Service\n`ExternalName` \u985e\u578b\u7684 Service \u7232\u5916\u90e8 DNS \u540d\u7a31\u63d0\u4f9b\u5167\u90e8\u5225\u540d\u3002\u5167\u90e8\u5ba2\u6236\u7aef\u4f7f\u7528\u5167\u90e8 DNS \u540d\u7a31\u767c\u51fa\u8acb\u6c42\uff0c\u7136\u5f8c\u8acb\u6c42\u6703\u88ab\u91cd\u5b9a\u5411\u5230\u5916\u90e8\u540d\u7a31\u3002\n\u4ee5\u4e0b\u662f `ExternalName` \u985e\u578b\u7684 Service \u7684\u6e05\u55ae\uff1a\n```\napiVersion: v1kind: Servicemetadata:\u00a0 name: my-xn-servicespec:\u00a0 type: ExternalName\u00a0 externalName: example.com\n```\n\u5275\u5efa Service \u6642\uff0cKubernetes \u6703\u5275\u5efa\u4e00\u500b DNS \u540d\u7a31\uff0c\u5167\u90e8\u5ba2\u6236\u7aef\u53ef\u4ee5\u4f7f\u7528\u8a72\u540d\u7a31\u4f86\u8abf\u7528 Service\u3002\u5c0d\u65bc\u4e0a\u8ff0\u793a\u4f8b\uff0cDNS \u540d\u7a31\u662f my-xn-service.default.svc.cluster.local\u3002\u7576\u5167\u90e8\u5ba2\u6236\u7aef\u5411 my-xn-service.default.svc.cluster.local \u767c\u51fa\u8acb\u6c42\u6642\uff0c\u8acb\u6c42\u6703\u88ab\u91cd\u5b9a\u5411\u5230 example.com\u3002\n`ExternalName` Service \u985e\u578b\u8207\u5176\u4ed6 Service \u985e\u578b\u5b8c\u5168\u4e0d\u540c\u3002\u4e8b\u5be6\u4e0a\uff0c `ExternalName` \u985e\u578b\u7684 Service \u4e0d\u7b26\u5408\u672c\u4e3b\u984c\u958b\u982d\u63d0\u51fa\u7684 Service \u5b9a\u7fa9\u3002 `ExternalName` \u985e\u578b\u7684 Service \u4e0d\u8207\u4e00\u7d44 Pod \u76f8\u95dc\u806f\uff0c\u4e5f\u6c92\u6709\u7a69\u5b9a\u7684 IP \u5730\u5740\u3002\u76f8\u53cd\uff0c `ExternalName` \u985e\u578b\u7684 Service \u5f9e\u5167\u90e8 DNS \u540d\u7a31\u6620\u5c04\u5230\u5916\u90e8 DNS \u540d\u7a31\u3002\n## \u7121\u982d Service\n\u7121\u982d Service \u662f\u4e00\u7a2e\u4e0d\u5206\u914d\u96c6\u7fa3 IP \u5730\u5740\u7684 Kubernetes Service \u985e\u578b\u3002\u4e0d\u904e\uff0c\u7121\u982d Service \u6703\u4f7f\u7528 DNS \u516c\u958b\u8207 Service \u95dc\u806f\u7684 Pod \u7684 IP \u5730\u5740\u3002\u9019\u6a23\uff0c\u60a8\u5c31\u53ef\u4ee5\u76f4\u63a5\u9023\u63a5\u5230 Pod\uff0c\u800c\u4e0d\u662f\u901a\u904e\u4ee3\u7406\u3002\n\u7121\u982d Service \u9069\u7528\u65bc\u5404\u7a2e\u5834\u666f\uff0c\u5305\u62ec\uff1a\n- **Pod \u4e4b\u9593\u7684\u8ca0\u8f09\u5747\u8861** \uff1a\u60a8\u53ef\u4ee5\u4f7f\u7528\u7121\u982d Service \u5728 Pod \u4e4b\u524d\u5be6\u73fe\u8ca0\u8f09\u5747\u8861\u3002\u5982\u9700\u5be6\u73fe\u6b64\u76ee\u6a19\uff0c\u8acb\u4f7f\u7528\u8207\u8981\u8ca0\u8f09\u5747\u8861\u7684 Pod \u5339\u914d\u7684\u9078\u64c7\u5668\u5275\u5efa Service\u3002\u7136\u5f8c\uff0cService \u6703\u5728\u8207\u9078\u64c7\u5668\u5339\u914d\u7684\u6240\u6709 Pod \u4e4b\u524d\u5747\u52fb\u5206\u914d\u6d41\u91cf\u3002\n- **\u670d\u52d9\u767c\u73fe** \uff1a\u60a8\u53ef\u4ee5\u4f7f\u7528\u7121\u982d Service \u4f86\u5be6\u73fe\u670d\u52d9\u767c\u73fe\u3002\u5982\u9700\u5be6\u73fe\u6b64\u76ee\u6a19\uff0c\u8acb\u4f7f\u7528\u540d\u7a31\u548c\u9078\u64c7\u5668\u5275\u5efa Service\u3002\u7121\u982d\u670d\u52d9\u7684 DNS \u8a18\u9304\u5305\u542b\u8207\u8a72\u9078\u64c7\u5668\u5339\u914d\u4e14\u8207\u8a72 Pod \u5339\u914d\u7684\u6240\u6709 Pod \u7684 IP \u5730\u5740\u3002\u5ba2\u6236\u7aef\u53ef\u4ee5\u4f7f\u7528\u9019\u4e9b DNS \u8a18\u9304\u4f86\u67e5\u627e\u8207 Service \u95dc\u806f\u7684 Pod \u7684 IP \u5730\u5740\u3002\n- **\u76f4\u63a5\u8a2a\u554f Pod** \uff1a\u5ba2\u6236\u7aef\u53ef\u4ee5\u76f4\u63a5\u9023\u63a5\u5230\u8207\u7121\u982d Service \u95dc\u806f\u7684 Pod\uff0c\u9019\u5c0d\u9700\u8981\u76f4\u63a5\u8a2a\u554f\u5e95\u5c64 Pod \u7684\u670d\u52d9\uff08\u4f8b\u5982\u8ca0\u8f09\u5747\u8861\u5668\u548c DNS \u670d\u52d9\u5668\uff09\u975e\u5e38\u6709\u7528\u3002\n- **\u9748\u6d3b\u6027** \uff1a\u7121\u982d\u670d\u52d9\u53ef\u7528\u65bc\u5275\u5efa\u5404\u7a2e\u4e0d\u540c\u7684\u62d3\u64b2\uff0c\u4f8b\u5982\u8ca0\u8f09\u5747\u8861\u5668\u3001DNS \u670d\u52d9\u5668\u548c\u5206\u4f48\u5f0f\u6578\u64da\u5eab\u3002\n\u5982\u679c\u60a8\u7684\u5de5\u4f5c\u8ca0\u8f09\u6709\u7279\u6b8a\u7684\u7db2\u7d61\u8981\u6c42\uff0c\u800c\u7121\u6cd5\u901a\u904e\u5177\u6709\u9078\u64c7\u5668\u7684\u7121\u982d Service \u4f86\u89e3\u6c7a\uff0c\u90a3\u9ebc\u9084\u53ef\u4ee5\u4f7f\u7528\u7121\u9078\u64c7\u5668\u7684\u7121\u982d Service\u3002\u7121\u982d Service \u662f\u8a2a\u554f\u4e0d\u5728 Kubernetes \u96c6\u7fa3\u672c\u8eab\u5167\u7684 Service \u7684\u6709\u7528\u5de5\u5177\uff0c\u7531\u65bc\u63a7\u5236\u5e73\u9762\u4e0d\u6703\u5275\u5efa Endpointslice \u5c0d\u8c61\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728 [\u7121\u9078\u64c7\u5668\u7684 Service](https://kubernetes.io/docs/concepts/services-networking/service/#without-selectors) \u4e2d\u8a73\u7d30\u77ad\u89e3\u8a72\u670d\u52d9\n\u4ee5\u4e0b\u793a\u4f8b\u662f\u7121\u982d Service \u7684\u6e05\u55ae\uff1a\n```\napiVersion: v1kind: Servicemetadata:\u00a0 name: nginxspec:\u00a0 clusterIP: None\u00a0 selector:\u00a0 \u00a0 app: nginx\u00a0 ports:\u00a0 - name: http\u00a0 \u00a0 port: 80\u00a0 \u00a0 targetPort: 80\n```\n\u5275\u5efa\u7121\u982d Service \u5f8c\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u67e5\u8a62 DNS \u67e5\u627e\u8207 Service \u95dc\u806f\u7684 Pod \u7684 IP \u5730\u5740\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u547d\u4ee4\u5217\u51fa\u4e86\u8207 nginx \u670d\u52d9\u95dc\u806f\u7684 Pod \u7684 IP \u5730\u5740\uff1a\n**\u6ce8\u610f\uff1a** \u672c\u793a\u4f8b\u5047\u8a2d\u5275\u5efa\u7684 Pod \u5177\u6709 `nginx` \u6a19\u7c64\u3002\n```\ndig +short nginx.default.svc.cluster.local\n```\n\u53e6\u4e00\u500b\u4f7f\u7528 Kubernetes \u67e5\u8a62\u64f4\u5c55\u7684\u793a\u4f8b\uff1a\n```\ndig +short +search nginx\n```\n\u60a8\u53ea\u9700\u4e00\u500b\u547d\u4ee4\u5373\u53ef\u5275\u5efa\u7121\u982d Service\uff0c\u800c\u4e14\u7121\u982d Service \u53ef\u4ee5\u8f15\u9b06\u66f4\u65b0\u548c\u64f4\u7e2e\u3002\n```\nkubectl create service clusterip my-svc --clusterip=\"None\" --dry-run=client -o yaml > [file.yaml]\n```\n## \u670d\u52d9\u62bd\u8c61\nService \u662f\u4e00\u500b\u62bd\u8c61\u6982\u5ff5\uff0c\u56e0\u7232\u5b83\u4e0d\u662f\u5075\u807d\u67d0\u500b\u7db2\u7d61\u63a5\u53e3\u7684\u9032\u7a0b\u3002\u90e8\u5206\u62bd\u8c61\u5728\u96c6\u7fa3\u7bc0\u9ede\u7684 [iptables](https://linux.die.net/man/8/iptables) \u898f\u5247\u4e2d\u5be6\u73fe\u3002\u6839\u64da Service \u985e\u578b\uff0c\u62bd\u8c61\u7684\u5176\u4ed6\u90e8\u5206\u901a\u904e [\u5916\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668](https://cloud.google.com/load-balancing/docs/network?hl=zh-cn) \u6216 [\u5916\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668](https://cloud.google.com/load-balancing/docs/https?hl=zh-cn) \u5be6\u73fe\u3002\n## \u4efb\u610f Service \u7aef\u53e3\nService \u6e05\u55ae\u4e2d `port` \u5b57\u6bb5\u7684\u503c\u662f\u4efb\u610f\u7684\u3002\u4f46\u662f\uff0c `targetPort` \u7684\u503c\u4e0d\u662f\u4efb\u610f\u503c\u3002\u6bcf\u500b\u6210\u54e1 Pod \u5fc5\u9808\u64c1\u6709\u4e00\u500b\u5075\u807d `targetPort` \u7684\u5bb9\u5668\u3002\n\u4ee5\u4e0b\u662f `port` \u503c\u7232 50000 \u7684 `LoadBalancer` \u985e\u578b\u7684 Service\uff1a\n```\napiVersion: v1kind: Servicemetadata:\u00a0 name: my-ap-servicespec:\u00a0 clusterIP: 10.11.241.93\u00a0 externalTrafficPolicy: Cluster\u00a0 ports:\u00a0 - nodePort: 30641\u00a0 \u00a0 port: 50000\u00a0 \u00a0 protocol: TCP\u00a0 \u00a0 targetPort: 8080\u00a0 selector:\u00a0 \u00a0 app: parts\u00a0 \u00a0 department: engineering\u00a0 sessionAffinity: None\u00a0 type: LoadBalancerstatus:\u00a0 loadBalancer:\u00a0 \u00a0 ingress:\u00a0 \u00a0 - ip: 203.0.113.200\n```\n\u5ba2\u6236\u7aef\u5728 TCP \u7aef\u53e3 50000 \u4e0a\u8abf\u7528\u5730\u5740\u7232 `203.0.113.200` \u7684 Service\u3002\u8acb\u6c42\u5c07\u8f49\u767c\u5230 TCP \u7aef\u53e3 8080 \u4e0a\u7684\u5176\u4e2d\u4e00\u500b\u6210\u54e1 Pod\u3002\n## \u591a\u500b\u7aef\u53e3\nService \u7684 `ports` \u5b57\u6bb5\u662f\u4e00\u7d44 [ServicePort](https://v1-25.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#serviceport-v1-core) \u5c0d\u8c61\u3002ServicePort \u5c0d\u8c61\u5177\u6709\u4ee5\u4e0b\u5b57\u6bb5\uff1a\n- `name`\n- `protocol`\n- `port`\n- `targetPort`\n- `nodePort`\n\u5982\u679c\u60a8\u5177\u6709\u591a\u500b ServicePort\uff0c\u5247\u6bcf\u500b ServicePort \u5fc5\u9808\u5177\u6709\u552f\u4e00\u7684\u540d\u7a31\u3002\n\u4ee5\u4e0b\u662f\u5177\u6709\u5169\u500b `ServicePort` \u5c0d\u8c61\u7684 `LoadBalancer` \u985e\u578b\u7684 Service\uff1a\n```\napiVersion: v1kind: Servicemetadata:\u00a0 name: my-tp-servicespec:\u00a0 clusterIP: 10.11.242.196\u00a0 externalTrafficPolicy: Cluster\u00a0 ports:\u00a0 - name: my-first-service-port\u00a0 \u00a0 nodePort: 31233\u00a0 \u00a0 port: 60000\u00a0 \u00a0 protocol: TCP\u00a0 \u00a0 targetPort: 50000\u00a0 - name: my-second-service-port\u00a0 \u00a0 nodePort: 31081\u00a0 \u00a0 port: 60001\u00a0 \u00a0 protocol: TCP\u00a0 \u00a0 targetPort: 8080\u00a0 selector:\u00a0 \u00a0 app: tests\u00a0 \u00a0 department: engineering\u00a0 sessionAffinity: None\u00a0 type: LoadBalancerstatus:\u00a0 loadBalancer:\u00a0 \u00a0 ingress:\u00a0 \u00a0 - ip: 203.0.113.201\n```\n**\u6ce8\u610f** \uff1a\u60a8\u6700\u591a\u53ef\u4ee5\u7232 LoadBalancer \u670d\u52d9\u6307\u5b9a 5 \u500b\u7aef\u53e3\u3002\n\u5728\u4e0a\u8ff0\u793a\u4f8b\u4e2d\uff0c\u5982\u679c\u5ba2\u6236\u7aef\u5728 TCP \u7aef\u53e3 60000 \u4e0a\u8abf\u7528\u5730\u5740\u7232 `203.0.113.201` \u7684 Service\uff0c\u5247\u8acb\u6c42\u5c07\u8f49\u767c\u5230 TCP \u7aef\u53e3 50000 \u4e0a\u7684\u6210\u54e1 Pod\u3002\u4f46\u662f\uff0c\u5982\u679c\u5ba2\u6236\u7aef\u5728 TCP \u7aef\u53e3 60001 \u4e0a\u8abf\u7528 `203.0.113.201` \u7684 Service\uff0c\u5247\u8acb\u6c42\u5c07\u8f49\u767c\u5230 TCP \u7aef\u53e3 8080 \u4e0a\u7684\u6210\u54e1 Pod\u3002\n\u6bcf\u500b\u6210\u54e1 Pod \u5fc5\u9808\u64c1\u6709\u4e00\u500b\u5075\u807d TCP \u7aef\u53e3 50000 \u7684\u5bb9\u5668\u548c\u4e00\u500b\u5075\u807d TCP \u7aef\u53e3 8080 \u7684\u5bb9\u5668\u3002\u9019\u53ef\u4ee5\u662f\u5177\u6709\u5169\u500b\u7dda\u7a0b\u7684\u55ae\u500b\u5bb9\u5668\uff0c\u4e5f\u53ef\u4ee5\u662f\u5728\u540c\u4e00 Pod \u4e2d\u904b\u884c\u7684\u5169\u500b\u5bb9\u5668\u3002\n## Service \u7aef\u9ede\n\u5275\u5efa Service \u6642\uff0cKubernetes \u6703\u5275\u5efa\u4e00\u500b\u8207 Service \u540c\u540d\u7684 [Endpoints](https://v1-25.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#endpoints-v1-core) \u5c0d\u8c61\u3002Kubernetes \u4f7f\u7528 Endpoints \u5c0d\u8c61\u4f86\u8ddf\u8e64\u54ea\u4e9b Pod \u662f Service \u7684\u6210\u54e1\u3002\n## \u55ae\u68e7\u548c\u96d9\u68e7 Service\n\u60a8\u53ef\u4ee5\u5275\u5efa [ClusterIP](https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=zh-cn#services_of_type_clusterip) \u6216 [NodePort](https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=zh-cn#service_of_type_nodeport) \u985e\u578b\u7684 IPv6 Service\u3002GKE \u5728 [\u9810\u89bd\u7248](https://cloud.google.com/products?hl=zh-cn#product-launch-stages) \u671f\u9593\u652f\u6301 [LoadBalancer](https://cloud.google.com/kubernetes-engine/docs/concepts/service-load-balancer?hl=zh-cn) \u985e\u578b\u7684\u96d9\u68e7 Service\uff0c\u6211\u5011\u4e0d\u7232\u5176\u63d0\u4f9b\u670d\u52d9\u7b49\u7d1a\u5354\u8b70 (SLA) \u6216\u6280\u8853\u652f\u6301\u3002\n\u5c0d\u65bc\u6bcf\u7a2e Service \u985e\u578b\uff0c\u60a8\u53ef\u4ee5\u5c07 `ipFamilies` \u548c `ipFamilyPolicy` \u5b57\u6bb5\u5b9a\u7fa9\u7232 IPv4\u3001IPv6 \u6216 [\u96d9\u68e7](https://kubernetes.io/docs/concepts/services-networking/dual-stack/#services) Service\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u8a73\u7d30\u77ad\u89e3 [Kubernetes Service](https://kubernetes.io/docs/concepts/services-networking/service/) \n- [\u4f7f\u7528 Service \u516c\u958b\u61c9\u7528](https://cloud.google.com/kubernetes-engine/docs/how-to/exposing-apps?hl=zh-cn) \n- \u8a73\u7d30\u77ad\u89e3 [StatefulSet](https://cloud.google.com/kubernetes-engine/docs/concepts/statefulset?hl=zh-cn) \n- \u8a73\u7d30\u77ad\u89e3 [Ingress](https://cloud.google.com/kubernetes-engine/docs/concepts/ingress?hl=zh-cn) \n- \u5b8c\u6210 [\u4f7f\u7528 Ingress \u8a2d\u7f6e\u5916\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668](https://cloud.google.com/kubernetes-engine/docs/tutorials/http-balancer?hl=zh-cn) \u6559\u7a0b", "guide": "Google Kubernetes Engine (GKE)"}