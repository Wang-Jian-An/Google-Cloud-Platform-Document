{"title": "Google Kubernetes Engine (GKE) - \u5553\u7528\u591a\u96c6\u7fa3 Gateway", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/enabling-multi-cluster-gateways?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u5553\u7528\u591a\u96c6\u7fa3 Gateway\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u7232 GKE \u96c6\u7fa3\u5553\u7528\u591a\u96c6\u7fa3 [GKE Gateway Controller](https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api?hl=zh-cn) \u63a7\u5236\u5668\uff0c\u9019\u662f Google \u8a17\u7ba1\u7684\u63a7\u5236\u5668\uff0c\u53ef\u7528\u65bc\u9810\u914d\u5916\u90e8\u548c\u5167\u90e8\u8ca0\u8f09\u5747\u8861\u5668\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u4f7f\u7528 Gateway \u8cc7\u6e90\u9032\u884c\u5bb9\u5668\u8ca0\u8f09\u5747\u8861\uff0c\u8acb\u53c3\u95b1 [\u90e8\u7f72 Gateway](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-gateways?hl=zh-cn) \u6216 [\u90e8\u7f72\u591a\u96c6\u7fa3 Gateway](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-multi-cluster-gateways?hl=zh-cn) \u3002\n\u591a\u96c6\u7fa3 GKE Gateway Controller \u63a7\u5236\u5668\u6703\u5728\u96c6\u7fa3\u4e2d\u5b89\u88dd\u4ee5\u4e0b\u591a\u96c6\u7fa3 GatewayClass\uff1a\n- `gke-l7-global-external-managed-mc`\uff08\u4ee3\u8868\u5168\u7403\u5916\u90e8\u591a\u96c6\u7fa3 Gateway\uff09\n- `gke-l7-regional-external-managed-mc`\uff08\u4ee3\u8868\u5340\u57df\u7d1a\u5916\u90e8\u591a\u96c6\u7fa3 Gateway\uff09\n- `gke-l7-rilb-mc`\uff08\u4ee3\u8868\u5340\u57df\u7d1a\u5167\u90e8\u591a\u96c6\u7fa3 Gateway\uff09\n- `gke-l7-gxlb-mc`\uff08\u4ee3\u8868\u5168\u7403\u5916\u90e8\u50b3\u7d71\u591a\u96c6\u7fa3 Gateway\uff09\n\u8a73\u7d30\u77ad\u89e3\u5404\u7a2e [GKE \u4e2d\u7684 GatewayClass](https://cloud.google.com/kubernetes-engine/docs/how-to/gatewayclass-capabilities?hl=zh-cn) \u7684\u529f\u80fd\u3002\n", "content": "## \u50f9\u683c\n\u901a\u904e Gateway \u63a7\u5236\u5668\u90e8\u7f72\u7684\u6240\u6709 Compute Engine \u8cc7\u6e90\u90fd\u6703\u6839\u64da GKE \u96c6\u7fa3\u6240\u5728\u7684\u9805\u76ee\u8a08\u8cbb\u3002\u4f5c\u7232 GKE Standard \u548c Autopilot \u50f9\u683c\u7684\u4e00\u90e8\u5206\uff0c\u7121\u9700\u984d\u5916\u4ed8\u8cbb\u5373\u53ef\u7372\u5f97\u55ae\u96c6\u7fa3 Gateway \u63a7\u5236\u5668\u3002\u5982\u9700\u77ad\u89e3\u591a\u96c6\u7fa3 Gateway \u7684\u50f9\u683c\uff0c\u8acb\u53c3\u95b1 [\u591a\u96c6\u7fa3 Ingress \u548c Gateway \u50f9\u683c\u9801\u9762](https://cloud.google.com/kubernetes-engine/pricing?hl=zh-cn#multi-cluster-ingress) \u3002\n## \u6e96\u5099\u5de5\u4f5c\n\u5728\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u57f7\u884c\u4ee5\u4e0b\u4efb\u52d9\uff1a\n- \u5553\u7528 Google Kubernetes Engine API\u3002\n- [  \u5553\u7528 Google Kubernetes Engine API ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com&hl=zh-cn) \n- \u5982\u679c\u60a8\u8981\u4f7f\u7528 Google Cloud CLI \u57f7\u884c\u6b64\u4efb\u52d9\uff0c\u8acb [\u5b89\u88dd](https://cloud.google.com/sdk/docs/install?hl=zh-cn) \u4e26 [\u521d\u59cb\u5316](https://cloud.google.com/sdk/docs/initializing?hl=zh-cn) gcloud CLI\u3002 \u5982\u679c\u60a8\u4e4b\u524d\u5b89\u88dd\u4e86 gcloud CLI\uff0c\u8acb\u904b\u884c`gcloud components update`\u4ee5\u7372\u53d6\u6700\u65b0\u7248\u672c\u3002 **\u6ce8\u610f** \uff1a\u5c0d\u65bc\u73fe\u6709 gcloud CLI \u5b89\u88dd\uff0c\u8acb\u52d9\u5fc5\u8a2d\u7f6e`compute/region`\u548c`compute/zone` [\u5c6c\u6027](https://cloud.google.com/sdk/docs/properties?hl=zh-cn#setting_properties) \u3002\u901a\u904e\u8a2d\u7f6e\u9ed8\u8a8d\u4f4d\u7f6e\uff0c\u60a8\u53ef\u4ee5\u907f\u514d gcloud CLI \u4e2d\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a`One of [--zone, --region] must be supplied: Please specify location`\u3002\n### GKE Gateway Controller \u8981\u6c42\n- \u5c0d\u65bc\u6a19\u6e96\u7248\uff0c\u9700\u8981 GKE 1.24 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- \u5c0d\u65bc Autopilot\uff0c\u9700\u8981 GKE 1.26 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- Google Cloud CLI 407.0.0 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u3002\n- \u50c5 [VPC \u539f\u751f](https://cloud.google.com/kubernetes-engine/docs/concepts/alias-ips?hl=zh-cn) \u96c6\u7fa3\u652f\u6301 Gateway API\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u5167\u90e8 GatewayClass\uff0c\u5247\u5fc5\u9808\u5553\u7528 [\u4ee3\u7406\u5c08\u7528\u5b50\u7db2](https://cloud.google.com/load-balancing/docs/proxy-only-subnets?hl=zh-cn) \u3002\n- \u96c6\u7fa3\u5fc5\u9808\u5553\u7528`HttpLoadBalancing`\u63d2\u4ef6\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Istio\uff0c\u5247\u5fc5\u9808\u5c07 Istio \u5347\u7d1a\u5230\u4ee5\u4e0b\u7248\u672c\u4e4b\u4e00\uff1a\n- 1.15.2 \u6216\u66f4\u9ad8\u7248\u672c\n- 1.14.5 \u6216\u66f4\u9ad8\u7248\u672c\n- 1.13.9 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u5171\u4eab VPC\uff0c\u5247\u9700\u8981\u5728\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5c07`Compute Network User`\u89d2\u8272\u5206\u914d\u7d66\u670d\u52d9\u9805\u76ee\u7684 GKE \u670d\u52d9\u8cec\u865f\u3002\n### \u591a\u96c6\u7fa3 Gateway \u8981\u6c42\n\u9664\u4e86 GKE Gateway Controller \u8981\u6c42\u4e4b\u5916\uff0c\u5c0d\u65bc\u591a\u96c6\u7fa3 Gateway \u90e8\u7f72\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u57f7\u884c\u4ee5\u4e0b\u4efb\u52d9\uff1a\n- \u5728\u914d\u7f6e\u96c6\u7fa3\u4e0a [\u5553\u7528 Gateway API](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-gateways?hl=zh-cn#enable-gateway-existing-cluster) \u3002\n- \u5728\u96c6\u7fa3\u4e0a\u5553\u7528 [GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408](https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity?hl=zh-cn#enable-existing-cluster) \u3002\n- \u5b8c\u6210\u95dc\u65bc\u8a3b\u518a\u96c6\u7fa3\u7684 [\u8266\u968a\u5e38\u898f\u524d\u63d0\u689d\u4ef6](https://cloud.google.com/anthos/fleet-management/docs/before-you-begin?hl=zh-cn#enable_apis) \u3002\n- \u5728\u9805\u76ee\u4e2d\u5553\u7528\u4ee5\u4e0b\u591a\u96c6\u7fa3 Gateway \u6240\u9700\u7684 API\uff1a- Traffic Director API\n- Multi-cluster Services API\n- Multi Cluster Ingress API\n\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u53ef\u5553\u7528\u6240\u9700\u7684 API\uff08\u5982\u679c\u5c1a\u672a\u5553\u7528\uff09\uff1a```\ngcloud services enable \\\u00a0 trafficdirector.googleapis.com \\\u00a0 multiclusterservicediscovery.googleapis.com \\\u00a0 multiclusteringress.googleapis.com \\\u00a0 --project=PROJECT_ID\n```\u5c07 `` \u66ff\u63db\u7232\u5728\u5176\u4e2d\u904b\u884c GKE \u96c6\u7fa3\u7684\u9805\u76ee\u7684 ID\u3002\n**\u6ce8\u610f\uff1a** Traffic Director \u7528\u4f5c\u5f8c\u7aef\u57fa\u790e\u67b6\u69cb\uff0c\u8ca0\u8cac\u50b3\u64ad [\u591a\u96c6\u7fa3 Service](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-cluster-services?hl=zh-cn) \u7684\u7aef\u9ede\uff0c\u4f46 MCS \u63a7\u5236\u5668\u5275\u5efa\u7684 Traffic Director \u8cc7\u6e90\u4e0d\u6703\u8a08\u5165\u60a8\u7684\u9805\u76ee\u8cbb\u7528\uff0c\u56e0\u7232 MCS \u5305\u542b\u5728 GKE \u7684\u8cbb\u7528\u4e2d\u3002\n### \u9650\u5236\u548c\u4fb7\u9650\n\u55ae\u96c6\u7fa3 Gateway \u7684 [\u9650\u5236\u548c\u5df2\u77e5\u554f\u984c](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-gateways?hl=zh-cn#limitations) \u540c\u6a23\u4e5f\u9069\u7528\u65bc\u591a\u96c6\u7fa3 Gateway\u3002\n\u9664\u4e86\u55ae\u96c6\u7fa3 Gateway \u7684\u9650\u5236\u4e4b\u5916\uff0c\u4ee5\u4e0b\u9650\u5236\u4e5f\u9069\u7528\u65bc\u591a\u96c6\u7fa3 Gateway\uff1a\n- \u5340\u57df\u7d1a\u5167\u90e8 GatewayClass `gke-l7-rilb-mc` \u4e0d\u652f\u6301\u8ca0\u8f09\u5747\u8861\u5230\u4e0d\u540c\u5340\u57df\u4e2d\u7684\u5f8c\u7aef\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6bcf\u500b GatewayClass \u652f\u6301\u7684\u4e0d\u540c\u529f\u80fd\uff0c\u8acb\u53c3\u95b1 [GatewayClass \u529f\u80fd](https://cloud.google.com/kubernetes-engine/docs/how-to/gatewayclass-capabilities?hl=zh-cn) \u3002\n- \u5728\u591a\u96c6\u7fa3 Gateway \u4e2d\uff0c\u4e0d\u652f\u6301\u5c07 `Service` \u7528\u4f5c `backendRefs` \u3002\u591a\u96c6\u7fa3 Gateway \u50c5\u652f\u6301\u5c07 `ServiceImport` \u7528\u4f5c\u6709\u6548\u7684 `backendRefs` \u3002\n- \u4e0d\u652f\u6301\u8de8\u9805\u76ee\u8ca0\u8f09\u5747\u8861\u3002\u9023\u63a5\u5230\u540c\u4e00\u591a\u96c6\u7fa3 Gateway \u7684\u6240\u6709\u96c6\u7fa3\uff08\u914d\u7f6e\u96c6\u7fa3\u548c\u76ee\u6a19\u96c6\u7fa3\uff09\u5fc5\u9808\u90e8\u7f72\u5728\u540c\u4e00\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u6216\u670d\u52d9\u9805\u76ee\u4e2d\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u591a\u96c6\u7fa3 Gateway \u652f\u6301\u7684\u5171\u4eab VPC \u62d3\u64b2\uff0c\u8acb\u53c3\u95b1 [\u5c07\u591a\u96c6\u7fa3 Gateway \u8207\u5171\u4eab VPC \u642d\u914d\u4f7f\u7528](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-multi-cluster-gateways?hl=zh-cn#use_multi-cluster_gateway_with) \u3002GKE Gateway \u4f7f\u7528 [Cloud Load Balancing \u914d\u984d](https://cloud.google.com/load-balancing/docs/quotas?hl=zh-cn) \u4f86\u9650\u5236 Gateway \u63a7\u5236\u5668\u53ef\u4ee5\u5275\u5efa\u591a\u5c11\u8cc7\u6e90\u4f86\u7ba1\u7406\u8def\u7531\u5230 GKE \u96c6\u7fa3\u7684\u5165\u7ad9\u6d41\u91cf\u3002\n## \u7232\u591a\u96c6\u7fa3 Gateway \u8a2d\u7f6e\u74b0\u5883\n\u5b83\u9700\u8981\u591a\u500b GKE \u96c6\u7fa3\u624d\u80fd\u5b8c\u6210 [\u90e8\u7f72\u591a\u96c6\u7fa3 Gateway](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-multi-cluster-gateways?hl=zh-cn) \u4e2d\u7684\u793a\u4f8b\u3002\u6240\u6709\u96c6\u7fa3\u5747\u8a3b\u518a\u5230\u540c\u4e00 [\u8266\u968a](https://cloud.google.com/anthos/fleet-management/docs?hl=zh-cn) \uff0c\u4ee5\u4fbf\u591a\u96c6\u7fa3 Gateway \u548c Service \u53ef\u4ee5\u5728\u5b83\u5011\u4e4b\u9593\u904b\u884c\u3002\n\u4ee5\u4e0b\u6b65\u9a5f\u5c07\u8de8\u9805\u76ee\u4e2d\u7684\u5169\u500b\u4e0d\u540c\u5730\u5340\u90e8\u7f72\u4e09\u500b GKE \u96c6\u7fa3\uff1a\n- `us-west1-a/gke-west-1`\n- `us-west1-a/gke-west-2`\n- `us-east1-b/gke-east-1`\n\u9019\u5c07\u5275\u5efa\u4ee5\u4e0b\u96c6\u7fa3\u62d3\u64b2\uff1a\n\u9019\u4e9b GKE \u96c6\u7fa3\u7528\u65bc\u6f14\u793a\u4f7f\u7528\u5916\u90e8\u548c\u5167\u90e8 Gateway \u7684 [\u591a\u5340\u57df\u8ca0\u8f09\u5747\u8861](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-multi-cluster-gateways?hl=zh-cn#external-gateway) \u548c [\u85cd\u7da0\u591a\u96c6\u7fa3\u6d41\u91cf\u5206\u914d](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-multi-cluster-gateways?hl=zh-cn#blue-green) \u3002\n### \u90e8\u7f72\u96c6\u7fa3\n\u5728\u9019\u4e9b\u6b65\u9a5f\u4e2d\uff0c\u60a8\u9700\u8981\u5c07\u4e09\u500b GKE \u96c6\u7fa3\u90e8\u7f72\u5230 `us-east1` \u548c `us-west1` \u5730\u5340\u3002\n- \u5728 `us-west1` \u4e2d\u5275\u5efa\u4e00\u500b\u540d\u7232 `gke-west-1` \u7684 GKE \u96c6\u7fa3\uff1a```\ngcloud container clusters create gke-west-1 \\\u00a0 \u00a0 --gateway-api=standard \\\u00a0 \u00a0 --zone=us-west1-a \\\u00a0 \u00a0 --workload-pool=PROJECT_ID.svc.id.goog \\\u00a0 \u00a0 --cluster-version=VERSION \\\u00a0 \u00a0 --project=PROJECT_ID\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u60a8\u7684 GKE \u96c6\u7fa3\u904b\u884c\u6240\u5728\u7684\u9805\u76ee ID\u3002\n- ``\uff1aGKE 1.24 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u3002\n- \u5728 `us-west1` \uff08\u6216\u8207\u4e0a\u4e00\u500b\u96c6\u7fa3\u76f8\u540c\u7684\u5340\u57df\uff09\u4e2d\u5275\u5efa\u540d\u7232 `gke-west-2` \u7684\u53e6\u4e00\u500b GKE \u96c6\u7fa3\uff1a```\ngcloud container clusters create gke-west-2 \\\u00a0 \u00a0 --gateway-api=standard \\\u00a0 \u00a0 --zone=us-west1-a \\\u00a0 \u00a0 --workload-pool=PROJECT_ID.svc.id.goog \\\u00a0 \u00a0 --cluster-version=VERSION \\\u00a0 \u00a0 --project=PROJECT_ID\n```\n- \u5728 `us-east1` \uff08\u6216\u8207\u4e0a\u4e00\u500b\u96c6\u7fa3\u4e0d\u540c\u7684\u5340\u57df\uff09\u4e2d\u5275\u5efa\u4e00\u500b\u540d\u7232 `gke-east-1` \u7684 GKE \u96c6\u7fa3```\ngcloud container clusters create gke-east-1 \\\u00a0 \u00a0 --gateway-api=standard \\\u00a0 \u00a0 --zone=us-east1-b \\\u00a0 \u00a0 --workload-pool=PROJECT_ID.svc.id.goog \\\u00a0 \u00a0 --cluster-version=VERSION \\\u00a0 \u00a0 --project=PROJECT_ID\n```\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u73fe\u6709\u96c6\u7fa3\uff0c\u8acb\u53c3\u95b1 [\u5728\u73fe\u6709\u96c6\u7fa3\u4e0a\u5553\u7528 Gateway API](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-gateways?hl=zh-cn#enable-gateway-existing-cluster) \u3002\n### \u914d\u7f6e\u96c6\u7fa3\u6191\u64da\n\u6b64\u6b65\u9a5f\u4f7f\u7528\u6613\u8a18\u7684\u540d\u7a31\u914d\u7f6e\u96c6\u7fa3\u6191\u64da\u3002\u9019\u53ef\u8b93\u60a8\u5728\u8de8\u591a\u500b\u96c6\u7fa3\u90e8\u7f72\u8cc7\u6e90\u6642\u66f4\u8f15\u9b06\u5730\u5728\u96c6\u7fa3\u4e4b\u9593\u5207\u63db\u3002\n- \u63d0\u53d6\u96c6\u7fa3 `gke-west-1` \u3001 `gke-west-2` \u548c `gke-east-1` \u7684\u6191\u64da\uff1a```\ngcloud container clusters get-credentials gke-west-1 --zone=us-west1-a --project=PROJECT_IDgcloud container clusters get-credentials gke-west-2 --zone=us-west1-a --project=PROJECT_IDgcloud container clusters get-credentials gke-east-1 --zone=us-east1-b --project=PROJECT_ID\n```\u6b64\u64cd\u4f5c\u6703\u5c07\u6191\u64da\u5b58\u5132\u5728\u672c\u5730\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\u4f7f\u7528 kubectl \u5ba2\u6236\u7aef\u8a2a\u554f\u96c6\u7fa3 API \u670d\u52d9\u5668\u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u7cfb\u7d71\u6703\u7232\u6191\u64da\u5275\u5efa\u81ea\u52d5\u751f\u6210\u7684\u540d\u7a31\u3002\n- \u91cd\u547d\u540d\u96c6\u7fa3\u4e0a\u4e0b\u6587\uff0c\u4ee5\u4fbf\u65e5\u5f8c\u66f4\u5bb9\u6613\u5f15\u7528\uff1a```\nkubectl config rename-context gke_PROJECT_ID_us-west1-a_gke-west-1 gke-west-1kubectl config rename-context gke_PROJECT_ID_us-west1-a_gke-west-2 gke-west-2kubectl config rename-context gke_PROJECT_ID_us-east1-b_gke-east-1 gke-east-1\n```\u5c07 `` \u66ff\u63db\u7232\u5728\u5176\u4e2d\u90e8\u7f72\u96c6\u7fa3\u7684\u9805\u76ee\u7684 ID\u3002\n### \u5c07\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\n- \u6210\u529f\u5275\u5efa\u6240\u6709\u4e09\u500b\u96c6\u7fa3\u540e\uff0c\u60a8\u9700\u8981\u5c07\u9019\u4e9b\u96c6\u7fa3\u8a3b\u518a\u5230\u9805\u76ee\u7684 [\u8266\u968a](https://cloud.google.com/anthos/fleet-management/docs?hl=zh-cn) \u3002\u901a\u904e\u5c07 GKE \u96c6\u7fa3\u7d44\u5408\u5230\u4e00\u500b\u8266\u968a\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u591a\u96c6\u7fa3 Gateway \u80fd\u5920\u5b9a\u4f4d\u9019\u4e9b\u96c6\u7fa3\u3002```\ngcloud container fleet memberships register gke-west-1 \\\u00a0 \u00a0 \u00a0--gke-cluster us-west1-a/gke-west-1 \\\u00a0 \u00a0 \u00a0--enable-workload-identity \\\u00a0 \u00a0 \u00a0--project=PROJECT_IDgcloud container fleet memberships register gke-west-2 \\\u00a0 \u00a0 \u00a0--gke-cluster us-west1-a/gke-west-2 \\\u00a0 \u00a0 \u00a0--enable-workload-identity \\\u00a0 \u00a0 \u00a0--project=PROJECT_IDgcloud container fleet memberships register gke-east-1 \\\u00a0 \u00a0 \u00a0--gke-cluster us-east1-b/gke-east-1 \\\u00a0 \u00a0 \u00a0--enable-workload-identity \\\u00a0 \u00a0 \u00a0--project=PROJECT_ID\n```\n- \u78ba\u8a8d\u9019\u4e9b\u96c6\u7fa3\u5df2\u6210\u529f\u8a3b\u518a\u5230\u8266\u968a\uff1a```\ngcloud container fleet memberships list --project=PROJECT_ID\n```\u8f38\u51fa\u5c07\u5982\u4e0b\u6240\u793a\uff1a```\nNAME  EXTERNAL_ID       LOCATION\ngke-east-1 45a80b37-4b00-49aa-a68b-b430fce1e3f0 us-east1\ngke-west-2 ac7087a5-f5ee-401e-b430-57f3af141239 us-west1\ngke-west-1 549efe3a-b18e-4eb9-8796-e50b7967cde2 us-west1\n```\n### \u5728\u8266\u968a\u4e2d\u5553\u7528\u591a\u96c6\u7fa3 Service\n- \u5728\u8266\u968a\u4e2d\u7232\u5df2\u8a3b\u518a\u7684\u96c6\u7fa3\u5553\u7528\u591a\u96c6\u7fa3 Service\u3002\u9019\u6703\u7232\u8a3b\u518a\u5230\u8266\u968a\u4e2d\u7684\u4e09\u500b\u96c6\u7fa3\u5553\u7528 MCS \u63a7\u5236\u5668\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u76e3\u807d\u548c\u5c0e\u51fa Service\u3002```\ngcloud container fleet multi-cluster-services enable \\\u00a0 \u00a0 --project PROJECT_ID\n```\n- \u6388\u4e88 MCS \u63a7\u5236\u5668\u6240\u9700\u7684 Identity and Access Management (IAM) \u6b0a\u9650\uff1a```\ngcloud projects add-iam-policy-binding PROJECT_ID \\\u00a0 \u00a0 --member \"serviceAccount:PROJECT_ID.svc.id.goog[gke-mcs/gke-mcs-importer]\" \\\u00a0 \u00a0 --role \"roles/compute.networkViewer\" \\\u00a0 \u00a0 --project=PROJECT_ID\n```\u5c07 `` \u66ff\u63db\u7232\u5728\u5176\u4e2d\u90e8\u7f72\u96c6\u7fa3\u7684\u9805\u76ee\u7684 ID\u3002\n- \u78ba\u8a8d\u7232\u5df2\u8a3b\u518a\u7684\u96c6\u7fa3\u5553\u7528 MCS\u3002\u60a8\u5c07\u770b\u5230\u4e09\u500b\u5df2\u8a3b\u518a\u96c6\u7fa3\u7684\u6210\u54e1\u3002\u6240\u6709\u96c6\u7fa3\u53ef\u80fd\u9700\u8981\u5e7e\u5206\u9418\u624d\u80fd\u986f\u793a\u51fa\u4f86\u3002```\ngcloud container fleet multi-cluster-services describe --project=PROJECT_ID\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\ncreateTime: '2023-10-12T06:14:33.466903587Z'\nmembershipStates:\n projects/441323991697/locations/us-east1/memberships/gke-east-1:\n state:\n  code: OK\n  description: Firewall successfully updated\n  updateTime: '2023-10-12T06:15:28.395318091Z'\n projects/441323991697/locations/us-west1/memberships/gke-west-1:\n state:\n  code: OK\n  description: Firewall successfully updated\n  updateTime: '2023-10-12T06:15:30.534594027Z'\n projects/441323991697/locations/us-west1/memberships/gke-west-2:\n state:\n  code: OK\n  description: Firewall successfully updated\n  updateTime: '2023-10-12T06:15:29.110582109Z'\nname: projects/pierre-louis-playground/locations/global/features/multiclusterservicediscovery\nresourceState:\n state: ACTIVE\nspec: {}\nupdateTime: '2023-10-12T06:15:31.027276757Z'\n```\n### \u5728\u8266\u968a\u4e2d\u5553\u7528\u591a\u96c6\u7fa3 Gateway\n[\u591a\u96c6\u7fa3 GKE Gateway Controller](https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api?hl=zh-cn#gateway_controller) \u63a7\u5236\u5668\u7528\u65bc\u7ba1\u7406\u591a\u96c6\u7fa3 Gateway \u7684\u90e8\u7f72\u3002\n**\u6ce8\u610f\uff1a** \u591a\u96c6\u7fa3 Gateway \u63a7\u5236\u5668\u9084\u8ca0\u8cac `MulticlusterIngress` \u8cc7\u6e90\u7684\u63d2\u6a01\u3002\n\u5553\u7528\u591a\u96c6\u7fa3 Gateway \u63a7\u5236\u5668\u6642\uff0c\u60a8\u5fc5\u9808\u9078\u64c7\u914d\u7f6e\u96c6\u7fa3\u3002\u914d\u7f6e\u96c6\u7fa3\u662f\u7528\u65bc\u90e8\u7f72 Gateway \u8cc7\u6e90\uff08 [Gateway](https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api?hl=zh-cn#gateway) \u3001 [\u8def\u7531](https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api?hl=zh-cn#httproute) \u3001 [\u653f\u7b56](https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api?hl=zh-cn#policy) \uff09\u7684 GKE \u96c6\u7fa3\u3002\u5b83\u662f\u63a7\u5236\u96c6\u7fa3\u4e4b\u9593\u8def\u7531\u7684\u4e2d\u5fc3\u4f4d\u7f6e\u3002\u8acb\u53c3\u95b1 [\u914d\u7f6e\u96c6\u7fa3\u8a2d\u8a08](https://cloud.google.com/kubernetes-engine/docs/concepts/multi-cluster-ingress?hl=zh-cn#config_cluster_design) \uff0c\u4ee5\u5e6b\u52a9\u60a8\u6c7a\u5b9a\u9078\u64c7\u54ea\u500b\u96c6\u7fa3\u4f5c\u7232\u914d\u7f6e\u96c6\u7fa3\u3002\n- \u5728\u8266\u968a\u4e2d\u5553\u7528\u591a\u96c6\u7fa3 Gateway \u4e26\u6307\u5b9a\u914d\u7f6e\u96c6\u7fa3\u3002\u8acb\u6ce8\u610f\uff0c\u60a8\u4ee5\u5f8c\u53ef\u4ee5\u96a8\u6642\u66f4\u65b0\u8a72\u914d\u7f6e\u96c6\u7fa3\u3002\u6b64\u793a\u4f8b\u5c07 `gke-west-1` \u6307\u5b9a\u7232\u914d\u7f6e\u96c6\u7fa3\uff0c\u8a72\u96c6\u7fa3\u5c07\u8a17\u7ba1\u591a\u96c6\u7fa3 Gateway \u7684\u8cc7\u6e90\u3002```\ngcloud container fleet ingress enable \\\u00a0 \u00a0 --config-membership=projects/PROJECT_ID/locations/us-west1-a/memberships/gke-west-1 \\\u00a0 \u00a0 --project=PROJECT_ID\n```\n- \u6388\u4e88\u591a\u96c6\u7fa3 Gateway \u63a7\u5236\u5668\u6240\u9700\u7684 Identity and Access Management (IAM) \u6b0a\u9650\uff1a```\ngcloud projects add-iam-policy-binding PROJECT_ID \\\u00a0 \u00a0 --member \"serviceAccount:service-PROJECT_NUMBER@gcp-sa-multiclusteringress.iam.gserviceaccount.com\" \\\u00a0 \u00a0 --role \"roles/container.admin\" \\\u00a0 \u00a0 --project=PROJECT_ID\n```\u5c07 `` \u548c `` \u66ff\u63db\u7232\u7528\u65bc\u90e8\u7f72\u96c6\u7fa3\u7684\u9805\u76ee\u7684 ID \u548c\u7de8\u865f\u3002\n- \u78ba\u8a8d\u60a8\u7684\u8266\u968a\u5553\u7528\u4e86 GKE Gateway Controller \u63a7\u5236\u5668\uff1a```\ngcloud container fleet ingress describe --project=PROJECT_ID\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\ncreateTime: '2023-10-12T06:23:06.732858524Z'\nmembershipStates:\n projects/441323991697/locations/us-east1/memberships/gke-east-1:\n state:\n  code: OK\n  updateTime: '2023-10-12T06:30:08.815839024Z'\n projects/441323991697/locations/us-west1/memberships/gke-west-1:\n state:\n  code: OK\n  updateTime: '2023-10-12T06:30:08.815837031Z'\n projects/441323991697/locations/us-west1/memberships/gke-west-2:\n state:\n  code: OK\n  updateTime: '2023-10-12T06:30:08.815840985Z'\nname: projects/pierre-louis-playground/locations/global/features/multiclusteringress\nresourceState:\n state: ACTIVE\nspec:\n multiclusteringress:\n configMembership: projects/pierre-louis-playground/locations/us-west1/memberships/gke-west-1\nstate:\n state:\n code: OK\n description: Ready to use\n updateTime: '2023-10-12T06:23:51.317464415Z'\nupdateTime: '2023-10-12T06:30:09.439319551Z'\n```\n- \u78ba\u8a8d\u60a8\u7684\u914d\u7f6e\u96c6\u7fa3\u4e2d\u5b58\u5728 GatewayClass\uff1a```\nkubectl get gatewayclasses --context=gke-west-1\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME         CONTROLLER     ACCEPTED AGE\ngke-l7-global-external-managed  networking.gke.io/gateway True  78m\ngke-l7-global-external-managed-mc  networking.gke.io/gateway True  4m22s\ngke-l7-gxlb       networking.gke.io/gateway True  78m\ngke-l7-gxlb-mc      networking.gke.io/gateway True  4m23s\ngke-l7-regional-external-managed  networking.gke.io/gateway True  78m\ngke-l7-regional-external-managed-mc networking.gke.io/gateway True  4m22s\ngke-l7-rilb       networking.gke.io/gateway True  78m\ngke-l7-rilb-mc      networking.gke.io/gateway True  4m22s\n```\u6b64\u8f38\u51fa\u5305\u62ec\u91dd\u5c0d\u5916\u90e8\u591a\u96c6\u7fa3 Gateway \u7684 GatewayClass gke-l7-global-external-managed-mc\u3001gke-l7-regional-external-managed-mc\u3001gke-l7-gxlb-mc \u548c\u91dd\u5c0d\u5167\u90e8\u591a\u96c6\u7fa3 Gateway \u7684 GatewayClass gke-l7-rilb-mc\u3002\n- \u5c07 kubectl \u4e0a\u4e0b\u6587\u5207\u63db\u5230\u914d\u7f6e\u96c6\u7fa3\uff1a```\nkubectl config use-context gke-west-1\n```\n\u60a8\u73fe\u5728\u53ef\u4ee5\u958b\u59cb\u5728\u914d\u7f6e\u96c6\u7fa3\u4e2d\u90e8\u7f72\u591a\u96c6\u7fa3 Gateway \u4e86\u3002\n## \u554f\u984c\u6392\u67e5\n\u672c\u90e8\u5206\u4ecb\u7d39\u5982\u4f55\u89e3\u6c7a\u8207\u591a\u96c6\u7fa3 Gateway \u5553\u7528\u76f8\u95dc\u7684\u554f\u984c\u3002\n### \u914d\u7f6e\u96c6\u7fa3\u4e2d\u4e0d\u63d0\u4f9b GatewayClass\n\u904b\u884c `kubectl get gatewayclasses` \u547d\u4ee4\u6642\u53ef\u80fd\u6703\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nerror: the server doesn't have a resource type \"gatewayclasses\"\n```\n\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u5728\u96c6\u7fa3\u4e0a\u5b89\u88dd Gateway API\uff1a\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --gateway-api=standard \\\u00a0 \u00a0 --region=COMPUTE_REGION\n```\n\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- ``\uff1a\u60a8\u7684\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u96c6\u7fa3\u7684 Compute Engine [\u5340\u57df](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#available) \u3002\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff0c\u8acb\u4f7f\u7528`--zone=` ``\u3002## \u5df2\u77e5\u554f\u984c\n- \u591a\u96c6\u7fa3 Gateway \u63a7\u5236\u5668\u5b58\u5728\u4e00\u500b\u5df2\u77e5\u554f\u984c\uff0c\u53ef\u80fd\u5c0e\u81f4\u5b83\u7121\u6cd5\u5553\u52d5\u3002\u7232\u907f\u514d\u6b64\u554f\u984c\uff0c\u8acb\u5728\u914d\u7f6e\u96c6\u7fa3\u4e0a [\u5553\u7528 Gateway API](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-gateways?hl=zh-cn#enable-gateway) \uff0c\u4e26\u5728\u5553\u7528\u8266\u968a Ingress \u529f\u80fd **\u4e4b\u524d** \u6dfb\u52a0 CRD\u3002\n- \u5728\u4ee5\u4e0b\u60c5\u6cc1\u4e0b\uff0c\u591a\u96c6\u7fa3 Gateway \u53ef\u80fd\u6703\u6cc4\u9732\u8ca0\u8f09\u5747\u8861\u5668\u8cc7\u6e90\uff1a- \u8266\u968a Ingress \u529f\u80fd\u6703\u4f7f\u7528\u65b0\u7684\u914d\u7f6e\u96c6\u7fa3\u9032\u884c\u66f4\u65b0\uff0c\u8a72\u96c6\u7fa3\u4e0d\u5305\u542b\u7576\u524d\u914d\u7f6e\u96c6\u7fa3\u4e0a\u5b58\u5728\u7684\u6240\u6709`Gateway`\u8cc7\u6e90\u3002\n- \u8266\u968a Ingress \u529f\u80fd\u5df2\u505c\u7528\uff0c\u800c\u5f15\u7528\u591a\u96c6\u7fa3`GatewayClass`\u7684`Gateway`\u8cc7\u6e90\u9084\u5728\u914d\u7f6e\u96c6\u7fa3\u4e2d\u3002\n- \u591a\u96c6\u7fa3 Gateway \u4f5c\u7232\u5168\u7403\u670d\u52d9\u904b\u884c\u3002\u5982\u679c\u591a\u96c6\u7fa3 Gateway \u63a7\u5236\u5668\u9047\u5230\u5340\u57df\u6027\u8266\u968a (Hub) \u63a7\u5236\u5e73\u9762\u6545\u969c\uff0c\u5b83\u7684\u97ff\u61c9\u65b9\u5f0f\u662f\u975c\u614b\u5931\u6557\u4e26\u5728\u5340\u57df\u6062\u5fa9\u6b63\u5e38\u670d\u52d9\u4e4b\u524d\u4e0d\u518d\u66f4\u6539\u8ca0\u8f09\u5747\u8861\u5668\u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u5982\u9700\u90e8\u7f72\u591a\u96c6\u7fa3\u8ca0\u8f09\u5747\u8861\uff0c\u8acb\u53c3\u95b1 [\u90e8\u7f72\u591a\u96c6\u7fa3 Gateway](https://cloud.google.com/kubernetes-engine/docs/how-to/deploying-multi-cluster-gateways?hl=zh-cn) \u3002\n- \u5982\u9700\u8a73\u7d30\u77ad\u89e3 Gateway \u63a7\u5236\u5668\uff0c\u8acb\u53c3\u95b1 [Gateway](https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}