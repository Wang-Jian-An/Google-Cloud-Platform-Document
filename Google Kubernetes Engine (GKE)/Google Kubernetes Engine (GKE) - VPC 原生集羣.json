{"title": "Google Kubernetes Engine (GKE) - VPC \u539f\u751f\u96c6\u7fa3", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/alias-ips?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - VPC \u539f\u751f\u96c6\u7fa3\n\u672c\u9801\u9762\u7c21\u8981\u4ecb\u7d39 Google Kubernetes Engine (GKE) \u4e2d\u7684 VPC \u539f\u751f\u96c6\u7fa3\u3002\n", "content": "## \u6982\u89bd\n\u5728 GKE \u4e2d\uff0c\u7cfb\u7d71\u53ef\u4ee5\u6839\u64da\u96c6\u7fa3\u5c07\u6d41\u91cf\u5f9e\u4e00\u500b Pod \u8def\u7531\u5230\u53e6\u4e00\u500b Pod \u7684\u65b9\u5f0f\u4f86\u5340\u5206\u96c6\u7fa3\u3002\n\u4f7f\u7528 [\u5225\u540d IP \u5730\u5740\u7bc4\u570d](https://cloud.google.com/vpc/docs/alias-ip?hl=zh-cn) \u7684\u96c6\u7fa3\u7a31\u7232\u201cVPC \u539f\u751f\u96c6\u7fa3\u201d\u3002\n[\u5728 VPC \u7db2\u7d61\u4e2d\u4f7f\u7528\u81ea\u5b9a\u7fa9\u975c\u614b\u8def\u7531](https://cloud.google.com/vpc/docs/routes?hl=zh-cn) \u7684\u96c6\u7fa3\u7a31\u7232\u201c\u57fa\u65bc\u8def\u7531\u7684\u96c6\u7fa3\u201d\u3002\n\u5c0d\u65bc GKE Autopilot \u96c6\u7fa3\uff0c\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\u6703\u5553\u7528 VPC \u539f\u751f\u6d41\u91cf\u8def\u7531\u3002\n### VPC \u539f\u751f\u96c6\u7fa3\u7684\u512a\u52e2\nVPC \u539f\u751f\u96c6\u7fa3\u5177\u6709\u591a\u7a2e\u512a\u52e2\uff1a\n- [Pod](https://kubernetes.io/docs/concepts/workloads/pods) IP \u5730\u5740\u53ef\u5728\u96c6\u7fa3\u7684 VPC \u7db2\u7d61\u548c\u901a\u904e [VPC \u7db2\u7d61\u5c0d\u7b49\u4e92\u9023](https://cloud.google.com/vpc/docs/vpc-peering?hl=zh-cn) \u8207\u4e4b\u76f8\u9023\u7684\u5176\u4ed6 VPC \u7db2\u7d61\u4e2d\u9032\u884c\u539f\u751f\u8def\u7531\u3002\n- \u5728\u96c6\u7fa3\u4e2d\u5275\u5efa Pod \u4e4b\u524d\uff0cPod IP \u6703\u9810\u7559\u5728 VPC \u7db2\u7d61\u4e2d \u3002\u9019\u53ef\u9632\u6b62\u8207 VPC \u7db2\u7d61\u4e2d\u5176\u4ed6\u8cc7\u6e90\u767c\u751f\u885d\u7a81\uff0c\u8b93\u60a8\u66f4\u597d\u5730\u898f\u5283 IP \u5730\u5740\u5206\u914d\u3002\n- Pod IP \u5730\u5740\u7bc4\u570d\u4e0d\u4f9d\u8cf4\u65bc\u81ea\u5b9a\u7fa9\u975c\u614b\u8def\u7531\u3002\u5b83\u5011\u4e0d\u6703\u6d88\u8017 [\u7cfb\u7d71\u751f\u6210\u7684\u8def\u7531\u914d\u984d\u548c\u81ea\u5b9a\u7fa9\u975c\u614b\u8def\u7531\u914d\u984d](https://cloud.google.com/vpc/docs/quota?hl=zh-cn) \u3002\u81ea\u52d5\u751f\u6210\u7684 [\u5b50\u7db2\u8def\u7531](https://cloud.google.com/vpc/docs/routes?hl=zh-cn#subnet-routes) \u8655\u7406 VPC \u539f\u751f\u96c6\u7fa3\u7684\u8def\u7531\u3002\n- \u60a8\u53ef\u4ee5\u5275\u5efa\u50c5\u61c9\u7528\u65bc Pod IP \u5730\u5740\u7bc4\u570d\u800c\u4e0d\u662f\u96c6\u7fa3\u7bc0\u9ede\u4e0a\u4efb\u4f55 IP \u5730\u5740\u7684 [\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/vpc/docs/firewalls?hl=zh-cn) \u3002\n- \u901a\u5e38\uff0cPod IP \u5730\u5740\u7bc4\u570d\u548c\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u53ef\u4ee5\u901a\u904e [Cloud Router](https://cloud.google.com/network-connectivity/docs/router?hl=zh-cn) \u8207\u9023\u63a5\u5230 Cloud VPN \u6216 Cloud Interconnect \u7684\u672c\u5730\u7db2\u7d61\u8a2a\u554f\u3002\n- \u67d0\u4e9b\u529f\u80fd\uff08\u4f8b\u5982 [\u7db2\u7d61\u7aef\u9ede\u7d44 (NEG)](https://cloud.google.com/load-balancing/docs/negs?hl=zh-cn) \uff09\u50c5\u9069\u7528\u65bc VPC \u539f\u751f\u96c6\u7fa3\u3002## \u9ed8\u8a8d\u96c6\u7fa3\u7db2\u7d61\u6a21\u5f0f\nVPC \u539f\u751f\u662f GKE 1.21.0-gke.1500 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u6240\u6709\u96c6\u7fa3\u7684\u9ed8\u8a8d\u7db2\u7d61\u6a21\u5f0f\u3002\u5c0d\u65bc\u65e9\u671f\u7248\u672c\uff0c\u9ed8\u8a8d\u7684\u96c6\u7fa3\u7db2\u7d61\u6a21\u5f0f\u53d6\u6c7a\u65bc\u96c6\u7fa3\u7684\u5275\u5efa\u65b9\u5f0f\uff1a\n\u4e0b\u8868\u5217\u51fa\u4e86 GKE \u96c6\u7fa3\u7248\u672c\u7684\u9ed8\u8a8d\u96c6\u7fa3\u7db2\u7d61\u6a21\u5f0f\u548c\u96c6\u7fa3\u5275\u5efa\u65b9\u6cd5\u3002\n| GKE \u7248\u672c     | \u96c6\u7fa3\u5275\u5efa\u65b9\u6cd5        | \u96c6\u7fa3\u7db2\u7d61\u6a21\u5f0f |\n|:---------------------------|:------------------------------------------|:---------------|\n| \u6240\u6709\u7248\u672c     | Google Cloud \u63a7\u5236\u6aaf      | VPC \u539f\u751f  |\n| 1.21.0-gke.1500 \u53ca\u66f4\u9ad8\u7248\u672c | Kubernetes Engine API \u6216 Google Cloud CLI | VPC \u539f\u751f  |\n| 1.21.0-gke.1500 \u4e4b\u524d\u7684\u7248\u672c | Kubernetes Engine API \u6216 Google Cloud CLI | \u57fa\u65bc\u8def\u7531  |\n\u60a8\u9084\u53ef\u4ee5\u5728\u5275\u5efa\u96c6\u7fa3\u6642\u6307\u5b9a `--no-enable-ip-alias` \u6a19\u8a8c\u4f86\u5275\u5efa\u57fa\u65bc\u8def\u7531\u7684\u96c6\u7fa3\u3002\n## VPC \u539f\u751f\u96c6\u7fa3\u7684 IP \u5730\u5740\u7bc4\u570d\n\u5275\u5efa VPC \u539f\u751f\u96c6\u7fa3\u6642\uff0c\u60a8\u9700\u8981\u5728 VPC \u7db2\u7d61\u4e2d\u6307\u5b9a\u5b50\u7db2\u3002\u8a72\u96c6\u7fa3\u4f7f\u7528\u4ee5\u4e0b [\u5b50\u7db2 IP \u5730\u5740\u7bc4\u570d](https://cloud.google.com/vpc/docs/subnets?hl=zh-cn#manually_created_subnet_ip_ranges) \uff1a\n**IPv4 \u5730\u5740\u5206\u914d**\nVPC \u539f\u751f\u96c6\u7fa3\u4f7f\u7528\u6307\u5b9a\u5b50\u7db2\u5167\u7684\u4e0d\u540c\u7bc4\u570d\u7232\u7bc0\u9ede\u3001Pod \u548c Service \u5206\u914d IPv4 \u5730\u5740\uff0c\u5982\u4e0b\u6240\u793a\u3002\n- **\u7bc0\u9ede IP \u5730\u5740** \uff1a\u96c6\u7fa3\u5229\u7528\u5b50\u7db2\u7684\u4e3b\u8981 IPv4 \u5730\u5740\u7bc4\u570d\u5c07 IP \u5730\u5740\u5206\u914d\u7d66\u6240\u6709\u7bc0\u9ede\u3002\n- **Pod IP \u5730\u5740** \uff1a\u96c6\u7fa3\u5c07\u5b50\u7db2\u4e2d\u7684\u6b21\u8981 IPv4 \u5730\u5740\u7bc4\u570d\u7528\u65bc\u96c6\u7fa3\u4e2d\u7684\u6240\u6709 Pod IPv4 \u5730\u5740\u3002\u7232\u4e86\u589e\u5f37\u9748\u6d3b\u6027\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u914d\u7f6e [\u4e0d\u9023\u7e8c\u7684\u591a Pod CIDR](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-pod-cidr?hl=zh-cn) \u4f86\u4f7f\u7528\u5176\u4ed6\u5b50\u7db2\u6b21\u8981 IPv4 \u5730\u5740\u7bc4\u570d\u3002\n- **Service IP \u5730\u5740** \uff1a\u96c6\u7fa3\u5c0d\u6240\u6709 Service\uff08\u96c6\u7fa3 IP\uff09\u5730\u5740\u4f7f\u7528\u55ae\u7368\u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u8b93\u591a\u500b\u96c6\u7fa3\u5171\u4eab\u540c\u4e00 Service IPv4 \u7bc4\u570d\uff0c\u8acb\u53c3\u95b1 [\u8de8 GKE \u96c6\u7fa3\u5171\u4eab IP \u5730\u5740\u7bc4\u570d](https://cloud.google.com/kubernetes-engine/docs/concepts/alias-ips?hl=zh-cn#sharing_ip_address) \u3002\n**IPv6 \u5730\u5740\u5206\u914d\uff08\u96d9\u68e7\u7db2\u7d61\uff09**\n- **\u7bc0\u9ede\u548c Pod IPv6 \u5730\u5740** \uff1a\u5728\u5553\u7528\u4e86\u96d9\u68e7\u7db2\u7d61\u7684\u96c6\u7fa3\u4e2d\uff0c\u7bc0\u9ede\u7684 IPv6 \u5730\u5740\u548c\u6240\u6709 Pod IPv6 \u5730\u5740\u90fd\u6e90\u81ea\u7bc0\u9ede\u7684\u6307\u5b9a`/96`IPv6 \u5730\u5740\u7bc4\u570d\u3002\u7bc0\u9ede IP \u5730\u5740\u672c\u8eab\u662f\u6b64\u7bc4\u570d\u5167\u7684\u7b2c\u4e00\u500b`/128`\uff08\u55ae\u500b IPv6 \u5730\u5740\uff09\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u96d9\u68e7\u7db2\u7d61](#dual_stack_network) \u3002\n\u4e0b\u8868\u5f59\u7e3d\u4e86\u7bc0\u9ede\u3001Pod \u548c Service \u7684 IP \u5730\u5740\u7bc4\u570d\uff1a\n| \u7bc4\u570d | \u8aaa\u660e                                                                                             | \u793a\u4f8b                                                                                    |\n|:--------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| \u7bc0\u9ede | \u7bc0\u9ede IP \u5730\u5740\u662f\u5f9e\u8207\u60a8\u7684\u96c6\u7fa3\u95dc\u806f\u7684\u5b50\u7db2\u7684\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u4e2d\u5206\u914d\u7684\u3002 \u7bc0\u9ede IP \u5730\u5740\u548c Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u5927\u5c0f\u90fd\u6703\u9650\u5236\u96c6\u7fa3\u53ef\u652f\u6301\u7684\u7bc0\u9ede\u6578\u91cf\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u7bc0\u9ede\u9650\u5236\u7bc4\u570d\u3002                                                  | \u5982\u679c\u60a8\u6253\u7b97\u5275\u5efa\u4e00\u500b\u5305\u542b 900 \u500b\u7bc0\u9ede\u7684\u96c6\u7fa3\uff0c\u5247\u8a72\u96c6\u7fa3\u7684\u5b50\u7db2\u7684\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u5fc5\u9808\u81f3\u5c11\u7232 /22\uff082(32-22) = 210 = 1024 \u500b\u5730\u5740\uff09\u3002\u5728\u9019 1024 \u500b\u5730\u5740\u4e2d\uff0c\u6709 1020 \u500b\u5730\u5740\u53ef\u7528\uff0c\u56e0\u7232\u6bcf\u500b\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u5167\u9810\u7559\u4e86 4 \u500b IP \u5730\u5740\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u5b50\u7db2\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u548c Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002               |\n| Pod  | Pod IP \u5730\u5740\u53d6\u81ea Pod \u7684\u96c6\u7fa3\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\u9664\u975e\u8a2d\u7f6e\u7684\u6bcf\u500b\u7bc0\u9ede\u7684\u6700\u5927 Pod \u6578\u4e0d\u540c\uff0c\u5426\u5247 GKE \u6703\u91dd\u5c0d\u6bcf\u500b\u7bc0\u9ede\u4e0a\u904b\u884c\u7684 Pod \u5411\u8a72\u7bc0\u9ede\u5206\u914d\u4e00\u500b /24 \u5225\u540d IP \u7bc4\u570d\uff08256 \u500b\u5730\u5740\uff09\u3002\u5728\u6bcf\u500b\u7bc0\u9ede\u4e0a\uff0c\u9019 256 \u500b\u5225\u540d IP \u5730\u5740\u7528\u65bc\u6700\u591a\u652f\u6301 110 \u500b Pod\u3002                                    | \u5c0d\u65bc\u4e00\u500b\u5305\u542b 900 \u500b\u7bc0\u9ede\u3001\u6bcf\u500b\u7bc0\u9ede\u6700\u591a\u652f\u6301 110 \u500b Pod \u7684\u96c6\u7fa3\uff0cPod \u9700\u8981 900 \u00d7 256 = 230400 \u500b IP \u5730\u5740\u3002\uff08\u6bcf\u500b\u7bc0\u9ede\u5206\u914d\u6709\u4e00\u500b\u7db2\u7d61\u63a9\u78bc\u5927\u5c0f\u7232 /24 \u7684\u5225\u540d IP \u7bc4\u570d\u3002\uff09\u6b64\u96c6\u7fa3\u9700\u8981\u4e00\u500b\u5b50\u7db2\uff0c\u5176 Pod \u7684\u6b21\u8981 IP \u7bc4\u570d\u7684\u5b50\u7db2\u63a9\u78bc\u4e0d\u5927\u65bc /14\u3002 \u8a72\u6b21\u8981 IP \u7bc4\u570d\u7232 Pod \u63d0\u4f9b\u4e86 2(32-14) = 218 = 262,144 \u500b IP \u5730\u5740\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002 |\n| Service | Service\uff08\u96c6\u7fa3 IP\uff09\u5730\u5740\u53d6\u81ea Service \u7684\u96c6\u7fa3\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\u60a8\u5fc5\u9808\u78ba\u4fdd\u6b64\u7bc4\u570d\u8db3\u5920\u5927\uff0c\u80fd\u5920\u7232\u60a8\u7684\u96c6\u7fa3\u4e2d\u8a17\u7ba1\u7684\u6240\u6709 Kubernetes Service \u63d0\u4f9b\u5730\u5740\u3002 \u5728\u904b\u884c GKE 1.27 \u7248\u53ca\u66f4\u9ad8\u7248\u672c\u7684\u65b0 Autopilot \u96c6\u7fa3\u4e2d\uff0cGKE \u9ed8\u8a8d\u5f9e Google \u7ba1\u7406\u7684\u7bc4\u570d\u7232 GKE Service \u5206\u914d IP \u5730\u5740\uff1a34.118.224.0/20\u3002 \u9019\u6a23\u60a8\u5c31\u7121\u9700\u7232 Service \u6307\u5b9a\u81ea\u5df1\u7684 IP \u5730\u5740\u7bc4\u570d\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 Service \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002 | \u5c0d\u65bc\u904b\u884c\u6700\u591a 3000 \u500b Service \u7684\u96c6\u7fa3\uff0c\u60a8\u9700\u8981 3000 \u500b\u96c6\u7fa3 IP \u5730\u5740\u3002\u60a8\u9700\u8981\u4e00\u500b\u5927\u5c0f\u7232 /20 \u6216\u66f4\u5927\u7684\u6b21\u8981\u7bc4\u570d\u3002\u5927\u5c0f\u7232 /20 \u7684 IP \u5730\u5740\u7bc4\u570d\u6703\u751f\u6210 2(32-20) = 212 = 4096 \u500b IP \u5730\u5740\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 Service \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002                             |\n### \u5167\u90e8 IP \u5730\u5740\n\u60a8\u7528\u65bc VPC \u539f\u751f\u96c6\u7fa3\u5b50\u7db2\u7684 IP \u5730\u5740\u5fc5\u9808\u4f86\u81ea\u6709\u6548\u5b50\u7db2\u7bc4\u570d\u3002\u6709\u6548\u7bc4\u570d\u5305\u62ec\u5c08\u7528 IP \u5730\u5740\uff08 [RFC 1918](https://tools.ietf.org/html/rfc1918) \u7b49\uff09\u4ee5\u53ca\u4ee5\u4e0d\u516c\u958b\u65b9\u5f0f\u4f7f\u7528\u7684\u516c\u5171 IP \u5730\u5740\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6709\u6548\u5b50\u7db2\u7bc4\u570d\uff0c\u8acb\u53c3\u95b1 VPC \u6587\u6a94\u4e2d\u7684 [\u6709\u6548\u7bc4\u570d](https://cloud.google.com/vpc/docs/subnets?hl=zh-cn#valid-ranges) \u548c [\u53d7\u9650\u7bc4\u570d](https://cloud.google.com/vpc/docs/subnets?hl=zh-cn#restricted-ranges) \u3002\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5553\u7528\u9019\u4e9b\u7bc4\u570d\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528\u975e RFC 1918 \u5c08\u7528 IP \u5730\u5740\u7bc4\u570d](https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=zh-cn#enable_reserved_ip_ranges) \u3002\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u4f7f\u7528\u9019\u4e9b\u7bc4\u570d\uff0c\u8acb\u53c3\u95b1 [\u5553\u7528\u4ee5\u4e0d\u516c\u958b\u65b9\u5f0f\u4f7f\u7528\u7684\u516c\u5171 IP \u5730\u5740\u7bc4\u570d](https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=zh-cn#enable_pupis) \u3002\n### \u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\n\u60a8\u53ef\u4ee5\u5c07 Pod IP \u5730\u5740\u7bc4\u570d\u548c Service ( `ClusterIP` ) \u5730\u5740\u7bc4\u570d\u5206\u914d\u7d66 VPC \u539f\u751f\u96c6\u7fa3\u3002\u9019\u4e9b IP \u5730\u5740\u7bc4\u570d\u53ef\u4ee5\u7531 GKE \u7ba1\u7406\uff0c\u4e5f\u53ef\u4ee5\u7531\u7528\u6236\u7ba1\u7406\u3002\n\u60a8\u5fc5\u9808\u77ad\u89e3\u4ee5\u4e0b\u4e3b\u8981\u8853\u8a9e\uff0c\u624d\u80fd\u77ad\u89e3\u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u3002\n**\u5206\u914d** \uff1a\u5206\u914d IP \u5730\u5740\u7bc4\u570d\u662f\u5c07\u7279\u5b9a\u5b50\u7db2\u7bc4\u570d\u5206\u914d\u7d66 VPC \u539f\u751f\u96c6\u7fa3\u7684\u904e\u7a0b\u3002\u9019\u5c07\u5efa\u7acb\u4e00\u500b IP \u5730\u5740\u6c60\uff0c\u4f9b\u7d44\u4ef6\uff08\u5982 Pod \u548c Service\uff09\u5728\u96c6\u7fa3\u5167\u4f7f\u7528\u3002\n**\u7ba1\u7406** \uff1a\u7ba1\u7406 IP \u5730\u5740\u7bc4\u570d\u662f\u6307\u5728\u96c6\u7fa3\u3001\u7bc0\u9ede\u6c60\u6216 Pod \u7d1a\u5c64\u6b63\u5728\u9032\u884c\u7684\uff08\u5275\u5efa\u3001\u66f4\u65b0\u3001\u522a\u9664\u3001\u8b80\u53d6\uff09CRUD \u64cd\u4f5c\uff0c\u9019\u4e9b\u64cd\u4f5c\u8207 VPC \u539f\u751f\u96c6\u7fa3\u4e2d\u5206\u914d\u7684\u5b50\u7db2\u7bc4\u570d\u548c\u8cc7\u6e90\u5206\u914d\u76f8\u95dc\u3002\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cGKE \u6703\u7232\u60a8\u7684 VPC \u539f\u751f\u96c6\u7fa3\u5206\u914d\u548c\u7ba1\u7406 IP \u5730\u5740\u3002\u5275\u5efa\u96c6\u7fa3\u6642\uff0c\u7121\u9700\u5275\u5efa\u5b50\u7db2\u3002\u60a8\u53ef\u4ee5\u7232 Pod \u548c Service \u5b9a\u7fa9 CIDR \u7bc4\u570d\u6216\u7db2\u7d61\u63a9\u78bc\u5927\u5c0f\u3002GKE \u8655\u7406\u5b50\u7db2\u7bc4\u570d\u7684\u5275\u5efa\u548c\u7ba1\u7406\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u7232 Pod \u6307\u5b9a `10.1.0.0/16` \uff0c\u7232 Service \u6307\u5b9a `10.2.0.0/20` \uff1b\u6216\u8005\u7232 Pod \u6307\u5b9a `/16` \uff0c\u7232 Service \u6307\u5b9a `/20` \u3002\n\u5c0d\u65bc\u904b\u884c GKE 1.27 \u53ca\u66f4\u9ad8\u7248\u672c\u7684 Autopilot \u96c6\u7fa3\uff0cGKE \u9ed8\u8a8d\u5f9e Google \u7ba1\u7406\u7684\u7bc4\u570d `34.118.224.0/20` \u5206\u914d Service IP \u5730\u5740\uff0c\u7121\u9700\u7232 Service \u6307\u5b9a\u81ea\u5df1\u7684\u7bc4\u570d\u3002\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u5e7e\u9ede\uff1a\n- \u60a8\u53ef\u4ee5\u8996\u9700\u8981\u4f7f\u7528`--services-ipv4-cidr`\u6a19\u8a8c\u7232 Service \u6307\u5b9a\u81ea\u5b9a\u7fa9\u7bc4\u570d\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528`--services-ipv4-cidr`\u6a19\u8a8c\u50c5\u6307\u5b9a\u7bc4\u570d\u5927\u5c0f\uff08\u4f8b\u5982`/22`\uff09\uff0cGKE \u4ecd\u6703\u4f7f\u7528 Google \u7ba1\u7406\u7684\u7bc4\u570d\u4f86\u7372\u53d6\u5730\u5740\u7684\u5b50\u7bc4\u570d\u3002\n- \u4f7f\u7528 Google \u7ba1\u7406\u7684\u7bc4\u570d\u6642\uff0cGKE \u4e0d\u6703\u7232 Service \u5275\u5efa\u55ae\u7368\u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\u5982\u9700\u5b8c\u5168\u63a7\u5236 IP \u5730\u5740\u5206\u914d\uff0c\u60a8\u53ef\u4ee5\u624b\u52d5\u7ba1\u7406 VPC \u539f\u751f\u96c6\u7fa3\u7684\u5b50\u7db2\u3002\n\u60a8\u53ef\u4ee5 [\u5275\u5efa\u5b50\u7db2\u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d](https://cloud.google.com/vpc/docs/create-modify-vpc-networks?hl=zh-cn#edit-secondary) \uff0c\u7136\u5f8c\u5275\u5efa\u4f7f\u7528\u9019\u4e9b\u7bc4\u570d\u7684\u96c6\u7fa3\u3002\u5728\u5275\u5efa\u96c6\u7fa3\u671f\u9593\uff0c\u8acb\u6307\u5b9a Pod \u548c Service \u7684\u5b50\u7db2\u7bc4\u570d\u540d\u7a31\u3002\u5982\u679c\u60a8\u624b\u52d5\u5275\u5efa\u6b21\u8981\u7bc4\u570d\uff0c\u5247\u5fc5\u9808\u81ea\u884c\u7ba1\u7406\u5b83\u5011\u3002\n**\u6ce8\u610f\uff1a** \u5982\u679c\u4f7f\u7528\u7528\u6236\u7ba1\u7406\u7684\u7bc4\u570d\uff0c\u8207\u4f7f\u7528 GKE \u7ba1\u7406\u7684\u7bc4\u570d\u76f8\u6bd4\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u66f4\u5c0f\u7684\u5b50\u7db2\u6b21\u8981\u7bc4\u570d\u3002\u5728\u5275\u5efa\u5c0f\u65bc /21 \u7684 Pod \u5730\u5740\u7bc4\u570d\u6642\u8acb\u52d9\u5fc5\u8b39\u614e\uff0c\u56e0\u7232\u96a8\u7740\u96c6\u7fa3\u7684\u589e\u9577\uff0cPod IP \u5730\u5740\u53ef\u80fd\u6703\u7528\u76e1\u3002\n\u5728\u4e0d\u4f7f\u7528 [\u975e\u9023\u7e8c\u6027\u591a Pod CIDR](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-pod-cidr?hl=zh-cn) \u7684\u60c5\u6cc1\u4e0b\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa\u7684\u6700\u5c0f IP \u5730\u5740\u7bc4\u570d\u7232 /28\uff0c\u4f46\u8a72\u7bc4\u570d\u50c5\u5141\u8a31\u5275\u5efa 1 \u500b\u7bc0\u9ede\uff08\u6700\u591a\u5305\u542b 8 \u500b Pod\uff09\u3002\u60a8\u61c9\u8a72\u4f7f\u7528\u8db3\u5920\u5927\u7684\u7bc4\u570d\uff0c\u4ee5\u6eff\u8db3\u60a8\u7684\u6700\u5927\u7bc0\u9ede\u6578\u9700\u6c42\u3002\u6700\u5c0f\u53ef\u7528\u7bc4\u570d\u9084\u53d6\u6c7a\u65bc [\u6bcf\u500b\u7bc0\u9ede\u7684 Pod \u6578\u4e0a\u9650](https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr?hl=zh-cn#configuring_maximum_pods_per_node) \u3002\n\u5982\u9700\u77ad\u89e3\u4e0d\u540c\u7684\u6bcf\u7bc0\u9ede Pod \u6578\u4e0a\u9650\u503c\u5c0d\u61c9\u7684\u6700\u5c0f\u53ef\u7528 CIDR \u7bc4\u570d\uff0c\u8acb\u53c3\u95b1 [\u512a\u5316 IP \u5730\u5740\u5206\u914d](https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr?hl=zh-cn#overview) \u4e2d\u7684\u8868\u683c\u3002\n\u5982\u679c\u60a8\u7528\u76e1 Pod \u7684 IP \u5730\u5740\u7bc4\u570d\uff0c\u5247\u5fc5\u9808\u57f7\u884c\u4ee5\u4e0b\u4efb\u4e00\u64cd\u4f5c\uff1a\n- \u5275\u5efa\u5177\u6709\u66f4\u5927\u7684 Pod \u5730\u5740\u7bc4\u570d\u7684\u65b0\u96c6\u7fa3\u3002\n- \u6e1b\u5c11\u7bc0\u9ede\u6c60\u7684 [--max-pods-per-node](https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr?hl=zh-cn#setting_the_maximum_number_of_pods_in_a_new_node_pool_for_an_existing_cluster) \u5f8c\u91cd\u65b0\u5275\u5efa\u7bc0\u9ede\u6c60\u3002\n- \u4f7f\u7528 [\u975e\u9023\u7e8c\u6027\u591a Pod CIDR](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-pod-cidr?hl=zh-cn) \u64f4\u5c55 Pod \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570dPod \u548c Service (ClusterIP) \u5730\u5740\u7684\u5206\u914d\u65b9\u6848\u4e0d\u540c\u65bc\u57fa\u65bc\u8def\u7531\u7684\u96c6\u7fa3\u4f7f\u7528\u7684\u65b9\u6848\u3002\u60a8\u5fc5\u9808\u5728\u96c6\u7fa3\u7684\u5b50\u7db2\u4e2d\u9078\u64c7\u6216\u5275\u5efa\u5169\u500b\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\uff08\u4e00\u500b\u7528\u65bc Pod\uff0c\u53e6\u4e00\u500b\u7528\u65bc Service\uff09\uff0c\u800c\u4e0d\u662f\u7232 Pod \u548c Service \u5171\u540c\u6307\u5b9a\u4e00\u500b CIDR\u3002\n### \u5171\u4eab VPC \u6ce8\u610f\u4e8b\u9805\n\u5728 [\u5171\u4eab VPC](https://cloud.google.com/vpc/docs/shared-vpc?hl=zh-cn) \u74b0\u5883\u4e2d\u5275\u5efa VPC \u539f\u751f\u96c6\u7fa3\u6642\uff0c\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u7684\u9805\u76ee\u6240\u6709\u8005\u3001\u7de8\u8f2f\u8005\u6216\u5177\u6709 Network Admin \u89d2\u8272\u7684 Identity and Access Management (IAM) \u4e3b\u8cec\u865f\u5fc5\u9808\u624b\u52d5\u5275\u5efa\u96c6\u7fa3\u7684\u5b50\u7db2 IP \u5730\u5740\u7bc4\u570d\u548c\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\u5275\u5efa\u96c6\u7fa3\u7684\u670d\u52d9\u9805\u76ee\u7ba1\u7406\u54e1\u5fc5\u9808\u81f3\u5c11\u64c1\u6709\u5171\u4eab VPC \u7db2\u7d61\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5b50\u7db2\u7684 [\u5b50\u7db2\u7d1a\u6b0a\u9650](https://cloud.google.com/vpc/docs/shared-vpc?hl=zh-cn#svc_proj_admins) \u3002\n\u5728\u5171\u4eab VPC \u74b0\u5883\u4e2d\uff0c\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u7121\u6cd5\u901a\u904e GKE \u7ba1\u7406\u3002\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u7684 Network Admin \u5fc5\u9808\u5148\u5275\u5efa\u5b50\u7db2 IP \u7bc4\u570d\u548c\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\uff0c\u7136\u5f8c\u624d\u80fd\u5275\u5efa\u96c6\u7fa3\u3002\u5982\u9700\u67e5\u770b\u5982\u4f55\u5728\u5171\u4eab VPC \u7db2\u7d61\u4e2d\u8a2d\u7f6e VPC \u539f\u751f\u96c6\u7fa3\u7684\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528\u5171\u4eab VPC \u8a2d\u7f6e\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-shared-vpc?hl=zh-cn) \u3002\n## IP \u5730\u5740\u7bc4\u570d\u898f\u5283\n\u4ee5\u4e0b\u90e8\u5206\u4e2d\u7684\u4fe1\u606f\u53ef\u4ee5\u5e6b\u52a9\u60a8\u8a08\u7b97\u96c6\u7fa3\u6240\u7528\u5b50\u7db2\u7684\u4e3b\u8981\u548c\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u7684\u5927\u5c0f\u3002\n### \u5b50\u7db2\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\n\u6bcf\u500b\u5b50\u7db2\u90fd\u5fc5\u9808\u5177\u6709\u4e00\u500b\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\u9019\u662f GKE \u7528\u65bc\u7232\u5167\u90e8\u8ca0\u8f09\u5747\u8861\u5668\u548c\u7bc0\u9ede\u5206\u914d IP \u5730\u5740\u7684 IP \u5730\u5740\u7bc4\u570d\u3002\n\u5275\u5efa\u5b50\u7db2\u5f8c\uff0c\u60a8\u7121\u6cd5\u518d\u7e2e\u5c0f\u6216\u66f4\u6539\u5b50\u7db2\u7684\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\n\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u7684\u524d\u5169\u500b IP \u5730\u5740\u548c\u6700\u5f8c\u5169\u500b IP \u5730\u5740\u7531 Google Cloud \u9810\u7559\u3002\n\u4e0b\u8868\u986f\u793a\u4e86\u5728\u7279\u5b9a\u7684\u5b50\u7db2\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u5927\u5c0f\u60c5\u6cc1\u4e0b\uff0c\u60a8\u53ef\u4ee5\u5728\u6240\u6709\u4f7f\u7528\u8a72\u5b50\u7db2\u7684\u96c6\u7fa3\u4e2d\u5275\u5efa\u7684\u6700\u5927\u7bc0\u9ede\u6578\u3002\n| \u5b50\u7db2\u4e3b\u8981 IP \u7bc4\u570d        | \u6700\u5927\u7bc0\u9ede\u6578  |\n|:-----------------------------------------------|:----------------|\n| /29 \u5b50\u7db2\u4e3b\u8981 IP \u7bc4\u570d\u7684\u6700\u5c0f\u5927\u5c0f     | 4 \u500b\u7bc0\u9ede  |\n| /28           | 12 \u500b\u7bc0\u9ede  |\n| /27           | 28 \u500b\u7bc0\u9ede  |\n| /26           | 60 \u500b\u7bc0\u9ede  |\n| /25           | 124 \u500b\u7bc0\u9ede  |\n| /24           | 252 \u500b\u7bc0\u9ede  |\n| /23           | 508 \u500b\u7bc0\u9ede  |\n| /22           | 1020 \u500b\u7bc0\u9ede  |\n| /21           | 2044 \u500b\u7bc0\u9ede  |\n| /20 \u81ea\u52d5\u6a21\u5f0f\u7db2\u7d61\u4e2d\u7684\u5b50\u7db2\u4e3b\u8981 IP \u7bc4\u570d\u7684\u9ed8\u8a8d\u5927\u5c0f | 4092 \u500b\u7bc0\u9ede  |\n| /19           | 8188 \u500b\u7bc0\u9ede  |\n| /8 \u5b50\u7db2\u4e3b\u8981 IP \u7bc4\u570d\u7684\u6700\u5927\u5927\u5c0f     | 16777212 \u500b\u7bc0\u9ede |\n\u5982\u679c\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u4e2d\u7684 IP \u5730\u5740\u5df2\u7528\u76e1\uff0c\u60a8\u53ef\u4ee5\u96a8\u6642 [\u64f4\u5c55\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d](https://cloud.google.com/vpc/docs/create-modify-vpc-networks?hl=zh-cn#expand-subnet) \uff0c\u5373\u4f7f Google Cloud \u8cc7\u6e90\uff08\u4f8b\u5982\u8ca0\u8f09\u5747\u8861\u5668\u548c\u7db2\u7d61\u7aef\u9ede\u7d44\uff09\u4f7f\u7528\u8a72\u5b50\u7db2\u4e5f\u662f\u5982\u6b64\u3002\n\u5728\u64f4\u5c55\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u4e4b\u524d\uff0c\u8acb\u8003\u616e\u4ee5\u4e0b\u4e8b\u9805\uff1a\n- \u5b50\u7db2\u4e2d\u4e0d\u5f97\u5b58\u5728\u91cd\u758a\u7684 IP \u5730\u5740\u7bc4\u570d\u3002\n- GKE \u4f7f\u7528\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u7232\u5167\u90e8\u8ca0\u8f09\u5747\u8861\u5668\u548c\u7bc0\u9ede\u5206\u914d IP \u5730\u5740\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u516c\u5f0f\u9032\u884c\u4ee5\u4e0b\u8a08\u7b97\uff1a\n- \u8a08\u7b97\u6307\u5b9a\u7db2\u7d61\u63a9\u78bc\u53ef\u4ee5\u652f\u6301\u7684\u6700\u5927\u7bc0\u9ede\u6578 \u3002\u4f7f\u7528 \u8868\u793a\u7db2\u7d61\u63a9\u78bc\u7684\u5927\u5c0f\uff0c\u5176\u6709\u6548\u7bc4\u570d\u4ecb\u65bc `8` \u548c `29` \u4e4b\u9593\uff08\u542b\u908a\u754c\u503c\uff09\u3002 = 2 - 4\n- \u8a08\u7b97\u652f\u6301\u6700\u591a \u500b\u7bc0\u9ede\u6240\u9700\u7684\u7db2\u7d61\u63a9\u78bc\u5927\u5c0f \uff1a = 32 - \u2308log ( + 4)\u2309`\u2308\u2309` \u662f [ceiling (\u6700\u5c0f\u6574\u6578) \u51fd\u6578](https://en.wikipedia.org/wiki/Floor_and_ceiling_functions) \uff0c\u8868\u793a\u5411\u4e0a\u53d6\u6574\u5230\u4e0b\u4e00\u500b\u6574\u6578\u3002\u7db2\u7d61\u63a9\u78bc\u5927\u5c0f\u7684\u6709\u6548\u7bc4\u570d \u4ecb\u65bc `8` \u548c `29` \u4e4b\u9593\uff08\u542b\u908a\u754c\u503c\uff09\u3002\n### Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\n\u4ed4\u7d30\u898f\u5283 Pod \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\n\u4e0b\u8868\u986f\u793a\u4e86\u5728\u7d66\u5b9a Pod \u4f7f\u7528\u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u5927\u5c0f\u7684\u60c5\u6cc1\u4e0b\uff0c\u60a8\u53ef\u4ee5\u5728\u6240\u6709\u4f7f\u7528\u8a72\u5b50\u7db2\u7684\u96c6\u7fa3\u4e2d\u5275\u5efa\u7684\u6700\u5927\u7bc0\u9ede\u6578\u548c Pod \u6578\u3002\u6b64\u8868\u5047\u5b9a [\u6bcf\u500b\u7bc0\u9ede\u7684 Pod \u6578\u4e0a\u9650](https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr?hl=zh-cn) \u7232 110\uff0c\u9019\u4e5f\u662f\u9ed8\u8a8d\u7684 Pod \u5bc6\u5ea6\u3002\n| Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u7bc4\u570d             | \u6700\u5927 Pod IP \u5730\u5740\u6578 | \u6700\u5927\u7bc0\u9ede\u6578 | \u6700\u5927 Pod \u6578 |\n|:-----------------------------------------------------------------------|:---------------------|:-------------|:---------------|\n| /24 \u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u7531\u7528\u6236\u7ba1\u7406\u6642\u7684\u6700\u5c0f Pod IP \u7bc4\u570d      | 256 \u500b\u5730\u5740   | 1 \u500b\u7bc0\u9ede  | 110 \u500b Pod  |\n| /23 \u50c5\u5728\u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u7531\u7528\u6236\u7ba1\u7406\u6642\u53ef\u7528        | 512 \u500b\u5730\u5740   | 2 \u500b\u7bc0\u9ede  | 220 \u500b Pod  |\n| /22 \u50c5\u5728\u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u7531\u7528\u6236\u7ba1\u7406\u6642\u53ef\u7528        | 1024 \u500b\u5730\u5740   | 4 \u500b\u7bc0\u9ede  | 440 \u500b\u5730\u5740  |\n| /21 \u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u7531 GKE \u7ba1\u7406\u6642\u7684\u6700\u5c0f Pod IP \u7bc4\u570d     | 2048 \u500b\u5730\u5740   | 8 \u500b\u7bc0\u9ede  | 880 \u500b Pod  |\n| /20                 | 4096 \u500b\u5730\u5740   | 16 \u500b\u7bc0\u9ede | 1760 \u500b Pod |\n| /19                 | 8192 \u500b\u5730\u5740   | 32 \u500b\u7bc0\u9ede | 3520 \u500b Pod |\n| /18                 | 16384 \u500b\u5730\u5740   | 64 \u500b\u7bc0\u9ede | 7040 \u500b Pod |\n| /17                 | 32768 \u500b\u5730\u5740   | 128 \u500b\u7bc0\u9ede | 14080 \u500b Pod |\n| /16                 | 65536 \u500b\u5730\u5740   | 256 \u500b\u7bc0\u9ede | 28160 \u500b Pod |\n| /15                 | 131072 \u500b\u5730\u5740  | 512 \u500b\u7bc0\u9ede | 56320 \u500b Pod |\n| /14 \u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u7531 GKE \u7ba1\u7406\u6642\u7528\u65bc Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u7bc4\u570d\u7684\u9ed8\u8a8d\u5927\u5c0f | 262144 \u500b\u5730\u5740  | 1024 \u500b\u7bc0\u9ede | 112640 \u500b Pod |\n| /13                 | 524288 \u500b\u5730\u5740  | 2048 \u500b\u7bc0\u9ede | 225280 \u500b Pod |\n| /12                 | 1048576 \u500b\u5730\u5740  | 4096 \u500b\u7bc0\u9ede | 450560 \u500b Pod |\n| /11                 | 2097152 \u500b\u5730\u5740  | 8192 \u500b\u7bc0\u9ede | 901120 \u500b Pod |\n| /10                 | 4194304 \u500b\u5730\u5740  | 16384 \u500b\u7bc0\u9ede | 1802240 \u500b\u7bc0\u9ede |\n| /9 \u6700\u5927 pod \u5730\u5740\u7bc4\u570d             | 8388608 \u500b\u5730\u5740  | 32768 \u500b\u7bc0\u9ede | 3604480 \u500b\u7bc0\u9ede |\n\u5982\u679c\u60a8\u66f4\u6539\u4e86\u6bcf\u500b\u7bc0\u9ede\u7684 [\u6700\u5927 Pod \u6578](https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr?hl=zh-cn) \uff0c\u5247\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u516c\u5f0f\u8a08\u7b97\u5b50\u7db2\u7684 Pod \u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u53ef\u4ee5\u652f\u6301\u7684\u6700\u5927\u7bc0\u9ede\u6578\u548c Pod \u6578\uff1a\n- \u8a08\u7b97\u6bcf\u500b\u7bc0\u9ede Pod \u7bc4\u570d\u7684\u7db2\u7d61\u63a9\u78bc\u5927\u5c0f \u3002 `` `` `= 31 - \u2308log` `` `(` `` `)\u2309` \u5176\u4e2d\uff1a- \u662f\u6bcf\u500b\u7bc0\u9ede\u7684 Pod \u6578\n- `\u2308\u2309`\u662f ceiling (\u6700\u5c0f\u6574\u6578) \u51fd\u6578\uff0c\u8868\u793a\u5411\u4e0a\u53d6\u6574\u5230\u4e0b\u4e00\u500b\u6574\u6578\n- \u4f8b\u5982\uff0c\u5982\u679c\u7232 110\uff0c\u5247`` `` `= 24`\n- \u8a08\u7b97\u7528\u65bc Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u53ef\u652f\u6301\u7684\u6700\u5927\u7bc0\u9ede\u6578 \uff1a `` `` `= 2` `` `` \u5176\u4e2d\uff1a- \u662f\u7b2c\u4e00\u6b65\u4e2d\u8a08\u7b97\u5f97\u51fa\u7684\u7528\u65bc Pod \u7684\u6bcf\u500b\u7bc0\u9ede\u5225\u540d IP \u5730\u5740\u7bc4\u570d\u7684\u7db2\u7d61\u63a9\u78bc\u5927\u5c0f\n- \u662f\u5b50\u7db2\u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u7684\u5b50\u7db2\u63a9\u78bc\u5927\u5c0f\n- \u4f8b\u5982\uff0c\u5982\u679c\u7232 24\uff0c\u7232 20\uff0c\u5247`` `` `= 16`\n- \u8a08\u7b97\u7528\u65bc Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u53ef\u652f\u6301\u7684\u6700\u5927 Pod \u6578 \uff1a `` `` `=` `` `\u00d7` `` `` \u5176\u4e2d\uff1a- \u662f\u5728\u4e0a\u4e00\u6b65\u8a08\u7b97\u5f97\u51fa\u7684\u6700\u5927\u7bc0\u9ede\u6578\n- \u662f\u6bcf\u500b\u7bc0\u9ede\u7684 Pod \u6578\n- \u4f8b\u5982\uff0c\u5982\u679c\u7232 16\uff0c\u7232 110\uff0c\u5247`` `` `= 1760`\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u4e0d\u9023\u7e8c\u7684\u591a Pod CIDR](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-pod-cidr?hl=zh-cn) \u7232 Pod \u6dfb\u52a0\u66f4\u591a IP \u5730\u5740\u3002\n### Service \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\n\u4ed4\u7d30\u898f\u5283 Service \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\u7531\u65bc\u9019\u4e5f\u662f\u4e00\u500b\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\uff0c\u56e0\u6b64\u4e00\u65e6\u5275\u5efa\u96c6\u7fa3\uff0c\u6b64\u7bc4\u570d\u4fbf\u7121\u6cd5\u66f4\u6539\u3002\n\u5982\u679c\u60a8\u4f7f\u7528 [\u591a\u96c6\u7fa3\u670d\u52d9](https://cloud.google.com/kubernetes-engine/docs/concepts/multi-cluster-services?hl=zh-cn) \uff0c\u5247 `ServiceImport` \u5c0d\u8c61\u6703\u4f7f\u7528 Service \u7684\u6b21\u8981 IP \u7bc4\u570d\u5167\u7684 IP \u5730\u5740\u3002\n\u5728\u904b\u884c GKE 1.27 \u7248\u53ca\u66f4\u9ad8\u7248\u672c\u7684\u65b0 Autopilot \u96c6\u7fa3\u4e2d\uff0cGKE \u9ed8\u8a8d\u5f9e Google \u7ba1\u7406\u7684\u7bc4\u570d\u7232 Service \u5206\u914d IP \u5730\u5740\uff1a `34.118.224.0/20` \u3002\u9019\u6a23\u60a8\u5c31\u7121\u9700\u7232 Service \u6307\u5b9a\u81ea\u5df1\u7684 IP \u5730\u5740\u7bc4\u570d\u3002\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u5e7e\u9ede\uff1a\n- \u60a8\u53ef\u4ee5\u8996\u9700\u8981\u4f7f\u7528`--services-ipv4-cidr`\u6a19\u8a8c\u6216`--services-secondary-range-name`\u6a19\u8a8c\u7232 Service \u6307\u5b9a\u81ea\u5b9a\u7fa9\u7bc4\u570d\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528`--services-ipv4-cidr`\u6a19\u8a8c\u50c5\u6307\u5b9a\u7bc4\u570d\u5927\u5c0f\uff08\u4f8b\u5982`/22`\uff09\uff0cGKE \u4ecd\u6703\u4f7f\u7528 Google \u7ba1\u7406\u7684\u7bc4\u570d\u4f86\u7372\u53d6\u5730\u5740\u7684\u5b50\u7bc4\u570d\u3002\n- \u4f7f\u7528 Google \u7ba1\u7406\u7684\u7bc4\u570d\u6642\uff0cGKE \u4e0d\u6703\u7232 Service \u5275\u5efa\u55ae\u7368\u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002Google \u7ba1\u7406\u7684\u7bc4\u570d\u4e0d\u6703\u7232\u5b50\u7db2\u4f7f\u7528\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u914d\u984d\u3002\n\u4e0b\u8868\u986f\u793a\u4e86\u5728\u7d66\u5b9a\u4e86 Service \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u5927\u5c0f\u7684\u60c5\u6cc1\u4e0b\uff0c\u60a8\u53ef\u4ee5\u5728\u4f7f\u7528\u8a72\u5b50\u7db2\u7684\u55ae\u500b\u96c6\u7fa3\u4e2d\u5275\u5efa\u7684\u6700\u5927 Service \u6578\u3002\n| Service \u7684\u6b21\u8981 IP \u7bc4\u570d              | \u6700\u5927 Service \u6578 |\n|:---------------------------------------------------------------------------|:------------------|\n| /28 \u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u7531\u7528\u6236\u7ba1\u7406\u6642\u7684\u6700\u5c0f Service \u5730\u5740\u7bc4\u570d     | 16 \u500b Service  |\n| /27 \u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u7531 GKE \u7ba1\u7406\u6642\u7684\u6700\u5c0f Service \u5730\u5740\u7bc4\u570d     | 32 \u500b Service  |\n| /26                  | 64 \u500b Service  |\n| /25                  | 128 \u500b Service |\n| /24                  | 256 \u500b Service |\n| /23                  | 512 \u500b Service |\n| /22                  | 1024 \u500b Service |\n| /21                  | 2048 \u500b Service |\n| /20 \u6b21\u8981\u7bc4\u570d\u5206\u914d\u65b9\u6cd5\u7531 GKE \u7ba1\u7406\u6642\u7528\u65bc Service \u7684\u5b50\u7db2\u6b21\u8981 IP \u7bc4\u570d\u7684\u9ed8\u8a8d\u5927\u5c0f | 4096 \u500b Service |\n| /19                  | 8192 \u500b Service |\n| /18                  | 16384 \u500b Service |\n| /17                  | 32768 \u500b Service |\n| /16 \u6700\u5927 Service \u5730\u5740\u7bc4\u570d             | 65536 \u500b Service |\n## \u8de8 GKE \u96c6\u7fa3\u5171\u4eab IP \u5730\u5740\u7bc4\u570d\n\u60a8\u53ef\u4ee5\u5728\u540c\u4e00\u5b50\u7db2\u4e2d\u7684\u96c6\u7fa3\u4e4b\u9593\u5171\u4eab\u4e3b\u8981\u7bc4\u570d\u3001Pod \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u4ee5\u53ca Service \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\n\u5982\u679c\u60a8\u6709\u96c6\u4e2d\u7ba1\u7406\u96c6\u7fa3\u57fa\u790e\u67b6\u69cb\u7684\u5718\u968a\uff0c\u5247\u53ef\u80fd\u9700\u8981\u5171\u4eab IP \u5730\u5740\u7bc4\u570d\u3002\u60a8\u53ef\u4ee5\u7232 Pod\u3001Service \u548c\u7bc0\u9ede\u5275\u5efa\u4e09\u500b\u7bc4\u570d\uff0c\u4e26\u91cd\u5fa9\u4f7f\u7528\u6216\u5171\u4eab\u9019\u4e9b\u7bc4\u570d\uff08\u5c24\u5176\u662f\u5728\u5171\u4eab VPC \u6a21\u578b\u4e2d\uff09\uff0c\u5f9e\u800c\u6e1b\u5c11\u958b\u92b7\u3002\u9019\u6a23\u7531\u65bc\u4e0d\u9700\u8981\u7db2\u7d61\u7ba1\u7406\u54e1\u7232\u6bcf\u500b\u96c6\u7fa3\u5275\u5efa\u7279\u5b9a\u5b50\u7db2\uff0c\u56e0\u800c\u80fd\u5920\u66f4\u8f15\u9b06\u5730\u7ba1\u7406 IP \u5730\u5740\u3002\n### \u5171\u4eab\u7bc0\u9ede\u7684\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\n\u5982\u679c\u60a8\u5728\u5b50\u7db2\u4e2d\u5275\u5efa\u591a\u500b\u96c6\u7fa3\uff0c\u5247\u7cfb\u7d71\u9ed8\u8a8d\u6703\u5171\u4eab\u7bc0\u9ede\u7684\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\n\u5171\u4eab\u7bc0\u9ede\u7684\u4e3b\u8981 IP \u5730\u5740\u6642\u5177\u6709\u4ee5\u4e0b\u9650\u5236\uff1a\n- \u5982\u679c\u60a8\u5c0d\u5169\u500b\u6216\u66f4\u591a VPC \u539f\u751f\u96c6\u7fa3\u5171\u4eab\u7bc0\u9ede\u7684\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\uff0c\u5247\u4e00\u500b\u96c6\u7fa3\u53ef\u80fd\u6703\u4f7f\u7528\u5927\u90e8\u5206\u5171\u4eab\u7684 Pod IP \u5730\u5740\u7bc4\u570d\uff0c\u8b93\u6c92\u6709\u8db3\u5920 IP \u5730\u5740\u7684\u5176\u4ed6\u96c6\u7fa3\u9032\u884c\u64f4\u5c55\u3002\n### \u5171\u4eab Pod \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\n\u7576\u60a8\u5171\u4eab Pod \u7684\u6b21\u8981\u7bc4\u570d\u6642\uff0c\u6bcf\u500b Pod \u4ecd\u6703\u7372\u5f97\u552f\u4e00\u7684 IP \u5730\u5740\u3002\n**\u6ce8\u610f** \uff1a\u5728\u4e0d\u540c\u985e\u578b\u7684\u6b21\u8981\u7bc4\u570d\u4e2d\uff0c\u5176\u4ed6 Pod \u7bc4\u570d\u4e0d\u80fd\u8de8\u96c6\u7fa3\u5171\u4eab\u3002\n\u5171\u4eab Pod \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u6642\u5177\u6709\u4ee5\u4e0b\u9650\u5236\uff1a\n- \u5982\u679c\u60a8\u5c0d\u5169\u500b\u6216\u66f4\u591a VPC \u539f\u751f\u96c6\u7fa3\u5171\u4eab Pod \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\uff0c\u5247\u4e00\u500b\u96c6\u7fa3\u53ef\u80fd\u6703\u4f7f\u7528\u5927\u90e8\u5206\u5171\u4eab\u7684 IP \u5730\u5740\u7bc4\u570d\uff0c\u8b93\u6c92\u6709\u8db3\u5920 IP \u5730\u5740\u7684\u5176\u4ed6\u96c6\u7fa3\u9032\u884c\u64f4\u5c55\u3002\n- \u5728\u4e0d\u540c\u985e\u578b\u7684\u6b21\u8981\u7bc4\u570d\u4e2d\uff0c [GKE \u7ba1\u7406\u7684](https://cloud.google.com/kubernetes-engine/docs/concepts/alias-ips?hl=zh-cn#managed_by_default) \u548c [\u5176\u4ed6 Pod \u7bc4\u570d](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-pod-cidr?hl=zh-cn#add_more_pod_ipv4_ranges_for_specific_use_cases) \u4e0d\u80fd\u8de8\u96c6\u7fa3\u5171\u4eab\u3002\n- \u5982\u9700\u5171\u4eab\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\uff0c\u8acb\u5728\u547d\u4ee4\u884c\u4e2d\u5c07\u5176\u8207 `--cluster-secondary-range` \u4e00\u8d77\u50b3\u905e\u3002\u5728\u754c\u9762\u4e2d\u5275\u5efa\u96c6\u7fa3\u6642\uff0c\u60a8\u7121\u6cd5\u4f7f\u7528\u5171\u4eab\u7684\u6b21\u8981\u7bc4\u570d\u3002\n### \u5171\u4eab Service \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\n\u4f7f\u7528 [\u7528\u6236\u7ba1\u7406\u7684](#user-managed) \u6b21\u8981\u7bc4\u570d\u6642\uff0c\u5169\u500b\u6216\u66f4\u591a\u96c6\u7fa3\u53ef\u4ee5\u540c\u6642\u5c07\u76f8\u540c\u7684\u5b50\u7db2\u6b21\u8981 IPv4 \u5730\u5740\u7bc4\u570d\u7528\u65bc Service\u3002\n\u5982\u9700\u5c07\u5169\u500b\u6216\u66f4\u591a\u96c6\u7fa3\u914d\u7f6e\u7232\u5171\u4eab Service \u7684\u5171\u7528\u5b50\u7db2\u6b21\u8981 IPv4 \u5730\u5740\u7bc4\u570d\uff0c\u8acb\u5728\u5275\u5efa\u6bcf\u500b\u96c6\u7fa3\u6642\u4f7f\u7528\u76f8\u540c\u7684\u5b50\u7db2\u6b21\u8981 IPv4 \u5730\u5740\u7bc4\u570d\u3002\u5171\u4eab Service \u7684\u5171\u7528 IPv4 \u5730\u5740\u7bc4\u570d\u6642\u4e0d\u9700\u8981\u55ae\u7368\u7684\u914d\u7f6e\u6a19\u8a8c\u3002\n\u5171\u4eab Service \u7684\u5171\u7528 IPv4 \u5730\u5740\u7bc4\u570d\u6642\uff0c\u6bcf\u500b\u96c6\u7fa3\u90fd\u6703\u5728\u5167\u90e8\u4f7f\u7528 Service \u7684\u6574\u500b\u5b50\u7db2\u6b21\u8981 IPv4 \u5730\u5740\u7bc4\u570d\u3002Service \u7684 IP \u5730\u5740\u5728\u6bcf\u500b\u96c6\u7fa3\u7684\u7bc0\u9ede\u5167\u9032\u884c\u7de8\u7a0b\uff0c\u4f46\u5b83\u5011\u4e0d\u6703\u5206\u914d\u7d66\u4efb\u4f55\u7bc0\u9ede\u7684\u7db2\u7d61\u63a5\u53e3\u3002Service \u7684 IP \u5730\u5740\u5728\u96c6\u7fa3\u7684 VPC \u7db2\u7d61\u4e2d\u7121\u6cd5\u8def\u7531\u3002Service \u7684 IP \u5730\u5740\u50c5\u4f9b\u8207 Service \u4f4d\u65bc\u540c\u4e00\u96c6\u7fa3\u4e2d\u7684\u5ba2\u6236\u7aef Pod \u4f7f\u7528\u3002\n\u7576 Pod \u5c07\u6578\u64da\u5305\u767c\u9001\u5230 Service IP \u5730\u5740\u6642\uff0c\u7bc0\u9ede\u4e0a\u7684 iptables \u6216 eBPF \u914d\u7f6e\u6703\u57f7\u884c\u76ee\u6a19\u7db2\u7d61\u5730\u5740\u8f49\u63db (NAT)\uff0c\u5c07\u6578\u64da\u5305\u7684\u76ee\u6a19 IP \u5730\u5740\u5f9e Service IP \u5730\u5740\u66f4\u6539\u7232\u670d\u52d9 Pod IP \u5730\u5740\u3002\u6578\u64da\u5305\u6839\u64da\u76ee\u6a19 Pod IP \u5730\u5740\u9032\u884c\u8def\u7531\u3002\n\u5171\u4eab Service \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u5177\u6709\u4ee5\u4e0b\u512a\u52e2\uff1a\n- \u6e1b\u5c11\u5728\u5b50\u7db2\u4e0a\u7232 Service \u5275\u5efa\u7684\u552f\u4e00\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u7684\u6578\u91cf\n- \u4f7f\u7528\u8f03\u5c11\u7684 IP \u5730\u5740\n\u5171\u4eab Service \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u6642\u5177\u6709\u4ee5\u4e0b\u9650\u5236\uff1a\n- [VPC \u7bc4\u570d\u5167\u7684 Cloud DNS for GKE](https://cloud.google.com/kubernetes-engine/docs/how-to/cloud-dns?hl=zh-cn#vpc_scope_dns) \u4e0d\u652f\u6301\u5171\u4eab Service \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u3002\n- \u60a8\u7121\u6cd5\u5171\u4eab\u8207\u4ee5\u4e0b\u6b63\u5247\u8868\u9054\u5f0f\u5339\u914d\u7684\u7bc4\u570d\uff1a```\n^gke-.*-services-[abcdef0-9]{8}\n```\n- \u5982\u9700\u5171\u4eab\u670d\u52d9\u7684\u6b21\u8981 IP \u7bc4\u570d\uff0c\u8acb\u5728\u547d\u4ee4\u884c\u4e2d\u901a\u904e `--cluster-secondary-range` \u50b3\u905e\u3002\u5728\u754c\u9762\u4e2d\u5275\u5efa\u96c6\u7fa3\u6642\uff0c\u60a8\u7121\u6cd5\u4f7f\u7528\u670d\u52d9\u7684\u5171\u4eab\u6b21\u8981\u7bc4\u570d\u3002\n### \u7bc0\u9ede\u9650\u5236\u7bc4\u570d\n\u6307\u5b9a GKE \u96c6\u7fa3\u7684\u6700\u5927 Pod \u6578\u548c\u6700\u5927 Service \u6578\u53d7\u96c6\u7fa3\u6b21\u8981\u7bc4\u570d\u7684\u9650\u5236\u3002\u96c6\u7fa3\u4e2d\u7bc0\u9ede\u7684\u6700\u5927\u6578\u91cf\u53d7\u96c6\u7fa3\u5b50\u7db2\u7684\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u5927\u5c0f\u548c\u96c6\u7fa3\u7684 Pod \u5730\u5740\u7bc4\u570d\u5927\u5c0f\u7684\u9650\u5236 \u3002\n\u4ee5\u4e0b\u932f\u8aa4\u6d88\u606f\u6307\u793a\u5b50\u7db2\u7684\u4e3b\u8981 IP \u5730\u5740\u7bc4\u570d\u6216\u96c6\u7fa3\u7684 Pod IP \u5730\u5740\u7bc4\u570d\uff08\u7528\u65bc Pod \u7684\u5b50\u7db2\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\uff09\u5df2\u7528\u76e1\uff1a\n```\nInstance [node name] creation failed: IP space of [cluster subnet] is\nexhausted\n```\n\u60a8\u53ef\u4ee5\u901a\u904e [\u64f4\u5c55\u4e3b\u8981\u5b50\u7db2](https://cloud.google.com/vpc/docs/create-modify-vpc-networks?hl=zh-cn#expand-subnet) \u7232\u7bc0\u9ede\u6dfb\u52a0\u66f4\u591a IP \u5730\u5740\uff0c\u6216\u4f7f\u7528 [\u4e0d\u9023\u7e8c\u7684\u591a Pod CIDR](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-pod-cidr?hl=zh-cn) \u7232 Pod \u6dfb\u52a0\u65b0\u7684 IP \u5730\u5740\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Pod \u6c92\u6709\u8db3\u5920\u7684\u53ef\u7528 IP \u5730\u5740\u7a7a\u9593](https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=zh-cn#not_enough_space) \u3002\n## IPv4/IPv6 \u96d9\u68e7\u7db2\u7d61\n\u901a\u904e IPv4/IPv6 \u96d9\u68e7\u7db2\u7d61\uff0c\u60a8\u53ef\u4ee5\u5b9a\u7fa9 GKE \u5982\u4f55\u5c07 IP \u5730\u5740 ( `ipFamilies` ) \u5206\u914d\u7d66\u4ee5\u4e0b\u5c0d\u8c61\uff1a\n- \u5c0d\u65bc Pod \u548c\u7bc0\u9ede\uff0cGKE \u6703\u540c\u6642\u5206\u914d IPv4 \u548c IPv6 \u5730\u5740\u3002\n- \u5c0d\u65bc Service\uff0cGKE \u6703\u5206\u914d\u55ae\u68e7\uff08\u50c5 IPv4 \u6216\u50c5 IPv6\uff09\u6216\u96d9\u68e7\u5730\u5740\u3002\n\u5728 GKE 1.24 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u60a8\u53ef\u4ee5\u7232\u7368\u7acb\u548c\u5171\u4eab VPC \u7db2\u7d61\u4e0a\u7684\u65b0 GKE \u96c6\u7fa3\u5553\u7528\u96d9\u68e7\u7db2\u7d61\u3002\u60a8\u9084\u53ef\u4ee5\u61c9\u7528\u5553\u7528\u4e86\u96d9\u68e7\u7db2\u7d61\u7684\u7db2\u7d61\u653f\u7b56\u3002\n### \u512a\u52e2\n\u96d9\u68e7\u7db2\u7d61\u5177\u6709\u4ee5\u4e0b\u512a\u9ede\uff1a\n- \u5553\u7528\u7aef\u5230\u7aef IPv6 \u901a\u4fe1\u3002\n- \u8207\u7db2\u7d61\u5730\u5740\u8f49\u63db (NAT) \u6216 IP \u96a7\u9053\u76f8\u6bd4\uff0c\u6027\u80fd\u66f4\u4f73\u3002\u9019\u662f\u56e0\u7232\u6c92\u6709 IPv6 \u5230 IPv4 \u7684\u8f49\u63db\u3002\n### \u53ef\u7528\u60c5\u6cc1\n\u5728 GKE \u4e2d\u4f7f\u7528\u96d9\u68e7\u7db2\u7d61\u5177\u6709\u4ee5\u4e0b\u9650\u5236\uff1a\n- \u96d9\u68e7\u7db2\u7d61\u50c5\u9069\u7528\u65bc\u5553\u7528\u4e86 [GKE Dataplane V2](https://cloud.google.com/kubernetes-engine/docs/how-to/dataplane-v2?hl=zh-cn) \u7684 [VPC \u539f\u751f\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=zh-cn) \u3002\n- \u96d9\u68e7\u7db2\u7d61\u50c5\u652f\u6301\u81ea\u5b9a\u7fa9\u6a21\u5f0f VPC \u4e2d\u7684\u5b50\u7db2\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Google Cloud \u4e2d\u7684 VPC \u7db2\u7d61\u985e\u578b](https://cloud.google.com/vpc/docs/vpc?hl=zh-cn#subnet-ranges) \u3002\n- Pod \u6216\u7bc0\u9ede\u4e0d\u652f\u6301\u55ae\u68e7 IPv6 \u5730\u5740\u3002\n- \u8207\u50c5\u652f\u6301 IPv4 \u7684\u96c6\u7fa3\u76f8\u6bd4\uff0c\u96d9\u68e7\u96c6\u7fa3\u9700\u8981\u5728\u6bcf\u500b\u7bc0\u9ede\u4f54\u7528\u984d\u5916\u7684\u5167\u5b58\u4f86\u652f\u6301 IPv4 \u548c IPv6\u3002\u5728\u8a2d\u7f6e\u5927\u898f\u6a21\u96c6\u7fa3\u6642\uff0c\u8acb\u8003\u616e\u6b64\u7279\u6027\u3002\n- \u96d9\u68e7\u96c6\u7fa3\u4e0d\u652f\u6301\u57fa\u65bc IPv6 \u7684\u5c08\u7528 Google \u8a2a\u554f\u901a\u9053\u3002\n- GKE 1.26.0-gke.2200 \u53ca\u66f4\u9ad8\u7248\u672c\u652f\u6301\u4f7f\u7528 Cloud DNS \u9032\u884c\u96c6\u7fa3\u5167\u90e8\u64cd\u4f5c\u548c\u5916\u90e8 DNS \u67e5\u8a62\u7684 IPv6\uff08AAAA \u8a18\u9304\uff09\u3002\n- `ClusterIP`\u3001`NodePort`\u548c`LoadBalancer`Service \u652f\u6301\u96d9\u68e7 Service\u3002\n- Windows \u7bc0\u9ede\u4e0d\u652f\u6301 IPv6\u3002\n\u5728\u5275\u5efa\u5177\u6709\u96d9\u68e7\u7db2\u7d61\u7684\u96c6\u7fa3\u4e4b\u524d\uff0c\u8acb\u8003\u616e\u4e0a\u8ff0\u9650\u5236\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5982\u4f55\u5275\u5efa\u5177\u6709\u96d9\u68e7\u7db2\u7d61\u7684 VPC \u539f\u751f\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=zh-cn#dual-stack) \u3002\n### \u516c\u5171\u548c\u5c08\u7528 IPv6 \u5730\u5740\u5206\u914d\n\u4e0b\u8868\u7e3d\u7d50\u4e86\u5177\u6709\u96d9\u68e7\u7db2\u7d61\u884c\u7232\u7684\u516c\u5171\u548c\u5c08\u7528 IPv6 \u5730\u5740\u53ca\u5176\u914d\u7f6e\uff1a\n| ipv6-access-type \u6a19\u8a8c | IP \u5730\u5740\u5206\u914d                                 | \u5b50\u7db2\u7bc4\u570d            |\n|:------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------|\n| EXTERNAL    | GKE \u6703\u5206\u914d\u53ef\u8def\u7531\u5230\u4e92\u806f\u7db2\u7684\u5916\u90e8 IPv6 \u5730\u5740\u3002                         | 2600:1900/28\u8d77           |\n| INTERNAL    | GKE \u6703\u5206\u914d\u7121\u6cd5\u8def\u7531\u5230\u4e92\u806f\u7db2\u7684\u5167\u90e8 IPv6 \u5730\u5740\u3002 \u5177\u6709 INTERNAL IPv6 \u8a2a\u554f\u6b0a\u9650\u985e\u578b\u7684\u96c6\u7fa3\u7121\u6cd5\u901a\u904e IPv6 \u5730\u5740\u8a2a\u554f\u4e92\u806f\u7db2\u3002Cloud NAT \u4e0d\u652f\u6301 IPv6 \u5730\u5740\u3002 | \u4f86\u81ea fd20::/20\uff08\u5b83\u662f\u6574\u500b ULA \u7bc4\u570d\u7684\u4e00\u90e8\u5206\uff1afc00::/7\uff09\u3002 |\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5982\u4f55\u5c07\u96d9\u68e7\u7db2\u7d61\u7528\u65bc VPC \u539f\u751f\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=zh-cn#dual-stack) \u3002\n### \u67b6\u69cb\n\u4f7f\u7528 IPv4/IPv6 \u96d9\u68e7\u7db2\u7d61\u7684\u96c6\u7fa3\u5206\u914d\u4e86\u4ee5\u4e0b\u7bc4\u570d\uff1a\n- \u5c07 /64 \u7bc4\u570d\u5206\u914d\u7d66\u6bcf\u500b\u5b50\u7db2\u4f5c\u7232\u4e3b\u8981\u7bc4\u570d\u3002\n- \u5f9e\u4e3b\u8981\u7bc4\u570d\u5167\u5206\u914d\u4e00\u500b /96 \u6bcf\u7bc0\u9ede\u7bc4\u570d\uff0c\u7528\u4f5c\u4e3b\u7bc0\u9ede IP \u5730\u5740\u7bc4\u570d\u3002\n- \u5f9e\u4e3b\u7bc0\u9ede IP \u5730\u5740\u7bc4\u570d\u4e2d\u5206\u914d\u4e00\u500b /112 \u6bcf\u7bc0\u9ede\u7bc4\u570d\uff0c\u7528\u4f5c\u8a72\u7bc0\u9ede\u7684 Pod IP \u5730\u5740\u7bc4\u570d\u3002\u901a\u904e\u96d9\u68e7\u7db2\u7d61\uff0cPod \u6703\u5f9e \u7372\u53d6\u5176 IPv6 \u5730\u5740\uff08\u985e\u4f3c\u65bc\u7bc0\u9ede\uff09\uff0c\u800c\u4e0d\u662f\u5f9e\u9810\u7559\u7d66 IPv4 \u5730\u5740\u7684 Pod \u6b21\u8981\u7bc4\u570d\u4e2d\u7372\u53d6\u3002\u6574\u9ad4 Pod IP \u5730\u5740\u7bc4\u570d\u7531\u4e3b\u7bc0\u9ede IP \u7bc4\u570d\u5167\u7684\u975e\u91cd\u758a\u7bc4\u570d\u7d44\u6210\u3002\u56e0\u6b64\uff0c\u6b64 Pod IP \u5730\u5740\u7bc4\u570d\u662f\u4e0d\u9023\u7e8c\u7684\u3002\n- \u7528\u65bc Service \u7684 /112 \u7bc4\u570d\u3002\u6b64\u7bc4\u570d\u4f86\u81ea\u7232 GKE \u7684\u6b21\u8981 Service IP \u5730\u5740\u7bc4\u570d\u9810\u7559\u7684 Google \u5c08\u7528\u5730\u5740\u7bc4\u570d\u5167\u7684 /64 \u7bc4\u570d\u3002\n\u4e0b\u5716\u5c55\u793a\u4e86 Google Cloud \u548c GKE \u5982\u4f55\u5206\u914d IPv6 \u5730\u5740\uff1a\n\u5728\u8a72\u5716\u4e2d\uff0cVPC \u5b50\u7db2\u7684\u4e3b\u8981\u7bc4\u570d\u7232 `2600:1900:0:1::/64` \uff0c\u800c GKE Service \u7684\u9810\u7559\u7bc4\u570d\u7232 `2600:2D00:0:4::0:0/64` \u3002\u96c6\u7fa3\u4e2d\u7684\u6bcf\u500b\u7bc0\u9ede\u90fd\u6709\u4e00\u500b /96 \u7bc4\u570d\uff08\u4e3b\u7bc0\u9ede IP \u5730\u5740\u7bc4\u570d\uff09\u548c\u4e00\u500b /112 \u7bc4\u570d\uff08Pod IP \u5730\u5740\u7bc4\u570d\uff09\u3002\u6b64\u5916\uff0c\u96c6\u7fa3\u9084\u5177\u6709\u4e00\u500b /112 \u6b21\u8981 Service IP \u5730\u5740\u7bc4\u570d\u3002\n**\u6ce8\u610f** \uff1aGKE \u6703\u81ea\u52d5\u7232 Pod IP \u5730\u5740\u7bc4\u570d\u548c\u6b21\u8981 Service IP \u5730\u5740\u7bc4\u570d\u9078\u64c7 IPv6 \u985e\u578b\u7684 IP \u5730\u5740\u7bc4\u570d\u3002\n### Service\n\u60a8\u53ef\u4ee5\u5275\u5efa [ClusterIP](https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=zh-cn#services_of_type_clusterip) \u3001 [NodePort](https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=zh-cn#service_of_type_nodeport) \u6216 [LoadBalancer](https://cloud.google.com/kubernetes-engine/docs/concepts/service-load-balancer?hl=zh-cn) \u985e\u578b\u7684 IPv6 Service\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `ClusterIP` \u3001 `NodePort` \u6216 `LoadBalancer` \u985e\u578b\u7684 Service \u516c\u958b Deployment\u3002\u5c0d\u65bc\u6bcf\u7a2e Service \u985e\u578b\uff0c\u60a8\u53ef\u4ee5\u5c07 `ipFamilies` \u548c `ipFamilyPolicy` \u5b57\u6bb5\u5b9a\u7fa9\u7232 IPv4\u3001IPv6 \u6216 [\u96d9\u68e7](https://kubernetes.io/docs/concepts/services-networking/dual-stack/#services) Service\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6709\u95dc\u5982\u4f55\u8a2d\u7f6e Deployment \u7684\u793a\u4f8b](https://cloud.google.com/kubernetes-engine/docs/deploy-app-cluster?hl=zh-cn) \u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [\u8a73\u7d30\u77ad\u89e3 VPC \u7db2\u7d61\u5c0d\u7b49\u4e92\u9023](https://cloud.google.com/vpc/docs/vpc-peering?hl=zh-cn) \u3002\n- [\u77ad\u89e3\u5982\u4f55\u5275\u5efa VPC \u539f\u751f\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=zh-cn) \u3002\n- [\u77ad\u89e3 GKE IP \u5730\u5740\u5229\u7528\u7387\u6578\u64da\u5206\u6790](https://cloud.google.com/network-intelligence-center/docs/network-analyzer/insights/kubernetes-engine/gke-ip-utilization?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}