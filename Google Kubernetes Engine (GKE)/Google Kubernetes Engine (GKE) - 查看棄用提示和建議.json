{"title": "Google Kubernetes Engine (GKE) - \u67e5\u770b\u68c4\u7528\u63d0\u793a\u548c\u5efa\u8b70", "url": "https://cloud.google.com/kubernetes-engine/docs/deprecations/viewing-deprecation-insights-and-recommendations?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u67e5\u770b\u68c4\u7528\u63d0\u793a\u548c\u5efa\u8b70\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u67e5\u770b Google Kubernetes Engine (GKE) \u96c6\u7fa3\u7684 Kubernetes \u68c4\u7528\u60c5\u6cc1\u7684 \u63d0\u793a\u548c\u5efa\u8b70 \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u4f7f\u7528 GKE \u7ba1\u7406 Kubernetes \u68c4\u7528\uff0c\u8acb\u53c3\u95b1 [GKE \u68c4\u7528](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn) \u3002\n", "content": "## \u4ec0\u9ebc\u662f\u68c4\u7528\u63d0\u793a\u548c\u5efa\u8b70\uff1f\n\u7576 GKE \u6aa2\u6e2c\u5230\u96c6\u7fa3\u6b63\u5728\u4f7f\u7528\u5df2\u68c4\u7528\u4e26\u5728\u5373\u5c07\u767c\u4f48\u7684\u6b21\u8981\u7248\u672c\u4e2d\u79fb\u9664\u7684 Kubernetes \u529f\u80fd\u6216 API \u6642\uff0c\u6703\u767c\u751f\u4ee5\u4e0b\u60c5\u6cc1\uff1a\n- \u66ab\u505c\u5230\u5373\u5c07\u767c\u4f48\u7684\u6b21\u8981\u7248\u672c\u7684 [\u81ea\u52d5\u5347\u7d1a](https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-upgrades?hl=zh-cn#upgrading_automatically) \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5176\u5de5\u4f5c\u539f\u7406\uff0c\u8acb\u53c3\u95b1 [GKE \u66ab\u505c\u81ea\u52d5\u5347\u7d1a\u6642\u6703\u767c\u751f\u4ec0\u9ebc\u60c5\u6cc1](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#auto-upgrade-pause) \u3002\n- \u751f\u6210\u63d0\u793a\u548c\u5efa\u8b70\uff0c\u4ee5\u4fbf\u60a8\u8a55\u4f30\u548c\u7de9\u89e3\u96c6\u7fa3\u9762\u81e8\u7684\u68c4\u7528\u98a8\u96aa\u3002\n\u68c4\u7528\u63d0\u793a\u548c\u5efa\u8b70\u7531 [Recommender](https://cloud.google.com/recommender/docs/overview?hl=zh-cn) \u63d0\u4f9b\uff0c\u8a72\u670d\u52d9\u63d0\u4f9b\u6709\u95dc Google Cloud \u8cc7\u6e90\u4f7f\u7528\u60c5\u6cc1\u7684\u63d0\u793a\u548c\u5efa\u8b70\u3002 \u5982\u9700\u8a73\u7d30\u77ad\u89e3 Recommender \u5982\u4f55\u8207 GKE \u642d\u914d\u4f7f\u7528\uff0c\u8acb\u53c3\u95b1 [\u5229\u7528\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\u512a\u5316 GKE \u4f7f\u7528](https://cloud.google.com/kubernetes-engine/docs/how-to/optimize-with-recommenders?hl=zh-cn) \u3002\n\u5c0d\u65bc Recommender \u7684\u68c4\u7528\u4e3b\u984c\uff1a\n- \u63d0\u793a\u8aaa\u660e\u96c6\u7fa3\u6b63\u5728\u4f7f\u7528\u5df2\u68c4\u7528\u4e26\u5c07\u5728\u5373\u5c07\u767c\u4f48\u7684\u6b21\u8981\u7248\u672c\u4e2d\u79fb\u9664\u7684\u529f\u80fd\u6216 API\u3002\n- \u5efa\u8b70\u63d0\u4f9b\u6709\u95dc\u5982\u4f55\u7de9\u89e3\u96c6\u7fa3\u68c4\u7528\u98a8\u96aa\u7684\u6307\u5c0e\u3002\n\u4f8b\u5982\uff0c\u63d0\u793a\u53ef\u80fd\u6703\u8aaa\u660e\uff0c\u60a8\u7684\u96c6\u7fa3\u4f7f\u7528\u7684 Beta \u7248 API \u5df2\u68c4\u7528\uff0c\u4e26\u5c07\u5728\u4e0b\u4e00\u500b\u6b21\u8981\u7248\u672c\u4e2d\u79fb\u9664\u3002\u5efa\u8b70\u5247\u8aaa\u660e\uff0c\u60a8\u61c9\u8a72\u5c07\u5de5\u4f5c\u8ca0\u8f09\u5f9e\u4f7f\u7528 Beta \u7248 API \u9077\u79fb\u5230\u4f7f\u7528 v1 API\u3002 \u6bcf\u689d\u5efa\u8b70\u5747\u5305\u542b\u5c0d\u5df2\u68c4\u7528\u529f\u80fd\u6216 API \u7684\u9077\u79fb\u6307\u5357\u7684\u5f15\u7528\u3002 [\u76f8\u61c9\u7684 Kubernetes \u68c4\u7528\u8868](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#deprecations-information) \u4e2d\u4e5f\u63d0\u4f9b\u4e86\u6b64\u9077\u79fb\u6307\u5357\u3002\nGKE \u751f\u6210\u6578\u64da\u5206\u6790\u548c\u5efa\u8b70\u5c0d\u6642\uff0c\u6703\u6db5\u84cb\u9805\u76ee\u4e2d\u7279\u5b9a\u96c6\u7fa3\u7684\u7279\u5b9a [\u6578\u64da\u5206\u6790\u5b50\u985e\u578b](#use-of-features) \u4e2d\u4efb\u4f55\u5df2\u68c4\u7528\u7684 Kubernetes API \u6216\u529f\u80fd\u7684\u4f7f\u7528\u60c5\u6cc1\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4efb\u4f55\u7528\u6236\u4ee3\u7406\u8abf\u7528 `DEPRECATION_K8S_1_22_V1BETA1_API` \u5b50\u985e\u578b\u8655\u7406\u7684\u4efb\u4f55 API\uff0c\u7cfb\u7d71\u6703\u986f\u793a\u4e00\u689d\u6578\u64da\u5206\u6790\u548c\u5efa\u8b70\uff0c\u5efa\u8b70\u60a8\u9077\u79fb\u6b64\u96c6\u7fa3\u4ee5\u514d\u4f7f\u7528\u9019\u4e9b API\u3002\u5982\u679c\u53e6\u4e00\u500b\u96c6\u7fa3\u4e5f\u4f7f\u7528\u9019\u4e9b API\uff0c\u5247 GKE \u6703\u751f\u6210\u53e6\u4e00\u500b\u6578\u64da\u5206\u6790\u548c\u5efa\u8b70\u3002\n### GKE \u6aa2\u6e2c\u5230\u7684\u5df2\u68c4\u7528 Kubernetes \u529f\u80fd\u548c API \u7684\u4f7f\u7528\n| \u68c4\u7528                    | \u5728\u54ea\u500b GKE \u7248\u672c\u4e2d\u79fb\u9664 | \u63d0\u793a\u5b50\u985e\u578b        |\n|:-----------------------------------------------------------------------------------|:------------------------|:---------------------------------------|\n| \u4f7f\u7528 SHA-1 \u7b97\u6cd5\u7c3d\u540d\u7684 TLS \u8b49\u66f8              | 1.29     | DEPRECATION_K8S_SHA_1_CERTIFICATE  |\n| Kubernetes 1.29 \u5df2\u68c4\u7528\u7684 API              | 1.29     | DEPRECATION_K8S_1_29_API    |\n| Kubernetes 1.27 \u5df2\u68c4\u7528\u7684 API              | 1.27     | DEPRECATION_K8S_1_27_API    |\n| Kubernetes 1.26 \u5df2\u68c4\u7528\u7684 API              | 1.26     | DEPRECATION_K8S_1_26_API    |\n| Kubernetes 1.25 \u5df2\u68c4\u7528\u7684 API              | 1.25     | DEPRECATION_K8S_1_25_API    |\n| PodSecurityPolicy                 | 1.25     | DEPRECATION_K8S_1_25_PODSECURITYPOLICY |\n| \u57fa\u65bc Docker \u7684\u7bc0\u9ede\u6620\u50cf                | 1.24     | DEPRECATION_K8S_1_24_DOCKERSHIM  |\n| \u7db2\u7d61\u9264\u5b50\u8b49\u66f8\u4e2d\u7684 X.509 \u901a\u7528\u540d\u7a31\u5b57\u6bb5            | 1.23     | DEPRECATION_K8S_1_23_CERTIFICATE  |\n| Kubernetes 1.22 \u5df2\u68c4\u7528\u7684 API\u3001 \u5728 GKE 1.23 \u4e2d\u79fb\u9664\u4e86 Kubernetes Ingress Beta \u7248 API | 1.22\u30011.23    | DEPRECATION_K8S_1_22_V1BETA1_API  |\n\u8acb\u6ce8\u610f\uff0c\u5c0d\u65bc [\u5373\u5c07\u767c\u751f\u7684\u68c4\u7528](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#deprecations-information) \uff0c\u60a8\u5fc5\u9808\u7368\u7acb\u8a55\u4f30\u96c6\u7fa3\u74b0\u5883\u7684\u98a8\u96aa\u4e26\u7de9\u89e3\u4efb\u4f55\u554f\u984c\u3002\n## \u6e96\u5099\u5de5\u4f5c\n\u5728\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u57f7\u884c\u4ee5\u4e0b\u4efb\u52d9\uff1a\n- \u5553\u7528 Google Kubernetes Engine API\u3002\n- [  \u5553\u7528 Google Kubernetes Engine API ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com&hl=zh-cn) \n- \u5982\u679c\u60a8\u8981\u4f7f\u7528 Google Cloud CLI \u57f7\u884c\u6b64\u4efb\u52d9\uff0c\u8acb [\u5b89\u88dd](https://cloud.google.com/sdk/docs/install?hl=zh-cn) \u4e26 [\u521d\u59cb\u5316](https://cloud.google.com/sdk/docs/initializing?hl=zh-cn) gcloud CLI\u3002 \u5982\u679c\u60a8\u4e4b\u524d\u5b89\u88dd\u4e86 gcloud CLI\uff0c\u8acb\u904b\u884c`gcloud components update`\u4ee5\u7372\u53d6\u6700\u65b0\u7248\u672c\u3002 **\u6ce8\u610f** \uff1a\u5c0d\u65bc\u73fe\u6709 gcloud CLI \u5b89\u88dd\uff0c\u8acb\u52d9\u5fc5\u8a2d\u7f6e`compute/region`\u548c`compute/zone` [\u5c6c\u6027](https://cloud.google.com/sdk/docs/properties?hl=zh-cn#setting_properties) \u3002\u901a\u904e\u8a2d\u7f6e\u9ed8\u8a8d\u4f4d\u7f6e\uff0c\u60a8\u53ef\u4ee5\u907f\u514d gcloud CLI \u4e2d\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a`One of [--zone, --region] must be supplied: Please specify location`\u3002\n### \u6240\u9700\u7684\u89d2\u8272\n\u78ba\u4fdd\u60a8\u64c1\u6709 Kubernetes \u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\u6240\u9700\u7684\u6b0a\u9650\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b [\u57fa\u672c\u89d2\u8272](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#basic) \u6216 [\u9810\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#predefined) \uff1a\n- \u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u89d2\u8272\u4e4b\u4e00\u67e5\u770b\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\uff1a- [\u67e5\u770b\u8005](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#basic) \n- [GKE Diagnosis Recommender Viewer](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#recommender.containerDiagnosisViewer) \n- \u67e5\u770b\u548c\u66f4\u65b0\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\u7684\u72c0\u614b\uff08\u4f8b\u5982\uff0c [\u5ffd\u7565\u5efa\u8b70](#dismiss-recommendation) \uff09\uff1a- [Editor](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#basic) \n- [Kubernetes Engine Admin](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#container.admin) \n- [Kubernetes Engine Developer](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#container.developer) \n- [GKE Diagnosis Recommender Admin](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#recommender.containerDiagnosisAdmin) \n## \u67e5\u770b\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud CLI\u3001Google Cloud \u63a7\u5236\u6aaf\u6216 [Recommender API](https://cloud.google.com/recommender/docs/reference/rest?hl=zh-cn) \u67e5\u770b\u63d0\u793a\u548c\u5efa\u8b70\u3002\n- \u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **Google Kubernetes Engine** \u9801\u9762\uff1a [\u8f49\u5230 Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list?hl=zh-cn) \n- \u67e5\u770b\u7279\u5b9a\u96c6\u7fa3\u7684 **\u901a\u77e5** \u5217\uff0c\u4ee5\u627e\u5230\u5206\u6790\u6d1e\u898b\u3002\n- \u9ede\u64ca\u5177\u9ad4\u7684\u63d0\u793a\u53ef\u986f\u793a\u66f4\u591a\u4fe1\u606f\u3002\u5728\u986f\u793a\u7684\u908a\u6b04\u9762\u677f\u4e2d\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b\u6709\u95dc\u6b64\u5206\u6790\u6d1e\u898b\u7684\u8a73\u7d30\u4fe1\u606f\uff0c\u5305\u62ec\u4efb\u4f55\u95dc\u806f\u7684\u5efa\u8b70\u3002\n\u5206\u6790\u6d1e\u898b\u901a\u5e38\u6709\u76f8\u61c9\u7684\u5efa\u8b70\u3002\u4f7f\u7528 [gcloud recommender insights](https://cloud.google.com/sdk/gcloud/reference/recommender/insights?hl=zh-cn) \u63d0\u53d6\u63d0\u793a\uff0c\u4f7f\u7528 [gcloud recommender recommendations](https://cloud.google.com/sdk/gcloud/reference/recommender/recommendations?hl=zh-cn) \u63d0\u53d6\u5efa\u8b70\u3002- \u67e5\u770b\u7279\u5b9a\u53ef\u7528\u5340\uff08\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff09\u6216\u7279\u5b9a\u5340\u57df\uff08\u5c0d\u65bc\u5340\u57df\u7d1a\u96c6\u7fa3\uff09\u7684\u96c6\u7fa3\u7684\u63d0\u793a\u5217\u8868\uff1a```\ngcloud recommender insights list \\\u00a0 \u00a0 --insight-type=google.container.DiagnosisInsight \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT \\\u00a0 \u00a0 --filter=\"insightSubtype:SUBTYPE\"\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u96c6\u7fa3\u6240\u5728\u9805\u76ee\u7684 Google Cloud \u9805\u76ee ID\u3002\n- ``\uff1a\u96c6\u7fa3\u7684\u78ba\u5207\u5340\u57df\u6216\u53ef\u7528\u5340\u3002\u5c0d\u65bc [\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters?hl=zh-cn#zonal_clusters) \uff0c\u60a8\u5fc5\u9808\u63d0\u4f9b\u78ba\u5207\u7684\u53ef\u7528\u5340\uff08\u4f8b\u5982`us-central1-c`\uff09\u3002\u5c0d\u65bc [\u5340\u57df\u7d1a\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters?hl=zh-cn#regional_clusters) \uff0c\u60a8\u5fc5\u9808\u63d0\u4f9b\u78ba\u5207\u7684\u5340\u57df\uff08\u4f8b\u5982`us-central1`\uff09\u3002\n- ``\uff1a\u5c07\u8f38\u51fa\u683c\u5f0f\u66f4\u6539\u7232 YAML\u3002\u6b64\u6a19\u8a8c\u4e0d\u662f\u5fc5\u9700\u7684\u3002\n- ``\uff1a [\u63d0\u793a\u5b50\u985e\u578b](https://cloud.google.com/recommender/docs/insights/using-insights?hl=zh-cn#insight_subtype) \uff0c\u4f8b\u5982`DEPRECATION_K8S_1_23_CERTIFICATE`\u3002\u9019\u6703\u5c07\u8f38\u51fa\u9650\u5236\u7232\u6307\u5b9a\u5b50\u985e\u578b\u7684\u63d0\u793a\u3002\u6b64\u6a19\u8a8c\u4e0d\u662f\u5fc5\u9700\u7684\u3002\n\u6216\u8005\uff0c\u5982\u679c\u60a8\u5df2\u7d93\u77e5\u9053\u63d0\u793a ID\uff0c\u5247\u53ef\u4ee5\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4f86\u67e5\u770b\u8a72\u63d0\u793a\u7684\u8a73\u7d30\u4fe1\u606f\uff1a```\ngcloud recommender insights describe INSIGHT \\\u00a0 \u00a0 --insight-type=google.container.DiagnosisInsight \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT\n```\u5c07 `` \u66ff\u63db\u7232\u63d0\u793a ID \u7684\u503c\uff0c\u8a72\u503c\u5728\u63d0\u793a\u7684 `name` \u5b57\u6bb5\u4e2d\u7684\u7db2\u5740\u672b\u5c3e\u6307\u5b9a\u3002 **\u6ce8\u610f** \uff1a\u5982\u9700\u67e5\u770b\u95dc\u806f\u7684\u5efa\u8b70\uff0c\u8acb\u4fdd\u5b58\u547d\u4ee4\u8f38\u51fa\u4e2d\u7684 `associatedRecommendations.recommendation` \u7684 **\u5efa\u8b70 ID** \u503c\uff0c\u4ee5\u5728\u7b2c 2 \u6b65\u4e2d\u4f7f\u7528\u3002\u8f38\u51fa\u5305\u542b\u6709\u95dc GKE \u6aa2\u6e2c\u5230\u7684\u96c6\u7fa3\u884c\u7232\u7684\u5176\u4ed6\u8a73\u7d30\u4fe1\u606f\u3002\n- \u67e5\u770b\u7279\u5b9a\u53ef\u7528\u5340\uff08\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff09\u6216\u7279\u5b9a\u5340\u57df\uff08\u5c0d\u65bc\u5340\u57df\u7d1a\u96c6\u7fa3\uff09\u7684\u96c6\u7fa3\u7684\u5efa\u8b70\u5217\u8868\uff1a **\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u5df2\u7d93\u5f9e\u7b2c 1 \u6b65\u4e2d\u7372\u5f97 **\u5efa\u8b70 ID** \u4e26\u4e14\u60f3\u8981\u67e5\u770b\u7279\u5b9a\u5efa\u8b70\uff0c\u8acb\u6539\u7528 `describe` \u547d\u4ee4\u3002```\ngcloud recommender recommendations list \\\u00a0 \u00a0 --recommender=google.container.DiagnosisRecommender \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT \\\u00a0 \u00a0 --filter=\"recommenderSubtype:SUBTYPE\"\n```\u5c07 `` \u66ff\u63db\u7232 [Recommender \u5b50\u985e\u578b](https://cloud.google.com/recommender/docs/key-concepts?hl=zh-cn#recommender_subtype) \uff0c\u4f8b\u5982 `DEPRECATION_K8S_1_23_CERTIFICATE` \u3002\u9019\u6703\u5c07\u8f38\u51fa\u9650\u5236\u7232\u6307\u5b9a\u5b50\u985e\u578b\u7684\u5efa\u8b70\u3002\u6b64\u6a19\u8a8c\u4e0d\u662f\u5fc5\u9700\u7684\u3002\u6216\u8005\uff0c\u5982\u679c\u60a8\u5df2\u7d93\u77e5\u9053\u5efa\u8b70 ID\uff0c\u5247\u53ef\u4ee5\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4f86\u67e5\u770b\u5efa\u8b70\uff1a```\ngcloud recommender recommendations describe RECOMMENDATION_ID \\\u00a0 \u00a0 --recommender=google.container.DiagnosisRecommender \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT\n```\u5c07 `` \u66ff\u63db\u7232\u7b2c 1 \u6b65\u7684\u547d\u4ee4\u8f38\u51fa\u4e2d\u7684 `associatedRecommendations.recommendation` \u503c\u3002\u8f38\u51fa\u63d0\u4f9b\u6709\u95dc\u512a\u5316\u96c6\u7fa3\u7684 GKE \u4f7f\u7528\u9700\u8981\u63a1\u53d6\u7684\u63aa\u65bd\u7684\u6307\u5c0e\u3002\n\u6bcf\u500b\u63d0\u793a\u90fd\u6709\u76f8\u61c9\u7684\u5efa\u8b70\u3002\u4f7f\u7528 [REST \u8cc7\u6e90\uff1aprojects.locations.insightTypes.insights](https://cloud.google.com/recommender/docs/reference/rest/v1/projects.locations.insightTypes.insights?hl=zh-cn) \u63d0\u53d6\u63d0\u793a\uff0c\u4f7f\u7528 [REST \u8cc7\u6e90\uff1aprojects.locations.recommenders.recommendations](https://cloud.google.com/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations?hl=zh-cn) \u63d0\u53d6\u5efa\u8b70\u3002- \u67e5\u770b\u7279\u5b9a\u53ef\u7528\u5340\uff08\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff09\u6216\u7279\u5b9a\u5340\u57df\uff08\u5c0d\u65bc\u5340\u57df\u7d1a\u96c6\u7fa3\uff09\u7684\u96c6\u7fa3\u7684\u63d0\u793a\u5217\u8868\uff1a```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/insightTypes/google.container.DiagnosisInsight/insights?filter=insightSubtype%20%3D%20SUBTYPE\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u96c6\u7fa3\u6240\u5728\u9805\u76ee\u7684 Google Cloud \u9805\u76ee ID\u3002\n- ``\uff1a\u96c6\u7fa3\u7684\u78ba\u5207\u5340\u57df\u6216\u53ef\u7528\u5340\u3002\u5c0d\u65bc [\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters?hl=zh-cn#zonal_clusters) \uff0c\u60a8\u5fc5\u9808\u63d0\u4f9b\u78ba\u5207\u7684\u53ef\u7528\u5340\uff08\u4f8b\u5982`us-central1-c`\uff09\u3002\u5c0d\u65bc [\u5340\u57df\u7d1a\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters?hl=zh-cn#regional_clusters) \uff0c\u60a8\u5fc5\u9808\u63d0\u4f9b\u78ba\u5207\u7684\u5340\u57df\uff08\u4f8b\u5982`us-central1`\uff09\u3002\n- ``\uff1a [\u63d0\u793a\u5b50\u985e\u578b](https://cloud.google.com/recommender/docs/insights/using-insights?hl=zh-cn#insight_subtype) \uff0c\u4f8b\u5982`DEPRECATION_K8S_1_23_CERTIFICATE`\u3002\u9019\u6703\u5c07\u8f38\u51fa\u9650\u5236\u7232\u6307\u5b9a\u5b50\u985e\u578b\u7684\u63d0\u793a\u3002\u6b64\u6a19\u8a8c\u4e0d\u662f\u5fc5\u9700\u7684\u3002\n\u6216\u8005\uff0c\u5982\u679c\u60a8\u5df2\u7d93\u77e5\u9053\u63d0\u793a ID\uff0c\u5247\u53ef\u4ee5\u767c\u51fa\u4ee5\u4e0b\u8acb\u6c42\u4f86\u67e5\u770b\u8a72\u63d0\u793a\u7684\u8a73\u7d30\u4fe1\u606f\uff1a```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/insightTypes/google.container.DiagnosisInsight/insights/INSIGHT\n```\u5c07 `` \u66ff\u63db\u7232\u63d0\u793a ID \u7684\u503c\uff0c\u8a72\u503c\u5728\u63d0\u793a\u7684 `name` \u5b57\u6bb5\u4e2d\u7684\u7db2\u5740\u672b\u5c3e\u6307\u5b9a\u3002 **\u6ce8\u610f** \uff1a\u5982\u9700\u67e5\u770b\u95dc\u806f\u7684\u5efa\u8b70\uff0c\u8acb\u4fdd\u5b58\u97ff\u61c9\u6b63\u6587\u4e2d\u7684 `associatedRecommendations.recommendation` \u7684 **\u5efa\u8b70 ID** \u503c\uff0c\u4ee5\u5728\u7b2c 2 \u6b65\u4e2d\u4f7f\u7528\u3002\u97ff\u61c9\u6b63\u6587\u5305\u542b\u6709\u95dc GKE \u6aa2\u6e2c\u5230\u7684\u96c6\u7fa3\u884c\u7232\u7684\u8a73\u7d30\u4fe1\u606f\u3002\n- \u67e5\u770b\u7279\u5b9a\u53ef\u7528\u5340\uff08\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff09\u6216\u7279\u5b9a\u5340\u57df\uff08\u5c0d\u65bc\u5340\u57df\u7d1a\u96c6\u7fa3\uff09\u7684\u96c6\u7fa3\u7684\u5efa\u8b70\u5217\u8868\uff1a **\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u5df2\u7d93\u5f9e\u7b2c 1 \u6b65\u4e2d\u7372\u5f97 **\u5efa\u8b70 ID** \u4e26\u4e14\u60f3\u8981\u67e5\u770b\u7279\u5b9a\u5efa\u8b70\uff0c\u8acb\u6539\u7528 `recommendations.get` \u8acb\u6c42\u3002```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/recommenders/google.container.DiagnosisRecommender/recommendations?filter=recommenderSubtype%20%3D%20SUBTYPE\n```\u5c07 `` \u66ff\u63db\u7232 [Recommender \u5b50\u985e\u578b](https://cloud.google.com/recommender/docs/key-concepts?hl=zh-cn#recommender_subtype) \uff0c\u4f8b\u5982 `DEPRECATION_K8S_1_23_CERTIFICATE` \u3002\u9019\u6703\u5c07\u8f38\u51fa\u9650\u5236\u7232\u6307\u5b9a\u5b50\u985e\u578b\u7684\u5efa\u8b70\u3002\u6b64\u6a19\u8a8c\u4e0d\u662f\u5fc5\u9700\u7684\u3002\u6216\u8005\uff0c\u5982\u679c\u60a8\u5df2\u7d93\u77e5\u9053\u5efa\u8b70 ID\uff0c\u5247\u53ef\u4ee5\u767c\u51fa\u4ee5\u4e0b\u8acb\u6c42\u4f86\u67e5\u770b\u5efa\u8b70\uff1a```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/recommenders/google.container.DiagnosisRecommender/recommendations/RECOMMENDATION_ID\n```\u5c07 `` \u66ff\u63db\u7232\u7b2c 1 \u6b65\u97ff\u61c9\u6b63\u6587\u4e2d\u4fdd\u5b58\u7684 `associatedRecommendations.recommendation` \u503c\u3002\u97ff\u61c9\u6b63\u6587\u63d0\u4f9b\u6709\u95dc\u512a\u5316\u96c6\u7fa3\u7684 GKE \u4f7f\u7528\u53ef\u80fd\u9700\u8981\u63a1\u53d6\u7684\u63aa\u65bd\u7684\u6307\u5c0e\u3002\u68c4\u7528\u63d0\u793a\u5305\u542b\u6709\u95dc\u5df2\u68c4\u7528\u529f\u80fd\u6216 API \u7684\u4f7f\u7528\u6642\u9593\u548c\u4f7f\u7528\u91cf\u7684\u8a73\u7d30\u4fe1\u606f\u3002\u63d0\u793a\u4e2d\u5305\u542b\u7684\u4fe1\u606f\u53d6\u6c7a\u65bc\u63d0\u793a\u7232\u54ea\u7a2e [\u68c4\u7528\u985e\u578b](#use-of-features) \u63d0\u4f9b\u4fe1\u606f\u3002\n\u4ee5\u4e0b\u662f `DEPRECATION_K8S_1_22_V1BETA1_API` \u63d0\u793a\u5b50\u985e\u578b\u7684\u793a\u4f8b\u63d0\u793a\uff1a\n```\n name: projects/<PROJECT-NUMBER>/locations/us-central1/insightTypes/google.container.DiagnosisInsight/insights/<INSIGHT-ID>\n observationPeriod: 2592000s\n severity: HIGH\n category: RELIABILITY\n stateInfo:\n state: ACTIVE\n insightSubtype: DEPRECATION_K8S_1_22_V1BETA1_API\n description: Your API clients have used deprecated APIs in the last 30 days that are removed in Kubernetes v1.22. Upgrading your cluster before migrating to the updated APIs supported by v1.22 could cause it to break. [Learn more](https://kubernetes.io/docs/reference/using-api/deprecation-guide/#v1-22).\n targetResources:\n - //container.googleapis.com/projects/<PROJECT-NUMBER>/locations/us-central1/clusters/c1\n associatedRecommendations:\n - recommendation: projects/<PROJECT-NUMBER>/locations/us-central1/recommenders/google.container.DiagnosisRecommender/recommendations/<RECOMMENDATION-ID>\n etag: '\"2147dd8e1e302ed7\"'\n lastRefreshTime: \"2022-01-30T08:00:00Z\"\n content:\n targetClusters:\n - clusterId: <CLUSTER-ID>\n  clusterUri: //container.googleapis.com/projects/<PROJECT-NUMBER>/locations/us-central1/clusters/c1\n apiDeprecationInsight:\n - api: /apis/networking.k8s.io/v1beta1/Ingress\n  stopServingVersion: 1.22\n  deprecatedClientStats:\n  userAgent: kubectl\n  numberOfRequestsLast30Days: 288\n  lastRequestTime: \"2022-02-30T08:00:18Z\"\n - api: /apis/rbac.authorization.k8s.io/v1beta1/ClusterRole\n  stopServingVersion: 1.22\n  deprecatedClientStats:\n  userAgent: kubectl\n  numberOfRequestsLast30Days: 126\n  lastRequestTime: \"2022-02-01T06:45:25Z\"\n```\n\u68c4\u7528\u5efa\u8b70\u5305\u542b\u68c4\u7528\u8aaa\u660e\u4ee5\u53ca\u68c4\u7528\u9077\u79fb\u6307\u5357\u93c8\u63a5\u3002\u60a8\u9084\u53ef\u4ee5\u5728 [GKE \u529f\u80fd\u68c4\u7528\u8868](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#feature_deprecations) \u548c [Kubernetes API \u68c4\u7528\u8868](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#kubernetes_api_deprecations) \u4e2d\u627e\u5230\u9019\u4e9b\u9077\u79fb\u6307\u5357\u3002\n\u4ee5\u4e0b\u662f `DEPRECATION_K8S_1_22_V1BETA1_API` \u5efa\u8b70\u5b50\u985e\u578b\u7684\u793a\u4f8b\u5efa\u8b70\uff1a\n```\n name: projects/<PROJECT-NUMBER>/locations/us-central1/recommenders/google.container.DiagnosisRecommender/recommendations/<RECOMMENDATION-ID>\n description: Update manifests and API clients to use v1 API before upgrading to Kubernetes 1.22 by following the [instructions](https://cloud.google.com/kubernetes-engine/docs/deprecations/apis-1-22).\n primaryImpact:\n category: RELIABILITY\n reliabilityProjection:\n  risks:\n  - SERVICE_DISRUPTION\n priority: P2\n recommenderSubtype: DEPRECATION_K8S_1_22_V1BETA1_API\n stateInfo:\n state: ACTIVE\n targetResources:\n - //container.googleapis.com/projects/<PROJECT-NUMBER>/locations/us-central1/clusters/c1\n associatedInsights:\n - insight: projects/<PROJECT-NUMBER>/locations/us-central1/insightTypes/google.container.DiagnosisInsight/insights/<INSIGHT-ID>\n etag: '\"4dc0f7b33594072f\"'\n lastRefreshTime: \"2022-01-30T08:00:00Z\"\n content:\n overview:\n  targetClusters:\n  - clusterId: <CLUSTER-ID>\n   clusterUri: //container.googleapis.com/projects/<PROJECT-NUMBER>/locations/us-central1/clusters/c1\n  apiDeprecationRecommendation:\n  - api: /apis/networking.k8s.io/v1beta1/Ingress\n   apiReplacement: /apis/networking.k8s.io/v1/Ingress\n   stopServingVersion: 1.22\n  - api: /apis/rbac.authorization.k8s.io/v1beta1/ClusterRole\n   apiReplacement: /apis/rbac.authorization.k8s.io/v1/ClusterRole\n   stopServingVersion: 1.22\n```\n## \u5c07\u6578\u64da\u5206\u6790\u548c\u5efa\u8b70\u5c0e\u51fa\u5230 BigQuery\n\u60a8\u53ef\u4ee5\u4f7f\u7528 BigQuery \u5c0e\u51fa\u548c\u5206\u6790\u6574\u500b\u7d44\u7e54\u7684\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5c07\u5efa\u8b70\u5c0e\u51fa\u5230 BigQuery](https://cloud.google.com/recommender/docs/bq-export/export-recommendations-to-bq?hl=zh-cn) \u3002\n## \u5ffd\u7565\u6216\u6062\u5fa9\u68c4\u7528\u5efa\u8b70\n\u5982\u679c\u60a8\u4e0d\u60f3\u518d\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u770b\u5230\u96c6\u7fa3\u7684\u68c4\u7528\u5efa\u8b70\uff0c\u8acb\u5ffd\u7565\u8a72\u5efa\u8b70\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5ffd\u7565\u9069\u7528\u65bc\u81e8\u6642\u3001\u77ed\u671f\u96c6\u7fa3\u7684\u5efa\u8b70\u3002\n\u5982\u679c\u60a8\u5ffd\u7565\u5efa\u8b70\uff0c\u5247\u7cfb\u7d71\u4e0d\u6703\u5411\u5728\u63a7\u5236\u6aaf\u4e2d\u67e5\u770b\u96c6\u7fa3\u7684\u4efb\u4f55\u7528\u6236\u986f\u793a\u5efa\u8b70\u3002\u5ffd\u7565\u5efa\u8b70\u5f8c\uff0c\u5373\u4f7f\u7528\u6236\u4ee3\u7406\u5728\u5ffd\u7565\u5f8c\u5df2\u68c4\u7528\u6b64 [\u5b50\u985e\u578b](#use-of-features) \u4e2d\u5df2\u68c4\u7528\u7684 API \u6216\u529f\u80fd\uff0c\u4e5f\u4e0d\u6703\u518d\u6b21\u986f\u793a\u3002\n\u4f46\u662f\uff0c\u5efa\u8b70\u4ecd\u53ef\u901a\u904e Google Cloud CLI \u548c Recommender API \u767c\u73fe\u3002\n\u5982\u679c\u60a8\u5ffd\u7565\u67d0\u5efa\u8b70\uff0c\u5247\u53ea\u6703\u5c0d\u6240\u6709\u7528\u6236\u96b1\u85cf\u8a72\u5efa\u8b70\u3002\u81ea\u52d5\u5347\u7d1a [\u6703\u4fdd\u6301\u66ab\u505c\u72c0\u614b](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#auto-upgrade-pause) \uff0c\u76f4\u5230\u60a8\u5f9e\u5df2\u68c4\u7528\u7684\u529f\u80fd\u6216 API \u9077\u79fb\uff0c\u4e26\u4e14 GKE \u9023\u7e8c 30 \u5929\u672a\u6aa2\u6e2c\u5230\u4f7f\u7528\u5df2\u68c4\u7528\u7684 API \u6216\u60a8\u5728\u96c6\u7fa3\u7684\u7248\u672c [\u7d42\u6b62\u670d\u52d9](https://cloud.google.com/kubernetes-engine/versioning?hl=zh-cn#lifecycle) \u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [GKE \u4f55\u6642\u6062\u5fa9\u81ea\u52d5\u5347\u7d1a\uff1f](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn#auto-upgrades-resume) \u3002\n### \u5ffd\u7565\u5efa\u8b70\n\u5982\u9700\u5ffd\u7565\u5efa\u8b70\uff0c\u8acb\u6309\u7167\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d [\u67e5\u770b\u5206\u6790\u6d1e\u898b\u548c\u5efa\u8b70](#view-insights-recs) \u7684\u8aaa\u660e\u64cd\u4f5c\uff0c\u6253\u958b\u908a\u6b04\u9762\u677f\uff0c\u5176\u4e2d\u5305\u542b\u66f4\u591a\u8a73\u7d30\u4fe1\u606f\u3002\u5728\u8a72\u9762\u677f\u4e2d\uff0c\u9ede\u64ca **\u5ffd\u7565** \u6309\u9215\u3002\n### \u6062\u5fa9\u5df2\u5ffd\u7565\u7684\u5efa\u8b70\n\u60a8\u53ef\u4ee5\u6309\u7167 [\u6062\u5fa9\u5efa\u8b70](https://cloud.google.com/recommender/docs/recommendation-hub/changing-applying-recommendations?hl=zh-cn#restoring_a_recommendation) \u4e2d\u7684\u8aaa\u660e\u6062\u5fa9\u5df2\u5ffd\u7565\u7684\u5efa\u8b70\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u5982\u9700\u8a73\u7d30\u77ad\u89e3\u68c4\u7528\u529f\u80fd\u5982\u4f55\u8207 GKE \u642d\u914d\u4f7f\u7528\uff0c\u8acb\u53c3\u95b1 [GKE \u68c4\u7528](https://cloud.google.com/kubernetes-engine/docs/deprecations?hl=zh-cn) \u3002\n- \u5982\u9700\u8a73\u7d30\u77ad\u89e3 Recommender API\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 API - \u5efa\u8b70](https://cloud.google.com/recommender/docs/using-api?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}