{"title": "Google Kubernetes Engine (GKE) - Configure Windows Server nodes to automatically join an Active Directory domain", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/auto-join-windows-nodepools", "abstract": "# Google Kubernetes Engine (GKE) - Configure Windows Server nodes to automatically join an Active Directory domain\nThis page provides instructions to configure your [Windows Server nodes](/kubernetes-engine/docs/how-to/creating-a-cluster-windows) in your Google Kubernetes Engine (GKE) cluster to automatically join an Active Directory (AD) domain.\nIf you want to join your Windows Server nodes to a [Managed Microsoft AD](/managed-microsoft-ad/docs/overview) domain and don't require a security group that contains the computer objects of your cluster, you can use the automated domain join feature. For more information, see [Join GKE Windows Server nodes automatically to aManaged Microsoft ADdomain](/managed-microsoft-ad/docs/automated-domain-join-gke) .\n", "content": "## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.\n- Ensure you have the correct IAM permission to create clusters. At minimum, you should be a [Kubernetes Engine Cluster Admin](/iam/docs/understanding-roles#kubernetes-engine-roles) .## Configure auto join for Windows Server node pools\n- Configure AD and your Google Cloud project for automatic joining by completing the instructions in the [Configuring Active Directory for VMs to automatically join a domain](/solutions/configuring-active-directory-for-vms-to-automatically-join-the-domain) tutorial.\n- Create a GKE cluster:```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --enable-ip-alias \\\u00a0 \u00a0 --num-nodes=NUMBER_OF_NODES \\\u00a0 \u00a0 --no-enable-shielded-nodes \\\u00a0 \u00a0 --cluster-version=VERSION\n```Replace the following:- ``: the name of your new cluster.\n- ``: the number of Linux nodes to create. You should provide sufficient compute resources to run cluster add-ons. This is an optional field and, if omitted, uses the default value of 3.\n- ``: the GKE cluster version, which must be 1.17.14-gke.1200 or later or 1.18.9-gke.100 or later. You can also use the [--release-channel](/sdk/gcloud/reference/container/clusters/create#--release-channel) flag to enroll the cluster in a release channel.\n- `--enable-ip-alias`turns on [alias IP](/vpc/docs/alias-ip) . Alias IP is required for Windows Server nodes.\n- `--no-enable-shielded-nodes`disables Shielded GKE Nodes.\n- Set the following variables:```\nexport DOMAIN_PROJECT_ID=PROJECT_ID\nexport SERVERLESS_REGION=REGION\nexport REGISTER_URL=https://$SERVERLESS_REGION-$DOMAIN_PROJECT_ID.cloudfunctions.net/register-computer\n```Replace the following:- ``: the [project ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects) of your domain project.\n- ``: the region to [deploy your Cloud Function](/solutions/configuring-active-directory-for-vms-to-automatically-join-the-domain) in. Choose a region that supports both [Cloud Functions](/functions/docs/locations) and [Serverless VPC Access](/vpc/docs/configure-serverless-vpc-access#supported_regions) . The region does not have to be the same region as the one you plan to deploy VM instances in.\n- Create and start a Windows Server node pool by passing the specialized scriptlet that joins the node to the AD domain:```\n\u00a0gcloud container node-pools create NODE_POOL_NAME \\\u00a0 \u00a0 --cluster=CLUSTER_NAME \\\u00a0 \u00a0 --image-type=IMAGE_NAME \\\u00a0 \u00a0 --no-enable-autoupgrade \\\u00a0 \u00a0 --machine-type=MACHINE_TYPE_NAME \\\u00a0 \u00a0 \"--metadata=sysprep-specialize-script-ps1=iex((New-Object System.Net.WebClient).DownloadString('$REGISTER_URL'))\"\n```Replace the following:- ``: the name of your Windows Server node pool.\n- ``: the name of the cluster you created.\n- ``: the node image to use, such as`WINDOWS_LTSC_CONTAINERD`. For more information, see [Choose your Windows Server node image](/kubernetes-engine/docs/how-to/creating-a-cluster-windows#choose_your_windows_server_node_image) .\n- ``: the machine type.`n1-standard-2`is the minimum recommended machine type as Windows Server nodes require additional resources. Machine types`f1-micro`and`g1-small`are not supported. Each machine type is billed differently. For more information, refer to the [machine type price sheet](/compute/pricing#standard_machine_types) .Your Windows Server node is now joined to your Active Directory domain.\n## What's next\n- To use a Group Managed Service Account (gMSA) with your Windows Server node pools, see [Using gMSA](/kubernetes-engine/docs/how-to/creating-a-cluster-windows#using_gmsa) .\n- Learn about the [Managed Service for Microsoft Active Directory](/managed-microsoft-ad/docs/overview) .", "guide": "Google Kubernetes Engine (GKE)"}