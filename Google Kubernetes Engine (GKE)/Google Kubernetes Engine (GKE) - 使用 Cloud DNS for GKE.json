{"title": "Google Kubernetes Engine (GKE) - \u4f7f\u7528 Cloud DNS for GKE", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/cloud-dns?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u4f7f\u7528 Cloud DNS for GKE\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u5c07 Cloud DNS \u7528\u4f5c Google Kubernetes Engine (GKE) \u7684 Kubernetes DNS \u63d0\u4f9b\u5546\u3002\n\u4f7f\u7528 Cloud DNS \u4f5c\u7232 DNS \u63d0\u4f9b\u5546\u4e0d\u6703\u5141\u8a31\u96c6\u7fa3\u5916\u90e8\u7684\u5ba2\u6236\u7aef\u76f4\u63a5\u89e3\u6790\u548c\u8a2a\u554f Kubernetes \u670d\u52d9\u3002\u60a8\u4ecd\u7136\u9700\u8981\u4f7f\u7528\u8ca0\u8f09\u5747\u8861\u5668\u5728\u5916\u90e8\u516c\u958b Service\uff0c\u4e26\u5728\u60a8\u7684 DNS \u57fa\u790e\u67b6\u69cb\u4e0a\u8a3b\u518a\u5176\u96c6\u7fa3\u5916\u90e8 IP \u5730\u5740\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5c07 kube-dns \u7528\u4f5c DNS \u63d0\u4f9b\u5546\uff0c\u8acb\u53c3\u95b1 [\u670d\u52d9\u767c\u73fe\u548c DNS](https://cloud.google.com/kubernetes-engine/docs/concepts/service-discovery?hl=zh-cn) \u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u4f7f\u7528\u81ea\u5b9a\u7fa9\u7248\u672c\u7684 kube-dns \u6216\u81ea\u5b9a\u7fa9 DNS \u63d0\u4f9b\u5546\uff0c\u8acb\u53c3\u95b1 [\u8a2d\u7f6e\u81ea\u5b9a\u7fa9 kube-dns \u90e8\u7f72](https://cloud.google.com/kubernetes-engine/docs/how-to/custom-kube-dns?hl=zh-cn) \u3002\n", "content": "## Cloud DNS for GKE \u7684\u5de5\u4f5c\u539f\u7406\n[Cloud DNS](https://cloud.google.com/dns/docs/overview?hl=zh-cn) \u53ef\u7528\u4f5c GKE \u7684 DNS \u63d0\u4f9b\u5546\uff0c\u63d0\u4f9b\u5177\u6709\u4ee3\u7ba1\u5f0f DNS (\u7121\u9700\u96c6\u7fa3\u8a17\u7ba1\u7684 DNS \u63d0\u4f9b\u5546) \u7684 Pod \u548c Service DNS \u89e3\u6790\uff0c\u3002Pod \u548c Service \u7684 DNS \u8a18\u9304\u6703\u81ea\u52d5\u5728 Cloud DNS \u4e2d\u7232\u96c6\u7fa3 IP\u3001\u7121\u982d\u548c\u5916\u90e8\u540d\u7a31\u670d\u52d9\u9810\u914d\u3002\nCloud DNS \u652f\u6301\u5b8c\u6574\u7684 [Kubernetes DNS \u898f\u7bc4](https://github.com/kubernetes/dns/blob/master/docs/specification.md) \uff0c\u4f75\u7232 GKE \u96c6\u7fa3\u4e2d\u7684 Service \u63d0\u4f9b A\u3001AAAA\u3001SRV \u548c PTR \u8a18\u9304\u7684\u89e3\u6790\u3002PTR \u8a18\u9304\u901a\u904e [\u97ff\u61c9\u653f\u7b56\u898f\u5247](https://cloud.google.com/dns/docs/zones/manage-response-policies?hl=zh-cn#managing_response_policy_rules) \u5be6\u73fe\u3002\n\u8207\u96c6\u7fa3\u8a17\u7ba1\u7684 DNS \u76f8\u6bd4\uff0c\u4f7f\u7528 Cloud DNS \u4f5c\u7232 GKE \u7684 DNS \u63d0\u4f9b\u5546\u5177\u6709\u8a31\u591a\u512a\u52e2\uff1a\n- \u79fb\u9664\u7ba1\u7406\u96c6\u7fa3\u8a17\u7ba1\u7684 DNS \u670d\u52d9\u5668\u7684\u958b\u92b7\u3002Cloud DNS \u4e0d\u9700\u8981\u64f4\u7e2e\u3001\u76e3\u63a7\u6216\u7ba1\u7406 DNS \u5be6\u4f8b\uff0c\u56e0\u7232\u5b83\u662f\u7531\u9ad8\u5ea6\u53ef\u64f4\u7e2e\u7684 Google \u57fa\u790e\u67b6\u69cb\u8a17\u7ba1\u7684\u5168\u8a17\u7ba1\u5f0f\u670d\u52d9\u3002\n- \u6bcf\u500b GKE \u7bc0\u9ede\u4e0a DNS \u67e5\u8a62\u7684\u672c\u5730\u89e3\u6790\u3002\u8207 [NodeLocal DNSCache](https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache?hl=zh-cn) \u985e\u4f3c\uff0cCloud DNS \u5728\u672c\u5730\u7de9\u5b58 DNS \u97ff\u61c9\uff0c\u63d0\u4f9b\u4f4e\u5ef6\u9072\u548c\u9ad8\u53ef\u4f38\u7e2e\u6027 DNS \u89e3\u6790\u3002\n- \u8207 [Google Cloud Observability](https://cloud.google.com/stackdriver/docs?hl=zh-cn) \u96c6\u6210\uff0c\u7528\u65bc DNS \u76e3\u63a7\u548c\u65e5\u8a8c\u8a18\u9304\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u5c08\u7528\u4ee3\u7ba1\u5340\u57df\u5553\u7528\u548c\u505c\u7528\u65e5\u8a8c\u8a18\u9304\u529f\u80fd](https://cloud.google.com/dns/docs/monitoring?hl=zh-cn#enabling_and_disabling_logging_for_private_managed_zones) \u3002\n### \u67b6\u69cb\n\u7576 Cloud DNS \u662f GKE \u7684 DNS \u63d0\u4f9b\u5546\u6642\uff0c\u63a7\u5236\u5668\u4f5c\u7232 GKE \u7ba1\u7406\u7684 Pod \u904b\u884c\u3002\u6b64 Pod \u5728\u96c6\u7fa3\u7684\u63a7\u5236\u5e73\u9762\u7bc0\u9ede\u4e0a\u904b\u884c\uff0c\u4e26\u5c07\u96c6\u7fa3 DNS \u8a18\u9304\u540c\u6b65\u5230\u4ee3\u7ba1\u5c08\u7528 DNS \u5340\u57df\u3002\n\u4e0b\u5716\u5c55\u793a\u4e86 Cloud DNS \u63a7\u5236\u5e73\u9762\u548c\u6578\u64da\u5e73\u9762\u5982\u4f55\u89e3\u6790\u96c6\u7fa3\u540d\u7a31\uff1a\n\u5728\u8a72\u5716\u4e2d\uff0cService `backend` \u9078\u64c7\u6b63\u5728\u904b\u884c\u7684 `backend` Pod\u3002 `clouddns-controller` \u7232 Service `backend` \u5275\u5efa DNS \u8a18\u9304\u3002\nPod `frontend` \u5411 [Compute Engine \u672c\u5730\u5143\u6578\u64da\u670d\u52d9\u5668](https://cloud.google.com/compute/docs/metadata/overview?hl=zh-cn) ( `169.254.169.254` ) \u767c\u9001 DNS \u8acb\u6c42\u4ee5\u89e3\u6790\u540d\u7232 `backend` \u7684 Service \u7684 IP \u5730\u5740\u3002\u5143\u6578\u64da\u670d\u52d9\u5668\u5728\u7bc0\u9ede\u4e0a\u672c\u5730\u904b\u884c\uff0c\u4e26\u5411 Cloud DNS \u767c\u9001\u672a\u547d\u4e2d\u7684\u7de9\u5b58\u3002\nCloud DNS \u6578\u64da\u5e73\u9762\u5728\u6bcf\u500b GKE \u7bc0\u9ede\u6216 Compute Engine \u865b\u64ec\u6a5f (VM) \u5be6\u4f8b\u4e2d\u672c\u5730\u904b\u884c\u3002\u6839\u64da Kubernetes Service \u7684\u985e\u578b\uff0cCloud DNS \u6703\u5c07 Service \u540d\u7a31\u89e3\u6790\u7232\u5176\u865b\u64ec IP \u5730\u5740\uff08\u5c0d\u65bc\u96c6\u7fa3 IP Service\uff09\u6216\u7aef\u9ede IP \u5730\u5740\u5217\u8868\uff08\u5c0d\u65bc\u7121\u982d Service\uff09\u3002\nPod `frontend` \u89e3\u6790 IP \u5730\u5740\u5f8c\uff0cPod \u53ef\u4ee5\u5c07\u6d41\u91cf\u767c\u9001\u5230 Service `backend` \u4ee5\u53ca Service \u5f8c\u9762\u7684\u4efb\u4f55 Pod\u3002\n**\u6ce8\u610f** \uff1akube-dns \u6703\u7e7c\u7e8c\u5728 1.19 \u53ca\u66f4\u9ad8\u7248\u672c\u7684\u5df2\u5553\u7528 Cloud DNS \u7684\u65b0 GKE \u548c\u73fe\u6709 GKE \u96c6\u7fa3\u4e0a\u904b\u884c\u3002\u60a8\u53ef\u4ee5\u901a\u904e [\u5c07 kube-dns Deployment \u548c\u81ea\u52d5\u64f4\u7e2e\u5668\u7e2e\u5bb9\u5230\u96f6](https://cloud.google.com/kubernetes-engine/docs/how-to/custom-kube-dns?hl=zh-cn#scaling_down_kube-dns) \u4f86\u505c\u7528 kube-dns\u3002\n### DNS \u7bc4\u570d\nCloud DNS \u6709\u5169\u7a2e\u7a2e\u985e\uff1a [DNS \u7bc4\u570d](https://cloud.google.com/dns/docs/scopes?hl=zh-cn) \u3001GKE \u96c6\u7fa3\u7bc4\u570d\u548c Virtual Private Cloud (VPC) \u7bc4\u570d\u3002\u96c6\u7fa3\u4e0d\u80fd\u540c\u6642\u5728\u9019\u5169\u7a2e\u6a21\u5f0f\u4e0b\u904b\u884c\u3002\n- [GKE \u96c6\u7fa3\u7bc4\u570d](#cluster_scope_dns) \uff1aDNS \u8a18\u9304\u53ea\u80fd\u5728\u96c6\u7fa3\u4e2d\u89e3\u6790\uff0c\u9019\u8207 kube-dns \u7684\u884c\u7232\u76f8\u540c\u3002\u53ea\u6709\u5728 GKE \u96c6\u7fa3\u4e2d\u904b\u884c\u7684\u7bc0\u9ede\u624d\u80fd\u89e3\u6790\u670d\u52d9\u540d\u7a31\u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u96c6\u7fa3\u7684 DNS \u540d\u7a31\u4ee5`*.cluster.local`\u7d50\u5c3e\u3002\u9019\u4e9b DNS \u540d\u7a31\u50c5\u5728\u96c6\u7fa3\u4e2d\u53ef\u898b\uff0c\u4e0d\u6703\u8207\u540c\u4e00\u9805\u76ee\u4e2d\u7684\u5176\u4ed6 GKE \u96c6\u7fa3\u7684`*.cluster.local`DNS \u540d\u7a31\u91cd\u758a\u6216\u885d\u7a81\u3002 **\u9019\u662f\u9ed8\u8a8d\u6a21\u5f0f** \u3002\n- [VPC \u7bc4\u570d](#vpc_scope_dns) \uff1aDNS \u8a18\u9304\u5728\u6574\u500b VPC \u4e2d\u53ef\u89e3\u6790\u3002Compute Engine \u865b\u64ec\u6a5f\u548c\u672c\u5730\u5ba2\u6236\u7aef\u53ef\u4ee5\u4f7f\u7528 Cloud Interconnect \u6216 Cloud VPN \u9032\u884c\u9023\u63a5\uff0c\u4e26\u76f4\u63a5\u89e3\u6790 GKE \u670d\u52d9\u540d\u7a31\u3002\u60a8\u5fc5\u9808\u7232\u6bcf\u500b\u96c6\u7fa3\u8a2d\u7f6e [\u552f\u4e00\u81ea\u5b9a\u7fa9\u7db2\u57df](#enable_scope_dns_in_an_existing_cluster) \uff0c\u9019\u610f\u5473\u7740\u6240\u6709 Service \u548c Pod DNS \u8a18\u9304\u5728 VPC \u4e2d\u90fd\u662f\u552f\u4e00\u7684\u3002\u6b64\u6a21\u5f0f\u53ef\u4ee5\u6e1b\u5c11 GKE \u8207\u975e GKE \u8cc7\u6e90\u4e4b\u9593\u7684\u901a\u4fe1\u885d\u7a81\u3002\n### Cloud DNS \u8cc7\u6e90\n\u4f7f\u7528 Cloud DNS \u4f5c\u7232 GKE \u96c6\u7fa3\u7684 DNS \u63d0\u4f9b\u5546\u6642\uff0cCloud DNS \u63a7\u5236\u5668\u6703\u5728 Cloud DNS \u4e2d\u7232\u60a8\u7684\u9805\u76ee\u5275\u5efa\u8cc7\u6e90\u3002GKE \u5275\u5efa\u7684\u8cc7\u6e90\u53d6\u6c7a\u65bc Cloud DNS \u7bc4\u570d\u3002\n| \u7bc4\u570d  | \u6b63\u5411\u67e5\u627e\u5340\u57df             | \u53cd\u5411\u67e5\u627e\u5340\u57df              |\n|:---------|:--------------------------------------------------------------|:------------------------------------------------------------------|\n| \u96c6\u7fa3\u7bc4\u570d | \u6bcf\u500b Compute Engine \u5340\u57df\u7684\u6bcf\u500b\u96c6\u7fa3\u6709 1 \u500b\u5c08\u7528\u5340\u57df\uff08\u5728\u5730\u5340\u4e2d\uff09 | \u6bcf\u500b Compute Engine \u5340\u57df\u7684\u6bcf\u500b\u96c6\u7fa3\u6709 1 \u500b\u97ff\u61c9\u653f\u7b56\u5340\u57df\uff08\u5728\u5730\u5340\u4e2d\uff09 |\n| VPC \u7bc4\u570d | \u6bcf\u500b\u96c6\u7fa3\u6709 1 \u500b\u5c08\u7528\u5340\u57df\uff08\u5168\u7403\u5340\u57df\uff09       | \u6bcf\u500b\u96c6\u7fa3\u6709 1 \u500b\u97ff\u61c9\u653f\u7b56\u5340\u57df\uff08\u5168\u7403\u5340\u57df\uff09       |\n\u9019\u4e9b Cloud DNS \u8cc7\u6e90\u4f7f\u7528\u7684\u547d\u540d\u6163\u4f8b\u5982\u4e0b\uff1a\n| \u7bc4\u570d  | \u6b63\u5411\u67e5\u627e\u5340\u57df      | \u53cd\u5411\u67e5\u627e\u5340\u57df      |\n|:---------|:----------------------------------|:---------------------------------|\n| \u96c6\u7fa3\u7bc4\u570d | gke-CLUSTER_NAME-CLUSTER_HASH-dns | gke-CLUSTER_NAME-CLUSTER_HASH-rp |\n| VPC \u7bc4\u570d | gke-CLUSTER_NAME-CLUSTER_HASH-dns | gke-NETWORK_NAME_HASH-rp   |\n\u9664\u4e86\u4e0a\u8868\u63d0\u5230\u7684\u5340\u57df\u4e4b\u5916\uff0cCloud DNS \u63a7\u5236\u5668\u9084\u6703\u6839\u64da\u60a8\u7684\u914d\u7f6e\u5728\u9805\u76ee\u4e2d\u5275\u5efa\u4ee5\u4e0b\u5340\u57df\uff1a\n| \u81ea\u5b9a\u7fa9 DNS \u914d\u7f6e  | \u5340\u57df\u985e\u578b   | \u5340\u57df\u547d\u540d\u6163\u4f8b         |\n|:---------------------|:-----------------|:-----------------------------------------------|\n| \u5b58\u6839\u7db2\u57df    | \u8f49\u767c\uff08\u5168\u7403\u5340\u57df\uff09 | gke-CLUSTER_NAME-CLUSTER_HASH-DOMAIN_NAME_HASH |\n| \u81ea\u5b9a\u7fa9\u4e0a\u6e38\u57df\u540d\u670d\u52d9\u5668 | \u8f49\u767c\uff08\u5168\u7403\u5340\u57df\uff09 | gke-CLUSTER_NAME-CLUSTER_HASH-upstream   |\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5275\u5efa\u81ea\u5b9a\u7fa9\u5b58\u6839\u7db2\u57df\u6216\u81ea\u5b9a\u7fa9\u4e0a\u6e38\u57df\u540d\u670d\u52d9\u5668\uff0c\u8acb\u53c3\u95b1 [\u7232\u5b58\u6839\u7db2\u57df\u6dfb\u52a0\u81ea\u5b9a\u7fa9\u89e3\u6790\u5668](https://cloud.google.com/kubernetes-engine/docs/how-to/kube-dns?hl=zh-cn#adding_custom_resolvers_for_stub_domains) \u3002\n\u7232\u4e86\u8655\u7406\u5167\u90e8 DNS \u6d41\u91cf\uff0cCloud DNS \u63a7\u5236\u5668\u6703\u5728\u96c6\u7fa3\u6240\u5c6c\u5730\u5340\u7684\u6bcf\u500b Compute Engine \u5340\u57df\u4e2d\u5275\u5efa\u4e00\u500b [\u4ee3\u7ba1 DNS \u5340\u57df](https://cloud.google.com/dns/docs/zones/zones-overview?hl=zh-cn) \u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5728 `us-central1-c` \u5340\u57df\u4e2d\u90e8\u7f72\u96c6\u7fa3\uff0c\u5247 Cloud DNS \u63a7\u5236\u5668\u6703\u5728 `us-central1-a` \u3001 `us-central1-b` \u3001 `us-central1-c` \u548c `us-central1-f` \u4e2d\u5275\u5efa\u4ee3\u7ba1\u5340\u57df\u3002\n\u5c0d\u65bc\u6bcf\u500b DNS `stubDomain` \uff0cCloud DNS \u63a7\u5236\u5668\u90fd\u6703\u5275\u5efa\u4e00\u500b\u8f49\u767c\u5340\u57df\u3002\nCloud DNS \u4f7f\u7528\u5177\u6709 `.` DNS \u540d\u7a31\u7684\u4e00\u500b\u4ee3\u7ba1\u5340\u57df\u8655\u7406\u6bcf\u500b\u4e0a\u6e38 DNS\u3002\n## \u50f9\u683c\n\u7576 Cloud DNS \u662f GKE Standard \u96c6\u7fa3\u7684 DNS \u63d0\u4f9b\u5546\u6642\uff0c\u4f86\u81ea GKE \u96c6\u7fa3\u5167 Pod \u7684 DNS \u67e5\u8a62\u6839\u64da [Cloud DNS \u50f9\u683c](https://cloud.google.com/dns/pricing?hl=zh-cn) \u7d50\u7b97\u3002\n\u5c0d\u7531 GKE \u7ba1\u7406\u7684 VPC \u7d1a DNS \u5340\u57df\u7684\u67e5\u8a62\u6309\u6a19\u6e96 Cloud DNS \u50f9\u683c\u8a08\u8cbb\u3002\n## \u4f7f\u7528\u8981\u6c42\nCloud DNS for GKE \u5c0d\u96c6\u7fa3\u7bc4\u570d\u5177\u6709\u4ee5\u4e0b\u8981\u6c42\uff1a\n- \u5c0d\u65bc\u6a19\u6e96\u7248\uff0c\u9700\u8981 GKE 1.24.7-gke.800\u30011.25.3-gke.700 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- \u5c0d\u65bc Autopilot\uff0c\u9700\u8981 GKE 1.25.9-gke.400\u30011.26.4-gke.500 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- Google Cloud CLI 411.0.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- \u5fc5\u9808\u5728\u9805\u76ee\u4e2d\u5553\u7528 Cloud DNS API\u3002\nCloud DNS for GKE \u5c0d VPC \u7bc4\u570d\u5177\u6709\u4ee5\u4e0b\u8981\u6c42\uff1a\n- \u5c0d\u65bc\u6a19\u6e96\u7248\uff0c\u9700\u8981 GKE 1.19 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- Google Cloud CLI 364.0.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n- \u5fc5\u9808\u5728\u9805\u76ee\u4e2d\u5553\u7528 Cloud DNS API\u3002## \u9650\u5236\u548c\u4fb7\u9650\n\u5b58\u5728\u4ee5\u4e0b\u9650\u5236\uff1a\n- Autopilot \u96c6\u7fa3\u4e0d\u652f\u6301 VPC \u7bc4\u570d\uff0c\u50c5\u652f\u6301\u96c6\u7fa3\u7bc4\u570d\u3002\n- Cloud DNS \u4e0d\u7b26\u5408\u5f71\u97ff\u7d1a\u5225 4 (IL4) \u5408\u898f\u6027\u5236\u5ea6\u3002Cloud DNS for GKE \u4e0d\u80fd\u5728 IL4 \u5408\u898f\u6027\u5236\u5ea6\u7684 [Assured Workload \u74b0\u5883](https://cloud.google.com/assured-workloads/docs/key-concepts?hl=zh-cn#environments) \u4e2d\u4f7f\u7528\u3002\u60a8\u9700\u8981\u5728\u6b64\u985e\u53d7\u76e3\u7ba1\u74b0\u5883\u4e2d\u4f7f\u7528 kube-dns\u3002\u5c0d\u65bc GKE Autopilot \u96c6\u7fa3\uff0c\u7cfb\u7d71\u6703\u6839\u64da\u60a8\u7684\u5408\u898f\u6027\u5236\u5ea6\u81ea\u52d5\u9078\u64c7 kube-dns \u6216 Cloud DNS\u3002\n- \u5c0d\u4ee3\u7ba1\u5c08\u7528 DNS \u5340\u57df\u6240\u505a\u7684\u624b\u52d5\u66f4\u6539\u4e0d\u53d7\u652f\u6301\uff0c\u6703\u88ab Cloud DNS \u63a7\u5236\u5668\u8986\u84cb\u3002\u63a7\u5236\u5668\u91cd\u5553\u6642\u4e0d\u6703\u4fdd\u7559\u9019\u4e9b\u5340\u57df\u4e2d\u7684 DNS \u8a18\u9304\u4fee\u6539\u3002\n- \u5728\u96c6\u7fa3\u4e2d\u5553\u7528 Cloud DNS for GKE \u5f8c\uff0ckube-dns \u6703\u7e7c\u7e8c\u5728\u96c6\u7fa3\u4e2d\u904b\u884c\u3002\u60a8\u53ef\u4ee5\u901a\u904e [\u5c07 kube-dns Deployment \u548c\u81ea\u52d5\u64f4\u7e2e\u5668\u7e2e\u5bb9\u5230\u96f6](https://cloud.google.com/kubernetes-engine/docs/how-to/custom-kube-dns?hl=zh-cn#scaling_down_kube-dns) \u4f86\u505c\u7528 kube-dns\u3002\n- \u4f7f\u7528`--cluster-dns-scope`\u6a19\u8a8c\u8a2d\u7f6e\u7bc4\u570d\u5f8c\uff0c\u60a8\u5c07\u7121\u6cd5\u66f4\u6539\u96c6\u7fa3\u4e2d\u7684 [DNS \u7bc4\u570d](#dns-scopes) \u3002\u5982\u679c\u60a8\u9700\u8981\u66f4\u6539 DNS \u7bc4\u570d\uff0c\u8acb\u4f7f\u7528\u5176\u4ed6 DNS \u7bc4\u570d\u91cd\u65b0\u5275\u5efa\u96c6\u7fa3\u3002\n- [\u81ea\u5b9a\u7fa9\u5b58\u6839\u7db2\u57df\u548c\u4e0a\u6e38 DNS \u670d\u52d9\u5668\u914d\u7f6e](#supporting_custom_stub_domains_and_upstream_nameservers) \u9069\u7528\u65bc Pod \u548c\u7bc0\u9ede\u7684 DNS \u914d\u7f6e\u3002\u4f7f\u7528\u4e3b\u6a5f\u7db2\u7d61\u6216\u76f4\u63a5\u5728\u4e3b\u6a5f\u4e0a\u904b\u884c\u7684\u9032\u7a0b\u7684 Pod \u4e5f\u6703\u4f7f\u7528\u5b58\u6839\u7db2\u57df\u548c\u4e0a\u6e38\u57df\u540d\u670d\u52d9\u5668\u914d\u7f6e\u3002 \u50c5 Standard \u652f\u6301\u6b64\u529f\u80fd\u3002\n- \u901a\u904e [kube-dns Configmap](https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/) \u914d\u7f6e\u7684\u81ea\u5b9a\u7fa9\u5b58\u6839\u7db2\u57df\u548c\u4e0a\u6e38\u57df\u540d\u670d\u52d9\u5668\u6703\u81ea\u52d5\u61c9\u7528\u65bc Cloud DNS \u4ee5\u7372\u53d6\u96c6\u7fa3\u7bc4\u570d DNS\u3002VPC \u7bc4\u570d DNS \u6703\u5ffd\u7565 kube-dns ConfigMap\uff0c\u60a8\u5fc5\u9808\u76f4\u63a5\u5728 Cloud DNS \u4e0a\u61c9\u7528\u9019\u4e9b\u914d\u7f6e\u3002 \u50c5 Standard \u652f\u6301\u6b64\u529f\u80fd\u3002\n- \u5f9e kube-dns \u5230 VPC \u7bc4\u570d\u6c92\u6709\u9077\u79fb\u8def\u5f91\uff0c\u64cd\u4f5c\u662f\u4e2d\u65b7\u6027\u7684\u3002\u5f9e kube-dns \u5207\u63db\u5230 VPC \u7bc4\u570d\u6216\u5f9e VPC \u7bc4\u570d\u5207\u63db\u5230 kube-dns \u6642\u91cd\u65b0\u5275\u5efa\u96c6\u7fa3\u3002\n- \u5c0d\u65bc VPC \u7bc4\u570d\uff0cService \u7684\u6b21\u8981 IP \u5730\u5740\u7bc4\u570d\u4e0d\u5f97\u8207\u8a72\u5b50\u7db2\u4e2d\u7684\u4efb\u4f55\u5176\u4ed6\u96c6\u7fa3\u5171\u4eab\u3002\n- \u5c0d\u65bc VPC \u7bc4\u570d\uff0c\u8207 PTR \u8a18\u9304\u95dc\u806f\u7684\u97ff\u61c9\u653f\u7b56\u6703\u9644\u52a0\u5230 VPC \u7db2\u7d61\u3002\u5982\u679c\u6709\u4efb\u4f55\u5176\u4ed6\u97ff\u61c9\u653f\u7b56\u7d81\u5b9a\u5230\u96c6\u7fa3\u7db2\u7d61\uff0c\u5247 PTR \u8a18\u9304\u89e3\u6790\u5c07\u4e0d\u9069\u7528\u65bc Kubernetes \u670d\u52d9 IP \u5730\u5740\u3002\n- \u5982\u679c\u60a8\u5617\u8a66\u5275\u5efa\u7121\u982d Service\uff0c\u4f46\u4f7f\u7528\u7684 Pod \u6578\u91cf\u8d85\u51fa\u5141\u8a31\u7684\u914d\u984d\uff0cCloud DNS \u4e0d\u6703\u7232\u8a72 Service \u5275\u5efa\u8a18\u9304\u96c6\u6216\u8a18\u9304\u3002\n- \u5f9e kube-dns \u5207\u63db\u5230 Cloud DNS VPC \u7bc4\u570d\u662f\u4e2d\u65b7\u6027\u64cd\u4f5c\u3002\u6211\u5011\u5efa\u8b70\u60a8\u5728\u7dad\u8b77\u7a97\u53e3\u5167\u57f7\u884c\u6b64\u64cd\u4f5c\u3002\n### \u914d\u984d\nCloud DNS \u4f7f\u7528\u914d\u984d\u4f86\u9650\u5236 GKE \u53ef\u7232 DNS \u689d\u76ee\u5275\u5efa\u7684\u8cc7\u6e90\u6578\u91cf\u3002 [Cloud DNS \u7684\u914d\u984d\u548c\u9650\u5236](https://cloud.google.com/dns/quotas?hl=zh-cn) \u53ef\u80fd\u8207\u9805\u76ee\u7684 kube-dns \u9650\u5236\u4e0d\u540c\u3002\n\u4f7f\u7528 Cloud DNS for GKE \u6642\uff0c\u7cfb\u7d71\u6703\u7232\u9805\u76ee\u4e2d\u7684\u6bcf\u500b\u4ee3\u7ba1\u5340\u57df\u61c9\u7528\u4ee5\u4e0b\u9ed8\u8a8d\u914d\u984d\uff1a\n| Kubernetes DNS \u8cc7\u6e90     | \u76f8\u61c9\u7684 Cloud DNS \u8cc7\u6e90 | \u914d\u984d                    |\n|:---------------------------------------|:-------------------------|:----------------------------------------------------------------------------------|\n| DNS \u8a18\u9304\u6578        | \u6bcf\u500b\u4ee3\u7ba1\u5340\u57df\u7684\u5b57\u7bc0\u6578\u4e0a\u9650 | 2,000,000\uff08\u4ee3\u7ba1\u5340\u57df\u6700\u5927 50MB\uff09             |\n| \u6bcf\u500b\u7121\u982d Service \u7684 Pod \u6578 (IPv4/IPv6) | \u6bcf\u500b\u8cc7\u6e90\u8a18\u9304\u96c6\u7684\u8a18\u9304\u6578 | GKE 1.24 \u5230 1.25\uff1a1,000 (IPv4/IPv6) GKE 1.26 \u53ca\u66f4\u9ad8\u7248\u672c\uff1a3,500/2,000 (IPv4/IPv6) |\n| \u9805\u76ee\u4e2d\u7684 GKE \u96c6\u7fa3\u6578\u91cf     | \u6bcf\u500b\u9805\u76ee\u7684\u97ff\u61c9\u653f\u7b56\u6578  | 100                    |\n| \u6bcf\u500b\u96c6\u7fa3\u7684 PTR \u8a18\u9304\u6578     | \u6bcf\u9805\u97ff\u61c9\u653f\u7b56\u7684\u898f\u5247\u6578  | 100000                   |\n**\u6ce8\u610f** \uff1a\u5c0d\u65bc VPC \u7bc4\u570d\uff0c\u9069\u7528\u65bc\u6574\u500b VPC \u7684\u4ee3\u7ba1\u5340\u57df\u8a2d\u6709\u76f8\u540c\u7684\u9650\u5236\u3002\u9019\u4e9b\u914d\u984d\u9069\u7528\u65bc\u4f7f\u7528 Cloud DNS VPC \u7bc4\u570d\u4e26\u5728\u540c\u4e00 VPC \u4e2d\u904b\u884c\u7684\u4e00\u7d44\u96c6\u7fa3\u3002\n### \u8cc7\u6e90\u9650\u5236\n\u60a8\u7232\u6bcf\u500b\u96c6\u7fa3\u5275\u5efa\u7684 Kubernetes \u8cc7\u6e90\u6703\u8a08\u5165 [Cloud DNS \u8cc7\u6e90\u9650\u5236](https://cloud.google.com/dns/quotas?hl=zh-cn#resource_limits) \uff0c\u5982\u4e0b\u8868\u6240\u793a\uff1a\n| \u9650\u5236       | \u8a08\u5165\u9650\u5236                               |\n|:-----------------------------|:------------------------------------------------------------------------------------------------------------------------------------|\n| \u6bcf\u500b\u4ee3\u7ba1\u53ef\u7528\u5340\u7684\u8cc7\u6e90\u8a18\u9304\u96c6\u6578 | \u6bcf\u500b\u96c6\u7fa3\u7684\u670d\u52d9\u6578\u52a0\u4e0a\u5177\u6709\u6709\u6548\u4e3b\u6a5f\u540d\u7684\u7121\u982d\u670d\u52d9\u7aef\u9ede\u6578\u3002                    |\n| \u6bcf\u500b\u8cc7\u6e90\u8a18\u9304\u96c6\u7684\u8a18\u9304\u6578  | \u6bcf\u500b\u7121\u982d\u670d\u52d9\u7684\u7aef\u9ede\u6578\u3002\u4e0d\u6703\u5f71\u97ff\u5176\u4ed6\u670d\u52d9\u985e\u578b\u3002                      |\n| \u6bcf\u9805\u97ff\u61c9\u653f\u7b56\u7684\u898f\u5247\u6578   | \u5c0d\u65bc\u96c6\u7fa3\u7bc4\u570d\uff0c\u6bcf\u500b\u96c6\u7fa3\u7684\u670d\u52d9\u6578\u52a0\u4e0a\u5177\u6709\u6709\u6548\u4e3b\u6a5f\u540d\u7684\u7121\u982d\u670d\u52d9\u7aef\u9ede\u6578\u3002\u5c0d\u65bc VPC \u7bc4\u570d\uff0cVPC \u4e2d\u6240\u6709\u96c6\u7fa3\u7684\u670d\u52d9\u6578\u52a0\u4e0a\u5177\u6709\u4e3b\u6a5f\u540d\u7684\u7121\u982d\u7aef\u9ede\u6578\u3002 |\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u7232 Kubernetes \u5275\u5efa DNS \u8a18\u9304\uff0c\u8acb\u53c3\u95b1 [Kubernetes \u57fa\u65bc DNS \u7684\u670d\u52d9\u767c\u73fe](https://github.com/kubernetes/dns/blob/master/docs/specification.md) \u3002\n## \u6e96\u5099\u5de5\u4f5c\n\u5728\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u57f7\u884c\u4ee5\u4e0b\u4efb\u52d9\uff1a\n- \u5553\u7528 Google Kubernetes Engine API\u3002\n- [  \u5553\u7528 Google Kubernetes Engine API ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com&hl=zh-cn) \n- \u5982\u679c\u60a8\u8981\u4f7f\u7528 Google Cloud CLI \u57f7\u884c\u6b64\u4efb\u52d9\uff0c\u8acb [\u5b89\u88dd](https://cloud.google.com/sdk/docs/install?hl=zh-cn) \u4e26 [\u521d\u59cb\u5316](https://cloud.google.com/sdk/docs/initializing?hl=zh-cn) gcloud CLI\u3002 \u5982\u679c\u60a8\u4e4b\u524d\u5b89\u88dd\u4e86 gcloud CLI\uff0c\u8acb\u904b\u884c`gcloud components update`\u4ee5\u7372\u53d6\u6700\u65b0\u7248\u672c\u3002 **\u6ce8\u610f** \uff1a\u5c0d\u65bc\u73fe\u6709 gcloud CLI \u5b89\u88dd\uff0c\u8acb\u52d9\u5fc5\u8a2d\u7f6e`compute/region`\u548c`compute/zone` [\u5c6c\u6027](https://cloud.google.com/sdk/docs/properties?hl=zh-cn#setting_properties) \u3002\u901a\u904e\u8a2d\u7f6e\u9ed8\u8a8d\u4f4d\u7f6e\uff0c\u60a8\u53ef\u4ee5\u907f\u514d gcloud CLI \u4e2d\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a`One of [--zone, --region] must be supplied: Please specify location`\u3002\n- \u5728\u60a8\u7684\u9805\u76ee\u4e2d\u5553\u7528 Cloud DNS API\u3002 [\u5553\u7528 Cloud DNS API](https://console.cloud.google.com/apis/library/dns.googleapis.com?hl=zh-cn) ## \u5553\u7528\u96c6\u7fa3\u7bc4\u570d DNS\n\u5728\u96c6\u7fa3\u7bc4\u570d DNS \u4e2d\uff0c\u53ea\u6709\u5728 GKE \u96c6\u7fa3\u4e2d\u904b\u884c\u7684\u7bc0\u9ede\u624d\u80fd\u89e3\u6790\u670d\u52d9\u540d\u7a31\uff0c\u4e26\u4e14\u670d\u52d9\u540d\u7a31\u5728\u96c6\u7fa3\u4e4b\u9593\u4e0d\u6703\u885d\u7a81\u3002\u6b64\u884c\u7232\u8207 GKE \u96c6\u7fa3\u4e2d\u7684 kube-dns \u76f8\u540c\uff0c\u9019\u610f\u5473\u7740\u60a8\u53ef\u4ee5\u5c07\u96c6\u7fa3\u5f9e kube-dns \u9077\u79fb\u5230 Cloud DNS \u96c6\u7fa3\u7bc4\u570d\uff0c\u800c\u7121\u9700\u505c\u6a5f\u6216\u66f4\u6539\u60a8\u7684\u61c9\u7528\u3002\n\u4e0b\u5716\u5c55\u793a\u4e86 Cloud DNS \u5982\u4f55\u7232 GKE \u96c6\u7fa3\u5275\u5efa\u5c08\u7528 DNS \u5340\u57df\u3002\u53ea\u6709\u5728\u96c6\u7fa3\u7bc0\u9ede\u4e0a\u904b\u884c\u7684\u9032\u7a0b\u548c Pod \u624d\u80fd\u89e3\u6790\u96c6\u7fa3\u7684 DNS \u8a18\u9304\uff0c\u56e0\u7232\u53ea\u6709\u7bc0\u9ede\u4f4d\u65bc DNS \u7bc4\u570d\u5167\u3002### \u5728\u65b0\u96c6\u7fa3\u4e2d\u5553\u7528\u96c6\u7fa3\u7bc4\u570d DNS\n**GKE Autopilot \u96c6\u7fa3**\n1.25.9-gke.400\u30011.26.4-gke.500 \u6216\u66f4\u9ad8\u7248\u672c\u7684\u65b0 Autopilot \u96c6\u7fa3\u9ed8\u8a8d\u4f7f\u7528 Cloud DNS \u96c6\u7fa3\u7bc4\u570d\u3002\n**GKE Standard \u96c6\u7fa3**\n\u60a8\u53ef\u4ee5\u4f7f\u7528 gcloud CLI \u6216 Google Cloud \u63a7\u5236\u6aaf\u5275\u5efa\u5553\u7528 Cloud DNS \u96c6\u7fa3\u7bc4\u570d\u7684 GKE Standard \u96c6\u7fa3\uff1a\n\u4f7f\u7528 `--cluster-dns` \u6a19\u8a8c\u5275\u5efa\u96c6\u7fa3\uff1a\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --cluster-dns=clouddns \\\u00a0 \u00a0 --cluster-dns-scope=cluster \\\u00a0 \u00a0 --location=COMPUTE_LOCATION\n```\n **\u6ce8\u610f** \uff1a\u5c0d\u65bc\u4f4e\u65bc 411.0.0 \u7684 Google Cloud CLI \u7248\u672c\uff0c\u8acb\u4f7f\u7528 `gcloud beta container` \u800c\u4e0d\u662f `gcloud container` \u3002\n\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u96c6\u7fa3\u7684 [Compute Engine \u4f4d\u7f6e](https://cloud.google.com/compute/docs/regions-zones/viewing-regions-zones?hl=zh-cn) \u3002\n`--cluster-dns-scope=cluster` \u6a19\u8a8c\u5728\u547d\u4ee4\u4e2d\u662f\u53ef\u9078\u7684\uff0c\u56e0\u7232 `cluster` \u662f\u9ed8\u8a8d\u503c\u3002- \u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **Google Kubernetes Engine** \u9801\u9762\u3002 [\u8f49\u5230 Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa** \u3002\n- \u5728\u5c0e\u822a\u7a97\u683c\u7684 **\u96c6\u7fa3** \u4e0b\uff0c\u9ede\u64ca **\u7db2\u7d61** \u3002\n- \u5728 **DNS \u63d0\u4f9b\u5546** \u90e8\u5206\uff0c\u9ede\u64ca **Cloud DNS** \u3002\n- \u9078\u64c7 **\u96c6\u7fa3\u7bc4\u570d** \u3002\n- \u6839\u64da\u9700\u8981\u914d\u7f6e\u96c6\u7fa3\u3002\n- \u9ede\u64ca **\u5275\u5efa** \u3002\n### \u5728\u73fe\u6709\u96c6\u7fa3\u4e2d\u5553\u7528\u96c6\u7fa3\u7bc4\u570d DNS\n**GKE Autopilot \u96c6\u7fa3**\n\u60a8\u7121\u6cd5\u5c07\u73fe\u6709 GKE Autopilot \u96c6\u7fa3\u5f9e kube-dns \u9077\u79fb\u5230 Cloud DNS \u96c6\u7fa3\u7bc4\u570d\u3002\u5982\u9700\u5553\u7528 Cloud DNS \u96c6\u7fa3\u7bc4\u570d\uff0c\u8acb\u91cd\u65b0\u5275\u5efa 1.25.9-gke.400\u30011.26.4-gke.500 \u6216\u66f4\u9ad8\u7248\u672c\u7684 Autopilot \u96c6\u7fa3\u3002\n**GKE Standard \u96c6\u7fa3**\n\u60a8\u53ef\u4ee5\u5728 GKE Standard \u96c6\u7fa3\u4e2d\u4f7f\u7528 gcloud CLI \u6216 Google Cloud \u63a7\u5236\u6aaf\u5c07\u73fe\u6709 GKE Standard \u96c6\u7fa3\u5f9e kube-dns \u9077\u79fb\u5230 Cloud DNS \u96c6\u7fa3\u7bc4\u570d\u3002\n\u9077\u79fb\u73fe\u6709\u96c6\u7fa3\u6642\uff0c\u9664\u975e\u60a8\u91cd\u65b0\u5275\u5efa\u7bc0\u9ede\uff0c\u5426\u5247\u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u4e0d\u6703\u5c07 Cloud DNS \u7528\u4f5c DNS \u63d0\u4f9b\u5546\u3002\n\u7232\u96c6\u7fa3\u5553\u7528 Cloud DNS \u5f8c\uff0c\u76f8\u61c9\u8a2d\u7f6e\u50c5\u5728\u60a8\u5347\u7d1a\u73fe\u6709\u7bc0\u9ede\u6c60\u6216\u5411\u96c6\u7fa3\u6dfb\u52a0\u65b0\u7bc0\u9ede\u6c60\u6642\u9069\u7528\u3002\u5347\u7d1a\u7bc0\u9ede\u6c60\u6642\uff0c\u7cfb\u7d71\u6703\u91cd\u65b0\u5275\u5efa\u7bc0\u9ede\u3002\n\u60a8\u9084\u53ef\u4ee5\u901a\u904e\u55ae\u7368\u5c07 Cloud DNS \u4f5c\u7232\u6bcf\u500b\u7bc0\u9ede\u6c60\u4e2d\u7684 DNS \u63d0\u4f9b\u5546\u4f86\u9077\u79fb\u5177\u6709\u6b63\u5728\u904b\u884c\u61c9\u7528\u7684\u96c6\u7fa3\uff0c\u800c\u4e0d\u6703\u4e2d\u65b7\u96c6\u7fa3\u901a\u4fe1\u3002\u90e8\u5206\u7bc0\u9ede\u59cb\u7d42\u8655\u65bc\u904b\u884c\u72c0\u614b\uff0c\u56e0\u7232\u67d0\u4e9b\u7bc0\u9ede\u6c60\u4f7f\u7528 kube-dns \u800c\u90e8\u5206\u7bc0\u9ede\u6c60\u4f7f\u7528 Cloud DNS\u3002\n\u5728\u4ee5\u4e0b\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u7232\u96c6\u7fa3\u5553\u7528 Cloud DNS\uff0c\u7136\u5f8c\u5347\u7d1a\u7bc0\u9ede\u6c60\u3002\u5347\u7d1a\u7bc0\u9ede\u6c60\u6703\u91cd\u65b0\u5275\u5efa\u7bc0\u9ede\u3002\u7136\u5f8c\uff0c\u7bc0\u9ede\u4f7f\u7528 Cloud DNS \u800c\u4e0d\u662f kube-dns \u9032\u884c DNS \u89e3\u6790\u3002\n- \u66f4\u65b0\u73fe\u6709\u96c6\u7fa3\uff1a```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --cluster-dns=clouddns \\\u00a0 \u00a0 --cluster-dns-scope=cluster \\\u00a0 \u00a0 --location=COMPUTE_LOCATION\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u96c6\u7fa3\u7684 [Compute Engine \u4f4d\u7f6e](https://cloud.google.com/compute/docs/regions-zones/viewing-regions-zones?hl=zh-cn) \u3002\n\u97ff\u61c9\u985e\u4f3c\u65bc\u4ee5\u4e0b\u793a\u4f8b\uff1a```\nAll the node-pools in the cluster need to be re-created by the user to start using Cloud DNS for DNS lookups. It is highly recommended to complete this step\nshortly after enabling Cloud DNS.\nDo you want to continue (Y/n)?\n```\u78ba\u8a8d\u5f8c\uff0cCloud DNS \u63a7\u5236\u5668\u6703\u5728 GKE \u63a7\u5236\u5e73\u9762\u4e0a\u904b\u884c\uff0c\u4f46\u60a8\u7684 Pod \u4e0d\u6703\u4f7f\u7528 Cloud DNS \u9032\u884c DNS \u89e3\u6790\uff0c\u9664\u975e\u60a8\u5347\u7d1a\u7bc0\u9ede\u6c60\u6216\u5411\u96c6\u7fa3\u6dfb\u52a0\u65b0\u7684\u7bc0\u9ede\u6c60\u3002\n- \u5347\u7d1a\u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u6c60\u4ee5\u4f7f\u7528 Cloud DNS\uff1a```\ngcloud container clusters upgrade CLUSTER_NAME \\\u00a0 \u00a0 --node-pool=POOL_NAME \\\u00a0 \u00a0 --location=COMPUTE_LOCATION\n``` **\u6ce8\u610f** \uff1a\u5c0d\u65bc\u4f4e\u65bc 411.0.0 \u7684 Google Cloud CLI \u7248\u672c\uff0c\u8acb\u4f7f\u7528 `gcloud beta container` \u800c\u4e0d\u662f `gcloud container` \u3002\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8981\u5347\u7d1a\u7684\u7bc0\u9ede\u6c60\u7684\u540d\u7a31\u3002\n\u5982\u679c\u7bc0\u9ede\u6c60\u548c\u63a7\u5236\u5e73\u9762\u904b\u884c\u76f8\u540c\u7684\u7248\u672c\uff0c\u8acb\u5148\u5347\u7d1a\u63a7\u5236\u5e73\u9762\uff08\u5982 [\u624b\u52d5\u5347\u7d1a\u63a7\u5236\u5e73\u9762](https://cloud.google.com/kubernetes-engine/docs/how-to/upgrading-a-cluster?hl=zh-cn#upgrade_cp) \u4e2d\u6240\u8ff0\uff09\uff0c\u7136\u5f8c\u57f7\u884c\u7bc0\u9ede\u6c60\u5347\u7d1a\u3002 **\u6ce8\u610f** \uff1a\u5347\u7d1a\u5230\u7bc0\u9ede\u6c60\u7576\u524d\u904b\u884c\u7684\u7248\u672c\u5c0d Pod \u6c92\u6709\u5f71\u97ff\u3002\u5c0d\u65bc\u6b64\u985e\u7bc0\u9ede\u6c60\uff0c\u5728\u9019\u4e9b\u7bc0\u9ede\u4e0a\u904b\u884c\u7684 Pod \u4ecd\u4f7f\u7528 kube-dns\u3002\u5c07 kube-dns \u90e8\u7f72\u548c\u81ea\u52d5\u64f4\u7e2e\u5668\u7e2e\u6e1b\u7232\u96f6\u6703\u5c0e\u81f4\u9019\u4e9b Pod \u7684 DNS \u5931\u6557\u3002\u7232\u4e86\u8b93 Pod \u4f7f\u7528 Cloud DNS\uff0c\u60a8\u5fc5\u9808\u5c07\u7bc0\u9ede\u6c60\u5347\u7d1a\u5230\u65b0\u7248\u672c\u3002\u6216\u8005\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5275\u5efa\u76f8\u540c\u7248\u672c\u7684\u65b0\u7bc0\u9ede\u6c60\u3002\u78ba\u8a8d\u97ff\u61c9\u4f75\u7232\u96c6\u7fa3\u4e2d\u7684\u6bcf\u500b\u7bc0\u9ede\u6c60\u91cd\u8907\u6b64\u547d\u4ee4\u3002\u5982\u679c\u96c6\u7fa3\u53ea\u6709\u4e00\u500b\u7bc0\u9ede\u6c60\uff0c\u8acb\u7701\u7565 `--node-pool` \u6a19\u8a8c\u3002\n- \u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **Google Kubernetes Engine** \u9801\u9762\u3002 [\u8f49\u5230 Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list?hl=zh-cn) \n- \u9ede\u64ca\u8981\u4fee\u6539\u7684\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \u5728 **\u7db2\u7d61** \u4e0b\u7684 **DNS \u63d0\u4f9b\u5546** \u5b57\u6bb5\u4e2d\uff0c\u9ede\u64ca **\u4fee\u6539 DNS \u63d0\u4f9b\u5546** \u3002\n- \u9ede\u64ca **Cloud DNS** \u3002\n- \u9ede\u64ca **\u96c6\u7fa3\u7bc4\u570d** \u3002\n- \u9ede\u64ca **\u4fdd\u5b58\u66f4\u6539** \u3002## \u5553\u7528 VPC \u7bc4\u570d DNS\n\u5728 VPC \u7bc4\u570d\u7684 DNS \u4e2d\uff0c\u96c6\u7fa3\u7684 DNS \u540d\u7a31\u53ef\u5728\u6574\u500b VPC \u5167\u9032\u884c\u89e3\u6790\u3002VPC \u4e2d\u7684\u4efb\u4f55\u5ba2\u6236\u7aef\u90fd\u53ef\u4ee5\u89e3\u6790\u96c6\u7fa3 DNS \u8a18\u9304\u3002\nVPC \u7bc4\u570d DNS \u53ef\u5be6\u73fe\u4ee5\u4e0b\u4f7f\u7528\u5834\u666f\uff1a\n- \u540c\u4e00 VPC \u4e2d\u975e GKE \u5ba2\u6236\u7aef\u7684\u7121\u982d\u670d\u52d9\u767c\u73fe\u3002\n- \u4f86\u81ea\u672c\u5730\u6216\u7b2c\u4e09\u65b9\u96f2\u5ba2\u6236\u7aef\u7684 GKE \u670d\u52d9\u89e3\u6790\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5165\u7ad9\u670d\u52d9\u5668\u653f\u7b56](https://cloud.google.com/dns/docs/server-policies-overview?hl=zh-cn#dns-server-policy-in) \u3002\n- \u670d\u52d9\u89e3\u6790\uff0c\u5ba2\u6236\u7aef\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u7fa9\u96c6\u7fa3 DNS \u7db2\u57df\u6c7a\u5b9a\u8981\u8207\u54ea\u500b\u96c6\u7fa3\u901a\u4fe1\u3002\n\u5728\u4e0b\u5716\u4e2d\uff0c\u5169\u500b GKE \u96c6\u7fa3\u5728\u540c\u4e00 VPC \u4e2d\u4f7f\u7528 VPC \u7bc4\u570d DNS\u3002\u9019\u5169\u500b\u96c6\u7fa3\u90fd\u5177\u6709\u81ea\u5b9a\u7fa9 DNS \u7db2\u57df `.cluster1` \u548c `.cluster2` \uff0c\u800c\u4e0d\u662f\u9ed8\u8a8d\u7684 `.cluster.local` \u7db2\u57df\u3002\u865b\u64ec\u6a5f\u901a\u904e\u89e3\u6790 `backend.default.svc.cluster1` \u8207\u7121\u982d\u5f8c\u7aef\u670d\u52d9\u9032\u884c\u901a\u4fe1\u3002Cloud DNS \u5c07\u7121\u982d Service \u89e3\u6790\u7232 Service \u4e2d\u7684\u5404\u500b Pod IP\uff0c\u4e26\u4e14\u865b\u64ec\u6a5f\u76f4\u63a5\u8207 Pod IP \u9032\u884c\u901a\u4fe1\u3002\n**\u6ce8\u610f** \uff1a\u53ea\u6709\u7121\u982d Service \u6703\u89e3\u6790\u7232 GKE \u96c6\u7fa3\u5916\u90e8\u7684 IP \u5730\u5740\u3002ClusterIP Service \u4f7f\u7528\u50c5\u5b58\u5728\u65bc\u672c\u5730\u96c6\u7fa3\u7684\u865b\u64ec IP \u5730\u5740\u3002\n\u7576\u901a\u904e Cloud Interconnect \u6216 Cloud VPN \u9023\u63a5\u5230 VPC \u6642\uff0c\u60a8\u9084\u53ef\u4ee5\u5728\u5176\u4ed6\u7db2\u7d61\u4e2d\u57f7\u884c\u6b64\u985e\u89e3\u6790\u3002 [DNS \u670d\u52d9\u5668\u653f\u7b56](https://cloud.google.com/dns/docs/best-practices?hl=zh-cn#reference_architectures_for_hybrid_dns) \u5141\u8a31\u4f86\u81ea VPC \u6240\u9023\u63a5\u7db2\u7d61\u7684\u5ba2\u6236\u7aef\u89e3\u6790 Cloud DNS \u4e2d\u7684\u540d\u7a31\uff1b\u5982\u679c\u96c6\u7fa3\u4f7f\u7528 VPC \u7bc4\u570d DNS\uff0c\u5247\u5305\u62ec GKE \u670d\u52d9\u3002\n### \u5728\u65b0\u96c6\u7fa3\u4e2d\u5553\u7528 VPC \u7bc4\u570d DNS\n**GKE Autopilot \u96c6\u7fa3**\n\u60a8\u7121\u6cd5\u4f7f\u7528 VPC \u7bc4\u570d DNS \u5275\u5efa GKE Autopilot \u96c6\u7fa3\uff0cGKE Autopilot \u4e0d\u652f\u6301\u6b64\u529f\u80fd\u3002\n**GKE Standard \u96c6\u7fa3**\n\u60a8\u53ef\u4ee5\u4f7f\u7528 gcloud CLI \u6216 Google Cloud \u63a7\u5236\u6aaf\u5728\u65b0\u96c6\u7fa3\u4e2d\u5553\u7528 VPC \u7bc4\u570d DNS\u3002\n**\u8b66\u544a** \uff1a\u5982\u679c\u60a8\u6307\u5b9a `cluster-dns-domain` \u800c\u4e0d\u662f `cluster.local` \uff0c\u5247 Kubernetes \u670d\u52d9\u7684\u6240\u6709 `*.cluster.local` \u67e5\u8a62\u90fd\u5c07\u5931\u6557\u3002\u5207\u52ff\u5c0d\u4f7f\u7528 `*.cluster.local` \u7684\u540d\u7a31\u57f7\u884c DNS \u67e5\u627e\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5275\u5efa\u4e00\u500b\u5553\u7528\u4e86 VPC \u7bc4\u570d Cloud DNS \u7684\u65b0\u96c6\u7fa3\uff1a\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --cluster-dns=clouddns \\\u00a0 \u00a0 --cluster-dns-scope=vpc \\\u00a0 \u00a0 --cluster-dns-domain=CUSTOM_DOMAIN \\\u00a0 \u00a0 --location=COMPUTE_LOCATION\n```\n **\u6ce8\u610f** \uff1a\u5c0d\u65bc\u4f4e\u65bc 364.0.0 \u7684 Google Cloud CLI \u7248\u672c\uff0c\u8acb\u4f7f\u7528 `gcloud beta container` \u800c\u4e0d\u662f `gcloud container` \u3002\n\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u96c6\u7fa3\u7684 [Compute Engine \u4f4d\u7f6e](https://cloud.google.com/compute/docs/regions-zones/viewing-regions-zones?hl=zh-cn) \u3002\n- ``\uff1a\u7db2\u57df\u7684\u540d\u7a31\u3002\u60a8\u5fc5\u9808\u78ba\u4fdd\u6b64\u540d\u7a31\u5728 VPC \u4e2d\u5177\u6709\u552f\u4e00\u6027\uff0c\u56e0\u7232 GKE \u4e0d\u6703\u78ba\u8a8d\u6b64\u503c\u3002\u6b64\u503c\u4e00\u7d93\u8a2d\u7f6e\u4fbf\u7121\u6cd5\u66f4\u6539\u3002\u8acb\u52ff\u4f7f\u7528\u4ee5\u201c.local\u201d\u7d50\u5c3e\u7684\u7db2\u57df\uff0c\u5426\u5247 DNS \u89e3\u6790\u53ef\u80fd\u6703\u5931\u6557\u3002\n- \u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **Google Kubernetes Engine** \u9801\u9762\u3002 [\u8f49\u5230 Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa** \u3002\n- \u5728\u5c0e\u822a\u7a97\u683c\u7684 **\u96c6\u7fa3** \u4e0b\uff0c\u9ede\u64ca **\u7db2\u7d61** \u3002\n- \u5728 **DNS \u63d0\u4f9b\u5546** \u90e8\u5206\uff0c\u9ede\u64ca **Cloud DNS** \u3002\n- \u9078\u64c7 **VPC \u7bc4\u570d** \u3002\n- \u8f38\u5165\u57df\u540d\u3002\u60a8\u5fc5\u9808\u78ba\u4fdd\u6b64\u540d\u7a31\u5728 VPC \u4e2d\u5177\u6709\u552f\u4e00\u6027\uff0c\u56e0\u7232 GKE \u4e0d\u6703\u78ba\u8a8d\u6b64\u503c\u3002\u6b64\u503c\u4e00\u7d93\u8a2d\u7f6e\u4fbf\u7121\u6cd5\u66f4\u6539\u3002\u8acb\u52ff\u4f7f\u7528\u4ee5\u201c.local\u201d\u7d50\u5c3e\u7684\u7db2\u57df\uff0c\u5426\u5247 DNS \u89e3\u6790\u53ef\u80fd\u6703\u5931\u6557\u3002\n- \u6839\u64da\u9700\u8981\u914d\u7f6e\u96c6\u7fa3\u3002\n- \u9ede\u64ca **\u5275\u5efa** \u3002\n### \u5728\u73fe\u6709\u96c6\u7fa3\u4e2d\u5553\u7528 VPC \u7bc4\u570d DNS\n**GKE Autopilot \u96c6\u7fa3**\n\u60a8\u7121\u6cd5\u5c07 GKE Autopilot \u96c6\u7fa3\u5f9e kube-dns \u9077\u79fb\u5230 Cloud DNS VPC \u7bc4\u570d\uff0cGKE Autopilot \u4e0d\u652f\u6301\u6b64\u529f\u80fd\u3002\n**GKE Standard \u96c6\u7fa3**\n\u60a8\u53ef\u4ee5\u4f7f\u7528 gcloud CLI \u6216 Google Cloud \u63a7\u5236\u6aaf\u5c07\u73fe\u6709 GKE \u96c6\u7fa3\u5f9e kube-dns \u9077\u79fb\u5230 Cloud DNS VPC \u7bc4\u570d\u3002\u53ea\u6709 GKE Standard \u652f\u6301\u6b64\u9077\u79fb\u3002\n\u7232\u96c6\u7fa3\u5553\u7528 Cloud DNS \u5f8c\uff0c\u76f8\u61c9\u8a2d\u7f6e\u50c5\u5728\u60a8\u5347\u7d1a\u73fe\u6709\u7bc0\u9ede\u6c60\u6216\u5411\u96c6\u7fa3\u6dfb\u52a0\u65b0\u7bc0\u9ede\u6c60\u6642\u9069\u7528\u3002\u5347\u7d1a\u7bc0\u9ede\u6c60\u6642\uff0c\u7cfb\u7d71\u6703\u91cd\u65b0\u5275\u5efa\u7bc0\u9ede\u3002\n**\u8b66\u544a** \uff1a\u5f9e kube-dns \u9077\u79fb\u5230 VPC \u7bc4\u570d\u662f\u4e2d\u65b7\u6027\u64cd\u4f5c\u3002\u9077\u79fb\u5f8c\uff0c\u9664\u975e\u60a8\u91cd\u65b0\u5275\u5efa\u7bc0\u9ede\uff0c\u5426\u5247\u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u4e0d\u6703\u5c07 Cloud DNS \u7528\u4f5c DNS \u63d0\u4f9b\u5546\uff0c\u4e26\u4e14 kube-dns \u7121\u6cd5\u89e3\u6790\u5148\u524d\u7db2\u57df\u7684 DNS \u67e5\u8a62\uff08\u9ed8\u8a8d\u7232 `cluster.local` \uff09\uff0c\u9019\u6703\u5c0e\u81f4 DNS \u5931\u6557\u3002\u7531\u65bc\u7121\u6cd5\u6309\u7bc0\u9ede\u6c60\u9077\u79fb\u5230 VPC \u7bc4\u570d\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u5728\u7dad\u8b77\u7a97\u53e3\u5167\u57f7\u884c\u6b64\u9077\u79fb\u3002\n\u5728\u4ee5\u4e0b\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u7232\u96c6\u7fa3\u5553\u7528 Cloud DNS\uff0c\u7136\u5f8c\u5347\u7d1a\u7bc0\u9ede\u6c60\u3002\u5347\u7d1a\u7bc0\u9ede\u6c60\u6703\u91cd\u65b0\u5275\u5efa\u7bc0\u9ede\u3002\u7136\u5f8c\uff0c\u7bc0\u9ede\u4f7f\u7528 Cloud DNS \u800c\u4e0d\u662f kube-dns \u9032\u884c DNS \u89e3\u6790\u3002\n- \u66f4\u65b0\u73fe\u6709\u96c6\u7fa3\uff1a```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --cluster-dns=clouddns \\\u00a0 \u00a0 --cluster-dns-scope=vpc \\\u00a0 \u00a0 --cluster-dns-domain=CUSTOM_DOMAIN \\\u00a0 \u00a0 --location=COMPUTE_LOCATION\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u96c6\u7fa3\u7684 [Compute Engine \u4f4d\u7f6e](https://cloud.google.com/compute/docs/regions-zones/viewing-regions-zones?hl=zh-cn) \u3002\n- ``\uff1a\u7db2\u57df\u7684\u540d\u7a31\u3002\u60a8\u5fc5\u9808\u78ba\u4fdd\u6b64\u540d\u7a31\u5728 VPC \u4e2d\u5177\u6709\u552f\u4e00\u6027\uff0c\u56e0\u7232 GKE \u4e0d\u6703\u78ba\u8a8d\u6b64\u503c\u3002\u6b64\u503c\u4e00\u7d93\u8a2d\u7f6e\u4fbf\u7121\u6cd5\u66f4\u6539\u3002\u8acb\u52ff\u4f7f\u7528\u4ee5\u201c.local\u201d\u7d50\u5c3e\u7684\u7db2\u57df\uff0c\u5426\u5247 DNS \u89e3\u6790\u53ef\u80fd\u6703\u5931\u6557\u3002\n\u97ff\u61c9\u985e\u4f3c\u65bc\u4ee5\u4e0b\u793a\u4f8b\uff1a```\nAll the node-pools in the cluster need to be re-created by the user to start using Cloud DNS for DNS lookups. It is highly recommended to complete this step\nshortly after enabling Cloud DNS.\nDo you want to continue (Y/n)?\n```\u78ba\u8a8d\u5f8c\uff0cCloud DNS \u63a7\u5236\u5668\u6703\u5728 GKE \u63a7\u5236\u5e73\u9762\u4e0a\u904b\u884c\u3002\u9664\u975e\u60a8\u5347\u7d1a\u7bc0\u9ede\u6c60\u6216\u5411\u96c6\u7fa3\u6dfb\u52a0\u65b0\u7bc0\u9ede\u6c60\uff0c\u5426\u5247 Pod \u4e0d\u6703\u4f7f\u7528 Cloud DNS \u9032\u884c DNS \u89e3\u6790\u3002\n- \u5347\u7d1a\u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u6c60\u4ee5\u4f7f\u7528 Cloud DNS\uff1a```\ngcloud container clusters upgrade CLUSTER_NAME \\\u00a0 \u00a0 --node-pool=POOL_NAME\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8981\u5347\u7d1a\u7684\u7bc0\u9ede\u6c60\u7684\u540d\u7a31\u3002\n\u5982\u679c\u7bc0\u9ede\u6c60\u548c\u63a7\u5236\u5e73\u9762\u904b\u884c\u76f8\u540c\u7684\u7248\u672c\uff0c\u8acb\u5148\u5347\u7d1a\u63a7\u5236\u5e73\u9762\uff08\u5982 [\u624b\u52d5\u5347\u7d1a\u63a7\u5236\u5e73\u9762](https://cloud.google.com/kubernetes-engine/docs/how-to/upgrading-a-cluster?hl=zh-cn#upgrade_cp) \u4e2d\u6240\u8ff0\uff09\uff0c\u7136\u5f8c\u57f7\u884c\u7bc0\u9ede\u6c60\u5347\u7d1a\u3002 **\u6ce8\u610f** \uff1a\u5347\u7d1a\u5230\u7bc0\u9ede\u6c60\u7576\u524d\u904b\u884c\u7684\u7248\u672c\u5c0d Pod \u6c92\u6709\u5f71\u97ff\u3002\u5c0d\u65bc\u6b64\u985e\u7bc0\u9ede\u6c60\uff0c\u5728\u9019\u4e9b\u7bc0\u9ede\u4e0a\u904b\u884c\u7684 Pod \u4ecd\u4f7f\u7528 kube-dns\u3002\u5c07 kube-dns \u90e8\u7f72\u548c\u81ea\u52d5\u64f4\u7e2e\u5668\u7e2e\u6e1b\u7232\u96f6\u6703\u5c0e\u81f4\u9019\u4e9b Pod \u7684 DNS \u5931\u6557\u3002\u7232\u4e86\u8b93 Pod \u4f7f\u7528 Cloud DNS\uff0c\u60a8\u5fc5\u9808\u5c07\u7bc0\u9ede\u6c60\u5347\u7d1a\u5230\u65b0\u7248\u672c\u3002\u6216\u8005\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5275\u5efa\u76f8\u540c\u7248\u672c\u7684\u65b0\u7bc0\u9ede\u6c60\u3002\u78ba\u8a8d\u97ff\u61c9\u4f75\u7232\u96c6\u7fa3\u4e2d\u7684\u6bcf\u500b\u7bc0\u9ede\u6c60\u91cd\u8907\u6b64\u547d\u4ee4\u3002\u5982\u679c\u96c6\u7fa3\u53ea\u6709\u4e00\u500b\u7bc0\u9ede\u6c60\uff0c\u8acb\u7701\u7565 `--node-pool` \u6a19\u8a8c\u3002\n- \u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **Google Kubernetes Engine** \u9801\u9762\u3002 [\u8f49\u5230 Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list?hl=zh-cn) \n- \u9ede\u64ca\u8981\u4fee\u6539\u7684\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \u5728 **\u7db2\u7d61** \u4e0b\u7684 **DNS \u63d0\u4f9b\u5546** \u5b57\u6bb5\u4e2d\uff0c\u9ede\u64ca **\u4fee\u6539 DNS \u63d0\u4f9b\u5546** \u3002\n- \u9ede\u64ca **Cloud DNS** \u3002\n- \u9ede\u64ca **VPC \u7bc4\u570d** \u3002\n- \u9ede\u64ca **\u4fdd\u5b58\u66f4\u6539** \u3002## \u9a57\u8b49 Cloud DNS\n\u9a57\u8b49 Cloud DNS for GKE \u662f\u5426\u5728\u96c6\u7fa3\u4e2d\u6b63\u5e38\u904b\u884c\uff1a\n- \u901a\u904e\u9023\u63a5\u5230\u7bc0\u9ede\u4e0a\u7684 Pod \u4e26\u904b\u884c `cat /etc/resolv.conf` \u547d\u4ee4\uff0c\u9a57\u8b49\u60a8\u7684\u7bc0\u9ede\u662f\u5426\u6b63\u5728\u4f7f\u7528 Cloud DNS\uff1a```\nkubectl exec -it POD_NAME -- cat /etc/resolv.conf | grep nameserver\n```\u5c07 `` \u66ff\u63db\u7232 Pod \u7684\u540d\u7a31\u3002\u6839\u64da\u96c6\u7fa3\u6a21\u5f0f\uff0c\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a **GKE Autopilot \u96c6\u7fa3** ```\nnameserver 169.254.20.10\n```\u7531\u65bc GKE Autopilot \u4e2d\u9ed8\u8a8d\u5553\u7528 [NodeLocal DNSCache](https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache?hl=zh-cn) \uff0c\u56e0\u6b64 Pod \u4f7f\u7528 [NodeLocal DNSCache](https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache?hl=zh-cn) \u3002\u50c5\u7576\u672c\u5730\u7de9\u5b58\u6c92\u6709\u6b63\u5728\u67e5\u627e\u7684\u540d\u7a31\u7684\u689d\u76ee\u6642\uff0cNodeLocal DNSCache \u7e94\u6703\u5c07\u8acb\u6c42\u8f49\u767c\u5230 Cloud DNS\u3002 **GKE Standard \u96c6\u7fa3** ```\nnameserver 169.254.169.254\n```Pod \u4f7f\u7528 `169.254.169.254` \u4f5c\u7232 `nameserver` \uff0c\u9019\u662f\u5143\u6578\u64da\u670d\u52d9\u5668\u7684 IP \u5730\u5740\uff0cCloud DNS \u6578\u64da\u5e73\u9762\u5728\u5176\u4e2d\u76e3\u807d\u7aef\u53e3 53 \u4e0a\u7684\u8acb\u6c42\u3002\u7bc0\u9ede\u4e0d\u518d\u4f7f\u7528 kube-dns \u670d\u52d9\u5730\u5740\u9032\u884c DNS \u89e3\u6790\uff0c\u4e26\u4e14\u6240\u6709 DNS \u89e3\u6790\u90fd\u5728\u672c\u5730\u7bc0\u9ede\u4e0a\u9032\u884c\u3002\u5982\u679c\u8f38\u51fa\u662f\u985e\u4f3c\u65bc `10.x.y.10` \u7684 IP \u5730\u5740\uff0c\u5247\u8aaa\u660e Pod \u4f7f\u7528\u7684\u662f [kube-dns](https://cloud.google.com/kubernetes-engine/docs/how-to/kube-dns?hl=zh-cn) \u3002\u8acb\u53c3\u95b1 [\u554f\u984c\u6392\u67e5](https://cloud.google.com/kubernetes-engine/docs/how-to/cloud-dns?hl=zh-cn#pods_use_kube-dns_even_after_is_enabled_on_an_existing_cluster) \u90e8\u5206\uff0c\u77ad\u89e3 Pod \u4ecd\u5728\u4f7f\u7528 kube-dns \u7684\u539f\u56e0\u3002\u5982\u679c\u8f38\u51fa\u7232 `169.254.20.10` \uff0c\u5247\u8868\u793a\u60a8\u5df2\u5728\u96c6\u7fa3\u4e2d\u5553\u7528\u4e86 [NodeLocal DNSCache](https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache?hl=zh-cn) \uff0c\u90a3\u9ebc Pod \u4f7f\u7528\u7684\u662f [NodeLocal DNSCache](https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache?hl=zh-cn) \u3002\n- \u5c07\u793a\u4f8b\u61c9\u7528\u90e8\u7f72\u5230\u60a8\u7684\u96c6\u7fa3\uff1a```\nkubectl run dns-test --image us-docker.pkg.dev/google-samples/containers/gke/hello-app:2.0\n```\n- \u4f7f\u7528 Service \u516c\u958b\u793a\u4f8b\u61c9\u7528\uff1a```\nkubectl expose pod dns-test --name dns-test-svc --port 8080\n```\n- \u9a57\u8b49 Service \u5df2\u6210\u529f\u90e8\u7f72\uff1a```\nkubectl get svc dns-test-svc\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME   TYPE  CLUSTER-IP  EXTERNAL-IP PORT(S) AGE\ndns-test-svc ClusterIP 10.47.255.11 <none>  8080/TCP 6m10s\n````CLUSTER-IP` \u7684\u503c\u662f\u96c6\u7fa3\u7684\u865b\u64ec IP \u5730\u5740\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u865b\u64ec IP \u5730\u5740\u7232 `10.47.255.11` \u3002\n- \u9a57\u8b49\u60a8\u7684 Service \u540d\u7a31\u662f\u5426\u5df2\u5728\u96c6\u7fa3\u7684\u5c08\u7528 DNS \u5340\u57df\u4e2d\u4f5c\u7232\u8a18\u9304\u5275\u5efa\uff1a```\ngcloud dns record-sets list \\\u00a0 \u00a0 --zone=PRIVATE_DNS_ZONE \\\u00a0 \u00a0 --name=dns-test-svc.default.svc.cluster.local.\n```\u5c07 `` \u66ff\u63db\u7232\u4ee3\u7ba1 DNS \u5340\u57df\u7684\u540d\u7a31\u3002\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME: dns-test-svc.default.svc.cluster.local.\nTYPE: A\nTTL: 30\nDATA: 10.47.255.11\n```## \u505c\u7528 Cloud DNS for GKE\n**GKE Autopilot \u96c6\u7fa3**\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u60a8\u7121\u6cd5\u5728\u4f7f\u7528 Cloud DNS \u5275\u5efa\u7684 GKE Autopilot \u96c6\u7fa3\u4e2d\u505c\u7528 Cloud DNS\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u9ed8\u8a8d\u4f7f\u7528 Cloud DNS \u7684 GKE Autopilot \u96c6\u7fa3\uff0c\u8acb\u53c3\u95b1 [\u8981\u6c42](https://cloud.google.com/kubernetes-engine/docs/how-to/cloud-dns?hl=zh-cn#minimum-requirements) \u3002\n**GKE Standard \u96c6\u7fa3**\n**\u8b66\u544a** \uff1a\u60a8\u7121\u6cd5\u5728 GKE Standard \u96c6\u7fa3\u4e2d\u505c\u7528 Cloud DNS VPC \u7bc4\u570d\uff0c\u60a8\u9700\u8981\u5c07 kube-dns \u4f5c\u7232\u9ed8\u8a8d DNS \u63d0\u4f9b\u5546\u4f86\u91cd\u65b0\u5275\u5efa\u96c6\u7fa3\u3002\n\u60a8\u53ef\u4ee5\u5728 GKE Standard \u96c6\u7fa3\u4e2d\u4f7f\u7528 gcloud CLI \u6216 Google Cloud \u63a7\u5236\u6aaf\u505c\u7528 Cloud DNS \u96c6\u7fa3\u7bc4\u570d\u3002\n\u66f4\u65b0\u96c6\u7fa3\u4ee5\u4f7f\u7528 kube-dns\uff1a\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --cluster-dns=default\n```- \u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **Google Kubernetes Engine** \u9801\u9762\u3002 [\u8f49\u5230 Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list?hl=zh-cn) \n- \u9ede\u64ca\u8981\u4fee\u6539\u7684\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \u5728 **\u7db2\u7d61** \u4e0b\u7684 **DNS \u63d0\u4f9b\u5546** \u5b57\u6bb5\u4e2d\uff0c\u9ede\u64ca **\u4fee\u6539 DNS \u63d0\u4f9b\u5546** \u3002\n- \u9ede\u64ca **Kube-dns** \u3002\n- \u9ede\u64ca **\u4fdd\u5b58\u66f4\u6539** \u3002## \u6e05\u7406\n\u5b8c\u6210\u672c\u9801\u9762\u4e0a\u7684\u7df4\u7fd2\u5f8c\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u79fb\u9664\u8cc7\u6e90\uff0c\u9632\u6b62\u60a8\u7684\u8cec\u865f\u7522\u751f\u4e0d\u5fc5\u8981\u7684\u8cbb\u7528\uff1a\n- \u522a\u9664\u670d\u52d9\uff1a```\nkubectl delete service dns-test-svc\n```\n- \u522a\u9664 Pod\uff1a```\nkubectl delete Pod dns-test\n```\n- \u60a8\u9084\u53ef\u4ee5 [\u522a\u9664\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/how-to/deleting-a-cluster?hl=zh-cn) \u3002## \u5c07 Cloud DNS \u8207\u5171\u4eab VPC \u642d\u914d\u4f7f\u7528\nCloud DNS for GKE \u652f\u6301 VPC \u548c\u96c6\u7fa3\u7bc4\u570d\u7684\u5171\u4eab VPC\u3002\nGKE \u63a7\u5236\u5668\u6703\u5728 GKE \u96c6\u7fa3\u6240\u5c6c\u7684\u9805\u76ee\u4e2d\u5275\u5efa\u8a17\u7ba1\u5c08\u7528\u5730\u5340\u3002\nGKE \u96c6\u7fa3\u7684 GKE \u670d\u52d9\u8cec\u865f\u4e0d\u9700\u8981\u5728\u5176\u81ea\u8eab\u9805\u76ee\u4e4b\u5916\u4f7f\u7528 DNS \u7684 Identity and Access Management (IAM)\uff0c\u56e0\u7232\u8a17\u7ba1\u5730\u5340\u548c GKE \u96c6\u7fa3\u4f4d\u65bc\u540c\u4e00\u9805\u76ee\u4e2d\u3002\n### \u6bcf\u500b\u670d\u52d9\u9805\u76ee\u6709\u591a\u500b\u96c6\u7fa3\n\u5f9e GKE 1.22.3-gke.700\u30011.21.6-gke.1500 \u7248\u672c\u958b\u59cb\uff0c\u60a8\u53ef\u4ee5\u5728\u591a\u500b\u5f15\u7528\u540c\u4e00\u5bbf\u4e3b\u9805\u76ee\u4e2d\u7684 VPC \u7684\u670d\u52d9\u9805\u76ee\u4e2d\u5275\u5efa\u96c6\u7fa3\u3002\u5982\u679c\u60a8\u5df2\u64c1\u6709\u4f7f\u7528\u5171\u4eab VPC \u548c Cloud DNS VPC \u7bc4\u570d\u7684\u96c6\u7fa3\uff0c\u5247\u5fc5\u9808\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u624b\u52d5\u9077\u79fb\u5b83\u5011\uff1a\n- [\u5c07\u5df2\u5553\u7528\u5171\u4eab VPC \u7684\u73fe\u6709\u96c6\u7fa3\u5347\u7d1a\u5230](https://cloud.google.com/kubernetes-engine/docs/how-to/upgrading-a-cluster?hl=zh-cn#upgrade_cp) GKE \u7248\u672c 1.22.3-gke.700+ \u6216 1.21.6-gke.1500+\u3002\n- \u5c07\u97ff\u61c9\u653f\u7b56\u5f9e\u670d\u52d9\u9805\u76ee\u9077\u79fb\u5230\u5bbf\u4e3b\u9805\u76ee\u3002\u60a8\u53ea\u9700\u7232\u6bcf\u500b\u5171\u4eab VPC \u7db2\u7d61\u57f7\u884c\u4e00\u6b21\u6b64\u9077\u79fb\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u9077\u79fb\u97ff\u61c9\u653f\u7b56\u3002\n\u5728\u670d\u52d9\u9805\u76ee\u4e2d\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a\n- \u8f49\u5230 **Cloud DNS \u5340\u57df** \u9801\u9762\u3002 [\u8f49\u5230 Cloud DNS \u5340\u57df](https://console.cloud.google.com/networking/dns/zones?hl=zh-cn) \n- \u9ede\u64ca **\u97ff\u61c9\u653f\u7b56\u5340\u57df** \u6a19\u7c64\u9801\u3002\n- \u9ede\u64ca\u60a8\u7684 VPC \u7db2\u7d61\u7684\u97ff\u61c9\u653f\u7b56\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u8aaa\u660e\u8b58\u5225\u97ff\u61c9\u653f\u7b56\uff0c\u9019\u8207\u201c\u7db2\u7d61 NETWORK_NAME \u4e0a\u7684 GKE \u96c6\u7fa3\u7684\u97ff\u61c9\u653f\u7b56\u201d\u985e\u4f3c\u3002\n- \u9ede\u64ca **\u4f7f\u7528\u8005** \u6a19\u7c64\u9801\u3002\n- \u5728\u5bbf\u4e3b\u9805\u76ee\u7684\u540d\u7a31\u65c1\u908a\uff0c\u9ede\u64ca \u4ee5\u79fb\u9664\u7db2\u7d61\u7d81\u5b9a\u3002\n- \u9ede\u64ca **\u97ff\u61c9\u653f\u7b56\u898f\u5247** \u6a19\u7c64\u9801\u3002\n- \u9078\u64c7\u8868\u4e2d\u7684\u6240\u6709\u689d\u76ee\u3002\n- \u9ede\u64ca **\u79fb\u9664\u97ff\u61c9\u653f\u7b56\u898f\u5247** \u3002\n- \u9ede\u64ca **\u522a\u9664\u97ff\u61c9\u653f\u7b56** \u3002\n\u522a\u9664\u97ff\u61c9\u653f\u7b56\u5f8c\uff0cDNS \u63a7\u5236\u5668\u6703\u81ea\u52d5\u5728\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5275\u5efa\u97ff\u61c9\u653f\u7b56\u3002\u5176\u4ed6\u670d\u52d9\u9805\u76ee\u4e2d\u7684\u96c6\u7fa3\u5171\u4eab\u6b64\u97ff\u61c9\u653f\u7b56\u3002\n## \u652f\u6301\u81ea\u5b9a\u7fa9\u6a01\u7db2\u57df\u548c\u4e0a\u6e38\u57df\u540d\u670d\u52d9\u5668\nCloud DNS for GKE \u652f\u6301\u4f7f\u7528 kube-dns ConfigMap \u914d\u7f6e\u7684\u81ea\u5b9a\u7fa9\u5b58\u6839\u7db2\u57df\u548c\u4e0a\u6e38\u57df\u540d\u670d\u52d9\u5668\u3002\u6b64\u652f\u6301\u50c5\u9069\u7528\u65bc GKE \u96c6\u7fa3\u7bc4\u570d\u3002\nCloud DNS \u6703\u5c07 `stubDomains` \u548c `upstreamNameservers` \u503c\u8f49\u63db\u7232 Cloud DNS \u8f49\u767c\u5730\u5340\u3002\n**\u6ce8\u610f** \uff1a\u81ea\u5b9a\u7fa9 DNS \u914d\u7f6e\u9069\u7528\u65bc\u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u548c Pod\u3002\u6b64\u884c\u7232\u8207 kube-dns \u4e0d\u540c\uff0c\u5176\u4e2d\u81ea\u5b9a\u7fa9 DNS \u914d\u7f6e\u50c5\u9069\u7528\u65bc Pod\u3002\n## \u5df2\u77e5\u554f\u984c\n### \u7531\u65bc dns_config \u66f4\u6539\uff0cTerraform \u8a08\u5283\u91cd\u65b0\u5275\u5efa Autopilot \u96c6\u7fa3\n\u5982\u679c\u4f7f\u7528 `terraform-provider-google` \u6216 `terraform-provider-google-beta` \uff0c\u60a8\u53ef\u80fd\u6703\u9047\u5230 Terraform \u5617\u8a66\u91cd\u65b0\u5275\u5efa Autopilot \u96c6\u7fa3\u7684\u554f\u984c\u3002\u767c\u751f\u6b64\u932f\u8aa4\u662f\u56e0\u7232\u904b\u884c 1.25.9-gke.400\u30011.26.4-gke.500\u30011.27.1-gke.400 \u6216\u66f4\u9ad8\u7248\u672c\u7684\u65b0\u5efa Autopilot \u96c6\u7fa3\u4f7f\u7528 Cloud DNS\uff08\u800c\u4e0d\u662f kube-dns\uff09\u4f5c\u7232 DNS \u63d0\u4f9b\u5546\u3002\n\u6b64\u554f\u984c\u5df2\u5728 Google Cloud \u7684 Terraform \u63d0\u4f9b\u7a0b\u5e8f 4.80.0 \u7248\u4e2d [\u89e3\u6c7a](https://github.com/GoogleCloudPlatform/magic-modules/pull/8654) \u3002\n\u5982\u679c\u60a8\u7121\u6cd5\u66f4\u65b0 `terraform-provider-google` \u6216 `terraform-provider-google-beta` \u7684\u7248\u672c\uff0c\u5247\u53ef\u4ee5\u5c07 `lifecycle.ignore_changes` \u6dfb\u52a0\u5230\u8cc7\u6e90\u4e2d\uff0c\u4ee5\u78ba\u4fdd `google_container_cluster` \u5ffd\u7565\u5c0d `dns_config` \u7684\u66f4\u6539\uff1a\n```\n\u00a0 lifecycle {\u00a0 \u00a0 ignore_changes = [\u00a0 \u00a0 \u00a0 dns_config,\u00a0 \u00a0 ]\u00a0 }\n```\n## \u554f\u984c\u6392\u67e5\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5553\u7528 DNS \u65e5\u8a8c\u8a18\u9304\uff0c\u8acb\u53c3\u95b1 [\u7232\u5c08\u7528\u4ee3\u7ba1\u5340\u57df\u5553\u7528\u548c\u505c\u7528\u65e5\u8a8c\u8a18\u9304\u529f\u80fd](https://cloud.google.com/dns/docs/monitoring?hl=zh-cn#enabling_and_disabling_logging_for_private_managed_zones) \u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u6392\u67e5 DNS \u554f\u984c\uff0c\u8acb\u53c3\u95b1 [\u6392\u67e5 GKE \u4e2d\u7684 DNS \u554f\u984c](https://cloud.google.com/kubernetes-engine/docs/troubleshooting/troubleshooting-dns?hl=zh-cn) \u3002\n### \u7121\u6cd5\u66f4\u65b0\u73fe\u6709\u96c6\u7fa3\u6216\u5275\u5efa\u5553\u7528\u4e86 Cloud DNS \u7684\u96c6\u7fa3\n\u8acb\u78ba\u4fdd\u60a8\u4f7f\u7528\u7684\u7248\u672c\u6b63\u78ba\u3002Cloud DNS for GKE \u8981\u6c42\u4f7f\u7528 VPC \u7bc4\u570d\u7684\u96c6\u7fa3\u4f7f\u7528 GKE 1.19 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u6216\u8005\u4f7f\u7528\u96c6\u7fa3\u7bc4\u570d\u7684\u96c6\u7fa3\u4f7f\u7528 GKE 1.24.7-gke.800\u30011.25.3-gke.700 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n### \u5373\u4f7f\u5728\u73fe\u6709\u96c6\u7fa3\u4e0a\u5553\u7528\u4e86 Cloud DNS\uff0cPod \u4e5f\u6703\u4f7f\u7528 kube-dns\n\u5728\u96c6\u7fa3\u4e0a\u5553\u7528 Cloud DNS \u5f8c\uff0c\u78ba\u4fdd\u60a8\u5df2\u5347\u7d1a\u6216\u91cd\u65b0\u5275\u5efa\u7bc0\u9ede\u6c60\u3002\u5728\u6b64\u6b65\u9a5f\u5b8c\u6210\u4e4b\u524d\uff0cPod \u5c07\u7e7c\u7e8c\u4f7f\u7528 kube-dns\u3002\n### Pod \u7121\u6cd5\u89e3\u6790 DNS \u67e5\u8a62\n- \u901a\u904e\u9023\u63a5\u5230 Pod \u4e26\u904b\u884c\u547d\u4ee4 `cat /etc/resolv.conf` \uff0c\u9a57\u8b49 Pod \u662f\u5426\u6b63\u5728\u4f7f\u7528 Cloud DNS\uff1a```\nkubectl exec -it POD_NAME -- cat /etc/resolv.conf | grep nameserver\n```\u5c07 `` \u66ff\u63db\u7232 Pod \u7684\u540d\u7a31\u3002\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nnameserver 169.254.169.254\n```\u5982\u679c\u8f38\u51fa\u662f\u985e\u4f3c\u65bc `10.x.y.10` \u6216 `34.118.224.10` \u7684 IP \u5730\u5740\uff08\u50c5\u5728 1.27 \u53ca\u66f4\u9ad8\u7248\u672c\u7684 GKE Autopilot \u96c6\u7fa3\u4e2d\uff09\uff0c\u5247\u8aaa\u660e Pod \u4f7f\u7528\u7684\u662f [kube-dns](https://cloud.google.com/kubernetes-engine/docs/how-to/kube-dns?hl=zh-cn) \u3002\u5982\u679c\u8f38\u51fa\u7232 `169.254.20.10` \uff0c\u5247\u8aaa\u660e Pod \u4f7f\u7528\u7684\u662f [NodeLocal DNSCache](https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache?hl=zh-cn) \u3002\n- \u78ba\u8a8d\u8a72\u8a17\u7ba1\u5730\u5340\u5b58\u5728\u4e14\u5305\u542b\u5fc5\u8981\u7684 DNS \u689d\u76ee\uff1a```\ngcloud dns managed-zones list --format list\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\n - creationTime: 2021-02-12T19:24:37.045Z\n description: Private zone for GKE cluster \"cluster1\" with cluster suffix \"cluster.local\" in project \"project-243723\"\n dnsName: cluster.local.\n id: 5887499284756055830\n kind: dns#managedZone\n name: gke-cluster1-aa94c1f9-dns\n nameServers: ['ns-gcp-private.googledomains.com.']\n privateVisibilityConfig: {'kind': 'dns#managedZonePrivateVisibilityConfig'}\n visibility: private\n```\u97ff\u61c9\u4e2d\u7684 `name` \u503c\u8868\u660e Google Cloud \u5275\u5efa\u4e86\u4e00\u500b\u540d\u7232 `gke-cluster1-aa94c1f9-dns` \u7684\u5c08\u7528\u5730\u5340\u3002\n- \u9a57\u8b49 Cloud DNS \u662f\u5426\u5305\u542b\u96c6\u7fa3\u7684\u689d\u76ee\uff1a```\ngcloud dns record-sets list --zone ZONE_NAME | grep SERVICE_NAME\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u5c08\u7528\u5730\u5340\u7684\u540d\u7a31\u3002\n- ``\uff1a\u670d\u52d9\u7684\u540d\u7a31\u3002\n\u8f38\u51fa\u986f\u793a Cloud DNS \u5305\u542b\u7db2\u57df `dns-test.default.svc.cluster.local.` \u548c\u96c6\u7fa3\u7684 IP \u5730\u5740 `10.47.255.11` \u7684 A \u8a18\u9304\uff1a```\ndns-test.default.svc.cluster.local.    A  30  10.47.255.11\n```\n- \u5553\u7528 [Cloud DNS \u65e5\u8a8c\u8a18\u9304](https://cloud.google.com/dns/docs/monitoring?hl=zh-cn) \u4ee5\u8ddf\u8e64\u67e5\u8a62\u3002\u6bcf\u500b\u65e5\u8a8c\u689d\u76ee\u90fd\u5305\u542b\u6709\u95dc\u67e5\u8a62\u7684\u4fe1\u606f\uff0c\u5305\u62ec DNS \u5ef6\u9072\u6642\u9593\u3002\n### \u5728\u96c6\u7fa3\u4e0a\u5553\u7528 Cloud DNS \u5f8c\uff0c\u7bc0\u9ede\u4e0a\u7684 DNS \u67e5\u627e\u6703\u5931\u6557\n\u5982\u679c\u60a8\u5728\u5177\u6709\u81ea\u5b9a\u7fa9\u5b58\u6839\u7db2\u57df\u6216\u4e0a\u6e38\u57df\u540d\u670d\u52d9\u5668\u7684 GKE \u96c6\u7fa3\u4e2d\u5553\u7528\u96c6\u7fa3\u7bc4\u570d Cloud DNS\uff0c\u5247\u81ea\u5b9a\u7fa9\u914d\u7f6e\u5c07\u61c9\u7528\u65bc\u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u548c Pod\uff0c\u56e0\u7232 Cloud DNS \u7121\u6cd5\u5340\u5206 Pod \u548c\u7bc0\u9ede DNS \u8acb\u6c42\u3002\u5982\u679c\u81ea\u5b9a\u7fa9\u4e0a\u6e38\u670d\u52d9\u5668\u7121\u6cd5\u89e3\u6790\u67e5\u8a62\uff0c\u7bc0\u9ede\u4e0a\u7684 DNS \u67e5\u627e\u53ef\u80fd\u6703\u5931\u6557\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [\u7c21\u8981\u4e86\u89e3](https://cloud.google.com/kubernetes-engine/docs/concepts/service-discovery?hl=zh-cn) GKE \u5982\u4f55\u63d0\u4f9b\u8a17\u7ba1\u5f0f DNS\u3002\n- \u95b1\u8b80 [\u670d\u52d9\u548c Pod \u7684 DNS](https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/) \uff0c\u5927\u81f4\u77ad\u89e3\u5982\u4f55\u5728 Kubernetes \u96c6\u7fa3\u4e2d\u4f7f\u7528 DNS\u3002\n- \u77ad\u89e3 Cloud DNS \u4e2d\u7684 [\u7bc4\u570d\u548c\u5c64\u6b21\u7d50\u69cb](https://cloud.google.com/dns/docs/scopes?hl=zh-cn) \u3002\n- \u77ad\u89e3\u5982\u4f55 [\u7232\u5c08\u7528\u4ee3\u7ba1\u5340\u57df\u5553\u7528\u548c\u505c\u7528\u65e5\u8a8c\u8a18\u9304\u529f\u80fd](https://cloud.google.com/dns/docs/monitoring?hl=zh-cn#enabling_and_disabling_logging_for_private_managed_zones) \u3002", "guide": "Google Kubernetes Engine (GKE)"}