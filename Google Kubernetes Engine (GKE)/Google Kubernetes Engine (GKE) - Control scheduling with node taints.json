{"title": "Google Kubernetes Engine (GKE) - Control scheduling with node taints", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/node-taints", "abstract": "# Google Kubernetes Engine (GKE) - Control scheduling with node taints\nThis page provides an overview of [node taints](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/) on Google Kubernetes Engine (GKE). Node taints help you specify the nodes where workloads should run.\nAutopilot clusters support using node taints for workload separation only. For instructions, see [Configure workload separation in GKE](/kubernetes-engine/docs/how-to/workload-separation) .\n", "content": "## Overview\nWhen you submit a workload to run in a cluster, the scheduler determines where to place the Pods associated with the workload. The scheduler is free to place a Pod on any node that satisfies the Pod's CPU, memory, and custom resource requirements.\nIf your cluster runs a variety of workloads, you might want to exercise some control over which workloads can run on a particular pool of nodes.\nA **node taint** lets you mark a node so that the scheduler avoids or prevents using it for certain Pods. A complementary feature, , lets you designate Pods that can be used on \"tainted\" nodes.\nTaints and tolerations work together to ensure that Pods are not scheduled onto inappropriate nodes.\nTaints are associated with an . The following table lists the available effects:\n| Effect   | Description                                  |\n|:-----------------|:-------------------------------------------------------------------------------------------------------------------------------------------------|\n| NoSchedule  | Pods that do not tolerate this taint are not scheduled on the node; existing Pods are not evicted from the node.        |\n| PreferNoSchedule | Kubernetes avoids scheduling Pods that do not tolerate this taint onto the node.                |\n| NoExecute  | The Pod is evicted from the node if it is already running on the node, and is not scheduled onto the node if it is not yet running on the node. |\n**Note:** Some system Pods (for example, `kube-proxy` and `fluent-bit` ) tolerate all `NoExecute` and `NoSchedule` taints, and will not be evicted.\n## Advantages of setting node taints in GKE\nYou can add node taints to clusters and nodes in GKE or by using the [kubectl taint](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#taint) command. Specifying node taints in GKE has several advantages over `kubectl` :\n- Taints are preserved when a node is restarted or replaced.\n- Taints are created automatically when a node is added to a node pool or cluster.\n- Taints are created automatically during cluster autoscaling.\n**Note:** If you manually remove a taint from one of the nodes in node pool using `kubectl` , then GKE does not preserve the taints after the node is restarted.\n## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.## Create a cluster with node taints\nWhen you create a cluster in GKE, you can assign node taints to the cluster. This assigns the taints to .\n**Note:** If you create a node pool, the node pool does not inherit taints from the cluster. If you want taints on the node pool, you must use the `--node-taints` flag when you create the node pool.\nIf you create a Standard cluster with node taints that have the `NoSchedule` effect or the `NoExecute` effect, GKE can't schedule some GKE managed components, such as `kube-dns` or `metrics-server` on the default node pool that GKE creates when you create the cluster. GKE can't schedule these components because they don't have the corresponding tolerations for your node taints. You must add a new node pool that satisfies one of the following conditions:\n- No taints\n- A taint that has the`PreferNoSchedule`effect\n- The`components.gke.io/gke-managed-components=true:NoSchedule`taint\nAny of these conditions allow GKE to schedule GKE managed components in the new node pool.\nFor instructions, refer to [Isolate workloads on dedicated nodes](/kubernetes-engine/docs/how-to/isolate-workloads-dedicated-nodes) .\nTo create a cluster with node taints, run the following command:\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --node-taints KEY=VALUE:EFFECT\n```\nReplace the following:- ``: the name of the new cluster.\n- ``: one of the following [effect values](#effects) :`PreferNoSchedule`,`NoSchedule`, or`NoExecute`.\n- `` `=` ``: a key-value pair associated with the``.\nFor example, the following command applies a taint that has a key-value of `dedicated=experimental` with an effect of `PreferNoSchedule` :\n```\ngcloud container clusters create example-cluster \\\n --node-taints dedicated=experimental:PreferNoSchedule\n```\nTo create a cluster with node taints:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Click **Create** .\n- Configure your cluster as desired.\n- From the navigation pane, under **Node Pools** , expand the node pool you want to modify, and then click **Metadata** .\n- In the **Node taints** section, click **Add Taint** .\n- In the **Effect** drop-down list, select the desired effect.\n- Enter the desired key-value pair in the **Key** and **Value** fields.\n- Click **Create** .\nWhen you use the API to create a cluster, include the `nodeTaints` field under `nodeConfig` . Here's an example:\n```\nPOST https://container.googleapis.com/v1/projects/PROJECT_ID/zones/COMPUTE_ZONE/clusters{\u00a0 'cluster': {\u00a0 \u00a0 'name': 'example-cluster',\u00a0 \u00a0 'nodeConfig': {\u00a0 \u00a0 \u00a0 'nodeTaints': [\u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'key': 'special',\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'Value': 'gpu',\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'effect': 'PreferNoSchedule'\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 \u00a0 ...\u00a0 \u00a0 }\u00a0 \u00a0 ...\u00a0 }}\n```\n## Create a node pool with node taints\nWhen you apply a taint to a node, only Pods that tolerate the taint are allowed to run on the node. In a GKE cluster, you can apply a taint to a node pool, which applies the taint to all nodes in the pool.\nTo create a node pool with node taints, you can use the Google Cloud CLI, the Google Cloud console, or the GKE API.\nTo create a node pool with node taints, run the following command:\n```\ngcloud container node-pools create POOL_NAME \\\u00a0 \u00a0 --cluster CLUSTER_NAME \\\u00a0 \u00a0 --node-taints KEY=VALUE:EFFECT\n```\nReplace the following:- ``: the name of the node pool to create.\n- ``: the name of the cluster in which the node pool is created.\n- ``: one of the following [effect values](#effects) :`PreferNoSchedule`,`NoSchedule`, or`NoExecute`.\n- `` `=` ``: a key-value pair associated with the``.\nFor example, the following command creates a node pool on an existing cluster and applies a taint that has a key-value of `dedicated=experimental` with a `NoSchedule` effect:\n```\ngcloud container node-pools create example-pool --cluster example-cluster \\\n --node-taints dedicated=experimental:NoSchedule\n```\nThis command creates a node pool and applies a taint that has key-value of `special=gpu` with a `NoExecute` effect:\n```\ngcloud container node-pools create example-pool-2 --cluster example-cluster \\\n --node-taints special=gpu:NoExecute\n```\nTo create a node pool with node taints, perform the following steps:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- On the **Cluster details** page, click **Add Node Pool** .\n- From the navigation pane, click **Metadata** .\n- Under **Node taints** , click **Add Taint** .\n- Select the desired effect in the **Effect** drop-down list.\n- Enter the desired key-value pair in the **Key** and **Value** fields.\n- Click **Create** .\nWhen you use the API to create a node pool, include the `nodeTaints` field under `nodeConfig` . Here's an example:\n```\nPOST https://container.googleapis.com/v1/projects/PROJECT_ID/zones/COMPUTE_ZONE/clusters/CLUSTER_ID/nodePools{\u00a0 'nodePool': {\u00a0 \u00a0 'name': 'example-pool',\u00a0 \u00a0 'nodeConfig': {\u00a0 \u00a0 \u00a0 'nodeTaints': [\u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'key': 'dedicated',\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'Value': 'experimental',\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'effect': 'NoSchedule'\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 \u00a0 ...\u00a0 \u00a0 }\u00a0 \u00a0 ...\u00a0 }}\n```\n## Configure Pods to tolerate a taint\nYou can configure Pods to tolerate a taint by including the `tolerations` field in the Pods' specification. Here's a portion of a [Pod specification](https://v1-25.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#pod-v1-core) .\nThis Pod can be scheduled on a node that has the `dedicated=experimental:NoSchedule` taint:\n```\ntolerations:- key: dedicated\u00a0 operator: Equal\u00a0 value: experimental\u00a0 effect: NoSchedule\n```\n## Add a taint to an existing node\nYou can add taints to an existing node by using the [kubectl taint](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#taint) command:\n```\nkubectl taint nodes NODE_NAME KEY=VALUE:EFFECT\n```\nFor example, the following command applies a taint that has a key-value of `dedicated=experimental` with a `NoSchedule` effect to the `mynode` node:\n```\nkubectl taint nodes mynode dedicated=experimental:NoSchedule\n```\nYou can also add taints to nodes that have a specific label by using the `-l` selector along with the specified label and value:\n```\nkubectl taint nodes -l LABEL=LABEL_VALUE KEY=VALUE:EFFECT\n```\n**Note:** In GKE, all node pools have a label in the following format (where``is the name of the node pool):```\ncloud.google.com/gke-nodepool:POOL_NAME\n```\nFor example, the following command adds a taint with key `dedicated-pool` to GKE nodes in the `my_pool` node pool:\n```\nkubectl taint nodes -l cloud.google.com/gke-nodepool=my_pool dedicated-pool=my_pool:NoSchedule\n```\n## Inspect taints for a node\nTo see the taints for a node, use the `kubectl` command-line tool.\n- Get a list of all nodes in your cluster by running the following command:```\nkubectl get nodes\n```\n- Inspect a node by running the following command:```\nkubectl describe node NODE_NAME\n```\n- In the returned output, look for the `Taints` field. The output is similar to the following:```\nTaints: dedicated-pool=mypool:NoSchedule\n```## Remove a taint from a node\nYou can use `kubectl taint` to remove taints. You can remove taints by key, key-value, or key-effect.\nFor example, the following command removes all the taints with the `dedicated` key from the `mynode` node:\n```\nkubectl taint nodes mynode dedicated\n```\n**Note:** Starting in GKE version 1.22, cluster autoscaler combines existing node and node pool information to represent the whole node pool. Cluster autoscaler detects node pool updates and manual node changes to scale cluster up.\n## Remove all taints from a node pool\nTo remove all taints from a node pool, run the following command:\n```\ngcloud beta container node-pools update POOL_NAME \\--node-taints=\"\" \\--cluster=CLUSTER_NAME\n```\nReplace the following:\n- ``: the name of the node pool to change.\n- ``: the name of the cluster in which the node pool was created.## What's next\n- [Learn more about node pools](/kubernetes-engine/docs/concepts/node-pools) .\n- [Read the Kubernetes documentation for taints and tolerations](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/) .\n- [Read the kubectl taint documentation](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#taint) .", "guide": "Google Kubernetes Engine (GKE)"}