{"title": "Google Kubernetes Engine (GKE) - Receive cluster notifications", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-notifications", "abstract": "# Google Kubernetes Engine (GKE) - Receive cluster notifications\nThis page shows you how to use Pub/Sub to receive notifications about your Google Kubernetes Engine (GKE) clusters.\n", "content": "## Overview\nWhen certain events occur that are relevant to your GKE clusters, such as important scheduled upgrades or available security bulletins, GKE publishes notifications about those events as messages to Pub/Sub topics that you configure. You can receive these notifications on a Pub/Sub subscription, [integrate with third-party services](/kubernetes-engine/docs/tutorials/cluster-notifications-slack) , and filter for the notification types you want to receive.\nTo learn more about the benefits of cluster notifications, how notifications work, and why filtering is important, refer to [Cluster notifications](/kubernetes-engine/docs/concepts/cluster-notifications) . You can configure cluster notifications in new and existing Standard clusters, and by updating existing Autopilot clusters.\n## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.\n- [Create a Pub/Sub topic](/pubsub/docs/admin#creating_a_topic) in your project.## Enable cluster notifications on a new cluster\nYou can enable GKE cluster notifications on a new Standard cluster using the Google Cloud CLI or the Google Cloud console. To enable notification on Autopilot clusters, you must first create an Autopilot cluster and then [update the cluster to use cluster notifications](#enable-notifications-existing) .\nTo enable cluster notifications on a new cluster, run the following command:\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --region=COMPUTE_REGION \\\u00a0 \u00a0 --notification-config=pubsub=ENABLED,pubsub-topic=projects/PROJECT_ID/topics/TOPIC_NAME,filter=NOTIFICATION_TYPE\n```\nReplace the following:- ``: the name of your new cluster.\n- ``: the [compute region](/compute/docs/regions-zones#available) for your new cluster. For zonal Standard clusters, use`--zone=` ``.\n- ``: your Google Cloud project ID.\n- ``: the name of your Pub/Sub topic.\n- `` : a pipe (|) delimited list of the notification types you want to receive. For example, `filter=\"UpgradeEvent|SecurityBulletinEvent\"` only sends `UpgradeEvent` and `SecurityBulletinEvent` notifications, ignoring all other types. **Note:** If you do not specify values for `filter` , you will receive all notifications that are applicable to your cluster configuration.\nTo enable cluster notifications on a new Standard cluster, perform the following:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Click **Create** .\n- On the **Create cluster** dialog, next to **GKE Standard** , click **Configure** .\n- In the navigation pane, in the **Cluster** section, click **Automation** .\n- Select the **Enable notifications** checkbox.\n- From the drop-down list, select the Pub/Sub topic you created.\n- To filter notifications, select the **Filter notification types** checkbox, and then select the notification types you want to receive. **Note:** If you do not select notification types to filter, you will receive all applicable notifications.\n- Continue to configure the cluster as desired.\n- Click **Create** .\nAfter enabling notifications, [create a Pub/Sub subscription](/pubsub/docs/admin#creating_subscriptions) for your topic.\n**Note:** GKE has no restrictions on how you correlate topics with clusters, as long as the topics are in the same project as the clusters. You can choose to create one topic for all clusters, or create multiple topics for groups of clusters.\n## Enable cluster notifications on an existing cluster\nYou can enable GKE cluster notifications on an existing cluster using the Google Cloud CLI or the Google Cloud console.\nTo enable cluster notifications on an existing cluster, run the following command:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --region=COMPUTE_REGION \\\u00a0 \u00a0 --notification-config=pubsub=ENABLED,pubsub-topic=projects/PROJECT_ID/topics/TOPIC_NAME,filter=NOTIFICATION_TYPE\n```\nReplace the following:- ``: the name of your cluster.\n- ``: the [compute region](/compute/docs/regions-zones#available) for your new cluster. For zonal Standard clusters, use`--zone=` ``.\n- ``: your Google Cloud project ID.\n- ``: the name of your Pub/Sub topic.\n- `` : a pipe (|) delimited list of the notification types you want to receive. For example, `filter=\"UpgradeEvent|SecurityBulletinEvent\"` only sends `UpgradeEvent` and `SecurityBulletinEvent` notifications, ignoring all other types. **Note:** If you do not specify values for `filter` , you will receive all notifications that are applicable to your cluster configuration.\nTo enable cluster notifications on an existing cluster, perform the following:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Click the name of the cluster you want to modify.\n- In the **Automation** section, next to **Notifications** , click edit **Edit notifications** .\n- In the **Edit notifications** dialog, select the **Enable notifications** checkbox.\n- From the drop-down list, select the Pub/Sub topic you created.\n- To filter notifications, select the **Filter notification types** checkbox, and then select the notification types you want to receive. **Note:** If you do not select notification types to filter, you will receive all applicable notifications.\n- Click **Save changes** .\nAfter enabling notifications, [create a Pub/Sub subscription](/pubsub/docs/admin#creating_subscriptions) for your topic.\n**Note:** GKE has no restrictions on how you correlate topics with clusters, as long as the topics are in the same project as the clusters. You can choose to create one topic for all clusters, or create multiple topics for groups of clusters\n## Filter cluster notifications\nYou can filter notifications by [notification type](/kubernetes-engine/docs/concepts/cluster-notifications#notification-types) to ensure that you receive notifications that you want.\nYou can choose to filter notifications using the following methods:\n- **GKE** : Specify values for`filter`in the`--notification-config`flag, as shown in the previous examples for enabling cluster notifications.\n- **Pub/Sub** : Configure your Pub/Sub subscription to [filter messages](/pubsub/docs/filtering) when you create a subscription.\n**Note:** We recommend that you filter using GKE. Filtering in GKE lets you modify the filters at any time and eliminates the [undelivered message cost](/pubsub/pricing#filtered_messages) associated with Pub/Sub filters. To learn more about the differences between the filtering options, see [Filtering notifications](/kubernetes-engine/docs/concepts/cluster-notifications#filtering) .\n### Modify existing filters in GKE\nTo modify your existing GKE cluster notification filters, follow the instructions in [Enable notifications on an existing cluster](#enable-notifications-existing) and specify the new notification types to filter in the `gcloud` command or select the new types in the Google Cloud console.\n### Disable filters in GKE\nYou can disable your GKE notification filters and receive all notification types applicable to your cluster using the gcloud CLI or the Google Cloud console.\nTo disable filters using the gcloud CLI, run the following command:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 --region=COMPUTE_REGION \\\u00a0 --notification-config=pubsub=ENABLED,pubsub-topic=projects/PROJECT_ID/topics/TOPIC_NAME\n```\nTo disable filters using the Google Cloud console, perform the following:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Click the name of the cluster you want to modify.\n- In the **Automation** section, next to **Notifications** , click edit **Edit notifications** .\n- In the **Edit notifications** dialog, clear the **Filter notification types** checkbox.\n- Click **Save changes** .## Verify setup for cluster notifications\nOn Autopilot mode, you can verify cluster notifications as follows:\n- [Start a control plane upgrade](/kubernetes-engine/docs/how-to/upgrading-a-cluster#upgrade_cp) .\n- Wait for GKE to automatically upgrade your nodes to the new version. The time taken might vary based on configured maintenance windows and exclusions.\n- After GKE upgrades your nodes, [check your Pub/Sub subscription](/pubsub/docs/pull) .\nOn Standard mode, you can verify cluster notifications as follows:\n- [Upgrade a specific node pool to a new version](/kubernetes-engine/docs/how-to/upgrading-a-cluster#upgrade_nodes) . If you don't want to change the GKE version on your nodes, you can upgrade to the same version currently on the nodes. **Caution:** Manually upgrading a Standard node pool ignores your configured [maintenance windows](/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions) and might cause disruptions to running workloads.\n- After GKE upgrades your nodes, [check your Pub/Sub subscription](/pubsub/docs/pull) .\nYou can only manually verify setup for the `UpgradeEvent` notification type. If your filters are configured to ignore this type, you won't see a message.\n## Disable cluster notifications\nYou can disable cluster notifications using the gcloud CLI or the Google Cloud console.\nTo disable notifications using the gcloud CLI, run the following command:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 --region=COMPUTE_REGION \\\u00a0 --notification-config=pubsub=DISABLED\n```\nTo disable notifications using the Google Cloud console, perform the following:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Click the name of the cluster you want to modify.\n- In the **Automation** section, next to **Notifications** , click edit **Edit notifications** .\n- In the **Edit notifications** dialog, clear the **Enable notifications** checkbox.\n- Click **Save changes** .\nOptionally, [delete the Pub/Sub topic](/pubsub/docs/admin#deleting_a_topic) you created for notifications.\n## What's next\n- Learn more about [cluster notifications](/kubernetes-engine/docs/concepts/cluster-notifications) .\n- Learn about [configuring Pub/Sub notifications](/pubsub/docs/filtering) .\n- Learn how to [configure cluster notifications for third-party services](/kubernetes-engine/docs/tutorials/cluster-notifications-slack) .", "guide": "Google Kubernetes Engine (GKE)"}