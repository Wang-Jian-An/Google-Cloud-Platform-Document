{"title": "Google Kubernetes Engine (GKE) - Improve workload efficiency using NCCL Fast Socket", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/nccl-fast-socket", "abstract": "# Google Kubernetes Engine (GKE) - Improve workload efficiency using NCCL Fast Socket\nThis page shows you how to use the [NVIDIA Collective Communication Library (NCCL) Fast Socket plugin](https://github.com/google/nccl-fastsocket) to run more efficient workloads on your Google Kubernetes Engine (GKE) clusters.\nAutopilot clusters don't support NCCL Fast Socket.\n", "content": "## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.\n### Limitations\n- [Compute Engine limitations](/compute/docs/networking/using-gvnic#limitations) apply.\n- [gVNIC limitations](/kubernetes-engine/docs/how-to/using-gvnic#limitations) apply.\n- NCCL Fast Socket is only supported on node pools that have [hardware accelerators](/kubernetes-engine/docs/how-to/gpus) enabled.\n### Requirements\n- Your node pools must have gVNIC enabled to use NCCL Fast Socket.\n- GKE nodes must use a Container-Optimized OS [node image](/kubernetes-engine/docs/concepts/node-images#cos) .\n- Your clusters must be running GKE version 1.25.2-gke.1700 or later.## Create a cluster\nCreate a new cluster:\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --cluster-version=VERSION \\\u00a0 \u00a0 --region=COMPUTE_REGION\n```\nReplace the following:\n- ``: the name of the new cluster.\n- ``: the GKE version, which must be 1.25.2-gke.1700 or later. You can also use the`--release-channel`flag to select a [release channel](/kubernetes-engine/docs/concepts/release-channels) . The release channel must have a default version of 1.25.2-gke.1700 or later.\n- ``: the [Compute Engine region](/compute/docs/regions-zones#available) for the new cluster. For zonal clusters, use`--zone=` ``.## Enable NCCL Fast Socket\nCreate a node pool that uses the NCCL Fast Socket plugin. You can also update an existing node pool using [gcloud container node-pools update](/sdk/gcloud/reference/container/node-pools/update) .\n```\ngcloud container node-pools create NODEPOOL_NAME \\\u00a0 \u00a0 --accelerator type=ACCELERATOR_TYPE,count=ACCELERATOR_COUNT \\\u00a0 \u00a0 --machine-type=MACHINE_TYPE \\\u00a0 \u00a0 --cluster=CLUSTER_NAME \\\u00a0 \u00a0 --enable-fast-socket \\\u00a0 \u00a0 --enable-gvnic\n```\nReplace the following:\n- ``: the name of the new node pool.\n- ``: the name of the cluster.\n- ``: the GPU type. Can be one of the following:- `nvidia-tesla-k80`\n- `nvidia-tesla-p100`\n- `nvidia-tesla-p4`\n- `nvidia-tesla-v100`\n- `nvidia-tesla-t4`\n- `nvidia-tesla-a100`\n- `nvidia-a100-80gb`\n- `nvidia-l4`\n- ``: the number of GPUs per node.\n- ``: the type of machine you want to use. NCCL Fast Socket is not supported on [memory-optimized machine types](/compute/docs/machine-types#memory-optimized_machine_type_family) .## Install NVIDIA GPU device drivers\nFollow the instructions in [Installing NVIDIA GPU device drivers](/kubernetes-engine/docs/how-to/gpus#installing_drivers) to install the required NVIDIA device drivers on your nodes.\n## Verify that NCCL Fast Socket is enabled\nTo verify that NCCL Fast Socket is enabled, view the kube-system pods:\n```\nkubectl get pods -n kube-system\n```\nThe output is similar to the following:\n```\nNAME        READY STATUS RESTARTS AGE\nnccl-fastsocket-installer-qvfdw 2/2  Running 0   10m\nnccl-fastsocket-installer-rtjs4 2/2  Running 0   10m\nnccl-fastsocket-installer-tm294 2/2  Running 0   10m\n```\nIn this output, the number of Pods should be equal to the number of nodes in the node pool.\n## Disable NCCL Fast Socket\nTo disable NCCL Fast Socket, run the following command:\n```\ngcloud container node-pools update NODEPOOL_NAME \\\u00a0 \u00a0 --cluster=CLUSTER_NAME \\\u00a0 \u00a0 --no-enable-fast-socket\n```\nExisting nodes still have the plugin installed. You must manually [resize the node pool](/kubernetes-engine/docs/how-to/resizing-a-cluster) to migrate workloads to new nodes.\n## Troubleshooting\nTo troubleshoot gVNIC, see [Troubleshooting Google Virtual NIC](/compute/docs/troubleshooting/gvnic) .\n## What's next\n- Use [network policy logging](/kubernetes-engine/docs/how-to/network-policy-logging) to record when connections to Pods are allowed or denied by your cluster's [network policies](https://kubernetes.io/docs/concepts/services-networking/network-policies/) .", "guide": "Google Kubernetes Engine (GKE)"}