{"title": "Google Kubernetes Engine (GKE) - GKE \u4e2d\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/access-scopes?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - GKE \u4e2d\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\n\u672c\u9801\u9762\u4ecb\u7d39\u5411 Google Kubernetes Engine (GKE) \u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u6388\u4e88\u7684\u9ed8\u8a8d\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u3002\n", "content": "## \u4ec0\u9ebc\u662f\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\uff1f\n\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u662f\u7232\u7bc0\u9ede\u4ee5\u53ca\u7bc0\u9ede\u4e0a\u904b\u884c\u7684\u5de5\u4f5c\u8ca0\u8f09\uff08\u5982\u679c\u5de5\u4f5c\u8ca0\u8f09\u4f7f\u7528 [\u61c9\u7528\u9ed8\u8a8d\u6191\u64da [ADC]](https://cloud.google.com/docs/authentication/application-default-credentials?hl=zh-cn) \uff09\u6388\u4e88\u6b0a\u9650\u7684\u50b3\u7d71\u65b9\u6cd5\u3002 \u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u5b9a\u7fa9\u4f86\u81ea\u5ba2\u6236\u7aef\u5eab\u6216 gcloud CLI \u7684 API \u8abf\u7528\u4e2d\u4f7f\u7528\u7684 OAuth \u7bc4\u570d\u3002\n\u6211\u5011\u5efa\u8b70\u60a8\u4e0d\u8981\u6307\u5b9a\u60a8\u81ea\u5df1\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u3002\u60a8\u61c9\u8a72\u4f7f\u7528 [IAM \u6b0a\u9650](https://cloud.google.com/iam/docs/creating-managing-service-accounts?hl=zh-cn#creating) \u6216 [Kubernetes \u57fa\u65bc\u89d2\u8272\u7684\u8a2a\u554f\u6b0a\u9650\u63a7\u5236 (RBAC)](https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control?hl=zh-cn) \u5411\u7279\u5b9a IAM \u670d\u52d9\u8cec\u865f\u6216 Kubernetes \u670d\u52d9\u8cec\u865f\u6388\u4e88\u8a2a\u554f\u6b0a\u9650\u3002\n## \u9ed8\u8a8d\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\n\u7576\u60a8\u5275\u5efa\u65b0\u7684 GKE \u96c6\u7fa3\u6642\uff0cGoogle Cloud \u6703\u6839\u64da\u7bc0\u9ede\u4f7f\u7528\u7684\u670d\u52d9\u8cec\u865f\u7232\u7bc0\u9ede\u5206\u914d\u4e00\u7d44\u9ed8\u8a8d\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u3002\u9019\u4e9b\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u53ef\u7232 GKE \u5553\u7528\u7279\u5b9a\u529f\u80fd\u3002\u60a8\u9084\u53ef\u4ee5\u5728\u5275\u5efa [Standard \u96c6\u7fa3](https://cloud.google.com/sdk/gcloud/reference/container/clusters/create?hl=zh-cn#--scopes) \u6642\u4f7f\u7528 `--scopes` \u6a19\u8a8c\u624b\u52d5\u8a2d\u7f6e\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u3002 [Autopilot \u96c6\u7fa3](https://cloud.google.com/sdk/gcloud/reference/container/clusters/create-auto?hl=zh-cn#--scopes) \u6216 [\u7bc0\u9ede\u6c60](https://cloud.google.com/sdk/gcloud/reference/container/node-pools/create?hl=zh-cn#--scopes) \u3002 \u60a8\u7121\u6cd5\u4fee\u6539\u73fe\u6709\u7bc0\u9ede\u6c60\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u3002\u8acb\u6539\u7232\u5275\u5efa\u5177\u6709\u65b0\u7bc4\u570d\u7684\u65b0\u7bc0\u9ede\u6c60\uff0c\u4e26\u5c07\u5de5\u4f5c\u8ca0\u8f09\u9077\u79fb\u5230\u8a72\u7bc0\u9ede\u6c60\u3002\n\u4ee5\u4e0b\u5e7e\u500b\u90e8\u5206\u4ecb\u7d39\u4e86 GKE \u6839\u64da\u60a8\u662f\u5426\u6307\u5b9a\u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f\u4ee5\u53ca\u662f\u5426\u624b\u52d5\u6307\u5b9a\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u5411\u7bc0\u9ede\u6dfb\u52a0\u7684\u9ed8\u8a8d\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u3002\n### Autopilot \u96c6\u7fa3\n| \u670d\u52d9\u8cec\u865f     | \u60a8\u662f\u5426\u624b\u52d5\u6307\u5b9a\u4e86\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\uff1f | GKE \u6dfb\u52a0\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d                                                                                      |\n|:----------------------------|:---------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Compute Engine \u9ed8\u8a8d\u670d\u52d9\u8cec\u865f | \u5426        | https://www.googleapis.com/auth/devstorage.read_only https://www.googleapis.com/auth/service.management.readonly https://www.googleapis.com/auth/servicecontrol https://www.googleapis.com/auth/trace.append https://www.googleapis.com/auth/logging.write\uff1a\u5982\u679c\u5df2\u5553\u7528 Cloud Logging\uff0c\u5247\u6dfb\u52a0 https://www.googleapis.com/auth/monitoring\uff1a\u5982\u679c\u5df2\u5553\u7528 Cloud Monitoring\uff0c\u5247\u6dfb\u52a0 |\n| Compute Engine \u9ed8\u8a8d\u670d\u52d9\u8cec\u865f | \u662f        | \u624b\u52d5\u6307\u5b9a\u7684\u7bc4\u570d                                                                                        |\n| \u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f    | \u5426        | https://www.googleapis.com/auth/cloud-platform                                                                                |\n| \u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f    | \u662f        | \u624b\u52d5\u6307\u5b9a\u7684\u7bc4\u570d                                                                                        |\n### Standard \u96c6\u7fa3\n| \u670d\u52d9\u8cec\u865f     | \u624b\u52d5\u6307\u5b9a\u4e86\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\uff1f | GKE \u8a2a\u554f\u6b0a\u9650\u7bc4\u570d                                                                                        |\n|:----------------------------|:---------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Compute Engine \u9ed8\u8a8d\u670d\u52d9\u8cec\u865f | \u5426       | https://www.googleapis.com/auth/devstorage.read_only https://www.googleapis.com/auth/service.management.readonly https://www.googleapis.com/auth/servicecontrol https://www.googleapis.com/auth/trace.append https://www.googleapis.com/auth/logging.write\uff1a\u5982\u679c\u5df2\u5553\u7528 Cloud Logging\uff0c\u5247\u6dfb\u52a0 https://www.googleapis.com/auth/monitoring\uff1a\u5982\u679c\u5df2\u5553\u7528 Cloud Monitoring\uff0c\u5247\u6dfb\u52a0 |\n| Compute Engine \u9ed8\u8a8d\u670d\u52d9\u8cec\u865f | \u662f       | \u624b\u52d5\u6307\u5b9a\u7684\u7bc4\u570d https://www.googleapis.com/auth/monitoring.write https://www.googleapis.com/auth/logging.write\uff1a\u5982\u679c\u5df2\u5553\u7528 Cloud Logging\uff0c\u5247\u6dfb\u52a0 https://www.googleapis.com/auth/monitoring\uff1a\u5982\u679c\u5df2\u5553\u7528 Cloud Monitoring\uff0c\u5247\u6dfb\u52a0                                    |\n| \u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f    | \u5426       | https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform                                                                    |\n| \u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f    | \u662f       | \u624b\u52d5\u6307\u5b9a\u7684\u7bc4\u570d https://www.googleapis.com/auth/monitoring.write https://www.googleapis.com/auth/logging.write\uff1a\u5982\u679c\u5df2\u5553\u7528 Cloud Logging\uff0c\u5247\u6dfb\u52a0 https://www.googleapis.com/auth/monitoring\uff1a\u5982\u679c\u5df2\u5553\u7528 Cloud Monitoring\uff0c\u5247\u6dfb\u52a0                                    |\n## \u7232\u5de5\u4f5c\u8ca0\u8f09\u914d\u7f6e\u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f\n[IAM](https://cloud.google.com/iam/docs/overview?hl=zh-cn) \u662f\u4e00\u7a2e\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\u7cfb\u7d71\uff0c\u7528\u65bc\u5411 Google Cloud \u9805\u76ee\u4e2d\u7684\u7528\u6236\u548c\u670d\u52d9\u8cec\u865f\u6388\u4e88\u5df2\u7372\u6388\u6b0a\u7684\u89d2\u8272\u3002 [\u670d\u52d9\u8cec\u865f](https://cloud.google.com/iam/docs/service-accounts?hl=zh-cn) \u662f\u4e00\u7a2e\u7279\u6b8a\u7684 Google \u8cec\u865f\uff0c\u7528\u65bc\u4ee3\u8868\u60a8\u57f7\u884c\u90e8\u7f72\u61c9\u7528\u7b49\u4efb\u52d9\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 IAM \u5275\u5efa\u670d\u52d9\u8cec\u865f\uff0c\u7136\u5f8c\u4f7f\u7528 IAM \u653f\u7b56\u7d81\u5b9a\u4f86\u4fdd\u8b77\u8a72\u8cec\u865f\u3002\n\u5982\u679c\u60a8\u7684\u5de5\u4f5c\u8ca0\u8f09\u9700\u8981\u8a2a\u554f Compute Engine\uff0c\u8acb\u5411\u670d\u52d9\u8cec\u865f\u6388\u4e88 [Compute Engine Admin](https://cloud.google.com/compute/docs/access/iam?hl=zh-cn#compute.admin) \u89d2\u8272\u3002\u5982\u679c\u60a8\u7684\u5de5\u4f5c\u8ca0\u8f09\u9700\u8981\u5f9e Artifact Registry \u62c9\u53d6\u79c1\u6709\u6620\u50cf\uff0c\u8acb\u53c3\u95b1 [\u7232 Artifact Registry \u4ee3\u78bc\u5eab\u914d\u7f6e\u8a2a\u554f\u6b0a\u9650\u63a7\u5236](https://cloud.google.com/artifact-registry/docs/access-control?hl=zh-cn) \u3002\n### \u5275\u5efa\u670d\u52d9\u8cec\u865f\n\u5982\u9700\u5275\u5efa\u540d\u7232 `kubernetes-engine-node-sa` \u7684\u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\nexport NODE_SA_NAME=kubernetes-engine-node-sagcloud iam service-accounts create $NODE_SA_NAME \\\u00a0 --display-name \"GKE Node Service Account\"export NODE_SA_EMAIL=`gcloud iam service-accounts list --format='value(email)' \\\u00a0 --filter='displayName:GKE Node Service Account'`\n```\n**\u6ce8\u610f** \uff1a\u9019\u4e9b\u547d\u4ee4\u6703\u5c0e\u51fa `$NODE_SA_NAME` \u548c `$NODE_SA_EMAIL` \u9019\u5169\u500b\u8b8a\u91cf\uff0c\u9019\u4e9b\u8b8a\u91cf\u5728\u672c\u9801\u5f8c\u9762\u8a18\u9304\u7684\u547d\u4ee4\u4e2d\u4f7f\u7528\u3002\n### \u6388\u4e88\u6700\u5c0f\u89d2\u8272\n\u5982\u9700\u7232\u670d\u52d9\u8cec\u865f\u914d\u7f6e\u6700\u5c0f\u7684\u5fc5\u8981\u89d2\u8272\u548c\u6b0a\u9650\u4ee5\u4fbf GKE \u7bc0\u9ede\u6b63\u5e38\u904b\u884c\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5176\u4e2d `$PROJECT` \u662f\u60a8\u7684 [\u9805\u76ee ID](https://support.google.com/cloud/answer/6158840?hl=zh-cn) \uff1a\n```\nexport PROJECT=`gcloud config get-value project`gcloud projects add-iam-policy-binding $PROJECT \\\u00a0 --member serviceAccount:$NODE_SA_EMAIL \\\u00a0 --role roles/monitoring.metricWritergcloud projects add-iam-policy-binding $PROJECT \\\u00a0 --member serviceAccount:$NODE_SA_EMAIL \\\u00a0 --role roles/monitoring.viewergcloud projects add-iam-policy-binding $PROJECT \\\u00a0 --member serviceAccount:$NODE_SA_EMAIL \\\u00a0 --role roles/logging.logWriter\n```\n### \u6388\u4e88\u5176\u4ed6\u89d2\u8272\n**\u8b66\u544a\uff1a** \u9664\u975e\u5fc5\u8981\uff0c\u5426\u5247\u4e0d\u61c9\u5411\u6b64\u670d\u52d9\u8cec\u865f\u6388\u4e88 `compute.admin` \u89d2\u8272\u3002\u6388\u4e88\u6b64\u89d2\u8272\u5f8c\uff0c\u5de5\u4f5c\u8ca0\u8f09\u53ef\u4ee5\u57f7\u884c\u591a\u7a2e\u64cd\u4f5c\uff0c\u5982\u5728\u7bc0\u9ede\u4e0a\u5275\u5efa\u3001\u522a\u9664\u548c\u8b80\u53d6\u5143\u6578\u64da\uff0c\u4ee5\u53ca\u4f7f\u7528 SSH \u9023\u63a5\u5230\u7bc0\u9ede\u3002\n\u8981\u5411\u670d\u52d9\u8cec\u865f\u6388\u4e88 [Compute Engine Admin](https://cloud.google.com/compute/docs/access/iam?hl=zh-cn#compute.admin) \u89d2\u8272\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ngcloud projects add-iam-policy-binding $PROJECT \\\u00a0 --member serviceAccount:$NODE_SA_EMAIL \\\u00a0 --role roles/compute.admin\n```\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5411\u670d\u52d9\u8cec\u865f\u6388\u4e88 Artifact Registry \u4e2d\u5b58\u5132\u7684\u79c1\u6709\u6620\u50cf\u7684\u8a2a\u554f\u6b0a\u9650\uff0c\u8acb\u53c3\u95b1 [\u6388\u4e88\u5c0d Google Kubernetes Engine \u96c6\u7fa3\u7684\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/artifact-registry/docs/access-control?hl=zh-cn#gke) \u3002\n### \u5275\u5efa\u4f7f\u7528\u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f\u7684\u96c6\u7fa3\u6216\u7bc0\u9ede\u6c60\n\u8981\u5275\u5efa\u4f7f\u7528\u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f\u7684\u96c6\u7fa3\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ngcloud container clusters create --service-account=$NODE_SA_EMAIL\n```\n\u5982\u9700\u5728\u73fe\u6709\u96c6\u7fa3\u4e2d\u5275\u5efa\u7bc0\u9ede\u6c60\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ngcloud container node-pools create --service-account=$NODE_SA_EMAIL\n```\n**\u6ce8\u610f** \uff1a\u60a8\u9084\u53ef\u4ee5\u901a\u904e\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u627e\u5230\u670d\u52d9\u8cec\u865f\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\uff1a```\ngcloud iam service-accounts list --format='value(email)' \\\n  --filter='displayName:Node Service Account'\n```", "guide": "Google Kubernetes Engine (GKE)"}