{"title": "Google Kubernetes Engine (GKE) - \u8a2d\u7f6e\u4f7f\u7528\u5171\u4eab VPC \u7684\u591a\u96c6\u7fa3 Service", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/msc-setup-with-shared-vpc-networks?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u8a2d\u7f6e\u4f7f\u7528\u5171\u4eab VPC \u7684\u591a\u96c6\u7fa3 Service\n\u672c\u9801\u9762\u4ecb\u7d39\u5e38\u898b\u7684 [\u591a\u96c6\u7fa3\u670d\u52d9 (MCS)](https://cloud.google.com/kubernetes-engine/docs/concepts/multi-cluster-services?hl=zh-cn) \u5834\u666f\u3002\u672c\u9801\u9762\u4ecb\u7d39\u7684\u5834\u666f\u5177\u6709\u4ee5\u4e0b\u7279\u5fb5\uff1a\n- **\u5169\u500b GKE \u96c6\u7fa3** \uff1a\u7b2c\u4e00\u500b GKE \u96c6\u7fa3\u5df2\u8a3b\u518a\u5230\u81ea\u5df1\u9805\u76ee\u7684 [\u8266\u968a](https://cloud.google.com/anthos/fleet-management/docs?hl=zh-cn) \u3002\u9019\u662f\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u3002\u7b2c\u4e8c\u500b GKE \u96c6\u7fa3\u5df2\u8a3b\u518a\u5230\u540c\u4e00\u8266\u968a\uff0c\u4f46\u53ef\u80fd\u4e0d\u5728\u540c\u4e00\u500b\u9805\u76ee\u4e2d\uff08\u5177\u9ad4\u53d6\u6c7a\u65bc\u5be6\u969b\u60c5\u6cc1\uff09\u3002\u5169\u500b GKE \u96c6\u7fa3\u90fd\u662f [VPC \u539f\u751f\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/concepts/alias-ips?hl=zh-cn) \u3002\n- **\u76f8\u540c\u7684 VPC \u7db2\u7d61** \uff1a\u5169\u500b GKE \u96c6\u7fa3\u90fd\u4f7f\u7528\u540c\u4e00\u5171\u4eab VPC \u7db2\u7d61\u4e2d\u7684\u5b50\u7db2\u3002\n- \u9019\u5169\u500b\u96c6\u7fa3\u4e2d\u5747\u5553\u7528\u4e86 **\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408** \u3002", "content": "## \u8853\u8a9e\n\u8853\u8a9e\u201c\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u201d \u548c\u201cGKE \u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u201d \u7684\u542b\u7fa9\u4e0d\u540c\u3002\n- \u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u662f\u5305\u542b\u5171\u4eab VPC \u7db2\u7d61\u7684\u9805\u76ee\u3002\n- GKE \u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u662f\u5305\u542b\u8981\u5411\u5176\u8a3b\u518a\u96c6\u7fa3\u7684 [\u8266\u968a](https://cloud.google.com/anthos/fleet-management/docs?hl=zh-cn) \u7684\u9805\u76ee\u3002## \u60c5\u6cc1\n\u4e0b\u8868\u4ecb\u7d39\u4e86\u5e38\u898b\u7684 MCS \u5834\u666f\uff1a\n| \u60c5\u6cc1                        | \u8266\u968a\u5bbf\u4e3b\u9805\u76ee\uff08\u5305\u542b\u7b2c\u4e00\u500b\u96c6\u7fa3\u7684\u9805\u76ee\uff09 | \u7b2c\u4e8c\u500b\u96c6\u7fa3\u7684\u4f4d\u7f6e     |\n|:----------------------------------------------------------------------------------------------------|:---------------------------------------|:------------------------------------|\n| \u540c\u4e00\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee\u4e2d\u7684\u96c6\u7fa3                  | \u5171\u4eab VPC \u670d\u52d9\u9805\u76ee      | \u8207\u7b2c\u4e00\u500b\u96c6\u7fa3\u76f8\u540c\u7684\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee |\n| \u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4f5c\u7232\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\uff08\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u7684\u4e00\u500b\u96c6\u7fa3\u3001\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee\u4e2d\u7684\u7b2c\u4e8c\u500b\u96c6\u7fa3\uff09 | \u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee      | \u5171\u4eab VPC \u670d\u52d9\u9805\u76ee     |\n| \u4e0d\u540c\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee\u4e2d\u7684\u96c6\u7fa3                  | \u5171\u4eab VPC \u670d\u52d9\u9805\u76ee      | \u5176\u4ed6\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee    |\n## \u524d\u63d0\u689d\u4ef6\n\u5728\u8a2d\u7f6e MCS \u7684\u8de8\u9805\u76ee\u914d\u7f6e\u4e4b\u524d\uff0c\u8acb\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9a5f\uff1a\n- \u78ba\u4fdd\u60a8\u719f\u6089 [\u5171\u4eab VPC \u6982\u5ff5](https://cloud.google.com/vpc/docs/shared-vpc?hl=zh-cn) \u3002\n- \u78ba\u4fdd\u60a8\u719f\u6089 [\u4f7f\u7528\u5171\u4eab VPC \u8a2d\u7f6e\u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-shared-vpc?hl=zh-cn) \u3002\n- \u78ba\u4fdd\u60a8\u77ad\u89e3 MCS \u7684 [\u9650\u5236](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-cluster-services?hl=zh-cn#limitations) \u548c [\u5df2\u77e5\u554f\u984c](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-cluster-services?hl=zh-cn#known_issues) \u3002## \u540c\u4e00\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee\u4e2d\u7684\u96c6\u7fa3\n\u672c\u90e8\u5206\u63d0\u4f9b\u4e86\u4e00\u500b\u793a\u4f8b MCS \u914d\u7f6e\uff0c\u5176\u4e2d\u6d89\u53ca\u5169\u500b\u73fe\u6709\u7684 GKE \u96c6\u7fa3\uff0c\u9019\u5169\u500b\u96c6\u7fa3\u90fd\u4f4d\u65bc\u540c\u4e00\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee\u4e2d\uff1a\n- \u9019\u5169\u500b\u96c6\u7fa3\u4f7f\u7528``\u4e2d\u7684\u540c\u4e00\u5171\u4eab VPC \u7db2\u7d61\u3002\n- \u7b2c\u4e00\u500b VPC \u539f\u751f GKE \u96c6\u7fa3``\uff08\u5553\u7528\u4e86\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff09\u662f\u5728``\u4e2d\u5275\u5efa\u3002\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u662f\u9023\u63a5\u5230``\u7684\u670d\u52d9\u9805\u76ee\u3002\n- \u7b2c\u4e8c\u500b VPC \u539f\u751f GKE \u96c6\u7fa3``\uff08\u5553\u7528\u4e86\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff09\u4e5f\u662f\u5728``\u4e2d\u5275\u5efa\u3002\n### \u5553\u7528\u5fc5\u9700\u7684 API\n\u5553\u7528\u6240\u9700\u7684 API\u3002 Google Cloud CLI \u7684\u8f38\u51fa\u6703\u986f\u793a API \u662f\u5426\u5df2\u5553\u7528\u3002\n- \u5553\u7528 Cloud DNS API\uff1a```\ngcloud services enable dns.googleapis.com \\\u00a0 \u00a0 --project SHARED_VPC_HOST_PROJ\n```\u5728\u6b64\u5834\u666f\u4e2d\uff0c\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u662f\u9023\u63a5\u5230\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u7684\u670d\u52d9\u9805\u76ee\u3002\u60a8\u5fc5\u9808\u5728\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528 Cloud DNS API\uff0c\u56e0\u7232\u9019\u662f\u5171\u4eab VPC \u7db2\u7d61\u6240\u5728\u7684\u4f4d\u7f6e\u3002GKE \u6703\u5728\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5275\u5efa Cloud DNS \u4ee3\u7ba1\u5f0f\u5c08\u7528\u5340\u57df\uff0c\u4e26\u91dd\u5c0d\u5171\u4eab VPC \u7db2\u7d61\u7232\u9019\u4e9b\u5340\u57df\u6388\u6b0a\u3002\n- \u5553\u7528 GKE Hub\uff08\u8266\u968a\uff09API\u3002\u53ea\u80fd\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528 GKE Hub API\u3002```\ngcloud services enable gkehub.googleapis.com \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n```\u5982\u679c\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u6b64 API\uff0c\u5247\u7cfb\u7d71\u6703\u5275\u5efa\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u6216\u8005\u78ba\u4fdd\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u5b58\u5728\uff1a `service-` `` `@gcp-sa-gkehub.iam.gserviceaccount.com` \u3002\n- \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528 Traffic Director\u3001Resource Manager \u548c Multi-cluster Service Discovery API\uff1a```\ngcloud services enable trafficdirector.googleapis.com \\\u00a0 \u00a0 cloudresourcemanager.googleapis.com \\\u00a0 \u00a0 multiclusterservicediscovery.googleapis.com \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n```\n### \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\n- \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\uff1a```\ngcloud container fleet multi-cluster-services enable \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n```\u5982\u679c\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\uff0c\u5247\u7cfb\u7d71\u6703\u5275\u5efa\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u6216\u8005\u78ba\u4fdd\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u5b58\u5728\uff1a `service-` `` `@gcp-sa-mcsd.iam.gserviceaccount.com` \u3002\n### \u5275\u5efa IAM \u7d81\u5b9a\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u8266\u968a\u5bbf\u4e3b\u9805\u76ee MCS \u670d\u52d9\u8cec\u865f\u6388\u4e88\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u7684 MCS Service Agent \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding SHARED_VPC_HOST_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:service-FLEET_HOST_PROJ_NUMBER@gcp-sa-mcsd.iam.gserviceaccount.com\" \\\u00a0 \u00a0 --role roles/multiclusterservicediscovery.serviceAgent\n```\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u8266\u968a\u5bbf\u4e3b\u9805\u76ee MCS \u670d\u52d9\u8cec\u865f\u6388\u4e88\u81ea\u5df1\u9805\u76ee\u7684 Network User \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding FLEET_HOST_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:FLEET_HOST_PROJ.svc.id.goog[gke-mcs/gke-mcs-importer]\" \\\u00a0 \u00a0 --role roles/compute.networkViewer\n```\u7531\u65bc\u6b64\u5834\u666f\u4f7f\u7528\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff0c\u56e0\u6b64\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 MCS \u5c0e\u5165\u7a0b\u5e8f GKE \u670d\u52d9\u8cec\u865f\u9700\u8981\u81ea\u5df1\u9805\u76ee\u7684 Network User \u89d2\u8272\u3002\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u7684 ID\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684\u7de8\u865f\uff0c\u5373\u6b64\u5834\u666f\u4e2d\u7684\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee\n- ``\uff1a\u7b2c\u4e00\u500b\u96c6\u7fa3\u9805\u76ee\u7684 ID\u3002\n### \u5c07\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\n- \u5c07\u7b2c\u4e00\u500b\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\u3002 `--gke-cluster` \u6a19\u8a8c\u53ef\u7528\u65bc\u6b64\u547d\u4ee4\uff0c\u56e0\u7232\u7b2c\u4e00\u500b\u96c6\u7fa3\u8207\u8a3b\u518a\u5b83\u7684\u8266\u968a\u4f4d\u65bc\u540c\u4e00\u9805\u76ee\u4e2d\u3002```\ngcloud container fleet memberships register MEMBERSHIP_NAME_1 \\\u00a0 \u00a0 --project FLEET_HOST_PROJ \\\u00a0 \u00a0 --enable-workload-identity \\\u00a0 \u00a0 --gke-cluster=LOCATION/FIRST_CLUSTER_NAME\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u6b64\u96c6\u7fa3\u5728\u6b64\u8266\u968a\u4e2d\u7684\u552f\u4e00\u6a19\u8b58\u7b26\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e00\u500b GKE \u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 ID\uff0c\u8207\u6b64\u5834\u666f\u4e2d\u7684\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u76f8\u540c\u3002\n- ``\uff1a\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff0c\u9019\u662f\u5305\u542b\u96c6\u7fa3\u7684 Compute Engine \u53ef\u7528\u5340\uff1b\u5c0d\u65bc\u5340\u57df\u7d1a\u96c6\u7fa3\uff0c\u9019\u662f\u5305\u542b\u96c6\u7fa3\u7684 Compute Engine \u5340\u57df\u3002\n- ``\uff1a\u7b2c\u4e00\u500b\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \u5c07\u7b2c\u4e8c\u500b\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u3002 `--gke-cluster` \u6a19\u8a8c\u53ef\u7528\u65bc\u6b64\u547d\u4ee4\uff0c\u56e0\u7232\u7b2c\u4e8c\u500b\u96c6\u7fa3\u4e5f\u4f4d\u65bc\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u3002```\ngcloud container fleet memberships register MEMBERSHIP_NAME_2 \\\u00a0 \u00a0 --project FLEET_HOST_PROJ \\\u00a0 \u00a0 --enable-workload-identity \\\u00a0 \u00a0 --gke-cluster=LOCATION/SECOND_CLUSTER_NAME\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u6b64\u96c6\u7fa3\u5728\u6b64\u8266\u968a\u4e2d\u7684\u552f\u4e00\u6a19\u8b58\u7b26\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e8c\u500b GKE \u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 ID\uff0c\u8207\u6b64\u5834\u666f\u4e2d\u7684\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u76f8\u540c\u3002\n- ``\uff1a\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff0c\u9019\u662f\u5305\u542b\u96c6\u7fa3\u7684 Compute Engine \u53ef\u7528\u5340\uff1b\u5c0d\u65bc\u5340\u57df\u7d1a\u96c6\u7fa3\uff0c\u9019\u662f\u5305\u542b\u96c6\u7fa3\u7684 Compute Engine \u5340\u57df\u3002\n- ``\uff1a\u7b2c\u4e8c\u500b\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n### \u7232\u96c6\u7fa3\u5275\u5efa\u901a\u7528\u547d\u540d\u7a7a\u9593\n- \u78ba\u4fdd\u6bcf\u500b\u96c6\u7fa3\u90fd\u6709\u4e00\u500b\u5728\u5176\u4e2d\u5171\u4eab Service \u7684\u547d\u540d\u7a7a\u9593\u3002\u5982\u679c\u9700\u8981\uff0c\u8acb\u5728\u6bcf\u500b\u96c6\u7fa3\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4f86\u5275\u5efa\u547d\u540d\u7a7a\u9593\uff1a```\nkubectl create ns NAMESPACE\n```\u5c07 `` \u66ff\u63db\u7232\u547d\u540d\u7a7a\u9593\u7684\u540d\u7a31\u3002## \u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4f5c\u7232\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\n\u672c\u90e8\u5206\u63d0\u4f9b\u4e86\u4e00\u500b\u793a\u4f8b MCS \u914d\u7f6e\uff0c\u5176\u4e2d\u6d89\u53ca\u5169\u500b\u73fe\u6709\u7684 GKE \u96c6\u7fa3\uff1a\n- \u7b2c\u4e00\u500b VPC \u539f\u751f GKE \u96c6\u7fa3``\uff08\u5553\u7528\u4e86\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff09\u5df2\u5728``\u4e2d\u5275\u5efa\u3002\u5728\u6b64\u5834\u666f\u4e2d\uff0c\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e5f\u662f\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u3002\n- \u7b2c\u4e8c\u500b VPC \u539f\u751f GKE \u96c6\u7fa3``\uff08\u5553\u7528\u4e86\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff09\u5df2\u5728``\u4e2d\u5275\u5efa\u3002\n### \u5553\u7528\u5fc5\u9700\u7684 API\n\u5553\u7528\u6240\u9700\u7684 API\u3002 Google Cloud CLI \u7684\u8f38\u51fa\u6703\u986f\u793a API \u662f\u5426\u5df2\u5553\u7528\u3002\n- \u5553\u7528 Cloud DNS API\uff1a```\ngcloud services enable dns.googleapis.com \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n```\u5728\u6b64\u5834\u666f\u4e0b\uff0c\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e5f\u662f\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u3002\u60a8\u5fc5\u9808\u5728\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528 Cloud DNS API\uff0c\u56e0\u7232\u9019\u662f\u5171\u4eab VPC \u7db2\u7d61\u6240\u5728\u7684\u4f4d\u7f6e\u3002GKE \u6703\u5728\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5275\u5efa Cloud DNS \u4ee3\u7ba1\u5f0f\u5c08\u7528\u5340\u57df\uff0c\u4e26\u91dd\u5c0d\u5171\u4eab VPC \u7db2\u7d61\u7232\u9019\u4e9b\u5340\u57df\u6388\u6b0a\u3002\n- \u5553\u7528 GKE Hub\uff08\u8266\u968a\uff09API\u3002\u53ea\u80fd\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528 GKE Hub API\u3002```\ngcloud services enable gkehub.googleapis.com \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n```\u5982\u679c\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528 GKE Hub API\uff0c\u5247\u7cfb\u7d71\u6703\u5275\u5efa\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u6216\u8005\u78ba\u4fdd\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u5b58\u5728\uff1a `service-` `` `@gcp-sa-gkehub.iam.gserviceaccount.com` \u3002\n- \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u548c\u7b2c\u4e8c\u500b\u96c6\u7fa3\u7684\u9805\u76ee\u4e2d\u5553\u7528 Traffic Director\u3001Resource Manager \u548c Multi-cluster Service Discovery API\uff1a```\ngcloud services enable trafficdirector.googleapis.com \\\u00a0 \u00a0 cloudresourcemanager.googleapis.com \\\u00a0 \u00a0 multiclusterservicediscovery.googleapis.com \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n``````\ngcloud services enable trafficdirector.googleapis.com \\\u00a0 \u00a0 cloudresourcemanager.googleapis.com \\\u00a0 \u00a0 multiclusterservicediscovery.googleapis.com \\\u00a0 \u00a0 --project SECOND_CLUSTER_PROJ\n```\n### \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\n- \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\uff1a```\ngcloud container fleet multi-cluster-services enable \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n```\u5982\u679c\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\uff0c\u5247\u7cfb\u7d71\u6703\u5275\u5efa\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u6216\u8005\u78ba\u4fdd\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u5b58\u5728\uff1a `service-` `` `@gcp-sa-mcsd.iam.gserviceaccount.com` \u3002\n### \u5275\u5efa IAM \u7d81\u5b9a\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 GKE \u8266\u968a\u670d\u52d9\u8cec\u865f\u6388\u4e88\u7b2c\u4e8c\u500b\u96c6\u7fa3\u9805\u76ee\u7684 GKE Service Agent \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding SECOND_CLUSTER_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:service-FLEET_HOST_PROJ_NUMBER@gcp-sa-gkehub.iam.gserviceaccount.com\" \\\u00a0 \u00a0 --role roles/gkehub.serviceAgent\n```\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 MCS \u670d\u52d9\u8cec\u865f\u6388\u4e88\u7b2c\u4e8c\u500b\u96c6\u7fa3\u9805\u76ee\u7684 MCS Service Agent \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding SECOND_CLUSTER_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:service-FLEET_HOST_PROJ_NUMBER@gcp-sa-mcsd.iam.gserviceaccount.com\" \\\u00a0 \u00a0 --role roles/multiclusterservicediscovery.serviceAgent\n```\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u6bcf\u500b\u9805\u76ee\u7684 MCS \u670d\u52d9\u8cec\u865f\u6388\u4e88\u81ea\u5df1\u9805\u76ee\u7684 Network User \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding FLEET_HOST_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:FLEET_HOST_PROJ.svc.id.goog[gke-mcs/gke-mcs-importer]\" \\\u00a0 \u00a0 --role roles/compute.networkViewer\n``````\ngcloud projects add-iam-policy-binding SECOND_CLUSTER_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:SECOND_CLUSTER_PROJ.svc.id.goog[gke-mcs/gke-mcs-importer]\" \\\u00a0 \u00a0 --role roles/compute.networkViewer\n```\u7531\u65bc\u6b64\u5834\u666f\u4f7f\u7528\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff0c\u56e0\u6b64\u6bcf\u500b\u9805\u76ee\u7684 MCS \u5c0e\u5165\u7a0b\u5e8f GKE \u670d\u52d9\u8cec\u865f\u90fd\u9700\u8981\u81ea\u5df1\u9805\u76ee\u7684 Network User \u89d2\u8272\u3002\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u7b2c\u4e8c\u500b\u96c6\u7fa3\u7684\u9805\u76ee\u7684 ID\n- ``\uff1a\u7b2c\u4e00\u500b\u96c6\u7fa3\u9805\u76ee\u7684 ID\u3002\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684\u7de8\u865f\uff0c\u8207\u6b64\u5834\u666f\u4e2d\u7684\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u76f8\u540c\n### \u5c07\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\n- \u5c07\u7b2c\u4e00\u500b\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\u3002 `--gke-cluster` \u6a19\u8a8c\u53ef\u7528\u65bc\u6b64\u547d\u4ee4\uff0c\u56e0\u7232\u7b2c\u4e00\u500b\u96c6\u7fa3\u8207\u8a3b\u518a\u5b83\u7684\u8266\u968a\u4f4d\u65bc\u540c\u4e00\u9805\u76ee\u4e2d\u3002```\ngcloud container fleet memberships register MEMBERSHIP_NAME_1 \\\u00a0 \u00a0 --project FLEET_HOST_PROJ \\\u00a0 \u00a0 --enable-workload-identity \\\u00a0 \u00a0 --gke-cluster=LOCATION/FIRST_CLUSTER_NAME\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u6b64\u96c6\u7fa3\u5728\u6b64\u8266\u968a\u4e2d\u7684\u552f\u4e00\u6a19\u8b58\u7b26\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e00\u500b GKE \u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 ID\uff0c\u8207\u6b64\u5834\u666f\u4e2d\u7684\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u76f8\u540c\u3002\n- ``\uff1a\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff0c\u9019\u662f\u5305\u542b\u96c6\u7fa3\u7684 Compute Engine \u53ef\u7528\u5340\uff1b\u5c0d\u65bc\u5340\u57df\u7d1a\u96c6\u7fa3\uff0c\u9019\u662f\u5305\u542b\u96c6\u7fa3\u7684 Compute Engine \u5340\u57df\u3002\n- ``\uff1a\u7b2c\u4e00\u500b\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \u5c07\u7b2c\u4e8c\u500b\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\u3002\u8a72\u547d\u4ee4\u5fc5\u9808\u4f7f\u7528 `--gke-uri` \u6a19\u8a8c\uff0c\u56e0\u7232\u7b2c\u4e8c\u500b\u96c6\u7fa3\u8207\u8266\u968a\u4f4d\u65bc\u4e0d\u540c\u9805\u76ee\u4e2d\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u904b\u884c `gcloud container clusters list --uri` \u4f86\u7372\u53d6\u5b8c\u6574\u7684\u96c6\u7fa3 URI\u3002```\ngcloud container fleet memberships register MEMBERSHIP_NAME_2 \\\u00a0 \u00a0 --project FLEET_HOST_PROJ \\\u00a0 \u00a0 --enable-workload-identity \\\u00a0 \u00a0 --gke-uri https://container.googleapis.com/v1/projects/SECOND_CLUSTER_PROJ/locations/LOCATION/clusters/SECOND_CLUSTER_NAME\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u6b64\u96c6\u7fa3\u5728\u6b64\u8266\u968a\u4e2d\u7684\u552f\u4e00\u6a19\u8b58\u7b26\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e8c\u500b GKE \u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 ID\uff0c\u8207\u6b64\u5834\u666f\u4e2d\u7684\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u76f8\u540c\u3002\n- ``\uff1a\u5c07`LOCATION`\u66ff\u63db\u7232\u4ee5\u4e0b\u5167\u5bb9\uff1a- \u96c6\u7fa3\u7684 Compute Engine \u53ef\u7528\u5340\uff08\u5982\u679c\u96c6\u7fa3\u662f\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff09\n- \u96c6\u7fa3\u7684 Compute Engine \u5340\u57df\uff08\u5982\u679c\u96c6\u7fa3\u662f\u5340\u57df\u7d1a\u96c6\u7fa3\uff09\n- ``\uff1a\u7b2c\u4e8c\u500b\u96c6\u7fa3\u6240\u5c6c\u7684\u9805\u76ee\u3002\n- ``\uff1a\u7b2c\u4e8c\u500b\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n### \u7232\u96c6\u7fa3\u5275\u5efa\u901a\u7528\u547d\u540d\u7a7a\u9593\n- \u78ba\u4fdd\u6bcf\u500b\u96c6\u7fa3\u90fd\u6709\u4e00\u500b\u5728\u5176\u4e2d\u5171\u4eab Service \u7684\u547d\u540d\u7a7a\u9593\u3002\u5982\u679c\u9700\u8981\uff0c\u8acb\u5728\u6bcf\u500b\u96c6\u7fa3\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4f86\u5275\u5efa\u547d\u540d\u7a7a\u9593\uff1a```\nkubectl create ns NAMESPACE\n```\u5c07 `` \u66ff\u63db\u7232\u547d\u540d\u7a7a\u9593\u7684\u540d\u7a31\u3002## \u4e0d\u540c\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee\u4e2d\u7684\u96c6\u7fa3\n\u672c\u90e8\u5206\u63d0\u4f9b\u4e86\u4e00\u500b\u793a\u4f8b MCS \u914d\u7f6e\uff0c\u5176\u4e2d\u6d89\u53ca\u5169\u500b\u73fe\u6709\u7684 GKE \u96c6\u7fa3\uff0c\u6bcf\u500b\u96c6\u7fa3\u4f4d\u65bc\u4e0d\u540c\u7684\u5171\u4eab VPC \u670d\u52d9\u9805\u76ee\u4e2d\u3002\n- \u9019\u5169\u500b\u96c6\u7fa3\u4f7f\u7528``\u4e2d\u7684\u540c\u4e00\u5171\u4eab VPC \u7db2\u7d61\u3002\n- \u7b2c\u4e00\u500b VPC \u539f\u751f GKE \u96c6\u7fa3``\uff08\u5553\u7528\u4e86\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff09\u5df2\u5728``\u4e2d\u5275\u5efa\u3002\u5728\u6b64\u5834\u666f\u4e2d\uff0c\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u662f\u9023\u63a5\u5230``\u7684\u670d\u52d9\u9805\u76ee\u3002\n- \u7b2c\u4e8c\u500b VPC \u539f\u751f GKE \u96c6\u7fa3``\uff08\u5553\u7528\u4e86\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff09\u5df2\u5728``\u4e2d\u5275\u5efa\u3002 \u5728\u6b64\u5834\u666f\u4e2d\uff0c``\u4e5f\u662f\u9023\u63a5\u5230``\u7684\u670d\u52d9\u9805\u76ee\u3002\n### \u5553\u7528\u5fc5\u9700\u7684 API\n\u5553\u7528\u6240\u9700\u7684 API\u3002 Google Cloud CLI \u7684\u8f38\u51fa\u6703\u986f\u793a API \u662f\u5426\u5df2\u5553\u7528\u3002\n- \u5553\u7528 Cloud DNS API\uff1a```\ngcloud services enable dns.googleapis.com \\\u00a0 \u00a0 --project SHARED_VPC_HOST_PROJ\n```\u5728\u6b64\u5834\u666f\u4e2d\uff0c\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u662f\u9023\u63a5\u5230\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u7684\u670d\u52d9\u9805\u76ee\u3002\u60a8\u5fc5\u9808\u5728\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528 Cloud DNS API\uff0c\u56e0\u7232\u9019\u662f\u5171\u4eab VPC \u7db2\u7d61\u6240\u5728\u7684\u4f4d\u7f6e\u3002GKE \u6703\u5728\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5275\u5efa Cloud DNS \u4ee3\u7ba1\u5f0f\u5c08\u7528\u5340\u57df\uff0c\u4e26\u91dd\u5c0d\u5171\u4eab VPC \u7db2\u7d61\u7232\u9019\u4e9b\u5340\u57df\u6388\u6b0a\u3002\n- GKE Hub\uff08\u8266\u968a\uff09API\u3002\u53ea\u80fd\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee `` \u4e2d\u5553\u7528 GKE Hub API\u3002```\ngcloud services enable gkehub.googleapis.com \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n```\u5982\u679c\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u6b64 API\uff0c\u5247\u7cfb\u7d71\u6703\u5275\u5efa\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u6216\u8005\u78ba\u4fdd\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u5b58\u5728\uff1a `service-` `` `@gcp-sa-gkehub.iam.gserviceaccount.com` \u3002\n- \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u548c\u7b2c\u4e8c\u500b\u96c6\u7fa3\u7684\u9805\u76ee\u4e2d\u5553\u7528 Traffic Director\u3001Resource Manager \u548c Multi-cluster Service Discovery API\uff1a```\ngcloud services enable trafficdirector.googleapis.com \\\u00a0 \u00a0 cloudresourcemanager.googleapis.com \\\u00a0 \u00a0 multiclusterservicediscovery.googleapis.com \\\u00a0 \u00a0 --project=FLEET_HOST_PROJ\n``````\ngcloud services enable trafficdirector.googleapis.com \\\u00a0 \u00a0 cloudresourcemanager.googleapis.com \\\u00a0 \u00a0 multiclusterservicediscovery.googleapis.com \\\u00a0 \u00a0 --project SECOND_CLUSTER_PROJ\n```\n### \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\n- \u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\uff1a```\ngcloud container fleet multi-cluster-services enable \\\u00a0 \u00a0 --project FLEET_HOST_PROJ\n```\u5982\u679c\u5728\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5553\u7528\u591a\u96c6\u7fa3\u670d\u52d9\uff0c\u5247\u7cfb\u7d71\u6703\u5275\u5efa\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u6216\u8005\u78ba\u4fdd\u4ee5\u4e0b\u670d\u52d9\u8cec\u865f\u5b58\u5728\uff1a `service-` `` `@gcp-sa-mcsd.iam.gserviceaccount.com` \u3002\n### \u5275\u5efa IAM \u7d81\u5b9a\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 GKE Hub \u670d\u52d9\u8cec\u865f\u6388\u4e88\u7b2c\u4e8c\u500b\u96c6\u7fa3\u9805\u76ee\u7684 GKE Service Agent \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding SECOND_CLUSTER_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:service-FLEET_HOST_PROJ_NUMBER@gcp-sa-gkehub.iam.gserviceaccount.com\" \\\u00a0 \u00a0 --role roles/gkehub.serviceAgent\n```\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 MCS \u670d\u52d9\u8cec\u865f\u6388\u4e88\u7b2c\u4e8c\u500b\u96c6\u7fa3\u9805\u76ee\u7684 MCS Service Agent \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding SECOND_CLUSTER_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:service-FLEET_HOST_PROJ_NUMBER@gcp-sa-mcsd.iam.gserviceaccount.com\" \\\u00a0 \u00a0 --role roles/multiclusterservicediscovery.serviceAgent\n```\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u8266\u968a\u5bbf\u4e3b\u9805\u76ee MCS \u670d\u52d9\u8cec\u865f\u6388\u4e88\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u7684 MCS Service Agent \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding SHARED_VPC_HOST_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:service-FLEET_HOST_PROJ_NUMBER@gcp-sa-mcsd.iam.gserviceaccount.com\" \\\u00a0 \u00a0 --role roles/multiclusterservicediscovery.serviceAgent\n```\n- \u5275\u5efa IAM \u7d81\u5b9a\uff0c\u5411\u6bcf\u500b\u9805\u76ee\u7684 MCS \u670d\u52d9\u8cec\u865f\u6388\u4e88\u81ea\u5df1\u9805\u76ee\u7684 Network User \u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding FLEET_HOST_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:FLEET_HOST_PROJ.svc.id.goog[gke-mcs/gke-mcs-importer]\" \\\u00a0 \u00a0 --role roles/compute.networkViewer\n``````\ngcloud projects add-iam-policy-binding SECOND_CLUSTER_PROJ \\\u00a0 \u00a0 --member \"serviceAccount:SECOND_CLUSTER_PROJ.svc.id.goog[gke-mcs/gke-mcs-importer]\" \\\u00a0 \u00a0 --role roles/compute.networkViewer\n```\u7531\u65bc\u6b64\u5834\u666f\u4f7f\u7528\u9069\u7528\u65bc GKE \u7684\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408\uff0c\u56e0\u6b64\u6bcf\u500b\u9805\u76ee\u7684 MCS \u5c0e\u5165\u7a0b\u5e8f GKE \u670d\u52d9\u8cec\u865f\u90fd\u9700\u8981\u81ea\u5df1\u9805\u76ee\u7684 Network User \u89d2\u8272\u3002\u6839\u64da\u9700\u8981\uff0c\u66ff\u63db\u4e0a\u8ff0\u547d\u4ee4\u4e2d\u7684\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u7b2c\u4e8c\u500b\u96c6\u7fa3\u9805\u76ee\u7684 ID\u3002\n- ``\uff1a\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u7684\u9805\u76ee ID\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u5169\u500b\u96c6\u7fa3\u4f7f\u7528\u540c\u4e00\u5171\u4eab VPC \u7db2\u7d61\uff0c\u4f46\u5169\u500b\u96c6\u7fa3\u5747\u4e0d\u5728\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u3002\n- ``\uff1a\u7b2c\u4e00\u500b\u96c6\u7fa3\u9805\u76ee\u7684 ID\u3002\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684\u7de8\u865f\u3002\n### \u5c07\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\n- \u5c07\u7b2c\u4e00\u500b\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\u3002 `--gke-cluster` \u6a19\u8a8c\u53ef\u7528\u65bc\u6b64\u547d\u4ee4\uff0c\u56e0\u7232\u7b2c\u4e00\u500b\u96c6\u7fa3\u8207\u8a3b\u518a\u5b83\u7684\u8266\u968a\u4f4d\u65bc\u540c\u4e00\u9805\u76ee\u4e2d\u3002```\ngcloud container fleet memberships register MEMBERSHIP_NAME_1 \\\u00a0 \u00a0 --project FLEET_HOST_PROJ \\\u00a0 \u00a0 --enable-workload-identity \\\u00a0 \u00a0 --gke-cluster=LOCATION/FIRST_CLUSTER_NAME\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u6b64\u96c6\u7fa3\u5728\u6b64\u8266\u968a\u4e2d\u7684\u552f\u4e00\u6a19\u8b58\u7b26\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e00\u500b GKE \u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 ID\uff0c\u8207\u6b64\u5834\u666f\u4e2d\u7684\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u76f8\u540c\u3002\n- ``\uff1a\u5c0d\u65bc\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff0c\u9019\u662f\u5305\u542b\u96c6\u7fa3\u7684 Compute Engine \u53ef\u7528\u5340\uff1b\u5c0d\u65bc\u5340\u57df\u7d1a\u96c6\u7fa3\uff0c\u9019\u662f\u5305\u542b\u96c6\u7fa3\u7684 Compute Engine \u5340\u57df\u3002\n- ``\uff1a\u7b2c\u4e00\u500b\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \u5c07\u7b2c\u4e8c\u500b\u96c6\u7fa3\u8a3b\u518a\u5230\u8266\u968a\u3002\u8a72\u547d\u4ee4\u5fc5\u9808\u4f7f\u7528 `--gke-uri` \u6a19\u8a8c\uff0c\u56e0\u7232\u7b2c\u4e8c\u500b\u96c6\u7fa3\u8207\u8266\u968a\u4f4d\u65bc\u4e0d\u540c\u9805\u76ee\u4e2d\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u904b\u884c `gcloud container clusters list --uri` \u4f86\u7372\u53d6\u5b8c\u6574\u7684\u96c6\u7fa3 URI\u3002```\ngcloud container fleet memberships register MEMBERSHIP_NAME_2 \\\u00a0 \u00a0 --project FLEET_HOST_PROJ \\\u00a0 \u00a0 --enable-workload-identity \\\u00a0 \u00a0 --gke-uri https://container.googleapis.com/v1/projects/SECOND_CLUSTER_PROJ/locations/LOCATION/clusters/SECOND_CLUSTER_NAME\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u6b64\u96c6\u7fa3\u5728\u6b64\u8266\u968a\u4e2d\u7684\u552f\u4e00\u6a19\u8b58\u7b26\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e8c\u500b GKE \u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8266\u968a\u5bbf\u4e3b\u9805\u76ee\u7684 ID\uff0c\u8207\u6b64\u5834\u666f\u4e2d\u7684\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u76f8\u540c\u3002\n- ``\uff1a\u5c07`LOCATION`\u66ff\u63db\u7232\u4ee5\u4e0b\u5167\u5bb9\uff1a- \u96c6\u7fa3\u7684 Compute Engine \u53ef\u7528\u5340\uff08\u5982\u679c\u96c6\u7fa3\u662f\u53ef\u7528\u5340\u7d1a\u96c6\u7fa3\uff09\n- \u96c6\u7fa3\u7684 Compute Engine \u5340\u57df\uff08\u5982\u679c\u96c6\u7fa3\u662f\u5340\u57df\u7d1a\u96c6\u7fa3\uff09\n- ``\uff1a\u7b2c\u4e8c\u500b\u96c6\u7fa3\u6240\u5c6c\u7684\u9805\u76ee\u3002\n- ``\uff1a\u7b2c\u4e8c\u500b\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n### \u7232\u96c6\u7fa3\u5275\u5efa\u901a\u7528\u547d\u540d\u7a7a\u9593\n- \u78ba\u4fdd\u6bcf\u500b\u96c6\u7fa3\u90fd\u6709\u4e00\u500b\u5728\u5176\u4e2d\u5171\u4eab Service \u7684\u547d\u540d\u7a7a\u9593\u3002\u5982\u679c\u9700\u8981\uff0c\u8acb\u5728\u6bcf\u500b\u96c6\u7fa3\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4f86\u5275\u5efa\u547d\u540d\u7a7a\u9593\uff1a```\nkubectl create ns NAMESPACE\n```\u5c07 `` \u66ff\u63db\u7232\u547d\u540d\u7a7a\u9593\u7684\u540d\u7a31\u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3\u5982\u4f55 [\u4f7f\u7528 MCS](https://cloud.google.com/kubernetes-engine/docs/how-to/multi-cluster-services?hl=zh-cn) \u3002", "guide": "Google Kubernetes Engine (GKE)"}