{"title": "Google Kubernetes Engine (GKE) - Manage GKE resources using Tags", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/tags", "abstract": "# Google Kubernetes Engine (GKE) - Manage GKE resources using Tags\nThis page shows you how to use Tags to manage your Google Kubernetes Engine (GKE) clusters and conditionally apply Identity and Access Management policies to nodes.\n", "content": "## Overview\nTags are key-value pairs that let you annotate and manage your Google Cloud resources at the organization or project level. You can use Tags to organize your resources and to conditionally apply policies like firewalls or IAM policies. Tags support IAM access control, which lets you define who can attach, create, update, or delete Tags.\n### Use cases for Tags in GKE\nYou might use Tags in GKE for situations like the following:\n- Conditionally apply network firewall policies to specific nodes. For example, deny ingress traffic from the public internet to all nodes of a cluster in staging or testing environments. For instructions, see [Selectively enforce network firewall policies in GKE](/kubernetes-engine/docs/how-to/tags-firewall-policies) .\n- Conditionally grant IAM roles based on Tags. For example, automatically grant contractors access to specific environments that would normally only be available to full-time employees. For instructions, see the rest of this document.\n- Audit and analyze billing information based on applied Tags at the project or organization level.\n### How it works\nFor network firewall policy enforcement specifically, you create a tag and explicitly designate the tag for firewall use. For all other purposes, you create a tag without setting a firewall designation.\nAfter creating the tag, you attach the tag to your GKE resources as a key-value pair. For network firewall policies, you use the GKE API, while for all other purposes you use the Tags API.\nFor each key, you can attach one value to a resource. For example, if you attached `env:dev` to a GKE cluster, you can't also attach `env:prod` or `env:test` . You can attach up to 50 non-firewall Tags and up to five firewall Tags to each resource.\n### Resource annotation methods in GKE\nIn GKE, there are several methods to annotate your resources, as outlined in the following table:\n| Annotation type  | Description                                                                                                             | Example                       |\n|:--------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------|\n| Tags (non-firewall) | Apply to cluster resource by using the Tags API Organize resources to track usage and billing Conditionally apply IAM policies Control access to specific Tags with IAM Caution: You can optionally attach tags directly to the Compute Engine VMs that back your GKE nodes. We don't recommend this method, because GKE overwrites these VM tags if you use the GKE API to attach firewall tags to the same nodes. To learn more, see Tags overview. | Conditionally grant IAM roles to control access to resources that have specific Tags   |\n| Tags (firewall)  | Apply to cluster or node pool using GKE API Conditionally apply Cloud Next Generation Firewall network firewall policies. Control access to specific Tags with IAM GKE attaches the key-value pairs to the underlying Compute Engine VMs. To learn more, see Selectively apply network firewall policies in GKE.                                   | Automatically deny ingress traffic from public internet to all staging or testing environments |\n| Network tags  | Apply to cluster or node pool using GKE API Simple strings with no IAM access control Use to conditionally apply VPC firewall rules GKE attaches the key-value pairs to the underlying Compute Engine VMs To learn more, see Use network tags to apply firewall rules to nodes.                                           | Automatically deny ingress traffic from public internet to all staging or testing environments |\n| GKE cluster labels | Apply to cluster or node pool using GKE API Organize resources to track usage and billing To learn more, see Cluster labels.                                                                                | Differentiate between clusters owned by specific cost centers or teams in your organization. |\n| Kubernetes labels | Apply to Kubernetes API objects Associate cluster components and resources with one another and manage resource lifecycles. To learn more, see Kubernetes labels and selectors.                                                                   | Require that workloads are scheduled on nodes with specific labels.        |\n## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.\n- Ensure that you have the following IAM roles:- `roles/resourcemanager.tagAdmin`\n- `roles/resourcemanager.tagUser`\nFor information on the permissions granted by these roles, see [Required permissions](/resource-manager/docs/tags/tags-creating-and-managing?cloudshell=false#required-permissions-attach) .\n- [Ensure that you have a GKE cluster](/kubernetes-engine/docs/how-to/creating-a-zonal-cluster) running.## Create tag keys and values\nBefore you can attach a tag to your GKE resources, you need to create the tag and configure its values. To create tag keys and values, see [Creating a tag](/resource-manager/docs/tags/tags-creating-and-managing#creating_tag) and [Adding tag values](/resource-manager/docs/tags/tags-creating-and-managing#adding_tag_values) .\n## Attach Tags to a cluster\nYou can attach Tags to an existing cluster if you have the correct permissions by using the Google Cloud CLI, the Google Cloud console, or the Tags API.\nTo create a tag binding to attach a tag to a cluster, run the following command:\n```\ngcloud alpha resource-manager tags bindings create \\\u00a0 \u00a0 --tag-value=TAG_VALUE_ID \\\u00a0 \u00a0 --parent=RESOURCE_ID \\\u00a0 \u00a0 --location=CLUSTER_LOCATION\n```\nReplace the following:- ``: The permanent ID or namespaced name of the tag value to attach. For example,`tagValues/4567890123`. For details about tag identifiers, see [Tag definitions and identifiers](/iam/docs/tags-access-control#definitions) .\n- ``: For regional clusters, specify the [compute region](/compute/docs/regions-zones#available) , such as`us-central1`. For zonal clusters, specify the compute zone, such as`us-central1-a`.\n- `` : The [full resource name](/apis/design/resource_names#full_resource_name) of your cluster, such as `//container.googleapis.com/projects/` `` `/locations/` `` `/clusters/` `` .In the resource ID:- ``: Your Google Cloud project ID.\n- ``: The name of your cluster.- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- In the **Metadata** section, next to **Tags** , click edit **Edit tags** .\n- If your organization doesn't appear in the **Tags** panel, click **Select scope** . Select your organization and click **Open** .\n- In the **Tags** panel, select **Add tag** .\n- Select the key for the tag you want to attach from the list. You can filter the list by typing keywords.\n- Select the value for the tag you want to attach from the list. You can filter the list by typing keywords.\n- Click **Save** .\n- In the **Confirm** dialog, click **Confirm** to attach the tag.A notification confirms that your tags updated.\nTo attach a tag to a resource, you must first create a JSON representation of a tag binding that includes the permanent IDs of the tag value and the resource. For more information about the format of a tag binding, see the [TagBinding reference](/resource-manager/reference/rest/v3/tagBindings) .\nUse the `tagBindings.create` method with the regional or zonal endpoint where your cluster is located.\n```\nPOST https://LOCATION-cloudresourcemanager.googleapis.com/v3/tagBindings\n```\nReplace `` with the region or zone where your cluster is located, such as `us-central1` .\nJSON request body:\n```\n{\u00a0 \"parent\": \"RESOURCE_ID\",\u00a0 \"tagValue\": \"TAG_VALUE_ID\"}\n```\nReplace the following:- `` : The [full resource name](/apis/design/resource_names#full_resource_name) of your cluster, such as `//container.googleapis.com/projects/` `` `/locations/` `` `/clusters/` `` .In the resource ID:- ``: Your Google Cloud project ID.\n- ``: The name of your cluster.\n- `` : The permanent ID or namespaced name of the tag value to attach. For example, `tagValues/4567890123` . For details about tag identifiers, see [Tag definitions and identifiers](/iam/docs/tags-access-control#definitions) .\nThe output is similar to the following:\n```\n{\n \"done\": true,\n \"response\": {\n \"@type\": \"type.googleapis.com/google.cloud.resourcemanager.v3.TagBinding\",\n \"name\": \"tagBindings///container.googleapis.com/projects/PROJECT_ID/locations/LOCATION/clusters/CLUSTER_NAME/tagValues/TAG_VALUE_ID\",\n \"parent\": \"//container.googleapis.com/projects/PROJECT_ID/locations/LOCATION/clusters/CLUSTER_NAME\",\n \"tagValue\": \"TAG_VALUE_ID\"\n }\n}\n```\n## List Tags attached to a cluster\nYou can list the Tags attached to a cluster by using the gcloud CLI, the Google Cloud console, or the Tags API.\nTo get a list of tag bindings attached to a cluster, run the following command:\n```\ngcloud alpha resource-manager tags bindings list \\\u00a0 \u00a0 --parent=RESOURCE_ID \\\u00a0 \u00a0 --location=CLUSTER_LOCATION\n```\nReplace the following:- `` : For regional clusters, specify the [compute region](/compute/docs/regions-zones#available) , such as `us-central1` . For zonal clusters, specify the compute zone, such as `us-central1-a` .\n- `` : The [full resource name](/apis/design/resource_names#full_resource_name) of your cluster, such as `//container.googleapis.com/projects/` `` `/locations/` `` `/clusters/` `` .In the resource ID:- `` : Your Google Cloud project ID.\n- `` : The name of your cluster.- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to view.\n- In the **Metadata** section, next to **Tags** , look for the currently attached tag values.\nTo get a list of tag bindings for a cluster, use the `tagBindings.list` method with the regional or zonal endpoint where your cluster is located.\n```\nGET https://LOCATION-cloudresourcemanager.googleapis.com/v3/tagBindings\n```\nJSON request body:\n```\n{\u00a0 \"parent\": RESOURCE_ID,}\n```\nReplace the following:- `` : The [full resource name](/apis/design/resource_names#full_resource_name) of your cluster, such as `//container.googleapis.com/projects/` `` `/locations/` `` `/clusters/` `` .In the resource ID:- ``: Your Google Cloud project ID.\n- ``: The name of your cluster.\nThe output is similar to the following:\n```\n\"tagBindings\": [ {\n \"name\": \"tagBindings/%2F%2Fcontainer.googleapis.com%2Fprojects%2Ftags-bugbash-project%2Flocations%2Fus-central1%2Fclusters%2Ftestcluster/tagValues/758072120217\",\n \"parent\": \"//container.googleapis.com/projects/PROJECT_ID/locations/LOCATION/clusters/CLUSTER_NAME\",\n \"tagValue\": \"TAG_VALUE_ID\"\n }\n]\n```\n## Detach tags from a cluster\nYou can detach a tag from a cluster by deleting the tag binding resource attached to the cluster by using the gcloud CLI, the Google Cloud console, or the Tags API. If you need to delete a tag, you must first detach from all attached resources.\nTo detach a tag binding attached to a cluster, run the following command:\n```\ngcloud alpha resource-manager tags bindings delete \\\u00a0 \u00a0 --tag-value=TAG_VALUE_ID \\\u00a0 \u00a0 --parent=RESOURCE_ID \\\u00a0 \u00a0 --location=CLUSTER_LOCATION\n```\nReplace the following:- `` : The permanent ID or namespaced name of the tag value to detach. For example, `tagValues/4567890123` . For details about tag identifiers, see [Tag definitions and identifiers](/iam/docs/tags-access-control#definitions) .\n- `` : For regional clusters, specify the [compute region](/compute/docs/regions-zones#available) , such as `us-central1` . For zonal clusters, specify the compute zone, such as `us-central1-a` .\n- `` : The [full resource name](/apis/design/resource_names#full_resource_name) of your cluster, such as `//container.googleapis.com/projects/` `` `/locations/` `` `/clusters/` `` .In the resource ID:- `` : Your Google Cloud project ID.\n- `` : The name of your cluster.- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [ Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- In the **Metadata** section, next to **Tags** , click edit **Edit tags** .\n- In the **Tags** panel, next to the tag you want to detach, click delete **Delete item** .\n- Click **Save** .\n- In the **Confirm** dialog, click **Confirm** to detach the tag.A notification confirms that your tags updated.\nTo delete tag bindings for a cluster, use the `tagBindings.delete` method with the regional or zonal endpoint where your cluster is located.\n```\nDELETE https://LOCATION-cloudresourcemanager.googleapis.com/v3/TAG_BINDING_NAME\n```\nReplace `` with the [full resourcename](/apis/design/resource_names#full_resource_name) of the `tagBinding` object you want to detach. For example, `tagBindings/container.googleapis.com/projects/` `` `/locations/` `` `/tagValues/` `` .\n## Delete tag keys and tag values\nBefore you delete tag keys and values, ensure that the tags are detached from all resources. Then, see [Deleting tags](/resource-manager/docs/tags/tags-creating-and-managing#deleting) to delete the keys and values.\n## Identity and Access Management conditions and Tags\nYou can use Tags and IAM conditions to conditionally grant role bindings to users in your project hierarchy. When you change or delete the tag attached to a cluster, GKE can remove user access to that cluster if an IAM policy with conditional role bindings has been applied.\nAuthorization to list and create GKE clusters is checked at the project level, not at the individual cluster level. If you use conditional IAM role bindings with cluster-level Tags to restrict access to specific clusters, those users might experience errors when attempting to list or create clusters in the project. To avoid these errors, attach a tag to the parent project and use a conditional role binding to grant the list or create access. For information about roles and permissions, see the [IAM roles reference](/iam/docs/understanding-roles#kubernetes-engine-roles) .\nFor more information about conditional access grants in IAM, see [Identity and Access Management conditions and Tags](/resource-manager/docs/tags/tags-creating-and-managing#iam_conditions_and_tags) .\n## What's next\n- [Learn how to set an organization policy withTags](/resource-manager/docs/organization-policy/tags-organization-policy) .\n- Learn more about how to [manage tags and attach tags toresources](/resource-manager/docs/tags/tags-creating-and-managing#adding_tag_values) .\n- [See the other services that support tags](/resource-manager/docs/tags/tags-supported-services) .\n- [Learn how to use tags with IAM](/iam/docs/tags-access-control) .", "guide": "Google Kubernetes Engine (GKE)"}