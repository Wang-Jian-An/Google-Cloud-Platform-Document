{"title": "Google Kubernetes Engine (GKE) - Isolate your GKE workloads using sole-tenant nodes", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/sole-tenancy", "abstract": "# Google Kubernetes Engine (GKE) - Isolate your GKE workloads using sole-tenant nodes\nThis page shows you how to isolate your workloads running on Google Kubernetes Engine (GKE) Standard clusters by using Compute Engine [sole-tenant nodes](/compute/docs/nodes) , which are dedicated physical servers that only run a specific project's VMs. You can use sole-tenant nodes to keep your VMs physically separated from VMs in other projects or to group your VMs together on the same host hardware.\nThis feature is not supported on GKE Autopilot. To learn more about Autopilot security boundaries, see [Security boundaries in Autopilot](/kubernetes-engine/docs/concepts/autopilot-security#security-boundaries) .\nTo use sole-tenant nodes in GKE, you create a sole-tenant node group in Compute Engine and use that node group to create a GKE node pool. You can create node pools using sole-tenant nodes from the GKE cluster's project or [shared sole-tenantnodes](/compute/docs/nodes/share-node-groups) using resources across projects within your organization. For example, you can designate an in your organization where you create sole-tenant node groups, and where you have clusters with node pools using those node groups from the owner project.\n", "content": "## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.\n### Request additional quota\nSole-tenant nodes are large (for example, 96 vCPUs and 624 GB memory), and the default project quotas are too low to handle them.\nYou must request a quota increase for Compute Engine API CPUs on the [quotas page](https://console.cloud.google.com/iam-admin/quotas) to create sole-tenant nodes. For more information about requesting an increase, see [Quotas](/compute/quotas#request_quotas) .\n**Note:** This request can take up to 48 hours to be fulfilled.\nThe number of CPUs you need depends on the following:\n- Your current CPU quota usage.\n- The size of the node group.\n- The node template.\nExamine the number of cores of your sole-tenant node type, and request a CPU limit of at least that amount, preferably with an additional 10 CPUs to ensure that your project has adequate capacity.\n## Create a sole-tenant node template\nA sole-tenant [node template](/compute/docs/nodes#node_templates) is a regional resource that defines and applies properties to every node when creating a node group. For more information, see [node types](/compute/docs/nodes#node_types) .\nIf you are using [shared sole-tenantnodes](/compute/docs/nodes/share-node-groups) , ensure that you complete these instructions in the owner project for the [nodegroup](/compute/docs/nodes#node_groups_and_vm_provisioning) , not the consumer project of the cluster.\n- Go to the **Sole-tenant nodes** page in the Google Cloud console. [Go to Sole-tenant nodes](https://console.cloud.google.com/compute/soleTenancy?tab=nodeTemplates) \n- Click **Create node template** .\n- Specify a **Name** and **Region** for your node template.\n- Select a **Node type** .\n- Optionally, add one or more Node affinity labels.\n- Click **Create** to create the node template.\nUse the [gcloud compute sole-tenancy node-templatescreate command](/sdk/gcloud/reference/compute/sole-tenancy/node-templates/create) to create a node template:\n```\ngcloud compute sole-tenancy node-templates create TEMPLATE_NAME \\\n --node-type=NODE_TYPE \\\n --node-affinity-labels=AFFINITY_LABELS \\\n --region=COMPUTE_REGION\n```\nReplace the following:- ``: the name for the new node template.\n- ``: the node type for sole-tenant nodes created based on this template. Use the [gcloud compute sole-tenancynode-types list command](/sdk/gcloud/reference/compute/sole-tenancy/node-types/list) to get a list of the node types available in each zone.\n- ``: the keys and values,`[KEY=VALUE,...]`, for affinity labels. Affinity labels let you logically group nodes and node groups and later, when provisioning VMs, you can specify affinity labels on the VMs to schedule VMs on a specific set of nodes or node groups. For more information, see [Node affinity and anti-affinity](/compute/docs/nodes#node_affinity_and_anti-affinity) .\n- ``: the [region](/compute/docs/regions-zones#available) to create the node template in. You can use this template to create node groups in any zone of this region.\nThe output is similar to the following:\n```\nCreated [https://www.googleapis.com/compute/v1/projects/my-project/regions/us-central1/nodeTemplates/template-name].\n```\n## Create a sole-tenant node group\nA [node group](/compute/docs/nodes#node_groups_and_vm_provisioning) is a set of sole-tenant nodes in a specific zone from the same sole-tenant node template. For regional clusters and node pools available in multiple zones, you must create a node group with the same name in each zone. Ensure that you have [sufficient quota](#requesting_additional_quota) before completing this step.\nIf you are using [shared sole-tenantnodes](/compute/docs/nodes/share-node-groups) , ensure that you complete these instructions in the owner project for the [nodegroup](/compute/docs/nodes#node_groups_and_vm_provisioning) , not the consumer project of the cluster.\nTo create a sole-tenant node group, perform the following steps:- Go to the **Sole-tenant nodes** page in the Google Cloud console. [Go to Sole-tenant nodes](https://console.cloud.google.com/compute/soleTenancy?tab=nodeGroups) \n- Click **Create node group** .\n- Specify a **Name** for your node template.\n- Select the same **Region** you created your node template in, then select a **Zone** in that **Region** .\n- Select your **Node template** .\n- Optionally, enable **Autoscaling mode** .\n- Specify the **Number of nodes** you want in the group.\n- Optionally, change the **Maintenance Policy** .\n- Optionally, to share the sole-tenant node group, configure the share settings by specifying one of the following in the **Configure share settings** section:- **Share this node group with all projects within the organization** .\n- **Share this node group with selected projects within the organization** .\n- Click **Create** to create the node group.\nCreate a node group from the template:\n```\ngcloud compute sole-tenancy node-groups create GROUP_NAME \\\u00a0 \u00a0 --zone COMPUTE_ZONE \\\u00a0 \u00a0 --node-template TEMPLATE_NAME --target-size TARGET_SIZE \\\u00a0 \u00a0 --share-settings=SHARE_SETTING \\\u00a0 \u00a0 --share-with=PROJECTS\n```\nReplace the following:- ``: the name you want for your new node group.\n- ``: the [zone](/compute/docs/regions-zones#available) where this node group is located. This zone must be in the same region as the node template that you are using.\n- ``: the name of the node template that you are using.\n- ``: the number of nodes that you want to create in the group.\n- ``: the share setting for the node group. Set to`projects`to share with specific projects, or set to`organization`to share with the entire organization.\n- ``: a list of project IDs or project numbers to share the node group with. Only required if you set``to`projects`.## Create a GKE sole-tenant node pool\nNow that you have created a sole-tenant node group in Compute Engine, you can create a sole-tenant node pool.\nIf you already have a GKE cluster, you can add a sole-tenant node pool to it. If not, create a cluster with [gcloud container clusters create](/sdk/gcloud/reference/container/clusters/create) .\nIf you are using a regional cluster or if your node pool is available in multiple zones, you must create a node group with the same name in each of those zones. If you cannot reuse the name in each zone, create separate node pools for each zone.\n### Create a node pool with a sole-tenant node group from the cluster's project\nTo create a node pool using a node group from the cluster's project, pass the name of the sole-tenancy node group. If you want to use a shared sole-tenant node group, or you want to use custom node affinity labels that you configured when you [created the sole-tenant node template](#creating_a_sole-tenant_node_template) , see the instructions to [create a node pool with shared sole-tenant node using a node affinity file](#node-pool-affinity-file) .\nCreate a new node pool with a specified node group:\nFor zonal node pools:\n```\n\u00a0 gcloud container node-pools create NODE_POOL_NAME \\\u00a0 \u00a0 \u00a0 --node-group GROUP_NAME --cluster CLUSTER_NAME \\\u00a0 \u00a0 \u00a0 --zone COMPUTE_ZONE --machine-type=MACHINE_TYPE \\\u00a0 \u00a0 \u00a0 --node-locations=COMPUTE_ZONE\n```\nFor regional node pools:\n```\n\u00a0 gcloud container node-pools create NODE_POOL_NAME \\\u00a0 \u00a0 \u00a0 --node-group GROUP_NAME --cluster CLUSTER_NAME \\\u00a0 \u00a0 \u00a0 --region COMPUTE_REGION --machine-type=MACHINE_TYPE \\\u00a0 \u00a0 \u00a0 --node-locations=COMPUTE_ZONE1,COMPUTE_ZONE2\n```\nReplace the following:\n- ``: a name for the new node pool.\n- ``: the name of the existing sole-tenancy node group you want to use.\n- ``: the name of the cluster in which you're creating the node pool.\n- ``: the same region as your cluster.\n- ``: the node pool machine type.\n- ``,`` `,[...]`: the [zones](/compute/docs/regions-zones#available) for the sole-tenancy node groups.\nFor a full list of optional flags you can specify, refer to the [gcloud container node-pools create](/sdk/gcloud/reference/container/node-pools/create) documentation.\n### Create a node pool with shared sole-tenant node using a node affinity file\nTo create a node pool using a [shared sole-tenant node group](/compute/docs/nodes/share-node-groups) , you must use [node affinity labels](/compute/docs/nodes/sole-tenant-nodes#node_affinity_and_anti-affinity) . You can also use node affinity to choose node groups from the same project.\nTo reference labels, follow the instructions to [create a node pool](#create-node-pool-same-project) , replacing the `--node-group` flag with `--sole-tenant-node-affinity-file` flag. Pass a JSON file with those labels. For example, see the following command:\n```\n gcloud container node-pools create sole-tenant-node-pool \\\n  --sole-tenant-node-affinity-file /path/to/affinity/file --cluster my-cluster \\\n  --region us-central1 --machine-type n1-standard-4 \\\n  --node-locations=us-central1-a,us-central1-b,us-central1-c\n```\nThe following sections describe use cases for node affinity labels with sole-tenant nodes.\nTo use sole-tenant node groups from a specific project and node group name, specify these values in the node affinity file. You can use this affinity if you are creating a multi-zone node pool where the node group names from each zone must match. To use any node group in the specified owner project, omit the entire `compute-googleapis.com/node-group-name` block from the JSON file.\nSee the following example:\n```\n[\u00a0 {\u00a0 \u00a0 \"key\" : \"compute.googleapis.com/project\",\u00a0 \u00a0 \"operator\" : \"IN\",\u00a0 \u00a0 \"values\" : [\"OWNER_PROJECT\"]\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\" : \"compute.googleapis.com/node-group-name\",\u00a0 \u00a0 \"operator\" : \"IN\",\u00a0 \u00a0 \"values\" : [\"GROUP_NAME\"]\u00a0 },]\n```\nYou can also use [node affinity and anti-affinity](/compute/docs/nodes/sole-tenant-nodes#node_affinity_and_anti-affinity) to create a node pool using node groups with custom labels. Each node group is automatically assigned [default affinity labels](/compute/docs/nodes/sole-tenant-nodes#default_affinity_labels) . You can reference the default labels as with the previous examples, or use custom labels designated when [creating the node template](#creating_a_sole-tenant_node_template) . You can use custom labels to isolate or group workloads.\nSee the following example:\n```\n[\u00a0 {\u00a0 \u00a0 \"key\" : \"compute.googleapis.com/project\",\u00a0 \u00a0 \"operator\" : \"IN\",\u00a0 \u00a0 \"values\" : [\"OWNER_PROJECT\"]\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\" : \"workload\",\u00a0 \u00a0 \"operator\" : \"IN\",\u00a0 \u00a0 \"values\" : [\"frontend\"]\u00a0 },]\n```\n## Limitations\nWhen creating a node pool with sole-tenant nodes, you are responsible for managing the underlying capacity for sole-tenant node groups. Consider how the following features interact with sole-tenant node groups:\n- You can enable [cluster autoscaling](/kubernetes-engine/docs/concepts/cluster-autoscaler) , however it is limited by the capacity of the underlying node group. You can configure the [node group autoscaler](/compute/docs/nodes/autoscaling-node-groups) in Compute Engine to automatically manage the size of your sole-tenant node groups.\n- You cannot enable [node auto-provisioning](/kubernetes-engine/docs/how-to/node-auto-provisioning) for your cluster if you use sole-tenant nodes.\n- You can use any [node upgrade strategy](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies) , however you must ensure you have sufficient capacity to support the node pool using its chosen upgrade strategy.## What's next\n- [Read about how node pools work](/kubernetes-engine/docs/concepts/node-pools) .\n- [Learn more about sole-tenant nodes](/compute/docs/nodes/sole-tenant-nodes) .", "guide": "Google Kubernetes Engine (GKE)"}