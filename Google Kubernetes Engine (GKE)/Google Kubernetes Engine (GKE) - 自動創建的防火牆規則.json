{"title": "Google Kubernetes Engine (GKE) - \u81ea\u52d5\u5275\u5efa\u7684\u9632\u706b\u7246\u898f\u5247", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/firewall-rules?hl=zh-cn", "abstract": "# Google Kubernetes Engine (GKE) - \u81ea\u52d5\u5275\u5efa\u7684\u9632\u706b\u7246\u898f\u5247\n\u672c\u9801\u9762\u4ecb\u7d39 Google Kubernetes Engine (GKE) \u5728 Google Cloud \u4e2d\u81ea\u52d5\u5275\u5efa\u7684 [\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/vpc/docs/firewalls?hl=zh-cn) \u3002\n\u9664\u4e86\u672c\u9801\u9762\u6240\u5217 GKE \u5c08\u7528\u898f\u5247\u4e4b\u5916\uff0c\u9ed8\u8a8d\u7684 Google Cloud \u9805\u76ee\u9084\u5305\u62ec [\u9810\u5148\u586b\u5145\u7684\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/vpc/docs/firewalls?hl=zh-cn#more_rules_default_vpc) \u3002GKE \u96c6\u7fa3\u901a\u5e38\u90e8\u7f72\u5728 VPC \u7db2\u7d61\u4e2d\u3002\u9019\u4e9b\u898f\u5247\u53ef\u7232 GKE \u96c6\u7fa3\u6388\u4e88\u5fc5\u8981\u7684\u7db2\u7d61\u8a2a\u554f\u6b0a\u9650\u3002\u9019\u4e9b\u898f\u5247\u8db3\u4ee5\u6eff\u8db3\u57fa\u672c\u96c6\u7fa3\u64cd\u4f5c\u7684\u9700\u6c42\uff0c\u4f46\u60a8\u53ef\u80fd\u9700\u8981\u6839\u64da\u5177\u9ad4\u9700\u6c42\u5275\u5efa\u5176\u4ed6\u898f\u5247\u3002\n**\u6ce8\u610f** \uff1a\u8acb\u8a55\u4f30\u9069\u7528\u65bc Virtual Private Cloud (VPC) \u4e2d\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u6240\u6709\u9632\u706b\u7246\u898f\u5247\uff0c\u5305\u62ec\u5165\u7ad9\u898f\u5247\u548c\u51fa\u7ad9\u898f\u5247\u3002\u5982\u679c\u60a8\u6c7a\u5b9a\u963b\u6b62\u5c08\u7528\u96c6\u7fa3\u7684\u51fa\u7ad9\u9023\u63a5\uff0c\u5247\u5fc5\u9808\u78ba\u4fdd\u5b58\u5728\u9069\u7576\u7684\u9632\u706b\u7246\u898f\u5247\uff0c\u4ee5\u5141\u8a31\u7bc0\u9ede\u8207 TCP \u7aef\u53e3 443 \u4e0a\u7684\u63a7\u5236\u5e73\u9762\u901a\u4fe1\u3002\n", "content": "## \u9632\u706b\u7246\u898f\u5247\n\u5275\u5efa\u4ee5\u4e0b\u8cc7\u6e90\u6642\uff0cGKE \u6703\u81ea\u52d5\u5275\u5efa\u9632\u706b\u7246\u898f\u5247\uff1a\n- GKE \u96c6\u7fa3\n- GKE Service\n- GKE Gateway \u548c HTTPRoute\n- GKE Ingress\n\u9664\u975e\u53e6\u6709\u8aaa\u660e\uff0c\u5426\u5247\u6240\u6709\u81ea\u52d5\u5275\u5efa\u7684\u9632\u706b\u7246\u898f\u5247\u7684\u512a\u5148\u7d1a\u5747\u7232 1000\uff0c\u9019\u662f [\u9632\u706b\u7246\u898f\u5247\u7684\u9ed8\u8a8d\u503c](https://cloud.google.com/vpc/docs/firewalls?hl=zh-cn#priority_order_for_firewall_rules) \u3002\u5982\u679c\u60a8\u5e0c\u671b\u66f4\u597d\u5730\u63a7\u5236\u9632\u706b\u7246\u884c\u7232\uff0c\u5247\u53ef\u4ee5\u5275\u5efa\u5177\u6709\u66f4\u9ad8 [\u512a\u5148\u7d1a](https://cloud.google.com/vpc/docs/firewalls?hl=zh-cn#priority_order_for_firewall_rules) \u7684\u9632\u706b\u7246\u898f\u5247\u3002\u512a\u5148\u7d1a\u8f03\u9ad8\u7684\u9632\u706b\u7246\u898f\u5247\u6703\u5728\u81ea\u52d5\u5275\u5efa\u7684\u9632\u706b\u7246\u898f\u5247\u4e4b\u524d\u61c9\u7528\u3002\n**\u8b66\u544a** \uff1a\u8acb\u52ff\u4fee\u6539\u6216\u522a\u9664 GKE \u5275\u5efa\u7684\u9632\u706b\u7246\u898f\u5247\uff0c\u5426\u5247\u96c6\u7fa3\u4e2d\u53ef\u80fd\u6703\u51fa\u73fe\u610f\u5916\u884c\u7232\u3002\n### GKE \u96c6\u7fa3\u9632\u706b\u7246\u898f\u5247\n\u5275\u5efa\u96c6\u7fa3\u6642\uff0cGKE \u6703\u5275\u5efa\u4ee5\u4e0b\u5165\u7ad9\u9632\u706b\u7246\u898f\u5247\uff1a\n| \u540d\u7a31          | \u7528\u9014                                                                                       | \u6e90\u4ee3\u78bc                                                                                               | \u76ee\u6a19\uff08\u7528\u65bc\u5b9a\u7fa9\u76ee\u7684\u5730\uff09  | \u5354\u8b70\u548c\u7aef\u53e3        | \u512a\u5148\u7d1a          | Unnamed: 6 |\n|:--------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------|:---------------------------------------|:----------------------------------------------|-------------:|\n| gke-[cluster-name]-[cluster-hash]-master | \u50c5\u9069\u7528\u65bc\u5c08\u7528 Autopilot \u96c6\u7fa3\u548c Standard \u96c6\u7fa3\u3002 \u5141\u8a31\u63a7\u5236\u5c64\u9762\u8a2a\u554f\u96c6\u7fa3\u7bc0\u9ede\u4e0a\u7684 Kubelet \u548c\u6307\u6a19\u670d\u52d9\u5668\u3002                                                               | \u50c5\u9069\u7528\u65bc\u5c08\u7528 Autopilot \u96c6\u7fa3\u3002 \u5141\u8a31\u63a7\u5236\u5c64\u9762\u8a2a\u554f\u96c6\u7fa3\u7bc0\u9ede\u4e0a\u7684 Kubelet \u548c\u6307\u6a19\u670d\u52d9\u5668\u3002                                                                            | \u63a7\u5236\u5c64\u9762 IP \u5730\u5740\u7bc4\u570d (/28) | \u7bc0\u9ede\u6a19\u8a18        | TCP\uff1a443\uff08\u6307\u6a19\u670d\u52d9\u5668\uff09\u548c TCP\uff1a10250 (kubelet) |   1000 |\n| gke-[cluster-name]-[cluster-hash]-vms  | \u7528\u65bc Kubernetes \u7db2\u7d61\u6a21\u578b\u6240\u9700\u7684\u96c6\u7fa3\u5167\u901a\u4fe1\u3002 \u5141\u8a31\u5728\u7bc0\u9ede\u4e0a\u904b\u884c\u7684\u8edf\u4ef6\u5c07\u5177\u6709\u8207\u4f86\u6e90\u5339\u914d\u7684\u7bc0\u9ede IP \u5730\u5740\u7684\u6578\u64da\u5305\u767c\u9001\u5230\u96c6\u7fa3\u4e2d\u7684\u76ee\u6a19 Pod IP \u5730\u5740\u548c\u7bc0\u9ede IP \u5730\u5740\u3002\u4f8b\u5982\uff0c\u6b64\u898f\u5247\u5141\u8a31\u7684\u6d41\u91cf\u5305\u62ec\uff1a \u5f9e\u7cfb\u7d71\u5b88\u8b77\u7a0b\u5e8f\uff08\u5982 kubelet\uff09\u767c\u9001\u5230\u96c6\u7fa3\u7684\u7bc0\u9ede\u548c Pod IP \u5730\u5740\u76ee\u6a19\u7684\u6578\u64da\u5305\u3002 \u5f9e\u5728 Pod \u4e2d\u904b\u884c\u7684\u8edf\u4ef6\uff08\u5177\u6709 hostNetwork:true \u8a2d\u7f6e\uff09\u767c\u9001\u5230\u96c6\u7fa3\u7684\u7bc0\u9ede\u548c Pod IP \u5730\u5740\u76ee\u6a19\u7684\u6578\u64da\u5305\u3002 | \u7bc0\u9ede IP \u5730\u5740\u7bc4\u570d\u6216\u6b64\u7bc0\u9ede IP \u5730\u5740\u7bc4\u570d\u7684\u8d85\u96c6\uff1a \u5c0d\u65bc\u81ea\u52d5\u6a21\u5f0f VPC \u7db2\u7d61\uff0cGKE \u6703\u4f7f\u7528 10.128.0.0/9 CIDR\uff0c\u56e0\u7232\u8a72\u7bc4\u570d\u5305\u542b\u81ea\u52d5\u5275\u5efa\u7684\u5b50\u7db2\u7576\u524d\u548c\u672a\u4f86\u7684\u6240\u6709\u5b50\u7db2\u4e3b\u8981 IPv4 \u5730\u5740\u7bc4\u570d\u3002 \u5c0d\u65bc\u81ea\u5b9a\u7fa9\u6a21\u5f0f VPC \u7db2\u7d61\uff0cGKE \u6703\u4f7f\u7528\u96c6\u7fa3\u5b50\u7db2\u7684\u4e3b\u8981 IPv4 \u5730\u5740\u7bc4\u570d\u3002 \u5982\u679c\u60a8\u64f4\u5c55\u96c6\u7fa3\u5b50\u7db2\u7684\u4e3b\u8981 IPv4 \u7bc4\u570d\uff0cGKE \u4e0d\u6703\u66f4\u65b0\u6b64\u9632\u706b\u7246\u898f\u5247\u7684\u4f86\u6e90 IPv4 \u7bc4\u570d\u3002\u5982\u679c\u60a8\u64f4\u5c55\u96c6\u7fa3\u5b50\u7db2\u7684\u4e3b\u8981 IPv4 \u7bc4\u570d\uff0c\u5247\u5fc5\u9808\u624b\u52d5\u5275\u5efa\u5fc5\u8981\u7684\u5165\u7ad9\u9632\u706b\u7246\u898f\u5247\u3002 | \u7bc0\u9ede\u6a19\u8a18     | TCP\uff1a1-65535\u3001UDP\uff1a1-65535\u3001ICMP  | 1000           |   nan |\n| gke-[cluster-name]-[cluster-hash]-all  | \u6309\u7167 Kubernetes \u7db2\u7d61\u6a21\u578b\u7684\u8981\u6c42\uff0c\u5141\u8a31\u96c6\u7fa3\u4e0a\u6240\u6709 Pod \u4e4b\u9593\u7684\u6d41\u91cf\u3002                                                                        | Pod CIDR \u5c0d\u65bc\u5553\u7528\u4e86\u9023\u7e8c\u7684\u591a Pod CIDR \u7684\u96c6\u7fa3\uff0c\u5247\u7232\u96c6\u7fa3\u4f7f\u7528\u7684\u6240\u6709 Pod CIDR \u5730\u5740\u584a\u3002                                                                            | \u7bc0\u9ede\u6a19\u8a18     | TCP\u3001UDP\u3001SCTP\u3001ICMP\u3001ESP\u3001AH   | 1000           |   nan |\n| gke-[cluster-hash]-ipv6-all     | \u50c5\u9069\u7528\u65bc\u96d9\u68e7\u7db2\u7d61\u96c6\u7fa3\u3002\u5141\u8a31\u96c6\u7fa3\u4e0a\u7684\u7bc0\u9ede\u8207 Pod \u4e4b\u9593\u7684\u6d41\u91cf\u3002                                                                          | subnetIpv6CidrBlock \u4e2d\u5206\u914d\u7684\u540c\u4e00 IP \u5730\u5740\u7bc4\u570d\u3002                                                                                     | \u7bc0\u9ede\u6a19\u8a18     | TCP\u3001UDP\u3001SCTP\u3001ICMP for IPv6\u3001ESP\u3001AH | 1000           |   nan |\n| gke-[cluster-name]-[cluster-hash]-inkubelet | \u5141\u8a31\u5728\u904b\u884c 1.23.6 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u65b0 GKE \u96c6\u7fa3\u4e2d\u901a\u904e\u5167\u90e8 Pod CIDR \u548c\u7bc0\u9ede CIDR \u8a2a\u554f\u7aef\u53e3 10255\uff08Kubelet \u53ea\u8b80\u7aef\u53e3\uff09\u3002\u904b\u884c\u9ad8\u65bc 1.26.4-gke.500 \u7248\u7684\u96c6\u7fa3\u5247\u6539\u7528 Kubelet \u8eab\u4efd\u9a57\u8b49\u7aef\u53e3 (10250)\u3002\u8acb\u52ff\u5728\u96c6\u7fa3\u5167\u6dfb\u52a0\u6703\u963b\u6b62 10250 \u7684\u9632\u706b\u7246\u898f\u5247\u3002                                | \u5167\u90e8 Pod CIDR \u548c\u7bc0\u9ede CIDR\u3002                                                                                          | \u7bc0\u9ede\u6a19\u8a18     | TCP\uff1a10255        | 999           |   nan |\n| gke-[cluster-name]-[cluster-hash]-exkubelet | \u5728\u904b\u884c 1.23.6 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u65b0 GKE \u96c6\u7fa3\u4e2d\u62d2\u7d55\u5c0d\u7aef\u53e3 10255 \u7684\u516c\u958b\u8a2a\u554f\u3002                                                                      | 0.0.0.0/0                                                                                              | \u7bc0\u9ede\u6a19\u8a18     | TCP\uff1a10255        | 1000           |   nan |\n### GKE Service \u9632\u706b\u7246\u898f\u5247\n\u5275\u5efa [Service](https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=zh-cn) \u6642\uff0cGKE \u6703\u5275\u5efa\u4ee5\u4e0b\u5165\u7ad9\u9632\u706b\u7246\u898f\u5247\uff1a\n| \u540d\u7a31               | \u7528\u9014                                   | \u6e90\u4ee3\u78bc                                      | \u76ee\u6a19\uff08\u7528\u65bc\u5b9a\u7fa9\u76ee\u7684\u5730\uff09 | \u5354\u8b70\u548c\u7aef\u53e3                                 |\n|:-------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------|\n| k8s-fw-[loadbalancer-hash]         | \u5141\u8a31\u5165\u7ad9\u6d41\u91cf\u5230\u9054 Service\u3002                             | \u4f86\u6e90\u4f86\u81ea spec.loadBalancerSourceRanges\u3002\u5982\u679c\u7701\u7565 spec.loadBalancerSourceRanges\uff0c\u5247\u9ed8\u8a8d\u7232 0.0.0.0/0\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u9632\u706b\u7246\u898f\u5247\u548c\u4f86\u6e90 IP \u5730\u5740\u8a31\u53ef\u540d\u55ae\u3002 | LoadBalancer \u865b\u64ec IP \u5730\u5740 | Service \u6e05\u55ae\u4e2d\u6307\u5b9a\u7684\u7aef\u53e3\u4e0a\u7684 TCP \u548c UDP\u3002                          |\n| k8s-[cluster-id]-node-http-hc        | \u7576 externalTrafficPolicy \u8a2d\u7f6e\u7232 Cluster \u6642\uff0c\u5141\u8a31\u5916\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668\u670d\u52d9\u7684\u5065\u5eb7\u6aa2\u67e5\u3002              | 130.211.0.0/22 35.191.0.0/16 209.85.152.0/22 209.85.204.0/22                        | LoadBalancer \u865b\u64ec IP \u5730\u5740 | TCP\uff1a10256                                 |\n| k8s-[loadbalancer-hash]-http-hc        | \u7576 externalTrafficPolicy \u8a2d\u7f6e\u7232 Local \u6642\uff0c\u5141\u8a31\u5916\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668\u670d\u52d9\u7684\u5065\u5eb7\u6aa2\u67e5\u3002               | 130.211.0.0/22 35.191.0.0/16 209.85.152.0/22 209.85.204.0/22                        | \u7bc0\u9ede\u6a19\u8a18     | \u7531 spec.healthCheckNodePort \u5b9a\u7fa9\u7684 TCP \u7aef\u53e3\u3002\u5982\u679c\u7701\u7565 spec.healthCheckNodePort\uff0c\u5247\u9ed8\u8a8d\u7232 TCP \u7aef\u53e3\u865f 10256\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u5065\u5eb7\u6aa2\u67e5\u7aef\u53e3\u3002 |\n| k8s-[cluster-id]-node-hc          | \u7576 externalTrafficPolicy \u8a2d\u7f6e\u7232 Cluster \u6642\uff0c\u5141\u8a31\u5167\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668\u670d\u52d9\u7684\u5065\u5eb7\u6aa2\u67e5\u3002              | 130.211.0.0/22 35.191.0.0/16 209.85.152.0/22 209.85.204.0/22                        | \u7bc0\u9ede\u6a19\u8a18     | TCP\uff1a10256                                 |\n| [loadbalancer-hash]-hc          | \u7576 externalTrafficPolicy \u8a2d\u7f6e\u7232 Local \u6642\uff0c\u5141\u8a31\u5167\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668\u670d\u52d9\u7684\u5065\u5eb7\u6aa2\u67e5\u3002               | 130.211.0.0/22 35.191.0.0/16 209.85.152.0/22 209.85.204.0/22                        | \u7bc0\u9ede\u6a19\u8a18     | \u7531 spec.healthCheckNodePort \u5b9a\u7fa9\u7684 TCP \u7aef\u53e3\u3002\u5982\u679c\u7701\u7565 spec.healthCheckNodePort\uff0c\u5247\u9ed8\u8a8d\u7232 TCP \u7aef\u53e3\u865f 10256\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u5065\u5eb7\u6aa2\u67e5\u7aef\u53e3\u3002 |\n| k8s2-[cluster-id]-[namespace]-[service-name]-[suffixhash] | \u5728\u5553\u7528\u4ee5\u4e0b\u5176\u4e2d\u4e00\u9805\u6642\uff0c\u5141\u8a31\u5165\u7ad9\u6d41\u91cf\u5230\u9054 Service\uff1aGKE \u5b50\u96c6\u3002 \u57fa\u65bc\u5f8c\u7aef\u670d\u52d9\u7684\u5916\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668\u3002           | \u4f86\u6e90\u4f86\u81ea spec.loadBalancerSourceRanges\u3002\u5982\u679c\u7701\u7565 spec.loadBalancerSourceRanges\uff0c\u5247\u9ed8\u8a8d\u7232 0.0.0.0/0\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u9632\u706b\u7246\u898f\u5247\u548c\u4f86\u6e90 IP \u5730\u5740\u8a31\u53ef\u540d\u55ae\u3002 | LoadBalancer \u865b\u64ec IP \u5730\u5740 | Service \u6e05\u55ae\u4e2d\u6307\u5b9a\u7684\u7aef\u53e3\u4e0a\u7684 TCP \u548c UDP\u3002                          |\n| k8s2-[cluster-id]-[namespace]-[service-name]-[suffixhash]-fw | \u7576 externalTrafficPolicy \u8a2d\u7f6e\u7232 Local \u4e14\u5553\u7528\u4e86\u4ee5\u4e0b\u4efb\u4e00\u9805\u6642\uff0c\u5141\u8a31\u5c0d Service \u9032\u884c\u5065\u5eb7\u6aa2\u67e5\uff1aGKE \u5b50\u96c6\u3002 \u57fa\u65bc\u5f8c\u7aef\u670d\u52d9\u7684\u5916\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668\u3002 | 130.211.0.0/22 35.191.0.0/16 209.85.152.0/22 209.85.204.0/22                        | LoadBalancer \u865b\u64ec IP \u5730\u5740 | \u7531 spec.healthCheckNodePort \u5b9a\u7fa9\u7684 TCP \u7aef\u53e3\u3002\u5982\u679c\u7701\u7565 spec.healthCheckNodePort\uff0c\u5247\u9ed8\u8a8d\u7232 TCP \u7aef\u53e3\u865f 10256\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u5065\u5eb7\u6aa2\u67e5\u7aef\u53e3\u3002 |\n| k8s2-[cluster-id]-l4-shared-hc-fw       | \u7576 externalTrafficPolicy \u8a2d\u7f6e\u7232 Cluster \u4e14\u5553\u7528\u4e86\u4ee5\u4e0b\u4efb\u4e00\u9805\u6642\uff0c\u5141\u8a31\u5c0d Service \u9032\u884c\u5065\u5eb7\u6aa2\u67e5\uff1aGKE \u5b50\u96c6\u3002 \u57fa\u65bc\u5f8c\u7aef\u670d\u52d9\u7684\u5916\u90e8\u76f4\u901a\u7db2\u7d61\u8ca0\u8f09\u5747\u8861\u5668\u3002 | 130.211.0.0/22 35.191.0.0/16 209.85.152.0/22 209.85.204.0/22                        | \u7bc0\u9ede\u6a19\u8a18     | TCP\uff1a10256                                 |\n| gke-[cluster-name]-[cluster-hash]-mcsd      | \u5141\u8a31\u63a7\u5236\u5c64\u9762\u8a2a\u554f\u591a\u96c6\u7fa3\u670d\u52d9\u7684\u96c6\u7fa3\u7bc0\u9ede\u4e0a\u7684 Kubelet \u548c\u6307\u6a19\u670d\u52d9\u5668\u3002\u6b64\u898f\u5247\u7684\u512a\u5148\u7d1a\u7232 900\u3002              | \u5065\u5eb7\u6aa2\u67e5 IP \u5730\u5740                                   | \u7bc0\u9ede\u6a19\u8a18     | TCP\u3001UDP\u3001SCTP\u3001ICMP\u3001ESP\u3001AH                             |\n### GKE Gateway \u9632\u706b\u7246\u898f\u5247\n\u5275\u5efa [Gateway](https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api?hl=zh-cn#gateway) \u548c [HTTPRoute](https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api?hl=zh-cn#httproute) \u8cc7\u6e90\u6642\uff0cGKE \u6703\u5275\u5efa\u4ee5\u4e0b\u7db2\u95dc\u9632\u706b\u7246\u898f\u5247\uff1a\n| \u540d\u7a31                  | \u7528\u9014                                    | \u6e90\u4ee3\u78bc                   | \u76ee\u6a19\uff08\u7528\u65bc\u5b9a\u7fa9\u76ee\u7684\u5730\uff09 | \u5354\u8b70\u548c\u7aef\u53e3       |\n|:-------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------|:-------------------------|:------------------------------------|\n| gkegw1-l7-[network]-[region/global] gkemcg1-l7-[network]-[region/global] | \u5141\u8a31\u7db2\u7d61\u7aef\u9ede\u7d44 (NEG) \u7684\u5065\u5eb7\u6aa2\u67e5\u3002 \u5275\u5efa\u7b2c\u4e00\u500b Gateway \u8cc7\u6e90\u6642\uff0cGateway \u63a7\u5236\u5668\u6703\u5275\u5efa\u6b64\u898f\u5247\u3002\u5982\u679c\u5275\u5efa\u66f4\u591a Gateway \u8cc7\u6e90\uff0cGateway \u63a7\u5236\u5668\u53ef\u4ee5\u66f4\u65b0\u6b64\u898f\u5247\u3002 | 130.211.0.0/22 35.191.0.0/16 \u7528\u6236\u5b9a\u7fa9\u7684\u50c5\u4ee3\u7406\u5b50\u7db2\u7bc4\u570d\uff08\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\uff09 | \u7bc0\u9ede\u6a19\u8a18     | TCP\uff1a\u6240\u6709\u5bb9\u5668\u76ee\u6a19\u7aef\u53e3\uff08\u9069\u7528\u65bc NEG\uff09 |\n### GKE Ingress \u9632\u706b\u7246\u898f\u5247\n\u5275\u5efa [Ingress](https://cloud.google.com/kubernetes-engine/docs/concepts/ingress?hl=zh-cn) \u8cc7\u6e90\u6642\uff0cGKE \u6703\u5275\u5efa\u4ee5\u4e0b\u5165\u7ad9\u6d41\u91cf\u9632\u706b\u7246\u898f\u5247\uff1a\n| \u540d\u7a31     | \u7528\u9014                                           | \u6e90\u4ee3\u78bc                                                          | \u76ee\u6a19\uff08\u7528\u65bc\u5b9a\u7fa9\u76ee\u7684\u5730\uff09 | \u5354\u8b70\u548c\u7aef\u53e3                     |\n|:------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------|:-------------------------------------------------------------------------------------------|\n| k8s-fw-l7-[random-hash] | \u5141\u8a31 NodePort Service \u6216\u7db2\u7d61\u7aef\u9ede\u7d44 (NEG) \u7684\u5065\u5eb7\u6aa2\u67e5\u3002 \u5275\u5efa\u7b2c\u4e00\u500b Ingress \u8cc7\u6e90\u6642\uff0cIngress \u63a7\u5236\u5668\u6703\u5275\u5efa\u6b64\u898f\u5247\u3002\u5982\u679c\u5275\u5efa\u4e86\u66f4\u591a Ingress \u8cc7\u6e90\uff0c\u5247 Ingress \u63a7\u5236\u5668\u53ef\u4ee5\u66f4\u65b0\u6b64\u898f\u5247\u3002 | 130.211.0.0/22 35.191.0.0/16 209.85.152.0/22 209.85.204.0/22 \u7528\u6236\u5b9a\u7fa9\u7684\u50c5\u4ee3\u7406\u5b50\u7db2\u7bc4\u570d\uff08\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\uff09 \u5c0d\u65bc GKE v1.17.13-gke.2600 \u6216\u66f4\u9ad8\u7248\u672c\uff1a 130.211.0.0/22 35.191.0.0/16 \u7528\u6236\u5b9a\u7fa9\u7684\u50c5\u4ee3\u7406\u5b50\u7db2\u7bc4\u570d\uff08\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\uff09 | \u7bc0\u9ede\u6a19\u8a18     | TCP\uff1a30000-32767\u3001TCP\uff1a80\uff08\u9069\u7528\u65bc\u5167\u90e8\u61c9\u7528\u8ca0\u8f09\u5747\u8861\u5668\uff09\u3001TCP\uff1a\u6240\u6709\u5bb9\u5668\u76ee\u6a19\u7aef\u53e3\uff08\u9069\u7528\u65bc NEG\uff09 |\n## \u5171\u4eab VPC\n\u4f4d\u65bc\u5171\u4eab VPC \u4e2d\u7684\u96c6\u7fa3\u4f7f\u7528\u5171\u4eab VPC \u7db2\u7d61\u6642\uff0cIngress \u63a7\u5236\u5668\u7121\u6cd5\u4f7f\u7528\u670d\u52d9\u9805\u76ee\u4e2d\u7684 GKE \u670d\u52d9\u8cec\u865f\u5728\u5bbf\u4e3b\u9805\u76ee\u4e2d\u5275\u5efa\u548c\u66f4\u65b0\u5165\u7ad9\u5141\u8a31\u9632\u706b\u7246\u898f\u5247\u3002\u60a8\u53ef\u4ee5\u5728\u670d\u52d9\u9805\u76ee\u4e2d\u7232 GKE \u670d\u52d9\u8cec\u865f\u6388\u4e88\u5275\u5efa\u548c\u7ba1\u7406\u9632\u706b\u7246\u8cc7\u6e90\u7684\u6b0a\u9650\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5171\u4eab VPC](https://cloud.google.com/kubernetes-engine/docs/concepts/ingress?hl=zh-cn#shared_vpc) \u3002\n**\u6ce8\u610f** \uff1a\u5c0d\u65bc GKE Gateway\uff0c\u76ee\u524d\u4e0d\u6703\u81ea\u52d5\u90e8\u7f72\u9632\u706b\u7246\u898f\u5247\u3002\u60a8\u9700\u8981\u624b\u52d5\u5275\u5efa\u9632\u706b\u7246\u898f\u5247\uff0c\u624d\u80fd\u4f7f\u5065\u5eb7\u6aa2\u67e5\u6210\u529f\u3002\n## \u64f4\u5c55\u5b50\u7db2\u6240\u9700\u7684\u9632\u706b\u7246\u898f\u5247\n\u5982\u679c\u60a8 [\u64f4\u5c55\u96c6\u7fa3\u5b50\u7db2\u7684\u4e3b\u8981 IPv4 \u7bc4\u570d](https://cloud.google.com/vpc/docs/create-modify-vpc-networks?hl=zh-cn#expand-subnet) \uff0cGKE \u4e0d\u6703\u81ea\u52d5\u66f4\u65b0 `gke-[cluster-name]-[cluster-hash]-vms` \u9632\u706b\u7246\u898f\u5247\u7684\u4f86\u6e90\u7bc4\u570d\u3002\u7531\u65bc\u96c6\u7fa3\u4e2d\u7684\u7bc0\u9ede\u53ef\u4ee5\u63a5\u6536\u4f86\u81ea\u5b50\u7db2\u4e3b\u8981 IPv4 \u7bc4\u570d\u64f4\u5c55\u90e8\u5206\u7684 IPv4 \u5730\u5740\uff0c\u56e0\u6b64\u60a8\u5fc5\u9808\u624b\u52d5\u5275\u5efa\u9632\u706b\u7246\u898f\u5247\uff0c\u4ee5\u5141\u8a31\u5728\u96c6\u7fa3\u7684\u7bc0\u9ede\u4e4b\u9593\u9032\u884c\u901a\u4fe1\u3002\n\u60a8\u5275\u5efa\u7684\u5165\u7ad9\u9632\u706b\u7246\u898f\u5247\u5fc5\u9808\u5141\u8a31 \u7684 TCP \u548c ICMP \u6578\u64da\u5305\uff0c\u4e26\u4e14\u8a72\u898f\u5247\u5fc5\u9808\u81f3\u5c11\u61c9\u7528\u65bc\u96c6\u7fa3\u4e2d\u7684\u6240\u6709\u7bc0\u9ede\u3002\n\u5982\u9700\u5275\u5efa\u50c5\u61c9\u7528\u65bc\u96c6\u7fa3\u7bc0\u9ede\u7684\u5165\u7ad9\u9632\u706b\u7246\u898f\u5247\uff0c\u8acb\u5c07\u9632\u706b\u7246\u898f\u5247\u7684\u76ee\u6a19\u8a2d\u7f6e\u7232\u96c6\u7fa3\u81ea\u52d5\u5275\u5efa\u7684 `gke-[cluster-name]-[cluster-hash]-vms` \u9632\u706b\u7246\u898f\u5247\u6240\u7528\u7684\u76ee\u6a19\u6a19\u8a18\u3002\n## \u9632\u706b\u7246\u898f\u5247\u65e5\u8a8c\u8a18\u9304\n\u9632\u706b\u7246\u898f\u5247\u65e5\u8a8c\u8a18\u9304\u9ed8\u8a8d\u8655\u65bc\u505c\u7528\u72c0\u614b\u3002\u5982\u9700\u7232\u9632\u706b\u7246\u898f\u5247\u5553\u7528\u65e5\u8a8c\u8a18\u9304\uff0c\u8acb\u4f7f\u7528 [--enable-logging \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/firewall-rules/update?hl=zh-cn) \u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u95b1\u8b80 [GKE \u4e2d\u7684\u7db2\u7d61](https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview?hl=zh-cn) \u6982\u89bd\u3002\n- \u77ad\u89e3\u5982\u4f55 [\u7232\u61c9\u7528\u914d\u7f6e\u7db2\u7d61\u653f\u7b56](https://cloud.google.com/kubernetes-engine/docs/tutorials/network-policy?hl=zh-cn) \u3002\n- \u77ad\u89e3 Google Cloud \u4e2d\u7684\u5176\u4ed6 [\u9810\u5148\u586b\u5145\u7684\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/vpc/docs/firewalls?hl=zh-cn#more_rules_default_vpc) \u3002\n- \u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5728\u4f7f\u7528\u5171\u4eab VPC \u7684\u9805\u76ee\u4e2d [\u5275\u5efa\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-shared-vpc?hl=zh-cn#creating_firewall_rules) \u3002", "guide": "Google Kubernetes Engine (GKE)"}