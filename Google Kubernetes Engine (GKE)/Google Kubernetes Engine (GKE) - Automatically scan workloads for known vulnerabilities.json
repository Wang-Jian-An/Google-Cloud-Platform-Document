{"title": "Google Kubernetes Engine (GKE) - Automatically scan workloads for known vulnerabilities", "url": "https://cloud.google.com/kubernetes-engine/docs/how-to/security-posture-vulnerability-scanning", "abstract": "# Google Kubernetes Engine (GKE) - Automatically scan workloads for known vulnerabilities\nThis page shows you how to automatically scan the container operating system (OS) and language packages in your running workloads for known vulnerabilities and get actionable mitigation strategies if available. Workload vulnerability scanning is a part of the [security posture dashboard](/kubernetes-engine/docs/concepts/about-security-posture-dashboard) , which is a set of features that provide opinionated information and recommendations to improve the security of your Google Kubernetes Engine (GKE) clusters and workloads.\nTo learn more, see [About workload vulnerability scanning](/kubernetes-engine/docs/concepts/about-workload-vulnerability-scanning) .\n", "content": "## Pricing\nFor pricing information, see [GKE security posture dashboard pricing](/kubernetes-engine/docs/concepts/about-security-posture-dashboard#pricing) .\n## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.\n- Enable the Container Security API. [EnableContainer Security API](https://console.cloud.google.com/flows/enableapi?apiid=containersecurity.googleapis.com) \n- To use advanced vulnerability insights, enable the Container Analysis API. [EnableContainer Analysis API](https://console.cloud.google.com/flows/enableapi?apiid=containeranalysis.googleapis.com) \n### Requirements\n- To get the permissions that you need to use workload vulnerability scanning,   ask your administrator to grant you the [Security Posture Viewer ](https://cloud.google.com/iam/docs/understanding-roles#containersecurity.viewer) ( `roles/containersecurity.viewer` ) IAM role on your Google Cloud project.    For more information about granting roles, see [Manage access](/iam/docs/granting-changing-revoking-access) .This predefined role contains     the permissions required to use workload vulnerability scanning. To see the exact permissions that are   required, expand the **Required permissions** section:You might also be able to get   these permissions  with [custom roles](/iam/docs/creating-custom-roles) or  other [predefined roles](/iam/docs/understanding-roles) .\n- Container OS vulnerability scanning requires GKE version 1.23.5-gke.700 or later. Advanced vulnerability insights requires GKE version 1.27 or later.## Workload vulnerability scanning tiers\nYou enable vulnerability scanning in tiers, each of which adds scanning capabilities as follows. If you use Google Kubernetes Engine (GKE) Enterprise edition to manage fleets of clusters, you can also configure fleet-level vulnerability scanning settings that apply to all member clusters. For instructions, see [Configure GKE security posture dashboard features at fleet-level](/kubernetes-engine/docs/how-to/fleet-security-posture) .\n| Tier          | Enabled capabilities              | GKE version requirement                                 |\n|:-------------------------------------------|:----------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Standard standard       | Container OS vulnerability scanning           | Requires version 1.23.5-gke.700 or later Enabled by default in Autopilot clusters running version 1.27 or later Disabled by default in Standard clusters |\n| Advanced vulnerability insights enterprise | Container OS vulnerability scanning Language package vulnerability scanning | Requires version 1.27 or later Disabled by default in Autopilot and Standard                    |\nFor more information, about each capability, see [About workload vulnerability scanning](/kubernetes-engine/docs/concepts/about-workload-vulnerability-scanning) .\n## Enable container OS vulnerability scanning\nContainer OS vulnerability scanning is enabled by default in new Autopilot clusters running version 1.27 and later. This section shows you how to enable this feature in new existing Standard clusters and in Autopilot clusters running versions prior to 1.27.\n### Enable container OS scanning on a new cluster\nCreate a new GKE cluster using the gcloud CLI:\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --workload-vulnerability-scanning=standard\n```\nReplace the following:- ``: the name of your new cluster.\n- ``: the [Compute Engine region or zone](/compute/docs/regions-zones#available) for your   cluster.\n- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Clickadd_box **Create** .\n- In the **GKE Standard** section, click **Configure** .\n- In the navigation pane, click **Security** .\n- In the **Security** section, select the **Vulnerability scan** checkbox.\n- Select the **Basic** option.\n- Configure other options for your cluster and click **Create** when you're ready.\n### Enable container OS scanning on an existing cluster\nUpdate the cluster:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --workload-vulnerability-scanning=standard\n```Replace the following:- ``: the name of your cluster.\n- ``: the [Compute Engine region or zone](/compute/docs/regions-zones#available) of your   cluster.\n- Go to the **Security Posture** page in the Google Cloud console. [Go to Security Posture](https://console.cloud.google.com/kubernetes/security/dashboard) \n- Click the **Settings** tab.\n- In the **Vulnerability scan enabled clusters** section, click **Select clusters** .\n- Select the checkboxes for the clusters that you want to add.\n- In the **Select action** drop-down menu, select **Set to Basic** .\n- Click **Apply** .## Enable advanced vulnerability insights\nAdvanced vulnerability insights enables continuous scanning of your running applications for the following vulnerability types:\n- Container OS vulnerabilities\n- Language package vulnerabilities\nWhen you enable advanced vulnerability insights, the container OS vulnerability scanning capability is automatically enabled and can't be separately disabled.\n### Requirements\n- Ensure that you enabled the Container Analysis API in your project. [Enable Container Analysis API](https://console.cloud.google.com/flows/enableapi?apiid=containeranalysis.googleapis.com) \n### Enable advanced vulnerability insights on a new cluster\nCreate a new GKE cluster using the gcloud CLI:\n```\ngcloud container clusters create-auto CLUSTER_NAME \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --workload-vulnerability-scanning=enterprise\n```\nReplace the following:- ``: the name of your new cluster.\n- ``: the [Compute Engine region or zone](/compute/docs/regions-zones#available) for your   cluster.\n- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Clickadd_box **Create** .\n- In the **GKE Autopilot** section, click **Configure** .\n- In the navigation pane, click **Advanced settings** . If you're creating a Standard cluster, click **Security** instead.\n- In the **Security** section, select the **Vulnerability scan** checkbox.\n- Select the **Advanced** option.\n- Configure other options for your cluster and click **Create** when you're ready.\n### Enable advanced vulnerability insights on an existing cluster\nUpdate the cluster:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --workload-vulnerability-scanning=enterprise\n```Replace the following:- ``: the name of your cluster.\n- ``: the [Compute Engine region or zone](/compute/docs/regions-zones#available) of your   cluster.\n- Go to the **Security Posture** page in the Google Cloud console. [Go to Security Posture](https://console.cloud.google.com/kubernetes/security/dashboard) \n- Click the **Settings** tab.\n- In the **Vulnerability scan enabled clusters** section, click **Select clusters** .\n- Select the checkboxes for the clusters that you want to add.\n- In the **Select action** drop-down menu, select **Set to Advanced** .\n- Click **Apply** .## Deploy a test workload\nThe following example manifests have known vulnerabilities for demonstration purposes. In practice, if you know an application is vulnerable, you probably shouldn't run it.\n- Save the following manifest as `os-vuln-sample.yaml` :```\napiVersion: apps/v1kind: Deploymentmetadata:\u00a0 name: frontendspec:\u00a0 replicas: 1\u00a0 selector:\u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 app: guestbook\u00a0 \u00a0 \u00a0 tier: frontend\u00a0 template:\u00a0 \u00a0 metadata:\u00a0 \u00a0 \u00a0 labels:\u00a0 \u00a0 \u00a0 \u00a0 app: guestbook\u00a0 \u00a0 \u00a0 \u00a0 tier: frontend\u00a0 \u00a0 spec:\u00a0 \u00a0 \u00a0 containers:\u00a0 \u00a0 \u00a0 - name: php-redis\u00a0 \u00a0 \u00a0 \u00a0 image: us-docker.pkg.dev/google-samples/containers/gke/gb-frontend@sha256:dc8de8e0d569d2f828b187528c9317bd6b605c273ac5a282aebe471f630420fc\u00a0 \u00a0 \u00a0 \u00a0 env:\u00a0 \u00a0 \u00a0 \u00a0 - name: GET_HOSTS_FROM\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 value: \"dns\"\u00a0 \u00a0 \u00a0 \u00a0 resources:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 requests:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cpu: 100m\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 memory: 100Mi\u00a0 \u00a0 \u00a0 \u00a0 ports:\u00a0 \u00a0 \u00a0 \u00a0 - containerPort: 80\n```\n- Review the following manifest, which contains a known Maven vulnerability: [  security/language-vulns/maven/deployment.yaml ](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/security/language-vulns/maven/deployment.yaml) [View on GitHub](https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/blob/HEAD/security/language-vulns/maven/deployment.yaml) ```\napiVersion: apps/v1kind: Deploymentmetadata:\u00a0 name: maven-vulnsspec:\u00a0 replicas: 1\u00a0 selector:\u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 app: mavenvulns\u00a0 template:\u00a0 \u00a0 metadata:\u00a0 \u00a0 \u00a0 labels:\u00a0 \u00a0 \u00a0 \u00a0 app: mavenvulns\u00a0 \u00a0 spec:\u00a0 \u00a0 \u00a0 containers:\u00a0 \u00a0 \u00a0 - name: maven-vulns-app\u00a0 \u00a0 \u00a0 \u00a0 image: us-docker.pkg.dev/google-samples/containers/gke/security/maven-vulns\u00a0 \u00a0 \u00a0 \u00a0 # This app listens on port 8080 for web traffic by default.\u00a0 \u00a0 \u00a0 \u00a0 ports:\u00a0 \u00a0 \u00a0 \u00a0 - containerPort: 8080\u00a0 \u00a0 \u00a0 \u00a0 env:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 - name: PORT\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 value: \"8080\"\u00a0 \u00a0 \u00a0 \u00a0 resources:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 requests:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 memory: \"1Gi\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cpu: \"500m\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ephemeral-storage: \"1Gi\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 limits:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 memory: \"1Gi\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cpu: \"500m\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ephemeral-storage: \"1Gi\"\n```\n- Optionally, get credentials for your cluster:```\ngcloud container clusters get-credentials CLUSTER_NAME \\\u00a0 \u00a0 --region=COMPUTE_REGION\n```\n- Deploy the applications to your cluster:```\nkubectl apply -f os-vuln-sample.yamlkubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/kubernetes-engine-samples/main/security/language-vulns/maven/deployment.yaml\n```\nTo test other vulnerabilities, try deploying earlier versions of images such as `nginx` in staging environments.\n## View and action the results\nThe initial scan takes at least 15 minutes to return results, depending on how many workloads are scanned. GKE displays the results on the **security posture dashboard** and automatically adds entries to Logging.\n### View results\nTo see an overview of discovered concerns across your project's clusters and workloads, do the following:\n- Go to the **Security Posture** page in the Google Cloud console. [Go to Security Posture](https://console.cloud.google.com/kubernetes/security/dashboard) \n- Click the **Concerns** tab.\n- In the **Filter concerns** pane, in the **Concern type** section, select the **Vulnerability** checkbox.\n### View concern details and recommendations\nTo view detailed information about a specific vulnerability, click the row containing that concern.\nThe **Vulnerability Concern** pane shows the following information:\n- **Description:** a description of the concern including a CVE number if applicable and a detailed description of the vulnerability and its potential impact.\n- **Recommended action:** actions that you can take to address the vulnerability, such as fixed package versions and where to apply the fix.\n### View logs for discovered concerns\nGKE adds entries to Logging for each discovered concern.\n- Go to the **Logs Explorer** in the Google Cloud console. [Goto Logs Explorer](https://console.cloud.google.com/logs/query) \n- In the **Query** field, specify the following query:```\nresource.type=\"k8s_cluster\"\njsonPayload.@type=\"type.googleapis.com/cloud.kubernetes.security.containersecurity_logging.Finding\"\njsonPayload.type=\"FINDING_TYPE_VULNERABILITY\"\n```\n- Click **Run query** .## Clean up\n- Delete the sample workload that you deployed:```\nkubectl delete deployment frontend\n```\n- Optionally, delete the cluster that you used:```\ngcloud container clusters delete CLUSTER_NAME \\\u00a0 \u00a0 --region=COMPUTE_REGION\n```## Disable workload vulnerability scanning\nYou can disable workload vulnerability scanning using either the gcloud CLI or the Google Cloud console.\nRun the following command:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --region=LOCATION \\\u00a0 \u00a0 --workload-vulnerability-scanning=disabled\n```\nReplace the following:- ``: the name of your cluster.\n- ``: the [Compute Engine region or zone](/compute/docs/regions-zones#available) for your   cluster.\n- Go to the **Security Posture** page in the Google Cloud console. [Go to Security Posture](https://console.cloud.google.com/kubernetes/security/dashboard) \n- Click the **Settings** tab.\n- In the **Vulnerability scan enabled clusters** section, click **Select clusters** .\n- Select the checkboxes for the clusters that you want to remove.\n- In the **Select action** drop-down menu, select **Set to Disabled** .\n- Click **Apply** .## What's next\n- [Learn more about the security posture dashboard](/kubernetes-engine/docs/concepts/about-security-posture-dashboard) .\n- [Learn how to scan your workloads for configuration concerns](/kubernetes-engine/docs/how-to/protect-workload-configuration) .", "guide": "Google Kubernetes Engine (GKE)"}