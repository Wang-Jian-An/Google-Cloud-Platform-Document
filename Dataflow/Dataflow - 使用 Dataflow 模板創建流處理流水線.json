{"title": "Dataflow - \u4f7f\u7528 Dataflow \u6a21\u677f\u5275\u5efa\u6d41\u8655\u7406\u6d41\u6c34\u7dda", "url": "https://cloud.google.com/dataflow/docs/quickstarts/create-streaming-pipeline-template?hl=zh-cn", "abstract": "# Dataflow - \u4f7f\u7528 Dataflow \u6a21\u677f\u5275\u5efa\u6d41\u8655\u7406\u6d41\u6c34\u7dda\n# \u4f7f\u7528 Dataflow \u6a21\u677f\u5275\u5efa\u6d41\u8655\u7406\u6d41\u6c34\u7dda\n\u672c\u5feb\u901f\u5165\u9580\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528 Google \u63d0\u4f9b\u7684 Dataflow \u6a21\u677f\u5275\u5efa\u6d41\u8655\u7406\u6d41\u6c34\u7dda\u3002\u5177\u9ad4\u4f86\u8aaa\uff0c\u672c\u5feb\u901f\u5165\u9580\u6703\u4ee5 **Pub/Sub to BigQuery** \u6a21\u677f\u7232\u4f8b\u3002\nPub/Sub to BigQuery \u6a21\u677f\u662f\u4e00\u7a2e\u6d41\u8655\u7406\u6d41\u6c34\u7dda\uff0c\u53ef\u5f9e Pub/Sub \u4e3b\u984c\u8b80\u53d6 JSON \u683c\u5f0f\u7684\u6d88\u606f\u4e26\u5c07\u5176\u5beb\u5165 BigQuery \u8868\u4e2d\u3002\u5982\u9700\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u76f4\u63a5\u9075\u5faa\u6709\u95dc\u6b64\u4efb\u52d9\u7684\u5206\u6b65\u6307\u5c0e\uff0c\u8acb\u9ede\u64ca **\u64cd\u4f5c\u6f14\u793a** \uff1a\n [\u64cd\u4f5c\u6f14\u793a](https://console.cloud.google.com/home/dashboard?tutorial=dataflow--quickstart-templates&hl=zh-cn) ", "content": "## \u6e96\u5099\u5de5\u4f5c- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5275\u5efa Cloud Storage \u5b58\u5132\u6876\uff1a- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u9032\u5165 Cloud Storage **\u5b58\u5132\u6876** \u9801\u9762\u3002 [\u9032\u5165\u201c\u5b58\u5132\u6876\u201d\u9801\u9762](https://console.cloud.google.com/storage/browser?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa\u5b58\u5132\u5206\u5340** \u3002\n- \u5728 **\u5275\u5efa\u5b58\u5132\u5206\u5340** \u9801\u9762\u4e0a\uff0c\u8f38\u5165\u60a8\u7684\u5b58\u5132\u5206\u5340\u4fe1\u606f\u3002\u8981\u8f49\u5230\u4e0b\u4e00\u6b65\uff0c\u8acb\u9ede\u64ca **\u7e7c\u7e8c** \u3002- \u5728 **\u6307\u5b9a\u5b58\u5132\u5206\u5340\u7684\u540d\u7a31** \u4e2d\uff0c\u8f38\u5165\u552f\u4e00\u7684\u5b58\u5132\u5206\u5340\u540d\u7a31\u3002\u8acb\u52ff\u5728\u5b58\u5132\u5206\u5340\u540d\u7a31\u4e2d\u6dfb\u52a0\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u7232\u5b58\u5132\u5206\u5340\u547d\u540d\u7a7a\u9593\u662f\u5168\u5c40\u6027\u7684\uff0c\u516c\u958b\u53ef\u898b\u3002\n- \u5c0d\u65bc **\u9078\u64c7\u6578\u64da\u5b58\u5132\u4f4d\u7f6e** \uff0c\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u9078\u64c7 **\u4f4d\u7f6e\u985e\u578b** \u9078\u9805\u3002\n- \u9078\u64c7 **\u4f4d\u7f6e** \u9078\u9805\u3002\n- \u5c0d\u65bc **\u7232\u6578\u64da\u9078\u64c7\u4e00\u500b\u9ed8\u8a8d\u5b58\u5132\u985e\u5225** \uff0c\u9078\u64c7\u4ee5\u4e0b\u9805\uff1a **Standard** \u3002\n- \u5c0d\u65bc **\u9078\u64c7\u5982\u4f55\u63a7\u5236\u5c0d\u8c61\u7684\u8a2a\u554f\u6b0a\u9650** \uff0c\u8acb\u9078\u64c7 **\u8a2a\u554f\u6b0a\u9650\u63a7\u5236** \u9078\u9805\u3002\n- \u5c0d\u65bc **\u9ad8\u7d1a\u8a2d\u7f6e\uff08\u53ef\u9078\uff09** \uff0c\u8acb\u6307\u5b9a [\u52a0\u5bc6\u65b9\u6cd5](https://cloud.google.com/storage/docs/encryption?hl=zh-cn) \u3001 [\u4fdd\u7559\u653f\u7b56](https://cloud.google.com/storage/docs/bucket-lock?hl=zh-cn) \u6216 [\u5b58\u5132\u5206\u5340\u6a19\u7c64](https://cloud.google.com/storage/docs/tags-and-labels?hl=zh-cn#bucket-labels) \u3002\n- \u9ede\u64ca **\u5275\u5efa** \u3002- \u5728\u5f8c\u7e8c\u90e8\u5206\u4e2d\u6839\u64da\u9700\u8981\u8907\u88fd\u4ee5\u4e0b\u5167\u5bb9\uff1a- \u60a8\u7684 Cloud Storage \u5b58\u5132\u6876\u540d\u7a31\u3002\n- \u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\u5982\u9700\u67e5\u627e\u6b64 ID\uff0c\u8acb\u53c3\u95b1 [\u8b58\u5225\u9805\u76ee](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifying_projects) \u3002\n- \u7232\u5b8c\u6210\u672c\u5feb\u901f\u5165\u9580\u4e2d\u7684\u6b65\u9a5f\uff0c\u60a8\u7684\u7528\u6236\u8cec\u865f\u5fc5\u9808\u5177\u6709 [Dataflow Admin \u89d2\u8272](https://cloud.google.com/dataflow/docs/concepts/access-control?hl=zh-cn#roles) \u548c [Service Account User](https://cloud.google.com/iam/docs/service-accounts-actas?hl=zh-cn) \u89d2\u8272\u3002 [Compute Engine \u9ed8\u8a8d\u670d\u52d9\u8cec\u865f](https://cloud.google.com/compute/docs/access/service-accounts?hl=zh-cn#default_service_account) \u5fc5\u9808\u5177\u6709 [Dataflow Worker \u89d2\u8272](https://cloud.google.com/dataflow/docs/concepts/access-control?hl=zh-cn#roles) \u3002\u5982\u9700\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u6dfb\u52a0\u6240\u9700\u7684\u89d2\u8272\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u8f49\u5230 **IAM** \u9801\u9762\u3002 [\u8f49\u5230 IAM](https://console.cloud.google.com/projectselector/iam-admin/iam?supportedpurview=project%2Cfolder%2CorganizationId&hl=zh-cn) \n- \u9078\u64c7\u60a8\u7684\u9805\u76ee\u3002\n- \u5728\u7528\u6236\u8cec\u865f\u6240\u5728\u7684\u884c\u4e2d\uff0c\u9ede\u64caedit **\u4fee\u6539\u4e3b\u8cec\u865f** \uff0c\u7136\u5f8c\u9ede\u64caadd **\u6dfb\u52a0\u5176\u4ed6\u89d2\u8272** \u3002\n- \u5728\u4e0b\u62c9\u5217\u8868\u4e2d\uff0c\u9078\u64c7 **Dataflow Admin** \u89d2\u8272\u3002\n- \u5c0d **Service Account User** \u89d2\u8272\u91cd\u8907\u4e0a\u8ff0\u6b65\u9a5f\uff0c\u7136\u5f8c\u9ede\u64ca **\u4fdd\u5b58** \u3002\n- \u5728 Compute Engine \u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u6240\u5728\u7684\u884c\u4e2d\uff0c\u9ede\u64caedit **\u4fee\u6539\u4e3b\u8cec\u865f** \uff0c\u7136\u5f8c\u9ede\u64caadd **\u6dfb\u52a0\u5176\u4ed6\u89d2\u8272** \u3002\n- \u5728\u4e0b\u62c9\u5217\u8868\u4e2d\uff0c\u9078\u64c7 **Dataflow Worker** \u89d2\u8272\u3002\n- \u5c0d **Pub/Sub Editor** \u548c **BigQuery Data Editor** \u89d2\u8272\u91cd\u8907\u4e0a\u8ff0\u6b65\u9a5f\uff0c\u7136\u5f8c\u9ede\u64ca **\u4fdd\u5b58** \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u6388\u4e88\u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528\u63a7\u5236\u6aaf\u6388\u4e88 IAM \u89d2\u8272](https://cloud.google.com/iam/docs/grant-role-console?hl=zh-cn) \u3002\n- \u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u6bcf\u500b\u65b0\u9805\u76ee\u8d77\u521d\u90fd\u6709\u4e00\u500b [\u9ed8\u8a8d\u7db2\u7d61](https://cloud.google.com/vpc/docs/vpc?hl=zh-cn#default-network) \u3002 \u5982\u679c\u60a8\u7684\u9805\u76ee\u7684\u9ed8\u8a8d\u7db2\u7d61 [\u5df2\u505c\u7528](https://cloud.google.com/vpc/docs/vpc?hl=zh-cn#org-policies) \u6216\u8005\u5df2\u88ab\u522a\u9664\uff0c\u5247\u60a8\u9700\u8981\u5728\u81ea\u5df1\u7684\u7528\u6236\u8cec\u865f\u5177\u5099 [Compute Network User \u89d2\u8272](https://cloud.google.com/compute/docs/access/iam?hl=zh-cn#compute.networkUser) (`roles/compute.networkUser`) \u7684\u9805\u76ee\u4e2d\u64c1\u6709\u7db2\u7d61\u3002\n## \u5275\u5efa BigQuery \u6578\u64da\u96c6\u548c\u8868\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\uff0c\u7232\u60a8\u7684 Pub/Sub \u4e3b\u984c\u5275\u5efa\u5177\u6709\u9069\u7576\u67b6\u69cb\u7684 BigQuery \u6578\u64da\u96c6\u548c\u8868\u3002\n\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u6578\u64da\u96c6\u7684\u540d\u7a31\u7232 `taxirides` \uff0c\u8868\u7684\u540d\u7a31\u7232 `realtime` \u3002\u5982\u9700\u5275\u5efa\u6b64\u6578\u64da\u96c6\u548c\u8868\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a- \u8f49\u5230 **BigQuery** \u9801\u9762\u3002 [\u524d\u5f80 BigQuery](https://console.cloud.google.com/bigquery?hl=zh-cn) \n- \u5728 **\u63a2\u7d22\u5668** \u9762\u677f\u4e2d\uff0c\u9ede\u64ca\u60a8\u8981\u5275\u5efa\u6578\u64da\u96c6\u7684\u9805\u76ee\u65c1\u908a\u7684more_vert **\u67e5\u770b\u64cd\u4f5c** \uff0c\u7136\u5f8c\u9ede\u64ca **\u5275\u5efa\u6578\u64da\u96c6** \u3002 **\u6ce8\u610f** \uff1a\u9ed8\u8a8d\u9ad4\u9a57\u662f [\u9810\u89bd\u7248](https://cloud.google.com/products?hl=zh-cn#product-launch-stages) Google Cloud \u63a7\u5236\u6aaf\u3002\u5982\u679c\u60a8\u9ede\u64ca **\u96b1\u85cf\u9810\u89bd\u7248\u529f\u80fd** (Hide preview features) \u4ee5\u524d\u5f80 Google Cloud \u63a7\u5236\u6aaf\uff0c\u5247\u6539\u7232\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a\u5728\u5c0e\u822a\u9762\u677f\u7684 **\u8cc7\u6e90** \u90e8\u5206\u4e2d\uff0c\u9078\u64c7\u60a8\u7684\u9805\u76ee\u3002\n- \u5728 **\u5275\u5efa\u6578\u64da\u96c6** \u9762\u677f\u4e0a\uff0c\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a\n- \u5728 **\u6578\u64da\u96c6 ID** \u90e8\u5206\uff0c\u8f38\u5165`taxirides`\u3002  \u6bcf\u500b Google Cloud \u9805\u76ee\u7684\u6578\u64da\u96c6 ID \u90fd\u662f\u552f\u4e00\u7684\u3002\n- \u5c0d\u65bc **\u4f4d\u7f6e\u985e\u578b** \uff0c\u8acb\u9078\u64c7 **\u591a\u5340\u57df** \uff0c\u7136\u5f8c\u9078\u64c7 **\u7f8e\u570b\uff08\u7f8e\u570b\u7684\u591a\u500b\u5340\u57df\uff09** \u3002\u516c\u5171\u6578\u64da\u96c6\u5b58\u5132\u5728`US`\u591a\u5340\u57df [\u4f4d\u7f6e](https://cloud.google.com/bigquery/docs/dataset-locations?hl=zh-cn) \u3002\u7232\u7c21\u55ae\u8d77\u898b\uff0c\u8acb\u5c07\u6578\u64da\u96c6\u653e\u5728\u540c\u4e00\u4f4d\u7f6e\u3002\n- \u4fdd\u7559\u5176\u4ed6\u9ed8\u8a8d\u8a2d\u7f6e\uff0c\u7136\u5f8c\u9ede\u64ca **\u5275\u5efa\u6578\u64da\u96c6** \u3002\n- \u5728\u9762\u677f\u4e2d\uff0c\u5c55\u958b\u60a8\u7684\u9805\u76ee\u3002\n- \u5728`taxirides`\u6578\u64da\u96c6\u65c1\u908a\uff0c\u9ede\u64camore_vert **\u67e5\u770b\u64cd\u4f5c** \uff0c\u7136\u5f8c\u9ede\u64ca **\u5275\u5efa\u8868** \u3002 **\u6ce8\u610f** \uff1a\u9ed8\u8a8d\u9ad4\u9a57\u662f [\u9810\u89bd\u7248](https://cloud.google.com/products?hl=zh-cn#product-launch-stages) Google Cloud \u63a7\u5236\u6aaf\u3002\u5982\u679c\u60a8\u9ede\u64ca **\u96b1\u85cf\u9810\u89bd\u7248\u529f\u80fd** (Hide preview features) \u4ee5\u524d\u5f80 Google Cloud \u63a7\u5236\u6aaf\uff0c\u5247\u6539\u7232\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a\u5728\u5c0e\u822a\u9762\u677f\u7684 **\u8cc7\u6e90** \u90e8\u5206\u4e2d\uff0c\u9078\u64c7\u60a8\u5275\u5efa\u7684`taxirides`\u6578\u64da\u96c6\u3002\n- \u5728 **\u5275\u5efa\u8868** \u9762\u677f\u4e0a\uff0c\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a\n- \u5728 **\u4f86\u6e90** \u90e8\u5206\uff0c\u7232 **\u57fa\u65bc\u4ee5\u4e0b\u6578\u64da\u5275\u5efa\u8868** \u9078\u64c7 **\u7a7a\u8868** \u3002\n- \u5728 **\u76ee\u6a19\u4f4d\u7f6e** \u90e8\u5206\u7684 **\u8868** \u4e2d\uff0c\u8f38\u5165`realtime`\u3002\n- \u5728 **\u67b6\u69cb** \u90e8\u5206\uff0c\u9ede\u64ca **\u4ee5\u6587\u5b57\u5f62\u5f0f\u4fee\u6539** \u958b\u95dc\uff0c\u4e26\u5c07\u4ee5\u4e0b\u67b6\u69cb\u5b9a\u7fa9\u7c98\u8cbc\u5230\u76f8\u61c9\u7684\u6846\u4e2d\uff1a```\nride_id:string,point_idx:integer,latitude:float,longitude:float,timestamp:timestamp,meter_reading:float,meter_increment:float,ride_status:string,passenger_count:integer\n```\n- \u5728 **\u5206\u5340\u548c\u96c6\u7fa3\u8a2d\u7f6e** \u90e8\u5206\u4e2d\uff0c\u5c0d\u65bc **\u5206\u5340** \uff0c\u9078\u64c7 **\u6642\u9593\u6233** \u5b57\u6bb5\u3002\n- \u4fdd\u7559\u5176\u4ed6\u9ed8\u8a8d\u8a2d\u7f6e\uff0c\u7136\u5f8c\u9ede\u64ca **\u5275\u5efa\u8868** \u3002\n## \u904b\u884c\u6d41\u6c34\u7dda\u4f7f\u7528 Google \u63d0\u4f9b\u7684 [Pub/Sub to BigQuery](https://cloud.google.com/dataflow/docs/guides/templates/provided/pubsub-to-bigquery?hl=zh-cn) \u6a21\u677f\u904b\u884c\u6d41\u8655\u7406\u6d41\u6c34\u7dda\u3002\u6d41\u6c34\u7dda\u6703\u5f9e\u8a72\u8f38\u5165\u4e3b\u984c\u7372\u53d6\u50b3\u5165\u6578\u64da\u3002\n- \u8f49\u5230 Dataflow **\u4f5c\u696d** \u9801\u9762\u3002 [\u8f49\u5230\u4f5c\u696d](https://console.cloud.google.com/dataflow/jobs?hl=zh-cn) \n- \u9ede\u64ca\u3002\n- \u8f38\u5165`taxi-data`\u4f5c\u7232 Dataflow \u4f5c\u696d\u7684 **\u540d\u7a31** \u3002\n- \u5c0d\u65bc **Dataflow \u6a21\u677f** \uff0c\u9078\u64c7 **Pub/Sub to BigQuery** \u6a21\u677f\u3002\n- \u5c0d\u65bc **BigQuery \u8f38\u51fa\u8868** \uff0c\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nPROJECT_ID:taxirides.realtime\n```\u5c07 `` \u66ff\u63db\u7232\u5275\u5efa\u4e86 BigQuery \u6578\u64da\u96c6\u7684\u9805\u76ee\u7684 ID\u3002\n- \u5c55\u958b **\u53ef\u9078\u53c3\u6578** \u3002\n- \u5728 **\u8f38\u5165 Pub/Sub \u4e3b\u984c** \u90e8\u5206\uff0c\u9ede\u64ca **\u624b\u52d5\u8f38\u5165\u4e3b\u984c** \u3002\n- \u5728\u5c0d\u8a71\u6846\u4e2d\uff0c\u7232 **\u4e3b\u984c\u540d\u7a31** \u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff0c\u7136\u5f8c\u9ede\u64ca **\u4fdd\u5b58** \uff1a```\nprojects/pubsub-public-data/topics/taxirides-realtime\n```\u6b64\u516c\u958b\u63d0\u4f9b\u7684 Pub/Sub \u4e3b\u984c\u57fa\u65bc [\u7d10\u7d04\u5e02\u51fa\u79df\u8eca\u548c\u8c6a\u83ef\u8f4e\u8eca\u59d4\u54e1\u6703\u7684\u958b\u653e\u6578\u64da\u96c6](https://data.cityofnewyork.us/) \u3002\u4ee5\u4e0b\u662f\u4f86\u81ea\u6b64\u4e3b\u984c\u7684 JSON \u683c\u5f0f\u7684\u793a\u4f8b\u6d88\u606f\uff1a```\n{\u00a0 \"ride_id\": \"19c41fc4-e362-4be5-9d06-435a7dc9ba8e\",\u00a0 \"point_idx\": 217,\u00a0 \"latitude\": 40.75399,\u00a0 \"longitude\": -73.96302,\u00a0 \"timestamp\": \"2021-03-08T02:29:09.66644-05:00\",\u00a0 \"meter_reading\": 6.293821,\u00a0 \"meter_increment\": 0.029003782,\u00a0 \"ride_status\": \"enroute\",\u00a0 \"passenger_count\": 1}\n```\n- \u5728 **\u81e8\u6642\u4f4d\u7f6e** \u90e8\u5206\uff0c\u8f38\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a```\ngs://BUCKET_NAME/temp/\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u7684 Cloud Storage \u5b58\u5132\u6876\u7684\u540d\u7a31\u3002 `temp` \u6587\u4ef6\u593e\u7528\u65bc\u5b58\u5132\u81e8\u6642\u6587\u4ef6\uff0c\u5982\u66ab\u5b58\u7684\u6d41\u6c34\u7dda\u4f5c\u696d\u3002\n- \u5982\u679c\u60a8\u7684\u9805\u76ee\u6c92\u6709 [\u9ed8\u8a8d\u7db2\u7d61](https://cloud.google.com/vpc/docs/vpc?hl=zh-cn#default-network) \uff0c\u8acb\u8f38\u5165 **\u7db2\u7d61** \u548c **\u5b50\u7db2** \u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6307\u5b9a\u7db2\u7d61\u548c\u5b50\u7db2](https://cloud.google.com/dataflow/docs/guides/specifying-networks?hl=zh-cn#specifying_a_network_and_a_subnetwork) \u3002 **\u6ce8\u610f** \uff1a\u9664\u975e\u901a\u904e`network`\u9078\u9805\u6307\u5b9a\uff0c\u5426\u5247 Dataflow \u904b\u884c\u7a0b\u5e8f\u5c07\u5728`default`Virtual Private Cloud \u7db2\u7d61\u4e2d\u904b\u884c\u4f5c\u696d\u3002\u5982\u679c\u60a8\u7684\u9805\u76ee\u6c92\u6709\u9ed8\u8a8d\u7db2\u7d61\uff0c\u4e26\u4e14\u60a8\u672a\u6307\u5b9a\u7db2\u7d61\uff0c\u5247\u6703\u767c\u751f\u932f\u8aa4\u3002\u5982\u679c\u9ed8\u8a8d\u7db2\u7d61\u5df2\u88ab\u522a\u9664\uff0c\u6216\u8005 [\u7d44\u7e54\u653f\u7b56\u9650\u5236\u689d\u4ef6](https://cloud.google.com/vpc/docs/vpc?hl=zh-cn#org-policies) \u963b\u6b62\u5275\u5efa\u9ed8\u8a8d\u7db2\u7d61\uff0c\u5247\u60a8\u53ef\u80fd\u6c92\u6709\u9ed8\u8a8d\u7db2\u7d61\u3002\n- \u9ede\u64ca **\u904b\u884c\u4f5c\u696d** \u3002\n## \u67e5\u770b\u7d50\u679c\n\u5982\u9700\u67e5\u770b\u5beb\u5165\n`realtime`\n\u8868\u7684\u6578\u64da\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a\n- \u8f49\u5230 **BigQuery** \u9801\u9762\u3002 [\u524d\u5f80 BigQuery](https://console.cloud.google.com/bigquery?hl=zh-cn) \n- \u9ede\u64ca add_box **\u7de8\u5beb\u65b0\u67e5\u8a62** \u3002\u96a8\u5373\u6703\u6253\u958b\u4e00\u500b\u65b0\u7684 **\u7de8\u8f2f\u5668** \u6a19\u7c64\u9801\u3002```\nSELECT * FROM `PROJECT_ID.taxirides.realtime`WHERE `timestamp` > TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 DAY)LIMIT 1000\n```\u5c07 `` \u66ff\u63db\u7232\u5275\u5efa\u4e86 BigQuery \u6578\u64da\u96c6\u7684\u9805\u76ee\u7684 ID\u3002\u6578\u64da\u6700\u591a\u53ef\u80fd\u9700\u8981\u4e00\u5206\u9418\u7e94\u6703\u958b\u59cb\u986f\u793a\u5728\u8868\u4e2d\u3002\n- \u9ede\u64ca **\u904b\u884c** \u3002\u67e5\u8a62\u5c07\u8fd4\u56de\u5728\u904e\u53bb 24 \u5c0f\u6642\u5167\u6dfb\u52a0\u5230\u8868\u4e2d\u7684\u884c\u3002\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528\u6a19\u6e96 SQL \u904b\u884c\u67e5\u8a62\u3002\n## \u6e05\u7406\u7232\u907f\u514d\u56e0\u672c\u9801\u4e2d\u4f7f\u7528\u7684\u8cc7\u6e90\u5c0e\u81f4\u60a8\u7684 Google Cloud \u8cec\u865f\u7522\u751f\u8cbb\u7528\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\u3002\n### \u522a\u9664\u9805\u76ee\n\u907f\u514d\u7522\u751f\u8cbb\u7528\u7684\u6700\u7c21\u55ae\u65b9\u6cd5\u662f\u522a\u9664\u60a8\u7232\u672c\u5feb\u901f\u5165\u9580\u5275\u5efa\u7684 Google Cloud \u9805\u76ee\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- **\u8b66\u544a** \uff1a\u522a\u9664\u9805\u76ee\u6703\u7522\u751f\u4ee5\u4e0b\u5f71\u97ff- **\u9805\u76ee\u4e2d\u7684\u6240\u6709\u5167\u5bb9\u90fd\u6703\u88ab\u522a\u9664\u3002** \u5982\u679c\u60a8\u5c07\u73fe\u6709\u9805\u76ee\u7528\u65bc\u672c\u6587\u6a94\u4e2d\u7684\u4efb\u52d9\uff0c\u5247\u522a\u9664\u8a72\u9805\u76ee\u5f8c\uff0c\u9084\u5c07\u522a\u9664\u60a8\u5df2\u5728\u8a72\u9805\u76ee\u4e2d\u5b8c\u6210\u7684\u4efb\u4f55\u5176\u4ed6\u5de5\u4f5c\u3002\n- **\u81ea\u5b9a\u7fa9\u9805\u76ee ID \u4e1f\u5931\u3002** \u5275\u5efa\u6b64\u9805\u76ee\u6642\uff0c\u60a8\u53ef\u80fd\u5275\u5efa\u4e86\u8981\u5728\u5c07\u4f86\u4f7f\u7528\u7684\u81ea\u5b9a\u7fa9\u9805\u76ee ID\u3002\u8981\u4fdd\u7559\u4f7f\u7528\u8a72\u9805\u76ee ID \u7684\u7db2\u5740\uff08\u4f8b\u5982`appspot.com`\u7db2\u5740\uff09\uff0c\u8acb\u522a\u9664\u9805\u76ee\u5167\u7684\u6240\u9078\u8cc7\u6e90\uff0c\u800c\u4e0d\u662f\u522a\u9664\u6574\u500b\u9805\u76ee\u3002\n\u5982\u679c\u60a8\u6253\u7b97\u63a2\u7d22\u591a\u500b\u67b6\u69cb\u3001\u6559\u7a0b\u6216\u5feb\u901f\u5165\u9580\uff0c\u5247\u91cd\u8907\u4f7f\u7528\u9805\u76ee\u53ef\u4ee5\u5e6b\u52a9\u60a8\u907f\u514d\u8d85\u51fa\u9805\u76ee\u914d\u984d\u9650\u5236\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u9032\u5165 **\u7ba1\u7406\u8cc7\u6e90** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u7ba1\u7406\u8cc7\u6e90\u201d](https://console.cloud.google.com/iam-admin/projects?hl=zh-cn) \n- \u5728\u9805\u76ee\u5217\u8868\u4e2d\uff0c\u9078\u64c7\u8981\u522a\u9664\u7684\u9805\u76ee\uff0c\u7136\u5f8c\u9ede\u64ca **\u522a\u9664** \u3002\n- \u5728\u5c0d\u8a71\u6846\u4e2d\u8f38\u5165\u9805\u76ee ID\uff0c\u7136\u5f8c\u9ede\u64ca **\u95dc\u9589** \u4ee5\u522a\u9664\u9805\u76ee\u3002\n### \u9010\u500b\u522a\u9664\u8cc7\u6e90\u5982\u679c\u60a8\u5e0c\u671b\u4fdd\u7559\u672c\u5feb\u901f\u5165\u9580\u4e2d\u4f7f\u7528\u7684 Google Cloud \u9805\u76ee\uff0c\u8acb\u9010\u500b\u522a\u9664\u8cc7\u6e90\uff1a- \u8f49\u5230 Dataflow **\u4f5c\u696d** \u9801\u9762\u3002 [\u8f49\u5230\u4f5c\u696d](https://console.cloud.google.com/dataflow/jobs?hl=zh-cn) \n- \u5f9e\u4f5c\u696d\u5217\u8868\u4e2d\u9078\u64c7\u60a8\u7684\u6d41\u8655\u7406\u4f5c\u696d\u3002\n- \u5728\u5c0e\u822a\u4e2d\uff0c\u9ede\u64ca **\u505c\u6b62** \u3002\n- \u5728 **\u505c\u6b62\u4f5c\u696d** \u5c0d\u8a71\u6846\u4e2d\uff0c [\u53d6\u6d88](https://cloud.google.com/dataflow/docs/guides/stopping-a-pipeline?hl=zh-cn#cancel) \u6216 [\u6392\u7a7a](https://cloud.google.com/dataflow/docs/guides/stopping-a-pipeline?hl=zh-cn#drain) \u60a8\u7684\u6d41\u6c34\u7dda\uff0c\u7136\u5f8c\u9ede\u64ca **\u505c\u6b62\u4f5c\u696d** \u3002\n- \u8f49\u5230 **BigQuery** \u9801\u9762\u3002 [\u524d\u5f80 BigQuery](https://console.cloud.google.com/bigquery?hl=zh-cn) \n- \u5728 **\u63a2\u7d22\u5668** \u9762\u677f\u4e2d\uff0c\u5c55\u958b\u60a8\u7684\u9805\u76ee\u3002\n- \u5728\u8981\u522a\u9664\u7684\u6578\u64da\u96c6\u65c1\u908a\uff0c\u9ede\u64camore_vert **\u67e5\u770b\u64cd\u4f5c** \uff0c\u7136\u5f8c\u9ede\u64ca **\u6253\u958b** \u3002\n- \u5728\u8a73\u7d30\u4fe1\u606f\u9762\u677f\u4e2d\uff0c\u9ede\u64ca **\u522a\u9664\u6578\u64da\u96c6** \uff0c\u7136\u5f8c\u6309\u7167\u76f8\u61c9\u8aaa\u660e\u64cd\u4f5c\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 Cloud Storage **\u5b58\u5132\u5206\u5340** \u9801\u9762\u3002 [\u9032\u5165\u201c\u5b58\u5132\u6876\u201d](https://console.cloud.google.com/storage/browser?hl=zh-cn) \n- \u9ede\u64ca\u8981\u522a\u9664\u7684\u5b58\u5132\u6876\u5c0d\u61c9\u7684\u8907\u9078\u6846\u3002\n- \u5982\u9700\u522a\u9664\u5b58\u5132\u6876\uff0c\u8acb\u9ede\u64cadelete **\u522a\u9664** \uff0c\u7136\u5f8c\u6309\u7167\u8aaa\u660e\u64cd\u4f5c\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [Dataflow \u6a21\u677f\u6982\u89bd](https://cloud.google.com/dataflow/docs/templates/overview?hl=zh-cn) \n- [\u5275\u5efa\u7d93\u5178\u6a21\u677f](https://cloud.google.com/dataflow/docs/templates/creating-templates?hl=zh-cn) \n- [\u904b\u884c\u7d93\u5178\u6a21\u677f](https://cloud.google.com/dataflow/docs/templates/running-templates?hl=zh-cn) \n- [Google \u63d0\u4f9b\u7684\u6a21\u677f](https://cloud.google.com/dataflow/docs/templates/provided-templates?hl=zh-cn)", "guide": "Dataflow"}