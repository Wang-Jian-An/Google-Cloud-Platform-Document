{"title": "Dataflow - \u8a2d\u8a08\u6d41\u6c34\u7dda", "url": "https://cloud.google.com/dataflow/docs/design-considerations?hl=zh-cn", "abstract": "# Dataflow - \u8a2d\u8a08\u6d41\u6c34\u7dda\n\u672c\u6587\u6a94\u91cd\u9ede\u4ecb\u7d39\u4e86\u5728\u8a2d\u8a08\u6d41\u6c34\u7dda\u6642\u9700\u8981\u8003\u616e\u7684\u4e00\u4e9b\u4e8b\u9805\u3002\n", "content": "## \u9700\u8981\u601d\u8003\u7684\u554f\u984c\n\u5728\u8a2d\u8a08\u6d41\u6c34\u7dda\u6642\uff0c\u8acb\u8003\u616e\u4ee5\u4e0b\u554f\u984c\uff1a\n- \u6d41\u6c34\u7dda\u7684\u8f38\u5165\u6578\u64da\u5b58\u5132\u5728\u4f55\u8655\uff1f\u60a8\u6709\u591a\u5c11\u7d44\u8f38\u5165\u6578\u64da\uff1f\n- \u60a8\u7684\u6578\u64da\u662f\u4ec0\u9ebc\u6a23\u7684\uff1f\n- \u60a8\u5e0c\u671b\u5982\u4f55\u8655\u7406\u6578\u64da\uff1f\n- \u6d41\u6c34\u7dda\u7684\u8f38\u51fa\u6578\u64da\u61c9\u50b3\u8f38\u5230\u4f55\u8655\uff1f\n- \u60a8\u7684 Dataflow \u4f5c\u696d\u662f\u5426\u4f7f\u7528 [Assured Workloads](https://cloud.google.com/assured-workloads/docs/concept-platform-controls?hl=zh-cn) \uff1f## \u8003\u616e\u4f7f\u7528 Dataflow \u6a21\u677f\n\u9664\u4e86\u69cb\u5efa\u6d41\u6c34\u7dda\uff08\u901a\u904e\u7de8\u5beb Apache Beam \u4ee3\u78bc\uff09\u4e4b\u5916\uff0c\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 [\u6a21\u677f](https://cloud.google.com/dataflow/docs/concepts/dataflow-templates?hl=zh-cn) \u3002\u6a21\u677f\u5141\u8a31\u91cd\u8907\u4f7f\u7528\u3002\u6a21\u677f\u53ef\u8b93\u60a8\u901a\u904e\u66f4\u6539\u7279\u5b9a\u7684\u6d41\u6c34\u7dda\u53c3\u6578\u4f86\u81ea\u5b9a\u7fa9\u6bcf\u9805\u4f5c\u696d\u3002\u7136\u5f8c\uff0c\u60a8\u63d0\u4f9b\u6b0a\u9650\u7684\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u4f7f\u7528\u6a21\u677f\u4f86\u90e8\u7f72\u6d41\u6c34\u7dda\u3002\n\u4f8b\u5982\uff0c\u958b\u767c\u8005\u53ef\u4ee5\u5f9e\u6a21\u677f\u5275\u5efa\u4f5c\u696d\uff0c\u7d44\u7e54\u4e2d\u7684\u6578\u64da\u79d1\u5b78\u5bb6\u4e4b\u5f8c\u53ef\u4ee5\u90e8\u7f72\u8a72\u6a21\u677f\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u591a\u7a2e [Google \u63d0\u4f9b\u7684\u6a21\u677f](https://cloud.google.com/dataflow/docs/guides/templates/provided-templates?hl=zh-cn) \uff0c\u4e5f\u53ef\u4ee5 [\u5275\u5efa\u81ea\u5b9a\u7fa9\u6a21\u677f](https://cloud.google.com/dataflow/docs/guides/templates/using-flex-templates?hl=zh-cn) \u3002\n## \u69cb\u5efa Apache Beam \u7528\u6236\u4ee3\u78bc\n\u901a\u5e38\uff0c\u5728\u5275\u5efa\u6d41\u6c34\u7dda\u6642\uff0c\u60a8\u5c07\u4f7f\u7528\u901a\u7528\u4e26\u884c\u8655\u7406 Apache Beam \u8f49\u63db [ParDo](https://beam.apache.org/documentation/programming-guide/#pardo) \u3002\u61c9\u7528 `ParDo` \u8f49\u63db\u6642\uff0c\u60a8\u9700\u8981\u4ee5 `DoFn` \u5c0d\u8c61\u7684\u5f62\u5f0f\u63d0\u4f9b\u7528\u6236\u4ee3\u78bc\u3002 `DoFn` \u662f\u4e00\u500b\u7528\u65bc\u5b9a\u7fa9\u5206\u4f48\u5f0f\u8655\u7406\u51fd\u6578\u7684 Apache Beam SDK \u985e\u3002\n\u60a8\u53ef\u4ee5\u5c07 `DoFn` \u4ee3\u78bc\u8996\u7232\u82e5\u5e72\u7368\u7acb\u7684\u5c0f\u578b\u5be6\u9ad4\uff0c\u4e5f\u5c31\u662f\u8aaa\uff0c\u53ef\u80fd\u6709\u8a31\u591a\u5be6\u4f8b\u5728\u4e0d\u540c\u6a5f\u5668\u4e2d\u904b\u884c\uff0c\u4e14\u5404\u5be6\u4f8b\u4e4b\u9593\u5c0d\u5f7c\u6b64\u4e00\u7121\u6240\u77e5\u3002\u56e0\u6b64\uff0c\u6211\u5011\u5efa\u8b70\u5275\u5efa\u7d14\u51fd\u6578 \uff08\u5373\u4e0d\u4f9d\u8cf4\u65bc\u96b1\u85cf\u6216\u5916\u90e8\u72c0\u614b\u3001\u6c92\u6709\u660e\u986f\u526f\u4f5c\u7528\u4e14\u5177\u6709\u78ba\u5b9a\u6027\u7684\u51fd\u6578\uff09\uff0c\u56e0\u7232\u5b83\u5011\u975e\u5e38\u7b26\u5408 `DoFn` \u7684\u4e26\u884c\u548c\u5206\u4f48\u6027\u8cea\u3002\n\u4f46\u662f\uff0c\u7d14\u51fd\u6578\u6a21\u578b\u4e26\u4e0d\u56b4\u8b39\uff1b\u53ea\u8981\u60a8\u7684\u4ee3\u78bc\u4e0d\u4f9d\u8cf4 Dataflow \u670d\u52d9\u7121\u6cd5\u4fdd\u8b49\u7684\u5167\u5bb9\uff0c\u72c0\u614b\u4fe1\u606f\u6216\u5916\u90e8\u521d\u59cb\u5316\u6578\u64da\u5c31\u53ef\u7528\u65bc `DoFn` \u548c\u5176\u4ed6\u51fd\u6578\u5c0d\u8c61\u3002\u5728\u8a2d\u8a08 `ParDo` \u8f49\u63db\u7d50\u69cb\u4e26\u5275\u5efa `DoFn` \u6642\uff0c\u8acb\u8b39\u8a18\u4ee5\u4e0b\u6e96\u5247\uff1a\n- Dataflow \u670d\u52d9\u53ef\u4ee5\u4fdd\u8b49\u8f38\u5165`PCollection`\u4e2d\u7684\u6240\u6709\u5143\u7d20\u90fd\u53ea\u7531`DoFn`\u5be6\u4f8b\u8655\u7406\u4e00\u6b21\u3002\n- Dataflow \u670d\u52d9\u7121\u6cd5\u4fdd\u8b49`DoFn`\u7684\u8abf\u7528\u6b21\u6578\u3002\n- Dataflow \u670d\u52d9\u7121\u6cd5\u4fdd\u8b49\u5206\u4f48\u5f0f\u5143\u7d20\u7684\u78ba\u5207\u5206\u7d44\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u8aaa\uff0c\u5b83\u7121\u6cd5\u4fdd\u8b49\u7cfb\u7d71\u6703\u4e00\u8d77\u8655\u7406\u54ea\u4e9b\u5143\u7d20\uff08\u5982\u679c\u6709\uff09\u3002\n- Dataflow \u670d\u52d9\u7121\u6cd5\u4fdd\u8b49\u5728\u6d41\u6c34\u7dda\u57f7\u884c\u904e\u7a0b\u4e2d\u6703\u5177\u9ad4\u5275\u5efa\u591a\u5c11\u500b`DoFn`\u5be6\u4f8b\u3002\n- Dataflow \u670d\u52d9\u5177\u6709\u5bb9\u932f\u529f\u80fd\uff1b\u5982\u679c\u5de5\u4f5c\u5668\u767c\u751f\u554f\u984c\uff0c\u8a72\u670d\u52d9\u53ef\u80fd\u6703\u591a\u6b21\u91cd\u8a66\u60a8\u7684\u4ee3\u78bc\u3002Dataflow \u670d\u52d9\u53ef\u80fd\u6703\u5275\u5efa\u4ee3\u78bc\u7684\u5099\u4efd\u526f\u672c\uff0c\u4e26\u4e14\u53ef\u80fd\u6703\u51fa\u73fe\u4eba\u7232\u56e0\u7d20\u7684\u8ca0\u9762\u5f71\u97ff\u554f\u984c\uff08\u4f8b\u5982\uff0c\u60a8\u7684\u4ee3\u78bc\u4f9d\u8cf4\u6216\u5275\u5efa\u7684\u81e8\u6642\u6587\u4ef6\u4f7f\u7528\u4e86\u91cd\u8907\u540d\u7a31\uff09\u3002\n- Dataflow \u670d\u52d9\u6703\u6309`DoFn`\u5be6\u4f8b\u5e8f\u5217\u5316\u5143\u7d20\u7684\u8655\u7406\u3002\u60a8\u7684\u4ee3\u78bc\u4e0d\u5fc5\u662f\u56b4\u683c\u7684\u7dda\u7a0b\u5b89\u5168\u4ee3\u78bc\uff1b\u4f46\u662f\uff0c\u591a\u500b`DoFn`\u5be6\u4f8b\u4e4b\u9593\u5171\u7528\u7684\u4efb\u4f55\u72c0\u614b\u5fc5\u9808\u662f\u7dda\u7a0b\u5b89\u5168\u7684\u3002## Assured Workloads\nAssured Workloads \u5e6b\u52a9\u6eff\u8db3 Google Cloud \u5ba2\u6236\u7684\u5b89\u5168\u548c\u5408\u898f\u6027\u8981\u6c42\u3002\u4f8b\u5982\uff0c [\u5177\u6709\u4e3b\u6b0a\u7ba1\u5236\u7684\u6b50\u76df\u5340\u57df\u548c\u652f\u6301](https://cloud.google.com/assured-workloads/docs/concept-platform-controls?hl=zh-cn#eu-sovereignty-controls) \u6709\u52a9\u65bc\u7232\u6b50\u76df\u5ba2\u6236\u5f37\u5236\u57f7\u884c\u6578\u64da\u99d0\u7559\u548c\u6578\u64da\u4e3b\u6b0a\u4fdd\u8b49\u3002\u7232\u4e86\u63d0\u4f9b\u9019\u4e9b\u529f\u80fd\uff0c\u67d0\u4e9b Dataflow \u529f\u80fd\u6703\u53d7\u5230\u9650\u5236\u3002\u5982\u679c\u60a8\u5c07 Assured Workloads \u8207 Dataflow \u642d\u914d\u4f7f\u7528\uff0c\u5247\u6d41\u6c34\u7dda\u8a2a\u554f\u7684\u6240\u6709\u8cc7\u6e90\u90fd\u5fc5\u9808\u4f4d\u65bc\u7d44\u7e54\u7684 [Assured Workloads \u9805\u76ee\u6216\u6587\u4ef6\u593e](https://cloud.google.com/assured-workloads/docs/eu-sovereign-controls-restrictions-limitations?hl=zh-cn) \u4e2d\u3002\u9019\u4e9b\u8cc7\u6e90\u5305\u62ec\uff1a\n- Cloud Storage \u5b58\u5132\u5206\u5340\n- BigQuery \u6578\u64da\u96c6\n- Pub/Sub \u4e3b\u984c\u548c\u8a02\u95b1\n- Firestore \u6578\u64da\u96c6\n- I/O \u9023\u63a5\u5668\n\u5728 Dataflow \u4e2d\uff0c\u57fa\u65bc\u5bc6\u9470\u7684\u64cd\u4f5c\u4e2d\u4f7f\u7528\u7684\u7528\u6236\u6307\u5b9a\u7684\u6578\u64da\u5bc6\u9470\u4e0d\u53d7 [CMEK \u52a0\u5bc6](https://cloud.google.com/dataflow/docs/guides/customer-managed-encryption-keys?hl=zh-cn) \u7684\u4fdd\u8b77\u3002 \u5982\u679c\u9019\u4e9b\u5bc6\u9470\u5305\u542b\u500b\u4eba\u8eab\u4efd\u4fe1\u606f (PII)\uff0c\u5247\u60a8\u9700\u8981\u5148 [\u5c0d\u5bc6\u9470\u9032\u884c\u54c8\u5e0c\u8655\u7406\u6216\u4ee5\u5176\u4ed6\u65b9\u5f0f\u9032\u884c\u8f49\u63db](https://cloud.google.com/dataflow/docs/guides/customer-managed-encryption-keys?hl=zh-cn#encryption_of_pipeline_state_artifacts) \uff0c\u7136\u5f8c\u518d\u8b93\u5bc6\u9470\u9032\u5165 Dataflow \u6d41\u6c34\u7dda\u3002\n## \u8de8\u6d41\u6c34\u7dda\u5171\u4eab\u6578\u64da\n\u6211\u5011\u4e26\u672a\u63d0\u4f9b\u53ef\u5728\u6d41\u6c34\u7dda\u4e4b\u9593\u5171\u4eab\u6578\u64da\u6216\u8655\u7406\u4e0a\u4e0b\u6587\u7684 Dataflow \u5c08\u7528\u8de8\u6d41\u6c34\u7dda\u901a\u4fe1\u6a5f\u5236\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Cloud Storage \u7b49\u6301\u4e45\u6027\u5b58\u5132\u670d\u52d9\u6216 App Engine \u7b49\u5167\u5b58\u7de9\u5b58\uff0c\u5728\u6d41\u6c34\u7dda\u5be6\u4f8b\u4e4b\u9593\u5171\u4eab\u6578\u64da\u3002\n## \u5b89\u6392\u4f5c\u696d\n\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u65b9\u5f0f\u81ea\u52d5\u57f7\u884c\u6d41\u6c34\u7dda\uff1a\n- \u4f7f\u7528 Cloud Scheduler\n- \u5728 [Cloud Composer \u5de5\u4f5c\u6d41](https://cloud.google.com/composer/docs/how-to/using/writing-dags?hl=zh-cn) \u4e2d\u4f7f\u7528 Apache Airflow \u7684 [Dataflow \u904b\u7b97\u7b26](https://airflow.apache.org/integration.html#cloud-dataflow) \uff08\u9019\u662f\u4e00\u7a2e [Cloud Platform \u904b\u7b97\u7b26](https://cloud.google.com/composer/docs/how-to/using/writing-dags?hl=zh-cn#operators) \uff09\n- \u5728 Compute Engine \u4e0a\u904b\u884c\u81ea\u5b9a\u7fa9 (Cron) \u4f5c\u696d\u6d41\u7a0b## \u77ad\u89e3\u8a73\u60c5\n\u4ee5\u4e0b Apache Beam \u6587\u7ae0\u4ecb\u7d39\u77ad\u5982\u4f55\u8a2d\u8a08\u6d41\u6c34\u7dda\u7d50\u69cb\u3001\u5982\u4f55\u9078\u64c7\u8981\u61c9\u7528\u5230\u6578\u64da\u7684\u8f49\u63db\uff0c\u4ee5\u53ca\u5728\u9078\u64c7\u6d41\u6c34\u7dda\u7684\u8f38\u5165\u548c\u8f38\u51fa\u65b9\u6cd5\u6642\u9700\u8981\u8003\u616e\u7684\u4e8b\u9805\u3002\n- [\u8a2d\u8a08\u6d41\u6c34\u7dda](https://beam.apache.org/documentation/pipelines/design-your-pipeline/) \u3002\n- [\u5275\u5efa\u6d41\u6c34\u7dda](https://beam.apache.org/documentation/pipelines/create-your-pipeline/) \u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u69cb\u5efa\u7528\u6236\u4ee3\u78bc\uff0c\u8acb\u53c3\u95b1 [\u7528\u6236\u63d0\u4f9b\u7684\u51fd\u6578\u8981\u6c42](https://beam.apache.org/documentation/programming-guide/#requirements-for-writing-user-code-for-beam-transforms) \u3002", "guide": "Dataflow"}