{"title": "Dataflow - Use the NVIDIA\u00ae L4 GPU type", "url": "https://cloud.google.com/dataflow/docs/gpu/use-l4-gpus", "abstract": "# Dataflow - Use the NVIDIA\u00ae L4 GPU type\n**Note:** The following considerations apply to this GA offering:- Jobs that use GPUs incur charges as specified in the Dataflow [pricing page](/dataflow/pricing) .\n- To use GPUs, your Dataflow job must use [Dataflow Runner v2](/dataflow/docs/runner-v2) .\nThe page explains how to run your Dataflow pipeline with the NVIDIA\u00ae L4 GPU type. The L4 GPU type is useful for running machine learning inference pipelines.\n", "content": "## Requirements\n- Use the Apache Beam SDK version 2.46 or later. Apache Beam 2.50 or later is recommended.\n- You need L4 GPU quota (`NVIDIA_L4_GPUS`) in the region that your job runs in. For more information, see [GPU quotas](/compute/resource-usage#gpu_quota) .\n- The L4 GPU type is available only with the G2 accelerator-optimized machine type. For more information, see [The G2 machine series](/compute/docs/accelerator-optimized-machines#g2-vms) . Pipelines that use the L4 GPU type are subject to the [G2 standard limitations](/compute/docs/accelerator-optimized-machines#g2_standard_limitations) .\n- The NVIDIA L4 GPU type uses the NVIDIA driver version 525.0 or later and the [CUDA toolkit](https://developer.nvidia.com/cuda-toolkit) version 12.0 or later. Any code that you use in your pipeline must be compatible with the NVIDIA driver version and CUDA toolkit version. For example, if you use PyTorch, you need to use PyTorch version 23.01 or later.## Run pipelines with the NVIDIA\u00ae L4 GPU type\nTo use the NVIDIA L4 GPU type, you need to include the following [pipeline options](/dataflow/docs/reference/pipeline-options) and [service options](/dataflow/docs/reference/service-options) in your pipeline code.\n```\n--workerMachineType=G2_MACHINE_TYPE\n--dataflowServiceOptions=\"worker_accelerator=type:nvidia-l4;count:GPU_COUNT;install-nvidia-driver\"\n```\n```\n--machine_type=G2_MACHINE_TYPE\n--dataflow_service_options=\"worker_accelerator=type:nvidia-l4;count:GPU_COUNT;install-nvidia-driver\"\n```\n```\n--worker_machine_type=G2_MACHINE_TYPE\n--dataflow_service_options=\"worker_accelerator=type:nvidia-l4;count:GPU_COUNT;install-nvidia-driver\"\n```\nReplace the following values:\n- : the [G2 machine type](/compute/docs/accelerator-optimized-machines#g2-standard-vms) to use\n- : The number of GPUs to use. Each G2 machine type has a fixed number of NVIDIA L4 GPUs. To find the correct number of GPUs for your machine type, see the **GPU count** column in the [G2 standard machine types](/compute/docs/accelerator-optimized-machines#g2-standard-vms) table.\nFor more information about running pipelines with GPUs, see [Run a pipeline with GPUs](/dataflow/docs/gpu/use-gpus) .\n## Manage dependencies\nTo manage dependencies, use a custom container. For more information, see [Use custom containers in Dataflow](/dataflow/docs/guides/using-custom-containers) .\nThe following Dockerfile example contains compatible dependencies for a pipeline that uses the NVIDIA L4 GPU type.\n```\nRUN apt-get -y update\nRUN apt-get install [system packages]\n# Install the SDK.\nRUN pip install --no-cache-dir apache-beam[gcp]==2.51.0\n# Install the machine learning dependencies.\nRUN pip install --no-cache-dir tensorflow[and-cuda]\nRUN pip install xgboost\nRUN pip install transformers accelerate\n(etc\u2026..)\n# Verify that the image doesn't have conflicting dependencies.\nRUN pip check\n# Copy files from official SDK image, including the script and dependencies.\nCOPY --from=apache/beam_python3.10_sdk:2.51.0 /opt/apache/beam /opt/apache/beam\n# Set the entrypoint to Apache Beam SDK launcher.\nENTRYPOINT [\"/opt/apache/beam/boot\"]\n```\n## What's next\n- Read about [best practices for working with Dataflow GPUs](/dataflow/docs/gpu/develop-with-gpus) .\n- [Run a pipeline with GPUs](/dataflow/docs/gpu/use-gpus) .\n- Learn more about [Dataflow ML](/dataflow/docs/machine-learning) .", "guide": "Dataflow"}