{"title": "Dataflow - \u4f7f\u7528 MLTransform \u9810\u8655\u7406\u6578\u64da", "url": "https://cloud.google.com/dataflow/docs/machine-learning/ml-preprocess-data?hl=zh-cn", "abstract": "# Dataflow - \u4f7f\u7528 MLTransform \u9810\u8655\u7406\u6578\u64da\n\u672c\u9801\u9762\u4ecb\u7d39\u4e86\u7232\u4ec0\u9ebc\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528 [MLTransform](https://github.com/apache/beam/blob/3d501ee9dc208af2efef009daa98c49819b73ddc/sdks/python/apache_beam/ml/transforms/base.py#L112) \u529f\u80fd\u4f86\u6e96\u5099\u6578\u64da\u4ee5\u7528\u65bc\u8a13\u7df4\u6a5f\u5668\u5b78\u7fd2 (ML) \u6a21\u578b\u3002\u901a\u904e\u5c07\u591a\u500b\u6578\u64da\u8655\u7406\u8f49\u63db\u5408\u4f75\u5230\u4e00\u500b\u985e\u4e2d\uff0c `MLTransform` \u53ef\u7c21\u5316\u5c07 Apache Beam ML \u6578\u64da\u8655\u7406\u64cd\u4f5c\u61c9\u7528\u65bc\u5de5\u4f5c\u6d41\u7684\u904e\u7a0b\u3002", "content": "## \u512a\u52e2\n`MLTransform` \u985e\u5177\u6709\u4ee5\u4e0b\u512a\u52e2\uff1a\n- \u7121\u9700\u7de8\u5beb\u8907\u96dc\u4ee3\u78bc\u6216\u7ba1\u7406\u5e95\u5c64\u5eab\u5373\u53ef\u8f49\u63db\u6578\u64da\u3002\n- \u751f\u6210\u53ef\u7528\u65bc\u5c07\u6578\u64da\u63a8\u9001\u5230\u5411\u91cf\u6578\u64da\u5eab\u6216\u904b\u884c\u63a8\u7406\u7684\u5d4c\u5165\u3002\n- \u901a\u904e\u4e00\u500b\u63a5\u53e3\u6709\u6548\u5730\u93c8\u63a5\u591a\u7a2e\u985e\u578b\u7684\u8655\u7406\u64cd\u4f5c\u3002## \u652f\u6301\u548c\u9650\u5236\n`MLTransform` \u985e\u5177\u6709\u4ee5\u4e0b\u9650\u5236\uff1a\n- \u9069\u7528\u65bc\u4f7f\u7528 Apache Beam Python SDK 2.53.0 \u53ca\u66f4\u9ad8\u7248\u672c\u7684\u6d41\u6c34\u7dda\u3002\n- \u6d41\u6c34\u7dda\u5fc5\u9808\u4f7f\u7528 [\u9ed8\u8a8d\u7a97\u53e3](https://beam.apache.org/documentation/programming-guide/#single-global-window) \u3002\n**\u6587\u672c\u5d4c\u5165\u8f49\u63db** \uff1a\n- \u652f\u6301 Python 3.8\u30013.9\u30013.10 \u548c 3.11\u3002\n- \u652f\u6301\u6279\u8655\u7406\u548c\u6d41\u5f0f\u8655\u7406\u6d41\u6c34\u7dda\u3002\n- \u652f\u6301 [Vertex AI \u6587\u672c\u5d4c\u5165 API](https://cloud.google.com/vertex-ai/docs/generative-ai/embeddings/get-text-embeddings?hl=zh-cn) \u548c [Hugging Face Sentence Transformers \u6a21\u584a](https://huggingface.co/sentence-transformers) \u3002\n**\u4f7f\u7528 TFT \u7684\u6578\u64da\u8655\u7406\u8f49\u63db** \uff1a\n- \u652f\u6301 Python 3.8\u30013.9 \u548c 3.10\u3002\n- \u652f\u6301\u6279\u8655\u7406\u6d41\u6c34\u7dda\u3002## \u4f7f\u7528\u5834\u666f\n\u793a\u4f8b\u7b46\u8a18\u672c\u6f14\u793a\u77ad\u5982\u4f55\u5c07 `MLTransform` \u7528\u65bc\u7279\u5b9a\u61c9\u7528\u5834\u666f\u3002\n\u5982\u9700\u67e5\u770b\u53ef\u7528\u8f49\u63db\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8acb\u53c3\u95b1 Apache Beam \u6587\u6a94\u4e2d\u7684 [\u8f49\u63db](https://beam.apache.org/documentation/ml/preprocess-data#transforms) \u3002\n## \u4f7f\u7528 MLTransform\n\u5982\u9700\u4f7f\u7528 `MLTransform` \u985e\u9810\u8655\u7406\u6578\u64da\uff0c\u8acb\u5728\u6d41\u6c34\u7dda\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u4ee3\u78bc\uff1a\n```\n\u00a0 import apache_beam as beam\u00a0 from apache_beam.ml.transforms.base import MLTransform\u00a0 from apache_beam.ml.transforms.tft import TRANSFORM_NAME\u00a0 import tempfile\u00a0 data = [\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 DATA\u00a0 \u00a0 \u00a0 },\u00a0 ]\u00a0 artifact_location = gs://BUCKET_NAME\u00a0 TRANSFORM_FUNCTION_NAME = TRANSFORM_NAME(columns=['x'])\u00a0 with beam.Pipeline() as p:\u00a0 \u00a0 transformed_data = (\u00a0 \u00a0 \u00a0 \u00a0 p\u00a0 \u00a0 \u00a0 \u00a0 | beam.Create(data)\u00a0 \u00a0 \u00a0 \u00a0 | MLTransform(write_artifact_location=artifact_location).with_transform(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 TRANSFORM_FUNCTION_NAME)\u00a0 \u00a0 \u00a0 \u00a0 | beam.Map(print))\n```\n\u66ff\u63db\u4ee5\u4e0b\u503c\uff1a\n- ``\uff1a\u8981\u4f7f\u7528\u7684 [\u8f49\u63db](https://beam.apache.org/documentation/ml/preprocess-data/#transforms) \u7684\u540d\u7a31\n- ``\uff1a [Cloud Storage \u5b58\u5132\u6876](https://cloud.google.com/storage/docs/buckets?hl=zh-cn#naming) \u7684\u540d\u7a31\n- ``\uff1a\u8981\u8f49\u63db\u7684\u8f38\u5165\u6578\u64da\n- ``\uff1a\u60a8\u5728\u4ee3\u78bc\u4e2d\u7232\u8f49\u63db\u51fd\u6578\u6307\u5b9a\u7684\u540d\u7a31## \u5f8c\u7e8c\u6b65\u9a5f\n- \u5982\u9700\u8a73\u7d30\u77ad\u89e3`MLTransform`\uff0c\u8acb\u53c3\u95b1 Apache Beam \u6587\u6a94\u4e2d\u7684 [\u9810\u8655\u7406\u6578\u64da](https://beam.apache.org/documentation/ml/preprocess-data) \u3002\n- \u5982\u9700\u67e5\u770b\u66f4\u591a\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1 Apache Beam \u8f49\u63db\u76ee\u9304\u4e2d\u7684 [\u7528\u65bc\u6578\u64da\u8655\u7406\u7684 MLTransform](https://beam.apache.org/documentation/transforms/python/elementwise/mltransform) \u3002\n- [\u5728 Colab \u4e2d\u904b\u884c\u4ea4\u4e92\u5f0f\u7b46\u8a18\u672c](https://colab.sandbox.google.com/github/apache/beam/blob/master/examples/notebooks/beam-ml/mltransform_basic.ipynb?hl=zh-cn) \u3002", "guide": "Dataflow"}