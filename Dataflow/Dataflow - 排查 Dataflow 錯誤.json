{"title": "Dataflow - \u6392\u67e5 Dataflow \u932f\u8aa4", "url": "https://cloud.google.com/dataflow/docs/guides/common-errors?hl=zh-cn", "abstract": "# Dataflow - \u6392\u67e5 Dataflow \u932f\u8aa4\n\u5982\u679c\u60a8\u5728\u4f7f\u7528 Dataflow \u6d41\u6c34\u7dda\u6216\u4f5c\u696d\u6642\u9047\u5230\u554f\u984c\uff0c\u672c\u9801\u9762\u5217\u51fa\u4e86\u60a8\u53ef\u80fd\u6703\u770b\u5230\u7684\u932f\u8aa4\u6d88\u606f\uff0c\u4e26\u63d0\u4f9b\u4e86\u6709\u95dc\u5982\u4f55\u4fee\u5fa9\u6bcf\u500b\u932f\u8aa4\u7684\u5efa\u8b70\u3002\n\u65e5\u8a8c\u985e\u578b `dataflow.googleapis.com/worker-startup` \u3001 `dataflow.googleapis.com/harness-startup` \u548c `dataflow.googleapis.com/kubelet` \u4e2d\u7684\u932f\u8aa4\u8868\u660e\u4f5c\u696d\u5b58\u5728\u914d\u7f6e\u554f\u984c\u3002\u9084\u53ef\u80fd\u8868\u793a\u5b58\u5728\u5c0e\u81f4\u6b63\u5e38\u65e5\u8a8c\u8a18\u9304\u8def\u5f91\u7121\u6cd5\u6b63\u5e38\u4f7f\u7528\u7684\u689d\u4ef6\u3002\n\u60a8\u7684\u6d41\u6c34\u7dda\u5728\u8655\u7406\u6578\u64da\u6642\u53ef\u80fd\u6703\u62cb\u51fa\u7570\u5e38\u3002\u5176\u4e2d\u4e00\u4e9b\u932f\u8aa4\u662f\u66ab\u6642\u6027\u7684\uff0c\u4f8b\u5982\u66ab\u6642\u7121\u6cd5\u8a2a\u554f\u5916\u90e8\u670d\u52d9\u3002\u5176\u4e2d\u4e00\u4e9b\u932f\u8aa4\u662f\u6c38\u4e45\u6027\u7684\uff0c\u4f8b\u5982\u56e0\u8f38\u5165\u6578\u64da\u640d\u58de\u6216\u7121\u6cd5\u89e3\u6790\u5f15\u767c\u7684\u932f\u8aa4\uff0c\u6216\u8005\u8a08\u7b97\u671f\u9593\u7684 NULL \u6307\u91dd\u3002\nDataflow \u6703\u8655\u7406\u4efb\u610f\u8edf\u4ef6\u5305\u4e2d\u7684\u5143\u7d20\uff0c\u4e26\u6703\u5728\u91dd\u5c0d\u8a72\u8edf\u4ef6\u5305\u4e2d\u7684\u4efb\u4f55\u5143\u7d20\u62cb\u51fa\u932f\u8aa4\u6642\u91cd\u8a66\u6574\u500b\u8edf\u4ef6\u5305\u3002\u4ee5\u6279\u91cf\u6a21\u5f0f\u904b\u884c\u6642\uff0c\u542b\u6709\u5931\u6557\u9805\u7684\u8edf\u4ef6\u5305\u5c07\u91cd\u8a66\u56db\u6b21\u3002\u55ae\u500b\u8edf\u4ef6\u5305\u5931\u6557\u56db\u6b21\u5f8c\uff0c\u6d41\u6c34\u7dda\u6703\u5b8c\u5168\u5931\u6557\u3002\u4ee5\u6d41\u5f0f\u6a21\u5f0f\u904b\u884c\u6642\uff0c\u542b\u6709\u5931\u6557\u9805\u7684\u8edf\u4ef6\u5305\u6703\u7121\u9650\u5730\u91cd\u8a66\uff0c\u9019\u53ef\u80fd\u6703\u5c0e\u81f4\u60a8\u7684\u6d41\u6c34\u7dda\u6c38\u4e45\u6027\u505c\u6eef\u3002\n[Dataflow \u76e3\u63a7\u754c\u9762](https://cloud.google.com/dataflow/pipelines/dataflow-monitoring-intf?hl=zh-cn) \u6703\u5831\u544a\u7528\u6236\u4ee3\u78bc\uff08\u4f8b\u5982 `DoFn` \u5be6\u4f8b\uff09\u4e2d\u7684\u7570\u5e38\u3002 \u5982\u679c\u4f7f\u7528 `BlockingDataflowPipelineRunner` \u904b\u884c\u6d41\u6c34\u7dda\uff0c\u60a8\u9084\u53ef\u5728\u63a7\u5236\u6aaf\u6216\u7d42\u7aef\u7a97\u53e3\u4e2d\u770b\u5230\u8f38\u51fa\u7684\u932f\u8aa4\u6d88\u606f\u3002\n\u8003\u616e\u901a\u904e\u6dfb\u52a0\u7570\u5e38\u8655\u7406\u7a0b\u5e8f\u4f86\u9632\u6b62\u4ee3\u78bc\u4e2d\u7684\u932f\u8aa4\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u56e0\u7232\u67d0\u4e9b\u5143\u7d20\u672a\u80fd\u901a\u904e\u5728 `ParDo` \u4e2d\u57f7\u884c\u7684\u4e00\u4e9b\u81ea\u5b9a\u7fa9\u8f38\u5165\u9a57\u8b49\u800c\u8981\u6368\u68c4\u5b83\u5011\uff0c\u8acb\u5728 `ParDo` \u4e2d\u4f7f\u7528 try/catch \u584a\uff0c\u4ee5\u4fbf\u8655\u7406\u7570\u5e38\u4e26\u8a18\u9304\u548c\u6368\u68c4\u9019\u4e9b\u5143\u7d20\u3002\u5c0d\u65bc\u751f\u7522\u5de5\u4f5c\u8ca0\u8f09\uff0c\u8acb\u5be6\u73fe\u672a\u8655\u7406\u7684\u6d88\u606f\u6a21\u5f0f\u3002\u5982\u9700\u8ddf\u8e64\u932f\u8aa4\u8a08\u6578\uff0c\u8acb\u4f7f\u7528 [\u805a\u5408\u8f49\u63db](https://beam.apache.org/documentation/transforms/java/overview/#aggregation) \u3002\n", "content": "## \u7f3a\u5931\u65e5\u8a8c\u6587\u4ef6\n\u5982\u679c\u60a8\u6c92\u6709\u770b\u5230\u4f5c\u696d\u7684\u4efb\u4f55\u65e5\u8a8c\uff0c\u8acb\u5f9e\u6240\u6709 Cloud Logging **\u65e5\u8a8c\u8def\u7531\u5668** \u63a5\u6536\u5668\u4e2d\u79fb\u9664\u4efb\u4f55\u5305\u542b `resource.type=\"dataflow_step\"` \u7684\u6392\u9664\u9805\u904e\u6ffe\u689d\u4ef6\u3002\n[\u8f49\u5230\u65e5\u8a8c\u8def\u7531\u5668](https://console.cloud.google.com/logs/router?hl=zh-cn)\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u79fb\u9664\u65e5\u8a8c\u6392\u9664\u9805\uff0c\u8acb\u53c3\u95b1 [\u79fb\u9664\u6392\u9664\u9805](https://cloud.google.com/logging/docs/exclusions?hl=zh-cn#stopping-resource) \u6307\u5357\u3002\n## \u6d41\u6c34\u7dda\u932f\u8aa4\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u60a8\u53ef\u80fd\u6703\u9047\u5230\u7684\u5e38\u898b\u6d41\u6c34\u7dda\u932f\u8aa4\uff0c\u4ee5\u53ca\u89e3\u6c7a\u6216\u6392\u67e5\u9019\u4e9b\u932f\u8aa4\u7684\u6b65\u9a5f\u3002\n### \u67d0\u4e9b Cloud API \u9700\u8981\u5553\u7528\n\u5617\u8a66\u904b\u884c Dataflow \u4f5c\u696d\u6642\uff0c\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nSome Cloud APIs need to be enabled for your project in order for Cloud Dataflow to run this job.\n```\n\u51fa\u73fe\u6b64\u554f\u984c\u7684\u539f\u56e0\u662f\u9805\u76ee\u4e2d\u672a\u5553\u7528\u67d0\u4e9b\u5fc5\u9700\u7684 API\u3002\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\u4e26\u904b\u884c Dataflow \u4f5c\u696d\uff0c\u8acb\u5728\u9805\u76ee\u4e2d\u5553\u7528\u4ee5\u4e0b Google Cloud API\uff1a\n- Compute Engine API (Compute Engine)\n- Cloud Logging API\n- Cloud Storage\n- Cloud Storage JSON API\n- BigQuery API\n- Pub/Sub\n- Datastore API\n\u5982\u9700\u77ad\u89e3\u8a73\u7d30\u8aaa\u660e\uff0c\u8acb\u53c3\u95b1 [\u6709\u95dc\u5553\u7528 Google Cloud API \u7684\u201c\u4f7f\u7528\u5165\u9580\u201d\u90e8\u5206](https://cloud.google.com/dataflow/getting-started?hl=zh-cn#APIs) \u3002\n### \u201c@*\u201d\u548c\u201c@N\u201d\u662f\u9810\u7559\u7684\u5206\u7247\u898f\u7bc4\n\u5617\u8a66\u904b\u884c\u4f5c\u696d\u6642\uff0c\u65e5\u8a8c\u6587\u4ef6\u4e2d\u6703\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\uff0c\u4e26\u4e14\u4f5c\u696d\u6703\u5931\u6557\uff1a\n```\nWorkflow failed. Causes: \"@*\" and \"@N\" are reserved sharding specs. Filepattern must not contain any of them.\n```\n\u5982\u679c\u81e8\u6642\u6587\u4ef6\uff08 `tempLocation` \u6216 `temp_location` \uff09\u7684 Cloud Storage \u8def\u5f91\u6587\u4ef6\u540d\u5305\u542b\u7b26\u865f (@) \u5f8c\u8ddf\u6578\u5b57\u6216\u661f\u865f (*)\uff0c\u5247\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u66f4\u6539\u6587\u4ef6\u540d\uff0c\u4f7f\u5176\u5728\u7b26\u865f\u5f8c\u8ddf\u652f\u6301\u7684\u5b57\u7b26\u3002\n### \u932f\u8aa4\u8acb\u6c42\n\u7576\u60a8\u904b\u884c Dataflow \u4f5c\u696d\u6642\uff0c [Cloud Monitoring](https://cloud.google.com/dataflow/docs/guides/using-cloud-monitoring?hl=zh-cn) \u65e5\u8a8c\u986f\u793a\u5982\u4e0b\u6240\u793a\u7684\u4e00\u7cfb\u5217\u8b66\u544a\uff1a\n```\nUnable to update setup work item STEP_ID error: generic::invalid_argument: Http(400) Bad Request\nUpdate range task returned 'invalid argument'. Assuming lost lease for work with id LEASE_ID\nwith expiration time: TIMESTAMP, now: TIMESTAMP. Full status: generic::invalid_argument: Http(400) Bad Request\n```\n\u5982\u679c\u5de5\u4f5c\u5668\u72c0\u614b\u4fe1\u606f\u56e0\u8655\u7406\u5ef6\u9072\u800c\u904e\u6642\u6216\u4e0d\u540c\u6b65\uff0c\u5247\u6703\u51fa\u73fe\u932f\u8aa4\u8acb\u6c42\u8b66\u544a\u3002\u901a\u5e38\u60c5\u6cc1\u4e0b\uff0c\u5118\u7ba1\u51fa\u73fe\u932f\u8aa4\u8acb\u6c42\u8b66\u544a\uff0cDataflow \u4f5c\u696d\u4ecd\u6703\u6210\u529f\u3002\u5982\u679c\u51fa\u73fe\u9019\u7a2e\u60c5\u6cc1\uff0c\u8acb\u5ffd\u7565\u6b64\u985e\u8b66\u544a\u3002\n### \u7121\u6cd5\u5728\u4e0d\u540c\u4f4d\u7f6e\u57f7\u884c\u8b80\u5beb\u64cd\u4f5c\n\u904b\u884c Dataflow \u4f5c\u696d\u6642\uff0c\u60a8\u53ef\u80fd\u6703\u5728\u65e5\u8a8c\u6587\u4ef6\u4e2d\u770b\u5230\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nmessage:Cannot read and write in different locations: source: SOURCE_REGION, destination: DESTINATION_REGION,reason:invalid\n```\n\u7576\u4f86\u6e90\u548c\u76ee\u6a19\u4f4d\u65bc\u4e0d\u540c\u7684\u5340\u57df\u6642\uff0c\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\u7576\u66ab\u5b58\u4f4d\u7f6e\u548c\u76ee\u6a19\u4f4d\u7f6e\u4f4d\u65bc\u4e0d\u540c\u5340\u57df\u6642\uff0c\u4e5f\u53ef\u80fd\u767c\u751f\u6b64\u932f\u8aa4\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f5c\u696d\u5f9e Pub/Sub \u8b80\u53d6\u6578\u64da\uff0c\u5c07\u6578\u64da\u5beb\u5165 Cloud Storage `temp` \u5b58\u5132\u6876\uff0c\u7136\u5f8c\u518d\u5beb\u5165 BigQuery \u8868\uff0c\u5247 Cloud Storage `temp` \u5b58\u5132\u6876\u548c BigQuery \u8868\u5fc5\u9808\u4f4d\u65bc\u540c\u4e00\u5340\u57df\u3002\n\u591a\u5340\u57df\u548c\u55ae\u5340\u57df\u88ab\u8996\u7232\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c\u5373\u4f7f\u55ae\u5340\u57df\u4f4d\u7f6e\u5728\u591a\u5340\u57df\u4f4d\u7f6e\u7bc4\u570d\u5167\u4e5f\u662f\u5982\u6b64\u3002\u4f8b\u5982\uff0c `us (multiple regions in the United States)` \u548c `us-central1` \u662f\u4e0d\u540c\u7684\u5340\u57df\u3002\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u5c07\u76ee\u6a19\u4f4d\u7f6e\u3001\u4f86\u6e90\u4f4d\u7f6e\u548c\u66ab\u5b58\u4f4d\u7f6e\u8a2d\u7f6e\u5728\u540c\u4e00\u5340\u57df\u3002Cloud Storage \u5b58\u5132\u6876\u4f4d\u7f6e\u7121\u6cd5\u66f4\u6539\uff0c\u56e0\u6b64\u60a8\u53ef\u80fd\u9700\u8981\u5728\u6b63\u78ba\u7684\u5340\u57df\u4e2d\u5275\u5efa\u65b0\u7684 Cloud Storage \u5b58\u5132\u6876\u3002\n### \u9023\u63a5\u8d85\u6642\n\u904b\u884c Dataflow \u4f5c\u696d\u6642\uff0c\u60a8\u53ef\u80fd\u6703\u5728\u65e5\u8a8c\u6587\u4ef6\u4e2d\u770b\u5230\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\norg.springframework.web.client.ResourceAccessException: I/O error on GET request for CONNECTION_PATH: Connection timed out (Connection timed out); nested exception is java.net.ConnectException: Connection timed out (Connection timed out)\n```\n\u7576 Dataflow \u5de5\u4f5c\u5668\u7121\u6cd5\u8207\u6578\u64da\u6e90\u6216\u76ee\u6a19\u5efa\u7acb\u9023\u63a5\u6216\u4fdd\u6301\u9023\u63a5\u6642\uff0c\u5c31\u6703\u51fa\u73fe\u6b64\u554f\u984c\u3002\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u6309\u4ee5\u4e0b\u554f\u984c\u6392\u67e5\u6b65\u9a5f\u64cd\u4f5c\uff1a\n- \u9a57\u8b49\u6578\u64da\u6e90\u6b63\u5728\u904b\u884c\u3002\n- \u9a57\u8b49\u76ee\u6a19\u6b63\u5728\u904b\u884c\u3002\n- \u67e5\u770b Dataflow \u6d41\u6c34\u7dda\u914d\u7f6e\u4e2d\u4f7f\u7528\u7684 [\u9023\u63a5\u53c3\u6578](https://beam.apache.org/documentation/pipelines/create-your-pipeline/#reading-data-into-your-pipeline) \u3002\n- \u9a57\u8b49\u6027\u80fd\u554f\u984c\u662f\u5426\u4e0d\u6703\u5f71\u97ff\u4f86\u6e90\u6216\u76ee\u6a19\u3002\n- \u78ba\u4fdd [\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/dataflow/docs/guides/routes-firewall?hl=zh-cn) \u4e0d\u6703\u963b\u6b62\u9023\u63a5\u3002\n### \u7121\u6b64\u985e\u5c0d\u8c61\n\u904b\u884c Dataflow \u4f5c\u696d\u6642\uff0c\u60a8\u53ef\u80fd\u6703\u5728\u65e5\u8a8c\u6587\u4ef6\u4e2d\u770b\u5230\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\n..., 'server': 'UploadServer', 'status': '404'}>, <content <No such object:...\n```\n\u5982\u679c\u67d0\u4e9b\u6b63\u5728\u904b\u884c\u7684 Dataflow \u4f5c\u696d\u4f7f\u7528\u540c\u4e00\u500b `temp_location` \u4f86\u66ab\u5b58\u6d41\u6c34\u7dda\u904b\u884c\u6642\u5275\u5efa\u7684\u81e8\u6642\u4f5c\u696d\u6587\u4ef6\uff0c\u5247\u901a\u5e38\u6703\u767c\u751f\u9019\u4e9b\u932f\u8aa4\u3002\u5982\u679c\u591a\u500b\u4f75\u767c\u4f5c\u696d\u5171\u4eab\u76f8\u540c\u7684 `temp_location` \uff0c\u5247\u9019\u4e9b\u4f5c\u696d\u53ef\u80fd\u6703\u4e92\u76f8\u57f7\u884c\u81e8\u6642\u6578\u64da\uff0c\u4e26\u4e14\u53ef\u80fd\u6703\u51fa\u73fe\u7af6\u614b\u689d\u4ef6\u3002\u7232\u907f\u514d\u6b64\u554f\u984c\uff0c\u5efa\u8b70\u60a8\u7232\u6bcf\u500b\u4f5c\u696d\u4f7f\u7528\u552f\u4e00\u7684 `temp_location` \u3002\n### Dataflow \u7121\u6cd5\u78ba\u5b9a\u7a4d\u58d3\n\u5f9e Pub/Sub \u904b\u884c\u6d41\u5f0f\u6d41\u6c34\u7dda\u6642\uff0c\u6703\u51fa\u73fe\u4ee5\u4e0b\u8b66\u544a\uff1a\n```\nDataflow is unable to determine the backlog for Pub/Sub subscription\n```\n\u7576 Dataflow \u6d41\u6c34\u7dda\u5f9e Pub/Sub \u4e2d\u62c9\u53d6\u6578\u64da\u6642\uff0cDataflow \u9700\u8981\u53cd\u8986\u5411 Pub/Sub \u8acb\u6c42\u4fe1\u606f\u3002\u6b64\u4fe1\u606f\u5305\u62ec\u8a02\u95b1\u7684\u7a4d\u58d3\u91cf\u4ee5\u53ca\u6700\u65e9\u7684\u672a\u78ba\u8a8d\u6d88\u606f\u7684\u5b58\u5728\u6642\u9593\u3002\u6709\u6642\uff0cDataflow \u6703\u56e0\u5167\u90e8\u7cfb\u7d71\u554f\u984c\u800c\u7121\u6cd5\u5f9e Pub/Sub \u4e2d\u6aa2\u7d22\u6b64\u4fe1\u606f\uff0c\u9019\u53ef\u80fd\u6703\u5c0e\u81f4\u7a4d\u58d3\u66ab\u6642\u7d2f\u7a4d\u3002\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 Cloud Pub/Sub \u9032\u884c\u6d41\u5f0f\u50b3\u8f38](https://cloud.google.com/dataflow/docs/concepts/streaming-with-cloud-pubsub?hl=zh-cn) \u3002\n### DEADLINE_EXCEEDED \u6216\u670d\u52d9\u5668\u7121\u97ff\u61c9\n\u904b\u884c\u4f5c\u696d\u6642\uff0c\u60a8\u53ef\u80fd\u6703\u9047\u5230 RPC \u8d85\u6642\u7570\u5e38\u6216\u4ee5\u4e0b\u932f\u8aa4\u4e4b\u4e00\uff1a\n```\nDEADLINE_EXCEEDED\n```\n\u6216\uff1a\n```\nServer Unresponsive\n```\n\u9019\u4e9b\u932f\u8aa4\u901a\u5e38\u662f\u7531\u65bc\u4ee5\u4e0b\u67d0\u7a2e\u539f\u56e0\u9020\u6210\u7684\uff1a\n- **\u7528\u65bc\u60a8\u7684\u4f5c\u696d\u7684 Virtual Private Cloud (VPC) \u7db2\u7d61\u53ef\u80fd\u7f3a\u5c11\u9632\u706b\u7246\u898f\u5247** \u3002\u9632\u706b\u7246\u898f\u5247\u9700\u8981\u5141\u8a31\u60a8\u5728\u6d41\u6c34\u7dda\u9078\u9805\u4e2d\u6307\u5b9a\u7684 VPC \u7db2\u7d61\u7684\u865b\u64ec\u6a5f\u4e4b\u9593\u7684\u6240\u6709 TCP \u6d41\u91cf\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Dataflow \u7684\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/dataflow/docs/guides/routes-firewall?hl=zh-cn#firewall_rules) \u3002\u5728\u67d0\u4e9b\u60c5\u6cc1\u4e0b\uff0c\u5de5\u4f5c\u5668\u7121\u6cd5\u76f8\u4e92\u901a\u4fe1\u3002\u7576\u60a8\u904b\u884c\u4e0d\u4f7f\u7528 Dataflow Shuffle \u6216 Streaming Engine \u7684 Dataflow \u4f5c\u696d\u6642\uff0c\u5de5\u4f5c\u5668\u9700\u8981\u4f7f\u7528 VPC \u7db2\u7d61\u4e2d\u7684 TCP \u7aef\u53e3 `12345` \u548c `12346` \u76f8\u4e92\u901a\u4fe1\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u932f\u8aa4\u5305\u62ec\u5de5\u4f5c\u5668 harness \u540d\u7a31\u548c\u88ab\u5c4f\u853d\u7684 TCP \u7aef\u53e3\u3002\u932f\u8aa4\u985e\u4f3c\u65bc\u4ee5\u4e0b\u793a\u4f8b\u4e4b\u4e00\uff1a```\nDEADLINE_EXCEEDED: (g)RPC timed out when SOURCE_WORKER_HARNESS\ntalking to DESTINATION_WORKER_HARNESS:12346.\n``````\nRpc to WORKER_HARNESS:12345 completed with error UNAVAILABLE: failed to connect to all addresses\nServer unresponsive (ping error: Deadline Exceeded, UNKNOWN: Deadline Exceeded...)\n```\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u4f7f\u7528 `gcloud compute firewall-rules create` [\u898f\u5247](https://cloud.google.com/sdk/gcloud/reference/compute/firewall-rules/create?hl=zh-cn#--rules) \u6a19\u8a8c\u4f86\u5141\u8a31\u767c\u9001\u5230\u7aef\u53e3 `12345` \u548c `12346` \u7684\u7db2\u7d61\u6d41\u91cf\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86 Google Cloud CLI \u547d\u4ee4\uff1a```\ngcloud compute firewall-rules create FIREWALL_RULE_NAME \\\n --network NETWORK \\\n --action allow \\\n --direction IN \\\n --target-tags dataflow \\\n --source-tags dataflow \\\n --priority 0 \\\n --rules tcp:12345-12346\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u9632\u706b\u7246\u898f\u5247\u7684\u540d\u7a31\n- ``\uff1a\u7db2\u7d61\u7684\u540d\u7a31\n- **\u60a8\u7684\u4f5c\u696d\u53d7 shuffle \u9650\u5236** \u3002\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u9032\u884c\u4ee5\u4e0b\u4e00\u9805\u6216\u591a\u9805\u66f4\u6539\u3002\n- \u5982\u679c\u4f5c\u696d\u672a\u4f7f\u7528\u57fa\u65bc\u670d\u52d9\u7684 Shuffle\uff0c\u8acb\u8a2d\u7f6e`--experiments=shuffle_mode=service`\u4ee5\u5207\u63db\u5230\u4f7f\u7528\u57fa\u65bc\u670d\u52d9\u7684 Dataflow Shuffle\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\u548c\u53ef\u7528\u6027\uff0c\u8acb\u53c3\u95b1 [Dataflow Shuffle](https://cloud.google.com/dataflow/docs/shuffle-for-batch?hl=zh-cn) \u3002\n- \u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e\u5177\u6709\u66f4\u9ad8\u503c\u7684`--numWorkers`\u3002\n- \u589e\u52a0\u5de5\u4f5c\u5668\u639b\u63a5\u7684\u78c1\u76e4\u7684\u5927\u5c0f\u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e\u5177\u6709\u66f4\u9ad8\u503c\u7684`--diskSizeGb`\u3002\n- \u4f7f\u7528\u652f\u6301 SSD \u7684\u6c38\u4e45\u6027\u78c1\u76e4\u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e`--workerDiskType=\"compute.googleapis.com/projects/` `` `/zones/` `` `/diskTypes/pd-ssd\"`\u3002\n- \u5982\u679c\u4f5c\u696d\u672a\u4f7f\u7528\u57fa\u65bc\u670d\u52d9\u7684 Shuffle\uff0c\u8acb\u8a2d\u7f6e`--experiments=shuffle_mode=service`\u4ee5\u5207\u63db\u5230\u4f7f\u7528\u57fa\u65bc\u670d\u52d9\u7684 Dataflow Shuffle\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\u548c\u53ef\u7528\u6027\uff0c\u8acb\u53c3\u95b1 [Dataflow Shuffle](https://cloud.google.com/dataflow/docs/shuffle-for-batch?hl=zh-cn) \u3002\n- \u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e\u5177\u6709\u66f4\u9ad8\u503c\u7684`--num_workers`\u3002\n- \u589e\u52a0\u5de5\u4f5c\u5668\u639b\u63a5\u7684\u78c1\u76e4\u7684\u5927\u5c0f\u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e\u5177\u6709\u66f4\u9ad8\u503c\u7684`--disk_size_gb`\u3002\n- \u4f7f\u7528\u652f\u6301 SSD \u7684\u6c38\u4e45\u6027\u78c1\u76e4\u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e`--worker_disk_type=\"compute.googleapis.com/projects/` `` `/zones/` `` `/diskTypes/pd-ssd\"`\u3002\n- \u5982\u679c\u4f5c\u696d\u672a\u4f7f\u7528\u57fa\u65bc\u670d\u52d9\u7684 Shuffle\uff0c\u8acb\u8a2d\u7f6e`--experiments=shuffle_mode=service`\u4ee5\u5207\u63db\u5230\u4f7f\u7528\u57fa\u65bc\u670d\u52d9\u7684 Dataflow Shuffle\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\u548c\u53ef\u7528\u6027\uff0c\u8acb\u53c3\u95b1 [Dataflow Shuffle](https://cloud.google.com/dataflow/docs/shuffle-for-batch?hl=zh-cn) \u3002\n- \u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e\u5177\u6709\u66f4\u9ad8\u503c\u7684`--num_workers`\u3002\n- \u589e\u52a0\u5de5\u4f5c\u5668\u639b\u63a5\u7684\u78c1\u76e4\u7684\u5927\u5c0f\u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e\u5177\u6709\u66f4\u9ad8\u503c\u7684`--disk_size_gb`\u3002\n- \u4f7f\u7528\u652f\u6301 SSD \u7684\u6c38\u4e45\u6027\u78c1\u76e4\u3002\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5617\u8a66\u8a2d\u7f6e`--disk_type=\"compute.googleapis.com/projects/` `` `/zones/` `` `/diskTypes/pd-ssd\"`\u3002### \u7528\u6236\u4ee3\u78bc\u4e2d\u7684\u7de8\u78bc\u932f\u8aa4\u3001IO \u7570\u5e38\u6216\u610f\u5916\u884c\u7232\nApache Beam SDK \u548c Dataflow \u5de5\u4f5c\u5668\u4f9d\u8cf4\u65bc\u5e38\u898b\u7684\u7b2c\u4e09\u65b9\u7d44\u4ef6\u3002\u800c\u9019\u4e9b\u7d44\u4ef6\u53c8\u6703\u5c0e\u5165\u5176\u4ed6\u4f9d\u8cf4\u9805\u3002\u7248\u672c\u885d\u7a81\u53ef\u80fd\u5c0e\u81f4\u670d\u52d9\u51fa\u73fe\u610f\u5916\u884c\u7232\u3002\u6b64\u5916\uff0c\u67d0\u4e9b\u5eab\u4e0d\u5411\u524d\u517c\u5bb9\u3002\u56e0\u6b64\u60a8\u53ef\u80fd\u9700\u8981\u5728\u57f7\u884c\u904e\u7a0b\u7684\u7bc4\u570d\u5167\u56fa\u5b9a\u4f7f\u7528\u5217\u660e\u7684\u7248\u672c\u3002 [SDK \u548c\u5de5\u4f5c\u5668\u4f9d\u8cf4\u9805](https://cloud.google.com/dataflow/docs/concepts/sdk-worker-dependencies?hl=zh-cn) \u5305\u542b\u4f9d\u8cf4\u9805\u53ca\u5176\u6240\u9700\u7248\u672c\u7684\u5217\u8868\u3002\n### \u904b\u884c LookupEffectiveGuestPolicies \u6642\u51fa\u932f\n\u904b\u884c Dataflow \u4f5c\u696d\u6642\uff0c\u60a8\u53ef\u80fd\u6703\u5728\u65e5\u8a8c\u6587\u4ef6\u4e2d\u770b\u5230\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nOSConfigAgent Error policies.go:49: Error running LookupEffectiveGuestPolicies:\nerror calling LookupEffectiveGuestPolicies: code: \"Unauthenticated\",\nmessage: \"Request is missing required authentication credential.\nExpected OAuth 2 access token, login cookie or other valid authentication credential.\n```\n\u5982\u679c\u7232\u6574\u500b\u9805\u76ee\u5553\u7528\u4e86 [OS Configuration Management](https://cloud.google.com/compute/docs/os-configuration-management?hl=zh-cn) \uff0c\u5247\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u505c\u7528\u61c9\u7528\u65bc\u6574\u500b\u9805\u76ee\u7684 [\u865b\u64ec\u6a5f\u7ba1\u7406\u5668](https://cloud.google.com/compute/docs/vm-manager?hl=zh-cn) \u653f\u7b56\u3002\u5982\u679c\u7121\u6cd5\u7232\u6574\u500b\u9805\u76ee\u505c\u7528\u865b\u64ec\u6a5f\u7ba1\u7406\u5668\u653f\u7b56\uff0c\u60a8\u53ef\u4ee5\u653e\u5fc3\u5730\u5ffd\u7565\u6b64\u932f\u8aa4\u4e26\u5c07\u5176\u5f9e\u65e5\u8a8c\u76e3\u63a7\u5de5\u5177\u4e2d\u904e\u6ffe\u6389\u3002\n### \u8cc7\u6e90\u6c60\u5df2\u8017\u76e1\n\u5275\u5efa Google Cloud \u8cc7\u6e90\u6642\uff0c\u60a8\u53ef\u80fd\u6703\u770b\u5230\u8017\u76e1\u7684\u8cc7\u6e90\u6c60\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nERROR: ZONE_RESOURCE_POOL_EXHAUSTED\n```\n\u7279\u5b9a\u53ef\u7528\u5340\u4e2d\u7684\u7279\u5b9a\u8cc7\u6e90\u7684\u81e8\u6642\u7f3a\u4e4f\u60c5\u6cc1\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u7232\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u60a8\u53ef\u4ee5\u7b49\u5f85\u8cc7\u6e90\uff0c\u4e5f\u53ef\u4ee5\u5728\u53e6\u4e00\u500b\u53ef\u7528\u5340\u5275\u5efa\u76f8\u540c\u7684\u8cc7\u6e90\u3002\u6211\u5011\u5efa\u8b70\u7684\u6700\u4f73\u5be6\u8e10\u662f\uff0c\u5c07\u8cc7\u6e90\u5206\u4f48\u5230 [\u591a\u500b\u53ef\u7528\u5340\u548c\u5340\u57df](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#choosing_a_region_and_zone) \uff0c\u4ee5\u61c9\u5c0d\u670d\u52d9\u4e2d\u65b7\u60c5\u6cc1\u3002\n### Java \u904b\u884c\u6642\u74b0\u5883\u6aa2\u6e2c\u5230\u56b4\u91cd\u932f\u8aa4\n\u5de5\u4f5c\u5668\u5553\u52d5\u671f\u9593\uff0c\u7cfb\u7d71\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nA fatal error has been detected by the Java Runtime Environment\n```\n\u5982\u679c\u6d41\u6c34\u7dda\u4f7f\u7528 Java \u539f\u751f\u63a5\u53e3 (JNI) \u904b\u884c\u975e Java \u4ee3\u78bc\uff0c\u4e26\u4e14\u8a72\u4ee3\u78bc\u6216 JNI \u7d81\u5b9a\u5305\u542b\u932f\u8aa4\uff0c\u5247\u7cfb\u7d71\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n### googclient_deliveryattempt \u5c6c\u6027\u9375\u932f\u8aa4\n\u60a8\u7684 Dataflow \u4f5c\u696d\u5931\u6557\uff0c\u4e26\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\u4e4b\u4e00\uff1a\n```\nThe request contains an attribute key that is not valid (key=googclient_deliveryattempt). Attribute keys must be non-empty and must not begin with 'goog' (case-insensitive).\n```\n\u6216\uff1a\n```\nInvalid extensions name: googclient_deliveryattempt\n```\n\u5982\u679c\u60a8\u7684 Dataflow \u4f5c\u696d\u5177\u6709\u4ee5\u4e0b\u7279\u5fb5\uff0c\u5247\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\uff1a\n- Dataflow \u4f5c\u696d\u4f7f\u7528 Streaming Engine\u3002\n- \u6d41\u6c34\u7dda\u5177\u6709 Pub/Sub \u63a5\u6536\u5668\u3002\n- \u8a72\u6d41\u6c34\u7dda\u4f7f\u7528 [\u62c9\u53d6\u8a02\u95b1](https://cloud.google.com/pubsub/docs/pull?hl=zh-cn) \u3002\n- \u8a72\u6d41\u6c34\u7dda\u4f7f\u7528\u5176\u4e2d\u4e00\u500b [Pub/Sub \u670d\u52d9 API](https://cloud.google.com/pubsub/docs/pull?hl=zh-cn#service_apis) \u4f86\u767c\u5e03\u6d88\u606f\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u5167\u7f6e\u7684 Pub/Sub I/O \u63a5\u6536\u5668\u3002\n- Pub/Sub \u4f7f\u7528 Java \u6216 C# [\u5ba2\u6236\u7aef\u5eab](https://cloud.google.com/pubsub/docs/pull?hl=zh-cn#client_libraries) \u3002\n- Pub/Sub \u8a02\u95b1\u5177\u6709 [\u6b7b\u4fe1\u4e3b\u984c](https://cloud.google.com/pubsub/docs/handling-failures?hl=zh-cn#dead_letter_topic) \u3002\n\u767c\u751f\u6b64\u932f\u8aa4\u7684\u539f\u56e0\u662f\u5982\u679c\u60a8\u4f7f\u7528 Pub/Sub Java \u6216 C# \u5ba2\u6236\u7aef\u5eab\u4e26\u5553\u7528\u8a02\u95b1\u7684\u6b7b\u4fe1\u4e3b\u984c\uff0c\u5247\u50b3\u9001\u5617\u8a66\u6703\u5728 `googclient_deliveryattempt` \u6d88\u606f\u5c6c\u6027\u4e2d\uff0c\u800c\u4e0d\u662f\u5728 `delivery_attempt` \u5b57\u6bb5\u4e2d\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u201c\u8655\u7406\u6d88\u606f\u5931\u6557\u201d\u9801\u9762\u4e2d\u7684 [\u8ddf\u8e64\u50b3\u9001\u5617\u8a66](https://cloud.google.com/pubsub/docs/handling-failures?hl=zh-cn#track-delivery-attempts) \u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u9032\u884c\u4ee5\u4e0b\u4e00\u9805\u6216\u591a\u9805\u66f4\u6539\u3002\n- [\u505c\u7528 Streaming Engine](https://cloud.google.com/dataflow/docs/streaming-engine?hl=zh-cn#use) \u3002\n- \u4f7f\u7528\u5167\u7f6e\u7684 [Apache Beam PubSubIO \u9023\u63a5\u5668](https://beam.apache.org/documentation/io/connectors/) \uff0c\u800c\u4e0d\u662f Pub/Sub \u670d\u52d9 API\u3002\n- \u4f7f\u7528\u5176\u4ed6\u985e\u578b\u7684 [Pub/Sub \u8a02\u95b1](https://cloud.google.com/pubsub/docs/subscription-overview?hl=zh-cn#push_pull) \u3002\n- [\u79fb\u9664\u6b7b\u4fe1\u4e3b\u984c](https://cloud.google.com/pubsub/docs/handling-failures?hl=zh-cn#removing_a_dead_letter_topic) \u3002\n- \u8acb\u52ff\u5c07 Java \u6216 C# \u5ba2\u6236\u7aef\u5eab\u8207 Pub/Sub \u62c9\u53d6\u8a02\u95b1\u642d\u914d\u4f7f\u7528\u3002\u5982\u9700\u77ad\u89e3\u5176\u4ed6\u9078\u9805\uff0c\u8acb\u53c3\u95b1 [\u5ba2\u6236\u7aef\u5eab\u4ee3\u78bc\u793a\u4f8b](https://cloud.google.com/pubsub/docs/pull?hl=zh-cn#client_library_code_samples) \u3002\n- \u5728\u6d41\u6c34\u7dda\u4ee3\u78bc\u4e2d\uff0c\u7576\u5c6c\u6027\u9375\u4ee5`goog`\u958b\u982d\u6642\uff0c\u8acb\u5148\u6e05\u7a7a\u6d88\u606f\u5c6c\u6027\uff0c\u7136\u5f8c\u518d\u767c\u5e03\u6d88\u606f\u3002\n### \u6aa2\u6e2c\u5230\u71b1\u9375 ...\n\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nA hot key HOT_KEY_NAME was detected in...\n```\n\u5982\u679c\u60a8\u7684\u6578\u64da\u5305\u542b\u71b1\u9375\uff0c\u5247\u6703\u767c\u751f\u9019\u4e9b\u932f\u8aa4\u3002\u71b1\u9375\u662f\u5177\u6709\u5f88\u591a\u5143\u7d20\u4e26\u5c0d\u6d41\u6c34\u7dda\u6027\u80fd\u9020\u6210\u4e0d\u5229\u5f71\u97ff\u7684\u9375\u3002\u9019\u4e9b\u9375\u6703\u9650\u5236 Dataflow \u4e26\u884c\u8655\u7406\u5143\u7d20\u7684\u80fd\u529b\uff0c\u5f9e\u800c\u589e\u52a0\u57f7\u884c\u6642\u9593\u3002\n\u5982\u9700\u5728\u6d41\u6c34\u7dda\u4e2d\u6aa2\u6e2c\u5230\u71b1\u9375\u6642\u5c07\u7c21\u55ae\u6613\u61c2\u7684\u9375\u8f38\u51fa\u5230\u65e5\u8a8c\uff0c\u8acb\u4f7f\u7528 [\u71b1\u9375\u6d41\u6c34\u7dda\u9078\u9805](https://cloud.google.com/dataflow/docs/reference/pipeline-options?hl=zh-cn#debugging) \u3002\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u6aa2\u67e5\u60a8\u7684\u6578\u64da\u662f\u5426\u5747\u52fb\u5206\u4f48\u3002\u5982\u679c\u67d0\u500b\u9375\u5177\u6709\u7570\u5e38\u591a\u7684\u503c\uff0c\u8acb\u8003\u616e\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u6d41\u7a0b\uff1a\n- \u91cd\u65b0\u751f\u6210\u6578\u64da\u9375\u3002\u61c9\u7528 [ParDo](https://beam.apache.org/documentation/programming-guide/#pardo) \u8f49\u63db\u4f86\u8f38\u51fa\u65b0\u7684\u9375\u503c\u5c0d\u3002\n- \u5c0d\u65bc Java \u4f5c\u696d\uff0c\u8acb\u4f7f\u7528 [Combine.PerKey.withHotKeyFanout](https://beam.apache.org/releases/javadoc/current/org/apache/beam/sdk/transforms/Combine.PerKey.html) \u8f49\u63db\u3002\n- \u5c0d\u65bc Python \u4f5c\u696d\uff0c\u8acb\u4f7f\u7528 [CombinePerKey.with_hot_key_fanout](https://beam.apache.org/releases/pydoc/current/apache_beam.transforms.core.html#apache_beam.transforms.core.CombinePerKey.with_hot_key_fanout) \u8f49\u63db\u3002\n- \u5553\u7528 [Dataflow Shuffle](https://cloud.google.com/dataflow/docs/shuffle-for-batch?hl=zh-cn) \u3002\n\u5982\u9700\u5728 Dataflow \u76e3\u63a7\u754c\u9762\u4e2d\u67e5\u770b\u71b1\u9375\uff0c\u8acb\u53c3\u95b1 [\u6392\u67e5\u6279\u91cf\u4f5c\u696d\u4e2d\u7684 Straggler \u554f\u984c](https://cloud.google.com/dataflow/docs/guides/troubleshoot-batch-stragglers?hl=zh-cn) \u3002\n### Data Catalog \u4e2d\u7684\u8868\u898f\u7bc4\u7121\u6548\n\u4f7f\u7528 Dataflow SQL \u5275\u5efa Dataflow SQL \u4f5c\u696d\u6642\uff0c\u4f5c\u696d\u53ef\u80fd\u6703\u5931\u6557\uff0c\u4e26\u4e14\u65e5\u8a8c\u6587\u4ef6\u4e2d\u6703\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nInvalid table specification in Data Catalog: Could not resolve table in Data Catalog\n```\n\u5982\u679c Dataflow \u670d\u52d9\u8cec\u865f\u7121\u6b0a\u8a2a\u554f Data Catalog API\uff0c\u5247\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u7232\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u5728\u60a8\u7528\u65bc\u7de8\u5beb\u548c\u904b\u884c\u67e5\u8a62\u7684 Google Cloud [\u9805\u76ee](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy?hl=zh-cn#projects) \u4e2d [\u5553\u7528 Data Catalog API](https://cloud.google.com/apis/docs/enable-disable-apis?hl=zh-cn#enabling_apis) \u3002\n\u6216\u8005\uff0c\u5c07 `roles/datacatalog.viewer` \u89d2\u8272\u5206\u914d\u7d66 [Dataflow \u670d\u52d9\u8cec\u865f](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#security_and_permissions_for_pipelines_on) \u3002\n### \u4f5c\u696d\u5716\u904e\u5927\n\u60a8\u7684\u4f5c\u696d\u53ef\u80fd\u6703\u5931\u6557\uff0c\u4e26\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nThe job graph is too large. Please try again with a smaller job graph,\nor split your job into two or more smaller jobs.\n```\n\u5982\u679c\u4f5c\u696d\u7684\u5716\u5927\u5c0f\u8d85\u904e 10 MB\uff0c\u5247\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002\u6d41\u6c34\u7dda\u4e2d\u7684\u67d0\u4e9b\u60c5\u6cc1\u53ef\u80fd\u6703\u5c0e\u81f4\u4f5c\u696d\u5716\u8d85\u51fa\u6b64\u4e0a\u9650\u3002\u5e38\u898b\u60c5\u6cc1\u5305\u62ec\uff1a\n- \u5305\u542b\u5927\u91cf\u5167\u5b58\u6578\u64da\u7684`Create`\u8f49\u63db\u3002\n- \u5927\u578b`DoFn`\u5be6\u4f8b\uff08\u9032\u884c\u5e8f\u5217\u5316\u8655\u7406\u5f8c\u50b3\u8f38\u7d66\u9060\u7a0b\u5de5\u4f5c\u5668\uff09\u3002\n- \u4f5c\u7232\u533f\u540d\u5167\u90e8\u985e\u5be6\u4f8b\u7684`DoFn`\uff0c\u8a72\u5be6\u4f8b\uff08\u53ef\u80fd\u7121\u610f\u4e2d\uff09\u5f15\u5165\u4e86\u5927\u91cf\u8981\u5e8f\u5217\u5316\u7684\u6578\u64da\u3002\n- \u5728\u679a\u8209\u5927\u578b\u5217\u8868\u7684\u7de8\u7a0b\u5faa\u74b0\u4e2d\u4f7f\u7528\u6709\u5411\u7121\u74b0\u5716 (DAG)\u3002\n\u7232\u4e86\u907f\u514d\u9019\u4e9b\u60c5\u6cc1\uff0c\u8acb\u8003\u616e\u91cd\u65b0\u69cb\u9020\u60a8\u7684\u6d41\u6c34\u7dda\u3002\n### \u5bc6\u9470\u63d0\u4ea4\u904e\u5927\n\u904b\u884c\u6d41\u5f0f\u4f5c\u696d\u6642\uff0c\u5de5\u4f5c\u5668\u65e5\u8a8c\u6587\u4ef6\u4e2d\u6703\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nKeyCommitTooLargeException\n```\n\u5982\u679c\u5728\u4e0d\u4f7f\u7528 `Combine` \u8f49\u63db\u7684\u60c5\u6cc1\u4e0b\u5c07\u5927\u91cf\u6578\u64da\u5206\u7d44\uff0c\u6216\u8005\u5982\u679c\u901a\u904e\u55ae\u500b\u8f38\u5165\u5143\u7d20\u751f\u6210\u5927\u91cf\u6578\u64da\uff0c\u5247\u5728\u6d41\u5f0f\u50b3\u8f38\u5834\u666f\u4e2d\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u7232\u4e86\u964d\u4f4e\u767c\u751f\u6b64\u932f\u8aa4\u7684\u53ef\u80fd\u6027\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u7b56\u7565\uff1a\n- \u78ba\u4fdd\u8655\u7406\u55ae\u500b\u5143\u7d20\u4e0d\u6703\u5c0e\u81f4\u8f38\u51fa\u6216\u72c0\u614b\u4fee\u6539\u8d85\u51fa\u9650\u5236\u3002\n- \u5982\u679c\u6309\u4e00\u500b\u9375\u5206\u7d44\u4e86\u591a\u500b\u5143\u7d20\uff0c\u8acb\u8003\u616e\u589e\u52a0\u9375\u7a7a\u9593\u4ee5\u6e1b\u5c11\u6309\u9375\u5206\u7d44\u7684\u5143\u7d20\u3002\n- \u5982\u679c\u67d0\u500b\u9375\u7684\u5143\u7d20\u5728\u77ed\u6642\u9593\u5167\u4ee5\u9ad8\u983b\u7387\u767c\u51fa\uff0c\u9019\u53ef\u80fd\u6703\u5c0e\u81f4\u5728\u6642\u9593\u7bc4\u570d\u5167\u7522\u751f\u8a72\u9375\u7684\u5927\u91cf\u4e8b\u4ef6\uff08\u4ee5 GB \u7232\u55ae\u4f4d\uff09\u3002\u8acb\u91cd\u65b0\u7de8\u5beb\u6d41\u6c34\u7dda\u4ee5\u6aa2\u6e2c\u6b64\u985e\u9375\uff0c\u4e26\u50c5\u767c\u51fa\u6307\u660e\u76f8\u61c9\u9375\u5728\u6642\u9593\u7bc4\u570d\u4e2d\u983b\u7e41\u51fa\u73fe\u7684\u8f38\u51fa\u3002\n- \u4f7f\u7528\u6b21\u7dda\u6027\u7a7a\u9593`Combine`\u8f49\u63db\u57f7\u884c\u4ea4\u63db\u548c\u95dc\u806f\u64cd\u4f5c\u3002\u5982\u679c\u4e00\u500b\u7d44\u5408\u5668\u4e0d\u80fd\u6e1b\u5c11\u7a7a\u9593\uff0c\u8acb\u4e0d\u8981\u4f7f\u7528\u5b83\u3002\u4f8b\u5982\uff0c\u6c92\u6709\u5fc5\u8981\u4f7f\u7528\u53ea\u662f\u5c07\u5b57\u7b26\u4e32\u9023\u63a5\u8d77\u4f86\u7684\u5b57\u7b26\u4e32\u7d44\u5408\u5668\u3002\n### \u62d2\u7d55\u8d85\u904e 7168K \u7684\u6d88\u606f\n\u7576\u60a8\u904b\u884c\u901a\u904e\u6a21\u677f\u5275\u5efa\u7684 Dataflow \u4f5c\u696d\u6642\uff0c\u8a72\u4f5c\u696d\u53ef\u80fd\u6703\u5931\u6557\uff0c\u4e26\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nError: CommitWork failed: status: APPLICATION_ERROR(3): Pubsub publish requests are limited to 10MB, rejecting message over 7168K (size MESSAGE_SIZE) to avoid exceeding limit with byte64 request encoding.\n```\n\u7576\u5beb\u5165\u6b7b\u4fe1\u968a\u5217\u7684\u6d88\u606f\u8d85\u904e 7168\u00a0K \u7684\u5927\u5c0f\u9650\u5236\u6642\uff0c\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u5553\u7528 [Streaming Engine](https://cloud.google.com/dataflow/docs/streaming-engine?hl=zh-cn) \uff0c\u5176\u5927\u5c0f\u9650\u5236\u66f4\u9ad8\u3002\u5982\u9700\u5553\u7528 Streaming Engine\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b [\u6d41\u6c34\u7dda\u9078\u9805](https://cloud.google.com/dataflow/docs/reference/pipeline-options?hl=zh-cn#streaming_pipeline_management) \u3002\n`--enableStreamingEngine=true`\n`--enable_streaming_engine=true`\n### Request Entity Too Large\n\u63d0\u4ea4\u4f5c\u696d\u6642\uff0c\u63a7\u5236\u6aaf\u6216\u7d42\u7aef\u7a97\u53e3\u4e2d\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\u4e4b\u4e00\uff1a\n```\n413 Request Entity Too Large\nThe size of serialized JSON representation of the pipeline exceeds the allowable limit\nFailed to create a workflow job: Invalid JSON payload received\nFailed to create a workflow job: Request payload exceeds the allowable limit\n```\n\u5982\u679c\u5728\u63d0\u4ea4\u4f5c\u696d\u6642\u51fa\u73fe\u6709\u95dc JSON \u8f09\u8377\u7684\u932f\u8aa4\uff0c\u5247\u6d41\u6c34\u7dda\u7684 JSON \u8868\u793a\u6cd5\u6703\u8d85\u904e 20\u00a0MB \u7684\u8acb\u6c42\u5927\u5c0f\u4e0a\u9650\u3002\n\u4f5c\u696d\u7684\u5927\u5c0f\u8207\u6d41\u6c34\u7dda\u7684 JSON \u8868\u793a\u6cd5\u95dc\u806f\u3002\u6d41\u6c34\u7dda\u8d8a\u5927\uff0c\u610f\u5473\u7740\u8acb\u6c42\u8d8a\u5927\u3002Dataflow \u7684\u8acb\u6c42\u5927\u5c0f\u4e0a\u9650\u7232 20\u00a0MB\u3002\n\u5982\u9700\u4f30\u7b97\u6d41\u6c34\u7dda\u7684 JSON \u8acb\u6c42\u5927\u5c0f\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u9078\u9805\u904b\u884c\u6d41\u6c34\u7dda\uff1a\n`--dataflowJobFile=` ``\n`--dataflow_job_file=` ``\nGo \u4e0d\u652f\u6301\u4ee5 JSON \u683c\u5f0f\u8f38\u51fa\u4f5c\u696d\u3002\n\u6b64\u547d\u4ee4\u6703\u5c07\u4f5c\u696d\u7684 JSON \u8868\u793a\u5beb\u5165\u6587\u4ef6\u4e2d\u3002\u60a8\u6700\u597d\u6839\u64da\u5e8f\u5217\u5316\u6587\u4ef6\u7684\u5927\u5c0f\u4f86\u4f30\u7b97\u8acb\u6c42\u5927\u5c0f\u3002\u7531\u65bc\u8acb\u6c42\u4e2d\u5305\u542b\u4e00\u4e9b\u5176\u4ed6\u4fe1\u606f\uff0c\u5be6\u969b\u5927\u5c0f\u5c07\u6703\u7565\u5927\u4e00\u4e9b\u3002\n\u6d41\u6c34\u7dda\u4e2d\u7684\u67d0\u4e9b\u60c5\u6cc1\u53ef\u80fd\u6703\u5c0e\u81f4 JSON \u8868\u793a\u6cd5\u8d85\u51fa\u9650\u984d\u3002\u5e38\u898b\u60c5\u6cc1\u5305\u62ec\uff1a\n- \u5305\u542b\u5927\u91cf\u5167\u5b58\u6578\u64da\u7684`Create`\u8f49\u63db\u3002\n- \u5927\u578b`DoFn`\u5be6\u4f8b\uff08\u9032\u884c\u5e8f\u5217\u5316\u8655\u7406\u5f8c\u50b3\u8f38\u7d66\u9060\u7a0b\u5de5\u4f5c\u5668\uff09\u3002\n- \u4f5c\u7232\u533f\u540d\u5167\u90e8\u985e\u5be6\u4f8b\u7684`DoFn`\uff0c\u8a72\u5be6\u4f8b\uff08\u53ef\u80fd\u7121\u610f\u4e2d\uff09\u5f15\u5165\u4e86\u5927\u91cf\u8981\u5e8f\u5217\u5316\u7684\u6578\u64da\u3002\n\u7232\u4e86\u907f\u514d\u9019\u4e9b\u60c5\u6cc1\uff0c\u8acb\u8003\u616e\u91cd\u65b0\u69cb\u9020\u60a8\u7684\u6d41\u6c34\u7dda\u3002\n### SDK \u6d41\u6c34\u7dda\u9078\u9805\u6216\u66ab\u5b58\u6587\u4ef6\u5217\u8868\u8d85\u51fa\u5927\u5c0f\u9650\u5236\n\u904b\u884c\u6d41\u6c34\u7dda\u6642\uff0c\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\u4e4b\u4e00\uff1a\n```\nSDK pipeline options or staging file list exceeds size limit.\nPlease keep their length under 256K Bytes each and 512K Bytes in total.\n```\n\u6216\uff1a\n```\nValue for field 'resource.properties.metadata' is too large: maximum size\n```\n\u5982\u679c\u7531\u65bc\u8d85\u51fa Compute Engine \u5143\u6578\u64da\u9650\u5236\u800c\u7121\u6cd5\u5553\u52d5\u6d41\u6c34\u7dda\uff0c\u5247\u6703\u51fa\u73fe\u9019\u4e9b\u932f\u8aa4\u3002\u9019\u4e9b\u9650\u5236\u4e0d\u80fd\u66f4\u6539\u3002Dataflow \u7232\u6d41\u6c34\u7dda\u9078\u9805\u4f7f\u7528 Compute Engine \u5143\u6578\u64da\u3002Compute Engine \u81ea\u5b9a\u7fa9\u5143\u6578\u64da [\u9650\u5236](https://cloud.google.com/compute/docs/metadata/setting-custom-metadata?hl=zh-cn#limitations) \u4e2d\u8a18\u9304\u4e86\u6b64\u9650\u5236\u3002\n\u4ee5\u4e0b\u60c5\u6cc1\u53ef\u80fd\u6703\u5c0e\u81f4 JSON \u8868\u793a\u6cd5\u8d85\u51fa\u9650\u5236\uff1a\n- \u8981\u66ab\u5b58\u7684 JAR \u6587\u4ef6\u904e\u591a\u3002\n- `sdkPipelineOptions`\u8acb\u6c42\u5b57\u6bb5\u904e\u5927\u3002\n\u5982\u9700\u4f30\u7b97\u6d41\u6c34\u7dda\u7684 JSON \u8acb\u6c42\u5927\u5c0f\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u9078\u9805\u904b\u884c\u6d41\u6c34\u7dda\uff1a\n`--dataflowJobFile=` ``\n`--dataflow_job_file=` ``\nGo \u4e0d\u652f\u6301\u4ee5 JSON \u683c\u5f0f\u8f38\u51fa\u4f5c\u696d\u3002\n\u6b64\u547d\u4ee4\u7684\u8f38\u51fa\u6587\u4ef6\u7684\u5927\u5c0f\u5fc5\u9808\u5c0f\u65bc 256 KB\u3002\u932f\u8aa4\u6d88\u606f\u4e2d\u7684 512\u00a0KB \u662f\u6307\u8f38\u51fa\u6587\u4ef6\u7684\u7e3d\u5927\u5c0f\u548c Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u81ea\u5b9a\u7fa9\u5143\u6578\u64da\u9078\u9805\u3002\n\u60a8\u53ef\u4ee5\u901a\u904e\u9805\u76ee\u4e2d\u6b63\u5728\u904b\u884c\u7684 Dataflow \u4f5c\u696d\u4f86\u7c97\u7565\u4f30\u8a08\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u81ea\u5b9a\u7fa9\u5143\u6578\u64da\u9078\u9805\u3002\u9078\u64c7\u4efb\u4f55\u6b63\u5728\u904b\u884c\u7684 Dataflow \u4f5c\u696d\u3002\u7372\u53d6\u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u7136\u5f8c\u5c0e\u822a\u5230\u8a72\u865b\u64ec\u6a5f\u7684 Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\u8a73\u60c5\u9801\u9762\uff0c\u4ee5\u6aa2\u67e5\u81ea\u5b9a\u7fa9\u5143\u6578\u64da\u90e8\u5206\u3002\u81ea\u5b9a\u7fa9\u5143\u6578\u64da\u548c\u6587\u4ef6\u7684\u7e3d\u9577\u5ea6\u61c9\u5c0f\u65bc 512 KB\u3002\u7121\u6cd5\u6e96\u78ba\u4f30\u8a08\u5931\u6557\u7684\u4f5c\u696d\uff0c\u56e0\u7232\u865b\u64ec\u6a5f\u4e0d\u6703\u7232\u5931\u6557\u7684\u4f5c\u696d\u5553\u52d5\u3002\n\u5982\u679c\u60a8\u7684 JAR \u5217\u8868\u9054\u5230\u4e86 256-KB \u7684\u9650\u5236\uff0c\u8acb\u9032\u884c\u6aa2\u67e5\u4e26\u6e1b\u5c11\u4efb\u4f55\u4e0d\u5fc5\u8981\u7684 JAR \u6587\u4ef6\u3002\u5982\u679c\u8a72\u5217\u8868\u4ecd\u7136\u904e\u5927\uff0c\u8acb\u5617\u8a66\u4f7f\u7528\u8d85\u7d1a JAR \u904b\u884c Dataflow \u4f5c\u696d\u3002\u5982\u9700\u67e5\u770b\u6f14\u793a\u5982\u4f55\u5275\u5efa\u548c\u4f7f\u7528\u8d85\u7d1a JAR \u7684\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1 [\u69cb\u5efa\u548c\u90e8\u7f72\u8d85\u7d1a JAR](https://cloud.google.com/functions/docs/concepts/java-deploy?hl=zh-cn#build_and_deploy_an_uber_jar) \u3002\n\u5982\u679c `sdkPipelineOptions` \u8acb\u6c42\u5b57\u6bb5\u904e\u5927\uff0c\u8acb\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u5305\u62ec\u4ee5\u4e0b\u9078\u9805\u3002\u8a72\u6d41\u6c34\u7dda\u9078\u9805\u5728 Java\u3001Python \u548c Go \u4e2d\u662f\u76f8\u540c\u7684\u3002\n```\n--experiments=no_display_data_on_gce_metadata\n```\n### \u91cd\u6392\u9375\u904e\u5927\n\u5de5\u4f5c\u5668\u65e5\u8a8c\u6587\u4ef6\u4e2d\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nShuffle key too large\n```\n\u5728\u61c9\u7528\u76f8\u61c9\u7de8\u78bc\u5668\u5f8c\uff0c\u5982\u679c\u767c\u9001\u5230\u7279\u5b9a (Co-)GroupByKey \u7684\u5e8f\u5217\u5316\u9375\u592a\u5927\uff0c\u5247\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002Dataflow \u5c0d\u5e8f\u5217\u5316 shuffle \u9375\u6709\u9650\u5236\u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u6e1b\u5c0f\u9375\u7684\u5927\u5c0f\u6216\u4f7f\u7528\u66f4\u7bc0\u7701\u7a7a\u9593\u7684\u7de8\u78bc\u5668\u3002\n### BoundedSource \u5c0d\u8c61\u7e3d\u6578 ... \u5927\u65bc\u5141\u8a31\u7684\u9650\u984d\n\u4f7f\u7528 Java \u904b\u884c\u4f5c\u696d\u6642\uff0c\u53ef\u80fd\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\u4e4b\u4e00\uff1a\n```\nTotal number of BoundedSource objects generated by splitIntoBundles() operation is larger than the allowable limit\n```\n\u6216\uff1a\n```\nTotal size of the BoundedSource objects generated by splitIntoBundles() operation is larger than the allowable limit\n```\n\u5982\u679c\u60a8\u4f7f\u7528\u7d93\u7531\u5c0e\u51fa\u7684 `TextIO` \u3001 `AvroIO` \u3001 `BigQueryIO` \u6216\u5176\u4ed6\u4e00\u4e9b\u57fa\u65bc\u6587\u4ef6\u7684\u4f86\u6e90\u8b80\u53d6\u5927\u91cf\u6587\u4ef6\uff0c\u5247\u53ef\u80fd\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002\u7279\u5b9a\u7684\u4e0a\u9650\u53d6\u6c7a\u65bc\u4f86\u6e90\u7684\u7d30\u7bc0\uff0c\u4f46\u4e00\u500b\u6d41\u6c34\u7dda\u4e2d\u5927\u7d04\u6709\u6578\u842c\u500b\u6587\u4ef6\u3002\u4f8b\u5982\uff0c\u5728 `AvroIO.Read` \u4e2d\u5d4c\u5165\u67b6\u69cb\u53ef\u5141\u8a31\u8f03\u5c11\u7684\u6587\u4ef6\u3002\n\u5982\u679c\u60a8\u7232\u6d41\u6c34\u7dda\u5275\u5efa\u4e86\u81ea\u5b9a\u7fa9\u6578\u64da\u6e90\uff0c\u4e26\u4e14\u6578\u64da\u6e90\u7684 `splitIntoBundles` \u65b9\u6cd5\u8fd4\u56de\u4e86\u4e00\u500b\u5e8f\u5217\u5316\u5f8c\u8d85\u904e 20\u00a0MB \u7684 `BoundedSource` \u5c0d\u8c61\u7684\u5217\u8868\uff0c\u5247\u4e5f\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u81ea\u5b9a\u7fa9\u4f86\u6e90\u7684 `splitIntoBundles()` \u64cd\u4f5c\u751f\u6210\u7684 `BoundedSource` \u5c0d\u8c61\u7e3d\u5927\u5c0f\u7684\u5141\u8a31\u9650\u984d\u7232 20\u00a0MB\u3002\n\u5982\u9700\u898f\u907f\u6b64\u9650\u5236\uff0c\u8acb\u9032\u884c\u4ee5\u4e0b\u67d0\u9805\u66f4\u6539\uff1a- \u5553\u7528 [Runner V2](https://cloud.google.com/dataflow/docs/runner-v2?hl=zh-cn) \u3002Runner v2 \u6703\u5c07\u4f86\u6e90\u8f49\u63db\u7232\u6c92\u6709\u6b64\u4f86\u6e90\u62c6\u5206\u9650\u5236\u7684\u53ef\u62c6\u5206 DoFn\u3002\n- \u4fee\u6539\u81ea\u5b9a\u7fa9 `BoundedSource` \u5b50\u985e\uff0c\u4ee5\u4f7f\u751f\u6210\u7684 `BoundedSource` \u5c0d\u8c61\u7684\u7e3d\u5927\u5c0f\u4f4e\u65bc 20-MB \u7684\u9650\u5236\u3002\u4f8b\u5982\uff0c\u60a8\u7684\u6578\u64da\u6e90\u6700\u521d\u53ef\u80fd\u6703\u751f\u6210\u8f03\u5c11\u7684\u62c6\u5206\uff0c\u4e26\u4f9d\u8cf4 [\u52d5\u614b\u5de5\u4f5c\u8ca0\u8f09\u518d\u5e73\u8861](https://cloud.google.com/dataflow/docs/dynamic-work-rebalancing?hl=zh-cn) \u4f86\u6309\u9700\u9032\u4e00\u6b65\u62c6\u5206\u8f38\u5165\u3002\n### \u540d\u7a31\u932f\u8aa4\n\u4f7f\u7528 Dataflow \u670d\u52d9\u57f7\u884c\u6d41\u6c34\u7dda\u6642\uff0c\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nNameError\n```\n\u672c\u5730\u57f7\u884c\u6642\uff08\u4f8b\u5982\u4f7f\u7528 `DirectRunner` \u57f7\u884c\u6642\uff09\uff0c\u4e0d\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u5982\u679c `DoFn` \u4f7f\u7528\u7684\u5168\u5c40\u547d\u540d\u7a7a\u9593\u4e2d\u7684\u503c\u5728 Dataflow \u5de5\u4f5c\u5668\u4e0a\u4e0d\u53ef\u7528\uff0c\u5247\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u5728 Dataflow \u4f5c\u696d\u5e8f\u5217\u5316\u671f\u9593\uff0c\u7cfb\u7d71\u4e0d\u6703\u4fdd\u5b58\u5728\u4e3b\u6703\u8a71\u4e2d\u5b9a\u7fa9\u7684\u5168\u5c40\u5c0e\u5165\u9805\u3001\u51fd\u6578\u548c\u8b8a\u91cf\u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u4e4b\u4e00\u3002\u5982\u679c `DoFn` \u662f\u5728\u4e3b\u6587\u4ef6\u4e2d\u5b9a\u7fa9\u7684\uff0c\u4e26\u4e14\u5728\u5168\u5c40\u547d\u540d\u7a7a\u9593\u4e2d\u5f15\u7528\u4e86\u5c0e\u5165\u9805\u548c\u51fd\u6578\uff0c\u8acb\u5c07 `--save_main_session` \u6d41\u6c34\u7dda\u9078\u9805\u8a2d\u7f6e\u7232 `True` \u3002\u6b64\u66f4\u6539\u6703\u5c07\u5168\u5c40\u547d\u540d\u7a7a\u9593\u7684\u72c0\u614b pickle \u548c\u52a0\u8f09\u5230 Dataflow \u5de5\u4f5c\u5668\u4e0a\u3002\n\u5982\u679c\u5168\u5c40\u547d\u540d\u7a7a\u9593\u4e2d\u7684\u5c0d\u8c61\u7121\u6cd5\u9032\u884c pickle\uff0c\u5247\u6703\u51fa\u73fe pickling \u932f\u8aa4\u3002\u5982\u679c\u6b64\u932f\u8aa4\u8207 Python \u767c\u884c\u7248\u4e2d\u61c9\u63d0\u4f9b\u7684\u6a21\u584a\u6709\u95dc\uff0c\u8acb\u5728\u4f7f\u7528\u8a72\u6a21\u584a\u7684\u4f4d\u7f6e\u672c\u5730\u5c0e\u5165\u8a72\u6a21\u584a\u3002\n\u4f8b\u5982\uff0c\u60a8\u4e0d\u61c9\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\nimport re\n\u2026\ndef myfunc():\n # use re module\n```\n\u800c\u61c9\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ndef myfunc():\n import re\n # use re module\n```\n\u6216\u8005\uff0c\u5982\u679c\u60a8\u7684 `DoFn` \u6db5\u84cb\u591a\u500b\u6587\u4ef6\uff0c\u8acb\u4f7f\u7528\u5176\u4ed6\u65b9\u6cd5\u4f86\u5c01\u88dd\u5de5\u4f5c\u6d41\u548c [\u7ba1\u7406\u4f9d\u8cf4\u9805](https://beam.apache.org/documentation/sdks/python-pipeline-dependencies/) \u3002\n### \u8655\u7406\u505c\u6eef\u6216\u64cd\u4f5c\u6b63\u5728\u9032\u884c\n\u5982\u679c Dataflow \u57f7\u884c `DoFn` \u7684\u6642\u9593\u8d85\u904e \u4e2d\u6307\u5b9a\u7684\u6642\u9593\u4e14\u672a\u8fd4\u56de\uff0c\u5247\u7cfb\u7d71\u6703\u986f\u793a\u4ee5\u4e0b\u6d88\u606f\u3002\n\u4ee5\u4e0b\u5169\u689d\u65e5\u8a8c\u6d88\u606f\u4e4b\u4e00\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u7248\u672c\uff1a\n`Processing stuck in step` `` `for at least` ``\n`Operation ongoing in bundle` `` `for at least` `` `without outputting or completing: at` ```Operation ongoing for over` `` `in state` `` `in step` `` `without returning. Current Traceback:` ```Operation ongoing in transform` `` `for at least` `` `without outputting or completing in state` ``\n\u6b64\u884c\u7232\u6709\u5169\u500b\u53ef\u80fd\u7684\u539f\u56e0\uff1a\n- `DoFn`\u4ee3\u78bc\u904b\u884c\u5f88\u6162\uff0c\u6216\u5728\u7b49\u5f85\u4e00\u4e9b\u7de9\u6162\u7684\u5916\u90e8\u64cd\u4f5c\u5b8c\u6210\u3002\n- \u60a8\u7684`DoFn`\u4ee3\u78bc\u53ef\u80fd\u88ab\u5361\u4f4f\u3001\u51fa\u73fe\u6b7b\u9396\u6216\u904b\u884c\u7570\u5e38\u7de9\u6162\uff0c\u96e3\u4ee5\u5b8c\u6210\u8655\u7406\u3002\n\u5982\u9700\u78ba\u5b9a\u662f\u54ea\u7a2e\u60c5\u6cc1\uff0c\u8acb\u5c55\u958b [Cloud Monitoring](https://cloud.google.com/dataflow/docs/guides/using-cloud-monitoring?hl=zh-cn) \u65e5\u8a8c\u689d\u76ee\u4ee5\u67e5\u770b\u5806\u68e7\u8ecc\u8de1\u3002\u67e5\u627e\u8868\u660e `DoFn` \u4ee3\u78bc\u5361\u4f4f\u6216\u51fa\u73fe\u5176\u4ed6\u554f\u984c\u7684\u6d88\u606f\u3002\u5982\u679c\u4e0d\u5b58\u5728\u6d88\u606f\uff0c\u5247\u53ef\u80fd\u662f `DoFn` \u4ee3\u78bc\u7684\u57f7\u884c\u901f\u5ea6\u6709\u554f\u984c\u3002\u8acb\u8003\u616e\u4f7f\u7528 [Cloud Profiler](https://cloud.google.com/dataflow/docs/guides/profiling-a-pipeline?hl=zh-cn) \u6216\u5176\u4ed6\u5de5\u5177\u4f86\u8abf\u67e5\u4ee3\u78bc\u7684\u6027\u80fd\u3002\n\u5982\u679c\u60a8\u7684\u6d41\u6c34\u7dda\u662f\u5728 Java \u865b\u64ec\u6a5f\u4e0a\u69cb\u5efa\u7684\uff08\u4f7f\u7528 Java \u6216 Scala\uff09\uff0c\u60a8\u53ef\u4ee5\u8abf\u67e5\u4ee3\u78bc\u5361\u4f4f\u7684\u539f\u56e0\u3002\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u5c0d\u6574\u500b JVM\uff08\u4e0d\u50c5\u50c5\u662f\u5361\u4f4f\u7684\u7dda\u7a0b\uff09\u9032\u884c\u5b8c\u6574\u7684\u7dda\u7a0b\u8f49\u5132\uff1a\n- \u8a18\u4e0b\u65e5\u8a8c\u689d\u76ee\u4e2d\u7684\u5de5\u4f5c\u5668\u540d\u7a31\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Compute Engine \u90e8\u5206\u4e2d\uff0c\u901a\u904e\u60a8\u8a18\u4e0b\u7684\u5de5\u4f5c\u5668\u540d\u7a31\u627e\u5230 Compute Engine \u5be6\u4f8b\u3002\n- \u4f7f\u7528 SSH \u9023\u63a5\u5230\u5177\u6709\u8a72\u540d\u7a31\u7684\u5be6\u4f8b\u3002\n- \u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a```\ncurl http://localhost:8081/threadz\n```\n### Pub/Sub \u914d\u984d\u932f\u8aa4\n\u5f9e Pub/Sub \u904b\u884c\u6d41\u5f0f\u6d41\u6c34\u7dda\u6642\uff0c\u6703\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\n429 (rateLimitExceeded)\n```\n\u6216\uff1a\n```\nRequest was throttled due to user QPS limit being reached\n```\n\u5982\u679c\u60a8\u7684\u9805\u76ee\u6c92\u6709\u8db3\u5920\u7684 [Pub/Sub \u914d\u984d](https://cloud.google.com/pubsub/quotas?hl=zh-cn) \uff0c\u5247\u6703\u51fa\u73fe\u9019\u4e9b\u932f\u8aa4\u3002\n\u8981\u4e86\u89e3\u60a8\u7684\u9805\u76ee\u662f\u5426\u914d\u984d\u4e0d\u8db3\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u6aa2\u67e5\u5ba2\u6236\u7aef\u932f\u8aa4\uff1a\n- \u524d\u5f80 [Google Cloud Console](https://console.cloud.google.com/?hl=zh-cn) \u3002\n- \u5728\u5de6\u5074\u83dc\u55ae\u4e2d\uff0c\u9078\u64c7 **API \u548c\u670d\u52d9** \u3002\n- \u5728 **\u641c\u7d22\u6846** \u4e2d\uff0c\u641c\u7d22 **Cloud Pub/Sub** \u3002\n- \u9ede\u64ca **\u7528\u91cf** \u6a19\u7c64\u9801\u3002\n- \u6aa2\u67e5 **\u97ff\u61c9\u4ee3\u78bc** \u4e26\u67e5\u627e`(4xx)`\u5ba2\u6236\u7aef\u932f\u8aa4\u4ee3\u78bc\u3002\n### \u7d44\u7e54\u7684\u653f\u7b56\u7981\u6b62\u8acb\u6c42\n\u904b\u884c\u6d41\u6c34\u7dda\u6642\uff0c\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nError trying to get gs://BUCKET_NAME/FOLDER/FILE:\n{\"code\":403,\"errors\":[{\"domain\":\"global\",\"message\":\"Request is prohibited by organization's policy\",\"reason\":\"forbidden\"}],\n\"message\":\"Request is prohibited by organization's policy\"}\n```\n\u5982\u679c Cloud Storage \u5b58\u5132\u6876\u4f4d\u65bc [\u670d\u52d9\u908a\u754c](https://cloud.google.com/vpc-service-controls/docs/overview?hl=zh-cn) \u5916\u90e8\uff0c\u5247\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u5275\u5efa [\u51fa\u7ad9\u898f\u5247](https://cloud.google.com/vpc-service-controls/docs/ingress-egress-rules?hl=zh-cn) \u4ee5\u5141\u8a31\u8a2a\u554f\u670d\u52d9\u908a\u754c\u5916\u7684\u5b58\u5132\u6876\u3002\n### \u66ab\u5b58\u7684\u8edf\u4ef6\u5305...\u7121\u6cd5\u8a2a\u554f\n\u904e\u53bb\u6210\u529f\u7684\u4f5c\u696d\u53ef\u80fd\u6703\u5931\u6557\uff0c\u4e26\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nStaged package...is inaccessible\n```\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u9a57\u8b49\u7528\u65bc\u66ab\u5b58\u7684 Cloud Storage \u5b58\u5132\u6876\u662f\u5426\u6c92\u6709\u5c0e\u81f4\u66ab\u5b58\u8edf\u4ef6\u5305\u88ab\u522a\u9664\u7684 [TTL \u8a2d\u7f6e](https://cloud.google.com/storage/docs/lifecycle?hl=zh-cn) \u3002\n- \u9a57\u8b49 Dataflow \u9805\u76ee\u7684\u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f\u6709\u6b0a\u8a2a\u554f\u7528\u65bc\u66ab\u5b58\u7684 Cloud Storage \u5b58\u5132\u6876\u3002\u6b0a\u9650\u4e0d\u8db3\u53ef\u80fd\u662f\u7531\u4ee5\u4e0b\u539f\u56e0\u9020\u6210\u7684\uff1a- \u7528\u65bc\u66ab\u5b58\u7684 Cloud Storage \u5b58\u5132\u6876\u4f4d\u65bc\u5176\u4ed6\u9805\u76ee\u4e2d\u3002\n- \u7528\u65bc\u66ab\u5b58\u7684 Cloud Storage \u5b58\u5132\u6876\u5df2\u5f9e\u7cbe\u7d30\u8a2a\u554f\u6b0a\u9650\u9077\u79fb\u5230 [\u7d71\u4e00\u5b58\u5132\u6876\u7d1a\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/storage/docs/uniform-bucket-level-access?hl=zh-cn) \u3002 \u7531\u65bc IAM \u653f\u7b56\u8207 ACL \u653f\u7b56\u5b58\u5728\u4e0d\u4e00\u81f4\uff0c\u56e0\u6b64\u4f7f\u66ab\u5b58\u5b58\u5132\u6876\u6539\u7528\u7d71\u4e00\u5b58\u5132\u6876\u7d1a\u8a2a\u554f\u6b0a\u9650\u6703\u7981\u6b62\u5c0d Cloud Storage \u8cc7\u6e90\u4f7f\u7528 ACL\u3002ACL \u5305\u62ec Dataflow \u9805\u76ee\u7684\u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f\u5c0d\u66ab\u5b58\u5b58\u5132\u6876\u64c1\u6709\u7684\u6b0a\u9650\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u8de8 Google Cloud \u9805\u76ee\u8a2a\u554f Cloud Storage \u5b58\u5132\u6876](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#accessing_buckets_across_projects) \u3002\n### \u5de5\u4f5c\u9805\u5931\u6557 4 \u6b21\n\u7576\u4f5c\u696d\u5931\u6557\u6642\uff0c\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\na work item failed 4 times\n```\n\u5982\u679c\u55ae\u500b\u64cd\u4f5c\u5c0e\u81f4\u5de5\u4f5c\u5668\u4ee3\u78bc\u5931\u6557\u56db\u6b21\uff0c\u5247\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002Dataflow \u4f7f\u4f5c\u696d\u5931\u6557\uff0c\u4e26\u4e14\u7cfb\u7d71\u6703\u986f\u793a\u6b64\u6d88\u606f\u3002\n\u60a8\u7121\u6cd5\u914d\u7f6e\u6b64\u5931\u6557\u95be\u503c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6d41\u6c34\u7dda\u932f\u8aa4\u548c\u7570\u5e38\u8655\u7406](https://cloud.google.com/dataflow/docs/pipeline-lifecycle?hl=zh-cn#error_and_exception_handling) \u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u5728\u4f5c\u696d\u7684 [Cloud Monitoring](https://cloud.google.com/dataflow/docs/guides/using-cloud-monitoring?hl=zh-cn) \u65e5\u8a8c\u4e2d\u67e5\u770b\u9019\u56db\u6b21\u5931\u6557\u60c5\u6cc1\u3002\u5728\u5de5\u4f5c\u5668\u65e5\u8a8c\u4e2d\u67e5\u627e\u986f\u793a\u7570\u5e38\u6216\u932f\u8aa4\u7684 **\u932f\u8aa4\u7d1a\u5225** \u6216 **\u56b4\u91cd\u7d1a\u5225** \u65e5\u8a8c\u689d\u76ee\u3002\u7570\u5e38\u6216\u932f\u8aa4\u61c9\u81f3\u5c11\u51fa\u73fe\u56db\u6b21\u3002\u5982\u679c\u65e5\u8a8c\u50c5\u5305\u542b\u8207\u8a2a\u554f\u5916\u90e8\u8cc7\u6e90\uff08\u4f8b\u5982 MongoDB\uff09\u76f8\u95dc\u7684\u4e00\u822c\u6027\u8d85\u6642\u932f\u8aa4\uff0c\u8acb\u9a57\u8b49\u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f\u662f\u5426\u6709\u6b0a\u8a2a\u554f\u8a72\u8cc7\u6e90\u7684\u5b50\u7db2\u3002\n### \u8f2a\u8a62\u7d50\u679c\u6587\u4ef6\u4e2d\u8d85\u6642\n\u7576\u4f5c\u696d\u5931\u6557\u6642\uff0c\u6703\u51fa\u73fe\u4ee5\u4e0b\u60c5\u6cc1\uff1a\n```\nTimeout in polling result file: PATH. Possible causes are:\n1. Your launch takes too long time to finish. Please check the logs on stackdriver.\n2. Service account SERVICE_ACCOUNT may not have enough permissions to pull\ncontainer image IMAGE_PATH or create new objects in PATH.\n3. Transient errors occurred, please try again.\n```\n\u8a72\u554f\u984c\u901a\u5e38\u8207\u4f7f\u7528 `requirements.txt` \u6587\u4ef6\u5b89\u88dd Python \u4f9d\u8cf4\u9805\u7684\u65b9\u5f0f\u76f8\u95dc\u3002Apache Beam \u66ab\u5b58\u5668\u5f9e PyPi \u4e0b\u8f09\u6240\u6709\u4f9d\u8cf4\u9805\u7684\u4f86\u6e90\uff0c\u5305\u62ec\u50b3\u905e\u4f9d\u8cf4\u9805\u7684\u4f86\u6e90\u3002\u7136\u5f8c\uff0c\u5728 `pip` \u4e0b\u8f09\u547d\u4ee4\u671f\u9593\uff0c\u4f5c\u7232 `apache-beam` \u4f9d\u8cf4\u9805\u7684\u4e00\u4e9b Python \u8edf\u4ef6\u5305\u767c\u751f\u986f\u5f0f\u7684 `wheel` \u7de8\u8b6f\u3002\u7531\u65bc `requirements.txt` \u6587\u4ef6\uff0c\u53ef\u80fd\u767c\u751f\u8d85\u6642\u554f\u984c\u3002\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Apache Arrow \u5718\u968a\u8ddf\u8e64\u6b64\u554f\u984c\u7684 bug](https://github.com/apache/arrow/issues/25105) \u3002 [\u5efa\u8b70\u7684\u89e3\u6c7a\u65b9\u6cd5](https://cloud.google.com/dataflow/docs/guides/troubleshoot-templates?hl=zh-cn#python-requirements) \u662f\u76f4\u63a5\u5728 Dockerfile \u4e2d\u5b89\u88dd `apache-beam` \u3002\u9019\u6a23\u5c31\u4e0d\u6703\u767c\u751f `requirements.txt` \u6587\u4ef6\u7684\u8d85\u6642\u3002\n## \u6b78\u6a94\u4f5c\u696d\u932f\u8aa4\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u60a8\u5617\u8a66\u4f7f\u7528 API [\u6b78\u6a94 Dataflow \u4f5c\u696d](https://cloud.google.com/dataflow/docs/guides/stopping-a-pipeline?hl=zh-cn#archive) \u6642\u53ef\u80fd\u6703\u9047\u5230\u7684\u5e38\u898b\u932f\u8aa4\u3002\n### \u672a\u63d0\u4f9b\u503c\n\u5617\u8a66\u4f7f\u7528 API \u6b78\u6a94 Dataflow \u4f5c\u696d\u6642\uff0c\u53ef\u80fd\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nThe field mask specifies an update for the field job_metadata.user_display_properties.archived in job JOB_ID, but no value is provided. To update a field, please provide a field for the respective value.\n```\n\u767c\u751f\u6b64\u932f\u8aa4\u662f\u7531\u4ee5\u4e0b\u67d0\u7a2e\u539f\u56e0\u9020\u6210\u7684\uff1a\n- \u7232 `updateMask` \u5b57\u6bb5\u6307\u5b9a\u7684\u8def\u5f91\u672a\u63a1\u7528\u6b63\u78ba\u7684\u683c\u5f0f\u3002\u6b64\u554f\u984c\u53ef\u80fd\u662f\u7531\u62fc\u5beb\u932f\u8aa4\u9020\u6210\u7684\u3002\n- \u672a\u6b63\u78ba\u6307\u5b9a [JobMetadata](https://cloud.google.com/dataflow/docs/reference/rest/v1b3/projects.jobs?hl=zh-cn#jobmetadata) \u3002\u5728 `JobMetadata` \u5b57\u6bb5\u4e2d\uff0c\u5c0d\u65bc `userDisplayProperties` \uff0c\u8acb\u4f7f\u7528\u9375\u503c\u5c0d `\"archived\":\"true\"` \u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u932f\u8aa4\uff0c\u8acb\u9a57\u8b49\u60a8\u50b3\u905e\u7d66 API \u7684\u547d\u4ee4\u5339\u914d\u6240\u9700\u7684\u683c\u5f0f\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6b78\u6a94\u4f5c\u696d](https://cloud.google.com/dataflow/docs/guides/stopping-a-pipeline?hl=zh-cn#archive-jobs) \u3002\n### API \u7121\u6cd5\u8b58\u5225\u503c\n\u5617\u8a66\u4f7f\u7528 API \u6b78\u6a94 Dataflow \u4f5c\u696d\u6642\uff0c\u53ef\u80fd\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nThe API does not recognize the value VALUE for the field job_metadata.user_display_properties.archived for job JOB_ID. REASON: Archived display property can only be set to 'true' or 'false'\n```\n\u7576\u6b78\u6a94\u4f5c\u696d\u9375\u503c\u5c0d\u4e2d\u63d0\u4f9b\u7684\u503c\u4e0d\u53d7\u652f\u6301\u6642\uff0c\u5c31\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\u6b78\u6a94\u4f5c\u696d\u9375\u503c\u5c0d\u652f\u6301\u7684\u503c\u7232 `\"archived\":\"true\"` \u548c `\"archived\":\"false\"` \u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u932f\u8aa4\uff0c\u8acb\u9a57\u8b49\u60a8\u50b3\u905e\u7d66 API \u7684\u547d\u4ee4\u5339\u914d\u6240\u9700\u7684\u683c\u5f0f\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6b78\u6a94\u4f5c\u696d](https://cloud.google.com/dataflow/docs/guides/stopping-a-pipeline?hl=zh-cn#archive-jobs) \u3002\n### \u7121\u6cd5\u540c\u6642\u66f4\u65b0\u72c0\u614b\u548c\u63a9\u78bc\n\u5617\u8a66\u4f7f\u7528 API \u6b78\u6a94 Dataflow \u4f5c\u696d\u6642\uff0c\u53ef\u80fd\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nCannot update both state and mask.\n```\n\u5982\u679c\u60a8\u5617\u8a66\u5728\u540c\u4e00 API \u8abf\u7528\u4e2d\u540c\u6642\u66f4\u65b0 [\u4f5c\u696d\u72c0\u614b](https://cloud.google.com/dataflow/docs/reference/rpc/google.dataflow.v1beta3?hl=zh-cn#google.dataflow.v1beta3.JobState) \u548c\u6b78\u6a94\u72c0\u614b\uff0c\u5247\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\u60a8\u4e0d\u80fd\u5728\u540c\u4e00 API \u8abf\u7528\u4e2d\u540c\u6642\u66f4\u65b0\u4f5c\u696d\u72c0\u614b\u548c [updateMask](https://cloud.google.com/dataflow/docs/reference/rest/v1b3/projects.jobs/update?hl=zh-cn#query-parameters) \u67e5\u8a62\u53c3\u6578\u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u932f\u8aa4\uff0c\u8acb\u5728\u53e6\u4e00\u500b API \u8abf\u7528\u4e2d\u66f4\u65b0\u4f5c\u696d\u72c0\u614b\u3002\u8acb\u5148\u66f4\u65b0\u4f5c\u696d\u72c0\u614b\uff0c\u7136\u5f8c\u518d\u66f4\u65b0\u4f5c\u696d\u6b78\u6a94\u72c0\u614b\u3002\n### \u5de5\u4f5c\u6d41\u4fee\u6539\u5931\u6557\n\u5617\u8a66\u4f7f\u7528 API \u6b78\u6a94 Dataflow \u4f5c\u696d\u6642\uff0c\u53ef\u80fd\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nWorkflow modification failed.\n```\n\u6b64\u932f\u8aa4\u901a\u5e38\u5728\u60a8\u5617\u8a66\u6b78\u6a94\u6b63\u5728\u904b\u884c\u7684\u4f5c\u696d\u6642\u767c\u751f\u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u932f\u8aa4\uff0c\u8acb\u7b49\u5f85\u4f5c\u696d\u5b8c\u6210\u5f8c\u518d\u5c07\u5b83\u6b78\u6a94\u3002\u5df2\u5b8c\u6210\u7684\u4f5c\u696d\u5177\u6709\u4ee5\u4e0b [\u4f5c\u696d\u72c0\u614b](https://cloud.google.com/dataflow/docs/reference/rpc/google.dataflow.v1beta3?hl=zh-cn#google.dataflow.v1beta3.JobState) \u4e4b\u4e00\uff1a\n- `JOB_STATE_CANCELLED`\n- `JOB_STATE_DRAINED`\n- `JOB_STATE_DONE`\n- `JOB_STATE_FAILED`\n- `JOB_STATE_UPDATED`\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6aa2\u6e2c Dataflow \u4f5c\u696d\u7684\u5b8c\u6210\u60c5\u6cc1](https://cloud.google.com/dataflow/docs/guides/stopping-a-pipeline?hl=zh-cn#job-completion) \u3002\n## \u5bb9\u5668\u6620\u50cf\u932f\u8aa4\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u4f7f\u7528\u81ea\u5b9a\u7fa9\u5bb9\u5668\u6642\u60a8\u53ef\u80fd\u6703\u9047\u5230\u7684\u5e38\u898b\u932f\u8aa4\uff0c\u4ee5\u53ca\u89e3\u6c7a\u6216\u6392\u67e5\u9019\u4e9b\u932f\u8aa4\u7684\u6b65\u9a5f\u3002\u9019\u4e9b\u932f\u8aa4\u901a\u5e38\u524d\u9762\u5e36\u6709\u4ee5\u4e0b\u6d88\u606f\uff1a\n```\nUnable to pull container image due to error: DETAILED_ERROR_MESSAGE\n```\n### \u201ccontaineranalysis.occurrences.list\u201d\u6b0a\u9650\u906d\u62d2\n\u65e5\u8a8c\u6587\u4ef6\u4e2d\u6703\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nError getting old patchz discovery occurrences: generic::permission_denied: permission \"containeranalysis.occurrences.list\" denied for project \"PROJECT_ID\", entity ID \"\" [region=\"REGION\" projectNum=PROJECT_NUMBER projectID=\"PROJECT_ID\"]\n```\n\u6f0f\u6d1e\u6383\u63cf\u9700\u8981\u4f7f\u7528 Container Analysis API\u3002\n**\u6ce8\u610f** \uff1a\u6b64 API \u7531 [Container Scanning](https://cloud.google.com/artifact-analysis/docs/enable-container-scanning?hl=zh-cn) API \u81ea\u52d5\u5553\u7528\u3002\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 Artifact Analysis \u6587\u6a94\u4e2d\u7684 [\u64cd\u4f5c\u7cfb\u7d71\u6383\u63cf\u6982\u89bd](https://cloud.google.com/artifact-analysis/docs/os-overview?hl=zh-cn) \u548c [\u914d\u7f6e\u8a2a\u554f\u6b0a\u9650\u63a7\u5236](https://cloud.google.com/artifact-analysis/docs/ca-access-control?hl=zh-cn) \u3002\n### \u540c\u6b65 pod \u6642\u51fa\u932f ...\u201cStartContainer\u201d\u5931\u6557\n\u5de5\u4f5c\u5668\u5553\u52d5\u671f\u9593\uff0c\u7cfb\u7d71\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nError syncing pod POD_ID, skipping: [failed to \"StartContainer\" for CONTAINER_NAME with CrashLoopBackOff: \"back-off 5m0s restarting failed container=CONTAINER_NAME pod=POD_NAME].\n```\npod \u662f Dataflow \u5de5\u4f5c\u5668\u4e0a\u904b\u884c\u7684\u4f4d\u65bc\u540c\u4e00\u4f4d\u7f6e\u7684 Docker \u5bb9\u5668\u7d44\u3002\u7576 pod \u4e2d\u7684\u4e00\u500b Docker \u5bb9\u5668\u7121\u6cd5\u5553\u52d5\u6642\uff0c\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\u5982\u679c\u6545\u969c\u4e0d\u53ef\u6062\u5fa9\uff0c\u5247 Dataflow \u5de5\u4f5c\u5668\u5c07\u7121\u6cd5\u5553\u52d5\uff0c\u4e26\u4e14 Dataflow \u6279\u91cf\u4f5c\u696d\u6700\u7d42\u6703\u5931\u6557\uff0c\u4e26\u986f\u793a\u5982\u4e0b\u932f\u8aa4\uff1a\n```\nThe Dataflow job appears to be stuck because no worker activity has been seen in the last 1h.\n```\n\u67d0\u500b\u5bb9\u5668\u5728\u5553\u52d5\u671f\u9593\u9023\u7e8c\u5d29\u6f70\u6642\u901a\u5e38\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002\n**\u6ce8\u610f\uff1a** \u5982\u679c\u55ae\u500b\u5de5\u4f5c\u5668\u53cd\u8986\u5553\u52d5\u4e26\u5728\u5e7e\u5206\u9418\u5f8c\u505c\u6b62\uff0c\u4e26\u4e14\u60a8\u770b\u5230 `Dataflow job appears to be stuck` \u932f\u8aa4\uff0c\u5247\u6709\u53ef\u80fd\u662f\u7db2\u7d61\u554f\u984c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u55ae\u500b\u5de5\u4f5c\u5668\u53cd\u8986\u5553\u52d5\u548c\u505c\u6b62](https://cloud.google.com/dataflow/docs/guides/troubleshoot-networking?hl=zh-cn#one-worker-repeatedly-stopped) \u3002\n\u5982\u9700\u77ad\u89e3\u6839\u672c\u539f\u56e0\uff0c\u8acb\u67e5\u627e\u5728\u5931\u6557\u524d\u7acb\u5373\u6355\u7372\u7684\u65e5\u8a8c\u3002\u5982\u9700\u5206\u6790\u65e5\u8a8c\uff0c\u8acb\u4f7f\u7528 [\u65e5\u8a8c\u700f\u89bd\u5668](https://cloud.google.com/logging/docs/view/logs-explorer-interface?hl=zh-cn) \u3002 \u5728\u65e5\u8a8c\u700f\u89bd\u5668\u4e2d\uff0c\u5c07\u65e5\u8a8c\u6587\u4ef6\u9650\u5236\u7232\u767c\u751f\u5bb9\u5668\u5553\u52d5\u932f\u8aa4\u7684\u5de5\u4f5c\u5668\u767c\u51fa\u7684\u65e5\u8a8c\u689d\u76ee\u3002\u5982\u9700\u9650\u5236\u65e5\u8a8c\u689d\u76ee\uff0c\u8acb\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9a5f\uff1a\n- \u5728\u65e5\u8a8c\u700f\u89bd\u5668\u4e2d\uff0c\u627e\u5230`Error syncing pod`\u65e5\u8a8c\u689d\u76ee\u3002\n- \u5982\u9700\u67e5\u770b\u8207\u65e5\u8a8c\u689d\u76ee\u95dc\u806f\u7684\u6a19\u7c64\uff0c\u8acb\u5c55\u958b\u65e5\u8a8c\u689d\u76ee\u3002\n- \u9ede\u64ca\u8207`resource_name`\u95dc\u806f\u7684\u6a19\u7c64\uff0c\u7136\u5f8c\u9ede\u64ca **\u986f\u793a\u5339\u914d\u689d\u76ee** \u3002\u5728\u65e5\u8a8c\u700f\u89bd\u5668\u4e2d\uff0cDataflow \u65e5\u8a8c\u88ab\u6574\u7406\u5230\u591a\u500b\u65e5\u8a8c\u6d41\u4e2d\u3002 `Error syncing pod` \u6d88\u606f\u5728\u540d\u7232 `kubelet` \u7684\u65e5\u8a8c\u4e2d\u767c\u51fa\u3002\u4f46\u662f\uff0c\u4f86\u81ea\u6545\u969c\u5bb9\u5668\u7684\u65e5\u8a8c\u53ef\u80fd\u4f4d\u65bc\u4e0d\u540c\u7684\u65e5\u8a8c\u6d41\u4e2d\u3002\u6bcf\u500b\u5bb9\u5668\u90fd\u6709\u4e00\u500b\u540d\u7a31\u3002\u8acb\u4f7f\u7528\u4e0b\u8868\u78ba\u5b9a\u54ea\u500b\u65e5\u8a8c\u6d41\u53ef\u80fd\u5305\u542b\u8207\u6545\u969c\u5bb9\u5668\u76f8\u95dc\u7684\u65e5\u8a8c\u3002\n| \u5bb9\u5668\u540d\u7a31       | \u65e5\u8a8c\u540d\u7a31     |\n|:-----------------------------------|:-------------------------|\n| sdk\u3001sdk0\u3001sdk1\u3001sdk-0-0 \u7b49  | docker     |\n| harness       | harness\u3001harness-startup |\n| python\u3001java-batch\u3001java-streaming | worker-startup\u3001worker |\n| artifact       | \u5de5\u4ef6      |\n\u67e5\u8a62\u65e5\u8a8c\u700f\u89bd\u5668\u6642\uff0c\u8acb\u78ba\u4fdd\u67e5\u8a62 [\u5728\u67e5\u8a62\u69cb\u5efa\u5668\u754c\u9762\u4e2d](https://cloud.google.com/logging/docs/view/building-queries?hl=zh-cn#query-builder-menus) \u5305\u542b\u76f8\u95dc\u65e5\u8a8c\u540d\u7a31\uff0c\u6216\u8005\u5c0d\u65e5\u8a8c\u540d\u7a31\u6c92\u6709\u9650\u5236\u3002\n\u9078\u64c7\u76f8\u95dc\u65e5\u8a8c\u5f8c\uff0c\u67e5\u8a62\u7d50\u679c\u53ef\u80fd\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a\n```\nresource.type=\"dataflow_step\"\nresource.labels.job_id=\"2022-06-29_08_02_54-JOB_ID\"\nlabels.\"compute.googleapis.com/resource_name\"=\"testpipeline-jenkins-0629-DATE-cyhg-harness-8crw\"\nlogName=(\"projects/apache-beam-testing/logs/dataflow.googleapis.com%2Fdocker\"\nOR\n\"projects/apache-beam-testing/logs/dataflow.googleapis.com%2Fworker-startup\"\nOR\n\"projects/apache-beam-testing/logs/dataflow.googleapis.com%2Fworker\")\n```\n\u7531\u65bc\u5831\u544a\u5bb9\u5668\u6545\u969c\u75c7\u72c0\u7684\u65e5\u8a8c\u6709\u6642\u5831\u544a\u7232 `INFO` \uff0c\u56e0\u6b64\u8acb\u5728\u5206\u6790\u4e2d\u5305\u542b `INFO` \u65e5\u8a8c\u3002\n\u5bb9\u5668\u6545\u969c\u7684\u5178\u578b\u539f\u56e0\u5305\u62ec\uff1a\n- Python \u6d41\u6c34\u7dda\u5728\u904b\u884c\u6642\u5b89\u88dd\u4e86\u5176\u4ed6\u4f9d\u8cf4\u9805\uff0c\u4e26\u4e14\u5b89\u88dd\u5931\u6557\u3002\u60a8\u53ef\u80fd\u6703\u770b\u5230`pip install failed with error`\u7b49\u932f\u8aa4\u3002\u51fa\u73fe\u6b64\u554f\u984c\u7684\u539f\u56e0\u53ef\u80fd\u662f\u8981\u6c42\u5b58\u5728\u885d\u7a81\uff0c\u6216\u8005\u7db2\u7d61\u914d\u7f6e\u53d7\u9650\u800c\u5c0e\u81f4 Dataflow \u5de5\u4f5c\u5668\u7121\u6cd5\u901a\u904e\u4e92\u806f\u7db2\u5f9e\u516c\u5171\u4ee3\u78bc\u5eab\u62c9\u53d6\u5916\u90e8\u4f9d\u8cf4\u9805\u3002\n- \u7531\u65bc\u5167\u5b58\u4e0d\u8db3\u932f\u8aa4\uff0c\u5de5\u4f5c\u5668\u5728\u6d41\u6c34\u7dda\u904b\u884c\u904e\u7a0b\u4e2d\u5931\u6557\u3002\u60a8\u53ef\u80fd\u6703\u770b\u5230\u5982\u4e0b\u932f\u8aa4\uff1a- `java.lang.OutOfMemoryError: Java heap space`\n- `Shutting down JVM after 8 consecutive periods of measured GC thrashing. Memory is used/total/max = 24453/42043/42043 MB, GC last/max = 58.97/99.89 %, #pushbacks=82, gc thrashing=true. Heap dump not written.`\n\u5982\u9700\u8abf\u8a66\u5167\u5b58\u4e0d\u8db3\u554f\u984c\uff0c\u8acb\u53c3\u95b1 [\u6392\u67e5 Dataflow \u5167\u5b58\u4e0d\u8db3\u932f\u8aa4](https://cloud.google.com/dataflow/docs/guides/troubleshoot-oom?hl=zh-cn) \u3002\n- Dataflow \u7121\u6cd5\u62c9\u53d6\u5bb9\u5668\u6620\u50cf\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6620\u50cf\u62c9\u53d6\u8acb\u6c42\u56e0\u932f\u8aa4\u800c\u5931\u6557](#error-pulling-container-image) \u3002\n- \u4f7f\u7528\u7684\u5bb9\u5668\u8207\u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\u7684 CPU \u67b6\u69cb\u4e0d\u517c\u5bb9\u3002\u5728\u81ea\u52d5\u5316\u6e2c\u8a66\u6846\u67b6\u5553\u52d5\u65e5\u8a8c\u4e2d\uff0c\u60a8\u53ef\u80fd\u6703\u770b\u5230\u5982\u4e0b\u932f\u8aa4\uff1a `exec /opt/apache/beam/boot: exec format error` \u3002\u5982\u9700\u6aa2\u67e5\u5bb9\u5668\u6620\u50cf\u7684\u67b6\u69cb\uff0c\u8acb\u904b\u884c `docker image inspect $IMAGE:$TAG` \u4e26\u67e5\u627e `Architecture` \u95dc\u9375\u5b57\u3002\u5982\u679c\u7cfb\u7d71\u986f\u793a `Error: No such image: $IMAGE:$TAG` \uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5148\u904b\u884c `docker pull $IMAGE:$TAG` \u4f86\u62c9\u53d6\u6620\u50cf\u3002 \u5982\u9700\u77ad\u89e3\u5982\u4f55\u69cb\u5efa\u591a\u67b6\u69cb\u6620\u50cf\uff0c\u8acb\u53c3\u95b1 [\u69cb\u5efa\u591a\u67b6\u69cb\u5bb9\u5668\u6620\u50cf](https://cloud.google.com/dataflow/docs/guides/multi-architecture-container?hl=zh-cn) \u3002\n\u5728\u78ba\u5b9a\u5c0e\u81f4\u5bb9\u5668\u5931\u6557\u7684\u932f\u8aa4\u5f8c\uff0c\u8acb\u5617\u8a66\u89e3\u6c7a\u8a72\u932f\u8aa4\uff0c\u7136\u5f8c\u91cd\u65b0\u63d0\u4ea4\u6d41\u6c34\u7dda\u3002\n### \u6620\u50cf\u62c9\u53d6\u8acb\u6c42\u5931\u6557\uff0c\u767c\u751f\u932f\u8aa4\n\u5728\u5de5\u4f5c\u5668\u5553\u52d5\u671f\u9593\uff0c\u5de5\u4f5c\u5668\u6216\u4f5c\u696d\u65e5\u8a8c\u4e2d\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\u4e4b\u4e00\uff1a\n```\nImage pull request failed with error\n```\n```\npull access denied for IMAGE_NAME\n```\n```\nmanifest for IMAGE_NAME not found: manifest unknown: Failed to fetch\n```\n```\nGet IMAGE_NAME: Service Unavailable\n```\n\u5982\u679c\u5de5\u4f5c\u5668\u56e0\u7121\u6cd5\u62c9\u53d6 Docker \u5bb9\u5668\u6620\u50cf\u800c\u7121\u6cd5\u5553\u52d5\uff0c\u5247\u6703\u767c\u751f\u9019\u4e9b\u932f\u8aa4\u3002\u6b64\u554f\u984c\u767c\u751f\u5728\u4ee5\u4e0b\u60c5\u6cc1\uff1a\n- \u81ea\u5b9a\u7fa9 SDK \u5bb9\u5668\u6620\u50cf\u7db2\u5740\u4e0d\u6b63\u78ba\n- \u5de5\u4f5c\u5668\u7f3a\u5c11\u6191\u64da\u6216\u5c0d\u9060\u7a0b\u6620\u50cf\u7684\u7db2\u7d61\u8a2a\u554f\u6b0a\u9650\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5982\u679c\u60a8\u7232\u4f5c\u696d\u4f7f\u7528\u81ea\u5b9a\u7fa9\u5bb9\u5668\u6620\u50cf\uff0c\u8acb\u9a57\u8b49\u6620\u50cf\u7db2\u5740\u6b63\u78ba\u4e14\u5177\u6709\u6709\u6548\u7684\u6a19\u8a18\u6216\u6458\u8981\u3002Dataflow \u5de5\u4f5c\u5668\u9084\u9700\u8981\u8a2a\u554f\u8a72\u6620\u50cf\u3002\n- \u901a\u904e\u5f9e\u672a\u7d93\u8eab\u4efd\u9a57\u8b49\u7684\u6a5f\u5668\u904b\u884c`docker pull $image`\uff0c\u9a57\u8b49\u662f\u5426\u53ef\u4ee5\u5728\u672c\u5730\u62c9\u53d6\u516c\u5171\u6620\u50cf\u3002\n\u5c0d\u65bc\u79c1\u6709\u6620\u50cf\u6216\u79c1\u6709\u5de5\u4f5c\u5668\uff1a\n- \u5982\u679c\u60a8\u4f7f\u7528 Container Registry \u8a17\u7ba1\u5bb9\u5668\u6620\u50cf\uff0c\u5efa\u8b70\u60a8\u6539\u7232\u4f7f\u7528 Artifact Registry\u3002\u5f9e 2023 \u5e74 5 \u6708 15 \u65e5\u8d77\uff0cContainer Registry \u5df2\u68c4\u7528\u3002\u5982\u679c\u60a8\u4f7f\u7528 Container Registry\uff0c\u5247\u53ef\u4ee5 [\u8f49\u63db\u5230 Artifact Registry](https://cloud.google.com/artifact-registry/docs/transition/transition-from-gcr?hl=zh-cn) \u3002\u5982\u679c\u60a8\u7684\u6620\u50cf\u6240\u5728\u7684\u9805\u76ee\u8207\u7528\u65bc\u904b\u884c Google Cloud \u4f5c\u696d\u7684\u9805\u76ee\u4e0d\u540c\uff0c\u8acb\u7232\u9ed8\u8a8d Google Cloud \u670d\u52d9\u8cec\u865f [\u914d\u7f6e\u8a2a\u554f\u6b0a\u9650\u63a7\u5236](https://cloud.google.com/container-registry/docs/access-control?hl=zh-cn) \u3002\n- \u5982\u679c\u4f7f\u7528\u5171\u4eab Virtual Private Cloud (VPC)\uff0c\u8acb\u78ba\u4fdd\u5de5\u4f5c\u5668 [\u53ef\u4ee5\u8a2a\u554f](https://cloud.google.com/dataflow/docs/guides/routes-firewall?hl=zh-cn) \u81ea\u5b9a\u7fa9\u5bb9\u5668\u4ee3\u78bc\u5eab\u4e3b\u6a5f\u3002\n- \u4f7f\u7528`ssh`\u9023\u63a5\u5230\u6b63\u5728\u904b\u884c\u7684\u4f5c\u696d\u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\uff0c\u4e26\u904b\u884c`docker pull $image`\u4ee5\u76f4\u63a5\u78ba\u8a8d\u5de5\u4f5c\u5668\u5df2\u6b63\u78ba\u914d\u7f6e\u3002\n\u5982\u679c\u5de5\u4f5c\u5668\u7531\u65bc\u932f\u8aa4\u5728\u884c\u4e2d\u591a\u6b21\u5931\u6557\uff0c\u4e26\u4e14\u5728\u4f5c\u696d\u4e0a\u5553\u52d5\u4e86\u5de5\u4f5c\uff0c\u5247\u4f5c\u696d\u53ef\u80fd\u6703\u56e0\u5982\u4e0b\u6240\u793a\u7684\u6d88\u606f\u800c\u5931\u6557\uff1a\n```\nJob appears to be stuck.\n```\n\u5982\u679c\u60a8\u5728\u4f5c\u696d\u904b\u884c\u6642\u79fb\u9664\u4e86\u5c0d\u6620\u50cf\u7684\u8a2a\u554f\u6b0a\u9650\uff08\u901a\u904e\u79fb\u9664\u6620\u50cf\u672c\u8eab\uff0c\u6216\u64a4\u6d88 Dataflow \u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f\u6191\u64da\u6216\u6620\u50cf\u7684\u4e92\u806f\u7db2\u8a2a\u554f\u6b0a\u9650\uff09\uff0c\u5247 Dataflow \u50c5\u6703\u8a18\u9304\u932f\u8aa4\u3002Dataflow \u4e0d\u6703\u4f7f\u4f5c\u696d\u5931\u6557\u3002Dataflow \u9084\u6703\u907f\u514d\u4f7f\u9577\u6642\u9593\u904b\u884c\u7684\u6d41\u5f0f\u6d41\u6c34\u7dda\u5931\u6557\uff0c\u4ee5\u907f\u514d\u4e1f\u5931\u6d41\u6c34\u7dda\u72c0\u614b\u3002\n\u5176\u4ed6\u932f\u8aa4\u53ef\u80fd\u662f\u7531\u4ee3\u78bc\u5eab\u914d\u984d\u554f\u984c\u6216\u670d\u52d9\u4e2d\u65b7\u9020\u6210\u7684\u3002 \u5982\u679c\u60a8\u9047\u5230\u62c9\u53d6\u516c\u5171\u6620\u50cf\u6642\u8d85\u51fa [Docker Hub \u914d\u984d](https://docs.docker.com/docker-hub/download-rate-limit/) \u6216\u5e38\u898f\u7b2c\u4e09\u65b9\u5009\u5eab\u670d\u52d9\u4e2d\u65b7\u554f\u984c\uff0c\u8acb\u8003\u616e\u4f7f\u7528 [Artifact Registry](https://cloud.google.com/artifact-registry/docs/overview?hl=zh-cn) \u4f5c\u7232\u6620\u50cf\u5009\u5eab\u3002\n### SystemError\uff1a\u672a\u77e5\u64cd\u4f5c\u78bc\n\u60a8\u7684 Python \u81ea\u5b9a\u7fa9\u5bb9\u5668\u6d41\u6c34\u7dda\u53ef\u80fd\u6703\u5728\u4f5c\u696d\u63d0\u4ea4\u5f8c\u7acb\u5373\u5931\u6557\uff0c\u4e26\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nSystemError: unknown opcode\n```\n\u6b64\u5916\uff0c\u5806\u68e7\u8ecc\u8de1\u53ef\u80fd\u5305\u62ec\n```\napache_beam/internal/pickler.py\n```\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u9a57\u8b49\u60a8\u5728\u672c\u5730\u4f7f\u7528\u7684 Python \u7248\u672c\u662f\u5426\u8207\u5bb9\u5668\u6620\u50cf\u4e2d\u7684\u7248\u672c\u5339\u914d\uff08\u4e3b\u8981\u7248\u672c\u548c\u6b21\u8981\u7248\u672c\u5747\u5339\u914d\uff09\u3002\u88dc\u4e01\u7a0b\u5e8f\u7248\u672c\u4e0d\u540c\uff08\u5982 3.6.7 \u8207 3.6.8\uff09\u4e0d\u6703\u5c0e\u81f4\u517c\u5bb9\u6027\u554f\u984c\u3002\u6b21\u8981\u7248\u672c\u4e0d\u540c\uff08\u4f8b\u5982 3.6.8 \u8207 3.8.2\uff09\u53ef\u80fd\u5c0e\u81f4\u6d41\u6c34\u7dda\u5931\u6557\u3002\n## \u5de5\u4f5c\u5668\u932f\u8aa4\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u60a8\u53ef\u80fd\u6703\u9047\u5230\u7684\u5e38\u898b\u5de5\u4f5c\u5668\u932f\u8aa4\uff0c\u4ee5\u53ca\u89e3\u6c7a\u6216\u6392\u67e5\u9019\u4e9b\u932f\u8aa4\u7684\u6b65\u9a5f\u3002\n### Java \u5de5\u4f5c\u5668\u81ea\u52d5\u5316\u6e2c\u8a66\u6846\u67b6\u5c0d Python DoFn \u7684\u8abf\u7528\u5931\u6557\u4e26\u986f\u793a\u932f\u8aa4\n\u5982\u679c Java \u5de5\u4f5c\u5668\u81ea\u52d5\u5316\u6e2c\u8a66\u6846\u67b6\u5c0d Python `DoFn` \u7684\u8abf\u7528\u5931\u6557\uff0c\u5247\u6703\u986f\u793a\u76f8\u95dc\u932f\u8aa4\u6d88\u606f\u3002\n\u5982\u9700\u8abf\u67e5\u932f\u8aa4\uff0c\u8acb\u5c55\u958b [Cloud Monitoring](https://cloud.google.com/dataflow/docs/guides/using-cloud-monitoring?hl=zh-cn) \u932f\u8aa4\u65e5\u8a8c\u689d\u76ee\u4e26\u67e5\u770b\u932f\u8aa4\u6d88\u606f\u548c\u56de\u6eaf\u3002\u5b83\u6703\u986f\u793a\u5931\u6557\u7684\u4ee3\u78bc\uff0c\u4ee5\u4fbf\u60a8\u6839\u64da\u9700\u8981\u9032\u884c\u66f4\u6b63\u3002\u5982\u679c\u60a8\u78ba\u5b9a\u932f\u8aa4\u662f Apache Beam \u6216 Dataflow \u4e2d\u7684\u932f\u8aa4\uff0c\u8acb [\u5831\u544a\u932f\u8aa4](https://cloud.google.com/dataflow/docs/support/getting-support?hl=zh-cn) \u3002\n### EOFError\uff1a\u7de8\u7d44\u6578\u64da\u592a\u77ed\n\u5de5\u4f5c\u5668\u65e5\u8a8c\u4e2d\u6703\u986f\u793a\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nEOFError: marshal data too short\n```\n\u7576 Python \u6d41\u6c34\u7dda\u5de5\u4f5c\u5668\u7684\u78c1\u76e4\u7a7a\u9593\u4e0d\u8db3\u6642\uff0c\u6709\u6642\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u53c3\u95b1 [\u8a2d\u5099\u4e0a\u5df2\u6c92\u6709\u5269\u9918\u7a7a\u9593](#no-space-left) \u3002\n### \u672a\u80fd\u639b\u63a5\u78c1\u76e4\n\u7576\u60a8\u5617\u8a66\u5553\u52d5\u5c07 [C3 \u865b\u64ec\u6a5f](https://cloud.google.com/compute/docs/general-purpose-machines?hl=zh-cn#c3_series) \u8207\u6c38\u4e45\u6027\u78c1\u76e4\u642d\u914d\u4f7f\u7528\u7684 Dataflow \u4f5c\u696d\u6642\uff0c\u4f5c\u696d\u6703\u5931\u6557\u4e26\u986f\u793a\u4ee5\u4e0b\u4e00\u500b\u6216\u5168\u90e8\u5169\u500b\u932f\u8aa4\uff1a\n```\nFailed to attach disk(s), status: generic::invalid_argument: One or more operations had an error\n```\n```\nCan not allocate sha384 (reason: -2), Spectre V2 : WARNING: Unprivileged eBPF is enabled with eIBRS on...\n```\n\u7576\u60a8\u5c07 C3 \u865b\u64ec\u6a5f\u8207\u4e0d\u53d7\u652f\u6301\u7684\u6c38\u4e45\u6027\u78c1\u76e4\u985e\u578b\u642d\u914d\u4f7f\u7528\u6642\uff0c\u6703\u767c\u751f\u9019\u4e9b\u932f\u8aa4\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [C3 \u652f\u6301\u7684\u78c1\u76e4\u985e\u578b](https://cloud.google.com/compute/docs/general-purpose-machines?hl=zh-cn#c3_disks) \u3002\n\u5982\u9700\u5c07 C3 \u865b\u64ec\u6a5f\u8207 Dataflow \u4f5c\u696d\u642d\u914d\u4f7f\u7528\uff0c\u8acb\u9078\u64c7 `pd-ssd` \u5de5\u4f5c\u5668\u78c1\u76e4\u985e\u578b\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5de5\u4f5c\u5668\u7d1a\u9078\u9805](https://cloud.google.com/dataflow/docs/reference/pipeline-options?hl=zh-cn#worker-level_options) \u3002\n`--workerDiskType=pd-ssd`\n`--worker_disk_type=pd-ssd`\n`disk_type=pd-ssd`\n### \u8a2d\u5099\u4e0a\u5df2\u6c92\u6709\u5269\u9918\u7a7a\u9593\n\u7576\u4f5c\u696d\u7684\u78c1\u76e4\u7a7a\u9593\u7528\u76e1\u6642\uff0c\u5de5\u4f5c\u5668\u65e5\u8a8c\u4e2d\u53ef\u80fd\u6703\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nNo space left on device\n```\n\u6b64\u932f\u8aa4\u53ef\u80fd\u662f\u7531\u4ee5\u4e0b\u67d0\u7a2e\u539f\u56e0\u9020\u6210\u7684\uff1a\n- \u5de5\u4f5c\u5668\u6c38\u4e45\u6027\u5b58\u5132\u7684\u53ef\u7528\u7a7a\u9593\u7528\u76e1\uff0c\u9019\u53ef\u80fd\u662f\u7531\u65bc\u4ee5\u4e0b\u67d0\u500b\u539f\u56e0\u9020\u6210\u7684\uff1a\n- \u4f5c\u696d\u5728\u904b\u884c\u6642\u4e0b\u8f09\u5927\u578b\u4f9d\u8cf4\u9805\n- \u4f5c\u696d\u4f7f\u7528\u5927\u578b\u81ea\u5b9a\u7fa9\u5bb9\u5668\n- \u4f5c\u696d\u5c07\u8a31\u591a\u81e8\u6642\u6578\u64da\u5beb\u5165\u672c\u5730\u78c1\u76e4\n- \u4f7f\u7528 [Dataflow Shuffle](https://cloud.google.com/dataflow/docs/shuffle-for-batch?hl=zh-cn) \u6642\uff0cDataflow \u6703\u8a2d\u7f6e [\u8f03\u4f4e\u7684\u9ed8\u8a8d\u78c1\u76e4\u5927\u5c0f](https://cloud.google.com/dataflow/docs/guides/deploying-a-pipeline?hl=zh-cn#disk-considerations) \u3002\u56e0\u6b64\uff0c\u5f9e\u57fa\u65bc\u5de5\u4f5c\u5668\u7684 shuffle \u9077\u79fb\u7684\u4f5c\u696d\u53ef\u80fd\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n- \u5de5\u4f5c\u5668\u5553\u52d5\u78c1\u76e4\u5df2\u6eff\uff0c\u56e0\u7232\u5b83\u6bcf\u79d2\u8a18\u9304\u7684\u689d\u76ee\u8d85\u904e 50 \u500b\u3002\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u6309\u4ee5\u4e0b\u554f\u984c\u6392\u67e5\u6b65\u9a5f\u64cd\u4f5c\uff1a\n\u5982\u9700\u67e5\u770b\u8207\u55ae\u500b\u5de5\u4f5c\u5668\u95dc\u806f\u7684\u78c1\u76e4\u8cc7\u6e90\uff0c\u8acb\u67e5\u627e\u8207\u4f5c\u696d\u95dc\u806f\u7684\u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u8a73\u60c5\u3002\u90e8\u5206\u78c1\u76e4\u7a7a\u9593\u4f9b\u64cd\u4f5c\u7cfb\u7d71\u3001\u4e8c\u9032\u5236\u6587\u4ef6\u3001\u65e5\u8a8c\u548c\u5bb9\u5668\u4f7f\u7528\u3002\n\u8981\u589e\u52a0\u6c38\u4e45\u6027\u78c1\u76e4\u6216\u5553\u52d5\u78c1\u76e4\u7a7a\u9593\uff0c\u8acb\u8abf\u6574 [\u78c1\u76e4\u5927\u5c0f\u6d41\u6c34\u7dda\u9078\u9805](https://cloud.google.com/dataflow/docs/reference/pipeline-options?hl=zh-cn#worker-level_options) \u3002\n\u4f7f\u7528 Cloud Monitoring \u8ddf\u8e64\u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\u7684\u78c1\u76e4\u53ef\u7528\u7a7a\u9593\u4f7f\u7528\u60c5\u6cc1\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u9032\u884c\u6b64\u8a2d\u7f6e\uff0c\u8acb\u53c3\u95b1 [\u5f9e Monitoring \u4ee3\u7406\u63a5\u6536\u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\u6307\u6a19](https://cloud.google.com/dataflow/docs/guides/using-cloud-monitoring?hl=zh-cn#receive_worker_vm_metrics_from_the_agent) \u3002\n\u901a\u904e\u5728\u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a [\u67e5\u770b\u4e32\u884c\u7aef\u53e3\u8f38\u51fa](https://cloud.google.com/compute/docs/instances/viewing-serial-port-output?hl=zh-cn#viewing_serial_port_output) \u4e26\u67e5\u627e\u5982\u4e0b\u6d88\u606f\u4f86\u67e5\u627e\u5553\u52d5\u78c1\u76e4\u7a7a\u9593\u554f\u984c\uff1a\n```\nFailed to open system journal: No space left on device\n```\n\u5982\u679c\u60a8\u6709\u8a31\u591a\u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u5247\u53ef\u4ee5\u5275\u5efa\u4e00\u500b\u8173\u672c\uff0c\u4ee5\u4fbf\u540c\u6642\u5c0d\u6240\u6709\u9019\u4e9b\u5be6\u4f8b\u904b\u884c `gcloud compute instances get-serial-port-output` \u3002 \u60a8\u53ef\u4ee5\u6539\u7232\u67e5\u770b\u8a72\u8f38\u51fa\u3002\n### Python \u6d41\u6c34\u7dda\u5728\u5de5\u4f5c\u5668\u8655\u65bc\u975e\u6d3b\u8e8d\u72c0\u614b\u4e00\u5c0f\u6642\u5f8c\u5931\u6557\n\u5728\u5177\u6709\u8a31\u591a CPU \u6838\u5fc3\u7684\u5de5\u4f5c\u5668\u6a5f\u5668\u4e0a\u4f7f\u7528 Python \u7248 Apache Beam SDK \u548c Dataflow Runner V2 \u6642\uff0c\u8acb\u4f7f\u7528 Apache Beam SDK 2.35.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u5982\u679c\u60a8\u7684\u4f5c\u696d\u4f7f\u7528\u81ea\u5b9a\u7fa9\u5bb9\u5668\uff0c\u8acb\u4f7f\u7528 Apache Beam SDK 2.46.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n\u8acb\u8003\u616e\u9810\u69cb\u5efa Python \u5bb9\u5668\u3002\u6b64\u6b65\u9a5f\u53ef\u4ee5\u7e2e\u77ed\u865b\u64ec\u6a5f\u5553\u52d5\u6642\u9593\u548c\u6a6b\u5411\u81ea\u52d5\u64f4\u7e2e\u6027\u80fd\u3002\u5982\u9700\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u8acb\u5728\u9805\u76ee\u4e0a\u5553\u7528 Cloud Build API\uff0c\u4e26\u4f7f\u7528\u4ee5\u4e0b\u53c3\u6578\u63d0\u4ea4\u6d41\u6c34\u7dda\uff1a\n`\u2011\u2011prebuild_sdk_container_engine=cloud_build` \u3002\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Dataflow Runner V2](https://cloud.google.com/dataflow/docs/runner-v2?hl=zh-cn) \u3002\n\u60a8\u9084\u53ef\u4ee5 [\u4f7f\u7528\u9810\u5b89\u88dd\u4e86\u6240\u6709\u4f9d\u8cf4\u9805\u7684\u81ea\u5b9a\u7fa9\u5bb9\u5668\u6620\u50cf](https://cloud.google.com/dataflow/docs/guides/using-custom-containers?hl=zh-cn) \u3002\n### \u5728\u53ef\u7528\u5340\u4e2d\u5553\u52d5\u5de5\u4f5c\u5668\u6c60\u7121\u6cd5\u5553\u52d5\u4efb\u4f55\u6240\u9700\u7684\u5de5\u4f5c\u5668\n\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nStartup of the worker pool in zone ZONE_NAME failed to bring up any of the desired NUMBER workers.\nThe project quota may have been exceeded or access control policies may be preventing the operation;\nreview the Cloud Logging 'VM Instance' log for diagnostics.\n```\n\u767c\u751f\u6b64\u932f\u8aa4\u662f\u7531\u4ee5\u4e0b\u67d0\u7a2e\u539f\u56e0\u9020\u6210\u7684\uff1a\n- \u5df2\u8d85\u51fa\u5275\u5efa Dataflow \u5de5\u4f5c\u5668\u6240\u4f9d\u8cf4\u7684\u5176\u4e2d\u4e00\u500b Compute Engine \u914d\u984d\u3002\n- \u60a8\u7684\u7d44\u7e54\u5df2\u8a2d\u7f6e [\u9650\u5236](https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints?hl=zh-cn) \uff0c\u4ee5\u7981\u6b62\u865b\u64ec\u6a5f\u5be6\u4f8b\u5275\u5efa\u904e\u7a0b\u7684\u67d0\u4e9b\u65b9\u9762\uff0c\u4f8b\u5982\u4f7f\u7528\u8cec\u865f\u6216\u4ee5\u53ef\u7528\u5340\u7232\u76ee\u6a19\u3002\n\u8981\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u6309\u4ee5\u4e0b\u554f\u984c\u6392\u67e5\u6b65\u9a5f\u64cd\u4f5c\uff1a\n**\u67e5\u770b\u865b\u64ec\u6a5f\u5be6\u4f8b\u65e5\u8a8c**\n- \u8f49\u5230 [Cloud Logging \u67e5\u770b\u5668](https://console.cloud.google.com/logs/viewer?hl=zh-cn) \n- \u5728 **\u5df2\u5be9\u8988\u7684\u8cc7\u6e90** \u4e0b\u62c9\u5217\u8868\u4e2d\uff0c\u9078\u64c7 **\u865b\u64ec\u6a5f\u5be6\u4f8b** \u3002\n- \u5728 **\u6240\u6709\u65e5\u8a8c** \u4e0b\u62c9\u5217\u8868\u4e2d\uff0c\u9078\u64c7 **compute.googleapis.com/activity_log** \u3002\n- \u6383\u63cf\u65e5\u8a8c\u4ee5\u67e5\u627e\u8207\u865b\u64ec\u6a5f\u5be6\u4f8b\u5275\u5efa\u5931\u6557\u76f8\u95dc\u7684\u4efb\u4f55\u689d\u76ee\u3002\n**\u6aa2\u67e5 Compute Engine \u914d\u984d\u7684\u4f7f\u7528\u60c5\u6cc1**\n- \u5982\u9700\u67e5\u770b Compute Engine \u8cc7\u6e90\u4f7f\u7528\u60c5\u6cc1\u8207\u76ee\u6a19\u5340\u57df\u7684 [Dataflow \u914d\u984d](https://cloud.google.com/dataflow/quotas?hl=zh-cn#compute-engine-quotas) \u7684\u5c0d\u6bd4\u60c5\u6cc1\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a`gcloud compute regions describe [REGION]`\n- \u67e5\u770b\u4ee5\u4e0b\u8cc7\u6e90\u7684\u7d50\u679c\uff0c\u77ad\u89e3\u662f\u5426\u6709\u4efb\u4f55\u8cc7\u6e90\u8d85\u51fa\u914d\u984d\uff1a- CPUS\n- DISKS_TOTAL_GB\n- IN_USE_ADDRESSES\n- INSTANCE_GROUPS\n- INSTANCES\n- REGIONAL_INSTANCE_GROUP_MANAGERS\n- \u5982\u679c\u9700\u8981\uff0c\u8acb [\u7533\u8acb\u66f4\u6539\u914d\u984d](https://cloud.google.com/compute/quotas?hl=zh-cn#request_quotas) \u3002\n**\u67e5\u770b\u7d44\u7e54\u653f\u7b56\u9650\u5236**\n- \u8f49\u5230 [\u201c\u7d44\u7e54\u653f\u7b56\u201d\u9801\u9762](https://console.cloud.google.com/iam-admin/orgpolicies/list?hl=zh-cn) \n- \u67e5\u770b\u53ef\u80fd\u6703\u9650\u5236\u4ee5\u4e0b\u884c\u7232\u7684\u9650\u5236\uff1a\u9650\u5236\u7232\u60a8\u4f7f\u7528\u7684\u8cec\u865f\uff08\u9ed8\u8a8d\u7232 [Dataflow \u670d\u52d9\u8cec\u865f](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#cloud_dataflow_service_account) \uff09\u6216\u5728\u60a8\u8a2d\u7232\u76ee\u6a19\u7684\u53ef\u7528\u5340\u4e2d\u5275\u5efa\u865b\u64ec\u6a5f\u5be6\u4f8b\u3002\n- \u5982\u679c\u60a8\u7684\u653f\u7b56\u9650\u5236\u4f7f\u7528\u5916\u90e8 IP \u5730\u5740\uff0c\u8acb\u7232\u6b64\u4f5c\u696d\u95dc\u9589\u5916\u90e8 IP \u5730\u5740\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u95dc\u9589\u5916\u90e8 IP \u5730\u5740\uff0c\u8acb\u53c3\u95b1 [\u914d\u7f6e\u4e92\u806f\u7db2\u8a2a\u554f\u6b0a\u9650\u548c\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/dataflow/docs/guides/routes-firewall?hl=zh-cn#turn_off_external_ip_address) \u3002\n### \u7b49\u5f85\u5de5\u4f5c\u5668\u66f4\u65b0\u6642\u8d85\u6642\n\u7576 Dataflow \u4f5c\u696d\u5931\u6557\u6642\uff0c\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nRoot cause: Timed out waiting for an update from the worker. For more information, see https://cloud.google.com/dataflow/docs/guides/common-errors#worker-lost-contact.\n```\n\u6709\u6642\uff0c\u7576\u5de5\u4f5c\u5668\u7684\u5167\u5b58\u6216\u4ea4\u63db\u7a7a\u9593\u4e0d\u8db3\u6642\uff0c\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u9996\u5148\u8acb\u5617\u8a66\u518d\u6b21\u904b\u884c\u8a72\u4f5c\u696d\u3002\u5982\u679c\u8a72\u4f5c\u696d\u4ecd\u7136\u5931\u6557\uff0c\u4e26\u4e14\u767c\u751f\u76f8\u540c\u7684\u932f\u8aa4\uff0c\u8acb\u5617\u8a66\u4f7f\u7528\u5167\u5b58\u548c\u78c1\u76e4\u7a7a\u9593\u66f4\u5927\u7684\u5de5\u4f5c\u5668\u3002\u4f8b\u5982\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u6d41\u6c34\u7dda\u5553\u52d5\u9078\u9805\uff1a\n`--worker_machine_type=m1-ultramem-40 --disk_size_gb=500`\n\u66f4\u6539\u5de5\u4f5c\u5668\u985e\u578b\u53ef\u80fd\u6703\u5f71\u97ff\u7d50\u7b97\u8cbb\u7528\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6392\u67e5 Dataflow \u5167\u5b58\u4e0d\u8db3\u932f\u8aa4](https://cloud.google.com/dataflow/docs/guides/troubleshoot-oom?hl=zh-cn) \u3002\n\u5982\u679c\u60a8\u7684\u6578\u64da\u5305\u542b\u71b1\u9375\uff0c\u4e5f\u53ef\u80fd\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u67d0\u4e9b\u5de5\u4f5c\u5668\u7684 CPU \u5229\u7528\u7387\u5728\u4f5c\u696d\u7684\u5927\u90e8\u5206\u6301\u7e8c\u6642\u9593\u5167\u90fd\u8f03\u9ad8\u3002 \u4f46\u662f\uff0c\u5de5\u4f5c\u5668\u6578\u91cf\u6c92\u6709\u9054\u5230\u5141\u8a31\u7684\u6700\u5927\u503c\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u71b1\u9375\u548c\u53ef\u80fd\u7684\u89e3\u6c7a\u65b9\u6848\uff0c\u8acb\u53c3\u95b1 [\u7de8\u5beb Dataflow \u6d41\u6c34\u7dda\u6642\u5c07\u53ef\u4f38\u7e2e\u6027\u8003\u616e\u5728\u5167](https://cloud.google.com/blog/products/gcp/writing-dataflow-pipelines-with-scalability-in-mind?hl=zh-cn) \u3002\n\u5982\u9700\u77ad\u89e3\u6b64\u554f\u984c\u7684\u5176\u4ed6\u89e3\u6c7a\u65b9\u6848\uff0c\u8acb\u53c3\u95b1 [\u6aa2\u6e2c\u5230\u71b1\u9375...](#hot-key-detected) \u3002\n\u5982\u679c\u60a8\u7684 Python \u4ee3\u78bc\u4f7f\u7528 [Python \u64f4\u5c55\u7a0b\u5e8f\u6a5f\u5236](https://docs.python.org/3/extending/extending.html) \u8abf\u7528 C/C++ \u4ee3\u78bc\uff0c\u8acb\u6aa2\u67e5\u64f4\u5c55\u7a0b\u5e8f\u4ee3\u78bc\u662f\u5426\u5728\u4e0d\u8a2a\u554f Python \u72c0\u614b\u7684\u8a08\u7b97\u5bc6\u96c6\u578b\u4ee3\u78bc\u90e8\u5206\u4e2d\u91cb\u653e Python \u5168\u5c40\u89e3\u91cb\u5668\u9396\u5b9a (GIL)\u3002 \u4fc3\u9032\u8207 [Cython](https://cython.readthedocs.io/en/latest/src/userguide/external_C_code.html#nogil) \u548c [PyBind](https://pybind11.readthedocs.io/en/stable/advanced/misc.html#global-interpreter-lock-gil) \u7b49\u64f4\u5c55\u7a0b\u5e8f\u4ea4\u4e92\u7684\u5eab\u5177\u6709\u7528\u65bc\u63a7\u5236 GIL \u72c0\u614b\u7684\u539f\u8a9e\u3002\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 `Py_BEGIN_ALLOW_THREADS` \u548c `Py_END_ALLOW_THREADS` \u5b8f\uff0c\u624b\u52d5\u91cb\u653e GIL \u4e26\u91cd\u65b0\u7372\u53d6\u5b83\uff0c\u7136\u5f8c\u518d\u5c07\u63a7\u5236\u6b0a\u8fd4\u9084\u7d66 Python \u89e3\u91cb\u5668\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 Python \u6587\u6a94\u4e2d\u7684 [\u7dda\u7a0b\u72c0\u614b\u548c\u5168\u5c40\u89e3\u91cb\u5668\u9396\u5b9a](https://docs.python.org/3/c-api/init.html#thread-state-and-the-global-interpreter-lock) \u3002\n\u5728 Python \u6d41\u6c34\u7dda\u7684\u9ed8\u8a8d\u914d\u7f6e\u4e2d\uff0cDataflow \u5047\u5b9a\u5de5\u4f5c\u5668\u4e0a\u904b\u884c\u7684\u6bcf\u500b Python \u9032\u7a0b\u90fd\u9ad8\u6548\u4f7f\u7528\u4e00\u500b vCPU \u6838\u5fc3\u3002\u5982\u679c\u6d41\u6c34\u7dda\u4ee3\u78bc\u7e5e\u904e GIL \u9650\u5236\uff08\u4f8b\u5982\u4f7f\u7528\u901a\u904e C++ \u5be6\u73fe\u7684\u5eab\uff09\uff0c\u5247\u8655\u7406\u5143\u7d20\u53ef\u80fd\u6703\u4f7f\u7528\u4f86\u81ea\u591a\u500b vCPU \u6838\u5fc3\u7684\u8cc7\u6e90\uff0c\u4e26\u4e14\u5de5\u4f5c\u5668\u53ef\u80fd\u7121\u6cd5\u7372\u53d6\u8db3\u5920\u7684 CPU \u8cc7\u6e90\u3002\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb [\u6e1b\u5c11\u5de5\u4f5c\u5668\u4e0a\u7684\u7dda\u7a0b\u6578](https://cloud.google.com/dataflow/docs/guides/troubleshoot-oom?hl=zh-cn#reduce-threads) \u3002\n### Java \u4f9d\u8cf4\u9805\u554f\u984c\n\u4e0d\u517c\u5bb9\u7684\u985e\u548c\u5eab\u53ef\u80fd\u6703\u5c0e\u81f4 Java \u4f9d\u8cf4\u9805\u554f\u984c\u3002\u5982\u679c\u60a8\u7684\u6d41\u6c34\u7dda\u5b58\u5728 Java \u4f9d\u8cf4\u9805\u554f\u984c\uff0c\u53ef\u80fd\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\u4e4b\u4e00\uff1a\n- `NoClassDefFoundError`\uff1a\u5982\u679c\u6574\u500b\u985e\u5728\u904b\u884c\u6642\u4e0d\u53ef\u7528\uff0c\u5c31\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002\n- `NoSuchMethodError`\uff1a\u5982\u679c\u985e\u8def\u5f91\u4e2d\u7684\u985e\u4f7f\u7528\u4e0d\u5305\u542b\u6b63\u78ba\u65b9\u6cd5\u7684\u7248\u672c\u6216\u8005\u65b9\u6cd5\u7c3d\u540d\u767c\u751f\u8b8a\u5316\uff0c\u5c31\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002\n- `NoSuchFieldError`\uff1a\u5982\u679c\u985e\u8def\u5f91\u4e2d\u7684\u985e\u5728\u904b\u884c\u6642\u4f7f\u7528\u6c92\u6709\u5fc5\u9700\u5b57\u6bb5\u7684\u7248\u672c\uff0c\u5c31\u6703\u51fa\u73fe\u6b64\u932f\u8aa4\u3002\n- `FATAL ERROR in native method`\uff1a\u7576\u7121\u6cd5\u6b63\u78ba\u52a0\u8f09\u5167\u7f6e\u4f9d\u8cf4\u9805\u6642\uff0c\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002 \u4f7f\u7528\u8d85\u7d1a JAR\uff08\u9670\u5f71\uff09\u6642\uff0c\u8acb\u52ff\u5728\u540c\u4e00 JAR \u4e2d\u5305\u542b\u4f7f\u7528\u7c3d\u540d\u7684\u5eab\uff08\u5982 Conscrypt\uff09\u3002\n\u5982\u679c\u60a8\u7684\u6d41\u6c34\u7dda\u5305\u542b\u7279\u5b9a\u65bc\u7528\u6236\u7684\u4ee3\u78bc\u548c\u8a2d\u7f6e\uff0c\u5247\u4ee3\u78bc\u4e0d\u80fd\u5305\u542b\u6df7\u5408\u7248\u672c\u7684\u5eab\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u4f9d\u8cf4\u9805\u7ba1\u7406\u5eab\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u4f7f\u7528 [Google Cloud \u5eab BOM](https://cloud.google.com/java/docs/bom?hl=zh-cn) \u3002\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Apache Beam SDK\uff0c\u5982\u9700\u5c0e\u5165\u6b63\u78ba\u7684\u5eab BOM\uff0c\u8acb\u4f7f\u7528 `beam-sdks-java-io-google-cloud-platform-bom` \uff1a\n```\n<dependencyManagement>\u00a0 <dependencies>\u00a0 \u00a0 <dependency>\u00a0 \u00a0 \u00a0 <groupId>org.apache.beam</groupId>\u00a0 \u00a0 \u00a0 <artifactId>beam-sdks-java-google-cloud-platform-bom</artifactId>\u00a0 \u00a0 \u00a0 <version>BEAM_VERSION</version>\u00a0 \u00a0 \u00a0 <type>pom</type>\u00a0 \u00a0 \u00a0 <scope>import</scope>\u00a0 \u00a0 </dependency>\u00a0 </dependencies></dependencyManagement>\n```\n```\ndependencies {\u00a0 \u00a0 implementation(platform(\"org.apache.beam:beam-sdks-java-google-cloud-platform-bom:BEAM_VERSION\"))}\n```\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5728 Dataflow \u4e2d\u7ba1\u7406\u6d41\u6c34\u7dda\u4f9d\u8cf4\u9805](https://cloud.google.com/dataflow/docs/guides/manage-dependencies?hl=zh-cn#java) \u3002\n### JDK 17 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u7684 InaccessObjectException\n\u4f7f\u7528 Java \u5e73\u81fa\u3001\u6a19\u6e96\u7248\u958b\u767c\u5de5\u5177\u5305 (JDK) 17 \u53ca\u66f4\u9ad8\u7248\u672c\u904b\u884c\u6d41\u6c34\u7dda\u6642\uff0c\u5de5\u4f5c\u5668\u65e5\u8a8c\u6587\u4ef6\u4e2d\u53ef\u80fd\u6703\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nUnable to make protected METHOD accessible:\n module java.MODULE does not \"opens java.MODULE\" to ...\n```\n\u51fa\u73fe\u6b64\u554f\u984c\u7684\u539f\u56e0\u662f\uff0c\u5f9e Java 9 \u7248\u958b\u59cb\uff0c\u9700\u8981\u958b\u653e\u6a21\u584a Java \u865b\u64ec\u6a5f (JVM) \u9078\u9805\u624d\u80fd\u8a2a\u554f JDK \u5167\u90e8\u5167\u5bb9\u3002\u5728 Java 16 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u8a2a\u554f JDK \u5167\u90e8\u5167\u5bb9\u59cb\u7d42\u9700\u8981\u958b\u653e\u6a21\u584a JVM \u9078\u9805\u3002\n\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u5728\u5c07\u6a21\u584a\u50b3\u905e\u7d66\u8981\u6253\u958b\u7684 Dataflow \u6d41\u6c34\u7dda\u6642\uff0c\u7d50\u5408\u4f7f\u7528 `` `/` `` `=` `` `(,` `` `)*` \u683c\u5f0f\u548c `jdkAddOpenModules` \u6d41\u6c34\u7dda\u9078\u9805\u3002\u6b64\u683c\u5f0f\u5141\u8a31\u8a2a\u554f\u5fc5\u8981\u7684\u5eab\u3002\n\u4f8b\u5982\uff0c\u5982\u679c\u932f\u8aa4\u7232 `module java.base does not \"opens java.lang\" to unnamed module @...` \uff0c\u8acb\u5728\u904b\u884c\u6d41\u6c34\u7dda\u6642\u6dfb\u52a0\u4ee5\u4e0b\u6d41\u6c34\u7dda\u9078\u9805\uff1a\n```\n--jdkAddOpenModules=java.base/java.lang=ALL-UNNAMED\n```\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [DataflowPipelineOptions](https://beam.apache.org/documentation/sdks/javadoc/current/index.html?org/apache/beam/runners/dataflow/options/DataflowPipelineOptions.html) \u985e\u6587\u6a94\u3002\n## BigQuery \u9023\u63a5\u5668\u932f\u8aa4\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u60a8\u53ef\u80fd\u6703\u9047\u5230\u7684\u5e38\u898b BigQuery \u9023\u63a5\u5668\u932f\u8aa4\uff0c\u4ee5\u53ca\u89e3\u6c7a\u6216\u6392\u67e5\u9019\u4e9b\u932f\u8aa4\u7684\u6b65\u9a5f\u3002\n### quotaExceeded\n\u4f7f\u7528 BigQuery \u9023\u63a5\u5668\u901a\u904e\u6d41\u5f0f\u63d2\u5165\u5c07\u6578\u64da\u5beb\u5165 BigQuery \u6642\uff0c\u5beb\u5165\u541e\u5410\u91cf\u4f4e\u65bc\u9810\u671f\uff0c\u4e26\u4e14\u53ef\u80fd\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nquotaExceeded\n```\n\u6b64\u541e\u5410\u91cf\u53ef\u80fd\u7531\u65bc\u60a8\u7684\u6d41\u6c34\u7dda\u8d85\u51fa\u53ef\u7528\u7684 BigQuery \u6d41\u5f0f\u63d2\u5165\u914d\u984d\u3002\u5982\u679c\u662f\u9019\u6a23\uff0c\u4f86\u81ea BigQuery \u7684\u914d\u984d\u76f8\u95dc\u932f\u8aa4\u6d88\u606f\u6703\u986f\u793a\u5728 Dataflow \u5de5\u4f5c\u5668\u65e5\u8a8c\u4e2d\uff08\u67e5\u627e `quotaExceeded` \u932f\u8aa4\uff09\u3002\n\u5982\u679c\u51fa\u73fe `quotaExceeded` \u932f\u8aa4\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u89e3\u6c7a\u6b64\u554f\u984c\uff1a\n- \u5982\u679c\u4f7f\u7528 Java \u7248 Apache Beam SDK\uff0c\u8acb\u8a2d\u7f6e BigQuery \u63a5\u6536\u5668\u9078\u9805`ignoreInsertIds()`\u3002\n- \u5982\u679c\u4f7f\u7528 Python \u7248 Apache Beam SDK\uff0c\u8acb\u4f7f\u7528`ignore_insert_ids`\u9078\u9805\u3002\n\u9019\u4e9b\u8a2d\u7f6e\u8b93\u60a8\u53ef\u4ee5\u7232\u6bcf\u500b\u9805\u76ee\u6bcf\u79d2\u8655\u7406 1 GB \u7684 BigQuery \u6d41\u5f0f\u63d2\u5165\u541e\u5410\u91cf\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u8207\u81ea\u52d5\u522a\u9664\u91cd\u8907\u6d88\u606f\u76f8\u95dc\u7684\u6ce8\u610f\u4e8b\u9805\uff0c\u8acb\u53c3\u95b1 [BigQuery \u6587\u6a94](https://cloud.google.com/bigquery/streaming-data-into-bigquery?hl=zh-cn#disabling_best_effort_de-duplication) \u3002\u5982\u9700\u5c07 BigQuery \u6d41\u5f0f\u63d2\u5165\u914d\u984d\u589e\u52a0\u5230 1 GBps \u4ee5\u4e0a\uff0c\u8acb [\u901a\u904e Google Cloud \u63a7\u5236\u6aaf\u63d0\u4ea4\u8acb\u6c42](https://console.cloud.google.com/iam-admin/quotas?hl=zh-cn) \u3002\n\u5982\u679c\u60a8\u5728\u5de5\u4f5c\u5668\u65e5\u8a8c\u4e2d\u6c92\u6709\u770b\u5230\u8207\u914d\u984d\u76f8\u95dc\u7684\u932f\u8aa4\uff0c\u5247\u554f\u984c\u5728\u65bc\uff0c\u9ed8\u8a8d\u6346\u7d81\u6216\u6279\u8655\u7406\u76f8\u95dc\u53c3\u6578\u7121\u6cd5\u63d0\u4f9b\u6d41\u6c34\u7dda\u7684\u64f4\u7e2e\u80fd\u529b\u3002\u4f7f\u7528\u6d41\u5f0f\u63d2\u5165\u529f\u80fd\u5c07\u6578\u64da\u5beb\u5165 BigQuery \u6642\uff0c\u60a8\u53ef\u4ee5\u8abf\u6574\u591a\u500b Dataflow BigQuery \u9023\u63a5\u5668\u76f8\u95dc\u7684\u914d\u7f6e\u4ee5\u5be6\u73fe\u9810\u671f\u7684\u6027\u80fd\u3002\u4f8b\u5982\uff0c\u5c0d\u65bc Java \u7248 Apache Beam SDK\uff0c\u8abf\u6574 `numStreamingKeys` \u4ee5\u5339\u914d\u6700\u5927\u5de5\u4f5c\u5668\u6578\u91cf\uff0c\u4e26\u8003\u616e\u589e\u52a0 `insertBundleParallelism` \u4ee5\u5c07 BigQuery \u9023\u63a5\u5668\u914d\u7f6e\u7232\u4f7f\u7528\u66f4\u591a\u4e26\u884c\u7dda\u7a0b\u4f86\u5c07\u6578\u64da\u5beb\u5165 BigQuery\u3002\n\u5982\u9700\u7372\u53d6 Java \u7248 Apache Beam SDK \u4e2d\u63d0\u4f9b\u7684\u914d\u7f6e\uff0c\u8acb\u53c3\u95b1 [BigQueryPipelineOptions](https://github.com/apache/beam/blob/master/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryOptions.java) \uff1b\u5982\u9700\u7372\u53d6 Python \u7248 Apache Beam SDK \u4e2d\u63d0\u4f9b\u7684\u914d\u7f6e\uff0c\u8acb\u53c3\u95b1 [WriteToBigQuery \u8f49\u63db](https://github.com/apache/beam/blob/master/sdks/python/apache_beam/io/gcp/bigquery.py) \u3002\n### rateLimitExceeded\n\u4f7f\u7528 BigQuery \u9023\u63a5\u5668\u6642\uff0c\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nrateLimitExceeded\n```\n\u5982\u679c BigQuery \u5728\u77ed\u6642\u9593\u5167\u767c\u9001\u7684 [API \u8acb\u6c42](https://console.cloud.google.com/apis/api/bigquery.googleapis.com/quotas?hl=zh-cn) \u904e\u591a\uff0c\u5247\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002BigQuery \u5177\u6709\u77ed\u671f\u914d\u984d\u9650\u5236\u3002 Dataflow \u6d41\u6c34\u7dda\u53ef\u80fd\u6703\u66ab\u6642\u8d85\u51fa\u6b64\u985e\u914d\u984d\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u5f9e Dataflow \u6d41\u6c34\u7dda\u5230 BigQuery \u7684 [API \u8acb\u6c42](https://console.cloud.google.com/apis/api/bigquery.googleapis.com/quotas?hl=zh-cn) \u90fd\u53ef\u80fd\u6703\u5931\u6557\uff0c\u9019\u53ef\u80fd\u6703\u5c0e\u81f4\u5de5\u4f5c\u5668\u65e5\u8a8c\u51fa\u73fe `rateLimitExceeded` \u932f\u8aa4\u3002\nDataflow \u6703\u91cd\u8a66\u6b64\u985e\u5931\u6557\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u653e\u5fc3\u5730\u5ffd\u7565\u9019\u4e9b\u932f\u8aa4\u3002\u5982\u679c\u60a8\u78ba\u4fe1\u6d41\u6c34\u7dda\u53d7\u5230 `rateLimitExceeded` \u932f\u8aa4\u7684\u5f71\u97ff\uff0c\u8acb\u8207 [Cloud Customer Care](https://cloud.google.com/support?hl=zh-cn) \u806f\u7e6b\u3002\n[](None)  [](None)\n## \u5176\u4ed6\u932f\u8aa4\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u60a8\u53ef\u80fd\u6703\u9047\u5230\u7684\u5176\u4ed6\u932f\u8aa4\u4ee5\u53ca\u89e3\u6c7a\u6216\u6392\u67e5\u9019\u4e9b\u932f\u8aa4\u7684\u6b65\u9a5f\u3002\n### \u7121\u6b64\u985e\u5c0d\u8c61\uff1apipeline.pb\n\u4f7f\u7528 [JOB_VIEW_ALL](https://cloud.google.com/dataflow/docs/reference/rest/v1b3/JobView?hl=zh-cn) \u9078\u9805\u5217\u51fa\u4f5c\u696d\u6642\uff0c\u6703\u767c\u751f\u4ee5\u4e0b\u932f\u8aa4\uff1a\n```\nNo such object: BUCKET_NAME/PATH/pipeline.pb\n```\n\u5982\u679c\u5f9e\u4f5c\u696d\u7684\u66ab\u5b58\u6587\u4ef6\u4e2d\u522a\u9664 `pipeline.pb` \u6587\u4ef6\uff0c\u5247\u53ef\u80fd\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n## \u63a8\u85a6\n\u5982\u9700\u67e5\u770b\u6709\u95dc Dataflow \u6578\u64da\u5206\u6790\u751f\u6210\u7684\u5efa\u8b70\u7684\u6307\u5c0e\uff0c\u8acb\u53c3\u95b1 [\u6578\u64da\u5206\u6790](https://cloud.google.com/dataflow/docs/guides/using-dataflow-insights?hl=zh-cn#insights) \u3002", "guide": "Dataflow"}