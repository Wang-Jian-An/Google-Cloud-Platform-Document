{"title": "Dataflow - \u904b\u884c\u793a\u4f8b\u6a21\u677f", "url": "https://cloud.google.com/dataflow/docs/sample-template?hl=zh-cn", "abstract": "# Dataflow - \u904b\u884c\u793a\u4f8b\u6a21\u677f\nWordCount \u6a21\u677f\u662f\u4e00\u7a2e\u6279\u8655\u7406\u6d41\u6c34\u7dda\uff0c\u5b83\u53ef\u5f9e Cloud Storage \u8b80\u53d6\u6587\u672c\uff0c\u5c07\u6587\u672c\u884c\u6a19\u8a18\u5316\u7232\u4e00\u500b\u500b\u7684\u8a5e\uff0c\u4e26\u5c0d\u6bcf\u500b\u8a5e\u9032\u884c\u8a5e\u983b\u8a08\u6578\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 WordCount\uff0c\u8acb\u53c3\u95b1 [WordCount \u793a\u4f8b\u6d41\u6c34\u7dda](https://cloud.google.com/dataflow/examples/wordcount-example?hl=zh-cn) \u3002\n\u5982\u679c Cloud Storage \u5b58\u5132\u6876\u4f4d\u65bc [\u670d\u52d9\u908a\u754c](https://cloud.google.com/vpc-service-controls/docs/overview?hl=zh-cn) \u5916\u90e8\uff0c\u8acb\u5275\u5efa\u4e00\u689d\u5141\u8a31\u8a2a\u554f\u8a72\u5b58\u5132\u6876\u7684 [\u51fa\u7ad9\u6d41\u91cf\u898f\u5247](https://cloud.google.com/vpc-service-controls/docs/ingress-egress-rules?hl=zh-cn) \u3002\n", "content": "## \u6a21\u677f\u53c3\u6578\n| \u53c3\u6578  | \u8aaa\u660e         |\n|:-----------|:-------------------------------------|\n| inputFile | Cloud Storage \u8f38\u5165\u6587\u4ef6\u7684\u8def\u5f91\u3002  |\n| outputFile | Cloud Storage \u8f38\u51fa\u6587\u4ef6\u7684\u8def\u5f91\u548c\u524d\u7db4\u3002 |\n## \u904b\u884c WordCount \u6a21\u677f\n- \u8f49\u5230 Dataflow **\u57fa\u65bc\u6a21\u677f\u5275\u5efa\u4f5c\u696d** \u9801\u9762\u3002\n- [\u8f49\u5230\u201c\u57fa\u65bc\u6a21\u677f\u5275\u5efa\u4f5c\u696d\u201d](https://console.cloud.google.com/dataflow/createjob) \n- \u5728 **\u4f5c\u696d\u540d\u7a31** \u5b57\u6bb5\u4e2d\uff0c\u8f38\u5165\u552f\u4e00\u7684\u4f5c\u696d\u540d\u7a31\u3002\n- \u53ef\u9078\uff1a\u5c0d\u65bc **\u5340\u57df\u6027\u7aef\u9ede** \uff0c\u5f9e\u4e0b\u62c9\u83dc\u55ae\u4e2d\u9078\u64c7\u4e00\u500b\u503c\u3002\u9ed8\u8a8d\u5340\u57df\u7232`us-central1`\u3002\u5982\u9700\u67e5\u770b\u53ef\u4ee5\u5728\u5176\u4e2d\u904b\u884c Dataflow \u4f5c\u696d\u7684\u5340\u57df\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [Dataflow \u4f4d\u7f6e](https://cloud.google.com/dataflow/docs/resources/locations?hl=zh-cn) \u3002\n- \u5f9e **Dataflow \u6a21\u677f** \u4e0b\u62c9\u83dc\u55ae\u4e2d\uff0c\u9078\u64c7 the WordCount template\u3002\n- \u5728\u63d0\u4f9b\u7684\u53c3\u6578\u5b57\u6bb5\u4e2d\uff0c\u8f38\u5165\u60a8\u7684\u53c3\u6578\u503c\u3002\n- \u9ede\u64ca **\u904b\u884c\u4f5c\u696d** \u3002 **\u6ce8\u610f** \uff1a\u5982\u9700\u4f7f\u7528 Google Cloud CLI \u904b\u884c classic \u6a21\u677f\uff0c\u60a8\u5fc5\u9808\u5b89\u88dd [Google Cloud CLI](https://cloud.google.com/sdk/docs/install?hl=zh-cn) \u7248\u672c 138.0.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n\u5728 shell \u6216\u7d42\u7aef\u4e2d\uff0c\u904b\u884c\u6a21\u677f\uff1a```\ngcloud dataflow jobs run JOB_NAME \\\\\u00a0 \u00a0 --gcs-location gs://dataflow-templates/latest/Word_Count \\\\\u00a0 \u00a0 --region REGION_NAME \\\\\u00a0 \u00a0 --parameters \\\\\u00a0 \u00a0 inputFile=gs://dataflow-samples/shakespeare/kinglear.txt,\\\\\u00a0 \u00a0 output=gs://BUCKET_NAME/output/my_output\n```\n\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- `JOB_NAME` \uff1a\u60a8\u9078\u64c7\u7684\u552f\u4e00\u6027\u4f5c\u696d\u540d\u7a31\n- `REGION_NAME` \uff1a\u8981\u5728\u5176\u4e2d\u90e8\u7f72 Dataflow \u4f5c\u696d\u7684 [\u5340\u57df](https://cloud.google.com/dataflow/docs/resources/locations?hl=zh-cn) \uff0c\u4f8b\u5982 `us-central1` \n- `BUCKET_NAME` \uff1aCloud Storage \u5b58\u5132\u6876\u7684\u540d\u7a31\n\u5982\u9700\u4f7f\u7528 REST API \u4f86\u904b\u884c\u6a21\u677f\uff0c\u8acb\u767c\u9001 HTTP POST \u8acb\u6c42\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 API \u53ca\u5176\u6388\u6b0a\u7bc4\u570d\uff0c\u8acb\u53c3\u95b1 [projects.templates.launch](https://cloud.google.com/dataflow/docs/reference/rest/v1b3/projects.templates/launch?hl=zh-cn) \u3002```\nPOST https://dataflow.googleapis.com/v1b3/projects/PROJECT_ID/locations/LOCATION/templates:launch?gcsPath=gs://dataflow-templates/latest/Word_Count{\u00a0 \u00a0 \"jobName\": \"JOB_NAME\",\u00a0 \u00a0 \"parameters\": {\u00a0 \u00a0 \u00a0 \u00a0\"inputFile\" : \"gs://dataflow-samples/shakespeare/kinglear.txt\",\u00a0 \u00a0 \u00a0 \u00a0\"output\": \"gs://BUCKET_NAME/output/my_output\"\u00a0 \u00a0 },\u00a0 \u00a0 \"environment\": { \"zone\": \"us-central1-f\" }}\n```\n\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- `PROJECT_ID`\uff1a\u60a8\u8981\u5728\u5176\u4e2d\u904b\u884c Dataflow \u4f5c\u696d\u7684 Google Cloud \u9805\u76ee\u7684 ID\n- `JOB_NAME` \uff1a\u60a8\u9078\u64c7\u7684\u552f\u4e00\u6027\u4f5c\u696d\u540d\u7a31\n- `LOCATION` \uff1a\u8981\u5728\u5176\u4e2d\u90e8\u7f72 Dataflow \u4f5c\u696d\u7684 [\u5340\u57df](https://cloud.google.com/dataflow/docs/resources/locations?hl=zh-cn) \uff0c\u4f8b\u5982 `us-central1` \n- `BUCKET_NAME` \uff1aCloud Storage \u5b58\u5132\u6876\u7684\u540d\u7a31", "guide": "Dataflow"}