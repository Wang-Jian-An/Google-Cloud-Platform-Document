{"title": "Dataflow - Dataflow \u6a21\u677f", "url": "https://cloud.google.com/dataflow/docs/concepts/dataflow-templates?hl=zh-cn", "abstract": "# Dataflow - Dataflow \u6a21\u677f\n\u85c9\u52a9 Dataflow \u6a21\u677f\uff0c\u60a8\u53ef\u4ee5\u5c01\u88dd Dataflow \u6d41\u6c34\u7dda\u4ee5\u65b9\u4fbf\u90e8\u7f72\u3002\u4e4b\u5f8c\uff0c\u5177\u5099\u5fc5\u8981\u6b0a\u9650\u7684\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u4f7f\u7528\u6a21\u677f\u4f86\u90e8\u7f72\u5c01\u88dd\u7684\u6d41\u6c34\u7dda\u3002\u60a8\u53ef\u4ee5\u5275\u5efa\u81ea\u5df1\u7684\u81ea\u5b9a\u7fa9 Dataflow \u6a21\u677f\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Google \u7232\u5e38\u898b\u7528\u4f8b\u63d0\u4f9b\u7684 [\u9810\u69cb\u5efa\u6a21\u677f](https://cloud.google.com/dataflow/docs/templates/provided-templates?hl=zh-cn) \u3002\n", "content": "## \u512a\u52e2\n\u8207\u76f4\u63a5\u5c07\u6d41\u6c34\u7dda\u90e8\u7f72\u5230 Dataflow \u76f8\u6bd4\uff0c\u4f7f\u7528\u6a21\u677f\u53ef\u4ee5\u63d0\u4f9b\u591a\u9805\u512a\u52e2\uff1a\n- \u6a21\u677f\u5c07\u6d41\u6c34\u7dda\u7684\u8a2d\u8a08\u8207\u90e8\u7f72\u5206\u9694\u958b\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u7531\u958b\u767c\u8005\u5275\u5efa\u6a21\u677f\uff0c\u4e4b\u5f8c\u518d\u7531\u6578\u64da\u79d1\u5b78\u5bb6\u4f86\u90e8\u7f72\u6a21\u677f\u3002\n- \u53ef\u4ee5\u5728\u6a21\u677f\u4e2d\u6dfb\u52a0\u5404\u7a2e\u53c3\u6578\uff0c\u9019\u6a23\u5c31\u53ef\u4ee5\u5728\u90e8\u7f72\u6a21\u677f\u6642\u81ea\u5b9a\u7fa9\u6d41\u6c34\u7dda\u3002\n- \u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u3001Google Cloud CLI \u6216 REST API \u8abf\u7528\u4f86\u90e8\u7f72\u6a21\u677f\u3002\u60a8\u4e0d\u9700\u8981\u5728\u672c\u5730\u6a5f\u5668\u4e0a\u5b89\u88dd\u958b\u767c\u74b0\u5883\u6216\u4efb\u4f55\u6d41\u6c34\u7dda\u4f9d\u8cf4\u9805\u3002\n- \u6a21\u677f\u662f\u4e00\u7a2e\u4ee3\u78bc\u5de5\u4ef6\uff0c\u53ef\u4ee5\u5b58\u5132\u5728\u6e90\u4ee3\u78bc\u63a7\u5236\u4ee3\u78bc\u5eab\u4e2d\uff0c\u4e26\u5728\u6301\u7e8c\u96c6\u6210 (CI/CD) \u6d41\u6c34\u7dda\u4e2d\u4f7f\u7528\u3002## Google \u63d0\u4f9b\u7684\u6a21\u677f\nGoogle \u63d0\u4f9b\u4e86\u5404\u7a2e\u9810\u69cb\u5efa\u7684\u958b\u6e90 Dataflow \u6a21\u677f\uff0c\u53ef\u4f9b\u60a8\u5728\u5e38\u898b\u5834\u666f\u4e2d\u4f7f\u7528\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u53ef\u7528\u6a21\u677f\uff0c\u8acb\u53c3\u95b1 [Google \u63d0\u4f9b\u7684\u6a21\u677f](https://cloud.google.com/dataflow/docs/templates/provided-templates?hl=zh-cn) \u3002\n## \u6bd4\u8f03 Flex \u6a21\u677f\u548c\u7d93\u5178\u6a21\u677fDataflow \u652f\u6301\u5169\u7a2e\u985e\u578b\u7684\u6a21\u677f\uff1aFlex \u6a21\u677f\uff08\u8f03\u65b0\uff09\u548c\u7d93\u5178\u6a21\u677f\u3002\u5982\u679c\u60a8\u8981\u5275\u5efa\u65b0\u7684 Dataflow \u6a21\u677f\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u5c07\u5176\u5275\u5efa\u7232 Flex \u6a21\u677f\u3002\n\u5982\u679c\u4f7f\u7528 Flex \u6a21\u677f\uff0c\u6d41\u6c34\u7dda\u5c07\u4f5c\u7232 Docker \u6620\u50cf\u5c01\u88dd\u5230 Artifact Registry \u4e2d\uff0c\u4e26\u4e14\u6a21\u677f\u898f\u7bc4\u6587\u4ef6\u6703\u5b58\u653e\u5728 Cloud Storage \u4e2d\u3002\u6a21\u677f\u898f\u7bc4\u5305\u542b\u6307\u5411 Docker \u6620\u50cf\u7684\u6307\u91dd\u3002\u904b\u884c\u6a21\u677f\u6642\uff0cDataflow \u670d\u52d9\u6703\u5553\u52d5\u5553\u52d5\u5668\u865b\u64ec\u6a5f\uff0c\u62c9\u53d6 Docker \u6620\u50cf\u4e26\u904b\u884c\u6d41\u6c34\u7dda\u3002\u7cfb\u7d71\u6703\u6839\u64da\u7528\u6236\u63d0\u4f9b\u7684\u904b\u884c\u6642\u53c3\u6578\u52d5\u614b\u69cb\u5efa\u57f7\u884c\u5716\u3002\u5982\u9700\u901a\u904e API \u5553\u52d5\u4f7f\u7528 Flex \u6a21\u677f\u7684\u4f5c\u696d\uff0c\u8acb\u4f7f\u7528 [projects.locations.flexTemplates.launch](https://cloud.google.com/dataflow/docs/reference/rest/v1b3/projects.locations.flexTemplates/launch?hl=zh-cn) \u65b9\u6cd5\u3002\n\u7d93\u5178\u6a21\u677f\u5247\u5305\u542b Dataflow \u4f5c\u696d\u5716\u7684 JSON \u5e8f\u5217\u5316\u3002\u6d41\u6c34\u7dda\u7684\u4ee3\u78bc\u5fc5\u9808\u5c07\u6240\u6709\u904b\u884c\u6642\u53c3\u6578\u90fd\u5c01\u88dd\u5728 `ValueProvider` \u63a5\u53e3\u4e2d\u3002\u8a72\u63a5\u53e3\u5141\u8a31\u7528\u6236\u5728\u90e8\u7f72\u6a21\u677f\u6642\u6307\u5b9a\u53c3\u6578\u503c\u3002\u5982\u9700\u5c07 API \u8207\u7d93\u5178\u6a21\u677f\u642d\u914d\u4f7f\u7528\uff0c\u8acb\u53c3\u95b1 [projects.locations.templates](https://cloud.google.com/dataflow/docs/reference/rest/v1b3/projects.locations.templates?hl=zh-cn) API \u53c3\u8003\u6587\u6a94\u3002\n\u8207\u7d93\u5178\u6a21\u677f\u76f8\u6bd4\uff0cFlex \u6a21\u677f\u5177\u6709\u4ee5\u4e0b\u512a\u52e2\uff1a- \u8207\u7d93\u5178\u6a21\u677f\u4e0d\u540c\uff0cFlex \u6a21\u677f\u4e0d\u9700\u8981\u85c9\u52a9`ValueProvider`\u63a5\u53e3\u4f86\u6307\u5b9a\u8f38\u5165\u53c3\u6578\u3002\u4e26\u975e\u6240\u6709 Dataflow \u4f86\u6e90\u548c\u63a5\u6536\u5668\u90fd\u652f\u6301`ValueProvider`\u3002\n- \u7d93\u5178\u6a21\u677f\u63d0\u4f9b\u7684\u662f\u975c\u614b\u4f5c\u696d\u5716\uff0cFlex \u6a21\u677f\u5247\u53ef\u4ee5\u52d5\u614b\u69cb\u5efa\u4f5c\u696d\u5716\u3002\u4f8b\u5982\uff0c\u6a21\u677f\u53ef\u4ee5\u6839\u64da\u8f38\u5165\u53c3\u6578\u9078\u64c7\u4e0d\u540c\u7684 I/O \u9023\u63a5\u5668\u3002\n- Flex \u6a21\u677f\u53ef\u4ee5\u5728\u6d41\u6c34\u7dda\u69cb\u5efa\u671f\u9593\u5c0d\u865b\u64ec\u6a5f\u57f7\u884c\u9810\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5b83\u53ef\u4ee5\u5728\u8a72\u904e\u7a0b\u4e2d\u9a57\u8b49\u8f38\u5165\u53c3\u6578\u503c\u3002## \u6a21\u677f\u5de5\u4f5c\u6d41Dataflow \u6a21\u677f\u7684\u4f7f\u7528\u904e\u7a0b\u6d89\u53ca\u4ee5\u4e0b\u7c21\u8981\u6b65\u9a5f\uff1a\n- \u958b\u767c\u8005\u9700\u8a2d\u7f6e\u958b\u767c\u74b0\u5883\u4e26\u958b\u767c\u6d41\u6c34\u7dda\u3002\u8a72\u74b0\u5883\u61c9\u5305\u542b Apache Beam SDK \u548c\u5176\u4ed6\u4f9d\u8cf4\u9805\u3002\n- \u4e4b\u5f8c\uff0c\u9700\u6839\u64da\u6a21\u677f\u985e\u578b\uff08Flex \u6216\u7d93\u5178\uff09\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5c0d\u65bc Flex \u6a21\u677f\uff0c\u958b\u767c\u8005\u9700\u5c07\u6d41\u6c34\u7dda\u5c01\u88dd\u5230 Docker \u6620\u50cf\u4e2d\uff0c\u7136\u5f8c\u5c07\u8a72\u6620\u50cf\u63a8\u9001\u5230 Artifact Registry\uff0c\u4e26\u5c07\u6a21\u677f\u898f\u7bc4\u6587\u4ef6\u4e0a\u50b3\u5230 Cloud Storage\u3002\n- \u5c0d\u65bc\u7d93\u5178\u6a21\u677f\uff0c\u958b\u767c\u8005\u9700\u904b\u884c\u6d41\u6c34\u7dda\uff0c\u5275\u5efa\u6a21\u677f\u6587\u4ef6\u4e26\u5c07\u6a21\u677f\u66ab\u5b58\u5230 Cloud Storage\u3002- \u63a5\u4e0b\u4f86\uff0c\u5176\u4ed6\u7528\u6236\u9700\u5411 Dataflow \u670d\u52d9\u63d0\u4ea4\u904b\u884c\u6a21\u677f\u7684\u8acb\u6c42\u3002\n- \u4e4b\u5f8c\uff0cDataflow \u4fbf\u6703\u57fa\u65bc\u6a21\u677f\u5275\u5efa\u6d41\u6c34\u7dda\u3002\u6d41\u6c34\u7dda\u6700\u591a\u53ef\u80fd\u9700\u8981 5 \u5230 7 \u5206\u9418\u624d\u80fd\u958b\u59cb\u904b\u884c\u3002## \u8a2d\u7f6e IAM \u6b0a\u9650Dataflow \u4f5c\u696d\uff08\u5305\u62ec\u901a\u904e\u6a21\u677f\u904b\u884c\u7684\u4f5c\u696d\uff09\u4f7f\u7528\u5169\u500b IAM \u670d\u52d9\u8cec\u865f\uff1a- Dataflow \u670d\u52d9\u4f7f\u7528 [Dataflow \u670d\u52d9\u8cec\u865f](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#service_account) \u4f86\u8655\u7406 Google Cloud \u8cc7\u6e90\uff0c\u4f8b\u5982\u5275\u5efa\u865b\u64ec\u6a5f\u3002\n- Dataflow \u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\u4f7f\u7528 [\u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#worker-service-account) \u4f86\u8a2a\u554f\u6d41\u6c34\u7dda\u7684\u6587\u4ef6\u548c\u5176\u4ed6\u8cc7\u6e90\u3002\u6b64\u670d\u52d9\u8cec\u865f\u9700\u8981\u8a2a\u554f\u6d41\u6c34\u7dda\u4f5c\u696d\u5f15\u7528\u7684\u4efb\u4f55\u8cc7\u6e90\uff0c\u5305\u62ec\u6a21\u677f\u4f7f\u7528\u7684\u4f86\u6e90\u548c\u63a5\u6536\u5668\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u8a2a\u554f Google Cloud \u8cc7\u6e90](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#access-resources) \u3002\n\u78ba\u4fdd\u9019\u5169\u500b\u670d\u52d9\u8cec\u865f\u5747\u5177\u6709\u9069\u7576\u7684\u89d2\u8272\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Dataflow \u5b89\u5168\u6027\u548c\u6b0a\u9650](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn) \u3002\n## Apache Beam SDK \u7248\u672c\u8981\u6c42\u8981\u5275\u5efa\u81ea\u5df1\u7684\u6a21\u677f\uff0c\u8acb\u78ba\u4fdd\u60a8\u7684 Apache Beam SDK \u7248\u672c\u652f\u6301\u5275\u5efa\u6a21\u677f\u3002\u5982\u9700\u4f7f\u7528 Java \u7248 Apache Beam SDK 2.x \u5275\u5efa\u6a21\u677f\uff0c\u60a8\u5fc5\u9808\u5177\u5099 2.0.0-beta3 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u5982\u9700\u4f7f\u7528 Python \u7248 Apache Beam SDK 2.x \u5275\u5efa\u6a21\u677f\uff0c\u60a8\u5fc5\u9808\u5177\u5099 2.0.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n\u5982\u9700\u4f7f\u7528 Google Cloud CLI \u904b\u884c\u6a21\u677f\uff0c\u60a8\u5fc5\u9808\u5177\u5099 [Google Cloud CLI](https://cloud.google.com/sdk/downloads?hl=zh-cn) 138.0.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n## \u64f4\u5c55\u6a21\u677f\u60a8\u53ef\u4ee5\u901a\u904e\u64f4\u5c55 [\u958b\u6e90](https://github.com/GoogleCloudPlatform/DataflowTemplates) Dataflow \u6a21\u677f\u4f86\u69cb\u5efa\u81ea\u5df1\u7684\u6a21\u677f\u3002\u4f8b\u5982\uff0c\u5c0d\u65bc\u4f7f\u7528\u56fa\u5b9a\u7a97\u53e3\u6301\u7e8c\u6642\u9593\u7684\u6a21\u677f\uff0c\u53ef\u80fd\u6703\u6368\u68c4\u5728\u7a97\u53e3\u4e4b\u5916\u5230\u9054\u7684\u6578\u64da\u3002\u7232\u4e86\u907f\u514d\u51fa\u73fe\u6b64\u884c\u7232\uff0c\u8acb\u4f7f\u7528\u6a21\u677f\u4ee3\u78bc\u4f5c\u7232\u57fa\u790e\uff0c\u4fee\u6539\u4ee3\u78bc\u4ee5\u8abf\u7528 [.withAllowedLateness](https://beam.apache.org/documentation/programming-guide/#managing-late-data) \u64cd\u4f5c\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [Google \u63d0\u4f9b\u7684\u6a21\u677f](https://cloud.google.com/dataflow/docs/templates/provided-templates?hl=zh-cn) \n- [\u5275\u5efa\u7d93\u5178\u6a21\u677f](https://cloud.google.com/dataflow/docs/templates/creating-templates?hl=zh-cn) \n- [\u904b\u884c\u7d93\u5178\u6a21\u677f](https://cloud.google.com/dataflow/docs/templates/executing-templates?hl=zh-cn) \n- [\u69cb\u5efa\u548c\u904b\u884c Flex \u6a21\u677f](https://cloud.google.com/dataflow/docs/guides/templates/using-flex-templates?hl=zh-cn) \n- [\u5c0d Flex \u6a21\u677f\u9032\u884c\u554f\u984c\u6392\u67e5](https://cloud.google.com/dataflow/docs/guides/troubleshoot-templates?hl=zh-cn)", "guide": "Dataflow"}