{"title": "Dataflow - \u4f7f\u7528 IAM \u9032\u884c\u8a2a\u554f\u6b0a\u9650\u63a7\u5236", "url": "https://cloud.google.com/dataflow/docs/concepts/access-control?hl=zh-cn", "abstract": "# Dataflow - \u4f7f\u7528 IAM \u9032\u884c\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\n\u5982\u9700\u9650\u5236\u9805\u76ee\u6216\u7d44\u7e54\u5167\u7528\u6236\u7684\u8a2a\u554f\u6b0a\u9650\uff0c\u60a8\u53ef\u4ee5\u7232 Dataflow \u4f7f\u7528 Identity and Access Management (IAM) \u89d2\u8272\u3002\u60a8\u53ef\u4ee5\u63a7\u5236\u5c0d Dataflow \u76f8\u95dc\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\uff0c\u800c\u4e0d\u662f\u5411\u7528\u6236\u6388\u4e88\u6574\u500b Google Cloud \u9805\u76ee\u7684 Viewer\u3001Editor \u6216 Owner \u89d2\u8272\u3002\n\u672c\u9801\u91cd\u9ede\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528 Dataflow \u7684 IAM \u89d2\u8272\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 IAM \u53ca\u5176\u529f\u80fd\uff0c\u8acb\u53c3\u95b1 [IAM \u6587\u6a94](https://cloud.google.com/iam/docs?hl=zh-cn) \u3002\n\u6bcf\u7a2e Dataflow \u65b9\u6cd5\u90fd\u8981\u6c42\u8abf\u7528\u8005\u64c1\u6709\u5fc5\u8981\u7684\u6b0a\u9650\u3002\u6709\u95dc Dataflow \u652f\u6301\u7684\u6b0a\u9650\u548c\u89d2\u8272\u7684\u5217\u8868\uff0c\u8acb\u53c3\u95b1\u4ee5\u4e0b\u90e8\u5206\u3002\n", "content": "## \u6b0a\u9650\u548c\u89d2\u8272\n\u672c\u90e8\u5206\u5f59\u7e3d\u4e86 Dataflow IAM \u652f\u6301\u7684\u6b0a\u9650\u548c\u89d2\u8272\u3002\n### \u6240\u9700\u6b0a\u9650\n\u4e0b\u8868\u5217\u51fa\u4e86\u8abf\u7528\u8005\u8abf\u7528\u6bcf\u7a2e\u65b9\u6cd5\u5fc5\u9808\u5177\u5099\u7684\u6b0a\u9650\uff1a\n| \u65b9\u6cd5       | \u6240\u9700\u6b0a\u9650      |\n|:-----------------------------|:-----------------------------|\n| dataflow.jobs.create   | dataflow.jobs.create   |\n| dataflow.jobs.cancel   | dataflow.jobs.cancel   |\n| dataflow.jobs.updateContents | dataflow.jobs.updateContents |\n| dataflow.jobs.list   | dataflow.jobs.list   |\n| dataflow.jobs.get   | dataflow.jobs.get   |\n| dataflow.messages.list  | dataflow.messages.list  |\n| dataflow.metrics.get   | dataflow.metrics.get   |\n| dataflow.jobs.snapshot  | dataflow.jobs.snapshot  |\n### \u89d2\u8272\n\u4e0b\u8868\u5217\u51fa\u4e86 Dataflow IAM \u89d2\u8272\uff0c\u9084\u6709\u4e00\u500b\u5217\u8868\u5217\u51fa\u6bcf\u500b\u89d2\u8272\u5305\u542b\u7684 Dataflow \u76f8\u95dc\u6b0a\u9650\u3002\u6bcf\u500b\u6b0a\u9650\u9069\u7528\u65bc\u7279\u5b9a\u7684\u8cc7\u6e90\u985e\u578b\u3002\u5982\u9700\u67e5\u770b\u6b0a\u9650\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [Google Cloud Console](https://console.cloud.google.com/iam-admin/roles?hl=zh-cn) \u4e2d\u7684 **\u89d2\u8272** \u9801\u9762\u3002\n| Role                                                       | Permissions                                                                                                                                                                                                                             |\n|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Dataflow Admin (roles/dataflow.admin) Minimal role for creating and managing dataflow jobs.                                 | cloudbuild.builds.create cloudbuild.builds.get cloudbuild.builds.list cloudbuild.builds.update cloudbuild.operations.* cloudbuild.operations.get cloudbuild.operations.list compute.machineTypes.get compute.projects.get compute.regions.list compute.zones.list dataflow.jobs.* dataflow.jobs.cancel dataflow.jobs.create dataflow.jobs.get dataflow.jobs.list dataflow.jobs.snapshot dataflow.jobs.updateContents dataflow.messages.list dataflow.metrics.get dataflow.snapshots.* dataflow.snapshots.delete dataflow.snapshots.get dataflow.snapshots.list recommender.dataflowDiagnosticsInsights.* recommender.dataflowDiagnosticsInsights.get recommender.dataflowDiagnosticsInsights.list recommender.dataflowDiagnosticsInsights.update remotebuildexecution.blobs.get resourcemanager.projects.get resourcemanager.projects.list storage.buckets.get storage.objects.create storage.objects.get storage.objects.list |\n| Dataflow Developer (roles/dataflow.developer) Provides the permissions necessary to execute and manipulate Dataflow jobs. Lowest-level resources where you can grant this role: Project          | cloudbuild.builds.create cloudbuild.builds.get cloudbuild.builds.list cloudbuild.builds.update cloudbuild.operations.* cloudbuild.operations.get cloudbuild.operations.list compute.projects.get compute.regions.list compute.zones.list dataflow.jobs.* dataflow.jobs.cancel dataflow.jobs.create dataflow.jobs.get dataflow.jobs.list dataflow.jobs.snapshot dataflow.jobs.updateContents dataflow.messages.list dataflow.metrics.get dataflow.snapshots.* dataflow.snapshots.delete dataflow.snapshots.get dataflow.snapshots.list recommender.dataflowDiagnosticsInsights.* recommender.dataflowDiagnosticsInsights.get recommender.dataflowDiagnosticsInsights.list recommender.dataflowDiagnosticsInsights.update remotebuildexecution.blobs.get resourcemanager.projects.get resourcemanager.projects.list                            |\n| Dataflow Viewer (roles/dataflow.viewer) Provides read-only access to all Dataflow-related resources. Lowest-level resources where you can grant this role: Project               | dataflow.jobs.get dataflow.jobs.list dataflow.messages.list dataflow.metrics.get dataflow.snapshots.get dataflow.snapshots.list recommender.dataflowDiagnosticsInsights.get recommender.dataflowDiagnosticsInsights.list resourcemanager.projects.get resourcemanager.projects.list                                                                                                                                                           |\n| Dataflow Worker (roles/dataflow.worker) Provides the permissions necessary for a Compute Engine service account to execute work units for a Dataflow pipeline. Lowest-level resources where you can grant this role: Project | autoscaling.sites.readRecommendations autoscaling.sites.writeMetrics autoscaling.sites.writeState compute.instanceGroupManagers.update compute.instances.delete compute.instances.setDiskAutoDelete dataflow.jobs.get dataflow.shuffle.* dataflow.shuffle.read dataflow.shuffle.write dataflow.streamingWorkItems.* dataflow.streamingWorkItems.ImportState dataflow.streamingWorkItems.commitWork dataflow.streamingWorkItems.getData dataflow.streamingWorkItems.getWork dataflow.streamingWorkItems.getWorkerMetadata dataflow.workItems.* dataflow.workItems.lease dataflow.workItems.sendMessage dataflow.workItems.update logging.logEntries.create logging.logEntries.route monitoring.timeSeries.create storage.buckets.get storage.objects.create storage.objects.get                                     |\nDataflow Worker \u89d2\u8272 ( `roles/dataflow.worker` ) \u53ef\u7232 Compute Engine \u670d\u52d9\u8cec\u865f\u63d0\u4f9b\u904b\u884c Apache Beam \u6d41\u6c34\u7dda\u5de5\u4f5c\u55ae\u5143\u6240\u9700\u7684\u6b0a\u9650\u3002Dataflow \u5de5\u4f5c\u5668\u89d2\u8272\u5fc5\u9808\u5206\u914d\u7d66\u80fd\u5920\u5f9e Dataflow \u670d\u52d9\u8acb\u6c42\u548c\u66f4\u65b0\u5de5\u4f5c\u7684\u670d\u52d9\u8cec\u865f\u3002\nDataflow \u670d\u52d9\u4ee3\u7406\u89d2\u8272 ( `roles/dataflow.serviceAgent` ) \u50c5\u4f9b [Dataflow \u670d\u52d9\u8cec\u865f](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#service_account) \u4f7f\u7528\u3002\u5b83\u7232\u670d\u52d9\u8cec\u865f\u6388\u4e88\u5c0d Google Cloud \u9805\u76ee\u4e2d\u8a17\u7ba1\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\uff0c\u4ee5\u904b\u884c Dataflow \u4f5c\u696d\u3002\u7576\u60a8\u5f9e Google Cloud Console \u4e2d\u7684 [API \u9801\u9762](https://console.cloud.google.com/project/_/apiui/apis/library?hl=zh-cn) \u7232\u9805\u76ee\u5553\u7528 Dataflow API \u6642\uff0c\u7cfb\u7d71\u6703\u81ea\u52d5\u5c07\u5176\u5206\u914d\u7d66\u670d\u52d9\u8cec\u865f\u3002\n### \u5275\u5efa\u4f5c\u696d\n\u8981\u5275\u5efa\u4f5c\u696d\uff0c [roles/dataflow.admin](#roles) \u89d2\u8272\u9700\u5177\u5099\u904b\u884c\u548c\u6aa2\u67e5\u4f5c\u696d\u6240\u9700\u7684\u4e00\u7d44\u6700\u4f4e\u6b0a\u9650\u3002\n\u6216\u8005\uff0c\u9700\u8981\u5177\u5099\u4ee5\u4e0b\u6b0a\u9650\uff1a\n- [roles/dataflow.developer](#roles) \u89d2\u8272\uff0c\u53ef\u5c07\u4f5c\u696d\u672c\u8eab\u5be6\u4f8b\u5316\u3002\n- [roles/compute.viewer](https://cloud.google.com/compute/docs/access/iam?hl=zh-cn#compute.viewer) \u89d2\u8272\uff0c\u53ef\u8a2a\u554f\u6a5f\u5668\u985e\u578b\u4fe1\u606f\u53ca\u67e5\u770b\u5176\u4ed6\u8a2d\u7f6e\u3002\n- [roles/storage.objectAdmin](https://cloud.google.com/storage/docs/access-control/iam-roles?hl=zh-cn#standard-roles) \u89d2\u8272\uff0c\u53ef\u63d0\u4f9b\u5c07\u6587\u4ef6\u66ab\u5b58\u5728 Cloud Storage \u4e0a\u7684\u6b0a\u9650\u3002## \u89d2\u8272\u5206\u914d\u793a\u4f8b\n\u7232\u4e86\u8aaa\u660e\u4e0d\u540c Dataflow \u89d2\u8272\u7684\u6548\u7528\uff0c\u8acb\u8003\u616e\u4ee5\u4e0b\u7d30\u5206\u8b1b\u89e3\uff1a\n- \u5275\u5efa\u548c\u6aa2\u67e5\u4f5c\u696d\u7684\u958b\u767c\u8005\u9700\u8981 [roles/iam.serviceAccountUser](#roles) \u89d2\u8272\u3002\n- \u7232\u9032\u884c\u66f4\u5fa9\u96dc\u7684\u6b0a\u9650\u7ba1\u7406\uff0c\u8207 Dataflow \u4f5c\u696d\u4ea4\u4e92\u7684\u958b\u767c\u8005\u9700\u8981 [roles/dataflow.developer](#roles) \u89d2\u8272\u3002\n- \u5982\u9700\u66ab\u5b58\u5fc5\u8981\u7684\u6587\u4ef6\uff0c\u958b\u767c\u8005\u9700\u8981 [roles/storage.objectAdmin](https://cloud.google.com/storage/docs/access-control/iam-roles?hl=zh-cn#standard-roles) \u6216\u76f8\u95dc\u89d2\u8272\u3002\n- \u5982\u9700\u9032\u884c\u8abf\u8a66\u548c\u914d\u984d\u6aa2\u67e5\uff0c\u958b\u767c\u8005\u9700\u8981\u9805\u76ee\u7684 [roles/compute.viewer](https://cloud.google.com/compute/docs/access/iam?hl=zh-cn#compute.viewer) \u89d2\u8272\u3002\n- \u5982\u679c\u6c92\u6709\u5206\u914d\u5176\u4ed6\u89d2\u8272\uff0c\u958b\u767c\u8005\u53ef\u4ee5\u901a\u904e\u6b64\u89d2\u8272\u5275\u5efa\u548c\u53d6\u6d88 Dataflow \u4f5c\u696d\uff0c\u4f46\u4e0d\u80fd\u8207\u5404\u500b\u865b\u64ec\u6a5f\u4ea4\u4e92\uff0c\u4e5f\u4e0d\u80fd\u8a2a\u554f\u5176\u4ed6 Cloud \u670d\u52d9\u3002\n- [\u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#worker-service-account) \u9700\u8981 [roles/dataflow.worker](#roles) \u548c [roles/dataflow.admin](#roles) \u89d2\u8272\u624d\u80fd\u8655\u7406 Dataflow \u670d\u52d9\u7684\u6578\u64da\u3002- \u5982\u9700\u8a2a\u554f\u4f5c\u696d\u6578\u64da\uff0c\u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f\u9084\u9700\u8981\u5176\u4ed6\u89d2\u8272\uff0c\u5982 [roles/storage.objectAdmin](https://cloud.google.com/storage/docs/access-control/iam-roles?hl=zh-cn#standard-roles) \u3002\n- \u5982\u9700\u5beb\u5165 BigQuery \u8868\uff0c\u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f\u9700\u8981 [roles/bigquery.dataEditor](https://cloud.google.com/bigquery/docs/access-control?hl=zh-cn) \u89d2\u8272\u3002\n- \u5982\u9700\u5f9e Pub/Sub \u4e3b\u984c\u6216\u8a02\u95b1\u4e2d\u8b80\u53d6\u6578\u64da\uff0c\u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f\u9700\u8981\u5177\u5099 [roles/pubsub.editor](https://cloud.google.com/pubsub/docs/access-control?hl=zh-cn#roles) \u89d2\u8272\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u5171\u4eab VPC\uff0c\u5247\u5171\u4eab VPC \u5b50\u7db2\u9700\u8981\u8207 [Dataflow \u670d\u52d9\u8cec\u865f](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#df-service-account) \u5171\u4eab\uff0c\u4e26\u4e14\u9700\u8981\u5177\u6709\u6307\u5b9a\u5b50\u7db2\u4e0a\u5206\u914d\u7684 [Compute Network User \u89d2\u8272](https://cloud.google.com/compute/docs/access/iam?hl=zh-cn#compute.networkUser) \u3002- \u5982\u9700\u67e5\u770b\u5171\u4eab VPC \u5b50\u7db2\u662f\u5426\u8207 Dataflow \u670d\u52d9\u8cec\u865f\u5171\u4eab\uff0c\u8acb\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u8f49\u5230 **\u5171\u4eab VPC** \u9801\u9762\uff0c\u7136\u5f8c\u641c\u7d22\u5b50\u7db2\u3002\u5728 **\u5171\u4eab\u5c0d\u8c61** \u5217\u4e2d\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b VPC \u5b50\u7db2\u662f\u5426\u5df2\u8207 Dataflow \u670d\u52d9\u8cec\u865f\u5171\u4eab\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u5171\u4eab VPC \u6307\u5b9a\u5b50\u7db2\u53c3\u6578\u7684\u6e96\u5247](https://cloud.google.com/dataflow/docs/guides/specifying-networks?hl=zh-cn#shared) \u3002\n- \u5bbf\u4e3b\u9805\u76ee\u7684 [Compute Engine \u670d\u52d9\u8cec\u865f](https://cloud.google.com/compute/docs/access/service-accounts?hl=zh-cn#default_service_account) \u3001\u670d\u52d9\u9805\u76ee\u7684 [Dataflow \u5de5\u4f5c\u5668\u670d\u52d9\u8cec\u865f](https://cloud.google.com/dataflow/docs/concepts/security-and-permissions?hl=zh-cn#worker-service-account) \u4ee5\u53ca\u7528\u65bc\u63d0\u4ea4\u4f5c\u696d\u7684\u670d\u52d9\u8cec\u865f\u9700\u8981\u5177\u6709\u4ee5\u4e0b\u89d2\u8272\uff1a- `roles/dataflow.admin`\n- `roles/dataflow.serviceAgent`\n- [roles/compute.networkUser](https://cloud.google.com/compute/docs/access/iam?hl=zh-cn#compute.networkUser) \n- [roles/storage.objectViewer](https://cloud.google.com/storage/docs/access-control/iam-roles?hl=zh-cn) ## \u5206\u914d Dataflow \u89d2\u8272\n\u76ee\u524d\uff0cDataflow \u89d2\u8272\u53ea\u80fd\u5728\u7d44\u7e54\u548c\u9805\u76ee\u7d1a\u5c64\u8a2d\u7f6e\u3002\n\u8981\u7ba1\u7406\u7d44\u7e54\u7d1a\u5c64\u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 IAM \u5c0d\u7d44\u7e54\u9032\u884c\u8a2a\u554f\u6b0a\u9650\u63a7\u5236](https://cloud.google.com/resource-manager/docs/access-control-org?hl=zh-cn) \u3002\n\u8981\u8a2d\u7f6e\u9805\u76ee\u7d1a\u5c64\u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [\u6388\u4e88\u3001\u66f4\u6539\u548c\u64a4\u6d88\u5c0d\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/iam/docs/managing-policies?hl=zh-cn#access_control_via_console) \u3002", "guide": "Dataflow"}