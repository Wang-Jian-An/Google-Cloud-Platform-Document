{"title": "Google Kubernetes Engine (GKE) - Viewing deprecation insights and recommendations", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview", "abstract": "# Google Kubernetes Engine (GKE) - Viewing deprecation insights and recommendations\nThis page shows you how to view and about Kubernetes deprecations for your Google Kubernetes Engine (GKE) clusters. To learn more about how to manage Kubernetes deprecations with GKE, see [GKE deprecations](/kubernetes-engine/docs/deprecations) .\n", "content": "## What are deprecation insights and recommendations?\nWhen GKE detects that a cluster is using a Kubernetes feature or API that is deprecated and will be removed in an upcoming minor version, the following happens:\n- [Automatic upgrade](/kubernetes-engine/docs/concepts/cluster-upgrades#upgrading_automatically) to the upcoming minor version is paused. To learn more about how this works, see [What happens when GKE pauses automatic upgrades](/kubernetes-engine/docs/deprecations#auto-upgrade-pause) .\n- An insight and recommendation are generated so that you can assess and mitigate your cluster's exposure to the deprecation.\nDeprecation insights and recommendations are available from [Recommender](/recommender/docs/overview) , a service that provides insights and recommendations for using resources on Google Cloud. To learn more about how Recommender works with GKE, see [Optimize your usage of GKE with insights and recommendations](/kubernetes-engine/docs/how-to/optimize-with-recommenders) .\nFor the deprecations topic with Recommender:\n- Anexplains that your cluster uses a feature or API that is deprecated and will be removed in an upcoming minor version.\n- Aprovides guidance on what to do to mitigate your cluster's exposure to the deprecation.\nFor example, an insight might explain that your cluster is using a beta API that is deprecated and will be removed in the next minor version. The recommendation explains that you should migrate your workloads from using the beta APIs to using v1 APIs. Each recommendation includes a reference to a migration guide for the deprecated feature or API. This migration guide is also available in the [corresponding table for Kubernetes deprecations](/kubernetes-engine/docs/deprecations#deprecations-information) .\nWhen GKE generates an insight and recommendation pair, it covers usage of any deprecated Kubernetes APIs or features in a particular [insight subtype](#use-of-features) for one cluster in your project. For example, if any user agents call any of the APIs addressed by the `DEPRECATION_K8S_1_22_V1BETA1_API` subtype, one insight and recommendation appear to recommend that you migrate this cluster from using these APIs. If another cluster is also using these APIs, GKE generates another insight and recommendation.\n### Use of deprecated Kubernetes features and APIs detected by GKE\n| Deprecation                  | Removed in GKE version | Insight subtype      |\n|:-----------------------------------------------------------------------------------|:-------------------------|:---------------------------------------|\n| TLS certificates signed with SHA-1 algorithm          | 1.29      | DEPRECATION_K8S_SHA_1_CERTIFICATE  |\n| Kubernetes 1.29 deprecated APIs             | 1.29      | DEPRECATION_K8S_1_29_API    |\n| Kubernetes 1.27 deprecated APIs             | 1.27      | DEPRECATION_K8S_1_27_API    |\n| Kubernetes 1.26 deprecated APIs             | 1.26      | DEPRECATION_K8S_1_26_API    |\n| Kubernetes 1.25 deprecated APIs             | 1.25      | DEPRECATION_K8S_1_25_API    |\n| PodSecurityPolicy                 | 1.25      | DEPRECATION_K8S_1_25_PODSECURITYPOLICY |\n| Docker-based node images               | 1.24      | DEPRECATION_K8S_1_24_DOCKERSHIM  |\n| X.509 Common Name field in webhook certificates         | 1.23      | DEPRECATION_K8S_1_23_CERTIFICATE  |\n| Kubernetes 1.22 deprecated APIs, Kubernetes Ingress Beta APIs removed in GKE 1.23 | 1.22, 1.23    | DEPRECATION_K8S_1_22_V1BETA1_API  |\nRemember that for [upcoming deprecations](/kubernetes-engine/docs/deprecations#deprecations-information) , you must independently assess your cluster environment's exposure and mitigate any issues.\n## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.\n### Required roles\nEnsure that you have the necessary permissions for Kubernetes insights and recommendations, either with the following [basic roles](/iam/docs/understanding-roles#basic) or [predefined roles](/iam/docs/understanding-roles#predefined) :\n- View insights and recommendations with one of the following roles:- [Viewer](/iam/docs/understanding-roles#basic) \n- [GKE Diagnosis Recommender Viewer](/iam/docs/understanding-roles#recommender.containerDiagnosisViewer) \n- View and update the state of insights and recommendations (for example, [dismiss a recommendation](#dismiss-recommendation) ):- [Editor](/iam/docs/understanding-roles#basic) \n- [Kubernetes Engine Admin](/iam/docs/understanding-roles#container.admin) \n- [Kubernetes Engine Developer](/iam/docs/understanding-roles#container.developer) \n- [GKE Diagnosis Recommender Admin](/iam/docs/understanding-roles#recommender.containerDiagnosisAdmin) \n## View insights and recommendations\nYou can view insights and recommendations with the Google Cloud CLI, in the Google Cloud console, or with the [Recommender API](/recommender/docs/reference/rest) .\n- Go to the **Google Kubernetes Engine** page in the Google Cloud console: [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Check the **Notifications** column for specific clusters to find insights.\n- Click on the insight to reveal more information. In the revealed sidebar panel, you can see details about this insight, including any associated recommendation.\nAn insight typically has a corresponding recommendation. Insights are fetched with [gcloud recommender insights](/sdk/gcloud/reference/recommender/insights) and recommendations are fetched with [gcloud recommender recommendations](/sdk/gcloud/reference/recommender/recommendations) .- View the list of insights for the clusters of a specific zone (for zonal clusters) or a specific region (for regional clusters):```\ngcloud recommender insights list \\\u00a0 \u00a0 --insight-type=google.container.DiagnosisInsight \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT \\\u00a0 \u00a0 --filter=\"insightSubtype:SUBTYPE\"\n```Replace the following:- ``: the Google Cloud project ID for the project where the cluster(s) are located.\n- ``: the exact region or zone of the cluster. For [zonal clusters](/kubernetes-engine/docs/concepts/types-of-clusters#zonal_clusters) , you must provide the exact zone (e.g.`us-central1-c`). For [regional clusters](/kubernetes-engine/docs/concepts/types-of-clusters#regional_clusters) , you must provide the exact region (e.g.`us-central1`).\n- ``: change the output format to YAML. This flag is optional.\n- ``: an [insight subtype](/recommender/docs/insights/using-insights#insight_subtype) , for example,`DEPRECATION_K8S_1_23_CERTIFICATE`. This limits the output to insights of a specified subtype. This flag is optional.\nOr, if you already have an insight ID, you can see details about the insight by running the following command:```\ngcloud recommender insights describe INSIGHT \\\u00a0 \u00a0 --insight-type=google.container.DiagnosisInsight \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT\n```Replace the `` with the value of insight ID, specified at the end of the URL from the `name` field for the insight. **Note:** To view the associated recommendation, save the **recommendation ID** value of the `associatedRecommendations.recommendation` from the command output for Step 2.The output includes additional details about what behavior GKE has detected with your cluster.\n- View the list of recommendations for the clusters of a specific zone (for zonal clusters) or a specific region (for regional clusters): **Note:** Use the `describe` command instead if you already have a **recommendation ID** from Step 1 and want to see a specific recommendation.```\ngcloud recommender recommendations list \\\u00a0 \u00a0 --recommender=google.container.DiagnosisRecommender \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT \\\u00a0 \u00a0 --filter=\"recommenderSubtype:SUBTYPE\"\n```Replace `` with a [recommender subtype](/recommender/docs/key-concepts#recommender_subtype) , for example, `DEPRECATION_K8S_1_23_CERTIFICATE` . This limits the output to recommendations of a specified subtype. This flag is optional.Or, if you already have a recommendation ID, you can view the recommendation by running the following command:```\ngcloud recommender recommendations describe RECOMMENDATION_ID \\\u00a0 \u00a0 --recommender=google.container.DiagnosisRecommender \\\u00a0 \u00a0 --location=LOCATION \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --format=FORMAT\n```Replace the `` with the saved value of `associatedRecommendations.recommendation` from the command output in Step 1.The output provides guidance on what action you might need to take to optimize your cluster's usage of GKE.\nEach insight has a corresponding recommendation. Insights are fetched with [REST Resource: projects.locations.insightTypes.insights](/recommender/docs/reference/rest/v1/projects.locations.insightTypes.insights) and recommendations are fetched with [REST Resource: projects.locations.recommenders.recommendations](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations) .- View the list of insights for the clusters of a specific zone (for zonal clusters) or a specific region (for regional clusters):```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/insightTypes/google.container.DiagnosisInsight/insights?filter=insightSubtype%20%3D%20SUBTYPE\n```Replace the following:- ``: the Google Cloud project ID for the project where the cluster(s) are located.\n- ``: the exact region or zone of the cluster. For [zonal clusters](/kubernetes-engine/docs/concepts/types-of-clusters#zonal_clusters) , you must provide the exact zone (e.g.`us-central1-c`). For [regional clusters](/kubernetes-engine/docs/concepts/types-of-clusters#regional_clusters) , you must provide the exact region (e.g.`us-central1`).\n- ``: an [insight subtype](/recommender/docs/insights/using-insights#insight_subtype) , for example,`DEPRECATION_K8S_1_23_CERTIFICATE`. This limits the output to insights of a specified subtype. This flag is optional.\nOr, if you already have an insight ID, you can see details about the insight by making the following request:```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/insightTypes/google.container.DiagnosisInsight/insights/INSIGHT\n```Replace the `` with the value of insight ID, specified at the end of the URL from the `name` field for the insight. **Note:** To view the associated recommendation, save the **recommendation ID** value of the `associatedRecommendations.recommendation` from the response body for Step 2.The response body includes details about what behavior GKE has detected with your cluster.\n- View the list of recommendations for the clusters of a specific zone (for zonal clusters) or a specific region (for regional clusters): **Note:** Use the `recommendations.get` request instead if you already have a **recommendation ID** from Step 1 and want to see a specific recommendation.```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/recommenders/google.container.DiagnosisRecommender/recommendations?filter=recommenderSubtype%20%3D%20SUBTYPE\n```Replace `` with a [recommender subtype](/recommender/docs/key-concepts#recommender_subtype) , for example, `DEPRECATION_K8S_1_23_CERTIFICATE` . This limits the output to recommendations of a specified subtype. This flag is optional.Or, if you already have a recommendation ID, you can view the recommendation by making the following request:```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/recommenders/google.container.DiagnosisRecommender/recommendations/RECOMMENDATION_ID\n```Replace the `` with the saved value of `associatedRecommendations.recommendation` from the response body in Step 1.The response body provides guidance on what action you might need to take to optimize your cluster's usage of GKE.A deprecation insight includes details about the timing and amount of usage of a deprecated feature or API. The information included in the insight depends on for what [type of deprecation](#use-of-features) the insight is providing information.\nThis is an example insight for the `DEPRECATION_K8S_1_22_V1BETA1_API` insight subtype:\n```\n name: projects/<PROJECT-NUMBER>/locations/us-central1/insightTypes/google.container.DiagnosisInsight/insights/<INSIGHT-ID>\n observationPeriod: 2592000s\n severity: HIGH\n category: RELIABILITY\n stateInfo:\n state: ACTIVE\n insightSubtype: DEPRECATION_K8S_1_22_V1BETA1_API\n description: Your API clients have used deprecated APIs in the last 30 days that are removed in Kubernetes v1.22. Upgrading your cluster before migrating to the updated APIs supported by v1.22 could cause it to break. [Learn more](https://kubernetes.io/docs/reference/using-api/deprecation-guide/#v1-22).\n targetResources:\n - //container.googleapis.com/projects/<PROJECT-NUMBER>/locations/us-central1/clusters/c1\n associatedRecommendations:\n - recommendation: projects/<PROJECT-NUMBER>/locations/us-central1/recommenders/google.container.DiagnosisRecommender/recommendations/<RECOMMENDATION-ID>\n etag: '\"2147dd8e1e302ed7\"'\n lastRefreshTime: \"2022-01-30T08:00:00Z\"\n content:\n targetClusters:\n - clusterId: <CLUSTER-ID>\n  clusterUri: //container.googleapis.com/projects/<PROJECT-NUMBER>/locations/us-central1/clusters/c1\n apiDeprecationInsight:\n - api: /apis/networking.k8s.io/v1beta1/Ingress\n  stopServingVersion: 1.22\n  deprecatedClientStats:\n  userAgent: kubectl\n  numberOfRequestsLast30Days: 288\n  lastRequestTime: \"2022-02-30T08:00:18Z\"\n - api: /apis/rbac.authorization.k8s.io/v1beta1/ClusterRole\n  stopServingVersion: 1.22\n  deprecatedClientStats:\n  userAgent: kubectl\n  numberOfRequestsLast30Days: 126\n  lastRequestTime: \"2022-02-01T06:45:25Z\"\n```\nA deprecation recommendation includes a description of the deprecation with a link to the migration guide for the deprecation. You can also find these migration guides in the [GKE feature deprecations table](/kubernetes-engine/docs/deprecations#feature_deprecations) and [Kubernetes API deprecations table](/kubernetes-engine/docs/deprecations#kubernetes_api_deprecations) .\nThis is an example recommendation for the `DEPRECATION_K8S_1_22_V1BETA1_API` recommendation subtype:\n```\n name: projects/<PROJECT-NUMBER>/locations/us-central1/recommenders/google.container.DiagnosisRecommender/recommendations/<RECOMMENDATION-ID>\n description: Update manifests and API clients to use v1 API before upgrading to Kubernetes 1.22 by following the [instructions](https://cloud.google.com/kubernetes-engine/docs/deprecations/apis-1-22).\n primaryImpact:\n category: RELIABILITY\n reliabilityProjection:\n  risks:\n  - SERVICE_DISRUPTION\n priority: P2\n recommenderSubtype: DEPRECATION_K8S_1_22_V1BETA1_API\n stateInfo:\n state: ACTIVE\n targetResources:\n - //container.googleapis.com/projects/<PROJECT-NUMBER>/locations/us-central1/clusters/c1\n associatedInsights:\n - insight: projects/<PROJECT-NUMBER>/locations/us-central1/insightTypes/google.container.DiagnosisInsight/insights/<INSIGHT-ID>\n etag: '\"4dc0f7b33594072f\"'\n lastRefreshTime: \"2022-01-30T08:00:00Z\"\n content:\n overview:\n  targetClusters:\n  - clusterId: <CLUSTER-ID>\n   clusterUri: //container.googleapis.com/projects/<PROJECT-NUMBER>/locations/us-central1/clusters/c1\n  apiDeprecationRecommendation:\n  - api: /apis/networking.k8s.io/v1beta1/Ingress\n   apiReplacement: /apis/networking.k8s.io/v1/Ingress\n   stopServingVersion: 1.22\n  - api: /apis/rbac.authorization.k8s.io/v1beta1/ClusterRole\n   apiReplacement: /apis/rbac.authorization.k8s.io/v1/ClusterRole\n   stopServingVersion: 1.22\n```\n## Export insights and recommendations to BigQuery\nYou can use BigQuery to export and analyze insights and recommendations for your entire organization. To learn more, see [Export recommendations to BigQuery](/recommender/docs/bq-export/export-recommendations-to-bq) .\n## Dismiss or restore deprecation recommendations\nIf you don't want to see a deprecation recommendation for a cluster in the Google Cloud console anymore, dismiss it. You might do this, for example, to dismiss recommendations that apply to temporary, short-lived clusters.\nIf you dismiss the recommendation, it doesn't appear for any user viewing the cluster in the console. After you dismiss the recommendation, it doesn't appear again even if a user agent calls the deprecated API or feature in this [subtype](#use-of-features) after dismissal.\nHowever, the recommendation remains discoverable with the Google Cloud CLI and the Recommender API.\nWhen you dismiss a recommendation, you only hide it for all users. Automatic upgrades [remain paused](/kubernetes-engine/docs/deprecations#auto-upgrade-pause) until you migrate from the deprecated feature or API and GKE does not detect usage of the deprecated APIs for 30 consecutive days, or until the cluster's version reaches [end of life](/kubernetes-engine/versioning#lifecycle) . To learn more, see [When does GKE resume automatic upgrades?](/kubernetes-engine/docs/deprecations#auto-upgrades-resume) .\n### Dismiss a recommendation\nTo dismiss the recommendation, follow the instructions for [Viewing insights and recommendations](#view-insights-recs) in the Google Cloud console to open the sidebar panel, which has more details. In that panel, click the **Dismiss** button.\n### Restore a dismissed recommendation\nYou can restore a dismissed recommendation by following the instructions for [Restoring a recommendation](/recommender/docs/recommendation-hub/changing-applying-recommendations#restoring_a_recommendation) .\n## What's next\n- To learn more about how deprecations work with GKE, see [GKE deprecations](/kubernetes-engine/docs/deprecations) .\n- To learn more about the Recommender API, see [Using the API - Recommendations](/recommender/docs/using-api) .", "guide": "Google Kubernetes Engine (GKE)"}