{"title": "Compute Engine - Share sole-tenant node groups", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Share sole-tenant node groups\nShared sole-tenant node groups are similar to [local sole-tenant nodegroups](/compute/docs/nodes/sole-tenant-nodes#node_groups_and_vm_provisioning) . For example, shared node groups cost the same, consume the same quota, and reside under a parent project in the [resource hierarchy](/resource-manager/docs/cloud-platform-resource-hierarchy) .\nThe difference between shared node groups and local node groups is that other projects in your organization can provision virtual machine (VM) instances in the shared node groups.\nSharing a node group across multiple projects or an organization can help you do the following:\n- Consolidate node groups that you manage into a single project and then share those nodes with other projects or the entire organization\n- Decrease costs by deleting nodes after consolidating VMs from various projects into underutilized node groups\n- Manage sole-tenant nodes with a single team\n- Share sole-tenant nodes with smaller projects and retain security and access control boundaries between those projects\n- Perform a live migration between node groups within the same project\n- Improve the utilization of your node groups and reduce the number of reserved maintenance nodes when using the [Migrate within node group maintenance policy](/compute/docs/nodes/sole-tenant-nodes#migrate_within_node_group_host_maintenance_policy) \nThe following diagram shows a node group that is shared with other projects so that other departments that manage VMs in those projects can provision VMs in a shared node group.\n", "content": "## Utilization benefits of shared node groups\nThe following table compares projects that use local node groups with projects that use shared node groups. Notice that vCPU underutilization decreases in projects that use shared node groups.\n| Project configuration   | Local node groups | Shared node groups |\n|:------------------------------|:--------------------|:---------------------|\n| Projects      | 10     | 10     |\n| vCPU / project    | 24     | 24     |\n| Node groups     | 10     | 1     |\n| Nodes / node group   | 1     | 3     |\n| vCPU / node     | 80     | 80     |\n| Utilization / node group  | 24     | 80     |\n| Underutilization / node group | 56     | 0     |\n| Total underutilization  | 10 x 56 = 560 vCPUs | 1 x 0 = 0 vCPUs  |\n## Settings for sharing node groups\nCompute Engine uses the following settings for sharing node groups and provisioning VMs in the shared node groups:\n- A share setting that you configure when you create or update the sole-tenant node group. To specify whether to share the node group with other projects or with the entire organization, use the gcloud CLI settings ( `--share-setting` , `--share-with` ) or REST settings ( `shareSetting` , `shareWith` ).\n- A default `compute.googleapis.com/project` node affinity label that you use when you provision a VM in a shared node group by using node affinity labels. For information about the other default node affinity labels, see [Default affinity labels](/compute/docs/nodes/sole-tenant-nodes#default_affinity_labels) .## Maintenance policy considerations\nWhen a node group uses the [Migrate within node group maintenance policy](/compute/docs/nodes/sole-tenant-nodes#migrate_within_node_group_host_maintenance_policy) , Compute Engine reserves at least 1 node for live migration events, so the node group must have at least 2 nodes. You can't schedule VMs on the reserved node, so node groups with this maintenance policy often have lower overall utilization. This makes workloads that require the **Migrate within nodegroup** maintenance policy good candidates for node group sharing, as they often see the greatest benefit from improved utilization.\n## IAM roles and permissions\nKeep in mind the following information about IAM roles and permissions when you share a node group:\n- If a node group is shared with a project, any user that can create VMs in the listed projects or in the organization can provision VMs from those projects onto the shared node group without any changes to IAM roles or permissions.\n- The `compute.soleTenantViewer` IAM role lets you list and view node groups ( [gcloud CLI](/sdk/gcloud/reference/compute/sole-tenancy/node-groups/list-nodes) / [REST](/compute/docs/reference/rest/v1/nodeGroups/listNodes) ). You cannot modify node groups with this role. Any user with this role or with permissions to list node groups, regardless of the IAM permissions on the VM, can view the project ID, name, machine type, and information about local SSDs and GPUs for all VMs in the node group.## Limitations\n- **Compliance regime limitations:** - Regardless of the IAM permissions on the VM, any user with permissions to list node groups can view the project ID, name, and machine type for all VMs in the node group. Thus, due to risk of cross-project information disclosure, projects that have VMs provisioned in shared node groups should be under the same [compliance regime](/assured-workloads/docs/supported-products) .\n- **Google Cloud console limitations:** - If you don't have permission to view VMs on the shared node group, those VMs won't appear on the VM list on the **Sole-tenant nodes** page in the Google Cloud console.\n- After modifying the sharing settings on the **Sole-tenant node groups** page, the **Shared with** setting is not updated in the UI. To see the updated **Shared with** setting, go to the **Sole-tenant nodes** page.\n- After sharing a node group with all projects within an organization or with selected projects within an organization, you can only see the shared node group from its owning project; you can't see the shared node group from the projects it has been shared with. To provision a VM on the shared node group, from the project that the node group is shared with, go to the **VM\ninstances** page, and then modify the sole tenancy node affinity labels.\n- **Sharing limitations:** - You must update the sharing settings from the project that owns the node group.\n- You can specify a maximum of 100 projects when you use the`projects`share setting.\n- You cannot share node groups between organizations. For example, if you [migrate a project](/resource-manager/docs/project-migration) that contains a shared node group from one organization to another, you must also migrate all projects that have VMs running in that shared node group.\n- You cannot perform live migration between projects while using shared sole-tenant node groups. For more information, see [Manually live migrate VMs](/compute/docs/nodes/manually-live-migrate#manually_live_migrate_vms_into_or_within_sole-tenancy) .\n## Pricing\nVMs in shared node groups do not incur additional charges, and there are no additional charges for sharing node groups. For more information about sole-tenant node pricing, see [Sole-tenant node pricing](/compute/sole-tenant-pricing) .\n## Before you begin\n- Before creating a sole-tenant node group, [create a sole-tenant node template](/compute/docs/nodes/provisioning-sole-tenant-vms#create_a_sole-tenant_node_template) .\n- Before provisioning VMs in a sole-tenant node, [check your quota](/compute/quotas#checking_your_quota) . Depending on the number and size of nodes that you reserve, you might need to [request additional quota](/compute/quotas#requesting_additional_quota) .\n- If you haven't already, set up authentication. [Authentication](/compute/docs/authentication) is the process by which your identity is verified for access to Google Cloud services and APIs. To run code or samples from a local development environment, you can authenticate to Compute Engine as follows.Select the tab for how you plan to use the samples on this page:\nWhen you use the Google Cloud console to access Google Cloud services and   APIs, you don't need to set up authentication.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:```\ngcloud init\n``` **Note:** If you installed the gcloud CLI  previously, make sure you have the latest version by running`gcloud components  update`.\n- [ Set a default region and zone](/compute/docs/gcloud-compute#set_default_zone_and_region_in_your_local_client) .\nTo use the REST API samples on this page in a local development environment, you use the credentials you provide to the gcloud CLI.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:\n- ```\ngcloud init\n```## Create a new node group and share it\nTo create a new node group and share it with other projects or with the entire organization, use the Google Cloud console, gcloud CLI, or REST.- Create a sole-tenant node group. For more information, see [Create asole-tenant node group](/compute/docs/nodes/provisioning-sole-tenant-vms#create_a_sole-tenant_node_group) .\n- Configure the share settings by specifying one of the following in **Configure share settings** :- To share the node group with all projects in your organization, choose **Share this node group with all projects within the organization** .\n- To share the node group with specific projects within your organization, choose **Share this node group with selected projects\nwithin the organization** .\nIf you don't want to share the node group, choose **Do not share thisnode group with other projects** .\nTo create a shared node group, use the following [gcloud computesole-tenancy node-groups createcommand](/sdk/gcloud/reference/compute/sole-tenancy/node-groups/create) .\n```\ngcloud compute sole-tenancy node-groups create NODE_GROUP \\\n --zone=ZONE \\\n --node-template=NODE_TEMPLATE \\\n --target-size=SIZE \\\n --share-setting=SHARE_SETTING \\\n --share-with=PROJECTS\n```\nReplace the following:- `` : the name of the node group.\n- `` : the zone to create the node group in.\n- `` : the name of the previously created node template.\n- `` : the number of nodes in the node group.\n- `` : the share setting for the node group. Set to `projects` to share with specific projects, or set to `organization` to share with the entire organization.\n- `` : a list of project IDs or project numbers to share the node group with. Only required if you set `SHARE_SETTING` to `projects` .\nTo create a shared node group, use the following [nodeGroups.insertmethod](/compute/docs/reference/rest/v1/nodeGroups/insert) .\n```\nPOST https://compute.googleapis.com/compute/v1/projects/PROJECT/zones/ZONE/nodeGroups\n{\n ...\n \"name\": NODE_GROUP,\n \"nodeTemplate\": NODE_TEMPLATE,\n \"size\": SIZE,\n \"shareSettings\": {\n \"shareType\": SHARE_TYPE,\n \"projectMap\": {\n  string: {\n  \"projectId\": PROJECTS\n  },\n }\n }\n ...\n}\n```\nReplace the following:- `` : the name of project to create the node group in.\n- `` : the zone to create the node group in.\n- `` : the name of the node group.\n- `` : the name of the previously created node template.\n- `` : the number of nodes in the node group.\n- `` : the share setting for the node group. Set to `SPECIFIC_PROJECTS` to share with specific projects, or set to `ORGANIZATION` to share with the entire organization.\n- `` : a list of project IDs or project numbers to share the node group with. Only required if you set `SHARE_TYPE` to `SPECIFIC_PROJECTS` .## Provision a sole-tenant VM in a shared node group\nTo provision a sole-tenant VM in a shared node group, use the Google Cloud console, gcloud CLI, or REST.\n- In the Google Cloud console, switch to a project that you've shared a node group with.\n- Go to the **VM instances** page. [Go to VM instances](https://console.cloud.google.com/compute/instances) \n- Click **Create instance** .\n- In **Zone** , choose the zone of the shared node group.\n- In **Machine configuration** > **Series** , choose the same machine type that the shared sole-tenant node group template specifies.\n- Open **Advanced options** > **Sole-tenancy** > **Browse** .\n- Choose **Select project** and specify the project that contains the shared node group.\n- Choose the sole-tenant node group or a specific sole-tenant node in that group to provision the VM on.\n **Provision a VM in a shared node group by using the node group name** \nTo provision a sole-tenant VM in a shared node group by using the node group name, use the following [gcloud compute instances createcommand](/sdk/gcloud/reference/compute/instances/create) .\n```\ngcloud compute instances create VM_NAME \\\n --machine-type=MACHINE_TYPE \\\n --node-group=NODE_GROUP \\\n --node-project=NODE_PROJECT\n```\nReplace the following:- `` : the name of the new sole-tenant VM to create in a shared node group\n- `` : the machine type for the new sole-tenant VM\n- `` : the name of the shared node group to create the sole-tenant VM in\n- `` : the project containing the node group to provision the VM in\n **Provision a VM in a shared node group by using a node affinity file** \nTo provision a sole-tenant VM in a shared node group by using a node affinity file, use the following [gcloud compute instances createcommand](/sdk/gcloud/reference/compute/instances/create) .\n```\ngcloud compute instances create VM_NAME \\\n --machine-type=MACHINE_TYPE \\\n --node-affinity-file=NODE_AFFINITY_FILE\n```\nReplace the following:- `` : the name of the sole-tenant VM to create in a shared node group by using an affinity label.\n- `` : the machine type of the sole-tenant VM to create in a shared node group.\n- `` : the name of the `.json` file containing the node affinity information. In the node affinity file, set the affinity label key to `\"compute.googleapis.com/project\"` , the operator equal to `\"IN\"` , and the value equal to the project containing the node group. For more information about how to configure node affinity, see [Configure node affinity labels](/compute/docs/nodes/provisioning-sole-tenant-vms#configure_node_affinity_labels) .\nTo provision a sole-tenant VM in a shared node group by using a node affinity file, use the following [nodeGroups.insertmethod](/compute/docs/reference/rest/v1/nodeGroups/insert) .\n```\nPOST https://compute.googleapis.com/compute/v1/projects/PROJECT/zones/ZONE/instances\n{\n ...\n \"name\": VM_NAME,\n \"machineType\": MACHINE_TYPE,\n \"scheduling\": {\n ...\n \"nodeAffinities\": [  {\n  \"key\": KEY,\n  \"operator\": OPERATOR,\n  \"values\": [   VALUE\n  ]\n  }\n ],\n ...\n },\n ...\n}\n```\nReplace the following:- `` : the name of the project that owns the node group.\n- `` : the zone of the node group.\n- `` : the name of the sole-tenant VM to create in a shared node group by using an affinity label.\n- `` : the machine type of the sole-tenant VM to create in a shared node group.\n- `` : the affinity label. Set to `\"compute.googleapis.com/project\"` .\n- `` : the affinity label operator. Set to `\"IN\"` .\n- `` : the project containing the node group to provision the VM in. Specify one project by using either the project name or project ID.\nFor more information about how to configure node affinity, see [Configurenode affinity labels](/compute/docs/nodes/provisioning-sole-tenant-vms#configure_node_affinity_labels) .\n## View the sharing settings of a node group\nTo view the sharing settings of a node group, use the Google Cloud console, gcloud CLI, or REST.- In the Google Cloud console, go to the **Sole-tenant nodes** page. [Go to Sole-tenant nodes](https://console.cloud.google.com/compute/soleTenancy) \n- To view the properties of the node group, in the **Name** column, click the name of the node group.\nTo view the sharing settings of a node group, use the following [gcloudcompute sole-tenancy node-groups describecommand](/sdk/gcloud/reference/compute/sole-tenancy/node-groups/describe) .\n```\ngcloud compute sole-tenancy node-groups describe NODE_GROUP\n```\nReplace `` with the name of the node group to view the sharing settings of.\nTo view the sharing settings of a node group, use the following [nodeGroups.getmethod](/compute/docs/reference/rest/v1/nodeGroups/get) .\n```\nGET https://compute.googleapis.com/compute/v1/projects/PROJECT/zones/ZONE/nodeGroups\n```\nReplace the following:- `` : the name of project with the node group to view the sharing settings of\n- `` : the zone containing the node group to view the sharing settings of## Share an existing node group\nTo share an existing node group with other projects or the entire organization, use the Google Cloud console, gcloud CLI, or REST.- In the Google Cloud console, go to the **Sole-tenant nodes** page. [Go to Sole-tenant nodes](https://console.cloud.google.com/compute/soleTenancy) \n- In the **Name** column, click the name of the node group.\n- To share the node group with all projects within the organization or with selected projects within the organization, in **Overview** > **Shared with** , click **Edit** edit .\nTo update the sharing settings of a node group, use the following [gcloudcompute sole-tenancy node-groups updatecommand](/sdk/gcloud/reference/compute/sole-tenancy/node-groups/update) .\n```\ngcloud compute sole-tenancy node-groups update NODE_GROUP \\\n --zone=ZONE \\\n --share-setting=SHARE_SETTING \\\n --share-with=PROJECTS\n```\nReplace the following:- `` : the name of the node group to update the sharing settings of.\n- `` : the share setting for the node group. Set to `projects` to share with specific projects, or set to `organization` to share with the entire organization.\n- `` : a list of project IDs or project numbers to share the node group with. Only required if you set `SHARE_SETTING` to `projects` .\nTo update the sharing settings of a node group, use the following [nodeGroups.patchmethod](/compute/docs/reference/rest/v1/nodeGroups/patch) .\n```\nPATCH https://compute.googleapis.com/compute/v1/projects/PROJECT/zones/ZONE/nodeGroups/NODE_GROUP\n{\n \"shareSettings\": {\n \"shareType\": SHARE_TYPE,\n \"projectMap\": {\n  string: {\n  \"projectId\": PROJECTS\n  },\n }\n }\n}\n```\nReplace the following:- `` : the name of the project with the node groups to update the sharing settings of.\n- `` : the zone containing the node groups to update the sharing settings of.\n- `` : the name of the node group to update the sharing settings of.\n- `` : the share setting for the node group. Set to `projects` to share with specific projects, or set to `organization` to share with the entire organization.\n- `` : a list of project IDs or project numbers to share the node group with. Only required if you set `SHARE_SETTING` to `SPECIFIC_PROJECTS` .## Stop sharing a node group\nTo stop sharing a node group with other projects or the entire organization, use the gcloud CLI or REST.- In the Google Cloud console, go to the **Sole-tenant nodes** page. [Go to Sole-tenant nodes](https://console.cloud.google.com/compute/soleTenancy) \n- Click the **Name** of the node group.\n- In **Overview** > **Shared with** , click **Edit** edit .\n- To stop sharing, choose **Do not share this node group with otherprojects** .\nTo stop sharing a node group with other projects or the entire organization, use the following [gcloud compute sole-tenancy node-groups updatecommand](/sdk/gcloud/reference/compute/sole-tenancy/node-groups/update) .\n```\ngcloud compute sole-tenancy node-groups update NODE_GROUP \\\n --zone=ZONE \\\n --share-setting=local\n```\nReplace the `` with the name of the node group to stop sharing.\nTo stop sharing a node group with other projects or the entire organization, use the following [nodeGroups.patchmethod](/compute/docs/reference/rest/v1/nodeGroups/patch) .\n```\nPATCH https://compute.googleapis.com/compute/v1/projects/PROJECT/zones/ZONE/nodeGroups/NODE_GROUP\n{\n \"shareSettings\": {\n \"shareType\": LOCAL\n }\n}\n```\nReplace the following:- `` : the name of the project with the node group to stop sharing\n- `` : the zone containing the node group to stop sharing\n- `` : the name of the node group to stop sharing## Delete a shared node group from the owning project\nTo delete a shared node group from the owning project, use the Google Cloud console, gcloud CLI, or REST. Before deleting a node group, stop all VMs that are running in the node group.- In the Google Cloud console, go to the **Sole-tenant nodes** page. [Go to Sole-tenant nodes](https://console.cloud.google.com/compute/soleTenancy) \n- In the **Name** column, click the name of the node group.\n- Click **Delete** .\nTo delete a shared node group from the owning project, use the following [gcloud compute sole-tenancy node-groups deletecommand](/sdk/gcloud/reference/compute/sole-tenancy/node-groups/delete) .\n```\ngcloud compute sole-tenancy node-groups delete NODE_GROUP\n```\nReplace `` with the name of the node group to delete.\nTo delete a shared node group from the owning project, use the following [nodeGroups.deletemethod](/compute/docs/reference/rest/v1/nodeGroups/delete) .\n```\nDELETE https://compute.googleapis.com/compute/v1/projects/PROJECT/zones/ZONE/nodeGroups/NODE_GROUP\n```\nReplace the following:- `` : the name of the project with the node group to delete\n- `` : the zone containing the node group to delete\n- `` : the name of the node group to delete", "guide": "Compute Engine"}