{"title": "Cloud Architecture Center - Monitor cloud volumes", "url": "https://cloud.google.com/architecture/reference-patterns/overview", "abstract": "# Cloud Architecture Center - Monitor cloud volumes\nLast reviewed 2023-02-24 UTC\nVarious metrics for monitoring cloud volumes are available within [Cloud Monitoring](/monitoring/docs) . Categories include volume capacity/operations metrics, storage pool metrics, backup metrics, and replication metrics.\nYou can select and chart individual metrics in [Metrics Explorer](/monitoring/charts/metrics-explorer) , create a dashboard with multiple charts, add alerting, or retrieve metrics data with the Cloud Monitoring API.\nCloud Volumes Service metrics are under the resource type **Monitored Resourcefor NetApp CVS** . These metrics use the resource type prefix `cloudvolumesgcp-api.netapp.com/CloudVolume` .\nStorage pool metrics are under the resource type **Monitored Resource for NetAppCVS storage pool** . These metrics use the resource type prefix `cloudvolumesgcp-api.netapp.com/CloudVolumePool` .\nMetrics are sampled and pushed to Cloud Monitoring every 5 minutes. In Cloud Monitoring Metrics Explorer, select a metric and use a **Minimum alignment period** of 5 minutes for accurate results.\nEach volume resource also has labels that can be used to filter or group the volumes.\n", "content": "## Resource labels\n| Metric name | Description            | CVS | CVS-Performance |\n|:--------------|:--------------------------------------------------------|:------|:------------------|\n| location  | Region/zone information.        | \u2713  | \u2713     |\n| volume_id  | ID of the volume.          | \u2713  | \u2713     |\n| name   | Name of the volume or replication relationship.   | \u2713  | \u2713     |\n| service_type | Service type of the volume or replication relationship. | \u2713  | \u2713     |\n## Volume capacity/operations metrics\n| Metric name   | Description                                      | CVS | CVS-Performance |\n|:--------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------|:------|:------------------|\n| volume_usage  | Space utilized by the volume, in bytes; the actual size of the volume.                       | \u2713  | \u2713     |\n| volume_size   | Space allocated to the volume, in bytes; the provisioned size of the volume.                     | \u2713  | \u2713     |\n| volume_percent_used | Percentage of allocated space used by the volume.                            | \u2713  | \u2713     |\n| operation_count  | Number of operations per second being performed on the cloud volume by the end users.                   | \u2713  | \u2713     |\n| read_bytes_count | I/O bytes from read operations by the end user.                             | \u2713  | \u2713     |\n| write_bytes_count | I/O bytes from write operations by the end user.                            | \u2713  | \u2713     |\n| request_latencies | The volume's responsiveness for I/O operation requests in milliseconds. This is latency at the storage level. It doesn't include network latency to the client. | \u2713  | \u2713     |\n| inode_allocation | Number of file and directory inodes allocated for the volume (hard cap); based on the allocated capacity (size) of the volume.         | x  | \u2713     |\n| inode_usage   | Number of inodes in use on the volume.                               | x  | \u2713     |\n## Storage pool metrics\n| Metric name | Description              | CVS | CVS-Performance |\n|:--------------|:----------------------------------------------------------------|:------|:------------------|\n| usage   | Space used by all of the volumes in the storage pool, in bytes. | \u2713  | x     |\n| size   | Space allocated to the pool, in bytes.       | \u2713  | x     |\n## Backup metrics\n| Metric name    | Description             | CVS | CVS-Performance |\n|:------------------------|:------------------------------------------------------------|:------|:------------------|\n| logical_bytes_backed_up | Logical bytes backed up (baseline and incremental changes). | \u2713  | x     |\n## Replication metrics\n| Metric name      | Description                       | CVS | CVS-Performance |\n|:-----------------------------------|:-------------------------------------------------------------------------------------------------------|:------|:------------------|\n| replication_healthy    | Health of replication relationships: 1/TRUE for healthy and 0/FALSE for unhealthy.      | x  | \u2713     |\n| replication_lag_time    | Elapsed time since the exported snapshot copy (last complete transfer) was created on the destination. | x  | \u2713     |\n| replication_last_transfer_duration | Duration of the last transfer job.                  | x  | \u2713     |\n| replication_last_transfer_size  | Number of bytes transferred for the last data transfer job.           | x  | \u2713     |\n| replication_relationship_progress | Number of bytes transferred so far for the current data transfer job.         | x  | \u2713     |\n| replication_relationship_status | Status of replication: 1/TRUE for transferring, 0/FALSE for idle.          | x  | \u2713     |\n| replication_total_transfer_bytes | Cumulative number of bytes transferred for the relationship since it was created.      | x  | \u2713     |\n## Implement monitoring and alerting for out-of-space conditions\nCloud Volumes Service limits growth beyond the allocated size for volumes of the CVS-Performance service type.\nAn application or user that writes more data into the volume than allocated receives an out-of-space error, which can cause application problems.\nTo implement monitoring and alerting for out-of-space conditions, use [Cloud Monitoring alerting](/monitoring/alerts) .\nFollow the [instructions to set up an alert](/monitoring/alerts/using-alerting-ui) , using the following MQL condition:\n```\n fetch cloudvolumesgcp-api.netapp.com/CloudVolume\n | {\n  metric 'cloudvolumesgcp-api.netapp.com/cloudvolume/volume_usage'\n  | filter (metric.type == 'logical')\n  ;\n  metric 'cloudvolumesgcp-api.netapp.com/cloudvolume/volume_size'\n } | join | div\n | group_by sliding(5m), max(val())\n | condition val() > 0.8\n```\nThe last line of the condition checks against a threshold. In this example, the threshold is `0.8` , which corresponds to 80% of capacity used for the volumes.\n**Important:** If you use the snapshot copy reserve ( `snapReserve` ), then you must subtract the `snapReserve` setting from the threshold. For example, if your threshold is 80% ( `0.8` ) and your `snapReserve` setting is 20% ( `0.2` ), use a threshold of 60% ( `0.6` ) in the MQL condition. If you change the `snapReserve` setting (through the API or Terraform), then also change your threshold setting in the MQL condition.\nWhen a volume reaches usage beyond the threshold, you get an alert. To make sure that volumes don't fill more quickly than you can react, consider choosing the recommended threshold of 80% ( `0.8` ). If your environment is write-intensive, use a smaller threshold.\nIf you receive an alert, do one of the following:\n- Increase the volume size using the Google Cloud console or the API.\n- Change the volume size in your declaration when using a GitOps system, such as Terraform.\n- Automatically adjust volume size with the [GCP-CVS-CapacityManager script](https://github.com/NetApp-on-Google-Cloud/GCP-CVS-CapacityManager) .## What's next\n- [Create and manage volume snapshots](/architecture/partners/netapp-cloud-volumes/creating-volume-snapshots) \n- [Revert a volume using a snapshot](/architecture/partners/netapp-cloud-volumes/revert-volume-snapshot) \n- [Back up and restore a cloud volume](/architecture/partners/netapp-cloud-volumes/back-up) \n- [Security considerations](/architecture/partners/netapp-cloud-volumes/security-considerations) \n- [FAQs about NetApp Cloud Volumes Service for Google Cloud](/architecture/partners/netapp-cloud-volumes/faqs-netapp)", "guide": "Cloud Architecture Center"}