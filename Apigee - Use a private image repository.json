{"title": "Apigee - Use a private image repository", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - Use a private image repository\nYou are currently viewing version 1.8 of the Apigee hybrid documentation. **This version is end of life.** You should upgrade to a newer version. For more information, see [Supported versions](/apigee/docs/hybrid/supported-platforms#supported-versions) .\nThis document explains how to configure Apigee hybrid to use images from a private container image repository.\n", "content": "## \n Overview\nAll Apigee hybrid runtime images are hosted in the [ Google Cloud Container Registry](https://cloud.google.com/container-registry/) (GCR). If for any reason you wish to employ a private image container repository, you can download the images from GCR, push them to your private repository, and override the default image locations in your `overrides.yaml` file.\n## \n Configuration steps\nFollow these steps to use a private image container repository for the Apigee hybrid images. To perform these steps and successfully use the images in your private repository, you must be familiar with the [Apigee hybrid installation procedure](https://cloud.google.com/apigee/docs/hybrid/v1.8/install-before-begin) . In a typical scenario, you would plan to configure the private repository as part of a fresh hybrid installation.\n- Push the Apigee hybrid images from GCR to your private repository. We recommend that you use the [apigee-push-pull](/apigee/docs/hybrid/v1.8/apigee-pull-push) utility to accomplish this step.If you prefer to do this step manually, you need to have [Docker](https://docs.docker.com/get-started/) installed and use the `docker pull` command as follows. Be sure to append the correct tag to each image name. For example, the tag for `apigee-synchronizer` is `1.8.8` , as shown below. **Note:** You can get an up to date list of all images in your current project with the`--list`option of the [apigee-pull-push.sh utility](/apigee/docs/hybrid/v1.8/apigee-pull-push) in the`apigeectl/tools/`directory:```\napigee-pull-push.sh --list\n```Here are the images for the `apigee-system` and `apigee` namespaces: **Namespace: apigee-system** ```\ndocker pull gcr.io/apigee-release/hybrid/apigee-installer:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-kube-rbac-proxy:v0.11.0docker pull gcr.io/apigee-release/hybrid/apigee-operators:1.8.8\n``` **Namespace: apigee** ```\ndocker pull gcr.io/apigee-release/hybrid/apigee-cassandra-backup-utility:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-connect-agent:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-diagnostics-collector:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-envoy:v1.21.0docker pull gcr.io/apigee-release/hybrid/apigee-fluent-bit:1.9.9docker pull gcr.io/apigee-release/hybrid/apigee-hybrid-cassandra-client:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-hybrid-cassandra:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-mart-server:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-mint-task-scheduler:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-prom-prometheus:v2.33.5docker pull gcr.io/apigee-release/hybrid/apigee-prometheus-adapter:v0.9.1docker pull gcr.io/apigee-release/hybrid/apigee-redis:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-runtime:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-stackdriver-logging-agent:1.8.9docker pull gcr.io/apigee-release/hybrid/apigee-stackdriver-prometheus-sidecar:0.9.0docker pull gcr.io/apigee-release/hybrid/apigee-synchronizer:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-udca:1.8.8docker pull gcr.io/apigee-release/hybrid/apigee-watcher:1.8.8\n```After you pull and tag the images, you must push them to your private repository. See [docker push](https://docs.docker.com/engine/reference/commandline/push/) .\n- Create a Kubernetes Secret in the`apigee`and`apigee-system`namespaces.If these namespaces do not exist in your cluster, you must create them before performing this step.For steps to create the Secret, see [Create a Secret by providing credentials on the command line](https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#create-a-secret-by-providing-credentials-on-the-command-line) .  For example, to create a secret in the `apigee-system` namespace:```\nkubectl create secret docker-registry SECRET_NAME -n apigee-system \\\n --docker-server=YOUR_REGISTRY_SERVER \\\n --docker-username=YOUR_DOCKER_USERNAME \\\n --docker-email=YOUR_DOCKER_EMAIL \\\n --docker-password=\"YOUR_DOCKER_PASSWORD)\"\n```To create a Secret in the `apigee` namespace:```\nkubectl create secret docker-registry SECRET_NAME -n apigee \\\n --docker-server=YOUR_REGISTRY_SERVER \\\n --docker-username=YOUR_DOCKER_USERNAME \\\n --docker-email=YOUR_DOCKER_EMAIL \\\n --docker-password=\"YOUR_DOCKER_PASSWORD)\"\n```\n- Add the Secret to your`overrides.yaml`file. Creation of the overrides file  is described in the hybrid installation steps. See [Configure the cluster](https://cloud.google.com/apigee/docs/hybrid/v1.8/install-configure-cluster) for details.```\nimagePullSecrets:\n - name: SECRET_NAME\n```\n- Update your`overrides.yaml`file with image URLs for the images stored in your private repository. Each component that is stored in the repository has an`image:url`element. Use this element to specify the URL of each component image. For example:```\nmart:\n serviceAccountPath: /installdir/hybrid-files/service-accounts/hybrid-apigee-non-prod.json\n image:\n url: my-docker.pkg.dev/hybrid-1/registry-name/apigee-mart-server\n```Follow this pattern to update each top-level hybrid component in your `overrides.yaml` file with its  private repository image URL. A complete example overrides file is provided with your hybrid installation in ` **$APIGEECTL_HOME** ` `/examples/private-overrides.yaml` directory. **Note: ** You only need to update the`url`property. You can accept the default values for  the`tag`and`pullPolicy`properties. For a complete list of components and their configuration properties,  see also [Configuration property reference](https://cloud.google.com/apigee/docs/hybrid/v1.8/config-prop-ref) .\nYou can now complete a new hybrid installation using the private images, or update your existing installation. See the [Apigee hybrid installation steps](https://cloud.google.com/apigee/docs/hybrid/v1.8/install-before-begin) for more information.\n## \n Installing cert-manager from a private repository\nTo install `cert-manager` from your private repository, see [Installing with Helm](https://cert-manager.io/docs/installation/helm/) . It is important that you install the same version of `cert-manager` as specified in the [Apigee hybrid installation](https://cloud.google.com/apigee/docs/hybrid/v1.8/install-cert-manager) instructions to ensure compatibility.", "guide": "Apigee"}