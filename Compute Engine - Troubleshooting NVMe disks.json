{"title": "Compute Engine - Troubleshooting NVMe disks", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Troubleshooting NVMe disks\nThis document lists errors that you might encounter when using disks with the nonvolatile memory express (NVMe) interface.\nYou can use the NVMe interface for Local SSDs and persistent disks (Persistent Disk or Google Cloud Hyperdisk). Only the most recent machine series, such as Tau T2A, M3, C3, C3D, and H3 use the [NVMe](http://wikipedia.org/wiki/NVM_Express) interface for Persistent Disk. Confidential VMs also use NVMe for Persistent Disk. All other Compute Engine machine series use the [SCSI](http://wikipedia.org/wiki/SCSI) disk interface for persistent disks.\n", "content": "## I/O operation timeout error\nIf you are encountering I/O timeout errors, latency could be exceeding the default timeout parameter for I/O operations submitted to NVMe devices.\n**Error message** :\n```\n[1369407.045521] nvme nvme0: I/O 252 QID 2 timeout, aborting\n[1369407.050941] nvme nvme0: I/O 253 QID 2 timeout, aborting\n[1369407.056354] nvme nvme0: I/O 254 QID 2 timeout, aborting\n[1369407.061766] nvme nvme0: I/O 255 QID 2 timeout, aborting\n[1369407.067168] nvme nvme0: I/O 256 QID 2 timeout, aborting\n[1369407.072583] nvme nvme0: I/O 257 QID 2 timeout, aborting\n[1369407.077987] nvme nvme0: I/O 258 QID 2 timeout, aborting\n[1369407.083395] nvme nvme0: I/O 259 QID 2 timeout, aborting\n[1369407.088802] nvme nvme0: I/O 260 QID 2 timeout, aborting\n...\n```\n**Resolution** :\nTo resolve this issue, increase the value of the timeout parameter.\n**Note:** Most of the operating system images provided by Google already include this change.\n- View the current value of the timeout parameter.- Determine which NVMe controller is used by the persistent disk or Local SSD volume.```\nls -l /dev/disk/by-id\n```\n- Display the `io_timeout` setting, specified in seconds, for the disk.```\ncat /sys/class/nvme/CONTROLLER_ID/NAMESPACE/queue/io_timeout\n```Replace the following:- ``: the ID of the NVMe disk controller, for example,`nvme1`\n- ``: the namespace of the NVMe disk, for example,`nvme1n1`\nIf you only have a single disk that uses NVMe, then use the command:```\ncat /sys/class/nvme/nvme0/nvme0n1/queue/io_timeout\n```\n- To increase the timeout parameter for I/O operations submitted to NVMe devices, add the following line to the `/lib/udev/rules.d/65-gce-disk-naming.rules` file, and then restart the VM:```\nKERNEL==\"nvme*n*\", ENV{DEVTYPE}==\"disk\", ATTRS{model}==\"nvme_card-pd\", ATTR{queue/io_timeout}=\"4294967295\"\n```## Symlinks not created on C3 and C3D VMs with Local SSD\nIf you attach Local SSD disks to a C3 or C3D VM, you might need to take additional steps to create the symlinks for the Local SSD disks. These steps are required only if you use any of the following public images offered by Google Cloud:\n- SLES 15 SP4 and SP5\n- SLES 12 SP4\nThese additional steps only apply to Local SSD disks; you don't need to do anything for Persistent Disk volumes.\nThe public Linux images listed previously don't have the correct `udev` configuration to create symlinks for Local SSD devices attached to C3 and C3D VMs. Custom images also might not include the required `udev` rules needed to create symlinks for Local SSD devices attached to C3 and C3D VMs.\nUse these instructions to add `udev` rules for SUSE or custom images.\n- Locate the udev rules directory. This is usually`/lib/udev/rules.d`or`/usr/lib/udev/rules.d`. Your image might have a different`udev`rules directory.\n- Locate the`65-gce-disk-naming.rules`file in the udev rules directory.\n- If the `65-gce-disk-naming.rules` file contains the following line, your image supports the new rules and you can stop here:```\nKERNEL==\"nvme*n*\", ATTRS{model}==\"nvme_card[0-9]*\",IMPORT{program}=\"google_nvme_id -d $tempnode\"\n```\n- If the preceding line is not present, or if the file `65-gce-disk-naming.rules` doesn't exist, replace the existing file, or create a new file, with the file contents from this URL: [https://raw.githubusercontent.com/GoogleCloudPlatform/guest-configs/20230630.00/src/lib/udev/rules.d/65-gce-disk-naming.rules](https://raw.githubusercontent.com/GoogleCloudPlatform/guest-configs/20230630.00/src/lib/udev/rules.d/65-gce-disk-naming.rules) . This file contains the updated contents of the `65-gce-disk-naming.rules` file, including the line from the previous step and other rules required for Compute Engine disk naming. For example:```\nsudo curl -o 65-gce-disk-naming.rules https://raw.githubusercontent.com/GoogleCloudPlatform/guest-configs/20230630.00/src/lib/udev/rules.d/65-gce-disk-naming.rules\n```\n- Go to the `udev` directory.\n- Locate the `google_nvme_id` file in the `udev` directory.\n- Replace the contents of the existing `google_nvme_id` file, or create a new file, with the contents at this URL:```\nsudo curl -o google_nvme_id https://raw.githubusercontent.com/GoogleCloudPlatform/guest-configs/20230630.00/src/lib/udev/google_nvme_id\n```\n- Ensure the `google_nvme_id` file is executable.```\nsudo chmod 755 google_nvme_id\n```\n- Reboot the VM.\n- Verify that the symlinks are created successfully.```\nls -l /dev/disk/by-id/google-local-nvme-ssd*\n```The output should list the same number of links as there are Local SSDs attached to the instance, and each link should point to a different `/dev/nvme` device path. For example:```\nlrwxrwxrwx 1 root root 13 Jul 19 22:52 /dev/disk/by-id/google-local-nvme-ssd-0 -> ../../nvme0n1lrwxrwxrwx 1 root root 13 Jul 19 22:52 /dev/disk/by-id/google-local-nvme-ssd-1 -> ../../nvme1n1\n```For more information about device names, see [Device naming](/compute/docs/disks/local-ssd#device_names) .You can verify that the `/dev/nvme` device paths are Local SSD devices by running `lsblk` . NVMe devices that show `375G` in size are Local SSD devices.## What's next?\n- Learn about [Persistent Disk](/compute/docs/disks/persistent-disks) .\n- Learn about [Local SSDs](/compute/docs/disks/local-ssd) .\n- [Configure disks to meet performance requirements](/compute/docs/disks/performance) .\n- Learn about [symlinks](/compute/docs/disks/disk-symlinks) .", "guide": "Compute Engine"}