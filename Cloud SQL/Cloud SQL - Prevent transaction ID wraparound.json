{"title": "Cloud SQL - Prevent transaction ID wraparound", "url": "https://cloud.google.com/sql/docs/postgres/recommender-high-transactionid-utilization", "abstract": "# Cloud SQL - Prevent transaction ID wraparound\n**    Preview     ** This feature is subject to the \"Pre-GA Offerings Terms\" in the General Service Terms section   of the [Service Specific Terms](/terms/service-terms#1) .     Pre-GA features are available \"as is\" and might have limited support.    For more information, see the [launch stage descriptions](/products#product-launch-stages) .\nThe Cloud SQL high-transaction-ID-utilization [recommender](/recommender/docs/overview) proactively generates recommendations that help you avoid potential transaction ID wraparound for Cloud SQL PostgreSQL instances.\nYou can apply this recommendation when a Cloud SQL instance is trending toward a transaction ID wraparound problem. This page describes how the Cloud SQL high-transaction-ID-utilization recommender works and how you can use it.\n", "content": "## How it works\nA transaction ID is assigned when the transaction starts, and it's frozen until the transaction is vacuumed. Transaction ID utilization is the number of unvacuumed transactions (assigned minus frozen) expressed as a fraction of the maximum value of 2 billion. Under the default PostgreSQL settings, with vacuum processes performing optimally and without interruption, most databases experience transaction ID utilization in the region of approximately 10%. Higher transaction ID utilization levels can be observed in busy databases where regular workloads frequently take precedence over vacuum. If the transaction ID utilization trends towards very high values (80% or more), the database might be at risk of transaction ID exhaustion. Transaction ID utilization reaching 100% is termed as transaction ID wraparound. Once the transaction ID utilization percentage reaches 100%, PostgreSQL stops accepting write queries.\nThe Cloud SQL high-transaction-ID-utilization recommender analyzes transaction ID utilization on a Cloud SQL PostgreSQL instance.\nIf the transaction ID utilization percentage is more than or equal to 80%, it's recommended to take actions to avoid transanction ID wraparound.\n**Note:** Recommendations are generated daily.\n## Pricing\nThe Cloud SQL high-transaction-ID-utilization recommender is in the  [Recommender pricing tier](/recommender/pricing) .\n## Before you begin\nBefore you can view recommendations and insights, do the following:\n- To get the permissions to view and work with insights and recommendations, ensure that you have the required [roles](/sql/docs/postgres/project-access-control#roles) .| Tasks     | Roles                    |\n|:----------------------|:------------------------------------------------------------------------------------|\n| View recommendations | One of these roles: recommender.cloudsqlViewer or cloudsql.viewer.     |\n| Apply recommendations | One of these roles: recommender.cloudsqlAdmin, cloudsql.editor, or cloudsql.admin. |For more information about roles, see [understanding roles](/iam/docs/understanding-roles) and [granting IAM permissions](/iam/docs/granting-changing-revoking-access) .\n- Enable the Recommender API. [Enable the API](https://console.cloud.google.com/flows/enableapi?apiid=recommender.googleapis.com) \n## List Improve Instance Performance recommendations\nYou can list the Improve Instance Performance recommendations by using the Google Cloud console, ` [gcloud CLI](/sdk/gcloud) ` , or the Recommender API.\nThe improve instance performance recommendations are shown only if you have instances that are nearing a transaction ID wraparound.\nTo list recommendations about instance performance by using the Google Cloud console, follow these steps:- Go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql/instances) \n- Click **View all** on the Prevent transaction ID wraparound recommendations banner.\nAlternatively, follow these steps:- Go to the **Recommendation Hub** . See also [Getting started with Recommendation Hub](/recommender/docs/recommendation-hub/identify-configuration-problems) . [Go to the Recommendation Hub](https://console.cloud.google.com/home/recommendations/) \n- In the **Improve Cloud SQL Instance Performance** card, click **View all** .\n- Select the instances with **Prevent transaction ID wraparound** recommendation.\nTo list Improve Instance Performance recommendations by using `gcloud CLI` , run the [gcloud recommender recommendations list](/sdk/gcloud/reference/recommender/recommendations/list) command as follows:\n```\ngcloud recommender recommendations list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--recommender=google.cloudsql.instance.PerformanceRecommender \\\n--filter=recommenderSubtype=POSTGRES_HIGH_TRANSACTION_ID_UTILIZATION_BEST_PRACTICE\n```\nReplace the following:- ``: Your project ID\n- ``: A region, such as`us-central1`\nTo list Improve Instance Performance recommendations by using the [Recommendations API](/recommender/docs/using-api) , call the [recommendations.list](/recommender/docs/reference/rest/v1beta1/projects.locations.recommenders.recommendations/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/recommenders/google.cloudsql.instance.PerformanceRecommender.PostgresHighTransactionIdUtilizationBestPractice/recommendations\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\nIf the recommender detects instances with high transaction ID utilization, it lists them in a table with other performance recommendations. Each row shows the instance ID, a brief recommendation, database engine, the location, and the last refresh date.\n## View insights and detailed recommendations\nYou can view insights and detailed recommendations about instances that are trending toward a transaction ID wraparound by using the Google Cloud console, `gcloud CLI` , or the Recommender API.\nTo view insights and detailed recommendations about instances that are close to the performance threshold by using the Google Cloud console, click the recommendation link in the list of instances.\nTo view insights and detailed recommendations about instances that are close to the performance threshold by using `gcloud CLI` , run the [gcloud recommender insights list](/sdk/gcloud/reference/recommender/insights/list) command as follows:\n```\ngcloud recommender insights list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--insight-type=google.cloudsql.instance.PerformanceInsight \\\n--filter=insightSubtype=POSTGRES_HIGH_TRANSACTION_ID_UTILIZATION\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\nTo view insights and detailed recommendations about instances that are close to the performance threahold by using the [Recommendations API](/recommender/docs/using-api) , call the [insights.list](/recommender/docs/reference/rest/v1beta1/projects.locations.insightTypes.insights/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/insightTypes/google.cloudsql.instance.PerformanceRecommender.PostgresHighTransactionIdUtilization/insights\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\nThe following table lists the insight and recommendation that the Cloud SQL high-transaction-ID-utilization recommender generates. The subtypes are visible in the `gcloud CLI` and API results.\n| Insight                                | Recommendation                              |\n|:------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------|\n| Transaction ID utilization percentage on this instance is high and close to 100%. Subtype: POSTGRES_HIGH_TRANSACTION_ID_UTILIZATION | Avoid potential transaction ID wraparound for Cloud SQL instances.. Subtype: POSTGRES_HIGH_TRANSACTION_ID_UTILIZATION_BEST_PRACTICE |\n## Apply recommendations\nEvaluate the recommendations carefully and do any of the following:\n- To examine the recommendation, click **View instance** . See [Optimize the performance of your instance](#optimize-performance) and follow the recommendations.\n- To dismiss the recommendation so that it's de-emphasized and appears dimmed, click **Dismiss** .\n- To close the panel without applying or dismissing the recommendation, click **Cancel** .\n### Optimize the performance of your instance\nTo address the transaction ID wraparound problem with the instance, do the following:\n- [Find the database and table causing the wraparound.](/sql/docs/postgres/txid-wraparound#find_the_database_and_table_causing_the_wraparound) \n- [Explore and interpret transaction ID utilization metrics on your database instances.](https://cloud.google.com/blog/products/databases/monitor-transaction-id-utilization-in-cloud-sql-postgresql) \n- [Check for a stuck transaction ID.](/sql/docs/postgres/txid-wraparound#check_for_a_stuck_transaction_id) \n- [Remove VACUUM blockers.](/sql/docs/postgres/txid-wraparound#how-to-remove) \n- [Check and accelerate VACUUM speed.](/sql/docs/postgres/txid-wraparound#tuning-vacuum-detailed) \nFor additional information, also see the blog post [Using VACUUM to accelerate transaction ID freezing in Cloud SQL for PostgreSQL](https://cloud.google.com/blog/products/databases/how-to-accelerate-transaction-id-freezing-in-cloud-sql-for-postgresql) .\n## What's next\n- [Monitor disk availability](/sql/docs/postgres/using-ood-recommender) \n- [Identify idle Cloud SQL instances](/sql/docs/postgres/recommender-sql-idle) \n- [Reduce overprovisioned Cloud SQL instances](/sql/docs/postgres/recommender-sql-overprovisioned) \n- Explore [Google Cloud recommenders](/recommender/docs/recommenders)", "guide": "Cloud SQL"}