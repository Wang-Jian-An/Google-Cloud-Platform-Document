{"title": "Cloud SQL - Identify idle Cloud SQL instances", "url": "https://cloud.google.com/sql/docs/postgres/recommender-sql-idle", "abstract": "# Cloud SQL - Identify idle Cloud SQL instances\nThe Cloud SQL idle instance [recommender](/recommender/docs/overview) helps you detect instances that might be idle and provides you insights and recommendations to help you reduce costs. This page describes how this recommender works and how to use it.\n", "content": "## How it works\nThe Cloud SQL idle instance recommender analyzes the usage metrics of primary instances that are older than 30 days. For each instance, the recommender considers the values of certain [metrics](/monitoring/api/metrics_gcp#gcp-cloudsql) within an observation period spanning the last 30 days. The recommender does not analyze read replicas.\nIf the activity level within the observation period is below a certain threshold, the recommender estimates that the instance is idle. Recommendations are generated every 24 hours for shutting down such instances.\n**Warning:** It's highly recommended that you evaluate the insights and in-context charts. Consult with the appropriate team to determine whether the flagged instance is inadvertently idle and can be deleted.\n## Pricing\nThe Cloud SQL idle instance recommender is in the  [Recommender pricing tier](/recommender/pricing) .\n## Before you begin\nBefore you can view recommendations and insights, do the following:\n- To get the permissions to view and work with insights and recommendations, ensure that you have the required [roles](/sql/docs/postgres/project-access-control#roles) .| Tasks     | Roles                    |\n|:----------------------|:------------------------------------------------------------------------------------|\n| View recommendations | One of these roles: recommender.cloudsqlViewer or cloudsql.viewer.     |\n| Apply recommendations | One of these roles: recommender.cloudsqlAdmin, cloudsql.editor, or cloudsql.admin. |For more information about roles, see [understanding roles](/iam/docs/understanding-roles) and [granting IAM permissions](/iam/docs/granting-changing-revoking-access) .\n- Enable the Recommender API. [Enable the API](https://console.cloud.google.com/flows/enableapi?apiid=recommender.googleapis.com) \n## List idle Cloud SQL instance recommendations\nYou can list idle instance recommendations by using the Google Cloud console, `gcloud` , or the Recommender API.\nTo list recommendations about idle instances by using the Google Cloud console, follow these steps:- Go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql/instances) \n- Click **View all** on the idle instance recommendations banner.\nAlternatively, follow these steps:- Go to the **Recommendation Hub** . [Go to the Recommendation Hub](https://console.cloud.google.com/home/recommendations/) For more information, see [Getting started with Recommendation Hub](/recommender/docs/recommendation-hub/identify-configuration-problems) .\n- In the **Reduce Cloud SQL instance cost** card, click **View all** .\n- Click the **Shut down instance** tab.\nTo list recommendations about idle instances by using `gcloud` , run the [gcloud recommender recommendations list](/sdk/gcloud/reference/recommender/recommendations/list) command as follows:\n```\ngcloud recommender recommendations list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--recommender=google.cloudsql.instance.RECOMMENDER\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the recommender as`IdleRecommender`.\nTo list recommendations about idle instances by using the [Recommendations API](/recommender/docs/using-api) , call the [recommendations.list](/recommender/docs/reference/rest/v1beta1/projects.locations.recommenders.recommendations/list) method as follows.\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/recommenders/google.cloudsql.instance.RECOMMENDER/recommendations\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the recommender as`IdleRecommender`.\nIf the recommender detects idle instances, it lists them in a table. Each row shows the instance name, a brief recommendation, the location, and the last refresh date.\n## View insights and detailed recommendations\nYou can view insights and detailed recommendations about idle instances by using the Google Cloud console, `gcloud` , or the Recommender API.\nTo view insights about an idle instance by using the Google Cloud console, click the recommendation button in the list of instances.\nTo view insights and detailed recommendations about idle instances by using `gcloud` , run the [gcloud recommender insights list](/sdk/gcloud/reference/recommender/insights/list) command as follows:\n```\ngcloud recommender insights list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--insight-type=google.cloudsql.instance.INSIGHT_TYPE\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the insight type as`ActivityInsight`.\nTo view insights and detailed recommendations about idle instances by using the [Recommendations API](/recommender/docs/using-api) , call the [insights.list](/recommender/docs/reference/rest/v1beta1/projects.locations.insightTypes.insights/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/insightTypes/google.cloudsql.instance.INSIGHT_TYPE/insights\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the insight type as`ActivityInsight`.\nA panel appears showing insights about the idle instance. The following categories of information are provided along with some supporting charts.\n| Fields       | Descriptions and related metrics               |\n|:--------------------------------|:-------------------------------------------------------------------------------------------|\n| Disk usage (bytes change)  | Data utilization in bytes. Sampled every 60 seconds. Pertains to database/disk/bytes_used. |\n| Max CPU utilization    | The maximum CPU utilization as a percentage. Pertains to database/cpu/utilization.   |\n| Max memory utilization   | The maximum memory utilization as a percentage. Pertains to database/memory/utilization. |\n| Max disk read ops count   | The maximum number of read operations. Pertains to database/disk/read_ops_count.   |\n| Max disk write ops count  | The maximum number of write operations. Pertains to database/disk/write_ops_count.   |\n| Observation start and end dates | The start and end dates of the 30-day observation period.         |\nThe following table lists the insight and recommendation that the Cloud SQL idle instance recommender might generate to help you reduce costs. The subtypes are visible in the `gcloud` and API results.\n| Insight                        | Recommendation                      |\n|:----------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------|\n| The instance has shown low levels of activity during the observation period. Subtype: LOW_ACTIVITY | Investigate to check if the instance can be shut down to reduce costs. Subtype: SHUTDOWN_INSTANCE |\n## Apply recommendations\nEvaluate the recommendations carefully and do any of the following:\n- To examine the recommendation, click **View instance** .A banner appears at the top of the page providing a recommendation.You might find that the instance is intentionally idle and you don't need to shut it down. If it's inadvertently idle, you can [stop](/sql/docs/postgres/start-stop-restart-instance#stop) and [delete](/sql/docs/postgres/delete-instance) the instance. Stopping an instance suspends instance charges. The instance data is unaffected, and charges for storage and IP addresses continue to apply.Exercise caution when [stopping](/sql/docs/postgres/start-stop-restart-instance#stop) or [deleting](/sql/docs/postgres/delete-instance) an instance. To avoid the loss of data, [create a backup](/sql/docs/postgres/backup-recovery/backing-up#on-demand) first.\n- To dismiss the recommendation so that it's de-emphasized and appears dimmed, click **Dismiss** .\n- To close the panel without applying or dismissing the recommendation, click **Cancel** .\nYou can also [export these recommendations to BigQuery](/recommender/docs/bq-export/export-recommendations-to-bq) and examine them by using [Looker Studio](/bigquery/docs/visualize-looker-studio) or [Looker](/bigquery/docs/looker) .\n## What's next\n- [Monitor disk availability](/sql/docs/postgres/using-ood-recommender) \n- [Reduce overprovisioned Cloud SQL instances](/sql/docs/postgres/recommender-sql-overprovisioned) \n- [Blog: Maximize your Cloud ROI](https://cloud.google.com/blog/products/management-tools/active-assist-comes-to-google-cloud) \n- [Blog: Do more with less](https://cloud.google.com/blog/products/databases/reduce-cloud-sql-costs-with-optimizations-by-active-assist) \n- [Google Cloud recommenders](/recommender/docs/recommenders)", "guide": "Cloud SQL"}