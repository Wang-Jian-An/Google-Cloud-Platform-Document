{"title": "Cloud SQL - View audit logs for automated backups", "url": "https://cloud.google.com/sql/docs/postgres/backup-recovery/view-audit-logs-for-automated-backups", "abstract": "# Cloud SQL - View audit logs for automated backups\nThis page describes how to view an audit log for an automated backup of your Cloud SQL instance.\nYou can use audit logs to do the following:\n- View an audit log to verify whether the backup is completed successfully.\n- Configure a log-based alert to notify you of the backup's status.", "content": "## View an audit log\nYou can use the Google Cloud console, ` [gcloud CLI](/sdk/gcloud) ` , or  API to view an audit log to verify whether a backup is completed successfully within a backup window.\n- In the Google Cloud console, select **Logging** and then select **Logs Explorer** . [Go to Logs Explorer](https://console.cloud.google.com/logs/query) \n- To filter for audit logs for automated backups of Cloud SQL instances, run the following query:```\nlogName=\"projects/PROJECT_ID/logs/cloudaudit.googleapis.com%2Fsystem_event\"protoPayload.methodName=\"cloudsql.instances.automatedBackup\"resource.type=\"cloudsql_database\"\n```Replace with your Google Cloud project's ID.The first expression filters for [System Event audit logs](/logging/docs/audit#system-event) . The second expression filters for audit logs for automated backups. The final expression filters for audit logs for Cloud SQL instances.For more information about how to use the Google Cloud console to query for audit logs, see [View logs](/sql/docs/postgres/audit-logging#viewing_logs) .\n- View the status of a backup created during the backup window. This status is displayed in the `windowStatus` field. To view this field, complete the following steps:- Click the audit log.\n- Click the`metadata`field.- To filter for audit logs for automated backups of Cloud SQL instances, run the following query:```\ngcloud logging read \\\"logName=projects/PROJECT_NAME/logs/cloudaudit.googleapis.com%2Fsystem_eventAND protoPayload.methodName=cloudsql.instances.automatedBackup ANDresource.type=cloudsql_database\" \\ \u00a0 \u00a0 --project=PROJECT_NAME\n```Replace with your Google Cloud project's name.The first expression filters for [System Event audit logs](/logging/docs/audit#system-event) . The second expression filters for audit logs for automated backups. The final expression filters for audit logs for Cloud SQL instances.For more information about how to use `gcloud` to query for audit logs, see [View logs](/sql/docs/postgres/audit-logging#viewing_logs) .\n- View the status of a backup created during the backup window. This status is displayed in the `windowStatus` field.\nBefore using any of the request data, make the following replacements:- : The ID of your Google Cloud project.\nFor the request JSON body, the first expression filters for [ System Event audit logs](/logging/docs/audit#system-event) . The second expression filters for audit logs for automated backups. The final expression filters for audit logs for Cloud SQL instances.\nFor more information about how to use the API to query for audit logs, see [View logs](/sql/docs/postgres/audit-logging#viewing_logs) .\nHTTP method and URL:\n```\nPOST https://logging.googleapis.com/v2/entries:list\n```\nRequest JSON body:\n```\n{\n  \"resourceNames\": [  \"projects/PROJECT_ID\"\n  ],\n  \"pageSize\": 5,\n  \"filter\": \"logName=projects/PROJECT_ID/logs/cloudaudit.googleapis.com%2Fsystem_event AND protoPayload.methodName = cloudsql.instances.automatedBackup AND resource.type=cloudsql_database\",\n  \"orderBy\": \"timestamp desc\"\n} \n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:For more information about for the `insertId` field, see [LogEntry](/logging/docs/reference/v2/rest/v2/LogEntry) .\nView the status of a backup created during the backup window. This status is displayed in the `windowStatus` field.\n### Automated backup statuses\n- `STATUS_SUCCEEDED`: The automated backup is completed successfully.\n- `STATUS_ATTEMPT_FAILED` : Cloud SQL tried to create the backup, but the backup either didn't start or it failed. Reasons for this status include:- Another backup is running on the instance.\n- The backup location is restricted by your organization policy.\n- The backup of the instance completed, but an error occurred.\n- The instance wasn't running when Cloud SQL tried to create the backup.\n- `STATUS_FAILED` : The automated backup of the instance either hasn't completed successfully or can't be completed within the backup window.For example, if you enabled automated backups and scheduled the backup window for between 1:00 am and 5:00 am, your backup might fail if you have many `EXPORT` operations during this time frame. Automated backups might also fail if there are too many conflicts with an `EXPORT` operation that runs for a long time.If Cloud SQL tries to create a backup multiple times during a backup window, but the backup can't be created for the reasons listed for `STATUS_ATTEMPT_FAILED` , Cloud SQL generates another audit log with the `windowStatus` field set to `STATUS_FAILED` .\n- `STATUS_SKIPPED` : The Cloud SQL instance [stopped running](/sql/docs/postgres/start-stop-restart-instance) since the last successful backup. Therefore, a new automated backup wasn't created.## Configure a log-based alert\nYou can [configure a log-based alert](/logging/docs/alerting/log-based-alerts) to notify you of the backup's status.\n- If a backup has a`STATUS_SUCCEEDED`status, you can be notified for tracking purposes.\n- If a backup has the`STATUS_FAILED`or`STATUS_ATTEMPT_FAILED`status, you can be notified to take corrective action, based on the message that appears in the log entry. You can also take an [on-demand backup](/sql/docs/postgres/backup-recovery/backing-up) before the next scheduled backup window.\n- If a backup has a`STATUS_SKIPPED`status, you can be notified to restart the Cloud SQL instance.## What's next\n- [Learn more about backing up your data](/sql/docs/postgres/backup-recovery/backups) .\n- [Learn more about creating and managing backups](/sql/docs/postgres/backup-recovery/backing-up) .\n- [Learn more about restoring data](/sql/docs/postgres/backup-recovery/restore) .\n- [See how to restore your data from a backup](/sql/docs/postgres/backup-recovery/restoring#restorebackups) .\n- [See how to perform a point-in-time recovery](/sql/docs/postgres/backup-recovery/restore#tips-pitr) .", "guide": "Cloud SQL"}