{"title": "Cloud SQL - Prevent deletion of an instance", "url": "https://cloud.google.com/sql/docs/postgres/deletion-protection", "abstract": "# Cloud SQL - Prevent deletion of an instance\nThis page describes how to protect Cloud SQL instances from accidental deletion.\n", "content": "## Overview\nInstance deletion protection enables you to prevent the accidental removal of existing and new instances. Using instance deletion protection, you can safeguard instances that are important to your applications and services.\nYou can set the deletion protection option when you create an instance. Additionally, you can set this option on an existing instance. In both cases, deletion is prevented at the instance level. By default, the deletion protection option is disabled unless you use the Google Cloud console or Terraform to create an instance.\nWhen you clone an instance, the new instance receives the deletion protection option (enabled or disabled) from the source instance.\n## Planning for deletion protection\nIf you are planning to create an instance, decide whether you want to protect the new instance from accidental deletion. For example, a critical instance should be protected in this way.\nAlso consider whether there are existing instances you want to protect from accidental deletion. If you have multiple instances to protect, set the option on each instance.\n### Considering deletion protection for read replicas\nWhen you create a read replica, that read replica doesn't get a deletion protection setting from the primary instance; this setting remains independent. However, you can enable deletion protection on a new or existing read replica.\nFor Cloud SQL read replicas, the deletion protection option works the same way as it does for Cloud SQL instances.\n### Confirming the necessary permissions or roles\nTo set the deletion protection option, the Cloud SQL instance's service account must have certain [permissions or IAM roles](/sql/docs/postgres/roles-and-permissions) .\nAs in the case of related operations, the deletion protection option requires the `cloudsql.instances.create` permission or the `cloudsql.admin` role. Thus, when you create an instance, no extra permissions are needed to enable deletion protection.\nAs in the case of related operations, deletion protection changes require the `cloudsql.instances.update` permission or the `cloudsql.editor` role. Thus, when you edit an instance for deletion protection, no extra permissions are needed.\n### Planning for instance deletion\nIf you are planning to delete an instance, first do the following:\n- Confirm that it is safe to delete the instance\n- Confirm that deletion protection is disabled; if necessary, edit the instance to disable deletion protection\n### Limitations of deletion protection\nDeletion protection on an instance does not prevent:\n- Stopping the instance\n- Restarting the instance\n- Editing the instance\n- Deleting a backup\n- Suspending the instance due to billing issues\n- Deleting the suspended instance due to billing issues\n- Deleting the instance due to a project deletion## Setting deletion protection on a new instance\nThe following are the ways to set the deletion protection option. By default, the deletion protection option is disabled unless you use the Google Cloud console or Terraform to create an instance.\nIf deletion protection is enabled, an attempt to delete the instance fails.\n- Follow the steps to begin [ creating an Instance](/sql/docs/postgres/create-instance#create-2nd-gen) .\n- Under **Customize your instance** , click the **Show configuration options** drop down arrow.\n- Under **Data protection** , confirm that the **Enable deletion protection** checkbox is checked.\n- As needed for your instance, select other [configuration options](/sql/docs/postgres/instance-settings) .\n- Click **Create Instance** .\nTo set deletion protection during instance creation, use a command similar to the following:\n```\ngcloud sql instances create [INSTANCE_NAME] \\\u00a0 \u00a0 --deletion-protection\n```To set deletion protection during instance creation, specify `true` in the `deletionProtection` field.\nBefore using any of the request data, make the following replacements:- : Your project ID\n- : Desired instance ID\n- : The database version\n- : desired region\n- : desired machine type\nHTTP method and URL:\n```\nPOST https://sqladmin.googleapis.com/v1/projects/project-id/instances\n```\nRequest JSON body:\n```\n{\n \"name\": \"instance-id\",\n \"region\": \"region\",\n \"databaseVersion\": \"database-version\",\n \"settings\": {\n \"tier\": \"machine-type\",\n \"deletionProtectionEnabled\": true\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2022-05-24T15:34:10.929Z\",\n \"operationType\": \"CREATE\",\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\nTo set deletion protection during instance creation, specify `true` in the `deletionProtection` field.\nBefore using any of the request data, make the following replacements:- : Your project ID\n- : Desired instance ID\n- : The database version\n- : desired region\n- : desired machine type\nHTTP method and URL:\n```\nPOST https://sqladmin.googleapis.com/v1beta4/projects/project-id/instances\n```\nRequest JSON body:\n```\n{\n \"name\": \"instance-id\",\n \"region\": \"region\",\n \"databaseVersion\": \"database-version\",\n \"settings\": {\n \"tier\": \"machine-type\",\n \"deletionProtectionEnabled\": true\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2022-05-26T15:37:10.929Z\",\n \"operationType\": \"CREATE\",\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n[underlying REST API request](/sql/docs/postgres/admin-api/rest/v1beta4/instances/insert)\n[APIs Explorer on the instances:insert page](/sql/docs/postgres/admin-api/rest/v1beta4/instances/insert)\n## Setting or removing deletion protection on an existing instance\nThe following are the ways to edit an instance for deletion protection. If you enable the option, a subsequent attempt to delete the instance fails.\n- Follow the steps to begin [ editing an Instance](/sql/docs/postgres/edit-instance#edit_an_instance) .\n- After you click **Edit** , find the **Customize your instance** section.\n- Under **Data protection** , check or uncheck the **Enable deletion protection** checkbox.\n- As needed for your instance, edit other [configuration options](/sql/docs/postgres/instance-settings) .\n- Click **Save** .\nTo enable deletion protection when you update an instance, use a command similar to the following:\n```\ngcloud sql instances patch [INSTANCE_NAME] \\\u00a0 \u00a0 --deletion-protection\n```\nTo disable deletion protection when you update an instance, use a command similar to the following:\n```\ngcloud sql instances patch [INSTANCE_NAME] \\\u00a0 \u00a0 --no-deletion-protection\n```To set deletion protection when you update an instance, specify `true` in the `deletionProtection` field. To remove deletion protection, specify `false` in that field.\nBefore using any of the request data, make the following replacements:- : Your project ID\n- : Desired instance ID\nHTTP method and URL:\n```\nPATCH https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\n```\nRequest JSON body:\n```\n{\n \"settings\": {\n \"deletionProtectionEnabled\": true\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2022-06-1T03:42:12.281Z\",\n \"operationType\": \"CREATE\",\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\nTo set deletion protection when you update an instance, specify `true` in the `deletionProtection` field. To remove deletion protection, specify `false` in that field.\nBefore using any of the request data, make the following replacements:- : Your project ID\n- : Desired instance ID\nHTTP method and URL:\n```\nPATCH https://sqladmin.googleapis.com/v1beta4/projects/project-id/instances/instance-id\n```\nRequest JSON body:\n```\n{\n \"settings\": {\n \"deletionProtectionEnabled\": true\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2022-06-1T03:32:12.281Z\",\n \"operationType\": \"UPDATE\",\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n[underlying REST API request](/sql/docs/postgres/admin-api/rest/v1beta4/instances/patch)\n[APIs Explorer on the instances:patch page](/sql/docs/postgres/admin-api/rest/v1beta4/instances/patch)", "guide": "Cloud SQL"}