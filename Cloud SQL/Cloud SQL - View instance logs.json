{"title": "Cloud SQL - View instance logs", "url": "https://cloud.google.com/sql/docs/postgres/logging", "abstract": "# Cloud SQL - View instance logs\nThis page describes how to find and use Cloud Logging to view and query logs for your Cloud SQL instance.\nCloud SQL uses Cloud Logging. See the [cloud logging documentation](/logging/docs) for complete information and review the [Cloud SQL sample queries](/logging/docs/view/query-library-preview#sql-filters) .\n", "content": "## View logs\nTo view logs for your Cloud SQL instance log entries:\n- In the Google Cloud console, go to the **Cloud Logging** page. [Go to Cloud Logging](https://console.cloud.google.com/logs/query) \n- Select an existing Cloud SQL project at the top of the page.\n- In the Query builder, add the following:\n- Resource: select **Cloud SQL Database** . In the dialog, select a   Cloud SQL instance.\n- Log names: scroll to the Cloud SQL section and select   appropriate log files for your instance. For example:- cloudsql.googleapis.com/postgres.log\n- Severity: select a log level.\n- Time range: select a preset or create a custom range.Use the [gcloud logging](/sdk/gcloud/reference/logging/read) command to view log entries. In the example below, replace `` . The [limit](/sdk/gcloud/reference/logging/read#--limit) flag is an optional parameter that indicates the maximum number of entries to return.\n```\ngcloud logging read \"resource.type=cloudsql_database\" \\--project=PROJECT-ID \\--limit=10 \\--format=json\n```\n## View instance operations log\nYou can view the logs for an instance in the **Operations** pane. The **Operations** pane logs every operation performed on the instance with the following information:\n- The time the operation completed, reported in your local time zone.\n- The type of operation.\n- The status of the operation.\n- A message describing the outcome the operation.\nIf the operation fails, you can use the message to troubleshoot the problem.\n**To view an instance operations log:**\n- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- To open the **Overview** page of an instance, click the instance name.\n- Click **Operations** to change to the pane showing the operation log.\n**Note:**\n`gcloud`\n## View application logs\nApplications that connect to Cloud SQL store their logs in different locations.\n### App Engine (flexible environment)\nIn **Compute > App Engine > Services** :\n- In the list of services, find your service.\n- Click on the **Tools** dropdown.\n- Select **logs** \nIn the **Operations > Logging > Logs explorer** section of Google Cloud console, use the following query:\n```\nresource.type=\"gae_app\"resource.labels.module_id=\"default\"\n```\n### Cloud Run\nView the logs in the Cloud Run **Logs Explorer** section of the Google Cloud console. Note that Cloud Run reports only error messages from the Cloud SQL Auth Proxy. Use a query like the following:\n```\nresource.type=\"cloud_run_revision\"resource.labels.service_name=\"$SERVICE_NAME\"resource.labels.revision_name=\"$REVISION_NAME\"\n```\n### Cloud SQL Auth Proxy\nIn **Operations > Logging > Logs explorer** , use the following query:\n```\nlog_id(\"appengine.googleapis.com/cloud-sql-proxy\")\n```\n## Troubleshoot\n| Issue               | Troubleshooting                                                                                                                                                                                   |\n|:-----------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Logging uses a lot of CPU and memory on your Cloud SQL instance. | Logging needs to be tuned. The log_statement flag can be set to none and the logging_collector flag can be set to off. If logging is still occurring, there may be other log-related flags that can be tuned. You can edit the instance to modify these flags.                                                                                                                       |\n| Audit logs are not found.          | Data-Access logs are only written if the operation is an authenticated user-driven API call that creates, modifies, or reads user-created data, or if the operation accesses configuration files or metadata of resources.                                                                                                                                |\n| Operations information is not found in logs.      | You want to find more information about an operation. For example, a user was deleted but you can't find out who did it. The logs show the operation started but don't provide any more information. You must enable audit logging for detailed and personal identifying information (PII) like this to be logged.                                                                                                         |\n| Log files are hard to read.          | You'd rather view the logs as json or text.You can use the gcloud logging read command along with linux post-processing commands to download the logs. To download the logs as JSON: gcloud logging read \\ \"resource.type=cloudsql_database \\ AND logName=projects/PROJECT_ID \\ /logs/cloudsql.googleapis.com%2FLOG_NAME\" \\ --format json \\ --project=PROJECT_ID \\ --freshness=\"1d\" \\ > downloaded-log.json To download the logs as TEXT: gcloud logging read \\ \"resource.type=cloudsql_database \\ AND logName=projects/PROJECT_ID \\ /logs/cloudsql.googleapis.com%2FLOG_NAME\" \\ --format json \\ --project=PROJECT_ID \\ --freshness=\"1d\"| jq -rnc --stream 'fromstream(1|truncate_stream(inputs)) \\ | .textPayload' \\ --order=asc > downloaded-log.txt |\n| Query logs are not found in PostgreSQL logs.      | You need to enable the pgaudit flags. From a terminal, connect to your database: gcloud sql connect INSTANCE_NAME Run this command to create the extension: CREATE EXTENSION pgaudit; Exit the database, and from a terminal run the following command: gcloud sql instances patch INSTANCE_NAME \\ --database-flags=cloudsql.enable_pgaudit=on,pgaudit.log=all                                                                                              |", "guide": "Cloud SQL"}