{"title": "Cloud SQL - Increase the table open cache size", "url": "https://cloud.google.com/sql/docs/mysql/recommender-high-number-of-open-tables", "abstract": "# Cloud SQL - Increase the table open cache size\n**    Preview     ** This feature is subject to the \"Pre-GA Offerings Terms\" in the General Service Terms section   of the [Service Specific Terms](/terms/service-terms#1) .     Pre-GA features are available \"as is\" and might have limited support.    For more information, see the [launch stage descriptions](/products#product-launch-stages) .\nThe Cloud SQL high-number-of-open-tables [recommender](/recommender/docs/overview) helps you detect instances whose number of concurrently opened tables is equal to the value of `table_open_cache` . It then provides recommendations on how to optimize such instances to improve performance.\nThis page describes how the high-number-of-open-tables recommender works and how you can use it.\n", "content": "## How it works\nMySQL is multi-threaded, and clients can simultaneously issue a query on the same table from multiple threads. Thus, MySQL can have independently open tables for each session. The number of simultaneously opened tables is managed by `table_open_cache` . If the cache is full and additional tables are opened, MySQL closes the least recently used table. If all the tables in cache are currently being used, MySQL extends the cache temporarily and closes the tables as soon as they become unused.\nIf the number of open tables exceeds the `table_open_cache` value, database performance can be adversely affected during high workload. This is because more threads are created and table handlers have to open and close the tables more frequently.\nThe Cloud SQL high-number-of-open-tables recommender analyzes metrics for the number of opened tables on a Cloud SQL MySQL instance daily. If the number of opened tables increases by 1 every 2 seconds or faster in the preceding 24 hours, and the number of open tables is equal to or more than the `table_open_cache` value, the recommender advises you to adjust the `table_open_cache` flag.\n**Note:** Recommendations are generated daily.\n## Pricing\nThe Cloud SQL high-number-of-open-tables recommender is in the  [Recommender pricing tier](/recommender/pricing) .\n## Before you begin\nBefore you can view recommendations and insights, do the following:\n- To get the permissions to view and work with insights and recommendations, ensure that you have the required [roles](/sql/docs/mysql/project-access-control#roles) .| Tasks     | Roles                    |\n|:----------------------|:------------------------------------------------------------------------------------|\n| View recommendations | One of these roles: recommender.cloudsqlViewer or cloudsql.viewer.     |\n| Apply recommendations | One of these roles: recommender.cloudsqlAdmin, cloudsql.editor, or cloudsql.admin. |For more information about roles, see [understanding roles](/iam/docs/understanding-roles) and [granting IAM permissions](/iam/docs/granting-changing-revoking-access) .\n- Enable the Recommender API. [Enable the API](https://console.cloud.google.com/flows/enableapi?apiid=recommender.googleapis.com) \n## List instance performance recommendations\nYou can list the instance performance recommendations by using the Google Cloud console, ` [gcloud CLI](/sdk/gcloud) ` , or the Recommender API.\nThe improve instance performance recommendations are shown only if you have instances that are nearing performance threshold limits.\nTo list recommendations about instance performance by using the Google Cloud console, follow these steps:- Go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql/instances) \n- Click **View all** on the Increase table open cache recommendations banner.\nAlternatively, follow these steps:- Go to the **Recommendation Hub** . See also [Getting started with Recommendation Hub](/recommender/docs/recommendation-hub/identify-configuration-problems) . [Go to the Recommendation Hub](https://console.cloud.google.com/home/recommendations/) \n- In the **Improve Cloud SQL Instance Performance** card, click **View all** .\n- Select the instances with **Increase table open cache** recommendation.\nTo list Improve Instance Performance recommendations by using `gcloud CLI` , run the [gcloud recommender recommendations list](/sdk/gcloud/reference/recommender/recommendations/list) command as follows:\n```\ngcloud recommender recommendations list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--recommender=google.cloudsql.instance.PerformanceRecommender \\\n--filter=recommenderSubtype=MYSQL_HIGH_NUMBER_OF_OPEN_TABLES_BEST_PRACTICE\n```\nReplace the following:- ``: Your project ID\n- ``: A region, such as`us-central1`\nTo list Improve Instance Performance recommendations by using the [Recommendations API](/recommender/docs/using-api) , call the [recommendations.list](/recommender/docs/reference/rest/v1beta1/projects.locations.recommenders.recommendations/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/recommenders/google.cloudsql.instance.PerformanceRecommender.MySqlHighNumberOfTablesBestPractice/recommendations\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\nIf the recommender detects instances that have a high-number-of-open-tables, it lists them in a table with other performance recommendations. Each row shows the instance ID, a brief recommendation, database engine, the location, and the last refresh date.\n## View insights and detailed recommendations\nYou can view insights and detailed recommendations about instances that have a high-number-of-open-tables by using the Google Cloud console, `gcloud CLI` , or the Recommender API.\nTo view insights and detailed recommendations about instances that are close to the performance threshold by using the Google Cloud console, click the recommendation link in the list of instances.\nTo view insights and detailed recommendations about instances that are close to the performance threshold by using `gcloud CLI` , run the [gcloud recommender insights list](/sdk/gcloud/reference/recommender/insights/list) command as follows:\n```\ngcloud recommender insights list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--insight-type=google.cloudsql.instance.PerformanceInsight \\\n--filter=insightSubtype=MYSQL_HIGH_NUMBER_OF_OPEN_TABLES\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\nTo view insights and detailed recommendations about instances that have a high-number-of-open-tables by using the [Recommendations API](/recommender/docs/using-api) , call the [insights.list](/recommender/docs/reference/rest/v1beta1/projects.locations.insightTypes.insights/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/insightTypes/google.cloudsql.instance.PerformanceRecommender.MySqlHighNumberOfOpenTables/insights\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\nThe following table lists the insight and recommendation that the Cloud SQL high-number-of-open-tables recommender generates to help you improve performance. The subtypes are visible in the `gcloud CLI` and API results.\n| Insight                          | Recommendation                               |\n|:--------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|\n| Number of open tables is equal to the table_open_cache flag value. Subtype: MYSQL_HIGH_NUMBER_OF_OPEN_TABLES | Increase Cloud SQL instance performance by reducing the number of open tables. Subtype: MYSQL_HIGH_NUMBER_OF_OPEN_TABLES_BEST_PRACTICE |\n## Apply recommendations\nEvaluate the recommendations carefully and do any of the following:\n- To examine the instance, click **View instance** . See [Optimize the performance of your instance](#optimize-performance) and follow the recommendations.\n- To dismiss the recommendation so that it's de-emphasized and appears dimmed, click **Dismiss** .\n- To close the panel without applying or dismissing the recommendation, click **Cancel** .\n### Optimize the performance of your instance\nTo optimize your instance's performance, do any of the following:\n- Increase the value of `table_open_cache` by 500 until the recommendation disappears. The recommendation is updated daily, so after you increase the value of `table_open_cache` , wait for 24 hours before checking it again.\n- If the value of `open_tables` is more than `table_open_cache` , increase the value of `table_open_cache` to the value of `open_tables` .For information on how to update a database flag, see [Configure database flags](/sql/docs/mysql/flags#config) . **Note:** Don't set the value of `table_open_cache` to be more than `524288` , which is [the maximum allowed value for this flag](/sql/docs/mysql/flags#table-open-cache) .## What's next\n- [Manage high number of tables](/sql/docs/mysql/recommender-high-number-of-tables) \n- [Monitor disk availability](/sql/docs/mysql/using-ood-recommender) \n- [Identify idle Cloud SQL instances](/sql/docs/mysql/recommender-sql-idle) \n- [Reduce overprovisioned Cloud SQL instances](/sql/docs/mysql/recommender-sql-overprovisioned) \n- Explore [Google Cloud recommenders](/recommender/docs/recommenders)", "guide": "Cloud SQL"}