{"title": "Cloud SQL - \u4e00\u822c\u6700\u4f73\u505a\u6cd5", "url": "https://cloud.google.com/sql/docs/postgres/best-practices?hl=zh-cn", "abstract": "# Cloud SQL - \u4e00\u822c\u6700\u4f73\u505a\u6cd5\n\u672c\u9801\u9762\u4ecb\u7d39\u4e86\u4e00\u4e9b\u6700\u4f73\u505a\u6cd5\uff0c\u9075\u5faa\u9019\u4e9b\u505a\u6cd5\u53ef\u5f9e Cloud SQL \u7372\u5f97\u6700\u4f73\u7684\u6027\u80fd\u3001\u8010\u7528\u6027\u548c\u53ef\u7528\u6027\u3002\n\u5982\u679c\u60a8\u7684 Cloud SQL \u5be6\u4f8b\u51fa\u73fe\u554f\u984c\uff0c\u8acb\u5728\u6392\u67e5\u554f\u984c\u6642\u67e5\u770b\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- [\u8abf\u8a66\u9023\u63a5\u554f\u984c](https://cloud.google.com/sql/docs/postgres/debugging-connectivity?hl=zh-cn) \n- [\u8a3a\u65b7\u554f\u984c](https://cloud.google.com/sql/docs/postgres/diagnose-issues?hl=zh-cn) \n- [\u5df2\u77e5\u554f\u984c](https://cloud.google.com/sql/docs/postgres/known-issues?hl=zh-cn) \n- [\u554f\u984c\u6392\u67e5](https://cloud.google.com/sql/docs/postgres/troubleshooting?hl=zh-cn) ", "content": "## \u5be6\u4f8b\u914d\u7f6e\u548c\u7ba1\u7406\n| \u6700\u4f73\u505a\u6cd5                    | \u66f4\u591a\u4fe1\u606f                                                                                                                                                                           |\n|:-------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| \u95b1\u8b80\u4e26\u9075\u5faa\u64cd\u4f5c\u6307\u5357\uff0c\u78ba\u4fdd\u60a8\u7684\u5be6\u4f8b\u5728 Cloud SQL \u670d\u52d9\u7b49\u7d1a\u5354\u8b70 (SLA) \u7684\u6db5\u84cb\u7bc4\u570d\u5167\u3002  | nan                                                                                                                                                                            |\n| \u7232\u4e3b\u5be6\u4f8b\u914d\u7f6e\u7dad\u8b77\u671f\uff0c\u4ee5\u63a7\u5236\u57f7\u884c\u4e2d\u65b7\u6027\u66f4\u65b0\u7684\u6642\u9593\u3002          | \u8acb\u53c3\u95b1\u7dad\u8b77\u671f\u3002                                                                                                                                                                         |\n| \u5c0d\u65bc\u983b\u7e41\u8b80\u53d6\u7684\u5de5\u4f5c\u8ca0\u8f09\uff0c\u8acb\u6dfb\u52a0\u53ea\u8b80\u526f\u672c\u4ee5\u5f9e\u4e3b\u5be6\u4f8b\u5206\u6d41\u6d41\u91cf\u3002       | \u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8ca0\u8f09\u5e73\u8861\u5668\uff08\u5982 HAProxy\uff09\u4f86\u7ba1\u7406\u767c\u9001\u5230\u526f\u672c\u7684\u6d41\u91cf\u3002                                                                                                                                                             |\n| \u5982\u679c\u60a8\u5b9a\u671f\u522a\u9664\u4e26\u91cd\u65b0\u5275\u5efa\u5be6\u4f8b\uff0c\u8acb\u5728\u5be6\u4f8b ID \u4e2d\u4f7f\u7528\u6642\u9593\u6233\u4ee5\u589e\u52a0\u65b0\u5be6\u4f8b ID \u53ef\u7528\u7684\u53ef\u80fd\u6027\u3002 | nan                                                                                                                                                                            |\n| \u5728\u5148\u524d\u64cd\u4f5c\u5b8c\u6210\u4e4b\u524d\uff0c\u8acb\u52ff\u5553\u52d5\u7ba1\u7406\u64cd\u4f5c\u3002            | Cloud SQL \u5be6\u4f8b\u5728\u5b8c\u6210\u5148\u524d\u7684\u64cd\u4f5c\u4e4b\u524d\u4e0d\u63a5\u53d7\u65b0\u7684\u64cd\u4f5c\u8acb\u6c42\u3002\u5982\u679c\u60a8\u8a66\u5716\u63d0\u524d\u5553\u52d5\u65b0\u64cd\u4f5c\uff0c\u5247\u64cd\u4f5c\u8acb\u6c42\u5c07\u5931\u6557\u3002\u9019\u4e5f\u5305\u62ec\u5be6\u4f8b\u91cd\u5553\u5728\u5167\u3002 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684\u5be6\u4f8b\u72c0\u614b\u4e0d\u6703\u53cd\u6620\u64cd\u4f5c\u662f\u5426\u6b63\u5728\u904b\u884c\u3002\u7da0\u8272\u5c0d\u52fe\u6a19\u8a18\u50c5\u8868\u793a\u5be6\u4f8b\u8655\u65bc RUNNABLE \u72c0\u614b\u3002\u5982\u9700\u67e5\u770b\u64cd\u4f5c\u662f\u5426\u6b63\u5728\u904b\u884c\uff0c\u8acb\u8f49\u5230\u64cd\u4f5c\u6a19\u7c64\u9801\uff0c\u7136\u5f8c\u6aa2\u67e5\u6700\u8fd1\u64cd\u4f5c\u7684\u72c0\u614b\u3002                                                                                                    |\n| \u914d\u7f6e\u5b58\u5132\u7a7a\u9593\u4ee5\u652f\u6301\u91cd\u8981\u7684\u6578\u64da\u5eab\u7dad\u8b77\u3002             | \u5982\u679c\u505c\u7528\u4e86\u5553\u7528\u5b58\u5132\u7a7a\u9593\u81ea\u52d5\u64f4\u5bb9\u529f\u80fd\u5be6\u4f8b\u8a2d\u7f6e\uff0c\u6216\u8005\u5553\u7528\u4e86\u5b58\u5132\u7a7a\u9593\u81ea\u52d5\u64f4\u5bb9\u4e0a\u9650\uff0c\u8acb\u78ba\u4fdd\u60a8\u81f3\u5c11\u6709 20% \u7684\u53ef\u7528\u7a7a\u9593\u4ee5\u652f\u6301 Cloud SQL \u53ef\u80fd\u57f7\u884c\u7684\u91cd\u8981\u6578\u64da\u5eab\u7dad\u8b77\u64cd\u4f5c\u3002 \u5982\u679c\u60a8\u5e0c\u671b\u5728\u53ef\u7528\u78c1\u76e4\u7a7a\u9593\u4f4e\u65bc 20% \u6642\u6536\u5230\u63d0\u9192\uff0c\u8acb\u7232\u78c1\u76e4\u5229\u7528\u7387\u6307\u6a19\u5275\u5efa\u57fa\u65bc\u6307\u6a19\u7684\u63d0\u9192\u653f\u7b56\uff0c\u4e26\u8a2d\u7f6e\u9ad8\u65bc\u95be\u503c\u7684\u95be\u503c\u4f4d\u7f6e\u548c .8 \u7684\u95be\u503c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u5275\u5efa\u57fa\u65bc\u6307\u6a19\u7684\u63d0\u9192\u653f\u7b56\u3002                                                                                            |\n| \u9632\u6b62 CPU \u5229\u7528\u7387\u904e\u9ad8\u3002                | \u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u201c\u5be6\u4f8b\u8a73\u60c5\u201d\u9801\u9762\u4e0a\u67e5\u770b\u5be6\u4f8b\u6b63\u5728\u4f7f\u7528\u7684\u53ef\u7528 CPU \u7684\u767e\u5206\u6bd4\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u6307\u6a19\u3002\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528\u5275\u5efa\u6307\u6a19\u95be\u503c\u63d0\u9192\u653f\u7b56\uff0c\u76e3\u63a7 CPU \u4f7f\u7528\u7387\u4e26\u5728\u9054\u5230\u6307\u5b9a\u7684\u95be\u503c\u6642\u6536\u5230\u63d0\u9192\u3002 \u7232\u4e86\u907f\u514d\u5229\u7528\u7387\u904e\u9ad8\uff0c\u60a8\u53ef\u4ee5\u589e\u52a0\u5be6\u4f8b\u7684 CPU \u6578\u3002\u66f4\u6539 CPU \u9700\u8981\u91cd\u5553\u5be6\u4f8b\u3002\u5982\u679c\u5be6\u4f8b\u7684 CPU \u6578\u5df2\u9054\u5230\u4e0a\u9650\uff0c\u5247\u5fc5\u9808\u5c07\u6578\u64da\u5eab\u5206\u7247\u5230\u591a\u500b\u5be6\u4f8b\u3002                                                                                              |\n| \u907f\u514d\u5167\u5b58\u8017\u76e1\u3002                  | \u5728\u67e5\u627e\u5167\u5b58\u8017\u76e1\u8de1\u8c61\u6642\uff0c\u61c9\u4e3b\u8981\u4f7f\u7528 usage \u6307\u6a19\u3002\u7232\u907f\u514d\u767c\u751f\u5167\u5b58\u4e0d\u8db3\u7684\u932f\u8aa4\uff0c\u6211\u5011\u5efa\u8b70\u5c07\u6b64\u6307\u6a19\u4fdd\u6301\u5728 90% \u4ee5\u4e0b\u3002 \u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 total_usage \u6307\u6a19\u4f86\u89c0\u5bdf Cloud SQL \u5be6\u4f8b\u6b63\u5728\u4f7f\u7528\u7684\u53ef\u7528\u5167\u5b58\u767e\u5206\u6bd4\uff0c\u5305\u62ec\u6578\u64da\u5eab\u5bb9\u5668\u4f7f\u7528\u7684\u5167\u5b58\u4ee5\u53ca\u64cd\u4f5c\u7cfb\u7d71\u7de9\u5b58\u3002 \u901a\u904e\u89c0\u5bdf\u9019\u5169\u500b\u6307\u6a19\u4e4b\u9593\u7684\u5dee\u7570\uff0c\u60a8\u53ef\u4ee5\u78ba\u5b9a\u9032\u7a0b\u4f7f\u7528\u7684\u5167\u5b58\u91cf\u8207\u64cd\u4f5c\u7cfb\u7d71\u7de9\u5b58\u4f7f\u7528\u7684\u5167\u5b58\u91cf\u3002\u60a8\u53ef\u4ee5\u5c07\u6b64\u7de9\u5b58\u4e2d\u7684\u5167\u5b58\u6539\u4f5c\u4ed6\u7528\u3002 \u5982\u9700\u9810\u6e2c\u5167\u5b58\u4e0d\u8db3\u554f\u984c\uff0c\u8acb\u6aa2\u67e5\u9019\u5169\u500b\u6307\u6a19\u4e26\u4e00\u8d77\u89e3\u8b80\u3002\u5982\u679c\u9019\u4e9b\u6307\u6a19\u770b\u8d77\u4f86\u8f03\u9ad8\uff0c\u5247\u8868\u793a\u5be6\u4f8b\u53ef\u80fd\u5167\u5b58\u4e0d\u8db3\u3002\u9019\u53ef\u80fd\u662f\u56e0\u7232\u81ea\u5b9a\u7fa9\u914d\u7f6e\u548c/\u6216\u5de5\u4f5c\u8ca0\u8f09\u7684\u5be6\u4f8b\u898f\u6a21\u4e0d\u8db3\u3002 \u64f4\u7e2e Cloud SQL \u5be6\u4f8b\u4ee5\u589e\u52a0\u5176\u5167\u5b58\u5927\u5c0f\u3002 \u66f4\u6539\u5be6\u4f8b\u7684\u5167\u5b58\u5927\u5c0f\u9700\u8981\u91cd\u5553\u5be6\u4f8b\u3002 \u5982\u679c\u5be6\u4f8b\u5df2\u9054\u5230\u5167\u5b58\u5927\u5c0f\u4e0a\u9650\uff0c\u5247\u5fc5\u9808\u5c07\u6578\u64da\u5eab\u5206\u7247\u5230\u591a\u500b\u5be6\u4f8b\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u76e3\u63a7\u5169\u500b\u6307\u6a19\uff0c\u8acb\u53c3\u95b1\u6307\u6a19\u3002 |\n| \u78ba\u4fdd\u60a8\u7684\u5be6\u4f8b\u5177\u6709\u6700\u4f73\u4e8b\u52d9 ID\u3002              | \u60a8\u53ef\u4ee5\u901a\u904e\u5c07 Resource Type \u8a2d\u7f6e\u7232 Cloud SQL Database \u4e26\u5c07 Metric \u8a2d\u7f6e\u7232 Percentage of instance's transaction IDs consumed\uff0c\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 Metrics Explorer \u9801\u9762\u4e0a\u67e5\u770b\u5be6\u4f8b\u7684\u4e8b\u52d9 ID \u4f7f\u7528\u60c5\u6cc1\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u4f7f\u7528 Metrics Explorer \u5275\u5efa\u5716\u8868\u3002 \u8abf\u6574\u548c\u76e3\u63a7\u6578\u64da\u5eab\u5be6\u4f8b\u6709\u52a9\u65bc\u6e1b\u5c11\u6216\u907f\u514d\u8207 vacuum \u6709\u95dc\u7684\u554f\u984c\u3002\u76e3\u63a7\u5be6\u4f8b\u7684\u4e8b\u52d9 ID \u4f7f\u7528\u60c5\u6cc1\uff0c\u4e26\u6839\u64da\u5be6\u4f8b\u4e0a\u7684\u5de5\u4f5c\u8ca0\u8f09\u5553\u7528\u548c\u8abf\u6574 autovacuum \u53c3\u6578\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u514b\u670d\u4e8b\u52d9 ID (TXID) \u56de\u6372\u4fdd\u8b77\u3002                                                               |\n## \u6578\u64da\u67b6\u69cb\n| \u6700\u4f73\u505a\u6cd5       | \u66f4\u591a\u4fe1\u606f                            |\n|:-----------------------------------|:-----------------------------------------------------------------------------------------------------------------------|\n| \u5118\u53ef\u80fd\u5c07\u5927\u578b\u5be6\u4f8b\u62c6\u5206\u7232\u8f03\u5c0f\u7684\u5be6\u4f8b\u3002 | \u5982\u679c\u53ef\u80fd\uff0c\u4f7f\u7528\u591a\u500b\u8f03\u5c0f\u7684 Cloud SQL \u5be6\u4f8b\u8981\u512a\u65bc\u4f7f\u7528\u4e00\u500b\u5927\u578b\u5be6\u4f8b\u3002 \u7ba1\u7406\u55ae\u500b\u5927\u578b\u5be6\u4f8b\u6642\uff0c\u6703\u9047\u5230\u4e00\u7d44\u8f03\u5c0f\u5be6\u4f8b\u4e0d\u6703\u767c\u751f\u7684\u96e3\u984c\u3002 |\n| \u8acb\u52ff\u4f7f\u7528\u592a\u591a\u7684\u6578\u64da\u5eab\u8868\u3002   | \u78ba\u4fdd\u5be6\u4f8b\u7684\u8868\u6578\u5c11\u65bc 10000 \u500b\u3002\u592a\u591a\u6578\u64da\u5eab\u8868\u53ef\u80fd\u6703\u5f71\u97ff\u6578\u64da\u5eab\u7684\u5347\u7d1a\u6642\u9593\u3002             |\n## \u61c9\u7528\u5be6\u73fe\n| \u6700\u4f73\u505a\u6cd5             | \u66f4\u591a\u4fe1\u606f                                        |\n|:---------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| \u63a1\u7528\u6700\u4f73\u9023\u63a5\u7ba1\u7406\u505a\u6cd5\uff0c\u4f8b\u5982\u9023\u63a5\u6c60\u548c\u6307\u6578\u9000\u907f\u7b97\u6cd5\u3002   | \u4f7f\u7528\u9019\u4e9b\u65b9\u6cd5\u6703\u6539\u5584\u61c9\u7528\u5c0d\u8cc7\u6e90\u7684\u4f7f\u7528\uff0c\u4e26\u5e6b\u52a9\u60a8\u4fdd\u6301\u5728 Cloud SQL \u9023\u63a5\u9650\u5236\u5167\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\u548c\u4ee3\u78bc\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1\u7ba1\u7406\u6578\u64da\u5eab\u9023\u63a5\u3002            |\n| \u6e2c\u8a66\u61c9\u7528\u5c0d\u7dad\u8b77\u66f4\u65b0\u7684\u97ff\u61c9\u60c5\u6cc1\uff0c\u9019\u53ef\u80fd\u5728\u7dad\u8b77\u671f\u9593\u96a8\u6642\u767c\u751f\u3002 | \u5617\u8a66\u81ea\u52a9\u7dad\u8b77\u4ee5\u6a21\u64ec\u7dad\u8b77\u66f4\u65b0\u3002\u5728\u7dad\u8b77\u671f\u9593\uff0c\u5be6\u4f8b\u5728\u77ed\u6642\u9593\u5167\u8b8a\u5f97\u4e0d\u53ef\u7528\uff0c\u4e26\u4e14\u73fe\u6709\u9023\u63a5\u6703\u88ab\u4e1f\u68c4\u3002\u901a\u904e\u6e2c\u8a66\u7dad\u8b77\u9aee\u5e03\uff0c\u60a8\u53ef\u4ee5\u66f4\u597d\u5730\u77ad\u89e3\u61c9\u7528\u8655\u7406\u8a08\u5283\u6027\u7dad\u8b77\u7684\u65b9\u5f0f\u4ee5\u53ca\u7cfb\u7d71\u6062\u5fa9\u7684\u901f\u5ea6\u3002 |\n| \u6e2c\u8a66\u61c9\u7528\u5c0d\u6545\u969c\u5207\u63db\u7684\u97ff\u61c9\u60c5\u6cc1\uff0c\u9019\u53ef\u80fd\u96a8\u6642\u767c\u751f\u3002   | \u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u3001gcloud CLI \u6216 API \u624b\u52d5\u5553\u52d5\u6545\u969c\u5207\u63db\u3002\u8acb\u53c3\u95b1\u5553\u52d5\u6545\u969c\u5207\u63db\u3002                    |\n| \u907f\u514d\u5927\u578b\u4e8b\u52d9\u3002           | \u4fdd\u6301\u4e8b\u52d9\u5c0f\u800c\u7c21\u77ed\u3002\u5982\u679c\u9700\u8981\u9032\u884c\u5927\u578b\u6578\u64da\u5eab\u66f4\u65b0\uff0c\u5c07\u5176\u5206\u7232\u5e7e\u500b\u8f03\u5c0f\u7684\u4e8b\u52d9\u57f7\u884c\uff0c\u800c\u4e0d\u662f\u901a\u904e\u4e00\u500b\u5927\u578b\u4e8b\u52d9\u3002                  |\n| \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Cloud SQL Auth \u4ee3\u7406\uff0c\u8acb\u78ba\u4fdd\u4f7f\u7528\u6700\u65b0\u7248\u672c\u3002 | \u8acb\u53c3\u95b1\u4fdd\u6301 Cloud SQL Auth \u4ee3\u7406\u7232\u6700\u65b0\u7248\u672c\u3002                                |\n## \u6578\u64da\u5c0e\u5165\u548c\u5c0e\u51fa\n| \u6700\u4f73\u505a\u6cd5              | \u66f4\u591a\u4fe1\u606f                                |\n|:--------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------|\n| \u4f7f\u7528\u7121\u670d\u52d9\u5668\u5c0e\u51fa\u529f\u80fd\u3002          | \u7121\u670d\u52d9\u5668\u5c0e\u51fa\u6703\u5c07\u5c0e\u51fa\u64cd\u4f5c\u5206\u6d41\u5230\u81e8\u6642\u5be6\u4f8b\uff0c\u4f7f\u4e3b\u5be6\u4f8b\u53ef\u4ee5\u7e7c\u7e8c\u8655\u7406\u67e5\u8a62\uff0c\u4e26\u4ee5\u6b63\u5e38\u7684\u6027\u80fd\u57f7\u884c\u64cd\u4f5c\u3002\u6578\u64da\u5c0e\u51fa\u64cd\u4f5c\u5b8c\u6210\u5f8c\uff0c\u81e8\u6642\u5be6\u4f8b\u6703\u88ab\u81ea\u52d5\u522a\u9664\u3002 |\n| \u52a0\u5feb\u5c0f\u578b\u5be6\u4f8b\u7684\u5c0e\u5165\u3002           | \u5c0d\u65bc\u5c0f\u578b\u5be6\u4f8b\uff0c\u60a8\u53ef\u4ee5\u81e8\u6642\u589e\u52a0\u5be6\u4f8b\u7684 CPU \u548c RAM\uff0c\u4ee5\u63d0\u9ad8\u5c0e\u5165\u5927\u578b\u6578\u64da\u96c6\u6642\u7684\u6027\u80fd\u3002              |\n| \u5982\u679c\u60a8\u8981\u5c0e\u51fa\u6578\u64da\u4ee5\u5c0e\u5165\u5230 Cloud SQL \u4e2d\uff0c\u8acb\u52d9\u5fc5\u63a1\u7528\u6b63\u78ba\u7684\u904e\u7a0b\u3002 | \u8acb\u53c3\u95b1\u5f9e\u5916\u90e8\u4ee3\u7ba1\u5f0f\u6578\u64da\u5eab\u670d\u52d9\u5668\u5c0e\u51fa\u6578\u64da\u3002                        |\n## \u5099\u4efd\u8207\u6062\u5fa9\n| \u6700\u4f73\u505a\u6cd5          | \u66f4\u591a\u4fe1\u606f                                                                                                                                                                               |\n|:---------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| \u4f7f\u7528\u9069\u7576\u7684 Cloud SQL \u529f\u80fd\u4fdd\u8b77\u60a8\u7684\u6578\u64da\u3002  | \u5099\u4efd\u3001\u6642\u9593\u9ede\u6062\u5fa9\u548c\u5c0e\u51fa\u662f\u63d0\u4f9b\u6578\u64da\u5197\u9918\u548c\u4fdd\u8b77\u7684\u65b9\u6cd5\u3002\u5b83\u5011\u5404\u81ea\u9632\u7bc4\u4e0d\u540c\u7684\u60c5\u5f62\uff0c\u4e26\u5728\u5f37\u5927\u7684\u6578\u64da\u4fdd\u8b77\u7b56\u7565\u4e2d\u76f8\u4e92\u88dc\u5145\u3002 \u5099\u4efd\u5c6c\u65bc\u8f15\u91cf\u7d1a\uff1b\u901a\u904e\u5099\u4efd\uff0c\u53ef\u4ee5\u5c07\u5be6\u4f8b\u4e0a\u7684\u6578\u64da\u6062\u5fa9\u5230\u9032\u884c\u5099\u4efd\u6642\u7684\u72c0\u614b\u3002\u4f46\u662f\uff0c\u5099\u4efd\u4e5f\u5b58\u5728\u4e00\u4e9b\u9650\u5236\u3002\u5982\u679c\u60a8\u522a\u9664\u5be6\u4f8b\uff0c\u5099\u4efd\u4e5f\u6703\u88ab\u522a\u9664\u3002\u60a8\u7121\u6cd5\u5099\u4efd\u55ae\u500b\u6578\u64da\u5eab\u6216\u8868\u3002\u4e26\u4e14\u5982\u679c\u5be6\u4f8b\u6240\u5728\u7684\u5340\u57df\u4e0d\u53ef\u7528\uff0c\u5247\u7121\u6cd5\u901a\u904e\u5c0d\u61c9\u5099\u4efd\u6062\u5fa9\u5be6\u4f8b\uff0c\u5373\u4f7f\u5728\u53ef\u7528\u5340\u57df\u4e2d\u4e5f\u4e0d\u884c\u3002 \u85c9\u52a9\u6642\u9593\u9ede\u6062\u5fa9\uff0c\u60a8\u53ef\u4ee5\u5c07\u5be6\u4f8b\u6062\u5fa9\u5230\u7279\u5b9a\u7684\u6642\u9593\u9ede\u3002\u4f8b\u5982\uff0c\u5982\u679c\u932f\u8aa4\u5c0e\u81f4\u6578\u64da\u4e1f\u5931\uff0c\u60a8\u53ef\u4ee5\u5c07\u6578\u64da\u5eab\u6062\u5fa9\u5230\u932f\u8aa4\u767c\u751f\u524d\u7684\u72c0\u614b\u3002\u6642\u9593\u9ede\u6062\u5fa9\u59cb\u7d42\u6703\u5275\u5efa\u4e00\u500b\u65b0\u5be6\u4f8b\uff1b\u60a8\u4e0d\u80fd\u5c0d\u73fe\u6709\u5be6\u4f8b\u57f7\u884c\u6642\u9593\u9ede\u6062\u5fa9\u3002 \u5c0e\u51fa\u9700\u8981\u8f03\u9577\u6642\u9593\u624d\u80fd\u5275\u5efa\uff0c\u56e0\u7232\u5728 Cloud Storage \u4e2d\u5275\u5efa\u4e86\u53ef\u7528\u65bc\u91cd\u65b0\u5275\u5efa\u6578\u64da\u7684\u5916\u90e8\u6587\u4ef6\u3002\u5982\u679c\u60a8\u522a\u9664\u5be6\u4f8b\uff0c\u5c0e\u51fa\u4e0d\u6703\u53d7\u5f71\u97ff\u3002\u6b64\u5916\uff0c\u60a8\u53ef\u4ee5\u53ea\u5c0e\u51fa\u55ae\u500b\u6578\u64da\u5eab\u751a\u81f3\u8868\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u60a8\u9078\u64c7\u7684\u5c0e\u51fa\u683c\u5f0f\u3002 |\n| \u8abf\u6574\u5be6\u4f8b\u5927\u5c0f\u4ee5\u8003\u616e\u4e8b\u52d9\uff08\u4e8c\u9032\u5236\uff09\u65e5\u8a8c\u4fdd\u7559\u91cf\u3002 | \u5c0d\u6578\u64da\u5eab\u7684\u9ad8\u5beb\u5165\u6d3b\u52d5\u53ef\u80fd\u6703\u751f\u6210\u5927\u91cf\u4e8b\u52d9\uff08\u4e8c\u9032\u5236\uff09\u65e5\u8a8c\uff0c\u9019\u53ef\u80fd\u6703\u4f54\u7528\u5927\u91cf\u78c1\u76e4\u7a7a\u9593\uff0c\u4e26\u53ef\u80fd\u6703\u5c0e\u81f4\u7528\u65bc\u5df2\u5553\u7528\u81ea\u52d5\u589e\u52a0\u5b58\u5132\u7684\u5be6\u4f8b\u7684\u78c1\u76e4\u7528\u91cf\u589e\u52a0\u3002\u5efa\u8b70\u8abf\u6574\u5be6\u4f8b\u5b58\u5132\u7684\u5927\u5c0f\u4ee5\u8003\u616e\u4e8b\u52d9\u65e5\u8a8c\u4fdd\u7559\u91cf\u3002                                                                                                                                    |\n| \u4fdd\u8b77\u60a8\u7684\u5be6\u4f8b\u548c\u5099\u4efd\u514d\u906d\u610f\u5916\u522a\u9664\u3002    | \u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u60a8\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u6216\u901a\u904e Terraform \u5275\u5efa\u7684 Cloud SQL \u5be6\u4f8b\u53ef\u4ee5\u9632\u6b62\u610f\u5916\u522a\u9664\u3002 \u4f7f\u7528 Cloud SQL \u4e2d\u7684\u5c0e\u51fa\u529f\u80fd\u5c0e\u51fa\u6578\u64da\u4ee5\u63d0\u4f9b\u984d\u5916\u4fdd\u8b77\u3002\u5c07 Cloud Scheduler \u8207 REST API \u642d\u914d\u4f7f\u7528\u4ee5\u81ea\u52d5\u57f7\u884c\u5c0e\u51fa\u7ba1\u7406\u3002\u5c0d\u65bc\u66f4\u9ad8\u7d1a\u7684\u5834\u666f\uff0c\u5c07 Cloud Scheduler \u8207 Cloud Functions \u642d\u914d\u4f7f\u7528\u4ee5\u5be6\u73fe\u81ea\u52d5\u5316\u3002                                                                                                          |\n## \u8abf\u6574\u548c\u76e3\u63a7\n\u8abf\u6574\u548c\u76e3\u63a7\u6578\u64da\u5eab\u5be6\u4f8b\u6709\u52a9\u65bc\u6e1b\u5c11\u6216\u907f\u514d\u8207 vacuum \u6709\u95dc\u7684\u554f\u984c\u3002\n`VACUUM` \u64cd\u4f5c\u5177\u6709\u4e0d\u540c\u7684\u8b8a\u9ad4\uff0c\u9019\u4e9b\u8b8a\u9ad4\u5177\u6709\u4e0d\u540c\u7684\u9396\u5b9a\u7d1a\u5225\uff1a\u6a19\u6e96 `VACUUM` \u548c `VACUUM FULL` \u3002 `VACUUM FULL` \u9078\u9805\u53ef\u4ee5\u6536\u56de\u66f4\u591a\u78c1\u76e4\u7a7a\u9593\uff0c\u4f46\u53ea\u6703\u9396\u5b9a\u8868\u4e26\u4e14\u904b\u884c\u7de9\u6162\u3002\u8acb\u6539\u7528\u6a19\u6e96\u5f62\u5f0f\u7684 `VACUUM` \uff0c\u5b83\u53ef\u4ee5\u8207\u751f\u7522\u6578\u64da\u5eab\u64cd\u4f5c\u4e26\u884c\u904b\u884c\u3002\u4f7f\u7528 `VACUUM` \u64cd\u4f5c\u6642\uff0c `SELECT, INSERT, UPDATE, and DELETE` \u7b49\u547d\u4ee4\u6703\u7e7c\u7e8c\u6b63\u5e38\u904b\u884c\u3002\u60a8\u7121\u6cd5\u5728\u8868\u6e05\u7a7a\u6642\u4f7f\u7528 `ALTER TABLE` \u7b49\u547d\u4ee4\u4fee\u6539\u8868\u7684\u5b9a\u7fa9\u3002\n\u4ee5\u4e0b\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5efa\u8b70\uff0c\u53ef\u80fd\u6709\u52a9\u65bc\u7e2e\u77ed\u5b8c\u6210 `VACUUM` \u64cd\u4f5c\u6240\u9700\u7684\u6642\u9593\uff1a\n- \u589e\u52a0\u7cfb\u7d71\u5167\u5b58\u548c`maintenance_work_mem`\u3002\u9019\u53ef\u4ee5\u5728\u6bcf\u6b21\u8fed\u4ee3\u4e2d\u6279\u8655\u7406\u66f4\u591a\u5143\u7d44\uff0c\u4e26\u5118\u5feb\u5b8c\u6210\u5de5\u4f5c\u3002\u8acb\u6ce8\u610f\uff0cautovacuum \u904b\u884c\u6642\uff0c\u6b64\u5167\u5b58\u53ef\u80fd\u6703\u88ab\u5206\u914d\u9ad8\u9054`autovacuum_max_workers`\u500d\uff0c\u56e0\u6b64\u5207\u52ff\u5c07\u9ed8\u8a8d\u503c\u8a2d\u7f6e\u904e\u9ad8\u3002\n- `VACUUM`\u64cd\u4f5c\u6703\u751f\u6210\u5927\u91cf\u9810\u5beb\u5f0f\u65e5\u8a8c (WAL) \u8a18\u9304\u3002\u5982\u679c\u53ef\u4ee5\u6e1b\u5c11 WAL \u8a18\u9304\u7684\u6578\u91cf\uff08\u4f8b\u5982\uff0c\u4e0d\u5c0d\u5be6\u4f8b\u914d\u7f6e\u526f\u672c\uff09\uff0c\u5247\u64cd\u4f5c\u5c07\u66f4\u5feb\u5b8c\u6210\u3002\n- \u5982\u679c\u7531\u65bc\u6c92\u6709\u5143\u7d44\u88ab\u51cd\u7d50\uff0c\u8868\u9054\u5230\u4e86 20 \u5104\u500b\u4e8b\u52d9 ID \u4e0a\u9650\uff0c\u8acb\u5617\u8a66\u6e1b\u5c11\u55ae\u7528\u6236\u6a21\u5f0f\u4e0b\u5b8c\u6210\u7684\u5de5\u4f5c\u91cf\u3002\u4e00\u7a2e\u53ef\u4ee5\u63a1\u7528\u7684\u65b9\u6cd5\u662f\u8a2d\u7f6e`vacuum_freeze_min_age=1,000,000,000`\uff08\u5141\u8a31\u7684\u6700\u5927\u503c\uff0c\u9060\u9060\u8d85\u51fa\u9ed8\u8a8d\u503c 5000 \u842c\uff09\u3002\u9019\u4e00\u65b0\u503c\u53ef\u5c07\u51cd\u7d50\u7684\u5143\u7d44\u6578\u6e1b\u5c11\u9ad8\u9054\u5169\u500d\u3002\n- PostgreSQL 12.0 \u53ca\u66f4\u9ad8\u7248\u672c\u652f\u6301\u6e05\u7406\u548c`VACUUM`\u64cd\u4f5c\uff0c\u800c\u7121\u9700\u6e05\u7406\u7d22\u5f15\u689d\u76ee\u3002\u9019\u4e00\u9ede\u81f3\u95dc\u91cd\u8981\uff0c\u56e0\u7232\u6e05\u7406\u7d22\u5f15\u9700\u8981\u5b8c\u6574\u7684\u7d22\u5f15\u6383\u63cf\uff1b\u5982\u679c\u5b58\u5728\u591a\u500b\u7d22\u5f15\uff0c\u5247\u7e3d\u6642\u9593\u53d6\u6c7a\u65bc\u7d22\u5f15\u5927\u5c0f\u3002\n- \u7d22\u5f15\u8d8a\u5927\uff0c\u7d22\u5f15\u6383\u63cf\u6240\u7528\u6642\u9593\u5c31\u8d8a\u9577\uff0c\u56e0\u6b64\u6700\u597d\u4f7f\u7528`INDEX_CLEANUP OFF`\u5feb\u901f\u6e05\u7406\u548c\u51cd\u7d50\u8868\u6578\u64da\u300212.0 \u4e4b\u524d\u7684 PostgreSQL \u7248\u672c\u9700\u8981\u8abf\u6574\u7d22\u5f15\u7684\u6578\u91cf\u3002\u4e5f\u5c31\u662f\u8aaa\uff0c\u5982\u679c\u5b58\u5728\u975e\u95dc\u9375\u7d22\u5f15\uff0c\u90a3\u9ebc\u522a\u9664`NON-CRITICAL`\u7d22\u5f15\u53ef\u80fd\u6709\u52a9\u65bc\u52a0\u5feb vacuum \u64cd\u4f5c\u7684\u901f\u5ea6\u3002## \u5f8c\u7e8c\u6b65\u9a5f\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6578\u64da\u5eab\u5f15\u64ce\u7684\u4e00\u822c\u505a\u6cd5\uff0c\u8acb\u53c3\u95b1\uff1a\n- [MySQL \u7684\u4e00\u822c\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/sql/docs/mysql/best-practices?hl=zh-cn) \n- [PostgreSQL \u7684\u4e00\u822c\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/sql/docs/postgres/best-practices?hl=zh-cn) \n- [SQL Server \u7684\u4e00\u822c\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/sql/docs/sqlserver/best-practices?hl=zh-cn)", "guide": "Cloud SQL"}