{"title": "Cloud SQL - \u5275\u5efa\u548c\u7ba1\u7406\u8b80\u53d6\u526f\u672c\u4e0a\u7684\u7d22\u5f15", "url": "https://cloud.google.com/sql/docs/mysql/replication/read-replica-indexes?hl=zh-cn", "abstract": "# Cloud SQL - \u5275\u5efa\u548c\u7ba1\u7406\u8b80\u53d6\u526f\u672c\u4e0a\u7684\u7d22\u5f15\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u5728 Cloud SQL \u8b80\u53d6\u526f\u672c\u4e0a\u6dfb\u52a0\u548c\u522a\u9664\u7d22\u5f15\u3002\u96d6\u7136\u526f\u672c\u901a\u5e38\u7232\u53ea\u8b80\uff0c\u4f46\u6709\u6642\u60a8\u53ef\u80fd\u9700\u8981\u7232\u8868\u5275\u5efa [\u4e8c\u7d1a\u7d22\u5f15](https://dev.mysql.com/doc/refman/8.0/en/innodb-index-types.html) \u4ee5\u7528\u65bc\u5831\u544a\u3002Cloud SQL \u63d0\u4f9b\u4e86\u4e00\u7d44\u7528\u65bc\u7ba1\u7406\u9019\u4e9b\u7d22\u5f15\u7684 [\u5b58\u5132\u904e\u7a0b](https://cloud.google.com/sql/docs/mysql/stored-procedures?hl=zh-cn) \u3002\n", "content": "## \u8853\u8a9e\n- **\u805a\u7c07\u7d22\u5f15** \u3002MySQL \u8868\u4e0a\u7684\u4e3b\u7d22\u5f15\uff0c\u7528\u65bc\u5c0d\u78c1\u76e4\u4e0a\u7684\u884c\u9032\u884c\u7269\u7406\u6392\u5e8f\u3002\u7576\u60a8\u5728\u8868\u4e0a\u5b9a\u7fa9\u4e3b\u9375\u6642\uff0cMySQL \u6703\u5c07\u5176\u7528\u4f5c\u805a\u7c07\u7d22\u5f15\u3002\u4e00\u500b\u8868\u4e0a\u53ea\u80fd\u6709\u4e00\u500b\u805a\u7c07\u7d22\u5f15\u3002\n- **\u4e8c\u7d1a\u7d22\u5f15** \u3002MySQL \u8868\u4e0a\u7684\u984d\u5916\u7d22\u5f15\uff0c\u53ef\u512a\u5316\u67e5\u8a62\u6027\u80fd\u3002## \u7d22\u5f15\u7684\u5b58\u5132\u904e\u7a0b\nCloud SQL \u5728 `mysql` \u67b6\u69cb\u4e2d\u5305\u542b\u4e86\u5169\u500b\u5b58\u5132\u904e\u7a0b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u5011\u5728 MySQL \u8b80\u53d6\u526f\u672c\u4e0a\u6dfb\u52a0\u548c\u522a\u9664\u4e8c\u7d1a\u7d22\u5f15\u3002\u8acb\u6ce8\u610f\uff0c\u5118\u7ba1\u9019\u4e9b\u904e\u7a0b\u53ef\u4ee5\u5728\u4e3b\u6e90\u5be6\u4f8b\u4e0a\u904b\u884c\uff0c\u4f46\u5b83\u5011\u662f\u7232\u8b80\u53d6\u526f\u672c\u8a2d\u8a08\u7684\u3002\n\u5c0d\u65bc `idxType` \u548c `idxOption` \u53c3\u6578\uff0c\u8acb\u53c3\u95b1 Cloud SQL \u5be6\u4f8b\u4e0a\u904b\u884c\u7684 MySQL \u4e3b\u8981\u7248\u672c\u7684\u6587\u6a94\u3002\n## \u793a\u4f8b\n### \u6b63\u78ba\u7528\u6cd5\n\u4ee5\u4e0b\u662f\u9019\u4e9b\u904e\u7a0b\u7684\u4e00\u4e9b\u793a\u4f8b\u8abf\u7528\u3002\u5047\u8a2d\u6211\u5011\u6709\u4e00\u500b\u5177\u6709\u4ee5\u4e0b\u5b9a\u7fa9\u7684\u8868\u3002\n```\nCREATE TABLE sampletest.t1(\u00a0 \u00a0id int(10) unsigned NOT NULL AUTO_INCREMENT,\u00a0 \u00a0first_name varchar(64) NOT NULL,\u00a0 \u00a0last_name varchar(64) NOT NULL,\u00a0 \u00a0license_id int NOT NULL,\u00a0 \u00a0PRIMARY KEY (id),\u00a0 \u00a0KEY idx_fname (first_name)) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\u5982\u679c\u8981\u5728 `first_name` \u548c `last_name` \u5217\u4e0a\u5275\u5efa\u4e00\u500b\u540d\u7232 `t1_fname_lname` \u7684\u5e38\u898f\u7d22\u5f15\uff0c\u5247\u57f7\u884c\u4ee5\u4e0b\u8abf\u7528\uff1a\n```\ncall mysql.addSecondaryIdxOnReplica('', 't1_fname_lname', 'sampletest.t1', 'first_name, last_name', '')\n```\n\u5982\u679c\u60a8\u9084\u60f3\u5728 `license_id` \u5217\u4e0a\u5275\u5efa\u4e00\u500b\u540d\u7232 `t1_license_id` \u4e14\u5177\u6709\u8a3b\u91cb\u201cunique licenses id\u201d\u7684\u552f\u4e00\u7d22\u5f15\uff0c\u5247\u57f7\u884c\u4ee5\u4e0b\u8abf\u7528\uff1a\n```\ncall mysql.addSecondaryIdxOnReplica('unique', 't1_license_id', 'sampletest.t1', 'license_id', 'comment \\\"unique license id\\\"')\n```\n\u5982\u679c\u96a8\u5f8c\u60f3\u8981\u522a\u9664 t1_fname_lname \u7d22\u5f15\uff0c\u5247\u57f7\u884c\u4ee5\u4e0b\u8abf\u7528\uff1a\n```\ncall mysql.dropSecondaryIdxOnReplica('t1_fname_lname', 'sampletest.t1', '')\n```\n### \u932f\u8aa4\u7528\u6cd5\n\u7531\u65bc idxDefinition \u53c3\u6578\u88ab\u62ec\u865f\u62ec\u8d77\uff0c\u4ee5\u4e0b\u5728 `first_name` \u548c `last_name` \u5217\u4e0a\u5275\u5efa\u7d22\u5f15\u7684\u5617\u8a66\u5c07\u5931\u6557\u3002\n```\ncall mysql.addSecondaryIdxOnReplica('', 't1_extra_parenthesis', 'sampletest.t1', '(first_name, last_name)', '')\n```\n\u60a8\u53ea\u80fd\u5728\u5ba2\u6236\u5275\u5efa\u7684\u8868\u4e0a\u6dfb\u52a0\u7d22\u5f15\u3002\u4ee5\u4e0b\u5728 mysql.servers \u8868\u7684\u4e3b\u6a5f\u5217\u4e0a\u5275\u5efa\u7d22\u5f15\u7684\u5617\u8a66\u5c07\u5931\u6557\u3002\n```\ncall mysql.addSecondaryIdxOnReplica('', 'idx_invalid', 'mysql.servers', 'host', '')\n```\n\u60a8\u53ea\u80fd\u4f7f\u7528 `dropSecondaryIdxOnReplica` \u904e\u7a0b\u522a\u9664\u4e4b\u524d\u4f7f\u7528 `addSecondaryIdxOnReplica` \u904e\u7a0b\u5275\u5efa\u7684\u7d22\u5f15\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u522a\u9664\u73fe\u6709 `idx_fname` \u7d22\u5f15\u7684\u8abf\u7528\u6703\u5931\u6557\u3002\n```\ncall mysql.dropSecondaryIdxOnReplica('idx_fname', 'sampletest.t1', '')\n```\n\u5728\u9019\u4e9b\u904e\u7a0b\u8abf\u7528\u4e2d\uff0cSQL \u6ce8\u5165\u5c07\u5931\u6557\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u5305\u542b\u8a3b\u91cb\u5e8f\u5217\u7684 SQL \u6ce8\u5165\u5c07\u5931\u6557\u3002\n```\ncall mysql.addSecondaryIdxOnReplica(\\\"user 'a'@'%' --\\\", 'idx_fname', 'sampletest.t1', 'first_name', '')\n```\n\u540c\u6a23\uff0c\u4ee5\u4e0b\u5305\u542b\u5206\u9694\u7b26\u7684 SQL \u6ce8\u5165\u5617\u8a66\u5c07\u5931\u6557\u3002\n```\ncall mysql.addSecondaryIdxOnReplica('', 'idx_fname', 'sampletest.t1', 'first_name', ';flush status')\n```\n## \u91cd\u65b0\u5275\u5efa\u8b80\u53d6\u526f\u672c\n\u6709\u6642\u5728\u51fa\u73fe\u554f\u984c\u6642\uff0cCloud SQL \u6703\u5f9e\u4e3b\u6e90\u5be6\u4f8b\u91cd\u65b0\u5275\u5efa\u8b80\u53d6\u526f\u672c\uff0c\u4ee5\u4fbf\u5feb\u901f\u6062\u5fa9\u5be6\u4f8b\u3002\u91cd\u65b0\u5275\u5efa\u64cd\u4f5c\u4e4b\u524d\u5728\u8b80\u53d6\u526f\u672c\u4e0a\u5275\u5efa\u7684\u7d22\u5f15\u5c07\u4e0d\u6703\u4fdd\u7559\u3002\u5ba2\u6236\u9700\u8981\u8ca0\u8cac\u5728\u8b80\u53d6\u526f\u672c\u4e0a\u4f7f\u7528\u5b58\u5132\u904e\u7a0b\u91cd\u65b0\u5275\u5efa\u9019\u4e9b\u7d22\u5f15\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [\u4f7f\u7528\u672c\u5730\u6a5f\u5668\u6216 Compute Engine \u4e2d\u7684\u6578\u64da\u5eab\u5ba2\u6236\u7aef\u9032\u884c\u9023\u63a5](https://cloud.google.com/sql/docs/mysql/connect-admin-ip?hl=zh-cn)", "guide": "Cloud SQL"}