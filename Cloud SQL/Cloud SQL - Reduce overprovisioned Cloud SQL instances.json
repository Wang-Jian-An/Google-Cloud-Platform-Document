{"title": "Cloud SQL - Reduce overprovisioned Cloud SQL instances", "url": "https://cloud.google.com/sql/docs/postgres/recommender-sql-overprovisioned", "abstract": "# Cloud SQL - Reduce overprovisioned Cloud SQL instances\nThe Cloud SQL overprovisioned instance [recommender](/recommender/docs/overview) helps you detect instances that are unnecessarily large for a given workload. It then provides recommendations on how to resize such instances and reduce cost. This page describes how this recommender works and how to use it.\n", "content": "## How it works\nThe Cloud SQL overprovisioned recommender analyzes the usage metrics of primary instances that are older than 30 days. For each instance, the recommender considers the CPU and memory utilization based on the values of certain [metrics](/monitoring/api/metrics_gcp#gcp-cloudsql) within the last 30 days. The recommender does not analyze read replicas.\nIf the peak utilization of either or both the CPU and the memory within the observation period is low, the instance is estimated to be overprovisioned. Recommendations are generated every 24 hours for rightsizing such instances when the estimated monthly cost savings are greater than or equal to $10.\nThe recommender uses conservative thresholds to ensure that it flags only instances that are significantly overprovisioned, which is usually a good indicator of waste. The recommender suggests a machine type that has at least 8 vCPUs and 32 GB.\n**Warning:** It's highly recommended that you evaluate the insights and in-context charts. Consult with the appropriate team to determine whether the flagged instance is inadvertently overprovisioned and a smaller instance might meet the needs of your application.\n## Pricing\nThe Cloud SQL overprovisioned instance recommender is in the  [Recommender pricing tier](/recommender/pricing) .\n## Before you begin\nBefore you can view recommendations and insights, do the following:\n- To get the permissions to view and work with insights and recommendations, ensure that you have the required [roles](/sql/docs/postgres/project-access-control#roles) .| Tasks     | Roles                    |\n|:----------------------|:------------------------------------------------------------------------------------|\n| View recommendations | One of these roles: recommender.cloudsqlViewer or cloudsql.viewer.     |\n| Apply recommendations | One of these roles: recommender.cloudsqlAdmin, cloudsql.editor, or cloudsql.admin. |For more information about roles, see [understanding roles](/iam/docs/understanding-roles) and [granting IAM permissions](/iam/docs/granting-changing-revoking-access) .\n- Enable the Recommender API. [Enable the API](https://console.cloud.google.com/flows/enableapi?apiid=recommender.googleapis.com) \n## List overprovisioned Cloud SQL instance recommendations\nYou can list overprovisioned instance recommendations by using the Google Cloud console, `gcloud` , or the Recommender API.\nTo list recommendations about overprovisioned instances by using the Google Cloud console, follow these steps:- Go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql/instances) \n- Click **View all** on the overprovisioned instance recommendations banner.\nAlternatively, follow these steps:- Go to the **Recommendation Hub** . [Go to the Recommendation Hub](https://console.cloud.google.com/home/recommendations/) For more information, see [Getting started with Recommendation Hub](/recommender/docs/recommendation-hub/identify-configuration-problems) .\n- In the **Reduce Cloud SQL instance cost** card, click **View all** .\n- Click the **Reduce instance** tab.\nTo list recommendations about overprovisioned instances by using `gcloud` , run the [gcloud recommender recommendations list](/sdk/gcloud/reference/recommender/recommendations/list) command as follows:\n```\ngcloud recommender recommendations list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--recommender=google.cloudsql.instance.RECOMMENDER\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the recommender as`OverprovisionedRecommender`.\nTo list recommendations about overprovisioned instances by using the [Recommendations API](/recommender/docs/using-api) , call the [recommendations.list](/recommender/docs/reference/rest/v1beta1/projects.locations.recommenders.recommendations/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/recommenders/google.cloudsql.instance.RECOMMENDER/recommendations\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the recommender as`OverprovisionedRecommender`.\nIf the recommender detects overprovisioned instances, it lists them in a table. Each row shows the instance name, a brief recommendation, the current machine type, the recommended machine type, the location, and the last refresh date.\n## View insights and detailed recommendations\nYou can view insights and detailed recommendations about overprovisioned instances by using the Google Cloud console, `gcloud` , or the Recommender API.\nTo view insights and detailed recommendations about an overprovisioned instance by using the Google Cloud console, click the recommendation button in the list of instances.\nTo view insights and detailed recommendations about overprovisioned instances by using `gcloud` , run the [gcloud recommender insights list](/sdk/gcloud/reference/recommender/insights/list) command as follows:\n```\ngcloud recommender insights list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--insight-type=google.cloudsql.instance.INSIGHT_TYPE\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the insight type as`CpuUsageInsight`or`MemoryUsageInsight`, which provide insights about CPU usage and memory, respectively.\nTo view insights and detailed recommendations about overprovisioned instances by using the [Recommendations API](/recommender/docs/using-api) , call the [insights.list](/recommender/docs/reference/rest/v1beta1/projects.locations.insightTypes.insights/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/insightTypes/google.cloudsql.instance.INSIGHT_TYPE/insights\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the insight type as`CpuUsageInsight`. or`MemoryUsageInsight`, which provide insights about CPU usage and memory, respectively.\nA panel appears showing insights about the current memory and CPU utilization of the instance. The following categories of information are provided along with some supporting charts.\n| Fields     | Descriptions and related metrics               |\n|:-----------------------|:-----------------------------------------------------------------------------------------|\n| Max CPU utilization | The maximum CPU utilization as a percentage. Pertains to database/cpu/utilization.  |\n| Max memory utilization | The maximum memory utilization as a percentage. Pertains to database/memory/utilization. |\nThe following table lists the insights and recommendations that the Cloud SQL overprovisioned instance recommender might generate to help you reduce costs. The subtypes are visible in the `gcloud` and API results.\n| Insights                              | Recommendations                      |\n|:-------------------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------|\n| Based on the current CPU utilization trends, the instance is flagged as overprovisioned. Subtype: LOW_CPU_UTILIZATION   | Reduce the number of vCPUs or switch to a machine with fewer vCPUs. Subtype: CHANGE_INSTANCE_SIZE |\n| Based on the current memory utilization trends, the instance is flagged as overprovisioned. Subtype: LOW_MEMORY_UTILIZATION. | Reduce the memory requirement or switch to a machine with less memory. Subtype: CHANGE_INSTANCE_SIZE |\n## Apply recommendations\nEvaluate the recommendations carefully and do any of the following:\n- To examine the recommendation, click **View instance** .A banner appears at the top of the page providing a recommendation. [Edit](/sql/docs/postgres/edit-instance) the instance, if required, to reduce the vCPUs or memory. Alternatively, switch to a machine type with fewer vCPUs and less memory. You don't need to rightsize the instance exactly as recommended. Use your judgement about instance size based on how you intend to provision the instance. Keep in mind that the bigger the size, the greater the operational latency.\n- To dismiss the recommendation so that it's de-emphasized and appears dimmed, click **Dismiss** .\n- To close the panel without applying or dismissing the recommendation, click **Cancel** .\nYou can also [export these recommendations to BigQuery](/recommender/docs/bq-export/export-recommendations-to-bq) and then examine them using [Looker Studio](/bigquery/docs/visualize-looker-studio) or [Looker](/bigquery/docs/looker) .\n## What's next\n- [Monitor disk availability](/sql/docs/postgres/using-ood-recommender) \n- [Reduce idle Cloud SQL instances](/sql/docs/postgres/recommender-sql-idle) \n- [Blog: Maximize your Cloud ROI](https://cloud.google.com/blog/products/management-tools/active-assist-comes-to-google-cloud) \n- [Blog: Do more with less](https://cloud.google.com/blog/products/databases/reduce-cloud-sql-costs-with-optimizations-by-active-assist) \n- [Google Cloud recommenders](/recommender/docs/recommenders)", "guide": "Cloud SQL"}