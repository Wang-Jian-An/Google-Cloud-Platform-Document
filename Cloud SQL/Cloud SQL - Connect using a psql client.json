{"title": "Cloud SQL - Connect using a psql client", "url": "https://cloud.google.com/sql/docs/postgres/connect-admin-ip", "abstract": "# Cloud SQL - Connect using a psql client\nYou can use the PostgreSQL command-line client to connect to Cloud SQL. This page describes how to connect a [psql client](https://www.postgresql.org/docs/current/static/app-psql.html) to your Cloud SQL instance, whether running locally on your client machine, on a Compute Engine VM, or in the Cloud Shell.\n**Note:** On Windows, enter these commands before executing`psql`commands:`SET PGCLIENTENCODING=utf-8``chcp 65001`\n**Note:** For information about connecting a client to a Cloud SQL instance using the Cloud SQL Auth Proxy, see [Connect using the Cloud SQL Auth Proxy](/sql/docs/postgres/connect-auth-proxy) . For information about connecting using private IP, see [Configure private IP](/sql/docs/postgres/configure-private-ip) .\n", "content": "## Before you begin\nBefore you can use a `psql` client to connect to your Cloud SQL instance, do the following:\n- Create a Cloud SQL instance, including configuring the default  user.See [  Create instances](/sql/docs/postgres/create-instance) and [Set the  password for the default user account](/sql/docs/postgres/create-manage-users#user-root) .\n- Optionally, create a Compute Engine VM instance and then  connected to the instance using SSH.See [Create and  start a VM instance](/compute/docs/instances/create-start-instance) , [About SSH connections](/compute/docs/instances/ssh) ,   or [Connect to  Windows VMs using RDP](/compute/docs/instances/connecting-to-windows) .\n- Determine how you'll connect to your instance.For the connection options and how to choose from among them, see [About connection options](/sql/docs/postgres/connect-overview) .\n## Use a PostgreSQL client on a local machine or a Compute Engine\n VM\nUsing a `psql` client to connect to your Cloud SQL instance involves three high-level tasks:\n- [Install the client](#install-mysql-client) .\n- [Configure access to your Cloud SQL instance](#configure-instance-mysql) .\n- [Connect to your Cloud SQL instance](#connect) .\n### Install the client\nTo install the `psql` client, do the following:\nInstall the psql client from the package manager:\n```\nsudo apt-get updatesudo apt-get install postgresql-client\n```Install the psql client from the package manager:\n```\nsudo yum install postgresql\n```Install the psql client from the package manager:\n```\nsudo zypper install postgresql\n```\n- Download the PostgreSQL Core Distribution for your platform from the [PostgreSQL Downloads page](https://www.postgresql.org/download/) .The Core Distribution includes the psql client.\n- Install the PostgreSQL database, following the directions on the download page.\n### Configure access to your Cloud SQL\ninstance\nTo configure access to your instance, do the following:\n- From the client machine or Compute Engine VM instance, use [What's my IP](http://ipv4.whatismyv6.com) to see the IP address of the client machine.\n- Copy that IP address.\n- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- To open the **Overview** page of an instance, click the instance name.\n- Select **Connections** from the SQL navigation menu.\n- Select the **Networking** tab.\n- In the **Authorized networks** section, click **Add network** and enter the IP address of the machine where the client is installed. **Note:** The IP address of the instance and the`psql`client IP address you authorize must both be IPv4.\n- Click **Done** . Then click **Save** at the bottom of the page to save your changes.\n- Connect to your instance, either [using SSL/TLS](#connect-ssl) or [without encryption (without using SSL/TLS)](#connect) .\n### Connect to your Cloud SQL instance without\nencryption\n**Caution:** This procedure configures an unencrypted connection to your database. If your database contains sensitive data, then [connect to your instance using SSL/TLS](#connect-ssl) .\nTo let you connect without encryption, the instance must have [SSL mode](/sql/docs/postgres/configure-ssl-instance#enforcing-ssl) set to `ALLOW_UNENCRYPTED_AND_ENCRYPTED` . In the Google Cloud console, the equivalent configuration is **Allow unencrypted network traffic** .\nFor more information about the SSL/TLS configuration of your instance, see [Configure SSL/TLS certificates](/sql/docs/postgres/configure-ssl-instance) .\nTo connect to your instance, do the following:\n- Confirm that you have [installed the client](#install-mysql-client) and [configured access to your instance](#configure-instance-mysql) .\n- Start the`psql`client:```\npsql \"sslmode=disable dbname=postgres user=postgres hostaddr=INSTANCE_IP_ADDRESS\"\n```\n- Enter your password.\n- The psql prompt appears.\n### Connect to your Cloud SQL instance using SSL/TLS\n**Note** : If you are using IAM database authentication to log in to the instance, then use the procedure in [Log in using IAM database authentication](/sql/docs/postgres/iam-logins#logging-in-as-a-user) instead.\nTo connect to your instance using SSL/TLS and built-in authentication:\n- Start the`psql`client:```\npsql \"sslmode=require \\\u00a0 \u00a0 \u00a0 hostaddr=INSTANCE_IP_ADDRESS \\\u00a0 \u00a0 \u00a0 user=postgres dbname=DB_NAME\"\u00a0 \u00a0\n```For example:```\npsql \"sslmode=require \\\n  hostaddr=203.12.34.56 \\\n  user=postgres dbname=postgres\"\n \n```You might also want to create a Connection Service File to manage your  connection parameters, especially if you are connecting to more than one  instance. For more information, see the [ PostgreSQL documentation](https://www.postgresql.org/docs/current/static/libpq-pgservice.html) .\n- Enter the password. The password is mandatory for Cloud SQL even  though PostgreSQL supports passwordless connectivity while using SSL/TLS.\n- You can confirm that the connection is encrypted by looking for the cipher in the connection information:```\nSSL connection (cipher: ECDHE-RSA-AES128-GCM-SHA256, bits: 128)\n```If `ssl_mode` on your Cloud SQL instance is configured to `TRUSTED_CLIENT_CERTIFICATE_REQUIRED` , then you must also provide a verified client identity when you log in.\nTo connect using SSL/TLS certificates with client verification, you need the following:\n- A client public key certificate in a **client-cert.pem** file.\n- A client private key in a **client-key.pem** file.\nIn addition, to let the client verify the server's identity for mutual authentication, specify the server certificate **server-ca.pem** .\n`psql`\n```\n\u00a0 \u00a0psql \"sslmode=verify-ca sslrootcert=server-ca.pem \\\u00a0 \u00a0 \u00a0 sslcert=client-cert.pem sslkey=client-key.pem \\\u00a0 \u00a0 \u00a0 hostaddr=INSTANCE_IP_ADDRESS \\\u00a0 \u00a0 \u00a0 user=postgres dbname=DB_NAME\"\u00a0 \u00a0\n```\nIf you do not have a client certificate and a corresponding private key, then [create a new client certificate](/sql/docs/postgres/configure-ssl-instance#new-client) .\n## Using the client in the Cloud Shell\nTo connect to a Cloud SQL instance (public IP only):- Go to the Google Cloud console. [ Go to the Google Cloud console](https://console.cloud.google.com/) \n- Click the Cloud Shell icontowards the right in the toolbar.The Cloud Shell takes a few moments to initialize.\n- At the Cloud Shell prompt, use the built-in client to connect to your Cloud SQL instance:```\ngcloud sql connect INSTANCE_ID \\--user=postgres\n```\n- Enter your password.\nThe `gcloud sql connect` command does not support connecting  to a Cloud SQL instance using private IP, or using SSL/TLS. To connect  with encryption, install and use the proxy in the Cloud Shell:- [Install the proxy](/sql/docs/postgres/connect-auth-proxy#install-the-cloud-sql-proxy) (Linux 64-bit) in the`/home/USER`directory.\n- Start the proxy, using gcloud CLI authentication:```\n./cloud-sql-proxy INSTANCE_CONNECTION_NAME &\n```\n- Connect to the database by using the TCP connection:```\npsql -U USERNAME --host=127.0.0.1\n```## What's next- Learn about [ configuring an instance with a private IP address](/sql/docs/postgres/configure-private-ip) .\n- Learn about [ options for connecting to your instance from your application](/sql/docs/postgres/connect-overview#external-connection-methods) .\n- Learn about how the [psql client works with SSL](https://www.postgresql.org/docs/current/static/libpq-ssl.html) .", "guide": "Cloud SQL"}