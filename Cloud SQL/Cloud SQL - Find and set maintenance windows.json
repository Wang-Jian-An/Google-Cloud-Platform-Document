{"title": "Cloud SQL - Find and set maintenance windows", "url": "https://cloud.google.com/sql/docs/postgres/set-maintenance-window", "abstract": "# Cloud SQL - Find and set maintenance windows\nThis page has procedures for finding and setting maintenance windows for Cloud SQL instances. To learn more about how and why Cloud SQL performs maintenance, see the [Overview of maintenance on Cloud SQL instances](/sql/docs/postgres/maintenance) .\n", "content": "## Before you begin## Set a preferred window for maintenance on an instance\n- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- To open the **Overview** page of an instance, click the instance name.\n- In the **Maintenance** section, click **Edit maintenance preferences** .\n- In the **Configuration options** section, open **Maintenance** .\n- Configure the following options:- **Preferred window** . Set the day and hour range when updates can   occur on this instance.\n- **Order of update** . Set the order for updating this instance, in  relation to updates to other instances. Set the timing to **Any** , **Earlier** , or **Later** . Instances using the **Earlier** setting receive updates up to a week before instances using the **Later** setting, when comparing instances that reside in the same   location.Before using the gcloud command below, make the following replacements:- : Instance to reschedule\n- : Day when you want maintenance to occur. Set to one of`SUN`,`MON`,`TUE`,`WED`,`THU`,`FRI`,`SAT`.\n- : Hour of day for maintenance window, in UTC time zone  (0-23).\n```\ngcloud sql instances patch instance-id \\--maintenance-window-day=day \\--maintenance-window-hour=hour\u00a0 \u00a0 \n```\nFor reference information, see\n [gcloud sql instances patch](https://cloud.google.com/sdk/gcloud/reference/sql/instances/patch) \n.\nIf you make changes to your maintenance window setting while the instance is already undergoing maintenance or is scheduled for maintenance, then the changes don't take effect immediately. These changes are reflected in the future maintenance events.\nIf you've [opted in to maintenance notifications](/sql/docs/postgres/set-maintenance-window#opt-in) , then Cloud SQL sends you notifications after an instance has been scheduled for maintenance, with the exact date and time when the maintenance is scheduled to happen. Cloud SQL sends these notifications based on your instance's maintenance window order of update settings, as follows:\n- If the order of update setting is set to`Earlier`, then Cloud SQL sends maintenance notifications at least one week in advance.\n- If the order of update setting is set to`Later`, then Cloud SQL sends maintenance notifications at least two weeks in advance.## Opt in to maintenance notifications\nBefore you opt-in for maintenance notifications, you must [set a preferred window for maintenance on an instance](#set-maintenance)\n- Go to the **Communication** page. [Go to Communication](https://console.cloud.google.com/user-preferences/communication) \n- In the row for **Cloud SQL** , **Maintenance window** , select the radio button under **Email** to turn it **ON** .\nEach user that needs to receive notifications must opt in separately.\n## Find maintenance notifications in the Google Cloud console\nYou can view maintenance notifications in a few places in the Google Cloud console:\n- On the **ACTIVITY** dashboard, look for instances marked with **SQL Maintenance** .  [Go to Activity](https://console.cloud.google.com/home/activity) \n- When an instance is scheduled for maintenance, the date for maintenance is listed on the **Instances** page in the **Maintenance** column. The **Maintenance** column is usually hidden, but it displays automatically when maintenance is scheduled. You can also select **Maintenance** from the **Column display options** ( ) if you want the **Maintenance** column to always show up.\n- Alternatively, you can select an instance to go to the **Instance details** page. If the instance is scheduled for maintenance, you will see a message in the **Maintenance** pane.  [Go to Cloud SQL instances](https://console.cloud.google.com/sql/instances) ## Find scheduled maintenance windows using the API\nBefore using the `gcloud` command below, make the following  replacements- : The instance to reschedule\n```\ngcloud sql instances describe instance-id\u00a0 \u00a0 \n```\nLook for the `scheduledMaintenance` section in the response.Before using any of the request data, make the following replacements:- : the ID or [project number](/resource-manager/docs/creating-managing-projects#identifying_projects) of the Google Cloud project that contains the instance\n- : the name of the instance that you're configuring for high availability\nHTTP method and URL:\n```\nGET https://sqladmin.googleapis.com/v1/projects/PROJECT_ID/instances/INSTANCE_NAME\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#instance\",\n \"state\": \"RUNNABLE\",\n \"databaseVersion\": \"POSTGRES_13\"\n}\n```\nLook for the `scheduledMaintenance` section in the response.Before using any of the request data, make the following replacements:- : the ID or [project number](/resource-manager/docs/creating-managing-projects#identifying_projects) of the Google Cloud project that contains the instance\n- : the name of the instance that you're configuring for high availability\nHTTP method and URL:\n```\nGET https://sqladmin.googleapis.com/sql/v1beta4/projects/PROJECT_ID/instances/INSTANCE_NAME\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#instance\",\n \"state\": \"RUNNABLE\",\n \"databaseVersion\": \"POSTGRES_13\"\n}\n```\nLook for the `scheduledMaintenance` section in the response.\n## Reschedule planned maintenance\nYou may reschedule maintenance by using the Google Cloud console, `gcloud` , or the Cloud SQL Admin API.\n- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- Filter for the term **Maintenance** to list all instances scheduled for maintenance.\n- In the **Maintenance** column, click **Reschedule** .\n- In the **Reschedule** dialog, choose whether to apply maintenance  immediately, reschedule it to happen at a specific time within the 28 day deferral period, or defer to the next available maintenance window.\nBefore using the `gcloud` command below, make the following replacements:- : The instance to reschedule\n- : Use one of **IMMEDIATE** , **NEXT_AVAILABLE_WINDOW** , or **SPECIFIC_TIME** .If you choose **NEXT_AVAILABLE_WINDOW** , maintenance is rescheduled to the next available maintenance window following the current scheduled time.\n- : If you select **SPECIFIC_TIME** for, you also need to set this flag to specify the  new day and time for maintenance to occur. Uses ISO 8601 format. For  example, 2020-01-16T16:56:00.000Z\n```\ngcloud sql reschedule-maintenance instance-id \\--reschedule-type=reschedule-type \\[--schedule-time=reschedule-time]\u00a0 \n```\nFor reference information, see\n [gcloud sql reschedule-maintenance](https://cloud.google.com/sdk/gcloud/reference/sql/reschedule-maintenance) \n.\nIf you want to reschedule maintenance for up to 28 days, then check the version number of `gcloud` . If the version number is below `390.0.0_RC00` , then reinstall `gcloud` .Before using any of the request data, make the following replacements:- : The project ID\n- : The instance ID\n- : Use one of **IMMEDIATE** , **NEXT_AVAILABLE_WINDOW** , or **SPECIFIC_TIME** .If you choose **NEXT_AVAILABLE_WINDOW** , maintenance is rescheduled  to the next available maintenance window.\nHTTP method and URL:\n```\nPOST https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id/rescheduleMaintenance\n```\nRequest JSON body:\n```\n{\n \"reschedule\": {\n \"reschedule_type\": \"reschedule-type\"\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": RESCHEDULE_MAINTENANCE,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\nBefore using any of the request data, make the following replacements:- : The project ID\n- : The instance ID\n- : Use one of **IMMEDIATE** , **NEXT_AVAILABLE_WINDOW** , or **SPECIFIC_TIME** .If you choose **NEXT_AVAILABLE_WINDOW** , maintenance is rescheduled  to the next available maintenance window.\nHTTP method and URL:\n```\nPOST https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id/rescheduleMaintenance\n```\nRequest JSON body:\n```\n{\n \"reschedule\": {\n \"reschedule_type\": \"reschedule-type\"\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": RESCHEDULE_MAINTENANCE,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\nTo see how the [underlying REST API request](/sql/docs/postgres/admin-api/rest/v1beta4/instances/patch) is constructed for this task, see the [APIs Explorer on the instances:post page](/sql/docs/postgres/admin-api/rest/v1beta4/instances/patch) .\nNote: If you reschedule maintenance for an instance into an existing deny maintenance period, the deny maintenance period takes precedence and the maintenance event will be skipped.\n## Configure a deny maintenance period\nYou can configure a maximum of one deny maintenance period on a Cloud SQL instance at any given time. The deny maintenance period takes precedence over any scheduled maintenance window. If there's a conflict between the timing of a maintenance window and the deny maintenance period, the deny maintenance period overrides the maintenance window.\nYou can manually remove a deny maintenance period, whether it has already occurred or not.\nTo configure a deny maintenance period, set its start date, end date, and the time of day the interval begins and ends. A deny maintenance period can span from one to 90 days.\nFor start date and end date, there are two formats:\n- `yyyy-mm-dd`: indicates a specific date\n- `mm-dd`: indicates a date recurring every year\nThe start date and end date are UTC. To set the timezone, use the time field to adjust the start time. For example, the start date = 2020-10-10 and the time = 07:00:00 indicate the start time 2020-10-10 07:00:00 UTC (2020-10-10 00:00:00 PST)\nFor time, the format is: `HH:mm:SS` .\n- Hours are between 0 and 23 (inclusive).\n- Minutes and seconds are between 0 and 59 (inclusive).\n- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- To open the **Overview** page of an instance, click the instance name.\n- In the **Maintenance** section, click **Edit maintenance preferences** .\n- In the **Deny maintenance period** section, set the start and end dates.\n- In the **Advanced options** section, optionally select **Repeat every year** .\n- Click **Save** .\nBefore using the `gcloud` command below, make the following  replacements:- : Cloud SQL instance id\n- : Date when the interval begins. For example, 2021-11-29\n- : Date when the interval ends. For example, 2021-12-02\n- : Time of day for interval to start and end. For example,  00:00:00\n```\ngcloud sql instances patch instance-id\\\u00a0--deny-maintenance-period-start-date=start-date \\\u00a0--deny-maintenance-period-end-date=end-date \\\u00a0--deny-maintenance-period-time=time\n```Before using any of the request data, make the following replacements:- : The project ID\n- : The instance ID\n- : The start date (yyyy-mm-dd) or (mm-dd) for annual recurrence\n- : The end date (yyyy-mm-dd) or (mm-dd) for annual recurrence\n- : The start and end time (HH:mm:SS)\nHTTP method and URL:\n```\nPOST https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\n```\nRequest JSON body:\n```\n{\n \"settings\":\n {\n \"denyMaintenancePeriods\": [{\n  \"start_date\": \"start-date\",\n  \"end_date\": \"end-date\"\n  \"time\": \"time\"\n }]\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": MAINTENANCE_DENY_PERIOD,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\nBefore using any of the request data, make the following replacements:- : The project ID\n- : The instance ID\n- : The start date (yyyy-mm-dd) or (mm-dd) for annual recurrence\n- : The end date (yyyy-mm-dd) or (mm-dd) for annual recurrence\n- : The start and end time (HH:mm:SS)\nHTTP method and URL:\n```\nPOST https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\n```\nRequest JSON body:\n```\n{\n \"settings\":\n {\n \"denyMaintenancePeriods\": [{\n  \"start_date\": \"start-date\",\n  \"end_date\": \"end-date\"\n  \"time\": \"time\"\n }]\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": MAINTENANCE_DENY_PERIOD,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n## Remove a deny maintenance period\n- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- To open the **Overview** page of an instance, click the instance name.\n- In the **Maintenance** section, click **Edit maintenance preferences** .\n- In the **Deny maintenance period** section, click **Clear** .\n- Click **Save** .\nBefore using the `gcloud` command below, make the following replacements:- : Cloud SQL instance id\n```\ngcloud sql instances patch instance-id \\--remove-deny-maintenance-period\n```Before using any of the request data, make the following replacements:- : The project ID\n- : The instance ID\nHTTP method and URL:\n```\nPOST https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\n```\nRequest JSON body:\n```\n{\n \"settings\":\n {\n \"denyMaintenancePeriods\": []\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": MAINTENANCE_DENY_PERIOD,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\nBefore using any of the request data, make the following replacements:- : The project ID\n- : The instance ID\nHTTP method and URL:\n```\nPOST https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\n```\nRequest JSON body:\n```\n{\n \"settings\":\n {\n \"denyMaintenancePeriods\": []\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": MAINTENANCE_DENY_PERIOD,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n## Deny maintenance period notifications\nMaintenance Window notifications aren't sent when the planned maintenance time falls within the deny maintenance period and are forbidden by maintenance deny period settings.\nIf you change the deny maintenance period settings to prevent maintenance at a previously scheduled time, then the Cloud SQL instance skips maintenance and sends a notification about cancelling the maintenance. Cloud SQL sends this cancellation notice whenever the instance is scheduled for an update.\nNotifications of planned maintenance are sent during the deny maintenance period, as long as such maintenance is scheduled to occur outside of that period.\n## What's next\n- [Starting, stopping, and restarting instances](/sql/docs/postgres/start-stop-restart-instance) \n- [Learn more about deny maintenance periods](/sql/docs/postgres/maintenance#deny)", "guide": "Cloud SQL"}