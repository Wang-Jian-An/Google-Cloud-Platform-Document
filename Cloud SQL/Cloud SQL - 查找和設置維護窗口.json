{"title": "Cloud SQL - \u67e5\u627e\u548c\u8a2d\u7f6e\u7dad\u8b77\u7a97\u53e3", "url": "https://cloud.google.com/sql/docs/postgres/set-maintenance-window?hl=zh-cn", "abstract": "# Cloud SQL - \u67e5\u627e\u548c\u8a2d\u7f6e\u7dad\u8b77\u7a97\u53e3\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u67e5\u627e\u548c\u8a2d\u7f6e Cloud SQL \u5be6\u4f8b\u7684\u7dad\u8b77\u671f\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Cloud SQL \u7232\u4f55\u53ca\u5982\u4f55\u57f7\u884c\u7dad\u8b77\uff0c\u8acb\u53c3\u95b1 [Cloud SQL \u5be6\u4f8b\u7dad\u8b77\u6982\u89bd](https://cloud.google.com/sql/docs/postgres/maintenance?hl=zh-cn) \u3002\n", "content": "## \u6e96\u5099\u5de5\u4f5c\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them## \u7232\u5be6\u4f8b\u8a2d\u7f6e\u9996\u9078\u7dad\u8b77\u671f\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Cloud SQL \u5be6\u4f8b** \u9801\u9762\u3002 [\u8f49\u5230\u201cCloud SQL \u5be6\u4f8b\u201d](https://console.cloud.google.com/sql?hl=zh-cn) \n- \u5982\u9700\u6253\u958b\u5be6\u4f8b\u7684 **\u6982\u89bd** \u9801\u9762\uff0c\u8acb\u9ede\u64ca\u5be6\u4f8b\u540d\u7a31\u3002\n- \u5728 **\u7dad\u8b77** \u90e8\u5206\uff0c\u9ede\u64ca **\u4fee\u6539\u7dad\u8b77\u504f\u597d\u8a2d\u7f6e** \u3002\n- \u5728 **\u914d\u7f6e\u9078\u9805** \u90e8\u5206\uff0c\u6253\u958b **\u7dad\u8b77** \u3002\n- \u914d\u7f6e\u4ee5\u4e0b\u9078\u9805\uff1a\n- **\u9996\u9078\u6642\u6bb5** \u3002\u8a2d\u7f6e\u6b64\u5be6\u4f8b\u53ef\u4ee5\u9032\u884c\u66f4\u65b0\u7684\u65e5\u671f\u548c\u6642\u9593\u7bc4\u570d\u3002\n- **\u66f4\u65b0\u9806\u5e8f** \u3002\u8a2d\u7f6e\u6b64\u5be6\u4f8b\u76f8\u5c0d\u65bc\u5176\u4ed6\u5be6\u4f8b\u7684\u66f4\u65b0\u9806\u5e8f\u3002\u8acb\u5c07\u6642\u9593\u5b89\u6392\u8a2d\u7f6e\u7232 **\u4efb\u610f** \u3001 **\u8f03\u65e9** \u6216 **\u665a\u4e9b\u6642\u5019** \u3002\u4f7f\u7528 **\u8f03\u65e9** \u8a2d\u7f6e\u7684\u5be6\u4f8b\u8981\u6bd4\u4f7f\u7528 **\u665a\u4e9b\u6642\u5019** \u8a2d\u7f6e\u7684\u5be6\u4f8b\u63d0\u524d\u9577\u9054\u4e00\u9031\u7684\u6642\u9593\u6536\u5230\u66f4\u65b0\uff0c\u4f46\u524d\u63d0\u662f\u6240\u6bd4\u8f03\u7684\u5be6\u4f8b\u5747\u4f4d\u65bc\u540c\u4e00\u4f4d\u7f6e\u3002\u5728\u4f7f\u7528\u4e0b\u9762\u7684 gcloud \u547d\u4ee4\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u8981\u91cd\u65b0\u5b89\u6392\u7684\u5be6\u4f8b\n- \uff1a\u6240\u9700\u7684\u7dad\u8b77\u65e5\u671f\u3002\u8acb\u8a2d\u7f6e\u7232`SUN`\u3001`MON`\u3001`TUE`\u3001`WED`\u3001`THU`\u3001`FRI`\u3001`SAT`\u4e4b\u4e00\u3002\n- \uff1a\u4ee5\u4e16\u754c\u5354\u8abf\u6642\u9593 (UTC) \u6642\u5340 (0-23) \u8868\u793a\u7684\u7dad\u8b77\u671f\u6642\u9593\u3002\n```\ngcloud sql instances patch instance-id \\--maintenance-window-day=day \\--maintenance-window-hour=hour\u00a0 \u00a0 \n```\n\u5982\u9700\u77ad\u89e3\u53c3\u8003\u4fe1\u606f\uff0c\u8acb\u53c3\u95b1\n [gcloud sql instances patch](https://cloud.google.com/sdk/gcloud/reference/sql/instances/patch?hl=zh-cn) \n\u3002\n\u5982\u679c\u60a8\u5728\u5be6\u4f8b\u6b63\u5728\u7dad\u8b77\u6216\u5df2\u5b89\u6392\u7dad\u8b77\u6642\u66f4\u6539\u7dad\u8b77\u7a97\u53e3\u8a2d\u7f6e\uff0c\u5247\u66f4\u6539\u4e0d\u6703\u7acb\u5373\u751f\u6548\u3002\u9019\u4e9b\u66f4\u6539\u6703\u53cd\u6620\u5728\u672a\u4f86\u7684\u7dad\u8b77\u4e8b\u4ef6\u4e2d\u3002\n\u5982\u679c\u60a8\u5df2 [\u9078\u64c7\u63a5\u6536\u7dad\u8b77\u901a\u77e5](https://cloud.google.com/sql/docs/postgres/set-maintenance-window?hl=zh-cn#opt-in) \uff0c\u5247 Cloud SQL \u6703\u5728\u5be6\u4f8b\u5b89\u6392\u7dad\u8b77\u5f8c\u5411\u60a8\u767c\u9001\u901a\u77e5\uff0c\u5176\u4e2d\u5305\u542b\u5b89\u6392\u7dad\u8b77\u7684\u78ba\u5207\u65e5\u671f\u548c\u6642\u9593\u3002Cloud SQL \u6703\u6839\u64da\u5be6\u4f8b\u7684\u66f4\u65b0\u7dad\u8b77\u7a97\u53e3\u9806\u5e8f\u8a2d\u7f6e\u767c\u9001\u9019\u4e9b\u901a\u77e5\uff0c\u5982\u4e0b\u6240\u793a\uff1a\n- \u5982\u679c\u66f4\u65b0\u9806\u5e8f\u8a2d\u7f6e\u8a2d\u5b9a\u7232`Earlier`\uff0c\u5247 Cloud SQL \u6703\u81f3\u5c11\u63d0\u524d\u4e00\u9031\u767c\u9001\u7dad\u8b77\u901a\u77e5\u3002\n- \u5982\u679c\u66f4\u65b0\u9806\u5e8f\u8a2d\u7f6e\u8a2d\u5b9a\u7232`Later`\uff0c\u5247 Cloud SQL \u6703\u81f3\u5c11\u63d0\u524d\u5169\u9031\u767c\u9001\u7dad\u8b77\u901a\u77e5\u3002## \u9078\u64c7\u63a5\u6536\u7dad\u8b77\u901a\u77e5\n\u5728\u9078\u64c7\u63a5\u6536\u7dad\u8b77\u901a\u77e5\u4e4b\u524d\uff0c\u60a8\u5fc5\u9808 [\u7232\u5be6\u4f8b\u8a2d\u7f6e\u9996\u9078\u7dad\u8b77\u7a97\u53e3](#set-maintenance)\n- \u9032\u5165 **\u901a\u4fe1** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u901a\u4fe1\u201d](https://console.cloud.google.com/user-preferences/communication?hl=zh-cn) \n- \u5728 **Cloud SQL** **\u7dad\u8b77\u7a97\u53e3** \u6240\u5c0d\u61c9\u7684\u884c\u4e2d\uff0c\u9078\u64c7 **\u96fb\u5b50\u90f5\u4ef6** \u4e0b\u65b9\u7684\u55ae\u9078\u6309\u9215\u4ee5 **\u958b\u5553** \u96fb\u5b50\u90f5\u4ef6\u529f\u80fd\u3002\n\u6bcf\u500b\u9700\u8981\u63a5\u6536\u901a\u77e5\u7684\u7528\u6236\u5fc5\u9808\u5206\u5225\u9078\u64c7\u63a5\u6536\u901a\u77e5\u3002\n## \u5728 Google Cloud Console \u4e2d\u67e5\u627e\u7dad\u8b77\u901a\u77e5\n\u60a8\u53ef\u4ee5\u5728 Google Cloud Console \u7684\u4ee5\u4e0b\u5e7e\u500b\u4f4d\u7f6e\u67e5\u770b\u7dad\u8b77\u901a\u77e5\uff1a\n- \u5728 **\u6d3b\u52d5** \u4fe1\u606f\u4e2d\u5fc3\u5167\uff0c\u67e5\u627e\u6a19\u6709 **SQL \u7dad\u8b77** \u7684\u5be6\u4f8b\u3002  [\u8f49\u5230\u201c\u6d3b\u52d5\u201d](https://console.cloud.google.com/home/activity?hl=zh-cn) \n- \u5982\u679c\u5be6\u4f8b\u5df2\u5b89\u6392\u7dad\u8b77\uff0c\u5247\u7dad\u8b77\u65e5\u671f\u6703\u5217\u5728 **\u5be6\u4f8b** \u9801\u9762\u7684 **\u7dad\u8b77** \u5217\u4e2d\u3002 **\u7dad\u8b77** \u5217\u901a\u5e38\u8655\u65bc\u96b1\u85cf\u72c0\u614b\uff0c\u4f46\u6703\u5728\u5b89\u6392\u7dad\u8b77\u5f8c\u81ea\u52d5\u986f\u793a\u51fa\u4f86\u3002\u5982\u679c\u60a8\u5e0c\u671b **\u7dad\u8b77** \u5217\u59cb\u7d42\u8655\u65bc\u986f\u793a\u72c0\u614b\uff0c\u4e5f\u53ef\u4ee5\u5f9e **\u5217\u986f\u793a\u9078\u9805** ( ) \u4e2d\u9078\u64c7 **\u7dad\u8b77** \u3002\n- \u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u9078\u64c7\u5be6\u4f8b\u4ee5\u8f49\u5230 **\u5be6\u4f8b\u8a73\u60c5** \u9801\u9762\u3002\u5982\u679c\u5be6\u4f8b\u5df2\u5b89\u6392\u7dad\u8b77\uff0c\u60a8\u6703\u5728 **\u7dad\u8b77** \u7a97\u683c\u4e2d\u770b\u5230\u4e00\u689d\u6d88\u606f\u3002  [\u8f49\u5230\u201cCloud SQL \u5be6\u4f8b\u201d](https://console.cloud.google.com/sql/instances?hl=zh-cn) ## \u4f7f\u7528 API \u67e5\u627e\u8a08\u5283\u7dad\u8b77\u671f\n\u5728\u4f7f\u7528\u4e0b\u9762\u7684 `gcloud` \u547d\u4ee4\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u8981\u91cd\u65b0\u5b89\u6392\u7684\u5be6\u4f8b\n```\ngcloud sql instances describe instance-id\u00a0 \u00a0 \n```\n\u5728\u97ff\u61c9\u4e2d\u67e5\u627e `scheduledMaintenance` \u90e8\u5206\u3002\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5305\u542b\u5be6\u4f8b\u7684 Google Cloud \u9805\u76ee\u7684 ID \u6216 [\u9805\u76ee\u7de8\u865f](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifying_projects) \n- \uff1a\u60a8\u7232\u5be6\u73fe\u9ad8\u53ef\u7528\u6027\u800c\u914d\u7f6e\u7684\u5be6\u4f8b\u7684\u540d\u7a31\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://sqladmin.googleapis.com/v1/projects/PROJECT_ID/instances/INSTANCE_NAME\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"kind\": \"sql#instance\",\n \"state\": \"RUNNABLE\",\n \"databaseVersion\": \"POSTGRES_13\"\n}\n```\n\u5728\u97ff\u61c9\u4e2d\u67e5\u627e `scheduledMaintenance` \u90e8\u5206\u3002\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5305\u542b\u5be6\u4f8b\u7684 Google Cloud \u9805\u76ee\u7684 ID \u6216 [\u9805\u76ee\u7de8\u865f](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifying_projects) \n- \uff1a\u60a8\u7232\u5be6\u73fe\u9ad8\u53ef\u7528\u6027\u800c\u914d\u7f6e\u7684\u5be6\u4f8b\u7684\u540d\u7a31\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://sqladmin.googleapis.com/sql/v1beta4/projects/PROJECT_ID/instances/INSTANCE_NAME\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"kind\": \"sql#instance\",\n \"state\": \"RUNNABLE\",\n \"databaseVersion\": \"POSTGRES_13\"\n}\n```\n\u5728\u97ff\u61c9\u4e2d\u67e5\u627e `scheduledMaintenance` \u90e8\u5206\u3002\n## \u91cd\u65b0\u5b89\u6392\u8a08\u5283\u5167\u7dad\u8b77\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u3001 `gcloud` \u6216 Cloud SQL Admin API \u91cd\u65b0\u5b89\u6392\u7dad\u8b77\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Cloud SQL \u5be6\u4f8b** \u9801\u9762\u3002 [\u8f49\u5230\u201cCloud SQL \u5be6\u4f8b\u201d](https://console.cloud.google.com/sql?hl=zh-cn) \n- \u91dd\u5c0d **\u7dad\u8b77** \u4e00\u8a5e\u9032\u884c\u904e\u6ffe\uff0c\u4ee5\u5217\u51fa\u6240\u6709\u5df2\u5b89\u6392\u7dad\u8b77\u7684\u5be6\u4f8b\u3002\n- \u5728 **\u7dad\u8b77** \u5217\u4e2d\uff0c\u9ede\u64ca **\u91cd\u65b0\u5b89\u6392** \u3002\n- \u5728 **\u91cd\u65b0\u5b89\u6392** \u5c0d\u8a71\u6846\u4e2d\uff0c\u9078\u64c7\u662f\u7acb\u5373\u61c9\u7528\u7dad\u8b77\u3001\u5c07\u7dad\u8b77\u91cd\u65b0\u5b89\u6392\u5728 28 \u5929\u5ef6\u9072\u671f\u5167\u7684\u7279\u5b9a\u6642\u9593\uff0c\u9084\u662f\u63a8\u9072\u5230\u4e0b\u4e00\u500b\u53ef\u7528\u7dad\u8b77\u7a97\u53e3\u3002\n\u5728\u4f7f\u7528\u4e0b\u9762\u7684 `gcloud` \u547d\u4ee4\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u8981\u91cd\u65b0\u5b89\u6392\u7684\u5be6\u4f8b\n- \uff1a\u4f7f\u7528 **IMMEDIATE** \u3001 **NEXT_AVAILABLE_WINDOW** \u6216 **SPECIFIC_TIME** \u4e4b\u4e00\u3002\u5982\u679c\u60a8\u9078\u64c7 **NEXT_AVAILABLE_WINDOW** \uff0c\u5247\u7dad\u8b77\u5c07\u88ab\u91cd\u65b0\u5b89\u6392\u5230\u7576\u524d\u8a08\u5283\u6642\u9593\u4e4b\u5f8c\u7684\u4e0b\u4e00\u500b\u53ef\u7528\u7dad\u8b77\u7a97\u53e3\u3002\n- \uff1a\u5982\u679c\u9078\u64c7 **SPECIFIC_TIME** \u4f5c\u7232\uff0c\u60a8\u9084\u9700\u8981\u8a2d\u7f6e\u6b64\u6a19\u8a8c\u4f86\u6307\u5b9a\u65b0\u7684\u7dad\u8b77\u65e5\u671f\u548c\u6642\u9593\u3002\u8a72\u503c\u63a1\u7528 ISO 8601 \u683c\u5f0f\uff0c\u4f8b\u5982 2020-01-16T16:56:00.000Z\u3002\n```\ngcloud sql reschedule-maintenance instance-id \\--reschedule-type=reschedule-type \\[--schedule-time=reschedule-time]\u00a0 \n```\n\u5982\u9700\u77ad\u89e3\u53c3\u8003\u4fe1\u606f\uff0c\u8acb\u53c3\u95b1\n [gcloud sql reschedule-maintenance](https://cloud.google.com/sdk/gcloud/reference/sql/reschedule-maintenance?hl=zh-cn) \n\u3002\n\u5982\u679c\u60a8\u8981\u91cd\u65b0\u5b89\u6392\u7dad\u8b77\uff0c\u4f7f\u5176\u9577\u9054 28 \u5929\uff0c\u8acb\u6aa2\u67e5 `gcloud` \u7684\u7248\u672c\u865f\u3002\u5982\u679c\u7248\u672c\u865f\u4f4e\u65bc `390.0.0_RC00` \uff0c\u8acb\u91cd\u65b0\u5b89\u88dd `gcloud` \u3002\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u9805\u76ee ID\n- \uff1a\u5be6\u4f8b ID\n- \uff1a\u4f7f\u7528 **IMMEDIATE** \u3001 **NEXT_AVAILABLE_WINDOW** \u6216 **SPECIFIC_TIME** \u4e4b\u4e00\u3002\u5982\u679c\u60a8\u9078\u64c7 **NEXT_AVAILABLE_WINDOW** \uff0c\u5247\u7dad\u8b77\u6703\u88ab\u91cd\u65b0\u5b89\u6392\u5230\u4e0b\u4e00\u500b\u53ef\u7528\u7684\u7dad\u8b77\u7a97\u53e3\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id/rescheduleMaintenance\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"reschedule\": {\n \"reschedule_type\": \"reschedule-type\"\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": RESCHEDULE_MAINTENANCE,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u9805\u76ee ID\n- \uff1a\u5be6\u4f8b ID\n- \uff1a\u4f7f\u7528 **IMMEDIATE** \u3001 **NEXT_AVAILABLE_WINDOW** \u6216 **SPECIFIC_TIME** \u4e4b\u4e00\u3002\u5982\u679c\u60a8\u9078\u64c7 **NEXT_AVAILABLE_WINDOW** \uff0c\u5247\u7dad\u8b77\u6703\u88ab\u91cd\u65b0\u5b89\u6392\u5230\u4e0b\u4e00\u500b\u53ef\u7528\u7684\u7dad\u8b77\u7a97\u53e3\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id/rescheduleMaintenance\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"reschedule\": {\n \"reschedule_type\": \"reschedule-type\"\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": RESCHEDULE_MAINTENANCE,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u7232\u6b64\u4efb\u52d9\u69cb\u5efa [\u5e95\u5c64 REST API \u8acb\u6c42](https://cloud.google.com/sql/docs/postgres/admin-api/rest/v1beta4/instances/patch?hl=zh-cn) \uff0c\u8acb\u53c3\u95b1 [instances:post \u9801\u9762\u4e0a\u7684 APIs Explorer](https://cloud.google.com/sql/docs/postgres/admin-api/rest/v1beta4/instances/patch?hl=zh-cn) \u3002\n\u6ce8\u610f\uff1a\u5982\u679c\u60a8\u5c07\u5be6\u4f8b\u7684\u7dad\u8b77\u91cd\u65b0\u5b89\u6392\u5230\u73fe\u6709\u7684\u62d2\u7d55\u7dad\u8b77\u671f\uff0c\u5247\u7cfb\u7d71\u6703\u512a\u5148\u9075\u5faa\u62d2\u7d55\u7dad\u8b77\u671f\u8a2d\u7f6e\uff0c\u4e26\u8df3\u904e\u7dad\u8b77\u4e8b\u4ef6\u3002\n## \u914d\u7f6e\u62d2\u7d55\u7dad\u8b77\u671f\n\u5728\u4efb\u4f55\u7d66\u5b9a\u6642\u9593\uff0c\u60a8\u6700\u591a\u53ef\u4ee5\u5728\u4e00\u500b Cloud SQL \u5be6\u4f8b\u4e0a\u914d\u7f6e\u4e00\u500b\u62d2\u7d55\u7dad\u8b77\u671f\u3002\u62d2\u7d55\u7dad\u8b77\u671f\u512a\u5148\u65bc\u4efb\u4f55\u8a08\u5283\u7684\u7dad\u8b77\u671f\u3002\u5982\u679c\u67d0\u7dad\u8b77\u671f\u6642\u9593\u8207\u62d2\u7d55\u7dad\u8b77\u671f\u4e4b\u9593\u5b58\u5728\u885d\u7a81\uff0c\u5247\u62d2\u7d55\u7dad\u8b77\u671f\u6703\u8986\u84cb\u8a72\u7dad\u8b77\u671f\u3002\n\u60a8\u53ef\u4ee5\u624b\u52d5\u79fb\u9664\u62d2\u7d55\u7dad\u8b77\u671f\uff0c\u7121\u8ad6\u5b83\u662f\u5426\u5df2\u7d93\u51fa\u73fe\u3002\n\u5982\u8981\u914d\u7f6e\u62d2\u7d55\u7dad\u8b77\u671f\uff0c\u8acb\u8a2d\u7f6e\u958b\u59cb\u65e5\u671f\u3001\u7d50\u675f\u65e5\u671f\u4ee5\u53ca\u9593\u9694\u7684\u958b\u59cb\u548c\u7d50\u675f\u6642\u9593\u3002\u62d2\u7d55\u7dad\u8b77\u671f\u53ef\u80fd\u5f9e 1 \u5929\u5230 90 \u5929\u4e0d\u7b49\u3002\n\u958b\u59cb\u65e5\u671f\u548c\u7d50\u675f\u65e5\u671f\u6709\u5169\u7a2e\u683c\u5f0f\uff1a\n- `yyyy-mm-dd`\uff1a\u8868\u793a\u7279\u5b9a\u65e5\u671f\n- `mm-dd`\uff1a\u8868\u793a\u6bcf\u5e74\u91cd\u8907\u7684\u65e5\u671f\n\u958b\u59cb\u65e5\u671f\u548c\u7d50\u675f\u65e5\u671f\u5747\u7232\u4e16\u754c\u5354\u8abf\u6642\u9593 (UTC)\u3002\u5982\u9700\u8a2d\u7f6e\u6642\u5340\uff0c\u8acb\u4f7f\u7528\u6642\u9593\u5b57\u6bb5\u4f86\u8abf\u6574\u958b\u59cb\u6642\u9593\u3002\u4f8b\u5982\uff0c\u958b\u59cb\u65e5\u671f = 2020-10-10\uff0c\u6642\u9593 = 07:00:00 \u8868\u793a\u958b\u59cb\u6642\u9593\u7232\u4e16\u754c\u5354\u8abf\u6642\u9593 (UTC) 2020-10-10 07:00:00 (2020-10-10 00:00:00 PST)\n\u5c0d\u65bc\u6642\u9593\uff0c\u683c\u5f0f\u7232 `HH:mm:SS` \u3002\n- \u5c0f\u6642\u4ecb\u65bc 0 \u5230 23 \u4e4b\u9593\uff08\u542b 0 \u548c 23\uff09\u3002\n- \u5206\u9418\u548c\u79d2\u4ecb\u65bc 0 \u5230 59\uff08\u5305\u542b 0 \u5230 59\uff09\u4e4b\u9593\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Cloud SQL \u5be6\u4f8b** \u9801\u9762\u3002 [\u8f49\u5230\u201cCloud SQL \u5be6\u4f8b\u201d](https://console.cloud.google.com/sql?hl=zh-cn) \n- \u5982\u9700\u6253\u958b\u5be6\u4f8b\u7684 **\u6982\u89bd** \u9801\u9762\uff0c\u8acb\u9ede\u64ca\u5be6\u4f8b\u540d\u7a31\u3002\n- \u5728 **\u7dad\u8b77** \u90e8\u5206\uff0c\u9ede\u64ca **\u4fee\u6539\u7dad\u8b77\u504f\u597d\u8a2d\u7f6e** \u3002\n- \u5728 **\u62d2\u7d55\u7dad\u8b77\u671f** \u90e8\u5206\u4e2d\uff0c\u8a2d\u7f6e\u958b\u59cb\u65e5\u671f\u548c\u7d50\u675f\u65e5\u671f\u3002\n- \u5728 **\u9ad8\u7d1a\u9078\u9805** \u90e8\u5206\u4e2d\uff0c\u9078\u64c7 **\u6bcf\u5e74\u91cd\u8907** \u3002\n- \u9ede\u64ca **\u4fdd\u5b58** \u3002\n\u5728\u4f7f\u7528\u4e0b\u9762\u7684 `gcloud` \u547d\u4ee4\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1aCloud SQL \u5be6\u4f8b ID\n- \uff1a\u9593\u9694\u958b\u59cb\u7684\u65e5\u671f\u3002\u4f8b\u5982\uff1a2021-11-29\n- \uff1a\u9593\u9694\u7d50\u675f\u7684\u65e5\u671f\u3002\u4f8b\u5982\uff1a2021-12-02\n- \uff1a\u9593\u9694\u958b\u59cb\u548c\u7d50\u675f\u7684\u5177\u9ad4\u6642\u9593\u3002\u4f8b\u5982\uff1a00:00:00\n```\ngcloud sql instances patch instance-id\\\u00a0--deny-maintenance-period-start-date=start-date \\\u00a0--deny-maintenance-period-end-date=end-date \\\u00a0--deny-maintenance-period-time=time\n```\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u9805\u76ee ID\n- \uff1a\u5be6\u4f8b ID\n- \uff1a\u958b\u59cb\u65e5\u671f (yyyy-mm-dd) \u6216 (mm-dd)\uff08\u5c0d\u65bc\u6bcf\u5e74\u5b9a\u671f\u91cd\u8907\u7684\u60c5\u6cc1\uff09\n- \uff1a\u7d50\u675f\u65e5\u671f (yyyy-mm-dd) \u6216 (mm-dd)\uff08\u5c0d\u65bc\u6bcf\u5e74\u5b9a\u671f\u91cd\u8907\u7684\u60c5\u6cc1\uff09\n- \uff1a\u958b\u59cb\u6642\u9593\u548c\u7d50\u675f\u6642\u9593 (HH:mm:SS)\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"settings\":\n {\n \"denyMaintenancePeriods\": [{\n  \"start_date\": \"start-date\",\n  \"end_date\": \"end-date\"\n  \"time\": \"time\"\n }]\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": MAINTENANCE_DENY_PERIOD,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u9805\u76ee ID\n- \uff1a\u5be6\u4f8b ID\n- \uff1a\u958b\u59cb\u65e5\u671f (yyyy-mm-dd) \u6216 (mm-dd)\uff08\u5c0d\u65bc\u6bcf\u5e74\u5b9a\u671f\u91cd\u8907\u7684\u60c5\u6cc1\uff09\n- \uff1a\u7d50\u675f\u65e5\u671f (yyyy-mm-dd) \u6216 (mm-dd)\uff08\u5c0d\u65bc\u6bcf\u5e74\u5b9a\u671f\u91cd\u8907\u7684\u60c5\u6cc1\uff09\n- \uff1a\u958b\u59cb\u6642\u9593\u548c\u7d50\u675f\u6642\u9593 (HH:mm:SS)\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"settings\":\n {\n \"denyMaintenancePeriods\": [{\n  \"start_date\": \"start-date\",\n  \"end_date\": \"end-date\"\n  \"time\": \"time\"\n }]\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": MAINTENANCE_DENY_PERIOD,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n## \u79fb\u9664\u62d2\u7d55\u7dad\u8b77\u671f\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Cloud SQL \u5be6\u4f8b** \u9801\u9762\u3002 [\u8f49\u5230\u201cCloud SQL \u5be6\u4f8b\u201d](https://console.cloud.google.com/sql?hl=zh-cn) \n- \u5982\u9700\u6253\u958b\u5be6\u4f8b\u7684 **\u6982\u89bd** \u9801\u9762\uff0c\u8acb\u9ede\u64ca\u5be6\u4f8b\u540d\u7a31\u3002\n- \u5728 **\u7dad\u8b77** \u90e8\u5206\uff0c\u9ede\u64ca **\u4fee\u6539\u7dad\u8b77\u504f\u597d\u8a2d\u7f6e** \u3002\n- \u5728 **\u62d2\u7d55\u7dad\u8b77\u671f** \u90e8\u5206\uff0c\u9ede\u64ca **\u6e05\u9664** \u3002\n- \u9ede\u64ca **\u4fdd\u5b58** \u3002\n\u5728\u4f7f\u7528\u4e0b\u9762\u7684 `gcloud` \u547d\u4ee4\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1aCloud SQL \u5be6\u4f8b ID\n```\ngcloud sql instances patch instance-id \\--remove-deny-maintenance-period\n```\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u9805\u76ee ID\n- \uff1a\u5be6\u4f8b ID\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"settings\":\n {\n \"denyMaintenancePeriods\": []\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": MAINTENANCE_DENY_PERIOD,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/v1/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u9805\u76ee ID\n- \uff1a\u5be6\u4f8b ID\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"settings\":\n {\n \"denyMaintenancePeriods\": []\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"kind\": \"sql#operation\",\n \"targetLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/instances/instance-id\",\n \"status\": \"PENDING\",\n \"user\": \"user@example.com\",\n \"insertTime\": \"2020-01-16T02:32:12.281Z\",\n \"startTime\": \"08:00\",\n \"endTime\": \"08:01\",\n \"operationType\": MAINTENANCE_DENY_PERIOD,\n \"name\": \"operation-id\",\n \"targetId\": \"instance-id\",\n \"selfLink\": \"https://sqladmin.googleapis.com/sql/v1beta4/projects/project-id/operations/operation-id\",\n \"targetProject\": \"project-id\"\n}\n```\n## \u62d2\u7d55\u7dad\u8b77\u671f\u901a\u77e5\n\u7576\u8a08\u5283\u5167\u7dad\u8b77\u6642\u9593\u5728\u62d2\u7d55\u7dad\u8b77\u671f\u5167\u4e14\u7dad\u8b77\u62d2\u7d55\u671f\u8a2d\u7f6e\u7981\u6b62\u8a72\u7dad\u8b77\u671f\u901a\u77e5\uff0c\u5247\u4e0d\u6703\u767c\u9001\u7dad\u8b77\u671f\u901a\u77e5\u3002\n\u5982\u679c\u60a8\u66f4\u6539\u62d2\u7d55\u7dad\u8b77\u671f\u8a2d\u7f6e\u4ee5\u963b\u6b62\u5728\u5148\u524d\u8a08\u5283\u7684\u6642\u9593\u9032\u884c\u7dad\u8b77\uff0c\u5247 Cloud SQL \u5be6\u4f8b\u6703\u8df3\u904e\u7dad\u8b77\u4f75\u767c\u9001\u6709\u95dc\u53d6\u6d88\u7dad\u8b77\u7684\u901a\u77e5\u3002\u6bcf\u7576\u7232\u8a72\u5be6\u4f8b\u5b89\u6392\u66f4\u65b0\u6642\uff0cCloud SQL \u90fd\u6703\u767c\u9001\u6b64\u53d6\u6d88\u901a\u77e5\u3002\n\u8a08\u5283\u5167\u7dad\u8b77\u901a\u77e5\u5c07\u5728\u62d2\u7d55\u7dad\u8b77\u671f\u9593\u767c\u9001\uff0c\u524d\u63d0\u662f\u5c07\u7dad\u8b77\u5b89\u6392\u5728\u8a72\u6642\u9593\u6bb5\u4e4b\u5916\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [\u5553\u52d5\u3001\u505c\u6b62\u548c\u91cd\u5553\u5be6\u4f8b](https://cloud.google.com/sql/docs/postgres/start-stop-restart-instance?hl=zh-cn) \n- [\u8a73\u7d30\u77ad\u89e3\u62d2\u7d55\u7dad\u8b77\u671f](https://cloud.google.com/sql/docs/postgres/maintenance?hl=zh-cn#deny)", "guide": "Cloud SQL"}