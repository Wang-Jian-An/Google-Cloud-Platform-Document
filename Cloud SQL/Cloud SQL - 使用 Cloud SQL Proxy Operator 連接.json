{"title": "Cloud SQL - \u4f7f\u7528 Cloud SQL Proxy Operator \u9023\u63a5", "url": "https://cloud.google.com/sql/docs/postgres/connect-proxy-operator?hl=zh-cn", "abstract": "# Cloud SQL - \u4f7f\u7528 Cloud SQL Proxy Operator \u9023\u63a5\n\u672c\u9801\u9762\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528 Cloud SQL Proxy Operator \u9023\u63a5\u5230 Cloud SQL \u5be6\u4f8b\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Cloud SQL Proxy Operator \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u8acb\u53c3\u95b1 [Cloud SQL Proxy Operator \u7c21\u4ecb](https://cloud.google.com/sql/docs/postgres/sql-proxy?hl=zh-cn#proxy-operator) \u3002\n", "content": "## \u6982\u89bd\nCloud SQL Proxy Operator \u914d\u7f6e\u90e8\u7f72\u5728 Google Kubernetes Engine (GKE) \u4e0a\u7684\u61c9\u7528\uff0c\u4ee5\u4f7f\u7528 Cloud SQL Auth \u4ee3\u7406\u9023\u63a5\u5230 Cloud SQL \u6578\u64da\u5eab\u5be6\u4f8b\u3002\u5982\u9700\u9023\u63a5\u5230 Cloud SQL \u5be6\u4f8b\uff0c\u5efa\u8b70\u4f7f\u7528\u65b9\u6cd5 [Cloud SQL Auth \u4ee3\u7406](https://cloud.google.com/sql/docs/postgres/sql-proxy?hl=zh-cn) \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Cloud SQL Auth \u4ee3\u7406\uff0c\u8acb\u53c3\u95b1 [Cloud SQL Auth \u4ee3\u7406\u7c21\u4ecb](https://cloud.google.com/sql/docs/postgres/sql-proxy?hl=zh-cn) \u3002\n\u5728 GKE \u4e2d\u904b\u884c\u7684\u61c9\u7528\u53ef\u4ee5 [\u4f7f\u7528 Cloud SQL Auth \u4ee3\u7406\u9032\u884c\u9023\u63a5](https://cloud.google.com/sql/docs/postgres/connect-kubernetes-engine?hl=zh-cn#proxy) \u3002\n## \u9808\u77e5\u4e8b\u9805\n\u5728\u9023\u63a5\u5230 Cloud SQL \u5be6\u4f8b\u4e4b\u524d\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5c0d\u65bc\u7528\u6236\u6216\u670d\u52d9\u8cec\u865f\uff0c\u8acb\u78ba\u4fdd\u8a72\u8cec\u865f\u5177\u6709 Cloud SQL Client \u89d2\u8272\u3002\u6b64\u89d2\u8272\u5305\u542b `cloudsql.instances.connect` \u6b0a\u9650\uff0c\u6b64\u6b0a\u9650\u5411\u4e3b\u8cec\u865f\u6388\u4e88\u9023\u63a5\u5230\u9805\u76ee\u4e2d\u7684\u6240\u6709 Cloud SQL \u5be6\u4f8b\u7684\u6b0a\u9650\u3002 [   \u8f49\u5230 IAM \u9801\u9762](https://console.cloud.google.com/iam-admin/iam?hl=zh-cn) \u60a8\u53ef\u4ee5\u9078\u64c7\u5728 IAM \u653f\u7b56\u7d81\u5b9a\u4e2d\u6dfb\u52a0 [IAM \u689d\u4ef6](https://cloud.google.com/sql/docs/mysql/project-access-control?hl=zh-cn#allow_users_to_connect_to_specific_instances) \uff0c\u5411\u8cec\u865f\u6388\u4e88\u50c5\u9023\u63a5\u5230\u4e00\u500b\u7279\u5b9a Cloud SQL \u5be6\u4f8b\u7684\u6b0a\u9650\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5553\u7528 Cloud SQL Admin API\u3002 [\u5553\u7528 API](https://console.cloud.google.com/flows/enableapi?apiid=sqladmin&hl=zh-cn) \n- \u5b89\u88dd\u4e26\u521d\u59cb\u5316 [gcloud CLI](https://cloud.google.com/sdk/docs/install?hl=zh-cn) \u3002## \u5b89\u88dd Cloud SQL Proxy Operator\n\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u5b89\u88dd Cloud SQL Proxy Operator\u3002\n- \u78ba\u8a8d`kubectl`\u53ef\u4ee5\u9023\u63a5\u5230\u60a8\u7684 GKE \u96c6\u7fa3\u3002```\nkubectl cluster-info\n```\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5c07 Google Kubernetes Engine \u9023\u63a5\u5230 Cloud SQL\uff0c\u8acb\u53c3\u95b1 [\u5f9e Google Kubernetes Engine \u9023\u63a5](https://cloud.google.com/sql/docs/postgres/connect-kubernetes-engine?hl=zh-cn) \u3002\n- \u4f7f\u7528 helm \u5b89\u88dd`cert-manager`\u3002\u5982\u9700\u5728 GKE \u96c6\u7fa3\u4e0a\u4f7f\u7528`cert-manager`\uff0c\u60a8\u9700\u8981\u4f7f\u7528\u6b64\u8655\u6307\u5b9a\u7684\u7248\u672c\u548c CLI \u53c3\u6578\u3002```\n\u00a0 \u00a0 \u00a0 helm repo add jetstack https://charts.jetstack.io\u00a0 \u00a0 \u00a0 helm repo update\u00a0 \u00a0 \u00a0 helm install \\\u00a0 \u00a0 \u00a0 \u00a0 cert-manager jetstack/cert-manager \\\u00a0 \u00a0 \u00a0 \u00a0 --namespace cert-manager \\\u00a0 \u00a0 \u00a0 \u00a0 --version \"v1.9.1\" \\\u00a0 \u00a0 \u00a0 \u00a0 --create-namespace \\\u00a0 \u00a0 \u00a0 \u00a0 --set global.leaderElection.namespace=cert-manager \\\u00a0 \u00a0 \u00a0 \u00a0 --set installCRDs=true\u00a0 \u00a0 \n```\n- \u5c07 Cloud SQL Proxy Operator \u5b89\u88dd\u5230 kubernetes \u96c6\u7fa3\uff1a```\nkubectl apply -f https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy-operator/v1.4.3/cloud-sql-proxy-operator.yaml\u00a0 \u00a0 \n```\n- \u7b49\u5f85 Cloud SQL Proxy Operator \u5553\u52d5\u3002```\nkubectl rollout status deployment -n cloud-sql-proxy-operator-system cloud-sql-proxy-operator-controller-manager --timeout=90s\u00a0 \u00a0 \n```\n- \u78ba\u8a8d Cloud SQL Proxy Operator \u5df2\u5b89\u88dd\u4e26\u6b63\u5728\u904b\u884c\uff1a```\nkubectl get pods -n cloud-sql-proxy-operator-system\u00a0 \n```## \u5f8c\u7e8c\u6b65\u9a5f- \u8a73\u7d30\u77ad\u89e3 [Cloud SQL Auth \u4ee3\u7406](https://cloud.google.com/sql/docs/postgres/sql-proxy?hl=zh-cn) \u3002\n- \u8a73\u7d30\u77ad\u89e3 [Identity and Access Management (IAM)](https://cloud.google.com/iam/docs/overview?hl=zh-cn) \u3002\n- \u8a73\u7d30\u77ad\u89e3 [\u670d\u52d9\u8cec\u865f](https://cloud.google.com/iam/docs/understanding-service-accounts?hl=zh-cn) \u3002\n- \u77ad\u89e3 Cloud SQL \u5be6\u4f8b\u7684 [\u5169\u500b\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\u7d1a\u5225](https://cloud.google.com/sql/docs/postgres/instance-access-control?hl=zh-cn) \u3002\n- \u5275\u5efa [\u7528\u6236](https://cloud.google.com/sql/docs/postgres/create-manage-users?hl=zh-cn) \u548c [\u6578\u64da\u5eab](https://cloud.google.com/sql/docs/postgres/create-manage-databases?hl=zh-cn) \u3002\n- \u77ad\u89e3\u5982\u4f55 [\u5f9e\u61c9\u7528\u9023\u63a5\u5230\u5be6\u4f8b](https://cloud.google.com/sql/docs/postgres/instance-access-control?hl=zh-cn#instanceaccess) \u3002\n- \u77ad\u89e3 [psql \u5ba2\u6236\u7aef](https://www.postgresql.org/docs/current/static/app-psql.html) \u3002\n- \u77ad\u89e3 [\u652f\u6301\u9078\u9805](https://cloud.google.com/sql/docs/support?hl=zh-cn) \u3002", "guide": "Cloud SQL"}