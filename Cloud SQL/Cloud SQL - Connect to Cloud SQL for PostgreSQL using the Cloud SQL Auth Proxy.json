{"title": "Cloud SQL - Connect to Cloud SQL for PostgreSQL using the Cloud SQL Auth Proxy", "url": "https://cloud.google.com/sql/docs/postgres/connect-instance-auth-proxy", "abstract": "# Cloud SQL - Connect to Cloud SQL for PostgreSQL using the Cloud SQL Auth Proxy\n# Connect to Cloud SQL for PostgreSQL using the Cloud SQL Auth Proxy\nThis page shows you how to connect to Cloud SQL from a local test environment using the Cloud SQL Auth Proxy. The [Cloud SQL Auth Proxy](/sql/docs/postgres/sql-proxy) provides secure access to your Cloud SQL instance without the need for authorized networks or for configuring SSL. By using the Cloud SQL Auth Proxy, you can connect to your Cloud SQL instance securely.\nThe instructions on this page are for a test environment only and shouldn't be used for production environments. For more information on the configuration required for production environments, see [Use the Cloud SQL Auth Proxy in a production environment](/sql/docs/mysql/sql-proxy#production-environment) and [Connect using the Cloud SQL Auth Proxy](/sql/docs/mysql/connect-auth-proxy) .", "content": "## Before you begin **Note:** The name you use for your project must be between 4 and 30 characters. When you type the name, the form suggests a project ID, which you can edit. The project ID must be between 6 and 30 characters, with a lowercase letter as the first character. You can use a dash, lowercase letter, or digit for the remaining characters, but the last character cannot be a dash.- Enable the necessary Google Cloud APIs.\nIn the Google Cloud console, go to the **APIs** page.\n [Go to APIs](https://console.cloud.google.com/apis) \nEnable the Cloud SQL Admin API.\nClick the following button to open Cloud Shell, which provides   command-line access to your Google Cloud resources directly from the browser.   Cloud Shell can be used to run the `gcloud` commands presented throughout this quickstart.\n [Open Cloud Shell](/console/sql/instances?cloudshell=true) \nRun the [gcloud services enable](/sdk/gcloud/reference/services/enable) command   as follows using Cloud Shell to enable the APIs required for this quickstart.:\n```\ngcloud services enable sqladmin.googleapis.com\n```\nThis command enables the following APIs:- Cloud SQL Admin API\n## Create a Cloud SQL instanceIn this quickstart, you use the Google Cloud console. To use the [gcloud CLI](/sdk/gcloud) , cURL, or PowerShell, see [Create instances](/sql/docs/postgres/create-instance) .- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- Click **Create Instance** .\n- Click **Choose PostgreSQL** .\n- Enter`myinstance`for **Instance ID** .\n- Enter a password for the`postgres`user.\n- Click **Create** .You're returned to the instances list. You can click the new instance right away to see the details, but it won't be available for other operations until it initializes and starts. **Note:** In this example, the instance is created using default settings, including a public IP address.\nInstall the psql client from the package manager:\n```\nsudo apt-get updatesudo apt-get install postgresql-client\n```Install the psql client from the package manager:\n```\nsudo yum install postgresql\n```Install the psql client from the package manager:\n```\nsudo zypper install postgresql\n```\n- Download the PostgreSQL Core Distribution for your platform from the [PostgreSQL Downloads page](https://www.postgresql.org/download/) .The Core Distribution includes the psql client.\n- Install the PostgreSQL database, following the directions on the download page.## Install the Cloud SQL Auth Proxy clientThe Cloud SQL Auth Proxy binary you download depends on your operating system, and whether it uses a 32-bit or 64-bit kernel. Most newer hardware uses a 64-bit kernel. If you're unsure whether your machine is running a 32-bit or 64-bit kernel, then use the `uname -a` command for Linux or macOS. For Windows, see the [Windows documentation](https://support.microsoft.com/en-us/windows/32-bit-and-64-bit-windows-frequently-asked-questions-c6ca9541-8dce-4d48-0415-94a3faa2e13d) .\n- Download the Cloud SQL Auth Proxy:```\ncurl -o cloud-sql-proxy https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.10.1/cloud-sql-proxy.linux.amd64\n```\n- Make the Cloud SQL Auth Proxy executable:```\nchmod +x cloud-sql-proxy\n```\n- Download the Cloud SQL Auth Proxy:```\ncurl -o cloud-sql-proxy https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.10.1/cloud-sql-proxy.linux.386\n```\n- If the`curl`command is not found, run`sudo apt install curl`and repeat the download command.\n- Make the Cloud SQL Auth Proxy executable:```\nchmod +x cloud-sql-proxy\n```\n- Download the Cloud SQL Auth Proxy:```\ncurl -o cloud-sql-proxy https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.10.1/cloud-sql-proxy.darwin.amd64\n```\n- Make the Cloud SQL Auth Proxy executable:```\nchmod +x cloud-sql-proxy\n```\n- Download the Cloud SQL Auth Proxy:```\n\u00a0 curl -o cloud-sql-proxy https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.10.1/cloud-sql-proxy.darwin.arm64\u00a0 \n```\n- Make the Cloud SQL Auth Proxy executable:```\n\u00a0 chmod +x cloud-sql-proxy\u00a0 \n```Right-click\n [https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.10.1/cloud-sql-proxy.x64.exe](https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.10.1/cloud-sql-proxy.x64.exe) \nand select\n **Save Link As** \nto download the Cloud SQL Auth Proxy. Rename the file to\n`cloud-sql-proxy.exe`\n.\nRight-click\n [https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.10.1/cloud-sql-proxy.x86.exe](https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.10.1/cloud-sql-proxy.x86.exe) \nand select\n **Save Link As** \nto download the Cloud SQL Auth Proxy. Rename the file to\n`cloud-sql-proxy.exe`\n.\nThe Cloud SQL Auth Proxy has different container images, such as `distroless` , `alpine` , and `buster` . The default Cloud SQL Auth Proxy container image uses [distroless](https://github.com/GoogleContainerTools/distroless) , which contains no shell. If you need a shell or related tools, then download an image based on `alpine` or `buster` . For more information, see [Cloud SQL Auth Proxy Container Images](https://github.com/GoogleCloudPlatform/cloudsql-proxy#container-images) .\nYou can pull the latest image to your local machine using Docker by using the following command:\n```\ndocker pull gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.10.1\n```\n **Note** : The Cloud SQL Auth Proxy uses a repository that supports the`gcr.io`domain but serves images from Artifact Registry. For more information, see [Transition from Container Registry](/artifact-registry/docs/transition/transition-from-gcr) .\nFor other operating systems not included here, you can\n [compile the Cloud SQL Auth Proxy from source](http://github.com/GoogleCloudPlatform/cloudsql-proxy) \n.## Get the instance connection name\n- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- Click the instance name to open its **Overview** page.\n- In the **Connect to this instance** section, copy the **Connection name** . The  connection name is in the format`projectID:region:instanceID`.\n## Start the Cloud SQL Auth ProxyStart the Cloud SQL Auth Proxy in its own terminal so you can monitor its output. Replace `INSTANCE_CONNECTION_NAME` with the instance connection name you copied in the previous step.\nFor Linux environments, use this command to launch the Cloud SQL Auth Proxy:\n```\n./cloud-sql-proxy INSTANCE_CONNECTION_NAME\n```\nIn PowerShell on Windows, use this command to launch the Cloud SQL Auth Proxy:\n```\n.\\cloud-sql-proxy.exe INSTANCE_CONNECTION_NAME\n```\nA message similar to the following appears:\n```\nListening on 127.0.0.1:5432 for INSTANCE_CONNECTION_NAME\nReady for new connections\n```\nRun the following command after replacing with the name of the Cloud SQL database:\n```\npsql \"host=127.0.0.1 port=5432 sslmode=disable dbname=DB_NAME user=postgres\"\n```\nAt the Enter password: prompt, enter the password of your PostgreSQL account.\nVerify that the PostgreSQL prompt appears. You have connected to your database using the psql client.\nReturn to the terminal window where you started the Cloud SQL Auth Proxy. You should see a message similar to the following:\n`New connection for` ``## Clean upTo avoid incurring charges to your Google Cloud account for   the resources used on this page, follow these steps.- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- Select the`myinstance`instance to open the **Instance details** page.\n- In the icon bar at the top of the page, click **Delete** .\n- In the **Delete instance** window, type your instance's name and then click **Delete** .\n### Optional cleanup stepsIf you're not using the APIs that were enabled as part of this quickstart, you can disable them.- APIs that were enabled within this quickstart:- Cloud SQL Admin API- In the Google Cloud console, go to the **APIs** page. [Go to APIs](https://console.cloud.google.com/apis) \n- Select the Cloud SQL Admin API and then click the **Disable API** button.\n## What's next\n- See how to [troubleshoot information for the Cloud SQL Auth Proxy](/sql/docs/postgres/connect-auth-proxy#troubleshooting) .\n- Learn more [about the Cloud SQL Auth Proxy](/sql/docs/postgres/sql-proxy) .\n- Learn more [about other connection options](/sql/docs/postgres/connect-overview) .", "guide": "Cloud SQL"}