{"title": "Cloud SQL - Optimize underprovisioned Cloud SQL instances", "url": "https://cloud.google.com/sql/docs/postgres/recommender-underprovisioned", "abstract": "# Cloud SQL - Optimize underprovisioned Cloud SQL instances\n**    Preview     ** This feature is subject to the \"Pre-GA Offerings Terms\" in the General Service Terms section   of the [Service Specific Terms](/terms/service-terms#1) .     Pre-GA features are available \"as is\" and might have limited support.    For more information, see the [launch stage descriptions](/products#product-launch-stages) .\nThe underprovisioned instance [recommender](/recommender/docs/overview) helps you detect instances that have high CPU and/or memory utilization. It then provides recommendations for how to optimize the instance. This page describes how this recommender works and how to use it.\n", "content": "## How it works\nWhen there is high CPU and/or memory utilization detected, you see a recommendation to increase the size of your instance to reduce CPU and/or memory utilization at peak.\n**Note:** Recommendations are generated daily.\n## Pricing\nThe underprovisioned instance recommender is in the Standard [Recommender pricing tier](/recommender/pricing) .\n## Before you begin\nBefore you can view recommendations and insights, do the following:\n- Ensure that you have the required [roles](/sql/docs/postgres/project-access-control#roles) so that you have permission to view and work with insights and recommendations.| Tasks     | Roles                    |\n|:----------------------|:------------------------------------------------------------------------------------|\n| View recommendations | One of these roles: recommender.cloudsqlViewer or cloudsql.viewer.     |\n| Apply recommendations | One of these roles: recommender.cloudsqlAdmin, cloudsql.editor, or cloudsql.admin. |For more information about roles, see [understanding roles](/iam/docs/understanding-roles) and [granting IAM permissions](/iam/docs/granting-changing-revoking-access) .\n- Enable the Recommender API. [Enable the API](https://console.cloud.google.com/flows/enableapi?apiid=recommender.googleapis.com) \n## List underprovisioned instance recommendations\nTo list recommendations about underprovisioned instances, follow these steps:- Go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql/instances) \n- Click **View all** on the resize Cloud SQL instance recommender banner.\nAlternatively, follow these steps:- Go to the **Recommendation Hub** . [Go to the Recommendation Hub](https://console.cloud.google.com/home/recommendations/) For more information, see [Getting started with Recommendation Hub](/recommender/docs/recommendation-hub/identify-configuration-problems) .\n- In the **Resize Cloud SQL instances to improve performance** card, click **View all** .\n- Click the instances with the **Resize Cloud SQL instance** recommendation.\nTo list recommendations about underprovisioned instances, run the [gcloud recommender recommendations list](/sdk/gcloud/reference/recommender/recommendations/list) command as follows:\n```\ngcloud recommender recommendations list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--recommender=google.cloudsql.instance.UnderprovisionedRecommender\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\nTo list recommendations about underprovisioned instances by using the [Recommendations API](/recommender/docs/using-api) , call the [recommendations.list](/recommender/docs/reference/rest/v1beta1/projects.locations.recommenders.recommendations/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/recommenders/google.cloudsql.instance.UnderprovisionedRecommender/recommendations\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\nIf the recommender detects underprovisioned instances, it lists them in a table. Each row shows the instance name, a brief recommendation, the current machine type, the recommended machine type, the location, and the last refresh date.\n## View insights and detailed recommendations\nTo view insights and detailed recommendations about an underprovisioned instance by using the Google Cloud console, click the recommendation button in the list of instances.\nTo view insights and detailed recommendations about underprovisioned instances by using `gcloud` , run the [gcloud recommender insights list](/sdk/gcloud/reference/recommender/insights/list) command as follows:\n```\ngcloud recommender insights list \\\n--project=PROJECT_ID \\\n--location=LOCATION \\\n--insight-type=google.cloudsql.instance.INSIGHT_TYPE\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the insight type is`UnderprovisionedCpuUsageInsight`,`UnderprovisionedMemoryUsageInsight`, or`OomProbabilityInsight`, which provide insights about CPU usage, memory, and OOM probability, respectively.\nTo view insights and detailed recommendations about underprovisioned instances by using the [Recommendations API](/recommender/docs/using-api) , call the [insights.list](/recommender/docs/reference/rest/v1beta1/projects.locations.insightTypes.insights/list) method as follows:\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT-ID/locations/LOCATION/insightTypes/google.cloudsql.instance.INSIGHT_TYPE/insights\n```\nReplace the following:- ``: Your project ID.\n- ``: A region, such as`us-central1`.\n- ``: The ID of the insight type as ``UnderprovisionedCpuUsageInsight`,`UnderprovisionedMemoryUsageInsight`, or`OomProbabilityInsight`, which provide insights about CPU usage, memory, and OOM probability, respectively.\nThe following table lists the insights and recommendations that the Cloud SQL underprovisioned instance recommender might generate to help you avoid bottlenecks from high CPU and memory usage and minimize the likelihood of out-of-memory events. The subtypes are visible in the `gcloud` and API results.\n| Insights                                   | Recommendations                 |\n|:-------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------|\n| Based on the current CPU utilization trends, the instance is flagged as having high CPU usage. Subtype: HIGH_CPU_UTILIZATION     | Increase CPU size or reduce CPU utilization. Subtype: CHANGE_INSTANCE_SIZE  |\n| Based on the current memory utilization trends, the instance is flagged as having high memory usage. Subtype: HIGH_MEMORY_UTILIZATION.   | Increase memory size or reduce memory utilization. Subtype: CHANGE_INSTANCE_SIZE |\n| Based on the current usage trends, the instance is flagged as being at the risk of incurring future OOM events. Subtype: HIGH_OOM_PROBABILITY. | Increase memory size or reduce memory utilization. Subtype: CHANGE_INSTANCE_SIZE |\n## Apply recommendations\nEvaluate the recommendations carefully and do any of the following:\n- To examine the recommendation, click **View instance** .A banner appears at the top of the page providing a recommendation.\n- To dismiss the recommendation so that it's de-emphasized and appears dimmed, click **Dismiss** .\n- To close the panel without applying or dismissing the recommendation, click **Cancel** .\n### Optimize the performance of your instance\nTo optimize your instance's performance, do the following:\n- [Optimize high CPU usage](/sql/docs/postgres/optimize-cpu-usage) \n- [Optimize high memory usage](/sql/docs/postgres/optimize-high-memory-usage) \n- [Optimize the query performance of your instance](/sql/docs/postgres/using-query-insights) .\n- [Create read replicas](/sql/docs/postgres/replication/create-replica) . **Caution:** This operation can lead to an increase in cost.\n- [Edit](/sql/docs/postgres/edit-instance) the instance, if required, to increase the vCPUs or memory. Alternatively, switch to a machine type with more vCPUs and more memory. You don't need to rightsize the instance exactly as recommended. Use your judgement and resize based on how you intend to provision the instance. Keep in mind that the bigger the size, the greater the operational latency. **Caution:** This operation can lead to an increase in cost. Additionally, it triggers a restart, which brings downtime to the instance.\nYou can also [export these recommendations to BigQuery](/recommender/docs/bq-export/export-recommendations-to-bq) and then examine them using [Looker Studio](/bigquery/docs/visualize-looker-studio) or [Looker](/bigquery/docs/looker) .\n## What's next\n- [Monitor disk availability](/sql/docs/postgres/using-ood-recommender) \n- [Reduce idle Cloud SQL instances](/sql/docs/postgres/recommender-sql-idle) \n- [Blog: Maximize your Cloud ROI](https://cloud.google.com/blog/products/management-tools/active-assist-comes-to-google-cloud) \n- [Blog: Do more with less](https://cloud.google.com/blog/products/databases/reduce-cloud-sql-costs-with-optimizations-by-active-assist) \n- [Google Cloud recommenders](/recommender/docs/recommenders)", "guide": "Cloud SQL"}