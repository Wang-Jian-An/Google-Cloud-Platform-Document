{"title": "Cloud SQL - Connect to Cloud SQL for PostgreSQL from Cloud Run", "url": "https://cloud.google.com/sql/docs/postgres/connect-instance-cloud-run", "abstract": "# Cloud SQL - Connect to Cloud SQL for PostgreSQL from Cloud Run\n# Connect to Cloud SQL for PostgreSQL from Cloud Run\nLearn how to deploy a sample app on [Cloud Run](/run/docs) connected to a PostgreSQL instance by using the Google Cloud console and a client application.\nAssuming that you complete all the steps in a timely manner, the resources created in this quickstart typically cost less than one dollar (USD).To follow step-by-step guidance for this task directly in the Google Cloud console, click **Guide me** :\n [Guide me](https://console.cloud.google.com/?walkthrough_id=sql--postgres--quickstart-cloud-run) ", "content": "## Before you begin **Note:** The name you use for your project must be between 4 and 30 characters. When you type the name, the form suggests a project ID, which you can edit. The project ID must be between 6 and 30 characters, with a lowercase letter as the first character. You can use a dash, lowercase letter, or digit for the remaining characters, but the last character cannot be a dash.- Enable the Cloud APIs necessary to run a Cloud SQL sample app on Cloud Run.\nClick **Enable APIs** to enable the APIs required for this quickstart.\n [Enable APIs](https://console.cloud.google.com/flows/enableapi?apiid=compute.googleapis.com,sqladmin.googleapis.com,run.googleapis.com,containerregistry.googleapis.com,cloudbuild.googleapis.com,servicenetworking.googleapis.com) \nThis enables the following APIs:- Compute Engine API\n- Cloud SQL Admin API\n- Cloud Run API\n- Container Registry API\n- Cloud Build API\n- Service Networking API\nClick the following button to open Cloud Shell, which provides   command-line access to your Google Cloud resources directly from the browser.   Cloud Shell can be used to run the `gcloud` commands presented throughout this quickstart.\n [Open Cloud Shell](/console/sql/instances?cloudshell=true) \nRun the following `gcloud` command using Cloud Shell:\n```\ngcloud services enable compute.googleapis.com sqladmin.googleapis.com run.googleapis.com \\containerregistry.googleapis.com cloudbuild.googleapis.com servicenetworking.googleapis.com\n```\nThis command enables the following APIs:- Compute Engine API\n- Cloud SQL Admin API\n- Cloud Run API\n- Container Registry API\n- Cloud Build API\n- Service Networking API\n## Set up Cloud SQL\n### Create a Cloud SQL instance\n### Create a database- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- Select`quickstart-instance`.\n- From the SQL navigation menu, select **Databases** .\n- Click **Create database** .\n- In the **Database name** field of the **New database** dialog  box, enter`quickstart-db`.\n- Click **Create** .Run the [gcloud sql databases create](/sdk/gcloud/reference/sql/databases/create) command to create a database.\n```\ngcloud sql databases create quickstart-db --instance=quickstart-instance\n```\n### Create a user- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- To open the **Overview** page of an instance, click the instance name.\n- Select **Users** from the SQL navigation menu.\n- Click **Add user account** .\n- On the **Add a user account to instance instance_name** page,   add the following information:- In the **Username** field, enter`quickstart-user`\n- In the **Password** field, specify a password for your database user.    Make a note of this for use in a later step of this quickstart.\n- Click **Add** .\nBefore running the following command, make the following replacements:- with a password for your database user.    Make a note of this for use in a later step of this quickstart.\nRun the [gcloud sql users create](/sdk/gcloud/reference/sql/users/create) command to create the user.\n```\ngcloud sql users create quickstart-user \\--instance=quickstart-instance \\--password=PASSWORD\n```\nUser name length limits are the same for Cloud SQL as for on-premises PostgreSQL.\n## Deploy sample app to Cloud Run\n### Configure a Cloud Run service account\nConfigure the service account used by Cloud Run so that it has the **Cloud SQL Client** role with permissions to connect to Cloud SQL.- In the Google Cloud console, go to the **IAM** page. [Go to IAM](https://console.cloud.google.com/iam-admin/iam) \n- For the service account named **Compute Engine default service account** ,    click the pencil icon.\n- Click **ADD ANOTHER ROLE** .\n- Add the **Role** named **Cloud SQL Client** .\n- Click **Save** .\n- Run the following`gcloud`command to get a list of    your project's service accounts:```\ngcloud iam service-accounts list\n```\n- Copy the **EMAIL** of the **Compute Engine service account** .\n- Run the following command to add the **Cloud SQL Client** role to **Compute Engine service account** :```\ngcloud projects add-iam-policy-binding YOUR_PROJECT_ID \\\u00a0 --member=\"serviceAccount:SERVICE_ACCOUNT_EMAIL\" \\\u00a0 --role=\"roles/cloudsql.client\"\n```### Configure a Cloud SQL sample appWith a Cloud SQL instance, database, and service account with client permissions, you can now configure a sample application to connect to your Cloud SQL instance.\n### Deploy the sample appThe steps to deploy the sample to Cloud Run depend on the type of IP address you assigned to your Cloud SQL instance.\n## Clean upTo avoid incurring charges to your Google Cloud account for   the resources used on this page, follow these steps.- In the Google Cloud console, go to the **Cloud SQL Instances** page. [Go to Cloud SQL Instances](https://console.cloud.google.com/sql) \n- Select the`quickstart-instance`instance to open the **Instance details** page.\n- In the icon bar at the top of the page, click **Delete** .\n- In the **Delete instance** dialog box, type`quickstart-instance`, and then click **Delete** to delete the instance.\n- In the Google Cloud console, go to the **Cloud Run** page. [Go to Cloud Run](https://console.cloud.google.com/run) \n- Select the checkbox next to the`quickstart-service`service name.\n- Click **Delete** at the top of the Cloud Run page.\n### Optional cleanup stepsIf you're not using the **Cloud SQL client** role that you assigned to the Compute Engine service account, you can remove it.- In the Google Cloud console, go to the **IAM** page. [Go to IAM](https://console.cloud.google.com/iam-admin/iam) \n- Click the edit icon (which looks like a pencil) for the IAM account named **Compute Engine default service account** .\n- Delete the **Cloud SQL client** role.\n- Click **Save** .\nIf you're not using the APIs that were enabled as part of this quickstart, you can disable them.- APIs that were enabled within this quickstart:- Compute Engine API\n- Cloud SQL Admin API\n- Cloud Run API\n- Container Registry API\n- Cloud Build API- In the Google Cloud console, go to the **APIs** page. [Go to APIs](https://console.cloud.google.com/apis) \n- Select any API that you would like to disable and then click the **Disable API** button.\n## What's next\nBased on your needs, you can learn more about\n [creating Cloud SQL instances](/sql/docs/postgres/create-instance) \n.\nYou also can learn about creating [PostgreSQL users](/sql/docs/postgres/create-manage-users#creating) and [databases](/sql/docs/postgres/create-manage-databases#create) for your Cloud SQL instance.\nFor more information about pricing, see [Cloud SQL for PostgreSQL pricing](/sql/docs/postgres/pricing) .\nLearn more about:- Configuring your Cloud SQL instance with a [public IP](/sql/docs/postgres/configure-ip) address.\n- Configuring your Cloud SQL instance with a [private IP](/sql/docs/postgres/configure-private-ip) address.\nAdditionally, you can learn about connecting to a Cloud SQL instance from other Google Cloud applications:- [From an application running on App Engine standard environment](/sql/docs/postgres/connect-app-engine) \n- [From an application running on Compute Engine](/sql/docs/postgres/connect-compute-engine) \n- [From an application running on GKE](/sql/docs/postgres/connect-kubernetes-engine) \n- [From Cloud Functions](/sql/docs/postgres/connect-functions) \n- [From Cloud Run](/sql/docs/postgres/connect-run)", "guide": "Cloud SQL"}