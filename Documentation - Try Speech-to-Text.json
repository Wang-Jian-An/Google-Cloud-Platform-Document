{"title": "Documentation - Try Speech-to-Text", "url": "https://cloud.google.com/distributed-cloud/hosted/docs/latest/gdch/overview", "abstract": "# Documentation - Try Speech-to-Text\nThis quickstart guides the Application Operator (AO) through the process of using the Vertex AI Speech-to-Text pre-trained API.\n", "content": "## Before you begin\n- [Enable the Speech-to-Text pre-trained API](/distributed-cloud/hosted/docs/latest/gdch/platform/pa-user/vertex-pre-trained-apis#enable-api) .\n- Download the [gdcloud command-line interface (CLI)](/distributed-cloud/hosted/docs/latest/gdch/resources/gdcloud-download) .## Set up your project\nSet up a project using the console to group the Vertex AI services. For information about creating and using projects, see [Creating a project](/distributed-cloud/hosted/docs/latest/gdch/platform/pa-user/create-a-project) .\n## Set up your service account\nSet up your service account with the name of your service account, project ID, and service key. Replace the `PROJECT_ID` with your [project](#set-up-your-project) .\n```\n\u00a0 ${HOME}/gdcloud init \u00a0# set URI and project\u00a0 ${HOME}/gdcloud auth login\u00a0 ${HOME}/gdcloud iam service-accounts create SERVICE_ACCOUNT \u00a0--project=PROJECT_ID\u00a0 ${HOME}/gdcloud iam service-accounts keys create \"SERVICE_KEY\".json --project=PROJECT_ID --iam-account=SERVICE_ACCOUNT\n```\n## Grant access to project resources\nGrant access to the Translation API service account by providing your project ID, name of your service account, and the role `ai-speech-developer` .\n```\n\u00a0 ${HOME}/gdcloud iam service-accounts add-iam-policy-binding --project=PROJECT_ID --iam-account=SERVICE_ACCOUNT --role=role/ai-speech-developer\n```\n## Set your environment variables\nBefore running the Speech-to-Text pre-trained service, set your environment variable.\n```\n\u00a0 export GOOGLE_APPLICATION_CREDENTIALS=\"SERVICE_KEY\".json\n```\n## Authenticate the CLI\nYou must get a token to authenticate the CLI before sending requests to the Speech-to-Text pre-trained service. Follow these steps:\n- Install the `google-auth` client library.```\npip install google-auth\n```\n- Save the following code to a Python script, and update the `ENDPOINT` to the Speech-to-Text endpoint. Run the script to fetch the token. For more information, see [View service statuses and endpoints](/distributed-cloud/hosted/docs/latest/gdch/application/ao-user/vertex-ai-api-status) .```\nimport google.authfrom google.auth.transport import requestsapi_endpoint = \"https://ENDPOINT\"creds, project_id = google.auth.default()creds = creds.with_gdch_audience(api_endpoint)def test_get_token():\u00a0 req = requests.Request()\u00a0 creds.refresh(req)\u00a0 print(creds.token)if __name__==\"__main__\":\u00a0 test_get_token()\n```\n- Save the following `recognize_request.json` file:```\ncat <<- EOF > recognize_request.json{\u00a0 \"config\": {\u00a0 \u00a0 \"encoding\": \"LINEAR16\",\u00a0 \u00a0 \"sample_rate_hertz\": 16000,\u00a0 \u00a0 \"audio_channel_count\": 1,\u00a0 \u00a0 \"language_code\": \"en-US\"\u00a0 },\u00a0 \"audio\": {\u00a0 \u00a0 \"content\": \"CONTENT\"\u00a0 }}EOF\n```Replace `` with the audio content.\n- If you don't have `grpcurl` installed, download and install it from a resource outside of GDCH ( [https://github.com/fullstorydev/grpcurl#from-source](https://github.com/fullstorydev/grpcurl#from-source) )\n- Make the `grpcurl` request:```\ngrpcurl -vv -insecure -H \"Authorization: Bearer TOKEN\" -authority ENPOINT.GDCH_URL -d @ ENPOINT.GDCH_URL:443 google.cloud.speech.v1.Speech.Recognize < recognize_request.json\n```Replace the following:- ``: the fetched token on the header of the`grpcurl`request.\n- ``: the Speech-to-Text endpoint that you use for your organization.\n- ``: the URL of your organization in GDCH, for example,`org-1.zone1.gdch.test`.\n## Run the Speech-to-Text pre-trained API sample script\nThis example shows you how to interact with a Speech-to-Text pre-trained API.\n- Check whether there is a client library installed.```\n\u00a0 pip freeze | grep speech\u00a0 # output example: google-cloud-speech==2.15.0\n```If the existing version doesn't match the client library in https:// /.well-known/static/client-libraries, uninstall the client library using the following command:```\n\u00a0 pip uninstall google-cloud-speech\n```\n- Specify the console endpoint and the [client library](/distributed-cloud/hosted/docs/latest/gdch/application/ao-user/vertex-ai-install-libraries#CLIENTLIB) for Speech-to-Text (provided in the example).```\n\u00a0 \u00a0wget https://CONSOLE_ENDPOINT/.well-known/static/client-libraries/google-cloud-speech\n``` **Note:** If the error message, \"x509: certificate signed by unknown authority\", is displayed, your workstation doesn't trust the CA certificate used in GDCH. Follow your organization's procedure to check the trusted certification store for your workstation. **Warning:** Using `--login-config-cert` with an unverified certificate makes your workstation vulnerable to man-in-the-middle attacks. Ensure that you rely only on your workstation's trust store instead of trusting a CA certificate from unknown sources.\n- Extract the `tar` file, and install it using `pip` . If errors are generated because something isn't found, install any missing dependencies.```\ntar -xvzf CLIENT_LIBRARYpip install -r FOLDER/requirements.txt --no-index --find-links FOLDER\n```\n- Use the [Speech-to-Text client library script](#speech_sample_script) to generate the token, and make requests to the OCR service.\n- Set up your environment variable.```\nos.environ[\"GOOGLE_APPLICATION_CREDENTIALS\"] = \"\"SERVICE_KEY\".json\"\n```## Speech-to-Text sample\nReplace the `ENDPOINT` with the Speech-to-Text endpoint that you use for your organization.\n```\nimport base64from google.cloud import speech_v1import google.authfrom google.auth.transport import requestsfrom google.api_core.client_options import ClientOptionsaudience = \"https://ENDPOINT\"api_endpoint=\"ENDPOINT:443\"def get_client(creds):\u00a0 opts = ClientOptions(api_endpoint=api_endpoint)\u00a0 return speech_v1.SpeechClient(credentials=creds, client_options=opts)def main():\u00a0 creds = None\u00a0 try:\u00a0 \u00a0 creds, project_id = google.auth.default()\u00a0 \u00a0 creds = creds.with_gdch_audience(audience)\u00a0 \u00a0 req = requests.Request()\u00a0 \u00a0 creds.refresh(req)\u00a0 \u00a0 print(\"Got token: \")\u00a0 \u00a0 print(creds.token)\u00a0 except Exception as e:\u00a0 \u00a0 print(\"Caught exception\" + str(e))\u00a0 \u00a0 raise e\u00a0 return credsdef speech_func(creds):\u00a0 tc = get_client(creds)\u00a0 content=\"CONTENT\"\u00a0 audio = speech_v1.RecognitionAudio()\u00a0 audio.content = base64.standard_b64decode(content)\u00a0 config = speech_v1.RecognitionConfig()\u00a0 config.encoding= speech_v1.RecognitionConfig.AudioEncoding.LINEAR16\u00a0 config.sample_rate_hertz=16000\u00a0 config.language_code=\"en-US\"\u00a0 config.audio_channel_count=1\u00a0 resp = tc.recognize(config=config, audio=audio)\u00a0 print(resp)if __name__==\"__main__\":\u00a0 creds = main()\u00a0 speech_func(creds)\n```\n## What's next\n- Learn more about how to [Transcribe audio](/distributed-cloud/hosted/docs/latest/gdch/application/ao-user/vertex-ai-stt) .", "guide": "Documentation"}