{"title": "Apigee - Obfuscating user data for analytics", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - Obfuscating user data for analytics\nYou are currently viewing version 1.2 of the Apigee hybrid documentation. **This version is end of life.** You should upgrade to a newer version. For more information, see [Supported versions](/apigee/docs/hybrid/supported-platforms#supported-versions) .\nThis feature allows you to obscure data before sending it as part of the analytics payload. With this feature, Apigee uses SHA512 to hash the original value before communicating from the runtime plane to the control plane.\nThis feature is for Apigee hybrid 1.2 and newer only.\n", "content": "## Procedure\nEnable this feature by setting `features.analytics.data.obfuscation.enabled` to ** true** .\nWhen using`PUT`, be careful to include the entire set of properties  for your environment. PUT overwrites the entire property set each time you issue it.\n```\ncurl -v -X PUT \\\n https://apigee.googleapis.com/v1/organizations/YOUR_ORG_NAME/environments/YOUR_ENV_NAME \\\n -H \"Content-Type: application/json\" \\\n -H \"Authorization: Bearer $TOKEN\" \\\n -d '{\n \"name\" : \"YOUR_ENV_NAME\",\n \"properties\" : {\n \"property\" : [ {\n  \"name\" : \"features.analytics.data.obfuscation.enabled\",\n  \"value\" : \"true\"\n },]\n }\n}'\n```\nWith obfuscation enabled, Apigee hybrid will hash the following fields with SHA512 at the runtime plane before sending the information to analytics backend:\n- client_id\n- client_ip\n- developer_email\n- proxy_client_ip\n- proxy_pathsuffix\n- request_urirequest_path\n- target_basepath\n- target_url\n- x_forwarded_for_ip\n- x-apigee.edge.true_client_ip\n- x-apigee.intelligence.client_ip_header\nApigee hybrid will hash the following dimension values in custom analytics reports:\n- Client ID\n- Client IP Address\n- Developer Email\n- Proxy Client IP\n- Proxy Path Suffix\n- Referred Client IP\n- Request Path\n- Request URI\n- Resolved Client IP\n- Target Base Path\n- Target URL\n- X Forwarded For\nSee [ Analytics metrics, dimensions, and filters reference](https://docs.apigee.com/api-platform/analytics/analytics-reference#dimensions) for detailed descriptions of analytics dimensions.\n## \n Viewing obfuscated results\nThe obfuscated results display in the Apigee hybrid analytics dashboard. It may take several minutes before you see the hashed results in the UI.\n**Note:** Analytics reports will display unhashed data communicated from the runtime plane before you enabled obfuscating or after you disable it.\n## Example\nThe following example shows the data before and after obfuscating:\n```\n// JSON data sent to AX before obfuscating{\u00a0 \u00a0\"proxy_basepath\":\"/APP_NAME\",\u00a0 \u00a0\"x-apigee.edge.execution.stats.request_flow_endtimestamp\":1582770652814,\u00a0 \u00a0\"apiproxy\":\"APP_NAME\",\u00a0 \u00a0\"x-apigee.edge.is_policy_error\":0,\u00a0 \u00a0\"client_sent_start_timestamp\":1582770652817,\u00a0 \u00a0\"x-apigee.edge.is_target_error\":0,\u00a0 \u00a0\"client_received_start_timestamp\":1582770652813,\u00a0 \u00a0\"client_ip\":\"10.10.0.99\",\u00a0 \u00a0\"is_error\":false,\u00a0 \u00a0\"x-apigee.edge.stats.steps\":\"{\\\"JS1.0\\\":1}\",\u00a0 \u00a0\"request_size\":0,\u00a0 \u00a0\"x-apigee.intelligence.client_ip_header\":\"10.10.0.99\",\u00a0 \u00a0\"virtual_host\":\"default\",\u00a0 \u00a0\"x-apigee.edge.mp_host\":\"mp\",\u00a0 \u00a0\"sla\":false,\u00a0 \u00a0\"x-apigee.intelligence.service\":\"{}\",\u00a0 \u00a0\"client_sent_end_timestamp\":1582770652817,\u00a0 \u00a0\"request_uri\":\"/APP_NAME\",\u00a0 \u00a0\"proxy\":\"default\",\u00a0 \u00a0\"proxy_client_ip\":\"10.10.0.99\",\u00a0 \u00a0\"x-apigee.edge.dn.region\":\"dc-1\",\u00a0 \u00a0\"apigee.edge.execution.is_apigee_fault\":0,\u00a0 \u00a0\"x-apigee.edge.target.latency.stats\":\"{\\\"targetList\\\":[]}\",\u00a0 \u00a0\"useragent\":\"Apache-HttpClient/4.3.6 (java 1.5)\",\u00a0 \u00a0\"proxy_pathsuffix\":\"\",\u00a0 \u00a0\"x-apigee.edge.execution.stats.request_flow_start_timestamp\":1582770652814,\u00a0 \u00a0\"x_forwarded_for_ip\":\"10.10.0.99\",\u00a0 \u00a0\"x_forwarded_proto\":\"http\",\u00a0 \u00a0\"response_status_code\":200,\u00a0 \u00a0\"request_verb\":\"GET\",\u00a0 \u00a0\"x-apigee.edge.execution.stats.response_flow_end_timestamp\":1582770652816,\u00a0 \u00a0\"gateway_source\":\"message_processor\",\u00a0 \u00a0\"environment\":\"env_82hw\",\u00a0 \u00a0\"client_received_end_timestamp\":1582770652814,\u00a0 \u00a0\"organization\":\"Org_1582769880344\",\u00a0 \u00a0\"x-apigee.edge.execution.stats.response_flow_start_timestamp\":1582770652814,\u00a0 \u00a0\"request_path\":\"/APP_NAME\",\u00a0 \u00a0\"gateway_flow_id\":\"rt-8644-188-1\",\u00a0 \u00a0\"apiproxy_revision\":\"1\"}\n```\n```\n// JSON data sent to AX after obfuscating{\u00a0 \u00a0\"proxy_basepath\":\"/APP_NAME\",\u00a0 \u00a0\"x-apigee.edge.execution.stats.request_flow_endtimestamp\":1582749361836,\u00a0 \u00a0\"apiproxy\":\"APP_NAME\",\u00a0 \u00a0\"x-apigee.edge.is_policy_error\":0,\u00a0 \u00a0\"client_sent_start_timestamp\":1582749361884,\u00a0 \u00a0\"x-apigee.edge.is_target_error\":0,\u00a0 \u00a0\"client_received_start_timestamp\":1582749361790,\u00a0 \u00a0\"client_ip\":\"090cdae81ea6e58e55093f702661cf2325cef6a68aa801f1209e73bb0649c2b931bcad468911da887a42ce1d1daee07b24933e3dbbde6eb7438cfc9020a25445\",\u00a0 \u00a0\"is_error\":false,\u00a0 \u00a0\"x-apigee.edge.stats.steps\":\"{\\\"JS1.0\\\":30}\",\u00a0 \u00a0\"request_size\":0,\u00a0 \u00a0\"x-apigee.intelligence.client_ip_header\":\"090cdae81ea6e58e55093f702661cf2325cef6a68aa801f1209e73bb0649c2b931bcad468911da887a42ce1d1daee07b24933e3dbbde6eb7438cfc9020a25445\",\u00a0 \u00a0\"virtual_host\":\"default\",\u00a0 \u00a0\"x-apigee.edge.mp_host\":\"mp\",\u00a0 \u00a0\"sla\":false,\u00a0 \u00a0\"x-apigee.intelligence.service\":\"{}\",\u00a0 \u00a0\"client_sent_end_timestamp\":1582749361886,\u00a0 \u00a0\"request_uri\":\"0176937d9c4a33094d3c3f38ac8b15fa05dd6380a6bb544e4002c98de9f27bdbfea754901b0acb487f4980b09f7d312ad1e7027b96b2c8bfd8b9c24e833fbb5a\",\u00a0 \u00a0\"proxy\":\"default\",\u00a0 \u00a0\"proxy_client_ip\":\"090cdae81ea6e58e55093f702661cf2325cef6a68aa801f1209e73bb0649c2b931bcad468911da887a42ce1d1daee07b24933e3dbbde6eb7438cfc9020a25445\",\u00a0 \u00a0\"x-apigee.edge.dn.region\":\"dc-1\",\u00a0 \u00a0\"apigee.edge.execution.is_apigee_fault\":0,\u00a0 \u00a0\"x-apigee.edge.target.latency.stats\":\"{\\\"targetList\\\":[]}\",\u00a0 \u00a0\"useragent\":\"Apache-HttpClient/4.3.6 (java 1.5)\",\u00a0 \u00a0\"proxy_pathsuffix\":\"cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e\",\u00a0 \u00a0\"x-apigee.edge.execution.stats.request_flow_start_timestamp\":1582749361833,\u00a0 \u00a0\"x_forwarded_for_ip\":\"090cdae81ea6e58e55093f702661cf2325cef6a68aa801f1209e73bb0649c2b931bcad468911da887a42ce1d1daee07b24933e3dbbde6eb7438cfc9020a25445\",\u00a0 \u00a0\"x_forwarded_proto\":\"http\",\u00a0 \u00a0\"response_status_code\":200,\u00a0 \u00a0\"request_verb\":\"GET\",\u00a0 \u00a0\"x-apigee.edge.execution.stats.response_flow_end_timestamp\":1582749361874,\u00a0 \u00a0\"gateway_source\":\"message_processor\",\u00a0 \u00a0\"environment\":\"env_xj25\",\u00a0 \u00a0\"client_received_end_timestamp\":1582749361821,\u00a0 \u00a0\"organization\":\"Org_1582749068984\",\u00a0 \u00a0\"x-apigee.edge.execution.stats.response_flow_start_timestamp\":1582749361836,\u00a0 \u00a0\"request_path\":\"0176937d9c4a33094d3c3f38ac8b15fa05dd6380a6bb544e4002c98de9f27bdbfea754901b0acb487f4980b09f7d312ad1e7027b96b2c8bfd8b9c24e833fbb5a\",\u00a0 \u00a0\"gateway_flow_id\":\"rt-6290-57-1\",\u00a0 \u00a0\"apiproxy_revision\":\"1\"}\n```", "guide": "Apigee"}