{"title": "Cloud TPU - \u5c07 Filestore \u5be6\u4f8b\u88dd\u8f09\u5230 Cloud TPU \u865b\u64ec\u6a5f", "url": "https://cloud.google.com/tpu/docs/mount-filestore?hl=zh-cn", "abstract": "# Cloud TPU - \u5c07 Filestore \u5be6\u4f8b\u88dd\u8f09\u5230 Cloud TPU \u865b\u64ec\u6a5f\n# \u5c07 Filestore \u5be6\u4f8b\u88dd\u8f09\u5230 Cloud TPU \u865b\u64ec\u6a5f\nFilestore \u662f Compute Engine \u7684\u4e00\u7a2e\u5168\u4ee3\u7ba1\u5f0f\u7db2\u7d61\u9644\u52a0\u5b58\u5132 (NAS) \u670d\u52d9\u3002Filestore \u539f\u751f\u517c\u5bb9\u73fe\u6709\u4f01\u696d\u61c9\u7528\uff0c\u4e26\u652f\u6301\u4efb\u4f55\u8207 NFSv3 \u517c\u5bb9\u7684\u5ba2\u6236\u7aef\u3002\n", "content": "## \u6e96\u5099\u5de5\u4f5c\n\u5982\u9700\u5728 Cloud TPU \u865b\u64ec\u6a5f\u4e0a\u88dd\u8f09 Filestore \u5be6\u4f8b\uff0c\u60a8\u9700\u8981\u5411\u8207 Cloud TPU \u865b\u64ec\u6a5f\u95dc\u806f\u7684\u670d\u52d9\u5e33\u865f\u6dfb\u52a0 Filestore \u89d2\u8272\uff08Cloud Filestore Editor \u6216 Cloud Filestore Viewer\uff09\u3002\u5982\u679c\u60a8\u5728\u5275\u5efa Cloud TPU \u865b\u64ec\u6a5f\u6642\u672a\u6307\u5b9a\u81ea\u5b9a\u7fa9\u670d\u52d9\u5e33\u865f\uff0c\u5247 Cloud TPU \u865b\u64ec\u6a5f\u5c07\u4f7f\u7528\u9ed8\u8a8d\u7684 Compute Engine \u670d\u52d9\u5e33\u865f\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5728\u5275\u5efa Cloud TPU \u865b\u64ec\u6a5f\u6642\u6307\u5b9a\u670d\u52d9\u5e33\u865f\uff0c\u8acb\u53c3\u95b1 [\u8a2d\u7f6e Cloud TPU \u74b0\u5883](https://cloud.google.com/tpu/docs/setup-gcp-account?hl=zh-cn#prepare-to-request) \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5275\u5efa\u670d\u52d9\u5e33\u865f\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u670d\u52d9\u5e33\u865f](https://cloud.google.com/iam/docs/service-accounts-create?hl=zh-cn) \u3002\n### \u5411\u670d\u52d9\u5e33\u865f\u6dfb\u52a0 Filestore Editor \u89d2\u8272\n\u4ee5\u4e0b\u8aaa\u660e\u4ecb\u7d39\u77ad\u5982\u4f55\u5c07 Cloud Filestore Editor \u89d2\u8272\u6dfb\u52a0\u5230 Compute Engine \u9ed8\u8a8d\u670d\u52d9\u5e33\u865f\u3002\u60a8\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u5c07 Cloud Filestore Editor \u89d2\u8272\u6dfb\u52a0\u5230\u4efb\u4f55\u670d\u52d9\u5e33\u865f\u3002\u60a8\u53ef\u4ee5\u5728\u7b2c 2 \u6b65\u4e2d\u641c\u7d22\u4e26\u4f7f\u7528\u81ea\u5b9a\u7fa9\u670d\u52d9\u5e33\u865f\uff0c\u800c\u4e0d\u662f Compute Engine \u9ed8\u8a8d\u670d\u52d9\u5e33\u865f\u3002\n- \u6253\u958b [IAM \u63a7\u5236\u6aaf](https://console.cloud.google.com/iam-admin/iam?hl=zh-cn) \u3002\n- \u9078\u64c7 **\u6309\u4e3b\u8cec\u865f\u67e5\u770b** \u6a19\u7c64\u9801\uff0c\u7136\u5f8c\u5728 **\u904e\u6ffe\u689d\u4ef6** \u5b57\u6bb5\u4e2d\u8f38\u5165 `Name:Compute Engine default service account` \u3002\n- \u9ede\u64ca\u670d\u52d9\u5e33\u865f\u65c1\u908a\u7684 edit \u3002 IAM \u63a7\u5236\u6aaf\u6703\u986f\u793a\u4e00\u500b\u5c0d\u8a71\u6846\uff0c\u5217\u51fa\u5206\u914d\u7d66 Compute Engine \u9ed8\u8a8d\u670d\u52d9\u5e33\u865f\u7684\u89d2\u8272\u3002\n- \u9ede\u64ca add \u53ef\u6dfb\u52a0\u5176\u4ed6\u89d2\u8272\u3002\n- \u5c55\u958b **\u9078\u64c7\u89d2\u8272** \u4e0b\u62c9\u83dc\u55ae\uff0c\u5728\u904e\u6ffe\u689d\u4ef6\u4e2d\u8f38\u5165 `Filestore` \uff0c\u7136\u5f8c\u9078\u64c7 **Cloud Filestore \u7de8\u8f2f\u5668** \u3002\n- \u9ede\u64ca **\u4fdd\u5b58** \u4ee5\u95dc\u9589\u5c0d\u8a71\u6846\u3002\u60a8\u5df2\u5c07 Filestore Editor \u89d2\u8272\u6dfb\u52a0\u5230 Compute Engine \u9ed8\u8a8d\u670d\u52d9\u5e33\u865f\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u670d\u52d9\u5e33\u865f\uff0c\u8acb\u53c3\u95b1 [\u670d\u52d9\u5e33\u865f\u6982\u89bd](https://cloud.google.com/iam/docs/service-account-overview?hl=zh-cn) \u3002 \u5982\u9700\u8a73\u7d30\u77ad\u89e3 IAM \u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [\u89d2\u8272\u548c\u6b0a\u9650](https://cloud.google.com/iam/docs/roles-overview?hl=zh-cn) \u3002\n### \u5275\u5efa\u4e00\u500b Filestore \u5be6\u4f8b\n\u6309\u7167 [\u5275\u5efa Filestore \u5be6\u4f8b](https://cloud.google.com/filestore/docs/creating-instances?hl=zh-cn) \u4e2d\u7684\u8aaa\u660e\u5275\u5efa\u4e00\u500b Filestore \u5be6\u4f8b\u3002\n## \u5728 Cloud TPU \u865b\u64ec\u6a5f\u4e0a\u88dd\u8f09 Filestore \u5be6\u4f8b\n\u7528\u65bc\u5728 Cloud TPU \u4e0a\u88dd\u8f09 Filestore \u5be6\u4f8b\u7684\u547d\u4ee4\u53d6\u6c7a\u65bc\u60a8\u4f7f\u7528\u7684\u662f\u55ae\u500b Cloud TPU \u9084\u662f Cloud TPU Pod \u5207\u7247\u3002\n### \u5728\u55ae\u500b Cloud TPU \u865b\u64ec\u6a5f\u4e0a\u88dd\u8f09 Filestore \u5be6\u4f8b\n- \u4f7f\u7528 SSH \u9023\u63a5\u5230\u60a8\u7684 Cloud TPU \u865b\u64ec\u6a5f\u3002```\n\u00a0 \u00a0 \u00a0 gcloud compute tpus tpu-vm ssh your-tpu-name \\\u00a0 \u00a0 \u00a0 \u00a0 --zone=your-zone\u00a0 \u00a0 \n```\n- \u5b89\u88dd`nfs-common`\u8edf\u4ef6\u5305\u3002```\n\u00a0 \u00a0 \u00a0 sudo apt-get update --allow-releaseinfo-change \\\u00a0 \u00a0 \u00a0 \u00a0 && sudo apt-get -y update \\\u00a0 \u00a0 \u00a0 \u00a0 && sudo apt-get -y install nfs-common\u00a0 \u00a0 \n```\n- \u5275\u5efa\u4e00\u500b\u8981\u5728\u5176\u4e2d\u88dd\u8f09 NFS \u7684\u76ee\u9304```\n\u00a0 \u00a0 \u00a0 sudo mkdir -p mount-dir \\\u00a0 \u00a0 \u00a0 \u00a0 && sudo chmod ugo+rw mount-dir\u00a0 \u00a0 \n```\n- \u627e\u5230 Filestore \u7684 IP \u5730\u5740\u3002```\n\u00a0 \u00a0 \u00a0 gcloud filestore instances describe filestore-instance-name \\\u00a0 \u00a0 \u00a0 \u00a0 --region filestore-region\u00a0 \u00a0 \n```\n- \u5c07 Cloud TPU \u865b\u64ec\u6a5f\u4e0a\u7684 Filestore \u5be6\u4f8b\u88dd\u8f09\u5230\u88dd\u8f09\u76ee\u9304\u3002```\n\u00a0 \u00a0 \u00a0 sudo mount filestore-ip:file-share-name mount-dir-name\u00a0 \u00a0 \n```\n### \u5728 Cloud TPU Pod \u5207\u7247\u4e0a\u88dd\u8f09 Filestore \u5be6\u4f8b\nCloud TPU Pod \u5207\u7247\u7531 2 \u500b\u6216\u66f4\u591a Cloud TPU \u865b\u64ec\u6a5f\u7d44\u6210\u3002\u4ee5\u4e0b\u547d\u4ee4\u4f7f\u7528\u5e36\u6709 `--worker=all` \u548c `--command` \u6a19\u8a8c\u7684 `gcloud compute tpus tpu-vm ssh` \u547d\u4ee4\uff0c\u4ee5\u4e00\u6b21\u6027\u5728\u6240\u6709 Cloud TPU \u865b\u64ec\u6a5f\u4e0a\u904b\u884c\u9019\u4e9b\u547d\u4ee4\u3002\n- \u5728 Pod \u5207\u7247\u4e2d\u7684\u6240\u6709 Cloud TPU \u865b\u64ec\u6a5f\u4e0a\u5b89\u88dd`nfs-common`\u8edf\u4ef6\u5305\u3002```\n\u00a0 \u00a0 \u00a0 \u00a0 gcloud compute tpus tpu-vm ssh your-tpu-name \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 --project=your-gcp-project \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 --zone=your-zone \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 --worker=all \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 --command=\"sudo apt-get update --allow-releaseinfo-change && sudo apt-get -y update && sudo apt-get -y install nfs-common\"\u00a0 \u00a0 \u00a0 \n```\n- \u5275\u5efa\u4e00\u500b\u8981\u5728\u5176\u4e2d\u88dd\u8f09 Filestore \u5be6\u4f8b\u7684\u76ee\u9304\u3002  \u5c07`mount-dir-name`\u66ff\u63db\u7232\u60a8\u9078\u64c7\u7684\u76ee\u9304\u540d\u7a31\u3002```\n\u00a0 \u00a0 \u00a0 gcloud compute tpus tpu-vm ssh your-tpu-name \\\u00a0 \u00a0 \u00a0 \u00a0 --project=your-gcp-project \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 --zone=your-zone \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 --worker=all \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 --command=\"sudo mkdir -p mount-dir-name && sudo chmod ugo+rw mount-dir-name\"\u00a0 \u00a0 \u00a0 \n```\n- \u627e\u5230 Filestore \u5be6\u4f8b\u7684 IP \u5730\u5740\u3002```\n\u00a0 \u00a0 \u00a0 gcloud filestore instances describe filestore-instance-name \\\u00a0 \u00a0 \u00a0 \u00a0 --region filestore-region\u00a0 \u00a0 \n```\n- \u5728 Cloud TPU \u865b\u64ec\u6a5f\u4e0a\u88dd\u8f09 Filestore \u5be6\u4f8b\u3002\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a```\n\u00a0 \u00a0 \u00a0 sudo mount filestore-ip:file-share-name mount-dir\u00a0 \u00a0 \n```## \u5c07\u6578\u64da\u5beb\u5165 Filestore \u5be6\u4f8b\n\u78ba\u4fdd\u60a8\u5411\u88dd\u8f09 Filestore \u5be6\u4f8b\u7684\u76ee\u9304\u6388\u4e88\u4e86 Linux \u7684\u8b80\u5beb\u6b0a\u9650\u3002\u60a8\u53ef\u4ee5\u50cf\u4f7f\u7528\u672c\u5730\u6587\u4ef6\u7cfb\u7d71\u4e00\u6a23\u4f7f\u7528\u8a72\u76ee\u9304\u3002", "guide": "Cloud TPU"}