{"title": "Cloud TPU - \u6392\u67e5 JAX \u554f\u984c - TPU", "url": "https://cloud.google.com/tpu/docs/troubleshooting/trouble-jax?hl=zh-cn", "abstract": "# Cloud TPU - \u6392\u67e5 JAX \u554f\u984c - TPU\n# \u6392\u67e5 JAX \u554f\u984c - TPU\n\u672c\u6307\u5357\u63d0\u4f9b\u4e86 JAX \u554f\u984c\u6392\u67e5\u4fe1\u606f\uff0c\u53ef\u5e6b\u52a9\u60a8\u8b58\u5225\u548c\u89e3\u6c7a\u5728 Cloud TPU \u4e0a\u8a13\u7df4 JAX \u6a21\u578b\u6642\u53ef\u80fd\u9047\u5230\u7684\u554f\u984c\u3002\n\u5982\u9700\u67e5\u770b\u66f4\u901a\u7528\u7684 Cloud TPU \u4f7f\u7528\u5165\u9580\u6307\u5357\uff0c\u8acb\u53c3\u95b1 [JAX \u5feb\u901f\u5165\u9580](https://cloud.google.com/tpu/docs/run-calculation-jax?hl=zh-cn) \u3002\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u4f7f\u7528\u672c\u6307\u5357\u7121\u6cd5\u89e3\u6c7a\u554f\u984c\uff0c\u8acb\u53c3\u95b1 [\u7372\u53d6\u652f\u6301](https://cloud.google.com/tpu/docs/getting-support?hl=zh-cn) \uff0c\u4ee5\u7372\u53d6\u9032\u4e00\u6b65\u5e6b\u52a9\u3002\n", "content": "## \u5e38\u898f JAX \u554f\u984c\n\u5982\u679c\u60a8\u5728\u958b\u767c\u8a13\u7df4\u6a21\u578b\u6216\u4f7f\u7528 JAX \u9032\u884c\u8a13\u7df4\u6642\u9047\u5230\u554f\u984c\uff0c\u8acb\u53c3\u95b1 [JAX \u5e38\u898b\u554f\u984c\u89e3\u7b54](https://jax.readthedocs.io/en/latest/faq.html) \u3002\n\u5982\u9700\u77ad\u89e3\u4f7f\u7528 JAX \u7de8\u5beb\u8a13\u7df4\u61c9\u7528\u6642\u53ef\u80fd\u9047\u5230\u7684\u66f4\u591a\u5e38\u898f\u7de8\u7a0b\u932f\u8aa4\uff0c\u8acb\u53c3\u95b1 [JAX \u932f\u8aa4](https://jax.readthedocs.io/en/latest/errors.html) \u3002\n## \u5206\u6790 JAX \u6027\u80fd\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u5256\u6790 JAX \u6027\u80fd](https://jax.readthedocs.io/en/latest/profiling.html) \u4e2d\u6240\u8ff0\u7684\u5de5\u5177\uff0c\u77ad\u89e3 TPU \u8cc7\u6e90\u7684\u4f7f\u7528\u65b9\u5f0f\u3002\n## \u6392\u67e5\u5167\u5b58\u554f\u984c\n**\u6ce8\u610f** \uff1aTPU \u5167\u5b58\uff08 [\u9ad8\u5e36\u5bec\u5167\u5b58](https://cloud.google.com/tpu/docs/system-architecture-tpu-vm?hl=zh-cn#versions) \u5728\u6bcf\u500b TPU \u82af\u7247\u4e4b\u9593\u5171\u4eab\u3002\u9019\u6a23\u53ef\u4ee5\u5728\u5169\u500b\u82af\u7247\u4e0a TensorCore \u4e4b\u9593\u9032\u884c\u9ad8\u6548\u5354\u8abf\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [JAX \u8a2d\u5099\u5167\u5b58\u5206\u6790\u5668](https://jax.readthedocs.io/en/latest/device_memory_profiling.html) \u76e3\u63a7\u5167\u5b58\u7684\u4f7f\u7528\u60c5\u6cc1\uff0c\u4f46\u7121\u6cd5\u76f4\u63a5\u7ba1\u7406\u5176\u4f7f\u7528\u65b9\u5f0f\u3002\n\u8a2d\u5099\u5167\u5b58\u5206\u6790\u5668\u53ef\u7528\u65bc\uff1a\n- \u627e\u51fa\u7d66\u5b9a\u6642\u9593 [TPU \u5167\u5b58\u4e2d\u6709\u54ea\u4e9b\u6578\u7d44\u548c\u53ef\u57f7\u884c\u6587\u4ef6](https://jax.readthedocs.io/en/latest/device_memory_profiling.html#understanding-how-a-jax-program-is-using-gpu-or-tpu-memory) \uff0c\u6216\u8005\n- [\u8ddf\u8e64\u5167\u5b58\u6cc4\u6f0f\u3002](https://jax.readthedocs.io/en/latest/device_memory_profiling.html#debugging-memory-leaks) \n\u60a8\u7121\u6cd5\u6307\u5b9a\u5982\u4f55\u7232\u7279\u5b9a\u64cd\u4f5c\u5206\u914d TPU \u5167\u5b58\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u7279\u5b9a\u65bc JAX \u7684 TPU \u6027\u80fd\u554f\u984c\uff0c\u8acb\u53c3\u95b1 [\u5c07 TPU \u8207 JAX \u642d\u914d\u4f7f\u7528\u7684\u6027\u80fd\u8aaa\u660e](https://cloud.google.com/tpu/docs/run-calculation-jax?hl=zh-cn#performance_notes) \u3002\n## \u6392\u67e5 TPU \u554f\u984c\n### \u5982\u4f55\u9a57\u8b49 TPU \u662f\u5426\u6b63\u5728\u904b\u884c\uff1f\n**\u8a73\u60c5**\n\u53ea\u8981 JAX \u4e0d\u8f38\u51fa\u201c\u627e\u4e0d\u5230 GPU/TPU\uff0c\u56de\u9000\u5230 CPU\u201d\uff0c\u4e00\u5207\u90fd\u6703\u5728 TPU \u4e0a\u904b\u884c\u3002\n\u60a8\u53ef\u4ee5\u901a\u904e\u67e5\u770b `jax.devices()` \uff08\u5176\u4e2d\u61c9\u8a72\u6703\u986f\u793a\u591a\u500b TPU \u8a2d\u5099\uff09\u4f86\u9a57\u8b49 TPU \u8655\u65bc\u6d3b\u8e8d\u72c0\u614b\uff0c\u6216\u8005\u4f7f\u7528 `assert jax.devices()[0].platform == 'tpu'` \u4ee5\u7de8\u7a0b\u65b9\u5f0f\u9032\u884c\u9a57\u8b49\u3002\n### RuntimeError\uff1a\u7121\u6cd5\u521d\u59cb\u5316\u5f8c\u7aef\u201ctpu\u201d\uff1aUNAVAILABLE\uff1a\u6c92\u6709\u53ef\u7528\u7684 TPU \u5e73\u81fa\u3002\n**\u8a73\u7d30\u4fe1\u606f**\n\u6b64\u904b\u884c\u6642\u932f\u8aa4\u6d88\u606f\u548c/\u6216\u5728 TPU \u865b\u64ec\u6a5f\u7684 `/tmp/tpu_logs/tpu_driver.WARNING` \u4e2d\u627e\u5230\u4ee5\u4e0b\u5167\u5bb9\uff1a `W1118 17:40:20.985243 23901 tpu_version_flag.cc:57] No hardware is found. Using default TPU version:xxxxxx` \u53ef\u80fd\u8868\u793a\u60a8\u904b\u884c\u7684 TPU \u865b\u64ec\u6a5f\u7248\u672c\u6709\u8aa4\u3002\n\u8acb\u9a57\u8b49\u60a8\u904b\u884c\u7684\u662f\u5426\u7232 [\u7576\u524d JAX \u904b\u884c\u6642\u7248\u672c](https://cloud.google.com/tpu/docs/supported-tpu-versions?hl=zh-cn#jax) \uff0c\u7136\u5f8c\u91cd\u8a66\u3002", "guide": "Cloud TPU"}