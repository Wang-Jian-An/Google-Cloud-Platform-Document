{"title": "Cloud TPU - \u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u7528\u6236\u6307\u5357", "url": "https://cloud.google.com/tpu/docs/queued-resources?hl=zh-cn", "abstract": "# Cloud TPU - \u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u7528\u6236\u6307\u5357\n# \u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u7528\u6236\u6307\u5357\n\u901a\u904e\u6392\u968a\u7684\u8cc7\u6e90\uff0c\u60a8\u80fd\u4ee5\u6392\u968a\u65b9\u5f0f\u8acb\u6c42 Cloud TPU \u8cc7\u6e90\u3002\u7576\u60a8\u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u6642\uff0c\u8acb\u6c42\u6703\u88ab\u6dfb\u52a0\u5230\u7531 Cloud TPU \u670d\u52d9\u7dad\u8b77\u7684\u968a\u5217\u4e2d\u3002\u7576\u8acb\u6c42\u7684\u8cc7\u6e90\u53ef\u7528\u6642\uff0c\u7cfb\u7d71\u5c31\u6703\u5c07\u5b83\u5206\u914d\u7d66\u60a8\u7684 Google Cloud \u9805\u76ee\uff0c\u4f9b\u60a8\u7acb\u5373\u5c08\u7528\u4f7f\u7528\u3002\u9664\u975e\u60a8\u522a\u9664\u5b83\u6216\u5b83\u88ab\u6436\u4f54\uff0c\u5426\u5247\u5b83\u6703\u4e00\u76f4\u5206\u914d\u7d66\u60a8\u7684\u9805\u76ee\u3002\u53ea\u6709\u6436\u4f54\u5f0f TPU \u624d\u7b26\u5408\u6436\u4f54\u689d\u4ef6\u3002\n**\u6ce8\u610f** \uff1a\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u50c5\u9069\u7528\u65bc [TPU \u865b\u64ec\u6a5f\u67b6\u69cb](https://cloud.google.com/tpu/docs/system-architecture-tpu-vm?hl=zh-cn#tpu-vm) \u3002\n\u60a8\u53ef\u4ee5\u5728\u6392\u968a\u7684\u8cc7\u6e90\u8acb\u6c42\u4e2d\u6307\u5b9a\u53ef\u9078\u7684 [\u958b\u59cb\u6642\u9593\u548c\u7d50\u675f\u6642\u9593](#request-queued-specified-time) \u3002\u958b\u59cb\u6642\u9593\u7528\u65bc\u6307\u5b9a\u586b\u5145\u8acb\u6c42\u7684\u6700\u65e9\u6642\u9593\u3002\u5982\u679c\u8acb\u6c42\u672a\u5728\u6307\u5b9a\u7684\u7d50\u675f\u6642\u9593\u4e4b\u524d\u586b\u5145\uff0c\u5247\u8acb\u6c42\u5c07\u904e\u671f\u3002\u8acb\u6c42\u904e\u671f\u5f8c\uff0c\u4ecd\u4fdd\u7559\u5728\u968a\u5217\u4e2d\u3002\n\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\u53ef\u80fd\u8655\u65bc\u4ee5\u4e0b\u67d0\u7a2e\u72c0\u614b\uff1a\n", "content": "## \u524d\u63d0\u689d\u4ef6\n\u5728\u904b\u884c\u672c\u6307\u5357\u4e2d\u7684\u547d\u4ee4\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\uff1a\n- \u5b89\u88dd [Google Cloud CLI Alpha \u7248\u7d44\u4ef6](https://cloud.google.com/sdk/gcloud/reference/components/install?hl=zh-cn) \n- \u5553\u7528 [Cloud TPU API](https://console.cloud.google.com/apis/library/tpu.googleapis.com?_ga=2.174913505.2116185568.1664815833-671377895.1662479582&%3B_gac=1.184538452.1663874535.Cj0KCQjwj7CZBhDHARIsAPPWv3diPfi1d-VcluDdaKlKf4CZnZ1K9DUABPC1VeRRurakgONsiLWUVMoaAmANEALw_wcB&hl=zh-cn) ## \u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u6309\u9700\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `gcloud alpha compute tpus queued-resources create` \u547d\u4ee4\u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6309\u9700\u8cc7\u6e90\uff0c\u8acb\u53c3\u95b1 [\u914d\u984d\u985e\u578b](https://cloud.google.com/tpu/docs/quota?hl=zh-cn#quota_types) \u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project \\--zone us-central2-b \\--accelerator-type v4-8 \\--runtime-version tpu-vm-tf-2.16.1-pjrt\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-8',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pjrt',\u00a0 \u00a0 }\u00a0 }}}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```### \u6309\u9700\u6392\u968a\u7684\u8cc7\u6e90\u7684\u9ed8\u8a8d\u5207\u7247\u5927\u5c0f\n\u4f7f\u7528\u6309\u9700\u914d\u984d\u6642\uff0c\u60a8\u8acb\u6c42\u7684\u5207\u7247\u5927\u5c0f\u5fc5\u9808\u5c0f\u65bc\u60a8\u6b63\u5728\u4f7f\u7528\u7684\u52a0\u901f\u5668\u985e\u578b\u7684\u9ed8\u8a8d\u9650\u5236\u3002\u7cfb\u7d71\u6703\u62d2\u7d55\u8d85\u51fa\u9ed8\u8a8d\u9650\u5236\u7684\u8acb\u6c42\u3002\n\u4e0b\u8868\u986f\u793a\u4e86 TPU \u985e\u578b\u53ca\u5176\u95dc\u806f\u7684\u9ed8\u8a8d\u9650\u5236\u3002\n| 0   | 1       |\n|:-----------|:----------------------------|\n| \u52a0\u901f\u5668\u985e\u578b | \u9ed8\u8a8d\u9650\u5236\uff08TensorCore \u6578\u91cf\uff09 |\n| v2   | 128       |\n| v3   | 128       |\n| v4   | 384       |\n| v5   | 32       |\n\u5982\u679c\u60a8\u9700\u8981\u66f4\u5927\u7684\u5207\u7247\uff0c\u8acb\u8207 Cloud TPU \u652f\u6301\u5718\u968a\u806f\u7e6b\u4ee5\u77ad\u89e3\u8a73\u60c5\u3002\n## \u4f7f\u7528\u9810\u7559\u914d\u984d\u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u9810\u7559\u914d\u984d\u8acb\u6c42\u6392\u968a\u7684\u8cc7\u6e90\uff0c\u65b9\u6cd5\u662f\u5728 `gcloud` \u547d\u4ee4\u4e2d\u6307\u5b9a `--reserved` \u6a19\u8a8c\u6216\u5728 curl \u8acb\u6c42\u4e2d\u6307\u5b9a `guaranteed.reserved=true` \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u9810\u7559\u914d\u984d\uff0c\u8acb\u53c3\u95b1 [\u914d\u984d\u985e\u578b](https://cloud.google.com/tpu/docs/quota?hl=zh-cn#quota_types) \u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project \\--zone us-central2-b \\--accelerator-type v4-8 \\--runtime-version tpu-vm-tf-2.16.1-pjrt \\--reserved\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-8',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pjrt',\u00a0 \u00a0 }\u00a0 }},'guaranteed': {\u00a0 'reserved': true,}}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```\n## \u8acb\u6c42\u6436\u4f54\u5f0f\u6392\u968a\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u8acb\u6c42\u6436\u4f54\u5f0f\u6392\u968a\u7684\u8cc7\u6e90\u3002 [\u6436\u4f54\u5f0f\u8cc7\u6e90](https://cloud.google.com/tpu/docs/preemptible?hl=zh-cn) \u662f\u4e00\u7a2e\u53ef\u5728\u5176\u4ed6\u5de5\u4f5c\u8ca0\u8f09\u9700\u8981\u984d\u5916\u8cc7\u6e90\u6642\u5206\u914d\u7d66\u5176\u4ed6\u5de5\u4f5c\u8ca0\u8f09\u7684\u8cc7\u6e90\u3002\u8207\u975e\u6436\u4f54\u5f0f\u8acb\u6c42\u76f8\u6bd4\uff0c\u6436\u4f54\u5f0f\u8cc7\u6e90\u7684\u8cbb\u7528\u66f4\u4f4e\uff0c\u800c\u4e14\u60a8\u53ef\u4ee5\u66f4\u5feb\u5730\u8a2a\u554f\u8cc7\u6e90\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6436\u4f54\u5f0f\u914d\u984d\uff0c\u8acb\u53c3\u95b1 [\u914d\u984d\u985e\u578b](https://cloud.google.com/tpu/docs/quota?hl=zh-cn#quota_types) \u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project-id \\--zone us-central2-b \\--accelerator-type v4-8 \\--runtime-version tpu-vm-tf-2.16.1-pjrt \\--best-effort\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-8',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pjrt',\u00a0 \u00a0 }\u00a0 }},'best_effort': {}}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```\n## \u8acb\u6c42\u5728\u6307\u5b9a\u6642\u9593\u4e4b\u524d\u6216\u4e4b\u5f8c\u5206\u914d\u6392\u968a\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u5728\u6392\u968a\u7684\u8cc7\u6e90\u8acb\u6c42\u4e2d\u6307\u5b9a\u53ef\u9078\u7684 [\u958b\u59cb\u6642\u9593](#request-queued-after-time) \u3001 [\u7d50\u675f\u6642\u9593](#request-queued-until-time) \u3001 [\u958b\u59cb\u6642\u9577](#request-queued-after-duration) \u6216 [\u7d50\u675f\u6642\u9577](#request-queued-until-duration) \u3002\u958b\u59cb\u6642\u9593\u6216\u958b\u59cb\u6642\u9577\u7528\u65bc\u6307\u5b9a\u586b\u5145\u8acb\u6c42\u7684\u6700\u65e9\u6642\u9593\u3002\u5982\u679c\u8acb\u6c42\u672a\u5728\u6307\u5b9a\u7684\u7d50\u675f\u6642\u9593\u6216\u6307\u5b9a\u7684\u6301\u7e8c\u6642\u9593\u5167\u586b\u5145\uff0c\u5247\u8acb\u6c42\u5c07\u904e\u671f\u3002\u8acb\u6c42\u904e\u671f\u5f8c\uff0c\u5b83\u4ecd\u4fdd\u7559\u5728\u968a\u5217\u4e2d\uff0c\u4f46\u4e0d\u518d\u7b26\u5408\u5206\u914d\u689d\u4ef6\u3002\n\u6b64\u5916\uff0c\u60a8\u9084\u53ef\u4ee5\u901a\u904e\u6307\u5b9a\u958b\u59cb\u6642\u9593\u6216\u6642\u9577\u4ee5\u53ca\u7d50\u675f\u6642\u9593\u6216\u6642\u9577\u4f86\u6307\u5b9a\u5206\u914d\u9593\u9694\u3002 [](#request-queued-interval)\n\u5982\u9700\u67e5\u770b\u652f\u6301\u7684\u6642\u9593\u6233\u548c\u6642\u9577\u683c\u5f0f\u7684\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [\u65e5\u671f\u6642\u9593](https://cloud.google.com/sdk/gcloud/reference/topic/datetimes?hl=zh-cn) \u3002\n### \u5728\u6307\u5b9a\u6642\u9577\u5f8c\u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `--valid-after-duration` \u6a19\u8a8c\u6307\u5b9a\u8cc7\u6e90\u7684\u5206\u914d\u6642\u9577\u3002\u4ee5\u4e0b\u793a\u4f8b\u8acb\u6c42\u5728 6 \u5c0f\u6642\u5f8c\u5206\u914d v4-32\u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project-id \\--zone us-central2-b \\--accelerator-type v4-32 \\--runtime-version tpu-vm-tf-2.16.1-pod-pjrt \\--valid-after-duration 6h\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-32',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pod-pjrt',\u00a0 \u00a0 }\u00a0 }},'queueing_policy': {\u00a0 'valid_after_duration': {\u00a0 \u00a0 'seconds': 21600\u00a0 }}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```### \u8acb\u6c42\u5728\u6307\u5b9a\u6642\u9577\u5f8c\u5230\u671f\u7684\u6392\u968a\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `--valid-until-duration` \u6a19\u8a8c\u6307\u5b9a\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\u4fdd\u6301\u6709\u6548\u7684\u6642\u9577\u3002\u4ee5\u4e0b\u793a\u4f8b\u8acb\u6c42\u7684\u662f v4-32\uff0c\u5982\u679c\u672a\u5728 6 \u5c0f\u6642\u5167\u586b\u5beb\uff0cv4-32 \u5c31\u6703\u904e\u671f\u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project-id \\--zone us-central2-b \\--accelerator-type v4-32 \\--runtime-version tpu-vm-tf-2.16.1-pod-pjrt \\--valid-until-duration 6h\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-32',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pod-pjrt',\u00a0 \u00a0 }\u00a0 }},'queueing_policy': {\u00a0 'valid_until_duration': {\u00a0 \u00a0 'seconds': 21600\u00a0 }}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```### \u5728\u6307\u5b9a\u6642\u9593\u5f8c\u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `--valid-after-time` \u6a19\u8a8c\u6307\u5b9a\u61c9\u5728\u591a\u9577\u6642\u9593\u5f8c\u5206\u914d\u8cc7\u6e90\u3002\n\u4ee5\u4e0b\u547d\u4ee4\u8acb\u6c42\u5728 2022 \u5e74 12 \u6708 14 \u65e5\u4e0a\u5348 9 \u9ede\u4e4b\u5f8c\u5206\u914d\u904b\u884c\u6642\u7248\u672c\u7232 `tpu-vm-tf-2.16.1-pjrt` \u7684 v4-4096 TPU\u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project-id \\--zone us-central2-b \\--accelerator-type v4-4096 \\--runtime-version tpu-vm-tf-2.16.1-pod-pjrt \\--valid-after-time 2022-12-14T09:00:00Z\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-4096',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pod-pjrt',\u00a0 \u00a0 }\u00a0 }},'queueing_policy': {\u00a0 'valid_after_time': {\u00a0 \u00a0 'seconds': 2022-12-14T09:00:00Z\u00a0 }}}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```### \u5728\u6307\u5b9a\u6642\u9593\u4e4b\u524d\u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `--valid-until-time` \u6a19\u8a8c\u6307\u5b9a\u61c9\u5728\u54ea\u500b\u6642\u9593\u4e4b\u524d\u5206\u914d\u8cc7\u6e90\u3002\n\u4ee5\u4e0b\u547d\u4ee4\u8acb\u6c42\u5728 2022 \u5e74 12 \u6708 14 \u65e5\u4e0a\u5348 9:00 \u4e4b\u524d\u5275\u5efa\u904b\u884c\u6642\u7248\u672c\u7232 `tpu-vm-tf-2.10.0-pod` \u7684 v4-4096 TPU \u7bc0\u9ede\u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project-id \\--zone us-central2-b \\--accelerator-type v4-4096 \\--runtime-version tpu-vm-tf-2.16.1-pod-pjrt \\--valid-until-time 2022-12-14T09:00:00Z\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-4096',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pod-pjrt',\u00a0 \u00a0 }\u00a0 }},'queueing_policy': {\u00a0 'valid_until_time': {\u00a0 \u00a0 'seconds': 1655197200\u00a0 }}}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```### \u8acb\u6c42\u5728\u6307\u5b9a\u6642\u9593\u9593\u9694\u5167\u5206\u914d\u6392\u968a\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f\u5c0d `--valid-after-time` \u3001 `--valid-after-duration` \u3001 `--valid-until-duration` \u548c `--valid-until-time` \u6a19\u8a8c\u4f86\u6307\u5b9a\u5206\u914d\u9593\u9694\uff0c\u524d\u63d0\u662f\u5176\u4e2d\u4e00\u500b\u6a19\u8a8c\u6307\u5b9a\u5206\u914d\u9593\u9694\u7684\u958b\u59cb\u6642\u9593\uff0c\u53e6\u4e00\u500b\u6a19\u8a8c\u7528\u65bc\u6307\u5b9a\u5206\u914d\u9593\u9694\u7684\u7d50\u675f\u3002\n\u4ee5\u4e0b\u547d\u4ee4\u8acb\u6c42\u5f9e\u7576\u524d\u6642\u9593\u8d77 5 \u5c0f\u6642 30 \u5206\u9418\u5167\u5275\u5efa v4-32\uff0c\u5176\u5275\u5efa\u6642\u9593\u4e0d\u665a\u65bc 2022 \u5e74 12 \u6708 14 \u65e5\u4e0a\u5348 9:00\u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project-id \\--zone us-central2-b \\--accelerator-type v4-32 \\--runtime-version tpu-vm-tf-2.16.1-pod-pjrt \\--valid-after-duration 5h30m \\--valid-until-time 2022-12-14T09:00:00Z\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-32',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pod-pjrt',\u00a0 \u00a0 }\u00a0 }},'queueing_policy': {\u00a0 'validInterval': {\u00a0 \u00a0 'startTime': '2022-12-10T14:30:00Z',\u00a0 \u00a0 'endTime': '2022-12-14T09:00:00Z'\u00a0 }},}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```\n## \u4f7f\u7528\u5553\u52d5\u8173\u672c\u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u6307\u5b9a\u5728\u9810\u914d\u5f8c\u5728\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u4e0a\u904b\u884c\u7684\u8173\u672c\u3002\u4f7f\u7528 `gcloud` \u547d\u4ee4\u6642\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 `--metadata` \u6216 `--metadata-from-file` \u6a19\u8a8c\u5206\u5225\u6307\u5b9a\u8173\u672c\u547d\u4ee4\u6216\u5305\u542b\u8173\u672c\u4ee3\u78bc\u7684\u6587\u4ef6\u3002\u4f7f\u7528 `curl` \u6642\uff0c\u60a8\u5fc5\u9808\u5728 JSON \u5167\u5bb9\u4e2d\u5305\u542b\u8173\u672c\u4ee3\u78bc\u3002\u4ee5\u4e0b\u793a\u4f8b\u6703\u5275\u5efa\u4e00\u500b\u6392\u968a\u7684\u8cc7\u6e90\u8acb\u6c42\uff0c\u8a72\u8acb\u6c42\u5c07\u904b\u884c `startup-script.sh` \u4e2d\u5305\u542b\u7684\u8173\u672c\u3002 `curl` \u793a\u4f8b\u986f\u793a\u4e86 JSON \u6b63\u6587\u4e2d\u7684\u5167\u5d4c\u8173\u672c\u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project \\--zone us-central2-b \\--accelerator-type v4-8 \\--runtime-version tpu-vm-tf-2.12.0 \\--reserved \\--metadata-from-file='startup-script=startup-script.sh'\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{tpu: {\u00a0 \u00a0 node_spec: {\u00a0 \u00a0 \u00a0 parent: 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 \u00a0 node_id: 'your-node-id',\u00a0 \u00a0 \u00a0 node: {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 accelerator_type: 'v2-8',\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 runtime_version: 'tpu-vm-tf-2.16.1-pjrt',\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 metadata: {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"startup-script\": \"#! /bin/bash\\npwd > /tmp/out.txt\\nwhoami >> /tmp/out.txt\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }},'queueing_policy': {\u00a0 'validInterval': {\u00a0 \u00a0 'startTime': '2022-12-10T14:30:00Z',\u00a0 \u00a0 'endTime': '2022-12-14T09:00:00Z'\u00a0 }},}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```\n## \u8acb\u6c42\u5177\u6709\u6307\u5b9a\u7db2\u7d61\u548c\u5b50\u7db2\u7684\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\n\u60a8\u53ef\u4ee5\u8acb\u6c42\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\uff0c\u6307\u5b9a\u8981\u5c07 TPU \u9023\u63a5\u5230\u7684\u7db2\u7d61\u548c\u5b50\u7db2\u3002\n```\ngcloud alpha compute tpus queued-resources create your-queued-resource-id \\--node-id your-node-id \\--project your-project \\--zone us-central2-b \\--accelerator-type v4-8 \\--runtime-version tpu-vm-tf-2.16.1-pjrt \\--network network-name \\--subnetwork subnetwork-name\n```\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\-d \"{'tpu': {\u00a0 'node_spec': {\u00a0 \u00a0 'parent': 'projects/your-project-number/locations/us-central2-b',\u00a0 \u00a0 'node_id': 'your-node-id',\u00a0 \u00a0 'node': {\u00a0 \u00a0 \u00a0 'accelerator_type': 'v4-8',\u00a0 \u00a0 \u00a0 'runtime_version': 'tpu-vm-tf-2.16.1-pjrt',\u00a0 \u00a0 \u00a0 \u00a0'network_config': {\u00a0 \u00a0 \u00a0 \u00a0 'network': 'network-name',\u00a0 \u00a0 \u00a0 \u00a0 'subnetwork': 'subnetwork-name',\u00a0 \u00a0 \u00a0 \u00a0 'enable_external_ips': true\u00a0 \u00a0 }\u00a0 }},'guaranteed': {\u00a0 'reserved': true,}}\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources?queued_resource_id=your-queued-resource-id\n```\n## \u522a\u9664\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\n\u60a8\u53ef\u4ee5\u5c07 `--force` \u6a19\u8a8c\u50b3\u905e\u7d66 `queued-resource delete` \u547d\u4ee4\uff0c\u5f9e\u800c\u522a\u9664\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\u4ee5\u53ca\u8a72\u8acb\u6c42\u5275\u5efa\u7684 TPU \u865b\u64ec\u6a5f\u3002\u5426\u5247\uff0c\u60a8\u5fc5\u9808\u5148\u522a\u9664 TPU \u865b\u64ec\u6a5f\uff0c\u7136\u5f8c\u624d\u80fd\u522a\u9664\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\u3002\u522a\u9664 TPU \u865b\u64ec\u6a5f\u6642\uff0c\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\u5c07\u8f49\u63db\u7232 `SUSPENDED` \u72c0\u614b\uff0c\u6b64\u5f8c\uff0c\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\u53ef\u80fd\u6703\u88ab\u522a\u9664\u3002\n\u4ee5\u4e0b\u547d\u4ee4\u5c07\u522a\u9664\u53ef\u7528\u5340\u201cus-central2-b\u201d\u4e2d\u201cmy-project\u201d\u9805\u76ee\u4e2d\u540d\u7232\u201cmy-queued-resource\u201d\u7684\u6392\u968a\u8cc7\u6e90\u8acb\u6c42\u3002\u5b83\u4f7f\u7528 `--force` \u6a19\u8a8c\u522a\u9664 TPU \u865b\u64ec\u6a5f\u548c\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\u3002\n**\u6ce8\u610f** \uff1a\u8a72\u547d\u4ee4\u53ef\u80fd\u9700\u8981\u5169\u5230\u4e94\u5206\u9418\u624d\u80fd\u5b8c\u6210\u3002\u60a8\u53ef\u4ee5\u5c07 `--async` \u6a19\u8a8c\u50b3\u905e\u7d66 `gcloud` \u547d\u4ee4\uff0c\u4ee5\u7570\u6b65\u65b9\u5f0f\u904b\u884c\u8a72\u547d\u4ee4\uff0c\u5982\u4ee5\u4e0b\u547d\u4ee4\u6240\u793a\u3002\n```\ngcloud alpha compute tpus queued-resources delete my-queued-resource \\--project my-project \\--zone us-central2-b \\--force \\--async\n```\n```\ncurl -X DELETE -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\https://tpu.googleapis.com/v2alpha1/projects/my-project/locations/us-central2-b/queuedResources/my-queued-resource?force=true\n```\n\u4ee5\u4e0b\u547d\u4ee4\u5c07\u522a\u9664\u53ef\u7528\u5340\u201cus-central2-b\u201d\u4e2d\u201cmy-project\u201d\u9805\u76ee\u4e2d\u540d\u7232\u201cmy-queued-resource\u201d\u7684\u6392\u968a\u8cc7\u6e90\u8acb\u6c42\u3002\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u672a\u4f7f\u7528\u4e4b\u524d\u4ecb\u7d39\u7684 `--force` \u6a19\u8a8c\uff0c\u5247\u5fc5\u9808\u5148\u522a\u9664 TPU \u865b\u64ec\u6a5f\uff0c\u7136\u5f8c\u624d\u80fd\u522a\u9664\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [gcloud \u53c3\u8003\u6587\u6a94](https://cloud.google.com/sdk/gcloud/reference/alpha/compute/tpus/tpu-vm/delete?hl=zh-cn) \u3002\n```\ngcloud alpha compute tpus queued-resources delete your-queued-resource-id \\--project your-project-id \\--zone us-central2-b\n```\n```\ncurl -X DELETE -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources/your-queued-resource-id\n```\n## \u6aa2\u7d22\u6709\u95dc\u5df2\u52a0\u5165\u968a\u5217\u8cc7\u6e90\u8acb\u6c42\u7684\u72c0\u614b\u548c\u8a3a\u65b7\u4fe1\u606f\n\u6aa2\u7d22\u6709\u95dc\u5df2\u52a0\u5165\u968a\u5217\u8cc7\u6e90\u8acb\u6c42\u7684\u72c0\u614b\u548c\u8a3a\u65b7\u4fe1\u606f\uff1a\n```\ngcloud alpha compute tpus queued-resources describe queued-resource-request-id \\--project your-project-id \\--zone us-central2-b\n```\n```\ncurl -X GET -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources/your-queued-resource-id\n```\n\u5982\u679c\u8acb\u6c42\u5931\u6557\uff0c\u97ff\u61c9\u5c07\u5305\u542b\u932f\u8aa4\u4fe1\u606f\u3002\u5c0d\u65bc\u6b63\u5728\u7b49\u5f85\u8cc7\u6e90\u7684\u8acb\u6c42\uff0c\u8f38\u51fa\u5c07\u5982\u4e0b\u6240\u793a\uff1a\n```\nname: projects/your-project-id/locations/us-central2-b/queuedResources/your-queued-resource-idstate:\u00a0 state: WAITING_FOR_RESOURCEStpu:\u00a0 nodeSpec:\u00a0 - node:\u00a0 \u00a0 \u00a0 acceleratorType: v4-8\u00a0 \u00a0 \u00a0 bootDisk: {}\u00a0 \u00a0 \u00a0 networkConfig:\u00a0 \u00a0 \u00a0 \u00a0 enableExternalIps: true\u00a0 \u00a0 \u00a0 queuedResource: projects/your-project-number/locations/us-central2-b/queuedResources/your-queued-resource-id\u00a0 \u00a0 \u00a0 runtimeVersion: tpu-vm-tf-2.10.0\u00a0 \u00a0 \u00a0 schedulingConfig: {}\u00a0 \u00a0 \u00a0 serviceAccount: {}\u00a0 \u00a0 \u00a0 shieldedInstanceConfig: {}\u00a0 \u00a0 \u00a0 useTpuVm: true\u00a0 \u00a0 nodeId: your-node-id\u00a0 \u00a0 parent: projects/your-project-number/locations/us-central2-b\n```\n## \u5217\u51fa\u9805\u76ee\u4e2d\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\n\u4ee5\u4e0b\u547d\u4ee4\u7528\u65bc\u5217\u51fa\u9805\u76ee\u201cyour-project-id\u201d\u4e2d\u5df2\u52a0\u5165\u968a\u5217\u7684\u8cc7\u6e90\u8acb\u6c42\uff1a\n```\ngcloud alpha compute tpus queued-resources list --project your-project-id \\--zone us-central2-b\n```\n```\ncurl -X GET -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\-H \"Content-Type: application/json\" \\https://tpu.googleapis.com/v2alpha1/projects/your-project-id/locations/us-central2-b/queuedResources\n```", "guide": "Cloud TPU"}