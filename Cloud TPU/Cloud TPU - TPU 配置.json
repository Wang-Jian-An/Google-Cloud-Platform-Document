{"title": "Cloud TPU - TPU \u914d\u7f6e", "url": "https://cloud.google.com/tpu/docs/supported-tpu-configurations?hl=zh-cn", "abstract": "# Cloud TPU - TPU \u914d\u7f6e\n# TPU \u914d\u7f6e\n", "content": "## TPU v5e \u914d\u7f6e\nCloud TPU v5e \u662f\u4e00\u6b3e\u8a13\u7df4\u548c\u63a8\u7406\uff08\u670d\u52d9\uff09\u7522\u54c1\u3002\u5982\u9700\u5340\u5206\u8a13\u7df4\u548c\u63a8\u7406\u74b0\u5883\uff0c\u8acb\u5728\u5275\u5efa GKE \u7bc0\u9ede\u6c60\u6642\u5c07 `AcceleratorType` \u6216 `AcceleratorConfig` \u6a19\u8a8c\u8207 TPU API \u6216 `--machine-type` \u6a19\u8a8c\u7d50\u5408\u4f7f\u7528\u3002 [](https://cloud.google.com/kubernetes-engine/docs/how-to/tpus?hl=zh-cn#create-node-pool)\n\u8a13\u7df4\u4f5c\u696d\u91dd\u5c0d\u541e\u5410\u91cf\u548c\u53ef\u7528\u6027\u9032\u884c\u4e86\u512a\u5316\uff0c\u800c\u8655\u7406\u4f5c\u696d\u91dd\u5c0d\u5ef6\u9072\u6642\u9593\u9032\u884c\u4e86\u512a\u5316\u3002\u56e0\u6b64\uff0c\u5728\u7232\u8a13\u7df4\u9810\u914d\u7684 TPU \u4e0a\u57f7\u884c\u7684\u8a13\u7df4\u4f5c\u696d\u53ef\u80fd\u5177\u6709\u8f03\u4f4e\u7684\u53ef\u7528\u6027\uff1b\u540c\u6a23\uff0c\u5728\u7232\u8a13\u7df4\u9810\u914d\u7684 TPU \u4e0a\u57f7\u884c\u7684\u670d\u52d9\u4f5c\u696d\u53ef\u80fd\u6703\u5177\u6709\u8f03\u9577\u7684\u5ef6\u9072\u6642\u9593\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `AcceleratorType` \u6307\u5b9a\u8981\u4f7f\u7528\u7684 TensorCore \u6578\u91cf\u3002\u4f7f\u7528 gcloud CLI \u6216 [Google Cloud \u63a7\u5236\u6aaf](https://console.cloud.google.com/?hl=zh-cn) \u5275\u5efa TPU \u6642\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a `AcceleratorType` \u3002\u60a8\u7232 `AcceleratorType` \u6307\u5b9a\u7684\u503c\u662f\u4e00\u500b\u5b57\u7b26\u4e32\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a `v$VERSION_NUMBER-$CHIP_COUNT` \u3002\n\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 `AcceleratorConfig` \u6307\u5b9a\u8981\u4f7f\u7528\u7684 TensorCore \u6578\u91cf\u3002\u4f46\u662f\uff0c\u7531\u65bc TPU v5e \u6c92\u6709\u81ea\u5b9a\u7fa9 2D \u62d3\u64b2\u8b8a\u9ad4\uff0c\u56e0\u6b64\u4f7f\u7528 `AcceleratorConfig` \u548c `AcceleratorType` \u6c92\u6709\u5340\u5225\u3002\n\u5982\u9700\u4f7f\u7528 `AcceleratorConfig` \u914d\u7f6e TPU v5e\uff0c\u8acb\u4f7f\u7528 `--version` \u548c `--topology` \u6a19\u8a8c\u3002\u5c07 `--version` \u8a2d\u7f6e\u7232\u60a8\u8981\u4f7f\u7528\u7684 TPU \u7248\u672c\uff0c\u4e26\u5c07 `--topology` \u8a2d\u7f6e\u7232\u5207\u7247\u4e2d TPU \u82af\u7247\u7684\u7269\u7406\u6392\u5217\u65b9\u5f0f\u3002\u60a8\u7232 `AcceleratorConfig` \u6307\u5b9a\u7684\u503c\u662f\u4e00\u500b\u683c\u5f0f\u7232 `AxB` \u7684\u5b57\u7b26\u4e32\uff0c\u5176\u4e2d `A` \u548c `B` \u662f\u6bcf\u500b\u65b9\u5411\u7684\u689d\u72c0\u6a19\u7c64\u8a08\u6578\u3002\nv5e \u652f\u6301\u4ee5\u4e0b 2D \u5207\u7247\u5f62\u72c0\uff1a\n| 0  | 1    | 2  |\n|:------|:---------------|:---------|\n| \u62d3\u64b2 | TPU \u82af\u7247\u7684\u6578\u91cf | \u4e3b\u6a5f\u6578\u91cf |\n| 1x1 | 1    | 1/8  |\n| 2x2 | 4    | 1/2  |\n| 2x4 | 8    | 1  |\n| 4x4 | 16    | 2  |\n| 4x8 | 32    | 4  |\n| 8x8 | 64    | 8  |\n| 8x16 | 128   | 16  |\n| 16x16 | 256   | 32  |\nv5e TPU \u5207\u7247\u4e2d\u7684\u6bcf\u500b TPU \u865b\u64ec\u6a5f\u5305\u542b 1\u30014 \u6216 8 \u500b\u82af\u7247\u3002\u5728 4 \u500b\u82af\u7247\u53ca\u66f4\u5c0f\u7684\u5207\u7247\u4e2d\uff0c\u6240\u6709 TPU \u82af\u7247\u5171\u4eab\u540c\u4e00\u500b\u975e\u7d71\u4e00\u5167\u5b58\u8a2a\u554f (NUMA) \u7bc0\u9ede\u3002\n\u5c0d\u65bc 8 \u82af\u7247 v5e TPU \u865b\u64ec\u6a5f\uff0c\u5728 NUMA \u5206\u5340\u5167 CPU-TPU \u901a\u4fe1\u66f4\u9ad8\u6548\u3002\u4f8b\u5982\uff0c\u5728\u4e0b\u5716\u4e2d\uff0c `CPU0-Chip0` \u901a\u4fe1\u6bd4 `CPU0-Chip4` \u901a\u4fe1\u5feb\u3002### \u7528\u65bc\u63d0\u4f9b\u670d\u52d9\u7684 Cloud TPU v5e \u985e\u578b\n\u6700\u591a\u652f\u6301 8 \u500b v5e \u82af\u7247\u9032\u884c\u55ae\u4e3b\u6a5f\u50b3\u9001\u3002\u652f\u6301\u4ee5\u4e0b\u914d\u7f6e\uff1a1x1\u30012x2 \u548c 2x4 \u5207\u7247\u3002\u6bcf\u500b\u5207\u7247\u5206\u5225\u6709 1\u30014 \u548c 8 \u500b\u82af\u7247\u3002\n\u5982\u9700\u7232\u670d\u52d9\u4f5c\u696d\u9810\u914d TPU\uff0c\u8acb\u5728 CLI \u6216 API TPU \u5275\u5efa\u8acb\u6c42\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u52a0\u901f\u5668\u985e\u578b\u4e4b\u4e00\uff1a\n| AcceleratorType (TPU API) | \u6a5f\u5668\u985e\u578b (GKE API) |\n|:----------------------------|:---------------------|\n| v5litepod-1     | ct5lp-hightpu-1t  |\n| v5litepod-4     | ct5lp-hightpu-4t  |\n| v5litepod-8     | ct5lp-hightpu-8t  |\n\u7cfb\u7d71\u652f\u6301\u4f7f\u7528 [Sax](https://github.com/google/saxml) \u5728 8 \u500b\u4ee5\u4e0a\u7684 v5e \u82af\u7247\u4e0a\u9032\u884c\u50b3\u9001\uff08\u4e5f\u7a31\u7232\u591a\u4e3b\u6a5f\u50b3\u9001\uff09\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5927\u8a9e\u8a00\u6a21\u578b\u670d\u52d9](https://cloud.google.com/tpu/docs/v5e-inference?hl=zh-cn#large_language_model_serving) \u3002\n### \u7528\u65bc\u8a13\u7df4\u7684 Cloud TPU v5e \u985e\u578b\n\u6700\u591a\u652f\u6301\u5c0d 256 \u500b\u82af\u7247\u9032\u884c\u8a13\u7df4\u3002\n\u5982\u9700\u7232 v5e \u8a13\u7df4\u4f5c\u696d\u9810\u914d TPU\uff0c\u8acb\u5728 CLI \u6216 API TPU \u5275\u5efa\u8acb\u6c42\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u52a0\u901f\u5668\u985e\u578b\u4e4b\u4e00\uff1a\n| AcceleratorType (TPU API) | \u6a5f\u5668\u985e\u578b (GKE API) | \u62d3\u64b2 |\n|:----------------------------|:---------------------|:-------|\n| v5litepod-16    | ct5lp-hightpu-4t  | 4x4 |\n| v5litepod-32    | ct5lp-hightpu-4t  | 4x8 |\n| v5litepod-64    | ct5lp-hightpu-4t  | 8x8 |\n| v5litepod-128    | ct5lp-hightpu-4t  | 8x16 |\n| v5litepod-256    | ct5lp-hightpu-4t  | 16x16 |\n### v5e TPU \u865b\u64ec\u6a5f\u985e\u578b\u6bd4\u8f03\uff1a\n| 0     | 1     | 2      | 3      |\n|:------------------|:---------------------|:-----------------------|:-----------------------|\n| \u865b\u64ec\u6a5f\u985e\u578b  | n2d-48-24-v5lite-tpu | n2d-192-112-v5lite-tpu | n2d-384-224-v5lite-tpu |\n| v5e \u82af\u7247\u6578\u91cf  | 1     | 4      | 8      |\n| vCPU \u7684\u6578\u91cf  | 24     | 112     | 224     |\n| RAM (GB)   | 48     | 192     | 384     |\n| NUMA \u500b\u7bc0\u9ede\u7684\u6578\u91cf | 1     | 1      | 2      |\n| \u9069\u7528\u65bc   | v5litepod-1   | v5litepod-4   | v5litepod-8   |\n| \u4e2d\u65b7    | \u9ad8     | \u4e2d      | \u4f4e      |\n\u7232\u4e86\u7d66\u9700\u8981\u66f4\u591a\u82af\u7247\u7684\u5de5\u4f5c\u8ca0\u8f09\u9a30\u51fa\u7a7a\u9593\uff0c\u8abf\u5ea6\u5668\u53ef\u80fd\u6703\u6436\u4f54\u66f4\u5c11\u82af\u7247\u7684\u865b\u64ec\u6a5f\u3002\u56e0\u6b64\uff0c8 \u82af\u7247\u865b\u64ec\u6a5f\u53ef\u80fd\u6703\u6436\u4f54 1 \u548c 4 \u82af\u7247\u865b\u64ec\u6a5f\u3002\n## TPU v4 \u914d\u7f6e\nTPU v4 Pod \u7531 4096 \u500b\u82af\u7247\u7d44\u6210\uff0c\u901a\u904e\u53ef\u91cd\u65b0\u914d\u7f6e\u7684\u9ad8\u901f\u93c8\u8def\u4e92\u9023\u3002TPU v4 \u7684\u9748\u6d3b\u7db2\u7d61\u4f7f\u60a8\u80fd\u5920\u4ee5\u591a\u7a2e\u65b9\u5f0f\u9023\u63a5\u76f8\u540c\u5927\u5c0f\u7684 Pod \u5207\u7247\u4e2d\u7684\u82af\u7247\u3002\u5275\u5efa TPU Pod \u5207\u7247\u6642\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u6240\u9700\u7684 TPU \u7248\u672c\u548c TPU \u8cc7\u6e90\u6578\u91cf\u3002\u5275\u5efa TPU v4 Pod \u5207\u7247\u6642\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u5169\u7a2e\u65b9\u5f0f\u4e4b\u4e00\u6307\u5b9a\u5176\u985e\u578b\u548c\u5927\u5c0f\uff1a `AcceleratorType` \u548c `AccleratorConfig` \u3002\n**\u6ce8\u610f** \uff1a `AcceleratorType` \u548c `AccleratorConfig` \u662f\u4e92\u65a5\u7684\uff1b\u5728\u5275\u5efa TPU \u6642\uff0c\u60a8\u53ea\u80fd\u4f7f\u7528\u5176\u4e2d\u4e00\u500b\u3002\n### \u4f7f\u7528 AcceleratorType\n\u5982\u679c\u672a\u6307\u5b9a\u62d3\u64b2\uff0c\u8acb\u4f7f\u7528 AcceleratorType\u3002\u5982\u9700\u4f7f\u7528 `AcceleratorType` \u914d\u7f6e v4 TPU\uff0c\u8acb\u5728\u5275\u5efa TPU Pod \u5207\u7247\u6642\u4f7f\u7528 `--accelerator-type` \u6a19\u8a8c\u3002\u5c07 `--accelerator-type` \u8a2d\u7f6e\u7232\u5305\u542b\u60a8\u8981\u4f7f\u7528\u7684 TPU \u7248\u672c\u548c TensorCore \u6578\u91cf\u7684\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff0c\u5982\u9700\u5275\u5efa\u5305\u542b 32 \u500b TensorCore \u7684 v4 Pod \u5207\u7247\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 `--accelerator-type=v4-32` \u3002\n\u4ee5\u4e0b\u547d\u4ee4\u4f7f\u7528 `--accelerator-type` \u6a19\u8a8c\u5275\u5efa\u4e00\u500b\u5305\u542b 512 \u500b TensorCore \u7684 v4 TPU Pod \u5207\u7247\uff1a\n```\n\u00a0 $ gcloud compute tpus tpu-vm create tpu-name\u00a0 \u00a0 --zone=zone\u00a0 \u00a0 --accelerator-type=v4-512\u00a0 \u00a0 --version=tpu-vm-tf-2.15.0-pod-pjrt\n```\nTPU \u7248\u672c\u5f8c\u9762\u7684\u6578\u5b57 ( `v4` ) \u6307\u5b9a TensorCore \u7684\u6578\u91cf\u3002v4 TPU \u4e2d\u6709\u5169\u500b TensorCore\uff0c\u56e0\u6b64 TPU \u82af\u7247\u7684\u6578\u91cf\u5c07\u7232 512/2 = 256\u3002\n### \u4f7f\u7528 AcceleratorConfig\n\u5982\u679c\u8981\u81ea\u5b9a\u7fa9 TPU \u5207\u7247\u7684 [\u7269\u7406\u62d3\u64b2](https://cloud.google.com/tpu/docs/types-topologies?hl=zh-cn#v4-variants) \uff0c\u8acb\u4f7f\u7528 `AcceleratorConfig` \u3002\u5c0d\u65bc\u8d85\u904e 256 \u500b\u82af\u7247\u7684 Pod \u5207\u7247\u7684\u6027\u80fd\u8abf\u6574\uff0c\u901a\u5e38\u9700\u8981\u9019\u6a23\u505a\u3002\n\u5982\u9700\u4f7f\u7528 `AcceleratorConfig` \u914d\u7f6e v4 TPU\uff0c\u8acb\u4f7f\u7528 `--version` \u548c `--topology` \u6a19\u8a8c\u3002\u5c07 `--version` \u8a2d\u7f6e\u7232\u60a8\u8981\u4f7f\u7528\u7684 TPU \u7248\u672c\uff0c\u4e26\u5c07 `--topology` \u8a2d\u7f6e\u7232 Pod \u5207\u7247\u4e2d TPU \u82af\u7247\u7684\u7269\u7406\u6392\u5217\u65b9\u5f0f\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 3 \u5143\u7d44 AxBxC \u6307\u5b9a TPU \u62d3\u64b2\uff0c\u5176\u4e2d A<=B<=C \u4e14 A\u3001B\u3001C \u5168\u90e8 <= 4 \u6216\u5168\u90e8\u7232 4 \u7684\u6574\u6578\u500d\u3002\u503c A\u3001B \u548c C \u5206\u5225\u662f\u9019\u4e09\u500b\u7dad\u5ea6\u4e2d\u7684\u689d\u72c0\u6a19\u7c64\u8a08\u6578\u3002\u4f8b\u5982\uff0c\u5982\u9700\u5275\u5efa\u4e00\u500b\u5305\u542b 16 \u500b\u82af\u7247\u7684 v4 Pod \u5207\u7247\uff0c\u60a8\u9700\u8981\u8a2d\u7f6e `--version=v4` \u548c `--topology=2x2x4` \u3002\n\u4ee5\u4e0b\u547d\u4ee4\u5c07\u5275\u5efa\u4e00\u500b v4 TPU Pod \u5207\u7247\uff0c\u5176\u4e2d\u6709 128 \u500b TPU \u82af\u7247\u4ee5 4x4x8 \u6578\u7d44\u6392\u5217\uff1a\n```\n\u00a0 $ gcloud compute tpus tpu-vm create tpu-name\u00a0 \u00a0 --zone=zone\u00a0 \u00a0 --type=v4\u00a0 \u00a0 --topology=4x4x8\u00a0 \u00a0 --version=tpu-vm-tf-2.15.0-pod-pjrt\n```\n2A=B=C \u6216 2A=2B=C \u7684\u62d3\u64b2\u4e5f\u5177\u6709\u91dd\u5c0d\u5168\u5c0d\u901a\u4fe1\u9032\u884c\u4e86\u512a\u5316\u7684 [\u62d3\u64b2\u8b8a\u9ad4](#v4-variants) \uff0c\u4f8b\u5982 4\u00d74\u00d78\u30018\u00d78\u00d716 \u548c 12\u00d712\u00d724\u3002\u9019\u985e\u62d3\u64b2\u7a31\u7232\u201c\u626d\u66f2\u9ce5\u5c45\u201d \u3002\n\u4e0b\u5716\u986f\u793a\u4e86\u4e00\u4e9b\u5e38\u898b\u7684 TPU v4 \u62d3\u64b2\u3002\n\u8f03\u5927\u7684 Pod \u5207\u7247\u53ef\u4ee5\u901a\u904e\u4e00\u500b\u6216\u591a\u500b 4x4x4\u201c\u7acb\u65b9\u9ad4\u201d\u82af\u7247\u69cb\u5efa\u3002\n\u67d0\u4e9b v4 3D \u74b0\u9762\u5207\u7247\u5f62\u72c0\u53ef\u4ee5\u9078\u64c7\u4f7f\u7528\u6240\u8b02\u7684\u626d\u66f2\u74b0\u9762 \u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u5c07\u5169\u500b v4 \u7acb\u65b9\u9ad4\u6392\u5217\u7232 4x4x8 \u5207\u7247\u6216 4x4x8_twisted\u3002\u626d\u66f2\u62d3\u64b2\u63d0\u4f9b\u7684\u5e73\u5206\u5e36\u5bec\u660e\u986f\u66f4\u9ad8\u3002\u589e\u52a0\u5c0d\u5206\u5e36\u5bec\u5c0d\u65bc\u4f7f\u7528\u5168\u7403\u901a\u4fe1\u6a21\u5f0f\u7684\u5de5\u4f5c\u8ca0\u8f09\u975e\u5e38\u6709\u7528\u3002\u626d\u66f2\u62d3\u64b2\u53ef\u4ee5\u63d0\u9ad8\u5927\u591a\u6578\u6a21\u578b\u7684\u6027\u80fd\uff0c\u5176\u4e2d\u5927\u578b [TPU \u5d4c\u5165\u5de5\u4f5c\u8ca0\u8f09](https://www.tensorflow.org/recommenders/api_docs/python/tfrs/layers/embedding/TPUEmbedding?hl=zh-cn) \u53d7\u76ca\u6700\u5927\u3002\n\u5c0d\u65bc\u5c07\u6578\u64da\u4e26\u884c\u7528\u4f5c\u552f\u4e00\u4f75\u884c\u7b56\u7565\u7684\u5de5\u4f5c\u8ca0\u8f09\uff0c\u626d\u66f2\u62d3\u64b2\u7684\u8868\u73fe\u53ef\u80fd\u6703\u7565\u6709\u63d0\u5347\u3002\u5c0d\u65bc LLM\uff0c\u4f7f\u7528\u626d\u66f2\u62d3\u64b2\u7684\u6027\u80fd\u53ef\u80fd\u56e0\u4e26\u884c\u985e\u578b\uff08DP\u3001MP \u7b49\uff09\u800c\u7570\u3002\u6700\u4f73\u5be6\u8e10\u662f\u5728\u4f7f\u7528\u548c\u4e0d\u4f7f\u7528\u626d\u66f2\u62d3\u64b2\u7684\u60c5\u6cc1\u4e0b\u8a13\u7df4 LLM\uff0c\u4ee5\u78ba\u5b9a\u54ea\u7a2e\u62d3\u64b2\u53ef\u7232\u6a21\u578b\u63d0\u4f9b\u6700\u4f73\u6027\u80fd\u3002 [FSDP MaxText \u6a21\u578b](https://github.com/google/maxtext#getting-started) \u7684\u4e00\u4e9b\u5be6\u9a57\u4f7f\u7528\u626d\u66f2\u7684\u62d3\u64b2\uff0c\u5be6\u73fe\u4e86 1-2 \u9805 MFU \u65b9\u9762\u7684\u6539\u9032\u3002\n\u626d\u66f2\u62d3\u64b2\u7684\u4e3b\u8981\u512a\u52e2\u5728\u65bc\uff0c\u5b83\u5c07\u975e\u5c0d\u7a31\u74b0\u5f62\u62d3\u64b2\uff08\u4f8b\u5982 4\u00d74\u00d78\uff09\u8f49\u63db\u7232\u5bc6\u5207\u76f8\u95dc\u7684\u5c0d\u7a31\u62d3\u64b2\u3002\u5c0d\u7a31\u62d3\u64b2\u5177\u6709\u8af8\u591a\u512a\u52e2\uff1a\n- \u6539\u9032\u4e86\u8ca0\u8f09\u5747\u8861\n- \u66f4\u9ad8\u7684\u5c0d\u5206\u5e36\u5bec\n- \u7e2e\u77ed\u6578\u64da\u5305\u8def\u7531\n\u9019\u4e9b\u512a\u52e2\u6700\u7d42\u6703\u8f49\u5316\u7232\u8a31\u591a\u5168\u7403\u901a\u4fe1\u6a21\u5f0f\u7684\u6027\u80fd\u7684\u63d0\u5347\u3002\nTPU \u8edf\u4ef6\u652f\u6301\u5728\u5207\u7247\u4e0a\u626d\u8f49 tori\uff0c\u5176\u4e2d\u6bcf\u500b\u7dad\u5ea6\u7684\u5927\u5c0f\u662f\u6700\u5c0f\u7dad\u5ea6\u7684\u5927\u5c0f\uff0c\u6216\u8005\u662f\u6700\u5c0f\u7dad\u5ea6\u5927\u5c0f\u7684\u5169\u500d\u3002\u4f8b\u5982\uff0c4x4x8\u30014x8x8 \u6216 12x12x24\u3002\n\u4f8b\u5982\uff0c\u8acb\u8003\u616e\u4ee5\u4e0b 4\u00d72 \u74b0\u9762\u62d3\u64b2\uff0c\u5176\u4e2d TPU \u5728\u5207\u7247\u4e2d\u5e36\u6709 (X,Y) \u5ea7\u6a19\u6a19\u7c64\uff1a\n\u7232\u6e05\u6670\u8d77\u898b\uff0c\u6b64\u62d3\u64b2\u5716\u4e2d\u7684\u908a\u986f\u793a\u7232\u7121\u5b9a\u5411\u908a\u3002\u5be6\u969b\u4e0a\uff0c\u6bcf\u500b\u908a\u7de3\u90fd\u662f TPU \u4e4b\u9593\u7684\u96d9\u5411\u9023\u63a5\u3002\u6211\u5011\u5c07\u6b64\u7db2\u683c\u7684\u4e00\u5074\u548c\u53e6\u4e00\u5074\u4e4b\u9593\u7684\u908a\u7a31\u7232\u74b0\u7e5e\u908a\uff0c\u5982\u5716\u6240\u793a\u3002\n\u901a\u904e\u626d\u8f49\u6b64\u62d3\u64b2\uff0c\u6211\u5011\u6700\u7d42\u5f97\u5230\u4e00\u500b\u5b8c\u5168\u5c0d\u7a31\u7684 4\u00d72 \u626d\u66f2\u74b0\u9762\u62d3\u64b2\uff1a\n\u4e0a\u5716\u8207\u4e0a\u5716\u4e4b\u9593\u552f\u4e00\u7684\u8b8a\u5316\u662f Y \u74b0\u7e5e\u908a\u3002\u9019\u4e9b TPU \u5df2\u6539\u7232\u9023\u63a5\u5230\u5177\u6709 X+2 mod 4 \u5ea7\u6a19\u7684 TPU\uff0c\u800c\u4e0d\u662f\u9023\u63a5\u5230\u53e6\u4e00\u500b\u5177\u6709\u76f8\u540c X \u5ea7\u6a19\u7684 TPU\u3002\n\u9019\u7a2e\u601d\u8def\u53ef\u4ee5\u6cdb\u5316\u5230\u4e0d\u540c\u7684\u7dad\u5ea6\u5927\u5c0f\u548c\u4e0d\u540c\u6578\u91cf\u7684\u7dad\u5ea6\u3002\u53ea\u8981\u6bcf\u500b\u7dad\u5ea6\u7b49\u65bc\u6216\u7b49\u65bc\u6700\u5c0f\u7dad\u5ea6\u5927\u5c0f\u7684\u5169\u500d\uff0c\u751f\u6210\u7684\u7db2\u7d61\u5c31\u662f\u5c0d\u7a31\u7684\u7db2\u7d61\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5728\u5275\u5efa Cloud TPU \u6642\u6307\u5b9a\u626d\u66f2\u7684 tori \u914d\u7f6e\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 AcceleratorConfig](#using-accelerator-config) \u3002\n\u4e0b\u8868\u986f\u793a\u4e86\u652f\u6301\u7684\u626d\u66f2\u62d3\u64b2\uff0c\u4ee5\u53ca\u4f7f\u7528\u5b83\u5011\u8207\u7121\u89e3\u62d3\u64b2\u76f8\u6bd4\u5728\u7406\u8ad6\u4e0a\u589e\u52a0\u4e86\u5c0d\u5206\u5e36\u5bec\u3002\n| \u626d\u66f2\u62d3\u64b2  | \u8207\u975e\u626d\u74b0\u9762\u76f8\u6bd4\uff0c\u5e36\u5bec\u5728\u7406\u8ad6\u4e0a\u589e\u52a0\u4e86 |\n|:--------------|:-------------------------------------|\n| 4\u00d74\u00d78_\u626d\u8f49 | \u7d04 70%        |\n| 8x8x16 \u626d\u66f2 | nan         |\n| 12\u00d712\u00d724_\u626d\u8f49 | nan         |\n| 4\u00d78\u00d78_\u626d\u8f49 | \u7d04 40%        |\n| 8\u00d716\u00d716 \u626d\u66f2 | nan         |\n**\u6ce8\u610f** \uff1a\u9664\u975e\u4f7f\u7528 `--topology` \u6a19\u8a8c\u6307\u5b9a\u5f8c\u7db4 `_twisted` \uff0c\u5426\u5247\u7cfb\u7d71\u4e0d\u6703\u81ea\u52d5\u4f7f\u7528\u626d\u66f2\u62d3\u64b2\u3002\u4f8b\u5982\uff0c\u5982\u9700\u6307\u5b9a 4x4x8 \u626d\u66f2\u62d3\u64b2\uff0c\u53ef\u4ee5\u5c07 `topology` \u6a19\u8a8c\u6307\u5b9a\u7232\uff1a `4x4x8_twisted` \u3002\n### TPU v4 \u62d3\u64b2\u8b8a\u9ad4\n\u67d0\u4e9b\u5305\u542b\u76f8\u540c\u6578\u91cf\u82af\u7247\u7684\u62d3\u64b2\u53ef\u4ee5\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u6392\u5217\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u62d3\u64b2\u914d\u7f6e\u5305\u542b 512 \u500b\u82af\u7247\uff081024 \u500b TensorCore\uff09\u7684 TPU Pod \u5207\u7247\uff1a4x4x32\u30014x8x16 \u6216 8x8x8\u3002\u5305\u542b 2048 \u500b\u82af\u7247\uff084096 \u500b TensorCore\uff09\u7684 TPU Pod \u5207\u7247\u53ef\u63d0\u4f9b\u66f4\u591a\u62d3\u64b2\u9078\u9805\uff1a4x4x128\u30014x8x64\u30014x16x32 \u548c 8x16x16\u3002\u5305\u542b 2048 \u500b\u82af\u7247\uff084096 \u500b TensorCore\uff09\u7684 TPU Pod \u5207\u7247\u53ef\u63d0\u4f9b\u66f4\u591a\u62d3\u64b2\u9078\u9805\uff1a4x4x128\u30014x8x64\u30014x16x32 \u548c 8x16x16\u3002\n\u8207\u7d66\u5b9a\u82af\u7247\u6578\u91cf\u95dc\u806f\u7684\u9ed8\u8a8d\u62d3\u64b2\u662f\u6700\u985e\u4f3c\u65bc\u7acb\u65b9\u9ad4\u7684\u62d3\u64b2\uff08\u8acb\u53c3\u95b1 [v4 \u62d3\u64b2](https://cloud.google.com/tpu/docs/system-architecture-tpu-vm?hl=zh-cn#twisted-tori) \uff09\u3002\u6b64\u5f62\u72c0\u53ef\u80fd\u662f\u6578\u64da\u4e26\u884c\u6a5f\u5668\u5b78\u7fd2\u8a13\u7df4\u7684\u6700\u4f73\u9078\u64c7\u3002\u5176\u4ed6\u62d3\u64b2\u5c0d\u65bc\u5177\u6709\u591a\u7a2e\u4e26\u884c\u8655\u7406\uff08\u4f8b\u5982\uff0c\u6a21\u578b\u548c\u6578\u64da\u4e26\u884c\uff0c\u6216\u6a21\u64ec\u7684\u7a7a\u9593\u5206\u5340\uff09\u7684\u5de5\u4f5c\u8ca0\u8f09\u975e\u5e38\u6709\u7528\u3002\u5982\u679c\u62d3\u64b2\u8207\u6240\u7528\u7684\u4e26\u884c\u6027\u76f8\u5339\u914d\uff0c\u5247\u9019\u4e9b\u5de5\u4f5c\u8ca0\u8f09\u7684\u6027\u80fd\u6700\u4f73\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5728 X \u7dad\u5ea6\u4e0a\u4e26\u884c\u653e\u7f6e 4 \u8def\u6a21\u578b\uff0c\u4e26\u5728 Y \u7dad\u5ea6\u548c Z \u7dad\u5ea6\u4e0a\u4e26\u884c\u653e\u7f6e 256 \u8def\u6578\u64da\u4e26\u884c\u8655\u7406\uff0c\u5247\u6703\u8207 4x16x16 \u62d3\u64b2\u5339\u914d\u3002\n\u5177\u6709\u591a\u500b\u4e26\u884c\u7dad\u5ea6\u7684\u6a21\u578b\u5728\u4e26\u884c\u7dad\u5ea6\u6620\u5c04\u5230 TPU \u62d3\u64b2\u7dad\u5ea6\u6642\u6548\u679c\u6700\u4f73\u3002\u9019\u4e9b\u6a21\u578b\u901a\u5e38\u662f\u6578\u64da + \u6a21\u578b\u4e26\u884c\u5927\u578b\u8a9e\u8a00\u6a21\u578b (LLM)\u3002\u4f8b\u5982\uff0c\u5c0d\u65bc\u62d3\u64b2\u7232 8x16x16 \u7684 TPU v4 Pod \u5207\u7247\uff0cTPU \u62d3\u64b2\u7dad\u5ea6\u7232 8\u300116 \u548c 16\u3002\u4f7f\u7528 8 \u8def\u6216 16 \u8def\u6a21\u578b\u4e26\u884c\u8655\u7406\uff08\u6620\u5c04\u5230\u5176\u4e2d\u4e00\u500b\u7269\u7406 TPU \u62d3\u64b2\u7dad\u5ea6\uff09\u6027\u80fd\u66f4\u9ad8\u3002\u63a1\u7528\u6b64\u62d3\u64b2\u6642\uff0c\u56db\u8def\u6a21\u578b\u7684\u4e26\u884c\u6027\u4e0d\u662f\u6700\u512a\uff0c\u56e0\u7232\u5b83\u8207\u4efb\u4f55 TPU \u62d3\u64b2\u7dad\u5ea6\u5747\u4e0d\u5c0d\u9f4a\uff0c\u4f46\u5c0d\u65bc\u76f8\u540c\u6578\u91cf\u7684\u82af\u7247\uff0c\u63a1\u7528 4x16x32 \u62d3\u64b2\u6642\u6548\u679c\u6700\u4f73\u3002\nTPU v4 \u914d\u7f6e\u7531\u5169\u7d44\u7d44\u6210\uff0c\u4e00\u7d44\u62d3\u64b2\u5c0f\u65bc 64 \u500b\u82af\u7247\uff08\u5c0f\u578b\u62d3\u64b2\uff09\uff0c\u53e6\u4e00\u7d44\u62d3\u64b2\u5927\u65bc 64 \u500b\u82af\u7247\uff08\u5927\u578b\u62d3\u64b2\uff09\u3002\nCloud TPU \u652f\u6301\u5c0f\u65bc 64 \u500b\u82af\u7247\u7684\u4ee5\u4e0b TPU v4 Pod \u5207\u7247\uff084x4x4 \u7acb\u65b9\u9ad4\uff09\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u9019\u4e9b\u5c0f\u578b v4 \u62d3\u64b2\u4f86\u5275\u5efa\u5176\u57fa\u65bc TensorCore \u7684\u540d\u7a31\uff08\u4f8b\u5982 v4-32\uff09\u6216\u5176\u62d3\u64b2\uff08\u4f8b\u5982 2x2x4\uff09\uff1a\n| 0       | 1   | 2  |\n|:-----------------------------|:-------------|:------|\n| \u540d\u7a31\uff08\u57fa\u65bc TensorCore \u6578\u91cf\uff09 | \u689d\u72c0\u6a19\u7c64\u6578\u91cf | \u62d3\u64b2 |\n| v4-8       | 4   | 2x2x1 |\n| v4-16      | 8   | 2x2x2 |\n| v4-32      | 16   | 2x2x4 |\n| v4-64      | 32   | 2x4x4 |\nTPU v4 Pod \u5207\u7247\u4ee5 64 \u500b\u82af\u7247\u7232\u589e\u91cf\u63d0\u4f9b\uff0c\u5f62\u72c0\u5728\u6240\u6709\u4e09\u500b\u7dad\u5ea6\u4e0a\u90fd\u662f 4 \u7684\u500d\u6578\u3002\u9019\u4e9b\u7dad\u5ea6\u4e5f\u5fc5\u9808\u6309\u905e\u589e\u9806\u5e8f\u6392\u5217\u3002\u4e0b\u8868\u986f\u793a\u4e86\u5e7e\u500b\u793a\u4f8b\u3002\u5176\u4e2d\u4e00\u4e9b\u62d3\u64b2\u662f\u201c\u81ea\u5b9a\u7fa9\u201d\u62d3\u64b2\uff0c\u53ea\u80fd\u4f7f\u7528 `--type` \u548c `--topology` \u6a19\u8a8c\u5275\u5efa\uff0c\u56e0\u7232\u6392\u5217\u82af\u7247\u7684\u65b9\u5f0f\u6709\u591a\u7a2e\u3002\n\u4ee5\u4e0b\u547d\u4ee4\u5c07\u5275\u5efa\u4e00\u500b v4 TPU Pod \u5207\u7247\uff0c\u5176\u4e2d\u6709 512 \u500b TPU \u82af\u7247\u4ee5 8x8x8 \u6578\u7d44\u6392\u5217\uff1a\n```\n\u00a0 $ gcloud compute tpus tpu-vm create tpu-name\u00a0 \u00a0 --zone=zone\u00a0 \u00a0 --type=v4\u00a0 \u00a0 --topology=8x8x8\u00a0 \u00a0 --version=tpu-vm-tf-2.15.0-pod-pjrt\n```\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `--accelerator-type` \u5275\u5efa\u5177\u6709\u76f8\u540c\u6578\u91cf\u7684 TensorCore \u7684 v4 TPU Pod \u5207\u7247\uff1a\n```\n\u00a0 $ gcloud compute tpus tpu-vm create tpu-name\u00a0 \u00a0 --zone=zone\u00a0 \u00a0 --accelerator-type=v4-1024\u00a0 \u00a0 --version=tpu-vm-tf-2.15.0-pod-pjrt\n```\n| 0           | 1   | 2  |\n|:--------------------------------------------|:-------------|:--------|\n| \u540d\u7a31\uff08\u57fa\u65bc TensorCore \u6578\u91cf\uff09    | \u689d\u72c0\u6a19\u7c64\u6578\u91cf | \u62d3\u64b2 |\n| v4-128          | 64   | 4x4x4 |\n| v4-256          | 128   | 4x4x8 |\n| v4-512          | 256   | 4x8x8 |\n| \u4e0d\u9069\u7528 - \u5fc5\u9808\u4f7f\u7528 --type \u548c --topology \u6a19\u8a8c | 256   | 4x4x16 |\n| v4-1024          | 512   | 8x8x8 |\n| v4-1536          | 768   | 8x8x12 |\n| v4-2048          | 1024   | 8x8x16 |\n| \u4e0d\u9069\u7528 - \u5fc5\u9808\u4f7f\u7528 --type \u548c --topology \u6a19\u8a8c | 1024   | 4x16x16 |\n| v4-4096          | 2048   | 8x16x16 |\n| \u2026           | \u2026   | \u2026  |\n## TPU v3 \u914d\u7f6e\nTPU v3 Pod \u7531 1024 \u500b\u82af\u7247\u7d44\u6210\uff0c\u901a\u904e\u9ad8\u901f\u93c8\u8def\u4e92\u9023\u3002\u5982\u9700\u5275\u5efa TPU v3 \u8a2d\u5099\u6216 Pod \u5207\u7247\uff0c\u8acb\u91dd\u5c0d gcloud compute tpus tpu-vm \u547d\u4ee4\u4f7f\u7528 `--accelerator-type` \u6a19\u8a8c\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u6307\u5b9a TPU \u7248\u672c\u548c TPU \u6838\u5fc3\u6578\u4f86\u6307\u5b9a\u52a0\u901f\u5668\u985e\u578b\u3002\u5c0d\u65bc\u55ae\u500b v3 TPU\uff0c\u8acb\u4f7f\u7528 `--accelerator-type=v3-8` \u3002\u5c0d\u65bc\u5177\u6709 128 \u500b TensorCore \u7684 v3 Pod \u5207\u7247\uff0c\u8acb\u4f7f\u7528 `--accelerator-type=v3-128` \u3002\n\u4ee5\u4e0b\u547d\u4ee4\u5c55\u793a\u77ad\u5982\u4f55\u5275\u5efa\u5177\u6709 128 \u500b TensorCore \u7684 v3 TPU Pod \u5207\u7247\uff1a\n```\n\u00a0 $ gcloud compute tpus tpu-vm create tpu-name\u00a0 \u00a0 --zone=zone\u00a0 \u00a0 --accelerator-type=v3-128\u00a0 \u00a0 --version=tpu-vm-tf-2.15.0-pjrt\n```\n\u4e0b\u8868\u5217\u51fa\u4e86\u652f\u6301\u7684 v3 TPU \u985e\u578b\uff1a\n| TPU \u7248\u672c | \u652f\u6301\u7d50\u675f    |\n|:-----------|:---------------------|\n| v3-8  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v3-32  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v3-128  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v3-256  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v3-512  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v3-1024 | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v3-2048 | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u7ba1\u7406 TPU\uff0c\u8acb\u53c3\u95b1 [\u7ba1\u7406 TPU](https://cloud.google.com/tpu/docs/managing-tpus-tpu-vm?hl=zh-cn) \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u4e0d\u540c\u7248\u672c\u7684 Cloud TPU\uff0c\u8acb\u53c3\u95b1 [\u7cfb\u7d71\u67b6\u69cb](https://cloud.google.com/tpu/docs/system-architecture?hl=zh-cn) \u3002\n## TPU v2 \u914d\u7f6e\nTPU v2 Pod \u7531 512 \u500b\u82af\u7247\u7d44\u6210\uff0c\u901a\u904e\u53ef\u91cd\u65b0\u914d\u7f6e\u7684\u9ad8\u901f\u93c8\u8def\u4e92\u9023\u3002\u5982\u9700\u5275\u5efa TPU v2 Pod \u5207\u7247\uff0c\u8acb\u5c0d gcloud compute tpus tpu-vm \u547d\u4ee4\u4f7f\u7528 `--accelerator-type` \u6a19\u8a8c\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u6307\u5b9a TPU \u7248\u672c\u548c TPU \u6838\u5fc3\u6578\u4f86\u6307\u5b9a\u52a0\u901f\u5668\u985e\u578b\u3002\u5c0d\u65bc\u55ae\u500b v2 TPU\uff0c\u8acb\u4f7f\u7528 `--accelerator-type=v2-8` \u3002\u5c0d\u65bc\u5177\u6709 128 \u500b TensorCore \u7684 v2 Pod \u5207\u7247\uff0c\u8acb\u4f7f\u7528 `--accelerator-type=v2-128` \u3002\n\u4ee5\u4e0b\u547d\u4ee4\u5c55\u793a\u77ad\u5982\u4f55\u5275\u5efa\u5177\u6709 128 \u500b TensorCore \u7684 v2 TPU Pod \u5207\u7247\uff1a\n```\n\u00a0 $ gcloud compute tpus tpu-vm create tpu-name\u00a0 \u00a0 --zone=zone\u00a0 \u00a0 --accelerator-type=v2-128\u00a0 \u00a0 --version=tpu-vm-tf-2.15.0-pjrt\n```\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u7ba1\u7406 TPU\uff0c\u8acb\u53c3\u95b1 [\u7ba1\u7406 TPU](https://cloud.google.com/tpu/docs/managing-tpus-tpu-vm?hl=zh-cn) \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u4e0d\u540c\u7248\u672c\u7684 Cloud TPU\uff0c\u8acb\u53c3\u95b1 [\u7cfb\u7d71\u67b6\u69cb](https://cloud.google.com/tpu/docs/system-architecture?hl=zh-cn) \u3002\n\u4e0b\u8868\u5217\u51fa\u4e86\u652f\u6301\u7684 v2 TPU \u985e\u578b\n| TPU \u7248\u672c | \u652f\u6301\u7d50\u675f    |\n|:-----------|:---------------------|\n| v2-8  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v2-32  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v2-128  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v2-256  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n| v2-512  | \uff08\u7d50\u675f\u65e5\u671f\u5c1a\u672a\u78ba\u5b9a\uff09 |\n## TPU \u985e\u578b\u517c\u5bb9\u6027\n\u60a8\u53ef\u4ee5\u5c07 TPU \u985e\u578b\u66f4\u6539\u7232\u5177\u6709\u76f8\u540c\u6578\u91cf\u7684 TensorCore \u6216\u82af\u7247\u7684\u5176\u4ed6 TPU \u985e\u578b\uff08\u4f8b\u5982\uff0c `v3-128` \u548c `v4-128` \uff09\uff0c\u4e26\u904b\u884c\u60a8\u7684\u8a13\u7df4\u8173\u672c\uff0c\u800c\u7121\u9700\u66f4\u6539\u4ee3\u78bc\u3002\u4f46\u662f\uff0c\u5982\u679c\u66f4\u6539\u7232\u5177\u6709\u66f4\u591a\u6216\u66f4\u5c11\u6578\u91cf\u7684 TensorCore \u7684 TPU \u985e\u578b\uff0c\u5c07\u9700\u8981\u57f7\u884c\u986f\u8457\u7684\u8abf\u6574\u548c\u512a\u5316\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5728 TPU Pod \u4e0a\u904b\u884c\u8a13\u7df4](https://cloud.google.com/tpu/docs/training-on-tpu-pods?hl=zh-cn) \u3002\n## TPU \u865b\u64ec\u6a5f\u8edf\u4ef6\u7248\u672c\n\u672c\u90e8\u5206\u4ecb\u7d39\u4e86\u5177\u6709 [TPU \u865b\u64ec\u6a5f](https://cloud.google.com/tpu/docs/system-architecture-tpu-vm?hl=zh-cn#tpu-vm-arch) \u67b6\u69cb\u7684 TPU \u61c9\u4f7f\u7528\u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u5982\u9700\u77ad\u89e3 [TPU \u7bc0\u9ede](https://cloud.google.com/tpu/docs/system-architecture-tpu-vm?hl=zh-cn#tpu-node-arch) \u67b6\u69cb\uff0c\u8acb\u53c3\u95b1 [TPU \u7bc0\u9ede\u8edf\u4ef6\u7248\u672c](#tpu-node-versions) \u3002\nTPU \u8edf\u4ef6\u7248\u672c\u9069\u7528\u65bc TensorFlow\u3001PyTorch \u548c JAX \u6846\u67b6\u3002\n### TensorFlow\n\u5c0d\u65bc TensorFlow 2.15.0 \u7248\uff0c\u8acb\u4f7f\u7528\u8207\u7de8\u5beb\u6a21\u578b\u7684 TensorFlow \u7248\u672c\u76f8\u5339\u914d\u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u60a8\u9084\u5fc5\u9808\u6307\u5b9a\u6d41\u57f7\u884c\u5668 (SE) \u904b\u884c\u6642\u6216 PJRT \u904b\u884c\u6642\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u8981\u5c07 TensorFlow 2.15.0 \u8207 PJRT \u904b\u884c\u6642\u642d\u914d\u4f7f\u7528\uff0c\u8acb\u4f7f\u7528 `tpu-vm-tf-2.15.0-pjrt` TPU \u8edf\u4ef6\u7248\u672c\u3002\nPJRT \u5177\u6709\u81ea\u52d5\u8a2d\u5099\u5167\u5b58\u788e\u7247\u6574\u7406\u529f\u80fd\uff0c\u53ef\u7c21\u5316\u786c\u4ef6\u8207\u6846\u67b6\u7684\u96c6\u6210\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 PJRT\uff0c\u8acb\u53c3\u95b1 Google \u958b\u6e90\u535a\u5ba2\u4e0a\u7684 [PJRT\uff1a\u7c21\u5316\u6a5f\u5668\u5b78\u7fd2\u786c\u4ef6\u548c\u6846\u67b6\u96c6\u6210](https://opensource.googleblog.com/2023/05/pjrt-simplifying-ml-hardware-and-framework-integration.html) \u3002\n**\u91cd\u8981\u63d0\u793a** \uff1aTPU v5e \u548c\u672a\u4f86 TPU \u4e16\u4ee3\u5c07\u50c5\u652f\u6301 PJRT\u3002\u53ea\u6709 TPU \u865b\u64ec\u6a5f\u67b6\u69cb\u652f\u6301 PJRT\u3002\n\u6211\u5011\u6b63\u52aa\u529b\u5c07 TPU v2\u3001v3 \u548c v4 \u7684\u6240\u6709\u529f\u80fd\u9077\u79fb\u5230 PJRT \u904b\u884c\u6642\u3002\u4e0b\u8868\u4ecb\u7d39\u4e86 PJRT \u6216 Steam Executor \u7576\u524d\u652f\u6301\u7684\u529f\u80fd\u3002\n| \u52a0\u901f\u5668 | \u7279\u5fb5         | PJRT \u652f\u6301         | \u5728\u6d41\u57f7\u884c\u5668\u4e0a\u53d7\u652f\u6301 |\n|:----------|:--------------------------------------|:------------------------------------------|:---------------------|\n| TPU v2-v4 | \u5bc6\u96c6\u8a08\u7b97\uff08\u7121 TPU \u5d4c\u5165 API\uff09   | \u662f          | \u662f     |\n| TPU v2-v4 | Dense Compute API + TPU Embedding API | \u5426          | \u662f     |\n| TPU v2-v4 | tf.summary/tf.print\uff08\u5728\u8edf\u8a2d\u5099\u4e0a\u653e\u7f6e\uff09 | \u5426          | \u662f     |\n| TPU v5e | \u5bc6\u96c6\u8a08\u7b97\uff08\u7121 TPU \u5d4c\u5165 API\uff09   | \u662f          | \u5426     |\n| TPU v5e | TPU \u5d4c\u5165 API       | \u4e0d\u9069\u7528 - TPU v5e \u4e0d\u652f\u6301 TPU embedding API | \u4e0d\u9069\u7528    |\nTensorFlow 2.14.0 \u53ca\u66f4\u4f4e\u7248\u672c\u50c5\u652f\u6301\u6d41\u57f7\u884c\u5668\u3002\u4f7f\u7528\u8207\u7de8\u5beb\u6a21\u578b\u6642\u6240\u7528 TensorFlow \u7248\u672c\u76f8\u5339\u914d\u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f TensorFlow 2.14.0\uff0c\u8acb\u4f7f\u7528 `tpu-vm-tf-2.14.0` TPU \u8edf\u4ef6\u7248\u672c\u3002\n\u76ee\u524d\u652f\u6301\u7684\u9069\u7528\u65bc TPU \u7684 TensorFlow TPU \u865b\u64ec\u6a5f\u8edf\u4ef6\u7248\u672c\u7232\uff1a\n- tpu-vm-tf-2.15.0-pjrt\n- tpu-vm-tf-2.15.0-se\n- tpu-vm-tf-2.14.1\n- tpu-vm-tf-2.14.0\n- tpu-vm-tf-2.13.1\n- tpu-vm-tf-2.13.0\n- tpu-vm-tf-2.12.1\n- tpu-vm-tf-2.12.0\n- tpu-vm-tf-2.11.1\n- tpu-vm-tf-2.11.0\n- tpu-vm-tf-2.10.1\n- tpu-vm-tf-2.10.0\n- tpu-vm-tf-2.9.3\n- tpu-vm-tf-2.9.1\n- tpu-vm-tf-2.8.4\n- tpu-vm-tf-2.8.3\n- tpu-vm-tf-2.8.0\n- tpu-vm-tf-2.7.4\n- tpu-vm-tf-2.7.3\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Pod \u5207\u7247\uff0c\u8acb\u5728 TensorFlow \u7248\u672c\u865f\u5f8c\u9762\u9644\u52a0 `-pod` \u3002\u4f8b\u5982 `tpu-vm-tf-2.15.0-pod-pjrt` \u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 TensorFlow \u88dc\u4e01\u7248\u672c\uff0c\u8acb\u53c3\u95b1 [\u652f\u6301\u7684 TensorFlow \u88dc\u4e01\u7248\u672c](https://cloud.google.com/tpu/docs/supported-versions?hl=zh-cn) \u3002\n\u5982\u679c\u60a8\u4f7f\u7528 TensorFlow \u5728 TPU v4 \u4e0a\u8a13\u7df4\u6a21\u578b\uff0cTensorFlow 2.10.0 \u53ca\u66f4\u4f4e\u7248\u672c\u5c07\u4f7f\u7528\u4e0b\u8868\u4e2d\u986f\u793a\u7684 `v4` \u5c08\u7528\u7248\u672c\u3002\u5982\u679c\u8868\u4e2d\u672a\u986f\u793a\u60a8\u4f7f\u7528\u7684 TensorFlow \u7248\u672c\uff0c\u8acb\u6309\u7167 [TensorFlow](#tensorflow-vm) \u90e8\u5206\u4e2d\u7684\u6307\u5c0e\u9032\u884c\u64cd\u4f5c\u3002\n| TensorFlow \u7248\u672c | TPU \u8edf\u4ef6\u7248\u672c         |\n|:------------------|:---------------------------------------------|\n| 2.10.0   | tpu-vm-tf-2.10.0-v4\u3001tpu-vm-tf-2.10.0-pod-v4 |\n| 2.9.3    | tpu-vm-tf-2.9.3-v4\u3001tpu-vm-tf-2.9.3-pod-v4 |\n| 2.9.2    | tpu-vm-tf-2.9.2-v4\u3001tpu-vm-tf-2.9.2-pod-v4 |\n| 2.9.1    | tpu-vm-tf-2.9.1-v4\u3001tpu-vm-tf-2.9.1-pod-v4 |\n\u5275\u5efa TPU \u865b\u64ec\u6a5f\u6642\u9810\u88dd\u4e86 TensorFlow \u4e26\u9810\u5b89\u88dd\u4e86\u76f8\u61c9\u7684 Libtpu \u5eab\u3002\u5982\u679c\u60a8\u8981\u5275\u5efa\u81ea\u5df1\u7684\u865b\u64ec\u6a5f\u6620\u50cf\uff0c\u8acb\u6307\u5b9a\u4ee5\u4e0b TensorFlow TPU \u8edf\u4ef6\u7248\u672c\u548c\u76f8\u61c9\u7684 `libtpu` \u7248\u672c\uff1a\n| TensorFlow \u7248\u672c | libtpu.so \u7248\u672c |\n|:------------------|:-----------------|\n| 2.15.0   | 1.9.0   |\n| 2.14.1   | 1.8.1   |\n| 2.14.0   | 1.8.0   |\n| 2.13.1   | 1.7.1   |\n| 2.13.0   | 1.7.0   |\n| 2.12.1   | 1.6.1   |\n| 2.12.0   | 1.6.0   |\n| 2.11.1   | 1.5.1   |\n| 2.11.0   | 1.5.0   |\n| 2.10.1   | 1.4.1   |\n| 2.10.0   | 1.4.0   |\n| 2.9.3    | 1.3.2   |\n| 2.9.1    | 1.3.0   |\n| 2.8.3    | 1.2.3   |\n| 2.8.*    | 1.2.0   |\n| 2.7.3    | 1.1.2   |\n### PyTorch\n\u4f7f\u7528\u8207\u7de8\u5beb\u6a21\u578b\u6642\u6240\u7528\u7684 PyTorch \u7248\u672c\u5339\u914d\u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f PyTorch 1.13 \u548c TPU v2 \u6216 v3\uff0c\u8acb\u4f7f\u7528 `tpu-vm-pt-1.13` TPU \u8edf\u4ef6\u7248\u672c\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f TPU v4\uff0c\u8acb\u4f7f\u7528 `tpu-vm-v4-pt-1.13` TPU \u8edf\u4ef6\u7248\u672c\u3002TPU Pod \u4f7f\u7528\u76f8\u540c\u7684 TPU \u8edf\u4ef6\u7248\u672c\uff08\u4f8b\u5982 `v2-32` \u3001 `v3-128` \u3001 `v4-32` \uff09\u3002\u7576\u524d\u652f\u6301\u7684 TPU \u8edf\u4ef6\u7248\u672c\u7232\uff1a- tpu-vm-pt-2.0 (pytorch-2.0)\n- tpu-vm-pt-1.13 (pytorch-1.13)\n- tpu-vm-pt-1.12 (pytorch-1.12)\n- tpu-vm-pt-1.11 (pytorch-1.11)\n- tpu-vm-pt-1.10 (pytorch-1.10)\n- v2-alpha \u7248 (pytorch-1.8.1)- tpu-vm-v4-pt-2.0 (pytorch-2.0)\n- tpu-vm-v4-pt-1.13 (pytorch-1.13)\n\u5275\u5efa TPU \u865b\u64ec\u6a5f\u6642\uff0cTPU \u865b\u64ec\u6a5f\u4e0a\u6703\u9810\u5b89\u88dd\u6700\u65b0\u7248\u672c\u7684 PyTorch\u3002\u7576\u60a8\u5b89\u88dd PyTorch \u6642\uff0c\u7cfb\u7d71\u6703\u81ea\u52d5\u5b89\u88dd\u6b63\u78ba\u7248\u672c\u7684 libtpu.so\u3002\n\u5982\u9700\u66f4\u6539\u7576\u524d\u7684 PyTorch \u8edf\u4ef6\u7248\u672c\uff0c\u8acb\u53c3\u95b1 [\u66f4\u6539 PyTorch \u7248\u672c](https://cloud.google.com/tpu/docs/pytorch-xla-ug-tpu-vm?hl=zh-cn#changing_pytorch_version) \u3002\n### JAX\n\u60a8\u5fc5\u9808\u5728 TPU \u865b\u64ec\u6a5f\u4e0a\u624b\u52d5\u5b89\u88dd JAX\uff0c\u56e0\u7232\u4e0d\u5b58\u5728\u7279\u5b9a\u65bc JAX \u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u5c0d\u65bc\u6240\u6709 TPU \u7248\u672c\uff0c\u8acb\u4f7f\u7528 tpu-ubuntu2204-base\u3002\u7576\u60a8\u5b89\u88dd JAX \u6642\uff0c\u7cfb\u7d71\u6703\u81ea\u52d5\u5b89\u88dd\u6b63\u78ba\u7248\u672c\u7684 libtpu.so\u3002\n## TPU \u7bc0\u9ede\u8edf\u4ef6\u7248\u672c\n\u672c\u90e8\u5206\u4ecb\u7d39\u4e86\u5728 [TPU \u7bc0\u9ede](https://cloud.google.com/tpu/docs/system-architecture-tpu-vm?hl=zh-cn#tpu-node-arch) \u67b6\u69cb\u4e2d\u61c9\u7528\u65bc TPU \u6642\u61c9\u4f7f\u7528\u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u5982\u9700\u77ad\u89e3 [TPU \u865b\u64ec\u6a5f](https://cloud.google.com/tpu/docs/system-architecture-tpu-vm?hl=zh-cn#tpu-vm-arch) \u67b6\u69cb\uff0c\u8acb\u53c3\u95b1 [TPU \u865b\u64ec\u6a5f\u8edf\u4ef6\u7248\u672c](#tpu-vm-versions) \u3002\nTPU \u8edf\u4ef6\u7248\u672c\u9069\u7528\u65bc TensorFlow\u3001PyTorch \u548c JAX \u6846\u67b6\u3002\n### TensorFlow\n\u4f7f\u7528\u8207\u7de8\u5beb\u6a21\u578b\u6642\u6240\u7528 TensorFlow \u7248\u672c\u76f8\u5339\u914d\u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f TensorFlow 2.12.0\uff0c\u8acb\u4f7f\u7528 `2.12.0` TPU \u8edf\u4ef6\u7248\u672c\u3002TensorFlow \u5c08\u7528 TPU \u8edf\u4ef6\u7248\u672c\u5982\u4e0b\uff1a\n- 2.12.1\n- 2.12.0\n- 2.11.1\n- 2.11.0\n- 2.10.1\n- 2.10.0\n- 2.9.3\n- 2.9.1\n- 2.8.4\n- 2.8.2\n- 2.7.3\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 TensorFlow \u88dc\u4e01\u7248\u672c\uff0c\u8acb\u53c3\u95b1 [\u652f\u6301\u7684 TensorFlow \u88dc\u4e01\u7248\u672c](https://cloud.google.com/tpu/docs/supported-patches?hl=zh-cn) \u3002\n\u5275\u5efa TPU \u7bc0\u9ede\u6642\uff0cTPU \u7bc0\u9ede\u4e0a\u6703\u9810\u5b89\u88dd\u6700\u65b0\u7248\u672c\u7684 TensorFlow\u3002\n### PyTorch\n\u4f7f\u7528\u8207\u7de8\u5beb\u6a21\u578b\u7684 PyTorch \u7248\u672c\u5339\u914d\u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f PyTorch 1.9\uff0c\u8acb\u4f7f\u7528 `pytorch-1.9` \u8edf\u4ef6\u7248\u672c\u3002\nPyTorch \u5c08\u7528 TPU \u8edf\u4ef6\u7248\u672c\u5982\u4e0b\uff1a\n- pytorch-2.0\n- pytorch-1.13\n- pytorch-1.12\n- pytorch-1.11\n- pytorch-1.10\n- pytorch-1.9\n- pytorch-1.8\n- pytorch-1.7\n- pytorch-1.6\n- pytorch-nightly\n\u5275\u5efa TPU \u7bc0\u9ede\u6642\uff0cTPU \u7bc0\u9ede\u4e0a\u6703\u9810\u5b89\u88dd\u6700\u65b0\u7248\u672c\u7684 PyTorch\u3002\n### JAX\n\u60a8\u5fc5\u9808\u5728 TPU \u865b\u64ec\u6a5f\u4e0a\u624b\u52d5\u5b89\u88dd JAX\uff0c\u56e0\u6b64\u4fc2\u7d71\u4e0d\u6703\u9810\u5b89\u88dd\u7279\u5b9a\u65bc JAX \u7684 TPU \u8edf\u4ef6\u7248\u672c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5217\u51fa\u7684\u9069\u7528\u65bc TensorFlow \u7684\u4efb\u4f55\u8edf\u4ef6\u7248\u672c\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u5982\u9700\u8a73\u7d30\u77ad\u89e3 TPU \u67b6\u69cb\uff0c\u8acb\u53c3\u95b1 [\u7cfb\u7d71\u67b6\u69cb](https://cloud.google.com/tpu/docs/system-architecture-tpu-vm?hl=zh-cn) \u9801\u9762\u3002\n- \u8acb\u53c3\u95b1 [\u4f55\u6642\u4f7f\u7528 TPU](https://cloud.google.com/tpu/docs/tpus?hl=zh-cn#when_to_use_tpus) \uff0c\u77ad\u89e3\u9069\u7528\u65bc Cloud TPU \u7684\u6a21\u578b\u985e\u578b\u3002", "guide": "Cloud TPU"}