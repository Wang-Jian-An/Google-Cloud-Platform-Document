{"title": "Documentation - Key Management Service (KMS)", "url": "https://cloud.google.com/distributed-cloud/hosted/docs/latest/gdch/overview", "abstract": "# Documentation - Key Management Service (KMS)\n| 0     | 1                 |\n|:-------------------|:------------------------------------------------------------------|\n| Workload location | Organization only workloads          |\n| Audit log source | Service Mesh Envoy access logs Kubernetes audit logs    |\n| Audited operations | API server (control plane) Istio (data plane) Server (data plane) |\n", "content": "## API server\nLog type: Control plane.\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')            |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------|\n| User or service identity              | user                    | For example, \"user\":{ \"groups\":[\"system:authenticated\"], \"username\":\"fop-platform-admin@example.com\" }   |\n| Target (Fields and values that call the API)         | objectRef                  | \"objectRef\":{ \"resource\":\"aeadkeys\", \"apiGroup\":\"kms.gdc.goog\", \"apiVersion\":\"v1\", \"namespace\":\"kms-test1\" } |\n| Action (Fields containing the performed operation)        | verb                    | For example, \"verb\": \"create\"                     |\n| Event timestamp                | requestReceivedTimestamp               | For example, \"requestReceivedTimestamp\":\"2022-12-08T03:59:20.025703Z\"           |\n| Source of action                | sourceIPs                  | For example, \"sourceIPs\":[ \"10.200.0.7\" ]                  |\n| Outcome                  | responseStatus                 | For example, \"responseStatus\": { \"metadata\": {}, \"code\": 200 }             |\n| Other fields                 | Not applicable                 | Not applicable                         |\n**Example log**\n```\n{\u00a0 \"user\":{\u00a0 \u00a0 \"groups\":[\"system:authenticated\"],\u00a0 \u00a0 \"username\":\"fop-platform-admin@example.com\"\u00a0 },\u00a0 \"auditID\":\"bec33328-b4ba-431e-96a2-9bbb77666478\",\u00a0 \"_gdch_fluentbit_pod\":\"anthos-audit-logs-forwarder-wxw7t\",\u00a0 \"stage\":\"RequestReceived\",\u00a0 \"_gdch_cluster\":\"org-1-admin\",\u00a0 \"userAgent\":\"kubectl/v1.25.4 (linux/amd64) kubernetes/872a965\",\u00a0 \"kind\":\"Event\",\u00a0 \"level\":\"Metadata\",\u00a0 \"stageTimestamp\":\"2022-12-08T03:59:20.025703Z\",\u00a0 \"requestReceivedTimestamp\":\"2022-12-08T03:59:20.025703Z\",\u00a0 \"objectRef\":{\u00a0 \u00a0 \"resource\":\"aeadkeys\",\u00a0 \u00a0 \"apiGroup\":\"kms.gdc.goog\",\u00a0 \u00a0 \"apiVersion\":\"v1\",\u00a0 \u00a0 \"namespace\":\"kms-test1\"\u00a0 },\u00a0 \"sourceIPs\":[\u00a0 \u00a0 \"10.200.0.7\"\u00a0 ],\u00a0 \"apiVersion\":\"audit.k8s.io/v1\",\u00a0 \"requestURI\":\"/apis/kms.gdc.goog/v1/namespaces/kms-test1/aeadkeys?fieldManager=kubectl-client-side-apply&fieldValidation=Strict\",\u00a0 \"verb\":\"create\",\u00a0 \"_gdch_service_name\":\"apiserver\"}\n```\n## Istio\nLog type: Data plane.\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')                                         |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| User or service identity              | username                   | For example, \"username\":\"fop-platform-admin@example.com\"                                            |\n| Target (Fields and values that call the API)         | resource                   | \"resource\":{ \"node_name\":\"sidecar~10.253.166.144~kms-backend-84f5c4f4c7-ncl4d.kms-system~kms-system.svc.cluster.local\", \"cluster_name\":\"kms-backend.kms-system\", \"zone_name\":\"europe-west4-b\", \"log_name\":\"otel_envoy_accesslog\" } |\n| Action (Fields containing the performed operation)        | path                    | For example, \"path\":\"/goog.gdc.kms.v1.CryptoOperationsService/Encrypt\"                                         |\n| Event timestamp                | start_time                  | For example, \"start_time\":\"2022-12-08T04:03:33.859Z\"                                             |\n| Source of action                | x_forwarded_for                 | For example, \"x_forwarded_for\":\"10.253.165.123\"                                              |\n| Outcome                  | response_code                 | For example, \"response_code\":\"200\"                                                  |\n| Other fields                 | Not applicable                 | Not applicable                                                       |\n**Example log**\n```\n{\u00a0 \"response_code\":\"200\",\u00a0 \"response_code_details\":\"via_upstream\",\u00a0 \"response_flags\":\"-\",\u00a0 \"route_name\":\"default\",\u00a0 \"severity_number\":0,\u00a0 \"severity_text\":\"\",\u00a0 \"start_time\":\"2022-12-08T04:03:33.859Z\",\u00a0 \"_gdch_service_name\":\"istio\",\u00a0 \"upstream_host\":\"10.253.166.144:8080\",\u00a0 \"upstream_local_address\":\"127.0.0.6:54383\",\u00a0 \"user_agent\":\"grpc-go/1.49.0\",\u00a0 \"_gdch_service_tenant\":\"platform-obs\",\u00a0 \"username\":\"fop-platform-admin@example.com\",\u00a0 \"x_envoy_upstream_service_time\":\"104\",\u00a0 \"x_forwarded_for\":\"10.253.165.123\",\u00a0 \"x_goog_api_client\":\"-\",\u00a0 \"x_request_id\":\"c11cbf94-765d-440d-9d36-56654d93d834\",\u00a0 \"authority\":\"kms.org-1.zone1.google.gdch.test\",\u00a0 \"bytes_received\":\"32756\",\u00a0 \"body\":{},\u00a0 \"upstream_transport_failure_reason\":\"-\",\u00a0 \"bytes_sent\":\"0\",\u00a0 \"downstream_local_address\":\"10.253.166.144:8080\",\u00a0 \"downstream_remote_address\":\"10.253.165.123:0\",\u00a0 \"duration\":\"318\",\u00a0 \"method\":\"POST\",\u00a0 \"observed_time_unix_nano\":0,\u00a0 \"protocol\":\"HTTP/2\",\u00a0 \"requested_server_name\":\"outbound_.8080_._.kms-backend.kms-system.svc.cluster.local\",\u00a0 \"_gdch_namespace\":\"istio-system\",\u00a0 \"path\":\"/goog.gdc.kms.v1.CryptoOperationsService/Encrypt\",\u00a0 \"connection_termination_details\":\"-\",\u00a0 \"time_unix_nano\":1670472213859570944,\u00a0 \"upstream_cluster\":\"inbound|8080||\",\u00a0 \"resource\":{\u00a0 \u00a0 \"node_name\":\"sidecar~10.253.166.144~kms-backend-84f5c4f4c7-ncl4d.kms-system~kms-system.svc.cluster.local\",\u00a0 \u00a0 \"cluster_name\":\"kms-backend.kms-system\",\u00a0 \u00a0 \"zone_name\":\"europe-west4-b\",\u00a0 \u00a0 \"log_name\":\"otel_envoy_accesslog\"\u00a0 },\u00a0 \"_gdch_cluster\":\"org-1-admin\",\u00a0 \"_gdch_fluentbit_pod\":\"anthos-audit-logs-forwarder-cr9h7\"}\n```\n## Server\nLog type: Data plane.\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')     |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------|\n| User or service identity              | message.user.identity               | For example, \"message\":{\"user\":\"{\"identity\":\"fop-platform-admin@example.com\"}}\"  |\n| Target (Fields and values that call the API)         | _gdch_service_name                | \"_gdch_service_name\":\"kms-backend\"              |\n| Action (Fields containing the performed operation)        | message.action                 | For example, \"message\":\"{\"action\":\"/goog.gdc.kms.v1.CryptoOperationsService/Encrypt\"}\" |\n| Event timestamp                | time                    | For example, \"time\":\"2022-12-08T04:25:32.676604174Z\"         |\n| Source of action                | _gdch_cluster                 | For example, \"_gdch_cluster\":\"org-1-admin\"            |\n| Outcome                  | message.response                 | For example, \"message\":\"{\"response\":\"OK\"}\"            |\n| Other fields                 | The message.description field contains the complete log message.     | For more information, see the Example log.            |\n**Example log**\n```\n{\u00a0 \u00a0 \"pri\":\"46\",\u00a0 \u00a0 \"time\":\"2023-05-30T20:58:25Z\",\u00a0 \u00a0 \"host\":\"kms-backend-9dd54b666-jfp5v\",\u00a0 \u00a0 \"ident\":\"/kms_bin\",\u00a0 \u00a0 \"pid\":\"1\",\u00a0 \u00a0 \"msgid\":\"audit-log\",\u00a0 \u00a0 \"extradata\":\"-\",\u00a0 \u00a0 \"message\":\"{\\\"time\\\":\\\"2023-08-01T18:04:00.458810232Z\\\",\\\"auditID\\\":\\\"6f848640-8af1-4659-b9c9-a358d19bea5f\\\",\\\"user\\\":{\\\"identity\\\":\\\"fop-platform-admin@example.com\\\"},\\\"resource\\\":\\\"namespaces/testnamespace/aeadKeys/testcryptokey\\\",\\\"action\\\":\\\"/goog.gdc.kms.v1.CryptoOperationsService/Decrypt\\\",\\\"description\\\":\\\"{\\\"duration_ms\\\":202}\\\",\\\"userAgent\\\":\\\"grpc-go/1.55.0\\\",\\\"response\\\":\\\"OK\\\",\\\"_gdch_service\\\":\\\"kms\\\"}\",\u00a0 \u00a0 \"_gdch_org_name\":\"org-1\",\u00a0 \u00a0 \"_gdch_org_id\":\"org-1.zone1.google.gdch.test\",\u00a0 \u00a0 \"_gdch_cluster\":\"org-1-admin\",\u00a0 \u00a0 \"_gdch_fluentbit_pod\":\"anthos-audit-logs-forwarder-5lq2g\",\u00a0 \u00a0 \"_gdch_service_name\":\"kms-backend\",\u00a0 \u00a0 \"_gdch_tenant_id\":\"platform-obs\"}\n```", "guide": "Documentation"}