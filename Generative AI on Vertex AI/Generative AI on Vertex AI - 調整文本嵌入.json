{"title": "Generative AI on Vertex AI - \u8abf\u6574\u6587\u672c\u5d4c\u5165", "url": "https://cloud.google.com/vertex-ai/generative-ai/docs/models/tune-embeddings?hl=zh-cn", "abstract": "# Generative AI on Vertex AI - \u8abf\u6574\u6587\u672c\u5d4c\u5165\n\u672c\u9801\u9762\u4ecb\u7d39\u77ad\u5982\u4f55\u8abf\u6574 [\u6587\u672c\u5d4c\u5165\u6a21\u578b](https://cloud.google.com/vertex-ai/generative-ai/docs/embeddings/get-text-embeddings?hl=zh-cn) `textembedding-gecko` \u548c `textembedding-gecko-multilingual` \u3002\u9019\u4e9b\u57fa\u790e\u6a21\u578b\u4f7f\u7528\u5927\u91cf\u516c\u5171\u6587\u672c\u6578\u64da\u9032\u884c\u4e86\u8a13\u7df4\u3002\u5982\u679c\u60a8\u7684\u7368\u7279\u4f7f\u7528\u5834\u666f\u9700\u8981\u60a8\u81ea\u5df1\u7684\u7279\u5b9a\u8a13\u7df4\u6578\u64da\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u8abf\u6574\u3002\u8abf\u6574\u57fa\u790e\u5d4c\u5165\u6a21\u578b\u5f8c\uff0c\u61c9\u6839\u64da\u60a8\u7684\u61c9\u7528\u5834\u666f\u91cf\u8eab\u5b9a\u88fd\u6a21\u578b\u3002\u6587\u672c\u5d4c\u5165\u6a21\u578b\u7684 [\u7a69\u5b9a\u7248\u672c](https://cloud.google.com/vertex-ai/generative-ai/docs/learn/model-versioning?hl=zh-cn#stable-version-available) \u652f\u6301\u8abf\u6574\u3002\n\u6587\u672c\u5d4c\u5165\u6a21\u578b\u652f\u6301 [\u76e3\u7763\u5f0f\u8abf\u53c3](https://cloud.google.com/vertex-ai/generative-ai/docs/models/tune-text-models-supervised?hl=zh-cn) \u3002\u76e3\u7763\u5f0f\u8abf\u6574\u4f7f\u7528\u6709\u6a19\u7c64\u6a23\u672c\uff0c\u9019\u4e9b\u6a23\u672c\u8868\u660e\u4e86\u4f60\u5728\u63a8\u7406\u671f\u9593\u5e0c\u671b\u6587\u672c\u5d4c\u5165\u6a21\u578b\u7684\u8f38\u51fa\u985e\u578b\u3002\u6587\u672c\u5d4c\u5165\u6a21\u578b\u4e0d\u652f\u6301\u4f7f\u7528 [\u57fa\u65bc\u4eba\u985e\u53cd\u994b\u7684\u5f37\u5316\u5b78\u7fd2 (RLHF)](https://cloud.google.com/vertex-ai/generative-ai/docs/models/tune-text-models-rlhf?hl=zh-cn) \u9032\u884c\u8abf\u53c3\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6a21\u578b\u8abf\u6574\uff0c\u8acb\u53c3\u95b1 [\u6a21\u578b\u8abf\u6574\u7684\u5de5\u4f5c\u539f\u7406](https://cloud.google.com/vertex-ai/generative-ai/docs/models/tune-models?hl=zh-cn#how_model_tuning_works) \u3002\n", "content": "## \u8abf\u6574\u5d4c\u5165\u6a21\u578b\u7684\u61c9\u7528\u5834\u666f\n\u901a\u904e\u8abf\u6574\u6587\u672c\u5d4c\u5165\u6a21\u578b\uff0c\u60a8\u7684\u6a21\u578b\u53ef\u4ee5\u9069\u61c9\u7279\u5b9a\u9818\u57df\u6216\u4efb\u52d9\u7684\u5d4c\u5165\u3002\u5982\u679c\u9810\u8a13\u7df4\u7684\u5d4c\u5165\u6a21\u578b\u4e0d\u80fd\u5f88\u597d\u5730\u6eff\u8db3\u60a8\u7684\u7279\u5b9a\u9700\u6c42\uff0c\u9019\u5c07\u975e\u5e38\u6709\u7528\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u91dd\u5c0d\u516c\u53f8\u7684\u7279\u5b9a\u5ba2\u6236\u670d\u52d9\u5de5\u55ae\u6578\u64da\u96c6\u5fae\u8abf\u5d4c\u5165\u6a21\u578b\u3002\u9019\u6709\u52a9\u65bc\u804a\u5929\u6a5f\u5668\u4eba\u77ad\u89e3\u5ba2\u6236\u901a\u5e38\u63d0\u51fa\u7684\u5404\u7a2e\u5ba2\u6236\u670d\u52d9\u554f\u984c\uff0c\u5f9e\u800c\u80fd\u5920\u66f4\u6709\u6548\u5730\u56de\u7b54\u554f\u984c\u3002\u5982\u679c\u4e0d\u5fae\u8abf\uff0c\u6a21\u578b\u5c31\u4e0d\u77e5\u9053\u5ba2\u6236\u670d\u52d9\u5de5\u55ae\u7684\u5177\u9ad4\u4fe1\u606f\u6216\u7522\u54c1\u7279\u5b9a\u554f\u984c\u7684\u89e3\u6c7a\u65b9\u6848\u3002\n## \u8abf\u6574\u5de5\u4f5c\u6d41\nVertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI \u4e0a\u9069\u7528\u65bc `textembedding-gecko` \u548c `textembedding-gecko-multilingual` \u7684\u6a21\u578b\u8abf\u512a\u5de5\u4f5c\u6d41\u5982\u4e0b\uff1a\n- \u6e96\u5099\u6a21\u578b\u8abf\u6574\u6578\u64da\u96c6\u3002\n- \u5c07\u6a21\u578b\u8abf\u6574\u6578\u64da\u96c6\u4e0a\u50b3\u5230 Cloud Storage \u5b58\u5132\u6876\u3002\n- \u5275\u5efa\u6a21\u578b\u8abf\u6574\u4f5c\u696d\u3002\n- \u5c07\u8abf\u512a\u5f8c\u7684\u6a21\u578b\u90e8\u7f72\u5230\u540c\u540d\u7684 Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI \u7aef\u9ede\u3002\u8207\u6587\u672c\u6216 Codey \u6a21\u578b\u8abf\u512a\u4f5c\u696d\u4e0d\u540c\uff0c\u6587\u672c\u5d4c\u5165\u8abf\u512a\u4f5c\u696d\u4e0d\u6703\u5c07\u8abf\u512a\u5f8c\u7684\u6a21\u578b\u90e8\u7f72\u5230 Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI \u7aef\u9ede\u3002## \u6e96\u5099\u5d4c\u5165\u6578\u64da\u96c6\n\u7528\u65bc\u8abf\u6574\u5d4c\u5165\u6a21\u578b\u7684\u6578\u64da\u96c6\u5305\u62ec\u8207\u60a8\u5e0c\u671b\u6a21\u578b\u57f7\u884c\u7684\u4efb\u52d9\u76f8\u914d\u7684\u6578\u64da\u3002\n### \u7528\u65bc\u8abf\u6574\u5d4c\u5165\u6a21\u578b\u7684\u6578\u64da\u96c6\u683c\u5f0f\n\u8a13\u7df4\u6578\u64da\u96c6\u5305\u542b\u4ee5\u4e0b\u6587\u4ef6\uff0c\u9019\u4e9b\u6587\u4ef6\u9700\u8981\u4f4d\u65bc Cloud Storage \u4e2d\u3002\u6587\u4ef6\u7684\u8def\u5f91\u5728\u5553\u52d5\u8abf\u6574\u6d41\u6c34\u7dda\u6642\u7531\u53c3\u6578\u5b9a\u7fa9\u3002\u56db\u500b\u5fc5\u9700\u6587\u4ef6\u662f **\u8a9e\u6599\u5eab\u6587\u4ef6** \u3001 **\u67e5\u8a62\u6587\u4ef6** \u3001 **\u8a13\u7df4\u6a19\u7c64** \u548c **\u6e2c\u8a66\u6a19\u7c64** \u3002\n- **\u8a9e\u6599\u5eab\u6587\u4ef6** \uff1a\u8def\u5f91\u7531\u53c3\u6578 `corpus_path` \u5b9a\u7fa9\u3002\u9019\u662f\u4e00\u500b JSONL \u6587\u4ef6\uff0c\u5176\u4e2d\u6bcf\u4e00\u884c\u90fd\u5305\u542b\u5177\u6709\u5b57\u7b26\u4e32\u503c\u7684\u5b57\u6bb5 `_id` \u3001 `title` \u548c `text` \u3002 `_id` \u548c `text` \u662f\u5fc5\u9700\u7684\uff0c\u800c `title` \u662f\u53ef\u9078\u7684\u3002\u4f8b\u5982\uff1a```\n{\"_id\": \"doc1\", \"title\": \"Get an introduction to generative AI on Vertex AI\", \"text\": \"Vertex AI's Generative AI Studio offers a Google Cloud console tool for rapidly prototyping and testing generative AI models. Learn how you can use Generative AI Studio to test models using prompt samples, design and save prompts, tune a foundation model, and convert between speech and text.\"}{\"_id\": \"doc2\", \"title\": \"Use gen AI for summarization, classification, and extraction\", \"text\": \"Learn how to create text prompts for handling any number of tasks with Vertex AI's generative AI support. Some of the most common tasks are classification, summarization, and extraction. Vertex AI's PaLM API for text lets you design prompts with flexibility in terms of their structure and format.\"}{\"_id\": \"doc3\", \"title\": \"Custom ML training overview and documentation\", \"text\": \"Get an overview of the custom training workflow in Vertex AI, the benefits of custom training, and the various training options that are available. This page also details every step involved in the ML training workflow from preparing data to predictions.\"}\n```\n- **\u67e5\u8a62\u6587\u4ef6** \uff1a\u67e5\u8a62\u6587\u4ef6\u5305\u542b\u60a8\u7684\u793a\u4f8b\u67e5\u8a62\u3002\u8a72\u8def\u5f91\u7531\u53c3\u6578 `queries_path` \u5b9a\u7fa9\u3002\u67e5\u8a62\u6587\u4ef6\u63a1\u7528 JSONL \u683c\u5f0f\uff0c\u4e26\u4e14\u8207\u8a9e\u6599\u5eab\u6587\u4ef6\u5177\u6709\u76f8\u540c\u7684\u5b57\u6bb5\u3002\u4f8b\u5982\uff1a```\n{\"_id\": \"query1\", \"title\": \"generative AI on Vertex\", \"text\": \"Does Vertex support generative AI?\"}{\"_id\": \"query2\", \"text\": \"What can I do with Vertex GenAI offerings?\"}{\"_id\": \"query3\", \"text\": \"How do I train my models using Vertex?\"}\n```\n- **\u8a13\u7df4\u6a19\u7c64** \uff1a\u8def\u5f91\u7531\u53c3\u6578 `train_label_path` \u5b9a\u7fa9\u3002train_label_path \u662f\u8a13\u7df4\u6a19\u7c64\u6578\u64da\u4f4d\u7f6e\u7684 Cloud Storage URI\uff0c\u5728\u5275\u5efa\u8abf\u6574\u4f5c\u696d\u6642\u6307\u5b9a\u3002\u6a19\u7c64\u5fc5\u9808\u662f\u5e36\u6709\u6a19\u984c\u7684 TSV \u6587\u4ef6\u3002\u60a8\u7684\u8a13\u7df4\u6a19\u7c64\u6587\u4ef6\u4e2d\u5fc5\u9808\u5305\u542b\u4e00\u90e8\u5206\u67e5\u8a62\u548c\u8a9e\u6599\u5eab\u3002\u8a72\u6587\u4ef6\u5fc5\u9808\u5305\u542b `query-id` \u3001 `corpus-id` \u548c `score` \u5217\u3002 `query-id` \u662f\u4e00\u500b\u5b57\u7b26\u4e32\uff0c\u8207\u67e5\u8a62\u6587\u4ef6\u4e2d\u7684 `_id` \u9375\u5339\u914d\uff0c `corpus-id` \u662f\u4e00\u500b\u5b57\u7b26\u4e32\uff0c\u8207\u8a9e\u6599\u5eab\u6587\u4ef6\u4e2d\u7684 `_id` \u5339\u914d\u3002 `Score` \u662f\u975e\u8ca0\u6574\u6578\u503c\u3002\u4efb\u4f55\u5927\u65bc\u96f6\u7684\u5206\u6578\u90fd\u8868\u793a\u6587\u6a94\u8207\u67e5\u8a62\u76f8\u95dc\u3002\u6578\u5b57\u8d8a\u5927\u8868\u793a\u76f8\u95dc\u6027\u8d8a\u9ad8\u3002\u5982\u679c\u7701\u7565\u5f97\u5206\uff0c\u5247\u9ed8\u8a8d\u503c\u7232 1\u3002\u4f8b\u5982\uff1a```\nquery-id \u00a0corpus-id \u00a0 scorequery1 \u00a0 \u00a0doc1 \u00a0 \u00a01query2 \u00a0 \u00a0doc2 \u00a0 \u00a01query3 \u00a0 \u00a0doc3 \u00a0 \u00a02\n``` **\u6ce8\u610f\uff1a** \u78ba\u4fdd\u6b64\u6587\u4ef6\u4e2d\u7684\u5206\u9694\u7b26\u662f\u88fd\u8868\u7b26 ( `\\t` )\u3002\u67d0\u4e9b\u700f\u89bd\u5668\u548c\u6587\u672c\u7de8\u8f2f\u5668\u53ef\u80fd\u6703\u5c07\u6a19\u7c64\u9801\u66ff\u63db\u7232\u4e00\u7cfb\u5217\u7a7a\u683c\u3002\n- **\u6e2c\u8a66\u6a19\u7c64** \uff1a\u6e2c\u8a66\u6a19\u7c64\u6587\u4ef6\u8def\u5f91\u7531 `test_label_path` \u53c3\u6578\u6307\u5b9a\u3002 `test_label_path` \u662f\u6e2c\u8a66\u6a19\u7c64\u6578\u64da\u4f4d\u7f6e\u7684 Cloud Storage URI\uff0c\u4e26\u5728\u5275\u5efa\u8abf\u6574\u4f5c\u696d\u6642\u6307\u5b9a\u3002\u6b64\u6587\u4ef6\u7684\u683c\u5f0f\u8207\u8a13\u7df4\u6a19\u7c64\u7684\u683c\u5f0f\u76f8\u540c\u3002\n### \u5275\u5efa\u5d4c\u5165\u6a21\u578b\u8abf\u6574\u4f5c\u696d\n\u4ee5\u4e0b\u4ee3\u78bc\u5c55\u793a\u77ad\u5982\u4f55\u4f7f\u7528 REST API \u547d\u4ee4\u5275\u5efa\u5d4c\u5165\u6a21\u578b\u8abf\u6574\u4f5c\u696d\u3002\u76ee\u524d\uff0c\u60a8\u7121\u6cd5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u8abf\u6574\u5d4c\u5165\u6a21\u578b\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- ``\uff1apipelineJob \u7684\u986f\u793a\u540d\u7a31\u3002\n- ``\uff1a\u6d41\u6c34\u7dda\u8f38\u51fa\u5de5\u4ef6\u7684\u8def\u5f91\u3002\n- ``\uff1a\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\n- ``\uff1a\u53ef\u9078\u3002\u4f7f\u7528\u6b64\u53c3\u6578\u6307\u5b9a\u8981\u8abf\u6574\u7684\u6587\u672c\u5d4c\u5165\u6a21\u578b\uff0c\u5426\u5247\u9ed8\u8a8d\u7232\u201ctextembedding-gecko@001\u201d\u3002\n- ``\uff1a\u53ef\u9078\u3002\u8a2d\u7f6e\u6b64\u53c3\u6578\u53ef\u91dd\u5c0d\u7279\u5b9a\u4e0b\u6e38\u4efb\u52d9\u512a\u5316\u8abf\u6574\u6a21\u578b\u3002\n- ``\uff1a\u7528\u65bc\u5b58\u5132\u67e5\u8a62\u7684 Cloud Storage \u5b58\u5132\u6876\u7684 URI\n- ``\uff1a\u8a9e\u6599\u5eab\u6578\u64da\u7684 Cloud Storage URI\u3002 .\n- ``\uff1a\u8a13\u7df4\u6a19\u7c64\u6578\u64da\u4f4d\u7f6e\u7684 Cloud Storage URI\u3002\n- ``\uff1a\u6e2c\u8a66\u6a19\u7c64\u6578\u64da\u4f4d\u7f6e\u7684 Cloud Storage URI\u3002\n- ``\uff1a\u8a13\u7df4\u6279\u6b21\u5927\u5c0f\u3002\n- ``\uff1a\u57f7\u884c\u6a21\u578b\u8abf\u6574\u7684\u6b65\u9a5f\u6578\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://us-central1-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/us-central1/pipelineJobs\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"displayName\": \"DISPLAY_NAME\",\n \"runtimeConfig\": {\n \"gcsOutputDirectory\": \"PIPELINE_SCRATCH_PATH\",\n \"parameterValues\": {\n  \"project\": \"PROJECT_ID\",\n  \"base_model_version_id\": \"BASE_MODEL_VERSION_ID\",\n  \"task_type\": \"TASK_TYPE\"\n  \"location\": \"us-central1\",\n  \"queries_path\": \"QUERIES_PATH\",\n  \"corpus_path\": \"CORPUS_PATH\",\n  \"train_label_path\": \"TRAIN_LABEL_PATH\",\n  \"test_label_path\": \"TEST_LABEL_PATH\",\n  \"batch_size\": \"BATCH_SIZE\",\n  \"iterations\": \"ITERATIONS\"\n }\n },\n \"templateUri\": \"https://us-kfp.pkg.dev/ml-pipeline/llm-text-embedding/tune-text-embedding-model/v1.1.1\"\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\u5553\u52d5\u6d41\u6c34\u7dda\u5f8c\uff0c\u901a\u904e **Google Cloud \u63a7\u5236\u6aaf** \u8ddf\u8e64\u8abf\u7bc0\u4f5c\u696d\u7684\u9032\u5ea6\u3002\n [\u524d\u5f80 Google Cloud \u63a7\u5236\u6aaf](https://console.cloud.google.com/vertex-ai/models?hl=zh-cn) \u5728\u5617\u8a66\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167 [\u300a\u751f\u6210\u5f0f AI \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab\u300b](https://cloud.google.com/vertex-ai/docs/start/client-libraries?hl=zh-cn) \u4e2d\u7684 Java \u8a2d\u7f6e\u8aaa\u660e\u57f7\u884c\u64cd\u4f5c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u751f\u6210\u5f0f AI Java API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/java/docs/reference/google-cloud-aiplatform/latest/com.google.cloud.aiplatform.v1?hl=zh-cn) \u3002\n\u5982\u9700\u5411\u751f\u6210\u5f0f AI \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n```\npackage aiplatform;// [START aiplatform_sdk_embedding_tuning]import com.google.cloud.aiplatform.v1beta1.CreatePipelineJobRequest;import com.google.cloud.aiplatform.v1beta1.LocationName;import com.google.cloud.aiplatform.v1beta1.PipelineJob;import com.google.cloud.aiplatform.v1beta1.PipelineJob.RuntimeConfig;import com.google.cloud.aiplatform.v1beta1.PipelineServiceClient;import com.google.cloud.aiplatform.v1beta1.PipelineServiceSettings;import com.google.protobuf.Value;import java.io.IOException;import java.util.HashMap;import java.util.Map;public class CreatePipelineJobEmbeddingModelTuningSample {\u00a0 public static void main(String[] args) throws IOException {\u00a0 \u00a0 // TODO(developer): Replace these variables before running the sample.\u00a0 \u00a0 String project = \"PROJECT\";\u00a0 \u00a0 String baseModelVersionId = \"BASE_MODEL_VERSION_ID\";\u00a0 \u00a0 String taskType = \"TASK_TYPE\";\u00a0 \u00a0 String location = \"us-central1\";\u00a0 \u00a0 String pipelineJobDisplayName = \"PIPELINE_JOB_DISPLAY_NAME\";\u00a0 \u00a0 String modelDisplayName = \"MODEL_DISPLAY_NAME\";\u00a0 \u00a0 String outputDir = \"OUTPUT_DIR\";\u00a0 \u00a0 String queriesPath = \"DATASET_URI\";\u00a0 \u00a0 String corpusPath = \"DATASET_URI\";\u00a0 \u00a0 String trainLabelPath = \"DATASET_URI\";\u00a0 \u00a0 String testLabelPath = \"DATASET_URI\";\u00a0 \u00a0 int batchSize = 50;\u00a0 \u00a0 int iterations = 300;\u00a0 \u00a0 createPipelineJobEmbeddingModelTuningSample(\u00a0 \u00a0 \u00a0 \u00a0 project,\u00a0 \u00a0 \u00a0 \u00a0 baseModelVersionId,\u00a0 \u00a0 \u00a0 \u00a0 taskType,\u00a0 \u00a0 \u00a0 \u00a0 location,\u00a0 \u00a0 \u00a0 \u00a0 pipelineJobDisplayName,\u00a0 \u00a0 \u00a0 \u00a0 modelDisplayName,\u00a0 \u00a0 \u00a0 \u00a0 outputDir,\u00a0 \u00a0 \u00a0 \u00a0 queriesPath,\u00a0 \u00a0 \u00a0 \u00a0 corpusPath,\u00a0 \u00a0 \u00a0 \u00a0 trainLabelPath,\u00a0 \u00a0 \u00a0 \u00a0 testLabelPath,\u00a0 \u00a0 \u00a0 \u00a0 batchSize,\u00a0 \u00a0 \u00a0 \u00a0 iterations);\u00a0 }\u00a0 // Create a model tuning job\u00a0 public static void createPipelineJobEmbeddingModelTuningSample(\u00a0 \u00a0 \u00a0 String project,\u00a0 \u00a0 \u00a0 String baseModelVersionId,\u00a0 \u00a0 \u00a0 String taskType,\u00a0 \u00a0 \u00a0 String location,\u00a0 \u00a0 \u00a0 String pipelineJobDisplayName,\u00a0 \u00a0 \u00a0 String modelDisplayName,\u00a0 \u00a0 \u00a0 String outputDir,\u00a0 \u00a0 \u00a0 String queriesPath,\u00a0 \u00a0 \u00a0 String corpusPath,\u00a0 \u00a0 \u00a0 String trainLabelPath,\u00a0 \u00a0 \u00a0 String testLabelPath,\u00a0 \u00a0 \u00a0 int batchSize,\u00a0 \u00a0 \u00a0 int iterations)\u00a0 \u00a0 \u00a0 throws IOException {\u00a0 \u00a0 final String endpoint = String.format(\"%s-aiplatform.googleapis.com:443\", location);\u00a0 \u00a0 PipelineServiceSettings pipelineServiceSettings =\u00a0 \u00a0 \u00a0 \u00a0 PipelineServiceSettings.newBuilder().setEndpoint(endpoint).build();\u00a0 \u00a0 // Initialize client that will be used to send requests. This client only needs to be created\u00a0 \u00a0 // once, and can be reused for multiple requests.\u00a0 \u00a0 try (PipelineServiceClient client = PipelineServiceClient.create(pipelineServiceSettings)) {\u00a0 \u00a0 \u00a0 Map<String, Value> parameterValues = new HashMap<>();\u00a0 \u00a0 \u00a0 parameterValues.put(\"project\", stringToValue(project));\u00a0 \u00a0 \u00a0 parameterValues.put(\"base_model_version_id\", stringToValue(baseModelVersionId));\u00a0 \u00a0 \u00a0 parameterValues.put(\"task_type\", stringToValue(taskType));\u00a0 \u00a0 \u00a0 parameterValues.put(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"location\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 stringToValue(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"us-central1\")); // Deployment is only supported in us-central1.\u00a0 \u00a0 \u00a0 parameterValues.put(\"queries_path\", stringToValue(queriesPath));\u00a0 \u00a0 \u00a0 parameterValues.put(\"corpus_path\", stringToValue(corpusPath));\u00a0 \u00a0 \u00a0 parameterValues.put(\"train_label_path\", stringToValue(trainLabelPath));\u00a0 \u00a0 \u00a0 parameterValues.put(\"test_label_path\", stringToValue(testLabelPath));\u00a0 \u00a0 \u00a0 parameterValues.put(\"batch_size\", numberToValue(batchSize));\u00a0 \u00a0 \u00a0 parameterValues.put(\"iterations\", numberToValue(iterations));\u00a0 \u00a0 \u00a0 RuntimeConfig runtimeConfig =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 RuntimeConfig.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setGcsOutputDirectory(outputDir)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .putAllParameterValues(parameterValues)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 PipelineJob pipelineJob =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 PipelineJob.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setTemplateUri(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"https://us-kfp.pkg.dev/ml-pipeline/llm-text-embedding/tune-text-embedding-model/v1.1.2\")\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setDisplayName(pipelineJobDisplayName)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setRuntimeConfig(runtimeConfig)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 LocationName parent = LocationName.of(project, location);\u00a0 \u00a0 \u00a0 CreatePipelineJobRequest request =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 CreatePipelineJobRequest.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setParent(parent.toString())\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setPipelineJob(pipelineJob)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 PipelineJob response = client.createPipelineJob(request);\u00a0 \u00a0 \u00a0 System.out.format(\"response: %s\\n\", response);\u00a0 \u00a0 \u00a0 System.out.format(\"Name: %s\\n\", response.getName());\u00a0 \u00a0 }\u00a0 }\u00a0 static Value stringToValue(String str) {\u00a0 \u00a0 return Value.newBuilder().setStringValue(str).build();\u00a0 }\u00a0 static Value numberToValue(int n) {\u00a0 \u00a0 return Value.newBuilder().setNumberValue(n).build();\u00a0 }}// [END aiplatform_sdk_embedding_tuning]\n```\u5982\u9700\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u8abf\u512a\u6587\u672c\u5d4c\u5165\u6a21\u578b\uff0c\u60a8\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u5553\u52d5\u81ea\u5b9a\u7fa9\u6d41\u6c34\u7dda\uff1a- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u751f\u6210\u5f0f AI \u90e8\u5206\u4e2d\uff0c\u9032\u5165 **Vertex AI Pipelines** \u9801\u9762\u3002 [\u524d\u5f80 Vertex AI Pipelines](https://console.cloud.google.com/vertex-ai//vertex-ai/pipelines/runs?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa\u904b\u884c\u4f5c\u696d** \u4ee5\u6253\u958b **\u5275\u5efa\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d** \u7a97\u683c\u3002\n- \u9ede\u64ca **\u5f9e\u73fe\u6709\u6d41\u6c34\u7dda\u4e2d\u9078\u64c7** \uff0c\u7136\u5f8c\u8f38\u5165\u4ee5\u4e0b\u8a73\u7d30\u4fe1\u606f\uff1a- \u5f9e **\u9078\u64c7\u8cc7\u6e90** \u4e0b\u62c9\u5217\u8868\u4e2d\u9078\u64c7\u201cml-pipeline\u201d\u3002\n- \u5f9e **\u5009\u5eab** \u4e0b\u62c9\u5217\u8868\u4e2d\u9078\u64c7\u201cllm-embedding-text\u201d\u3002\n- \u5f9e **\u6d41\u6c34\u7dda\u6216\u7d44\u4ef6** \u4e0b\u62c9\u5217\u8868\u4e2d\u9078\u64c7\u201ctune-text-embedding-model\u201d\u3002\n- \u5f9e **\u7248\u672c** \u4e0b\u62c9\u5217\u8868\u4e2d\u9078\u64c7\u6a19\u8a18\u7232\u201cv1.1.2\u201d\u7684\u7248\u672c\u3002- \u6307\u5b9a **\u904b\u884c\u540d\u7a31** \u4ee5\u552f\u4e00\u6a19\u8b58\u6d41\u6c34\u7dda\u904b\u884c\u3002\n- \u5728 **\u5340\u57df** \u4e0b\u62c9\u5217\u8868\u4e2d\uff0c\u9078\u64c7\u5340\u57df\u4ee5\u5275\u5efa\u6d41\u6c34\u7dda\u904b\u884c\u3002 \u76ee\u524d\u50c5\u652f\u6301 us-central1\u3002\n- \u9ede\u64ca **\u7e7c\u7e8c** \u3002\u6b64\u6642\u6703\u986f\u793a **\u904b\u884c\u6642\u914d\u7f6e** \u7a97\u683c\u3002\n- \u5728 **Cloud Storage \u4f4d\u7f6e** \u4e0b\uff0c\u9ede\u64ca **\u700f\u89bd** \u4ee5\u9078\u64c7\u7528\u65bc\u5b58\u5132\u6d41\u6c34\u7dda\u8f38\u51fa\u5de5\u4ef6\u7684 Cloud Storage \u5b58\u5132\u6876\uff0c\u7136\u5f8c\u9ede\u64ca **\u9078\u64c7** \u3002\n- \u5728 **\u6d41\u6c34\u7dda\u53c3\u6578** \u4e0b\uff0c\u6307\u5b9a\u7528\u65bc\u8abf\u512a\u6d41\u6c34\u7dda\u7684\u53c3\u6578\u3002\u5982\u9700\u77ad\u89e3\u9019\u4e9b\u53c3\u6578\u7684\u542b\u7fa9\uff0c\u8acb\u53c3\u95b1 REST \u6587\u6a94\u3002\n- \u9ede\u64ca **\u63d0\u4ea4** \u4ee5\u5275\u5efa\u6d41\u6c34\u7dda\u904b\u884c\u3002\n```\nPROJECT_ID=PROJECT_IDBASE_MODEL_VERSION_ID=BASE_MODEL_VERSION_IDTASK_TYPE=TASK_TYPEPIPELINE_SCRATCH_PATH=PIPELINE_SCRATCH_PATHQUERIES_PATH=QUERIES_PATHCORPUS_PATH=CORPUS_PATHTRAIN_LABEL_PATH=TRAIN_LABEL_PATHTEST_LABEL_PATH=TEST_LABEL_PATHBATCH_SIZE=BATCH_SIZEITERATIONS=ITERATIONScurl -X POST \u00a0\\\u00a0 -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\u00a0 -H \"Content-Type: application/json; charset=utf-8\" \\\"https://us-central1-aiplatform.googleapis.com/v1/projects/${PROJECT_ID}/locations/us-central1/pipelineJobs?pipelineJobId=tune-text-embedding-$(date +%Y%m%d%H%M%S)\" \\-d '{\u00a0 \"displayName\": \"tune-text-embedding-model\",\u00a0 \"runtimeConfig\": {\u00a0 \u00a0 \"gcsOutputDirectory\": \"'${PIPELINE_SCRATCH_PATH}'\",\u00a0 \u00a0 \"parameterValues\": {\u00a0 \u00a0 \u00a0 \"project\": \u00a0\"'${PROJECT_ID}'\",\u00a0 \u00a0 \u00a0 \"base_model_version_id\": \u00a0\"'${BASE_MODEL_VERSION_ID}'\",\u00a0 \u00a0 \u00a0 \"task_type\": \"'${TASK_TYPE}'\",\u00a0 \u00a0 \u00a0 \"location\": \"us-central1\",\u00a0 \u00a0 \u00a0 \"queries_path\": \u00a0\"'${QUERIES_PATH}'\",\u00a0 \u00a0 \u00a0 \"corpus_path\": \u00a0\"'${CORPUS_PATH}'\",\u00a0 \u00a0 \u00a0 \"train_label_path\": \u00a0\"'${TRAIN_LABEL_PATH}'\",\u00a0 \u00a0 \u00a0 \"test_label_path\": \u00a0\"'${TEST_LABEL_PATH}'\",\u00a0 \u00a0 \u00a0 \"batch_size\": \u00a0\"'${BATCH_SIZE}'\",\u00a0 \u00a0 \u00a0 \"iterations\": \u00a0\"'${ITERATIONS}'\"\u00a0 \u00a0 }\u00a0 },\u00a0 \"templateUri\": \"https://us-kfp.pkg.dev/ml-pipeline/llm-text-embedding/tune-text-embedding-model/v1.1.1\"}'\n```\n## \u5728 Model Registry \u4e2d\u67e5\u770b\u7d93\u904e\u8abf\u6574\u7684\u6a21\u578b\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u67e5\u770b\u7576\u524d\u9805\u76ee\u4e2d\u7684\u6a21\u578b\u5217\u8868\uff0c\u5305\u62ec\u5df2\u8abf\u6574\u7684\u6a21\u578b\u3002\n\u5982\u9700\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u67e5\u770b\u8abf\u6574\u5f8c\u6a21\u578b\uff0c\u8acb\u9032\u5165 **Vertex AI Model Registry** \u9801\u9762\u3002\n[\u9032\u5165 Vertex AI Model Registry](https://console.cloud.google.com/vertex-ai/models?hl=zh-cn)\n## \u90e8\u7f72\u6a21\u578b\n\u8abf\u6574\u4f5c\u696d\u5b8c\u6210\u5f8c\uff0c\u8abf\u6574\u5f8c\u7684\u6a21\u578b\u4e0d\u6703\u90e8\u7f72\u5230\u7aef\u9ede\u3002\u8abf\u6574\u5d4c\u5165\u6a21\u578b\u5f8c\uff0c\u60a8\u9700\u8981\u90e8\u7f72\u8a72\u6a21\u578b\u3002\u5982\u9700\u90e8\u7f72\u8abf\u6574\u5f8c\u7684\u5d4c\u5165\u6a21\u578b\uff0c\u8acb\u53c3\u95b1 [\u5c07\u6a21\u578b\u90e8\u7f72\u5230\u7aef\u9ede](https://cloud.google.com/vertex-ai/docs/general/deployment?hl=zh-cn) \u3002\n\u8207\u57fa\u790e\u6a21\u578b\u4e0d\u540c\uff0c\u8abf\u6574\u5f8c\u7684\u6587\u672c\u5d4c\u5165\u6a21\u578b\u7531\u7528\u6236\u7ba1\u7406\u3002\u9019\u5305\u62ec\u7ba1\u7406\u6a5f\u5668\u985e\u578b\u548c\u52a0\u901f\u5668\u7b49\u670d\u52d9\u8cc7\u6e90\u3002\u7232\u9632\u6b62\u5728\u9810\u6e2c\u671f\u9593\u51fa\u73fe\u5167\u5b58\u4e0d\u8db3\u932f\u8aa4\uff0c\u5efa\u8b70\u60a8\u4f7f\u7528 `NVIDIA_TESLA_A100` GPU \u985e\u578b\u9032\u884c\u90e8\u7f72\uff0c\u8a72\u985e\u578b\u53ef\u652f\u6301\u4efb\u4f55\u8f38\u5165\u9577\u5ea6\u5927\u5c0f\u4e0d\u8d85\u904e 5 \u7684\u6279\u91cf\u5927\u5c0f\u3002\n\u8207 `textembedding-gecko` \u57fa\u790e\u6a21\u578b\u985e\u4f3c\uff0c\u8abf\u6574\u5f8c\u7684\u6a21\u578b\u652f\u6301\u591a\u9054 3072 \u500b\u8a5e\u5143\uff0c\u4e26\u4e14\u53ef\u4ee5\u622a\u53d6\u66f4\u9577\u7684\u8f38\u5165\u3002\n## \u4f7f\u7528\u90e8\u7f72\u7684\u6a21\u578b\u7372\u53d6\u9810\u6e2c\u7d50\u679c\n### tuned textembedding-gecko@001 \u6a21\u578b\u7684 curl \u547d\u4ee4\u793a\u4f8b\n\u5982\u9700\u4f7f\u7528 `textembedding-gecko@001` \u7684\u8abf\u6574\u5f8c\u7248\u672c\u7372\u53d6\u9810\u6e2c\u7d50\u679c\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u793a\u4f8b curl \u547d\u4ee4\u3002\n```\nENDPOINT_URI=https://us-central1-aiplatform.googleapis.comPROJECT_ID=<your-project>LOCATION=us-central1MODEL_ENDPOINT=<created-vertex-endpoint-id>curl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\u00a0 \u00a0 -H \"Content-Type: application/json\" \u00a0\\\u00a0 \u00a0 ${ENDPOINT_URI}/v1/projects/${PROJECT_ID}/locations/${LOCATION}/endpoints/${MODEL_ENDPOINT}:predict \\\u00a0 \u00a0 -d '{\u00a0 \"instances\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"content\": \"Dining in New York City\"\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"content\": \"Best resorts on the east coast\"\u00a0 \u00a0 }\u00a0 ]}'\n```\n### \u975e textembedding-gecko@001 \u6a21\u578b\u7684 curl \u547d\u4ee4\u793a\u4f8b\n`textembedding-gecko@002` \u548c `textembedding-gecko-multilingual@001` \u7684\u8abf\u6574\u5f8c\u7248\u672c\u9084\u9700\u8981\u53e6\u5916\u5169\u500b\u8f38\u5165\uff1a `task_type` \u548c `title` \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u9019\u4e9b\u53c3\u6578\uff0c\u8acb\u53c3\u95b1 [curl \u547d\u4ee4](https://cloud.google.com/vertex-ai/generative-ai/docs/embeddings/get-text-embeddings?hl=zh-cn#api_changes_to_models_released_in_or_after_august_2023) \u3002\n**\u6ce8\u610f\uff1a** \u6bcf\u500b\u8acb\u6c42\u90fd\u9700\u8981 `task_type` \u548c `title` \u3002\u5982\u9700\u4f7f\u7528\u9ed8\u8a8d\u884c\u7232\uff0c\u8acb\u8a2d\u7f6e `task_type=\"DEFAULT\"` \u548c `title=\"\"` \u3002\n```\nENDPOINT_URI=https://us-central1-aiplatform.googleapis.comPROJECT_ID=<your-project>LOCATION=us-central1MODEL_ENDPOINT=<created-vertex-endpoint-id>curl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\u00a0 \u00a0 -H \"Content-Type: application/json\" \u00a0\\\u00a0 \u00a0 ${ENDPOINT_URI}/v1/projects/${PROJECT_ID}/locations/${LOCATION}/endpoints/${MODEL_ENDPOINT}:predict \\\u00a0 \u00a0 -d '{\u00a0 \"instances\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"content\": \"Dining in New York City\",\u00a0 \u00a0 \u00a0 \"task_type\": \"DEFAULT\",\u00a0 \u00a0 \u00a0 \"title\": \"\"\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"content\": \"There are many resorts to choose from on the East coast...\",\u00a0 \u00a0 \u00a0 \"task_type\": \"RETRIEVAL_DOCUMENT\",\u00a0 \u00a0 \u00a0 \"title\": \"East Coast Resorts\"\u00a0 \u00a0 }\u00a0 ]}'\n```\n### \u8f38\u51fa\u793a\u4f8b\n\u7121\u8ad6\u4ec0\u9ebc\u7248\u672c\uff0c\u6b64\u8f38\u51fa\u90fd\u9069\u7528\u65bc `textembedding-gecko` \u548c `textembedding-gecko-multilingual` \u6a21\u578b\u3002\n**\u6ce8\u610f\uff1a** \u767c\u9001\u5230\u5df2\u90e8\u7f72\u7684\u8abf\u6574\u5f8c\u7684 `textembedding-gecko` \u6a21\u578b\u7684\u9810\u6e2c\u8acb\u6c42\u7684\u8f38\u51fa\u8207\u6587\u672c\u5d4c\u5165 API \u8f38\u51fa\u4e0d\u540c\u3002\n```\n{\u00a0\"predictions\": [\u00a0 \u00a0[ ... ],\u00a0 \u00a0[ ... ],\u00a0 \u00a0...\u00a0],\u00a0\"deployedModelId\": \"...\",\u00a0\"model\": \"projects/.../locations/us-central1/models/...\",\u00a0\"modelDisplayName\": \"tuned-text-embedding-model\",\u00a0\"modelVersionId\": \"1\"}\n```\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3\u5982\u4f55 [\u8abf\u6574\u57fa\u790e\u6a21\u578b](https://cloud.google.com/vertex-ai/generative-ai/docs/models/tune-models?hl=zh-cn) \u3002\n- \u77ad\u89e3 [Responsible AI \u6700\u4f73\u5be6\u8e10\u548c Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI \u7684\u5b89\u5168\u904e\u6ffe\u689d\u4ef6](https://cloud.google.com/vertex-ai/generative-ai/docs/learn/responsible-ai?hl=zh-cn) \u3002", "guide": "Generative AI on Vertex AI"}