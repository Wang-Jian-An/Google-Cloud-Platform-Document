{"title": "Compute Engine - View and apply idle VM recommendations", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - View and apply idle VM recommendations\nThis page describes how you can use idle VM recommendations to identify and stop idle VM instances to reduce waste of resources and reduce your compute bill on your projects.\n- For more information on how Compute Engine generates idle VM recommendations, see [How detection of idle VM instances works](/compute/docs/instances/idle-vm-recommendations-overview#how_detection_of_idle_vm_instances_works) .\n- For more information on how to configure idle VM Recommender to receive more or fewer recommendations, see [Configure idle VM recommendations](/compute/docs/instances/configuring-idle-vm-recommendations) .", "content": "## Before you begin\n- Review the [limitations](/compute/docs/instances/idle-vm-recommendations-overview#limitations) to check if your VM supports idle VM recommendations.\n- If you haven't already, set up authentication. [Authentication](/compute/docs/authentication) is the process by which your identity is verified for access to Google Cloud services and APIs. To run code or samples from a local development environment, you can authenticate to Compute Engine as follows.Select the tab for how you plan to use the samples on this page:\nWhen you use the Google Cloud console to access Google Cloud services and   APIs, you don't need to set up authentication.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:```\ngcloud init\n``` **Note:** If you installed the gcloud CLI  previously, make sure you have the latest version by running`gcloud components  update`.\n- [ Set a default region and zone](/compute/docs/gcloud-compute#set_default_zone_and_region_in_your_local_client) .\nTo use the REST API samples on this page in a local development environment, you use the credentials you provide to the gcloud CLI.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:\n- ```\ngcloud init\n```## Pricing\nIdle VM recommendations are available free of charge. Using recommendations to reduce your resource usage can result in cost savings.\n## Viewing idle VM instance recommendations\nTo view recommendations about idle VMs, use the gcloud CLI or REST.\nUse the [gcloud recommender recommendations list command](/sdk/gcloud/reference/recommender/recommendations/list) with `--recommender=google.compute.instance.IdleResourceRecommender` :\n```\ngcloud recommender recommendations list \\\n --project=PROJECT_ID \\\n --location=ZONE \\\n --recommender=google.compute.instance.IdleResourceRecommender \\\n --format=yaml\n```\nReplace the following:- ``: the ID of your project\n- ``: the zone that contains instances to list recommendations for\nFor example:\n```\ngcloud recommender recommendations list \\\n --project=my-project \\\n --location=us-central1-c \\\n --recommender=google.compute.instance.IdleResourceRecommender \\\n --format=yaml\n```\nIf there are no idle VMs in the location, the response is empty. Otherwise, the response includes the following fields for each recommendation:- [operationGroups](#interpreting_the_recommendation_response) : groups of operations that you can perform in serial order to [apply the recommendation](#applying_idle_vm_recommendations) \n- `description`: a human-readable explanation of the recommendation\n```\n--content:\n...\noperationGroups:\n- operations:\n - action: test\n path: /status\n resource: //compute.googleapis.com/projects/my-project/zones/us-central1-c/instances/vm-name\n resourceType: compute.googleapis.com/Instance\n value: RUNNING\n - action: replace\n path: /status\n resource: //compute.googleapis.com/projects/my-project/zones/us-central1-c/instances/vm-name\n resourceType: compute.googleapis.com/Instance\n value: TERMINATED\ndescription: Save cost by stopping Idle VM 'vm-name'.\netag: '\"83da314c23f634e1\"'\nlastRefreshTime: '2020-02-24T07:56:40Z'\nname: projects/141732092341/locations/us-central1-c/recommenders/google.compute.instance.IdleResourceRecommender/recommendations/0e061a3a-f921-4216-b1b4-62e16942cd1a\nprimaryImpact:\ncategory: COST\ncostProjection:\n cost:\n currencyCode: USD\n nanos: -91533961\n units: '-262'\n duration: 2592000s\nrecommenderSubtype: STOP_VM\nstateInfo:\nstate: ACTIVE\n```\nLearn more about working with recommendations using gcloud in [gcloud examples](/sdk/gcloud/reference/recommender/recommendations) .\nCall the [recommendations.list method](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations/list) and use the following recommendation type:- **google.compute.instance.IdleResourceRecommender** \nThe API call looks like:\n```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/ZONE/recommenders/google.compute.instance.IdleResourceRecommender/recommendations\n```\nReplace the following:- ``: the ID of your project.\n- ``: the zone that contains instances to list recommendations for.\nThe following example shows out to send a request with `curl` , and the associated sample response.\n```\nPROJECT_ID=my-project\nZONE=us-central1-c\nRECOMMENDER_ID=google.compute.instance.IdleResourceRecommender\ncurl -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"x-goog-user-project: $PROJECT_ID\" \\\n https://recommender.googleapis.com/v1/projects/$PROJECT_ID/locations/$ZONE/recommenders/$RECOMMENDER_ID/recommendations\n```\nExample JSON response for an idle VM recommendation:\n```\n{\"description\" : \"Save cost by stopping Idle VM `vm-name`\",\"name\": \"projects/1574864402/locations/us-central1-c/recommenders/\"\u00a0 \u00a0 \u00a0 \u00a0 \"google.compute.instance.IdleResourceRecommender/\"\u00a0 \u00a0 \u00a0 \u00a0 \"recommendations/0fd31b24-cc05-4132-8431-ed54a22dd4f1\",\"lastRefreshTime\": {\u00a0 \"seconds\": 1543912652},\"primaryImpact\": {\u00a0 \"category\": COST,\u00a0 \"costProjection\": {\u00a0 \u00a0 \"cost\": {\"currencyCode\": \"USD\", \"units\": -50},\u00a0 \u00a0 \"duration\": { \"seconds\": 2592000 }\u00a0 }},\"stateInfo\": ACTIVE,\"content\":\u00a0 \"groups\" : [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"operations\" : [\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \"action\": \"test\",\u00a0 \u00a0 \u00a0 \u00a0 \"resourceType\": \"compute.googleapis.com/Instance\",\u00a0 \u00a0 \u00a0 \u00a0 \"resource\": \"//compute.googleapis.com/projects/my-project/\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"zones/us-central1-c/instances/vm-name\",\u00a0 \u00a0 \u00a0 \u00a0 \"path\": \"/status\",\u00a0 \u00a0 \u00a0 \u00a0 \"value\": \"RUNNING\"\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \"action\": \"replace\",\u00a0 \u00a0 \u00a0 \u00a0 \"resourceType\": \"compute.googleapis.com/Instance\",\u00a0 \u00a0 \u00a0 \u00a0 \"resource\": \"//compute.googleapis.com/projects/my-project/\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"zones/us-central1-c/instances/vm-name\",\u00a0 \u00a0 \u00a0 \u00a0 \"path\": \"/status\",\u00a0 \u00a0 \u00a0 \u00a0 \"value\": \"TERMINATED\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 }\u00a0 ]},\"etag\" : \"cb0e6ac2cfc0b591\"}\n```\nYou can find more details about each field in the [Recommender API documentation](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations) .\n### Interpreting the recommendation response\nEach recommendation that you receive through the gcloud CLI or REST contains an operations group, with operations that you can perform in serial to apply the recommendation. Idle VM recommendation operation groups include two operations:\n- A test operation to verify the current [status](/compute/docs/instances/instance-life-cycle) of the VM. For example:```\n\u00a0{\u00a0 \u00a0\"action\": \"test\",\u00a0 \u00a0\"resourceType\": \"compute.googleapis.com/Instance\",\u00a0 \u00a0\"resource\" : \"//compute.googleapis.com/projects/my-project/zones/us-central1-c/instances/vm-name\",\u00a0 \u00a0\"path\": \"/status\",\u00a0 \u00a0\"value\": \"RUNNING\"\u00a0}\n```\n- A replace operation to change the `status` of the VM. For example:```\n\u00a0{\u00a0 \u00a0\"action\": \"replace\",\u00a0 \u00a0\"resourceType\": \"compute.googleapis.com/Instance\",\u00a0 \u00a0\"resource\" : \"//compute.googleapis.com/projects/my-project/zones/us-central1-c/instances/vm-name\",\u00a0 \u00a0\"path\": \"/status\",\u00a0 \u00a0\"value\": \"TERMINATED\"\u00a0}\n```\nThe first operation is a `test` , which means that you should test that the `resource` is still `RUNNING` . You can do this by [checking the VM state](/compute/docs/reference/rest/v1/instances/get) .\nThe second operation, `replace` , means that you should replace the resource's `status` with a new value, `TERMINATED` . You can do that by stopping the VM, which is described below.\n## Applying idle VM recommendations\nAfter you receive an idle VM recommendation and you decide that you no longer need the instance, use the [Google Cloud console](https://console.cloud.google.com/) , the [gcloud CLI](/compute/docs/gcloud-compute) , or [REST](/compute/docs/reference/latest/instances) to stop and optionally delete the instance.\nIf you stop but do not delete an instance and its disks, you still pay for its disks.\n**Warning:** Deleting a VM can cause loss of data. Take precautions to protect any data that you need to keep before you delete a VM, for example, by [creating persistent disk snapshots](/compute/docs/disks/create-snapshots) .- In the Google Cloud console, go to the **VM instances** page. [Go to the VM instances page](https://console.cloud.google.com/compute/instances) \n- Select the instance that you want to stop.\n- Click **Stop** .\nUse the [instances stop](/sdk/gcloud/reference/compute/instances/stop) command and specify the `` that you want to stop.\n```\ngcloud compute instances stop VM_NAME --zone=ZONE\n```\nReplace the following:- ``: the name of the VM instance you want to stop\n- ``: the zone that contains the instance you want to stop\nConstruct a `POST` request to stop an instance.\n```\nPOST https://compute.googleapis.com/compute/v1/projects/PROJECT_ID/zones/ZONE/instances/VM_NAME/stop\n```\nReplace the following:- ``: the ID of your project\n- ``: the zone that contains the instance you want to stop\n- ``: the name of the VM instance you want to stop\nIf you're sure that the VM instance and its disks can be removed you can [delete the instance](/compute/docs/instances/deleting-instance) .\n## What's next\n- Learn more about how stopping, resetting, and deleting a VM instance [affects the instance and its resources](/compute/docs/instances/instance-life-cycle#comparison_table) .\n- Learn how to [configure idle VM recommendations](/compute/docs/instances/configuring-idle-vm-recommendations) .", "guide": "Compute Engine"}