{"title": "Cloud Deploy - Using Cloud Deploy notifications", "url": "https://cloud.google.com/deploy/docs/subscribe-deploy-notifications", "abstract": "# Cloud Deploy - Using Cloud Deploy notifications\nThis page describes how to use Cloud Deploy service notifications, including how to subscribe to them.\nCloud Deploy uses Pub/Sub to publish notifications for two purposes:\n- To let you integrate Cloud Deploy with third-party tools and other Google tools, such as tools for workflow ticketing or test infrastructure.\n- To extend Cloud Deploy with supplemental business logic.", "content": "## Available topics\nCloud Deploy publishes messages to the following set of [Google Pub/Sub](/pubsub) topics:\n- `clouddeploy-resources`When there is an operation (create, update, delete) against any Cloud Deploy core resource (automation, custom target type, delivery pipeline, job run, release, rollout, target).\n- `clouddeploy-operations`- When Cloud Deploy renders the Skaffold configuration.\n- When Cloud Deploy deploys to a target (`Start`,`Succeed`,`Failure`,`Terminated`(job run),`Cancelled`(rollout)).\n- `clouddeploy-approvals`- When Cloud Deploy needs an approval (or rejection) of a rollout.\n- When a rollout has been approved or rejected.\n- `clouddeploy-advances`- When a Cloud Deploy rollout has been advanced from one phase to the next.\n- When a rollout is ready to be advanced.You can use a [push or pull model](/pubsub/docs/subscriber#push_pull) for your Pub/Sub subscriptions.\n## Receive Cloud Deploy service notifications\nTo receive Cloud Deploy service notifications:\n- Enable the Cloud Deploy API: [Enable the Cloud Deploy API](https://console.cloud.google.com/apis/library/clouddeploy.googleapis.com) The **Cloud Deploy Service Agent** service account is automatically added to your project when you first call the Cloud Deploy API. This service account enables you to receive Cloud Deploy service notifications using Pub/Sub.The service account name has the following format, where is your project number:```\n\u00a0service-project-number@gcp-sa-clouddeploy.iam.gserviceaccount.com\n``` **Note:** if you don't see the service account listed, activate the **IncludeGoogle-provided role grants** checkbox, at the top of the list.If you still don't see the **Cloud Deploy Service Agent** service account on your IAM page, or you can't receive Pub/Sub notifications, add this service account to your project:- Open the **IAM** page in the Google Cloud console: [Open the IAM page](https://console.cloud.google.com/iam-admin/iam) \n- Click **Add** .\n- Add the following principal, where is your project number:```\nservice-project-number@gcp-sa-clouddeploy.iam.gserviceaccount.com\n```\n- Select **Service Management** > **Cloud Deploy Service Agent** as your role.\n- Click **Save** .\n- Enable the Pub/Sub API: [Enable the Pub/Sub API](https://console.cloud.google.com/apis/library/pubsub.googleapis.com) \n- Create the Pub/Sub topic or topics, based on which notification types you want to receive:```\ngcloud pubsub topics create clouddeploy-resourcesgcloud pubsub topics create clouddeploy-operationsgcloud pubsub topics create clouddeploy-approvalsgcloud pubsub topics create clouddeploy-advances\n```To learn more about managing Pub/Sub topics, see [Managing topics and subscriptions](/../pubsub/docs/admin) .\n**Note:** Pub/Sub notifications generated by Cloud Deploy are subject to the [Pub/Sub Service Level Agreement (SLA)](/../pubsub/sla) .\n## Subscribe to Cloud Deploy service notifications\nYou have several of options for subscribing to notifications. For example, you can [push messages to an endpoint](/pubsub/docs/push#configuring-http-endpoints) , or [write a Python app for polling your subscription](/pubsub/docs/pull#pubsub-pull-python) .\nTo learn how to set up Pub/Sub subscriptions for Cloud Deploy service notifications, read the [Pub/Sub Subscriber Guide](/pubsub/docs/subscriber) . You can also learn about [Pub/Sub Client Libraries](/pubsub/docs/reference/libraries) , which make developing subscriber applications easier.\n## Field values\nThis section lists possible values for fields in the Cloud Deploy Pub/Sub messages.\n### For Action\nIn these notifications, the possible values for `Action` are as follows.\n- For resources- `Create`\n- `Update`\n- `Delete`\n- For operations:- `Start`\n- `Succeed`\n- `Failure`\n- `Terminated`\n- `Cancelled`\n- For approvals:- `Required`\n- `Approved`\n- `Rejected`\n- For advances:- `Required`\n- `Advanced`\n### For ResourceType\nAnd the possible values for `ResourceType` are as follows:\n- `DeliveryPipeline`\n- `Target`\n- `Release`\n- `Rollout`\n- `JobRun`## Sample messages\nThe following examples show several types of Pub/Sub messages from Cloud Deploy topics.\n### Delivery pipeline create\nThe following is an example of a Pub/Sub message published to `clouddeploy-resources` in response to creation of a new `deliveryPipeline` :\n```\n{\u00a0 \"ackId\": \u00a0 \"RFAGFixdRkhRNxkIaFEOT14jPzUgKEUQBQgUBXx9cEFMdVhddmhRDRlyfWByY11AAgVMVnldURsHaE5tdR_Wg6LHS0NVaF4TBgpGVX5fXx0IYVtedi_m7r_2wPXOXkAvOYXL6Mtpe735h9xvZiM9XxJLLD5-IzRFQV5AEkwoAURJUytDCypYEU4EISE-MD5FUw\",\u00a0 \"message\": {\u00a0 \u00a0 \"attributes\": {\u00a0 \u00a0 \u00a0 \"Action\": \"Create\",\u00a0 \u00a0 \u00a0 \"Resource\": \"projects/120123456789/locations/us-central1/deliveryPipelines/etest\",\u00a0 \u00a0 \u00a0 \"ResourceType\": \"DeliveryPipeline\",\u00a0 \u00a0 \u00a0 \"Location\": \"us-central1\",\u00a0 \u00a0 \u00a0 \"DeliveryPipelineId\": \"etest\",\u00a0 \u00a0 \u00a0 \"ProjectNumber\": \"120123456789\",\u00a0 \u00a0 },\u00a0 \u00a0 \"messageId\": \"2407836004659723\",\u00a0 \u00a0 \"publishTime\": \"2021-05-17T21:24:48.204Z\"\u00a0 }}\n```\n### Render start\nThe following is an example of a Pub/Sub message published to `clouddeploy-operations` to notify that a release has been rendered:\n```\n{\u00a0 \"ackId\": \"U0RQBhYsXUZIUTcZCGhRDk9eIz81IChFFwYIFAV8fXBBTHVeXHRoUQ0Zcn1gcmNfR1MLFlN5WFEaB2hObXUfioKix0tDVWheEwYKRVZ3W1kdBGFVXH0v_qD5rMP1zl5AKDnZyujLaXudkqxfZiM9XxJLLD5-PTNFQV5AEkw2BkRJUytDCypYEU4EISE-MD5F\",\u00a0 \"message\": {\u00a0 \u00a0 \"attributes\": {\u00a0 \u00a0 \u00a0 \"Action\": \"Start\",\u00a0 \u00a0 \u00a0 \"Resource\": \"projects/120123456789/locations/us-central1/deliveryPipelines/etest/releases/f2\",\u00a0 \u00a0 \u00a0 \"ResourceType\": \"Release\"\u00a0 \u00a0 \u00a0 \"Location\": \"us-central1\",\u00a0 \u00a0 \u00a0 \"DeliveryPipelineId\": \"etest\",\u00a0 \u00a0 \u00a0 \"ProjectNumber\": \"120123456789\",\u00a0 \u00a0 \u00a0 \"ReleaseId\": \"f2\",\u00a0 \u00a0 },\u00a0 \u00a0 \"messageId\": \"2407805942699908\",\u00a0 \u00a0 \"publishTime\": \"2021-05-17T21:28:04.201Z\"\u00a0 }}\n```\n### Approval required\nThe following is an example of a Pub/Sub message published to `clouddeploy-approvals` to notify that a rollout requires approval:\n```\n{\u00a0 \u00a0\"ackId\": \"RVNEUAYWLF1GSFE3GQhoUQ5PXiM_NSAoRRILUxNRXHQBWhBpWF8aB1ENGXJ8ZnxtCRBVU0FWf1VbEQ16bVxti6C2rERfQXduWhQJBkBXd11aHQhoXF9dotnkpeTv2kFwYSuN8_7mSH_Mo6AYZiA9XBJLLD5-IzZFQV5AEkwoA0RJUytDCypYEU4EISE-MD4\",\u00a0 \u00a0\"message\": {\u00a0 \u00a0 \u00a0\"attributes\": {\u00a0 \u00a0 \u00a0 \u00a0\"Action\": \"Required\",\u00a0 \u00a0 \u00a0 \u00a0\"Rollout\": \"projects/120123456789/locations/us-central1/deliveryPipelines/etest/releases/f2/rollouts/rollout-123\"\u00a0 \u00a0 \u00a0 \u00a0\"ReleaseId\": \"f2\",\u00a0 \u00a0 \u00a0 \u00a0\"RolloutId\": \"rollout-123\",\u00a0 \u00a0 \u00a0 \u00a0\"TargetId\": \"prod\",\u00a0 \u00a0 \u00a0 \u00a0\"Location\": \"us-central1\",\u00a0 \u00a0 \u00a0 \u00a0\"ProjectNumber\": \"120123456789\",\u00a0 \u00a0 \u00a0},\u00a0 \u00a0 \u00a0\"messageId\": \"2407845492165003\",\u00a0 \u00a0 \u00a0\"publishTime\": \"2021-05-17T21:31:25.143Z\"\u00a0 \u00a0}\u00a0}\n```\n### Rollout advance\nThe following is an example of a Pub/Sub message published to `clouddeploy-advances` to notify that a rollout has been advanced from one phase to the next:\n```\n{\u00a0 \"ackId\": \"RFAGFixdRkhRNxkIaFEOT14jPzUgKEUSAwVPAihdeTFXKkFZdWhRDRlyfWB9bV4UUFZMV38OURoHaE5tdR_z4ILjS0NVbVkQBApEUHldXhkEa1RcfC-a0fmv1OzMV0AvOaCoyO9pe77r3NluZiM9XhJLLD5-Jz1FQV5AEkwsCERJUytDCypYEU4EISE-MD5FUw\",\u00a0 \"message\": {\u00a0 \u00a0 \"attributes\": {\u00a0 \u00a0 \u00a0 \"Action\": \"Advanced\",\u00a0 \u00a0 \u00a0 \"Location\": \"us-central1\",\u00a0 \u00a0 \u00a0 \"PhaseId\": \"stable\",\u00a0 \u00a0 \u00a0 \"ProjectNumber\": \"120123456789\",\u00a0 \u00a0 \u00a0 \"ReleaseId\": \"rollout-123\",\u00a0 \u00a0 \u00a0 \"Rollout\": \"projects/120123456789/locations/us-central1/deliveryPipelines/etest/releases/f2/rollouts/rollout-123\",\u00a0 \u00a0 \u00a0 \"RolloutId\": \"rollout-123\",\u00a0 \u00a0 \u00a0 \"TargetId\": \"prod\"\u00a0 \u00a0 },\u00a0 \u00a0 \"messageId\": \"7335813725293809\",\u00a0 \u00a0 \"publishTime\": \"2023-04-03T15:16:30.425Z\"\u00a0 }}\n```\nIn this message, `PhaseId` identifies the phase that the rollout has been advanced to.\n## What's next\n- [Learn more about Pub/Sub](/pubsub/docs) .", "guide": "Cloud Deploy"}