{"title": "Cloud Deploy - \u4f7f\u7528\u81ea\u52d5\u5316\u898f\u5247", "url": "https://cloud.google.com/deploy/docs/automation-rules?hl=zh-cn", "abstract": "# Cloud Deploy - \u4f7f\u7528\u81ea\u52d5\u5316\u898f\u5247\n\u672c\u6587\u6a94\u4ecb\u7d39\u4e86\u81ea\u52d5\u5316\u898f\u5247\uff0c\u5373\u7cfb\u7d71\u53ef\u4ee5\u81ea\u52d5\u5c0d\u4ea4\u4ed8\u6d41\u6c34\u7dda\u57f7\u884c\u7684\u64cd\u4f5c\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u4ea4\u4ed8\u6d41\u6c34\u7dda\uff0c\u4ee5\u4fbf\u5728\u9069\u7576\u7684\u60c5\u6cc1\u4e0b\u81ea\u52d5\u63d0\u5347\u5230\u7279\u5b9a\u76ee\u6a19\u3002\n\u60a8\u53ea\u80fd\u4f7f\u7528 Cloud Deploy \u5167\u7f6e\u7684\u81ea\u52d5\u5316\u898f\u5247\u3002 \u672c\u6587\u6a94\u4e2d\u5217\u51fa\u4e86\u53ef\u7528\u7684\u81ea\u52d5\u5316\u898f\u5247\u3002\n", "content": "## \u53ef\u7528\u7684\u81ea\u52d5\u5316\u898f\u5247\nCloud Deploy \u63d0\u4f9b\u4ee5\u4e0b\u81ea\u52d5\u5316\u898f\u5247\uff1a\n| \u898f\u5247   | \u8aaa\u660e               |\n|:---------------|:----------------------------------------------------------------|\n| promoteRelease | \u6210\u529f\u5f8c\u81ea\u52d5\u5c07\u67d0\u500b\u7248\u672c\u63d0\u5347\u5230\u6307\u5b9a\u7684\u76ee\u6a19 \u9084\u80fd\u5728\u4e0a\u4e00\u500b\u76ee\u6a19\u4e2d\u9010\u6b65\u63a8\u51fa |\n| advanceRollout | \u5f9e\u6307\u5b9a\u7684\u968e\u6bb5\u9032\u5165\u4e0b\u4e00\u968e\u6bb5\u3002          |\n## \u914d\u7f6e\u81ea\u52d5\u5316\u898f\u5247\n\u6bcf\u689d\u81ea\u52d5\u5316\u898f\u5247\u7684\u914d\u7f6e\u53d6\u6c7a\u65bc\u5177\u9ad4\u898f\u5247\u3002\u672c\u90e8\u5206\u4ecb\u7d39\u4e86\u6240\u6709\u898f\u5247\u5171\u6709\u7684\u914d\u7f6e\uff0c\u4ee5\u53ca\u5982\u4f55\u914d\u7f6e\u6bcf\u500b\u53ef\u7528\u898f\u5247\u3002\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u7279\u5b9a\u65bc\u5404\u81ea\u52d5\u5316\u898f\u5247\u7684\u914d\u7f6e\u3002\u5982\u9700\u77ad\u89e3\u81ea\u52d5\u5316\u672c\u8eab\u7684\u914d\u7f6e\uff0c\u8acb\u53c3\u95b1 [\u81ea\u52d5\u5316\u90e8\u7f72](https://cloud.google.com/deploy/docs/automation?hl=zh-cn#create_automation) \u3002\n### \u914d\u7f6e promoteRelease \u81ea\u52d5\u5316\u898f\u5247\n`promoteRelease` \u898f\u5247\u6703\u5728\u6210\u529f\u767c\u4f48\u5230\u76ee\u6a19\u5f8c\u63d0\u5347\u60a8\u7684\u7248\u672c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u6709\u4e09\u500b\u76ee\u6a19\uff0c\u5247\u53ef\u4ee5\u8a2d\u7f6e\u6b64\u898f\u5247\uff0c\u4ee5\u4fbf\u5728\u7248\u672c\u6210\u529f\u90e8\u7f72\u5230\u7b2c\u4e00\u500b\u76ee\u6a19\u5f8c\uff0c\u81ea\u52d5\u5c07\u5176\u63d0\u5347\u5230\u7b2c\u4e8c\u500b\u76ee\u6a19\u3002\n\u914d\u7f6e `promoteRelease` \u81ea\u52d5\u5316\u64cd\u4f5c\u6642\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u8981\u63d0\u5347\u5230 ( `destinationTargetId` ) \u6216 `@next` \u7684\u76ee\u6a19\u3002\u5728 `Automation` \u5b9a\u7fa9\u4e2d\u6307\u5b9a\u7684\u76ee\u6a19\u4e2d\u6210\u529f\u5b8c\u6210\u767c\u4f48\u5f8c\uff0c\u767c\u4f48\u5373\u6703\u63d0\u5347\u5230 `destinationTargetId` \u4e2d\u6307\u5b9a\u7684\u76ee\u6a19\uff0c\u9593\u9694\u6642\u9577\u7232 `wait` \u3002\n\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 `destinationPhase` \u5c6c\u6027\uff0c\u5728\u9810\u671f\u76ee\u6a19\u4e2d\u5c07\u7248\u672c\u63d0\u5347\u5230\u7279\u5b9a\u968e\u6bb5\u3002\n```\nrules:- promoteRelease:\u00a0 \u00a0 name: \"[RULE_NAME]\"\u00a0 \u00a0 wait: [WAIT_TIME]\u00a0 \u00a0 destinationTargetId: \"[TO_TARGET]\"\u00a0 \u00a0 destinationPhase: \"[TO_PHASE]\"\n```\n\u5176\u4e2d\uff1a\n- `[RULE_NAME]`\u662f\u60a8\u8981\u7232\u6b64\u898f\u5247\u6307\u5b9a\u7684\u4efb\u4f55\u540d\u7a31\u3002\u6b64\u540d\u7a31\u5728\u81ea\u52d5\u5316\u8cc7\u6e90\u4e2d\u5fc5\u9808\u662f\u552f\u4e00\u7684\u3002\n- `[WAIT_TIME]`\u662f\u7248\u672c\u6e96\u5099\u597d\u63d0\u5347\u5f8c\u5728\u5347\u7d1a\u4e4b\u524d\u7b49\u5f85\u7684\u6642\u9593\uff08\u5206\u9418\uff09\u3002\u4f8b\u5982 `1m` \u3002 `m` \u662f\u5fc5\u9808\u7684\u3002\u9ed8\u8a8d\u503c\u7232 `0` \uff0c\u8868\u793a\u6c92\u6709\u7b49\u5f85\u6642\u9593\u3002\u6700\u9577\u7232 `20160m` \uff08\u6216 14 \u5929\uff09\u3002\n- `[TO_TARGET]`\u662f\u8981\u63d0\u5347\u5230\u7684\u76ee\u6a19\u7684 [targetId](https://cloud.google.com/deploy/docs/config-files?hl=zh-cn#targetid) \u3002\u6b64\u5c6c\u6027\u4e5f\u53ef\u4ee5\u662f `@next` \uff0c\u5b83\u6703\u81ea\u52d5\u5c07\u7248\u672c\u63d0\u5347\u5230\u6b64 [\u81ea\u52d5\u5316\u914d\u7f6e](https://cloud.google.com/deploy/docs/config-files?hl=zh-cn#automation_definitions) \u7684 `selector.target` \u5c6c\u6027\u4e2d\u6307\u5b9a\u7684\u76ee\u6a19\u4e4b\u5f8c\u7684\u4e0b\u4e00\u500b\u76ee\u6a19\u3002\u5982\u679c\u60a8\u7701\u7565 `destinationTargetId` \u7684\u503c\uff0c\u9019\u5c31\u662f\u9ed8\u8a8d\u503c\u3002\n- `[TO_PHASE]`\u662f\u8981\u63d0\u5347\u5230\u7684\u968e\u6bb5\u7684\u968e\u6bb5\u540d\u7a31\uff0c\u4f8b\u5982 `canary-25` \u6216 `stable` \u3002\u6b64\u5c6c\u6027\u662f\u53ef\u9078\u7684\uff1b\u5982\u679c\u7701\u7565\u5b83\uff0c\u5247\u7248\u672c\u6703\u63d0\u5347\u5230\u76ee\u6a19\u4e2d\u7684\u7b2c\u4e00\u968e\u6bb5\u3002\n### \u914d\u7f6e advanceRollout \u81ea\u52d5\u5316\u898f\u5247\n\u5728\u6210\u529f\u5b8c\u6210\u4e00\u500b\u968e\u6bb5\u5f8c\uff0c `advanceRollout` \u898f\u5247\u6703\u81ea\u52d5\u5c07\u767c\u4f48\u63a8\u9032\u5230\u4e0b\u4e00\u968e\u6bb5\u3002\u6b64\u81ea\u52d5\u5316\u898f\u5247\u5c0d\u65bc Canary \u90e8\u7f72\u975e\u5e38\u6709\u7528\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5728\u76ee\u6a19\u4e0a\u914d\u7f6e\u4e86 Canary \u90e8\u7f72\u7b56\u7565\uff0c\u5176\u968e\u6bb5\u7232 `25%` \u3001 `50%` \u548c `stable` \uff0c\u5247\u53ef\u4ee5\u914d\u7f6e\u4e00\u689d\u81ea\u52d5\u5316\u898f\u5247\uff0c\u5728 `50%` \u968e\u6bb5\u7d50\u675f\u5f8c\u81ea\u52d5\u5c07\u968e\u6bb5\u63a8\u9032\u5230 `stable` \u3002\n\u914d\u7f6e `advanceRollout` \u81ea\u52d5\u5316\u64cd\u4f5c\u6642\uff0c\u60a8\u9700\u8981\u78ba\u5b9a\u8981\u5f9e `sourcePhase` \u63a8\u9032\u7684\u968e\u6bb5\u3002\n```\nrules:- advanceRollout:\u00a0 \u00a0 name: \"[RULE]\"\u00a0 \u00a0 sourcePhases: [\"[START_PHASE]\", \"[START_PHASE]\"...]\u00a0 \u00a0 wait: [WAIT_TIME]\n```\n\u5176\u4e2d\uff1a\n- `[RULE]`\u662f\u60a8\u8981\u7232\u6b64\u898f\u5247\u6307\u5b9a\u7684\u4efb\u4f55\u540d\u7a31\u3002\u6b64\u540d\u7a31\u5728\u4ea4\u4ed8\u6d41\u6c34\u7dda\u4e2d\u5fc5\u9808\u662f\u552f\u4e00\u7684\u3002\n- `[WAIT_TIME]`\u662f\u767c\u4f48\u6e96\u5099\u5c31\u7dd2\u5f8c\u7b49\u5f85\u767c\u5e03\u7684\u6642\u9577\uff08\u4ee5\u5206\u9418\u7232\u55ae\u4f4d\uff09\u3002\u4f8b\u5982 `1m` \u3002 `m` \u662f\u5fc5\u9808\u7684\u3002\u9ed8\u8a8d\u503c\u7232 `0` \uff0c\u8868\u793a\u6c92\u6709\u7b49\u5f85\u6642\u9593\u3002\u6700\u9577\u7232 `20160m` \uff08\u6216 14 \u5929\uff09\u3002\n- `[\"[START_PHASE]\", \"[START_PHASE]\"...]`\u662f\u81ea\u52d5\u63a8\u9032\u767c\u5e03\u6d41\u7a0b\u7684\u4e00\u500b\u6216\u591a\u500b\u968e\u6bb5\u3002 \u4e5f\u5c31\u662f\u8aaa\uff0c\u7576\u5217\u51fa\u7684\u4efb\u4f55\u968e\u6bb5\u6210\u529f\u5b8c\u6210\u6642\uff0c\u767c\u4f48\u6703\u81ea\u52d5\u5f9e\u8a72\u968e\u6bb5\u63a8\u9032\u5230\u4e0b\u4e00\u968e\u6bb5\u3002\u968e\u6bb5\u540d\u7a31\u5340\u5206\u5927\u5c0f\u5beb\u3002\u6b64\u5916\uff0c\u9019\u4e9b\u968e\u6bb5\u540d\u7a31\u662f\u53ef\u9078\u7684\uff1b\u5982\u679c\u60a8\u7701\u7565 `sourcePhases` \uff0c\u5247\u767c\u4f48\u4e2d\u7684\u6240\u6709\u968e\u6bb5\u90fd\u6703\u81ea\u52d5\u63a8\u9032\u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u8acb\u53c3\u95b1 [\u5feb\u901f\u5165\u9580\uff1a\u81ea\u52d5\u5275\u5efa\u548c\u767c\u4f48\u7248\u672c](https://cloud.google.com/deploy/docs/deploy-app-automation?hl=zh-cn) \u3002\n- [\u8a73\u7d30\u77ad\u89e3](https://cloud.google.com/deploy/docs/automation?hl=zh-cn) Cloud Deploy \u4e2d\u7684\u90e8\u7f72\u81ea\u52d5\u5316\u3002", "guide": "Cloud Deploy"}