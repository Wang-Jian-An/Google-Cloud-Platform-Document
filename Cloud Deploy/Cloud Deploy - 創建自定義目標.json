{"title": "Cloud Deploy - \u5275\u5efa\u81ea\u5b9a\u7fa9\u76ee\u6a19", "url": "https://cloud.google.com/deploy/docs/create-custom-target?hl=zh-cn", "abstract": "# Cloud Deploy - \u5275\u5efa\u81ea\u5b9a\u7fa9\u76ee\u6a19\n\u672c\u6587\u6a94\u4ecb\u7d39\u5982\u4f55\u5275\u5efa\u81ea\u5b9a\u7fa9 Cloud Deploy \u76ee\u6a19\u985e\u578b\uff0c\u4e26\u5c07\u8a72\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u7528\u4f5c Cloud Deploy [\u4ea4\u4ed8\u6d41\u6c34\u7dda](https://cloud.google.com/deploy/docs/terminology?hl=zh-cn#delivery_pipeline) \u4e2d\u7684 [\u76ee\u6a19](https://cloud.google.com/deploy/docs/terminology?hl=zh-cn#target) \u3002\n\u4ee5\u4e0b\u662f\u5275\u5efa\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u4e26\u5728\u4ea4\u4ed8\u6d41\u6c34\u7dda\u4e2d\u4f7f\u7528\u76ee\u6a19\u985e\u578b\u7684\u6982\u8981\u6d41\u7a0b\uff1a\n- [\u5275\u5efa\u4e00\u500b\u5bb9\u5668\u5316\u61c9\u7528](#create_containerized_application) \u6216\u591a\u500b\u61c9\u7528\uff0c\u8a72\u61c9\u7528\u5305\u542b\u90e8\u7f72\u5230\u81ea\u5b9a\u7fa9\u76ee\u6a19\u7684\u529f\u80fd\uff0c\u4e26\u6eff\u8db3\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u7684 Cloud Deploy [\u8981\u6c42](https://cloud.google.com/deploy/docs/custom-targets?hl=zh-cn#required_inputs_and_outputs) \u3002\n- \u5728 `skaffold.yaml` \u4e2d [\u5b9a\u7fa9\u4e00\u9805\u81ea\u5b9a\u7fa9\u64cd\u4f5c](#skaffold_define_action) \uff0c\u7528\u65bc\u5f15\u7528\u8a72\u5bb9\u5668\u4e26\u6307\u5b9a\u8981\u5728\u8a72\u5bb9\u5668\u4e0a\u904b\u884c\u7684\u4e00\u500b\u6216\u591a\u500b\u547d\u4ee4\u3002\n- [\u5275\u5efa\u5f15\u7528\u4e0a\u4e00\u6b65\u4e2d\u7684\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u7684 CustomTargetType \u5b9a\u7fa9](#define_custom_target_type) \uff0c\u4e26\u5c07\u5176\u8a3b\u518a\u7232 Cloud Deploy \u8cc7\u6e90\u3002\n- \u4f7f\u7528 `customTarget` \u5c6c\u6027 [\u5b9a\u7fa9\u4e00\u500b\u65b0\u76ee\u6a19](#define_target) \uff0c\u8a72\u5c6c\u6027\u7528\u65bc\u6a19\u8b58\u65b0\u7684\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u3002\n- \u5f9e\u4ea4\u4ed8\u6d41\u6c34\u7dda [\u9032\u5ea6](https://cloud.google.com/deploy/docs/terminology?hl=zh-cn#progression) \u4e2d [\u5f15\u7528\u8a72\u76ee\u6a19](#add_target_to_pipeline) \u3002\n- [\u5275\u5efa\u7248\u672c](#create_release) \u3002\n\u672c\u6587\u6a94\u5176\u9918\u90e8\u5206\u5c07\u8a73\u7d30\u4ecb\u7d39\u4e0a\u8ff0\u5404\u500b\u6b65\u9a5f\u3002\n", "content": "## \u5275\u5efa\u5bb9\u5668\u5316\u61c9\u7528\n\u90e8\u7f72\u5230\u81ea\u5b9a\u7fa9\u76ee\u6a19\u7684\u529f\u80fd\u662f\u5728\u5bb9\u5668\u5316\u61c9\u7528\u4e2d\u5b9a\u7fa9\u7684\uff0c\u60a8\u53ef\u4ee5\u901a\u904e [\u5f9e skaffold.yaml \u6587\u4ef6\u4e2d\u5f15\u7528\u9019\u4e9b\u61c9\u7528](#skaffold_define_action) \u5c07\u5176\u63d0\u4f9b\u7d66 Cloud Deploy\u3002\u7576\u60a8\u7684\u4ea4\u4ed8\u6d41\u6c34\u7dda\u5305\u542b\u4f7f\u7528\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u7684\u76ee\u6a19\u6642\uff0cCloud Deploy \u6703\u5728 Skaffold \u4e2d\u8abf\u7528\u7232\u8a72\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u5b9a\u7fa9\u7684\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u5bb9\u5668\uff0c\u4ee5\u57f7\u884c\u60a8\u5b9a\u7fa9\u7684\u6e32\u67d3\u548c\u90e8\u7f72\u64cd\u4f5c\u3002\n\u61c9\u7528\u7684\u884c\u7232\u7531\u60a8\u78ba\u5b9a\u3002\u4f46\u662f\uff0c\u5b83\u5fc5\u9808\u4f7f\u7528 Cloud Deploy \u63d0\u4f9b\u7684\u8f38\u5165\u74b0\u5883\u8b8a\u91cf\uff0c\u4e26\u4e14\u5fc5\u9808\u8fd4\u56de [\u6240\u9700\u7684\u8f38\u51fa](https://cloud.google.com/deploy/docs/custom-targets?hl=zh-cn#required_inputs_and_outputs) \u3002\n\u5728\u5927\u591a\u6578\u60c5\u6cc1\u4e0b\uff0c\u60a8\u9700\u8981\u7232\u5275\u5efa\u7684\u6bcf\u500b\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u5275\u5efa\u4e00\u500b\u5bb9\u5668\uff0c\u4f75\u7232\u90e8\u7f72\u64cd\u4f5c\u5275\u5efa\u4e00\u500b\u5bb9\u5668\u3002\u6e32\u67d3\u64cd\u4f5c\u662f\u53ef\u9078\u7684\uff0c\u4f46\u5982\u679c\u60a8\u672a\u63d0\u4f9b\u6e32\u67d3\u64cd\u4f5c\uff0cCloud Deploy \u6703\u4f7f\u7528\u9ed8\u8a8d\u7684 `skaffold render` \u3002\n## \u5728 Skaffold \u4e2d\u5b9a\u7fa9\u81ea\u5b9a\u7fa9\u64cd\u4f5c\n\u6e96\u5099\u597d\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u5bb9\u5668\u6620\u50cf\u5f8c\uff0c\u60a8\u53ef\u4ee5\u5f9e [skaffold.yaml \u914d\u7f6e\u6587\u4ef6](https://cloud.google.com/deploy/docs/using-skaffold?hl=zh-cn) \u4e2d\u5f15\u7528\u9019\u4e9b\u6620\u50cf\u3002\n\u60a8\u53ef\u4ee5\u5728 `customActions` \u7bc0\u4e2d\u7232\u81ea\u5b9a\u7fa9\u76ee\u6a19\u914d\u7f6e\u6bcf\u500b\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u3002\u5c0d\u65bc\u4efb\u4f55\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\uff0c\u60a8\u53ef\u4ee5\u5728 Skaffold \u4e2d\u5275\u5efa\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u4ee5\u9032\u884c\u6e32\u67d3\uff0c\u4e26\u5275\u5efa\u4e00\u9805\u7528\u65bc\u90e8\u7f72\u7684\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u3002 [CustomTargetType](#define_custom_target_type) \u5b9a\u7fa9\u53ef\u8b58\u5225\u54ea\u4e9b\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u7528\u65bc\u6e32\u67d3\uff0c\u54ea\u4e9b\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u7528\u65bc\u90e8\u7f72\u3002\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u7684\u81ea\u5b9a\u7fa9\u76ee\u6a19\u53ef\u4ee5\u4f7f\u7528\u9ed8\u8a8d\u6e32\u67d3\u7a0b\u5e8f ( `skaffold render` ) \u751f\u6210\u7684\u6e05\u55ae\uff0c\u5247\u4e0d\u9700\u8981\u81ea\u5b9a\u7fa9\u6e32\u67d3\u7a0b\u5e8f\u3002\u5e7e\u4e4e\u5728\u6240\u6709\u60c5\u6cc1\u4e0b\uff0c\u60a8\u90fd\u9700\u8981\u81ea\u5b9a\u7fa9\u6e32\u67d3\u64cd\u4f5c\u3002\n\u4ee5\u4e0b\u662f `skaffold.yaml` \u4e2d\u81ea\u5b9a\u7fa9\u6e32\u67d3\u548c\u90e8\u7f72\u64cd\u4f5c\u7684\u914d\u7f6e\uff1a\n```\napiVersion: skaffold/v4beta7kind: ConfigcustomActions:# custom render action- name:\u00a0 containers:\u00a0 - name:\u00a0 \u00a0 image:\u00a0 \u00a0 command:\u00a0 \u00a0 args:# custom deploy action- name:\u00a0 containers:\u00a0 - name:\u00a0 \u00a0 image:\u00a0 \u00a0 command:\u00a0 \u00a0 args:\n```\n\u5728\u6b64 Skaffold \u914d\u7f6e\u4e2d\uff1a\n- `customActions.name`\u662f\u81ea\u5b9a\u7fa9\u6e32\u67d3\u6216\u90e8\u7f72\u64cd\u4f5c\u7684\u4efb\u610f\u540d\u7a31\u3002 `CustomTargetType` \u5b9a\u7fa9\u6703\u5728 `renderAction` \u5c6c\u6027\u6216 `deployAction` \u5c6c\u6027\u4e2d\u5f15\u7528\u6b64\u540d\u7a31\u3002\n- `containers` \u7bc0\u5305\u542b\u60a8\u7684\u5f15\u7528\uff0c\u4ee5\u53ca\u7528\u65bc\u904b\u884c\u8a72\u5bb9\u5668\u7684\u547d\u4ee4\u3002`containers` \u7bc0\u5141\u8a31\u591a\u500b\u5bb9\u5668\uff0c\u4f46 Google \u5efa\u8b70\u50c5\u4f7f\u7528\u4e00\u500b\u3002\n- `customActions.containers.name`\u662f\u7528\u65bc\u6b64\u64cd\u4f5c\u7684\u7279\u5b9a\u5bb9\u5668\u7684\u4efb\u610f\u540d\u7a31\u3002 \u6839\u64da\u6700\u4f73\u5be6\u8e10\uff0c\u6b64\u5bb9\u5668\u540d\u7a31\u61c9\u59cb\u7d42\u7b26\u5408 SHA \u683c\u5f0f\u3002\n- `image`\u662f\u5bb9\u5668\u6620\u50cf\u7684\u8def\u5f91\u3002\n- `command`\u662f\u6307\u8981\u5728\u5bb9\u5668\u4e0a\u904b\u884c\u7684\u4e00\u500b\u6216\u591a\u500b\u547d\u4ee4\u3002\n- `args`\u662f `command` \u7684\u53c3\u6578\u96c6\u5408\u3002\n\u5982\u9700\u67e5\u770b\u6709\u95dc [customActions](https://skaffold.dev/docs/custom-actions) \u4e2d\u4f7f\u7528\u7684\u914d\u7f6e\u5c6c\u6027\u7684\u8a73\u7d30\u6587\u6a94\uff0c\u8acb\u53c3\u95b1 [Skaffold YAML \u53c3\u8003\u6587\u6a94](https://skaffold.dev/docs/references/yaml/) \u3002\n**\u6ce8\u610f** \uff1a\u60a8\u9084\u53ef\u4ee5\u5b9a\u7fa9 Skaffold \u914d\u7f6e\u4e26\u5c07\u5176\u5b58\u5132\u5728 Git \u4ee3\u78bc\u5eab\u6216 Cloud Storage \u5b58\u5132\u6876\u4e2d\uff0c\u4e26 [\u5f9e\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u5b9a\u7fa9\u4e2d\u5f15\u7528\u9019\u4e9b\u914d\u7f6e](#remote_skaffold) \u3002\n## \u6307\u5b9a\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\n\u5982\u9700\u5b9a\u7fa9\u81ea\u5b9a\u7fa9\u76ee\u6a19\uff0c\u8acb\u5148\u4f7f\u7528 [CustomTargetType \u914d\u7f6e](https://cloud.google.com/deploy/docs/config-files?hl=zh-cn#custom_target_type_definitions) \u5275\u5efa\u81ea\u5b9a\u7fa9\u76ee\u6a19 \u3002\u60a8\u53ef\u4ee5\u5728\u8207\u4ea4\u4ed8\u6d41\u6c34\u7dda\u5b9a\u7fa9\u76f8\u540c\u7684\u6587\u4ef6\u4e2d\u3001\u4f7f\u7528\u76ee\u6a19\u5b9a\u7fa9\u6216\u5728\u55ae\u7368\u7684\u6587\u4ef6\u4e2d\u5275\u5efa `CustomTargetType` \u3002\n`CustomTargetType` \u5b9a\u7fa9\u5982\u4e0b\uff1a\n```\n# Custom target type config (preview)apiVersion: deploy.cloud.google.com/v1kind: CustomTargetTypemetadata:\u00a0 name: [CUSTOM_TARGET_TYPE_NAME]\u00a0 annotations:\u00a0 labels:description:customActions:\u00a0 renderAction: [RENDER_ACTION_NAME]\u00a0 deployAction: [DEPLOY_ACTION_NAME]\u00a0 includeSkaffoldModules:\n```\n\u5730\u9ede\n- `CUSTOM_TARGET_TYPE_NAME`\u662f\u60a8\u7232\u6b64\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u5b9a\u7fa9\u6307\u5b9a\u7684\u4efb\u610f\u540d\u7a31\u3002\u4efb\u4f55\u4f7f\u7528\u60a8\u5b9a\u7fa9\u7684\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u7684\u76ee\u6a19\u7684 [\u76ee\u6a19\u5b9a\u7fa9](https://cloud.google.com/deploy/docs/config-files?hl=zh-cn#target_definitions) \u4e2d\u90fd\u6703\u5f15\u7528\u6b64\u540d\u7a31\u3002\n- `RENDER_ACTION_NAME`\u662f\u81ea\u5b9a\u7fa9\u5448\u73fe\u64cd\u4f5c\u7684\u540d\u7a31\u3002\u6b64\u503c\u662f `skaffold.yaml` \u4e2d\u7232 [\u6e32\u67d3](https://cloud.google.com/deploy/docs/custom-targets?hl=zh-cn#required_inputs_and_outputs) \u64cd\u4f5c\u5b9a\u7fa9\u7684 `customAction.name` \u3002\n- `DEPLOY_ACTION_NAME`\u662f\u81ea\u5b9a\u7fa9\u90e8\u7f72\u64cd\u4f5c\u7684\u540d\u7a31\u3002\u6b64\u503c\u662f `skaffold.yaml` \u4e2d\u7232 [deploy](https://cloud.google.com/deploy/docs/custom-targets?hl=zh-cn#required_inputs_and_outputs) \u64cd\u4f5c\u5b9a\u7fa9\u7684 `customAction.name` \u3002\n- `includeSkaffoldModules`\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u9060\u7a0b Skaffold \u914d\u7f6e\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528\u8a72\u53ef\u9078\u7bc0\u3002 [\u4f7f\u7528\u9060\u7a0b Skaffold \u914d\u7f6e](#remote_skaffold) \u90e8\u5206\u986f\u793a\u4e86\u6b64\u7bc0\u4e2d\u7684\u5c6c\u6027\u3002\n### \u4f7f\u7528\u9060\u7a0b Skaffold \u914d\u7f6e\n\u60a8\u53ef\u4ee5\u5c07 Skaffold \u914d\u7f6e\u5b58\u5132\u5728\u516c\u5171 Git \u4ee3\u78bc\u5eab\u6216 Cloud Storage \u5b58\u5132\u6876\u4e2d\uff0c\u4e26\u5f9e\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u5b9a\u7fa9\u4e2d\u5f15\u7528\u9019\u4e9b\u914d\u7f6e\u3002\n\u4f7f\u7528\u9060\u7a0b Skaffold \u914d\u7f6e\u610f\u5473\u7740\u60a8\u5728\u767c\u4f48\u6642\u63d0\u4f9b\u7684 `skaffold.yaml` \u4e0d\u9700\u8981\u5b9a\u7fa9\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u3002\u9019\u6a23\uff0c\u60a8\u5c31\u53ef\u4ee5\u5728\u6574\u500b\u7d44\u7e54\u4e2d\u5171\u4eab\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u3002\n\u5982\u9700\u4f7f\u7528\u9060\u7a0b Skaffold \u914d\u7f6e\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u4f7f\u7528\u60a8\u7684\u4e00\u500b\u6216\u591a\u500b\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u5275\u5efa Skaffold \u914d\u7f6e\u3002\n- \u5c07\u914d\u7f6e\u5b58\u5132\u5728 Git \u4ee3\u78bc\u5eab\u6216 Cloud Storage \u5b58\u5132\u6876\u4e2d\u3002\n- \u5728\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u5b9a\u7fa9\u4e2d\uff0c\u6dfb\u52a0\u4e00\u500b `customActions.includeSkaffoldModules` \u7bc0\u3002\n- \u5728 `includeSkaffoldModules` \u4e0b\uff0c\u6307\u5b9a\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff08\u53ef\u9078\uff09\u4e00\u500b\u6216\u591a\u500b `configs` \u5143\u7d20\uff1a`- configs: [\"name1\", \"name2\"]``configs` \u7684\u503c\u662f\u8207\u8981\u5305\u542b\u7684\u6bcf\u500b Skaffold \u914d\u7f6e\u4e0a\u7684 `metadata.name` \u5c6c\u6027\u5339\u914d\u7684\u5b57\u7b26\u4e32\u5217\u8868\u3002\u5982\u679c\u7701\u7565\uff0cCloud Deploy \u5c07\u63a1\u7528\u6307\u5b9a\u8def\u5f91\u4e2d\u7684\u6240\u6709\u914d\u7f6e\u3002\n- \u53ef\u4ee5\u662f `googleCloudStorage` \u7bc0\uff0c\u4e5f\u53ef\u4ee5\u662f `git` \u7bc0\u3002\u5c0d\u65bc Cloud Storage\uff1a```\ngoogleCloudStorage:\u00a0 source: PATH_TO_GCS_BUCKET\u00a0 path: FILENAME\n```\u5c0d\u65bc Git\uff1a```\ngit:\u00a0 repo: REPO_URL\u00a0 path: PATH_TO_FILE\u00a0 ref: BRANCH_NAME\n```\u5176\u4e2d\uff1a`PATH_TO_GCS_BUCKET` \u662f\u6307\u5411\u4ee5 `/*` \u7d50\u5c3e\u7684 Cloud Storage \u76ee\u9304\u7684\u8def\u5f91\uff0c\u5176\u4e2d\u5b58\u5132\u4e86 Skaffold \u914d\u7f6e\u3002Skaffold \u6703\u4e0b\u8f09\u6b64\u76ee\u9304\u4e2d\u7684\u6240\u6709\u6587\u4ef6\uff0c\u7136\u5f8c\u6839\u64da\u914d\u7f6e\u7684\u76f8\u5c0d\u8def\u5f91\u67e5\u627e\u5305\u542b\u914d\u7f6e\u7684\u76f8\u95dc Skaffold \u6587\u4ef6\u3002`FILENAME` \u662f\u5305\u542b Skaffold \u914d\u7f6e\u7684\u6587\u4ef6\u7684\u540d\u7a31\u3002\u6b64 `path:` \u5c6c\u6027\u662f\u53ef\u9078\u7684\uff1b\u5982\u679c\u60a8\u672a\u6307\u5b9a\u8a72\u5c6c\u6027\uff0cCloud Deploy \u6703\u5047\u5b9a\u7232 `skaffold.yaml` \u3002\u5982\u679c\u6c92\u6709 `skaffold.yaml` \uff0c\u6216\u8005\u60a8\u6307\u5b9a\u7684\u6587\u4ef6\u540d\u4e0d\u5b58\u5728\uff0c\u5247\u7248\u672c\u5275\u5efa\u5931\u6557\u3002`REPO_URL` \u662f Git \u4ee3\u78bc\u5eab\u7684\u7db2\u5740\u3002`PATH_TO_FILE` \u662f\u8a72\u4ee3\u78bc\u5eab\u4e2d\u5305\u542b Skaffold \u914d\u7f6e\u7684\u6587\u4ef6\u7684\u8def\u5f91\u3002`BRANCH_NAME` \u662f\u5f9e\u4e2d\u7372\u53d6 Skaffold \u914d\u7f6e\u7684\u5206\u652f\u7684\u540d\u7a31\uff08\u4f8b\u5982 `main` \uff09\u3002\n\u4ee5\u4e0b\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b YAML \u662f\u4e00\u500b\u5305\u542b `includeSkaffoldModules` \u7bc0\u7684 `customActions` \u7bc0\uff0c\u6307\u5411\u5b58\u5132\u5728 Cloud Storage \u5b58\u5132\u6876\u4e2d\u7684 Skaffold \u914d\u7f6e\uff1a\n```\ncustomActions:\u00a0 renderAction: my-custom-action\u00a0 deployAction: my-custom-action\u00a0 includeSkaffoldModules:\u00a0 \u00a0 - configs: [\"myConfig\"]\u00a0 \u00a0 \u00a0 googleCloudStorage:\u00a0 \u00a0 \u00a0 \u00a0 source: \"gs://my-custom-target-bucket/my-custom/*\"\u00a0 \u00a0 \u00a0 \u00a0 path: \"skaffold.yaml\n```\n\u4ee5\u4e0b YAML \u662f\u6240\u793a\u7684\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u6240\u5f15\u7528\u7684 Skaffold \u914d\u7f6e\uff1a\n```\napiVersion: skaffold/v4beta7kind: Configmetadata:\u00a0 name: myConfigcustomActions:\u00a0 - name: my-custom-action\u00a0 \u00a0 containers:\u00a0 \u00a0 \u00a0 - name: my-custom-container\u00a0 \u00a0 \u00a0 \u00a0 image: us-east1-docker.pkg.dev/abcdefg/foldername/myimage@sha256:c56fcf6e0a7637ddf0df3d56a0dd23bfce03ceca06a6fc527b0e0e7430e6e9f9\n```\n### \u8a3b\u518a\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\n\u914d\u7f6e `CustomTargetType` \u5f8c\uff0c\u8acb\u904b\u884c [gcloud deploy apply](https://cloud.google.com/sdk/gcloud/reference/deploy/apply?hl=zh-cn) \u547d\u4ee4\u4ee5\u5728 Google Cloud \u9805\u76ee\u4e2d\u8a3b\u518a `CustomTargetType` \u8cc7\u6e90\uff1a\n```\ngcloud deploy apply --file=[FILE] --project=[PROJECT] --region=[REGION]\n```\n\u5176\u4e2d\uff1a\n`FILE` \u662f\u60a8\u5728\u5176\u4e2d\u5b9a\u7fa9\u4e86\u6b64\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u7684\u6587\u4ef6\u7684\u540d\u7a31\u3002\n`PROJECT` \u662f\u8981\u5728\u5176\u4e2d\u5275\u5efa\u6b64\u8cc7\u6e90\u7684 Google Cloud \u9805\u76ee\u3002 `CustomTargetType` \u5fc5\u9808\u8207\u5f15\u7528\u5b83\u7684 `Target` \u8cc7\u6e90\u4f4d\u65bc\u540c\u4e00\u9805\u76ee\u4e2d\u3002\u5982\u679c\u60a8\u5df2\u5c07\u9805\u76ee\u8a2d\u7f6e\u7232 Google Cloud CLI \u7684\u9ed8\u8a8d\u9805\u76ee\uff0c\u5247\u7121\u9700\u6307\u5b9a\u9805\u76ee\u3002\n`REGION` \u662f\u8981\u5728\u5176\u4e2d\u5275\u5efa\u6b64\u8cc7\u6e90\u7684\u5340\u57df\uff08\u4f8b\u5982 `us-centra1` \uff09\u3002 `CustomTargetType` \u5fc5\u9808\u8207\u5f15\u7528\u5b83\u7684 `Target` \u8cc7\u6e90\u4f4d\u65bc\u540c\u4e00\u5340\u57df\u3002\u5982\u679c\u60a8\u5df2\u5c07\u5340\u57df\u8a2d\u7f6e\u7232 gcloud CLI \u7684\u9ed8\u8a8d\u5340\u57df\uff0c\u5247\u7121\u9700\u6307\u5b9a\u5340\u57df\u3002\n\u5c07 `CustomTargetType` \u5275\u5efa\u7232 Cloud Deploy \u8cc7\u6e90\u5f8c\uff0c\u60a8\u73fe\u5728\u53ef\u4ee5\u5728 `Target` \u5b9a\u7fa9\u4e2d\u4f7f\u7528\u5b83\u4f86\u5275\u5efa\u81ea\u5b9a\u7fa9\u76ee\u6a19\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 `CustomTargetType` \u5b9a\u7fa9\uff0c\u8acb\u53c3\u95b1 [Cloud Deploy \u914d\u7f6e\u67b6\u69cb\u53c3\u8003\u6587\u6a94](https://cloud.google.com/deploy/docs/config-files?hl=zh-cn#custom_target_type_definitions) \u3002\n## \u8a2d\u5b9a\u76ee\u6a19\n\u53d7\u652f\u6301\u7684\u76ee\u6a19\u985e\u578b\u7684\u76ee\u6a19\u5b9a\u7fa9\u8207\u81ea\u5b9a\u7fa9\u76ee\u6a19\u5b9a\u7fa9\u7684\u552f\u4e00\u5340\u5225\u5728\u65bc\uff0c\u81ea\u5b9a\u7fa9\u76ee\u6a19\u5b9a\u7fa9\u5305\u542b `customTarget` \u7bc0\u3002 `customTarget` \u7684\u8a9e\u6cd5\u5982\u4e0b\uff1a\n```\ncustomTarget:\u00a0 customTargetType: [CUSTOM_TARGET_TYPE_NAME]\n```\n\u5176\u4e2d\uff0c `CUSTOM_TARGET_TYPE_NAME` \u662f [\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u914d\u7f6e](#define_custom_target_type) \u4e2d\u5b9a\u7fa9\u7684 `name` \u5c6c\u6027\u7684\u503c\u3002\n**\u6ce8\u610f** \uff1a\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u591a\u76ee\u6a19](https://cloud.google.com/deploy/docs/parallel?hl=zh-cn) \uff0c\u5176\u4e2d\u5b50\u76ee\u6a19\u7232\u81ea\u5b9a\u7fa9\u76ee\u6a19\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u6240\u6709\u5b50\u76ee\u6a19\u90fd\u5fc5\u9808\u5c6c\u65bc\u540c\u4e00 `CustomTargetType` \u3002\n## \u5c07\u76ee\u6a19\u6dfb\u52a0\u5230\u4ea4\u4ed8\u6d41\u6c34\u7dda\n\u60a8\u53ef\u4ee5\u5728\u4ea4\u4ed8\u6d41\u6c34\u7dda\u4e2d\u4f7f\u7528\u81ea\u5b9a\u7fa9\u76ee\u6a19\uff0c\u5c31\u50cf\u4f7f\u7528\u53d7\u652f\u6301\u7684\u76ee\u6a19\u985e\u578b\u4e00\u6a23\u3002\u4e5f\u5c31\u662f\u8aaa\uff0c\u53d7\u652f\u6301\u7684\u76ee\u6a19\u985e\u578b\u7684\u76ee\u6a19\u8207\u81ea\u5b9a\u7fa9\u76ee\u6a19\u4e4b\u9593\u7684\u4ea4\u4ed8\u6d41\u6c34\u7dda\u9032\u5ea6\u6c92\u6709\u5dee\u7570\u3002\n\u4ea4\u4ed8\u6d41\u6c34\u7dda\u4e2d\u7684\u6240\u6709\u76ee\u6a19\u5fc5\u9808\u4f7f\u7528\u76f8\u540c\u7684\u76ee\u6a19\u985e\u578b\u3002\u4f8b\u5982\uff0c\u60a8\u4e0d\u80fd\u64c1\u6709\u5c07\u4e00\u4e9b\u76ee\u6a19\u90e8\u7f72\u5230 Google Kubernetes Engine \u548c\u4e00\u4e9b\u81ea\u5b9a\u7fa9\u76ee\u6a19\u7684\u4ea4\u4ed8\u6d41\u6c34\u7dda\u3002\n\u8207\u652f\u6301\u7684\u76ee\u6a19\u985e\u578b\u4e00\u6a23\uff0c\u60a8\u53ef\u4ee5\u5728\u6d41\u6c34\u7dda\u968e\u6bb5\u6dfb\u52a0 [\u90e8\u7f72\u53c3\u6578](https://cloud.google.com/deploy/docs/parameters?hl=zh-cn) \u3002\n## \u5275\u5efa\u7248\u672c\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u672a\u4f7f\u7528 [\u9060\u7a0b Skaffold \u914d\u7f6e](#remote_skaffold) \uff0c\u5247\u60a8\u7232\u7248\u672c\u63d0\u4f9b\u7684 `skaffold.yaml` \u6587\u4ef6\u5fc5\u9808\u5b9a\u7fa9\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u6240\u9700\u7684\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u3002\n\u73fe\u5728\uff0c\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b\u5df2\u5b8c\u5168\u5b9a\u7fa9\uff0c\u4e26\u5275\u5efa\u4e86\u4f7f\u7528\u8a72\u985e\u578b\u7684\u76ee\u6a19\u5f8c\uff0c\u60a8\u5c31\u53ef\u4ee5\u901a\u904e\u5e38\u898f\u65b9\u5f0f\u5275\u5efa\u7248\u672c\u4e86\uff1a\n```\ngcloud deploy releases create [RELEASE_NAME] \\\u00a0 --project=[PROJECT_NAME] \\\u00a0 --region=[REGION] \\\u00a0 --delivery-pipeline=[PIPELINE_NAME]\n```\n\u5275\u5efa\u7248\u672c\u5f8c\uff0c\u7cfb\u7d71\u6703\u7232\u4ea4\u4ed8\u6d41\u6c34\u7dda\u4e2d\u7684\u6bcf\u500b\u76ee\u6a19\u57f7\u884c\u81ea\u5b9a\u7fa9\u6e32\u67d3\u64cd\u4f5c\uff0c\u5305\u62ec\u8655\u7406\u5728\u7248\u672c\u3001\u76ee\u6a19\u6216\u4ea4\u4ed8\u6d41\u6c34\u7dda\u4e2d\u914d\u7f6e\u7684 [\u90e8\u7f72\u53c3\u6578](https://cloud.google.com/deploy/docs/parameters?hl=zh-cn) \u3002Cloud Deploy \u5411\u81ea\u5b9a\u7fa9\u6e32\u67d3\u5bb9\u5668\u63d0\u4f9b [\u90e8\u7f72\u53c3\u6578\u4f5c\u7232\u8f38\u5165](https://cloud.google.com/deploy/docs/custom-targets?hl=zh-cn#custom_targets_and_deploy_parameters) \u3002\n## \u67e5\u770b\u81ea\u5b9a\u7fa9\u76ee\u6a19\u7684\u8f38\u51fa\n\u5982\u679c\u60a8\u7684\u81ea\u5b9a\u7fa9\u64cd\u4f5c\u6eff\u8db3\u81ea\u5b9a\u7fa9\u76ee\u6a19\u7684 [\u8981\u6c42](https://cloud.google.com/deploy/docs/custom-targets?hl=zh-cn#required_inputs_and_outputs) \uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u67e5\u770b\u6e32\u67d3\u7684\u5de5\u4ef6\u3002\n\u5982\u9700\u67e5\u770b\u81ea\u5b9a\u7fa9\u5448\u73fe\u64cd\u4f5c\u7684\u8f38\u51fa\uff0c\u8acb\u6309\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 Cloud Deploy **\u4ea4\u4ed8\u6d41\u6c34\u7dda** \u9801\u9762\u4ee5\u67e5\u770b\u4ea4\u4ed8\u6d41\u6c34\u7dda\u3002 [\u6253\u958b\u201c\u4ea4\u4ed8\u6d41\u6c34\u7dda\u201d\u9801\u9762](https://console.cloud.google.com/deploy/delivery-pipelines?hl=zh-cn) \n- \u9ede\u64ca\u4ea4\u4ed8\u6d41\u6c34\u7dda\u7684\u540d\u7a31\u3002\u6d41\u6c34\u7dda\u53ef\u8996\u5316\u6703\u986f\u793a\u61c9\u7528\u7684\u90e8\u7f72\u72c0\u614b\uff0c\u60a8\u7684\u7248\u672c\u6703\u5217\u5728 **\u4ea4\u4ed8\u6d41\u6c34\u7dda\u8a73\u60c5** \u4e0b\u7684 **\u7248\u672c** \u6a19\u7c64\u9801\u4e0a\u3002\n- \u9ede\u64ca\u76f8\u61c9\u7248\u672c\u540d\u7a31\u3002\u7cfb\u7d71\u96a8\u5373\u6703\u986f\u793a **\u767c\u4f48\u7248\u672c\u8a73\u60c5** \u9801\u9762\u3002\n- \u9ede\u64ca **\u5de5\u4ef6** \u6a19\u7c64\u9801\u3002\n- \u5728 **\u76ee\u6a19\u5de5\u4ef6** \u4e0b\uff0c\u9ede\u64ca **\u67e5\u770b\u5de5\u4ef6** \u65c1\u908a\u7684\u7bad\u982d\u3002\u7cfb\u7d71\u6703\u5217\u51fa\u6e32\u67d3\u7684\u5de5\u4ef6\uff0c\u5305\u62ec\u5df2\u6e32\u67d3\u7684 `skaffold.yaml` \u548c\u7531\u81ea\u5b9a\u7fa9\u6e32\u67d3\u7a0b\u5e8f\u751f\u6210\u7684\u6e32\u67d3\u7684\u6e05\u55ae\u6587\u4ef6\u3002\u60a8\u53ef\u4ee5\u9ede\u64ca\u6bcf\u500b\u6587\u4ef6\u65c1\u908a\u7684 **\u5b58\u5132\u4f4d\u7f6e** \u93c8\u63a5\uff0c\u8f49\u5230 Cloud Storage \u5b58\u5132\u6876\u4ee5\u67e5\u770b\u9019\u4e9b\u6587\u4ef6\u3002\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 [\u7248\u672c\u6aa2\u67e5\u5668](https://cloud.google.com/deploy/docs/view-release?hl=zh-cn#view_release_artifacts) \u9ede\u64ca **\u67e5\u770b\u5de5\u4ef6** \u93c8\u63a5\uff0c\u6309\u7248\u672c\u3001\u76ee\u6a19\u6216\u968e\u6bb5\u67e5\u770b\u9019\u4e9b\u6587\u4ef6\u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u53c3\u95b1\u300a [\u5feb\u901f\u5165\u9580\uff1a\u5b9a\u7fa9\u548c\u4f7f\u7528\u81ea\u5b9a\u7fa9\u76ee\u6a19\u985e\u578b](https://cloud.google.com/deploy/docs/deploy-app-custom-target?hl=zh-cn) \u300b\n- [\u5275\u5efa\u4ea4\u4ed8\u6d41\u6c34\u7dda\u548c\u76ee\u6a19](https://cloud.google.com/deploy/docs/create-pipeline-targets?hl=zh-cn) \u3002\n- \u8a73\u7d30\u77ad\u89e3\u5982\u4f55 [\u914d\u7f6e Cloud Deploy \u76ee\u6a19](https://cloud.google.com/deploy/docs/config-files?hl=zh-cn#target_definitions)", "guide": "Cloud Deploy"}