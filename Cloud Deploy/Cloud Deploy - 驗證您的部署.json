{"title": "Cloud Deploy - \u9a57\u8b49\u60a8\u7684\u90e8\u7f72", "url": "https://cloud.google.com/deploy/docs/verify-deployment?hl=zh-cn", "abstract": "# Cloud Deploy - \u9a57\u8b49\u60a8\u7684\u90e8\u7f72\n\u672c\u6587\u6a94\u4ecb\u7d39\u5982\u4f55\u9a57\u8b49 Cloud Deploy \u90e8\u7f72\u3002\n\u60a8\u53ef\u4ee5\u914d\u7f6e Cloud Deploy \u548c Skaffold \u4ee5\u9a57\u8b49\u5df2\u90e8\u7f72\u5230\u4efb\u4f55\u76ee\u6a19\u7684\u61c9\u7528\u662f\u5426\u6b63\u5e38\u904b\u884c\u3002\u4f7f\u7528\u60a8\u81ea\u5df1\u7684\u6e2c\u8a66\u6620\u50cf\u9032\u884c\u9a57\u8b49\uff0c\u7136\u5f8c\u5c07 Cloud Deploy \u548c Skaffold \u914d\u7f6e\u7232\u5728\u90e8\u7f72\u5b8c\u6210\u5f8c\u904b\u884c\u9019\u4e9b\u6e2c\u8a66\u3002\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u90e8\u7f72\u9a57\u8b49\u5728 Cloud Deploy [\u57f7\u884c\u74b0\u5883](https://cloud.google.com/deploy/docs/execution-environment?hl=zh-cn#changing_the_execution_environment) \u4e2d\u904b\u884c\uff0c\u4f46\u60a8\u4e5f\u53ef\u4ee5 [\u5c07\u5176\u914d\u7f6e\u7232\u5728\u904b\u884c\u61c9\u7528\u7684\u540c\u4e00\u96c6\u7fa3\u4e0a\u904b\u884c](#run_the_verification_container_on_the_application_cluster) \u3002\n", "content": "## \u90e8\u7f72\u9a57\u8b49\u7684\u5de5\u4f5c\u539f\u7406\u662f\u4ec0\u9ebc\uff1f\n- \u60a8 [configure](#configure_skaffold) Skaffold \u4ee5\u9032\u884c\u9a57\u8b49\u3002\u6b64\u914d\u7f6e\u53ef\u6a19\u8b58\u8981\u7528\u65bc\u904b\u884c\u6e2c\u8a66\u7684\u4e00\u500b\u6216\u591a\u500b\u5bb9\u5668\u6620\u50cf\uff0c\u4ee5\u53ca\u8981\u5f9e\u8a72\u5bb9\u5668\u6620\u50cf\u904b\u884c\u7684\u7279\u5b9a\u547d\u4ee4\uff08\u4f8b\u5982\u8173\u672c\uff09\u3002\n- \u60a8\u53ef\u4ee5\u5728\u4ea4\u4ed8\u6d41\u6c34\u7dda\u4e2d [configure](#configure_pipeline) \u4e00\u500b\u6216\u591a\u500b\u76ee\u6a19\uff0c\u4ee5\u9032\u884c\u90e8\u7f72\u9a57\u8b49\u3002\u6b64\u914d\u7f6e\u7528\u65bc\u5c0d\u90e8\u7f72\u5230\u8a72\u76ee\u6a19\u7684\u5de5\u4f5c\u8ca0\u8f09\u9032\u884c\u9a57\u8b49\u3002 \n- \u90e8\u7f72\u767c\u4f48 ( `skaffold apply` ) \u5f8c\uff0cCloud Deploy \u5728 Cloud Deploy \u57f7\u884c\u74b0\u5883\u4e2d\u904b\u884c [skaffold verify](https://skaffold.dev/docs/references/cli/#skaffold-verify) \u547d\u4ee4\u3002\u5c0d\u65bc\u5230 Google Kubernetes Engine \u548c GKE Enterprise \u7684\u90e8\u7f72\uff0c\u60a8\u53ef\u4ee5\u9078\u64c7\u5728\u904b\u884c\u61c9\u7528\u5bb9\u5668\u7684\u540c\u4e00\u96c6\u7fa3\u4e0a\u904b\u884c\u9a57\u8b49\u5bb9\u5668\u3002\n- Skaffold \u6703\u8abf\u7528 `skaffold.yaml` \u7684 `verify` \u7bc0\u4e2d\u6307\u5b9a\u7684\u4e00\u500b\u6216\u591a\u500b\u6e2c\u8a66\uff0c\u4ee5\u5c0d\u5df2\u90e8\u7f72\u7684\u61c9\u7528\u904b\u884c\u3002\n- \u57f7\u884c\u7684\u6e2c\u8a66\u6210\u529f\u6216\u5931\u6557\u8868\u793a\u9a57\u8b49\u6210\u529f\u6216\u5931\u6557\u3002- \u9a57\u8b49\u6210\u529f\u53d6\u6c7a\u65bc\u5df2\u57f7\u884c\u7684\u5bb9\u5668\u7684\u9000\u51fa\u4ee3\u78bc\u3002`0` \u8868\u793a\u6210\u529f\u3002\u975e\u96f6\u9000\u51fa\u4ee3\u78bc\u8868\u793a\u5931\u6557\u3002\u5982\u9700\u751f\u6210\u6240\u9700\u7684\u9a57\u8b49\u7d50\u679c\uff0c\u8acb\u78ba\u4fdd\u5bb9\u5668\u9000\u51fa\u4e26\u986f\u793a\u76f8\u61c9\u7684\u9000\u51fa\u4ee3\u78bc\u3002\u5982\u679c\u9a57\u8b49\u904e\u7a0b\u4e2d\u57f7\u884c\u4e86\u591a\u500b\u5bb9\u5668\uff0c\u5247\u9019\u4e9b\u5bb9\u5668\u5fc5\u9808\u5168\u90e8\u6210\u529f\u624d\u80fd\u6210\u529f\u9a57\u8b49\u3002\n- \u5982\u679c\u9a57\u8b49\u5931\u6557\uff0c\u767c\u4f48\u4e5f\u6703\u5931\u6557\u3002\n- \u5982\u679c\u90e8\u7f72\u5728\u9a57\u8b49\u671f\u9593\u5931\u6557\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u6aa2\u67e5\u767c\u4f48\u4f86\u78ba\u8a8d\u9019\u4e00\u9ede\uff1a \n- \u60a8\u53ef\u4ee5 [ignore](https://cloud.google.com/deploy/docs/deployment-strategies/manage-rollout?hl=zh-cn#ignore_job) \u6216 [\u91cd\u8a66](#retry) \u5931\u6557\u7684\u9a57\u8b49\u3002\u60a8\u9084\u53ef\u4ee5 [\u7d42\u6b62](https://cloud.google.com/deploy/docs/deployment-strategies/manage-rollout?hl=zh-cn#terminate_job_run) \u6b63\u5728\u9032\u884c\u7684\u9a57\u8b49\u4f5c\u696d\u3002\n### \u7528\u65bc\u9a57\u8b49\u7684\u7d44\u4ef6\n[rollout](https://cloud.google.com/deploy/docs/architecture?hl=zh-cn#resources) \u8cc7\u6e90\u5305\u62ec\u4ee5\u4e0b\u652f\u6301\u90e8\u7f72\u9a57\u8b49\u7684\u5c0d\u8c61\uff1a\n- \u968e\u6bb5\u767c\u4f48\u4e2d\u908f\u8f2f\u4e0a\u7d44\u5408\u5728\u4e00\u8d77\u7684\u64cd\u4f5c\uff08\u4f5c\u696d\uff09\u96c6\u5408\uff0c\u4f8b\u5982\u90e8\u7f72\u6216\u90e8\u7f72\u548c\u9a57\u8b49\u3002\n- \u4f5c\u696d\u8981\u5728\u767c\u4f48\u6642\u57f7\u884c\u7684\u7279\u5b9a\u64cd\u4f5c\uff0c\u4f8b\u5982\u90e8\u7f72\u6216\u9a57\u8b49\u3002\n- \u4f5c\u696d\u904b\u884c\u4f5c\u7232\u767c\u4f48\u8cc7\u6e90\u7684\u5b50\u7d1a\uff0c\u4f5c\u696d\u904b\u884c\u662f\u4f5c\u696d\u7684\u5be6\u4f8b\uff0c\u4f8b\u5982\u5617\u8a66\u90e8\u7f72\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Cloud Deploy \u8cc7\u6e90\uff0c\u8acb\u53c3\u95b1 [Cloud Deploy \u670d\u52d9\u67b6\u69cb](https://cloud.google.com/deploy/docs/architecture?hl=zh-cn)\n### \u90e8\u7f72\u9a57\u8b49\u751f\u6210\u7684\u901a\u77e5\nCloud Deploy \u7232\u4ee5\u4e0b\u4e8b\u4ef6\u751f\u6210 Pub/Sub \u6d88\u606f\u4f75\u767c\u5e03\u9019\u4e9b\u6d88\u606f\uff1a\n- \u5275\u5efa\u3001\u66f4\u65b0\u548c\u522a\u9664\u4f5c\u696d\u904b\u884c\u9019\u4e9b\u901a\u77e5\u6703\u767c\u5e03\u5230 `clouddeploy-resources` \u4e3b\u984c\uff0c\u5e77\u5305\u542b\u4ee5\u4e0b\u5c6c\u6027\uff1a- `Resource`\n- `ResourceType`(`JobRun`)\n- `Action`\uff08`Create`\uff0c`Update`\uff0c`Delete`\uff09\n- `ProjectNumber`\n- `Location`\n- `TargetId`\n- `DeliveryPipelineId`\n- `ReleaseId`\n- `RolloutId`\n- `JobRunId`\u4ee5\u4e0b\u662f\u95dc\u65bc\u4f5c\u696d\u904b\u884c\u5275\u5efa\u7684 Pub/Sub \u6d88\u606f\u793a\u4f8b\uff0c\u8a72\u6d88\u606f\u5df2\u767c\u4f48\u5230 `clouddeploy-resources` \u4e3b\u984c\uff1a\n```\n{\u00a0 \u00a0 \"ackId\": \"UAYWLF1GSFE3GQhoUQ5PXiM_NSAoRRAGAE8CKF15MFcrQVh9Dz4NGXJ9YXRiWRIJBkUHeF9cEQ1iXE5EB0nq0KDVV1dKXxYGAExQeVhbHQVoWVh0Bnn7h5nK-8HjYwk9OqKarPdtO4PY2fNHZiI9XhJLLD5-My5FQV5AEkw4G0RJUytDCypYEU4EISE-MD5FU0Q\",\u00a0 \u00a0 \"message\": {\u00a0 \u00a0 \u00a0 \"attributes\": {\u00a0 \u00a0 \u00a0 \u00a0 \"Action\": \"Create\",\u00a0 \u00a0 \u00a0 \u00a0 \"DeliveryPipelineId\": \"dv-pipeline\",\u00a0 \u00a0 \u00a0 \u00a0 \"JobRunId\": \"634f8c6f-30c3-49ca-af80-68dc24d4cc5d\",\u00a0 \u00a0 \u00a0 \u00a0 \"Location\": \"us-central1\",\u00a0 \u00a0 \u00a0 \u00a0 \"ProjectNumber\": \"253401481285\",\u00a0 \u00a0 \u00a0 \u00a0 \"ReleaseId\": \"test-release-100\",\u00a0 \u00a0 \u00a0 \u00a0 \"Resource\": \"projects/253401481285/locations/us-central1/deliveryPipelines/dv-pipeline/releases/test-release-100/rollouts/test-release-100-to-dev-0001/jobRuns/634f8c6f-30c3-49ca-af80-68dc24d4cc5d\",\u00a0 \u00a0 \u00a0 \u00a0 \"ResourceType\": \"JobRun\",\u00a0 \u00a0 \u00a0 \u00a0 \"RolloutId\": \"test-release-100-to-dev-0001\"\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \"messageId\": \"5572937706805411\",\u00a0 \u00a0 \u00a0 \"publishTime\": \"2022-09-07T14:00:46.040Z\"\u00a0 \u00a0 }\u00a0 },\n```\n- \u4f5c\u696d\u904b\u884c\u958b\u59cb\u3001\u6210\u529f\u548c\u5931\u6557\u9019\u4e9b\u901a\u77e5\u6703\u767c\u5e03\u5230 `clouddeploy-operations` \u4e3b\u984c\uff0c\u5e77\u5305\u542b\u4ee5\u4e0b\u5c6c\u6027\uff1a- `Resource`\n- `ResourceType`(`JobRun`)\n- `Action`\uff08`Start`\uff0c`Succeed`\uff0c`Failure`\uff09\n- `ProjectNumber`\n- `Location`\n- `TargetId`\n- `DeliveryPipelineId`\n- `ReleaseId`\n- `RolloutId`\n- `JobRunId`\n- `PhaseId`\n- `JobId`\n- `JobType`\uff08`Deploy`\u6216`Verify`\uff09\u4ee5\u4e0b\u662f\u4e00\u500b\u95dc\u65bc\u5931\u6557\u7684\u4f5c\u696d\u904b\u884c\u60c5\u6cc1\u7684 Pub/Sub \u6d88\u606f\u793a\u4f8b\uff0c\u8a72\u6d88\u606f\u5df2\u767c\u4f48\u5230 `clouddeploy-operations` \u4e3b\u984c\uff1a\n```\n{\u00a0 \u00a0 \"ackId\": \"RFAGFixdRkhRNxkIaFEOT14jPzUgKEUUBAgUBXx9cEFPdVhec2hRDRlyfWB9aVsbCAUXU3cJURsHaE5tdR-6xcvaS0NVb18UAgRFWndfXhMEblhfcy-fkK3HwvT9U0AvOemNgdZpe6jHiulvZiM9XxJLLD5-My5FQV5AEkw4G0RJUytDCypYEU4EISE-MD5FUw\",\u00a0 \u00a0 \"message\": {\u00a0 \u00a0 \u00a0 \"attributes\": {\u00a0 \u00a0 \u00a0 \u00a0 \"Action\": \"Failure\",\u00a0 \u00a0 \u00a0 \u00a0 \"DeliveryPipelineId\": \"dv-pipeline\",\u00a0 \u00a0 \u00a0 \u00a0 \"JobId\": \"verify\",\u00a0 \u00a0 \u00a0 \u00a0 \"JobRunId\": \"b389224a-c259-4a00-ab75-c22e48bc3136\",\u00a0 \u00a0 \u00a0 \u00a0 \"JobType\": \"Verify\",\u00a0 \u00a0 \u00a0 \u00a0 \"Location\": \"us-central1\",\u00a0 \u00a0 \u00a0 \u00a0 \"PhaseId\": \"stable\",\u00a0 \u00a0 \u00a0 \u00a0 \"ProjectNumber\": \"253401481285\",\u00a0 \u00a0 \u00a0 \u00a0 \"ReleaseId\": \"test-release-101\",\u00a0 \u00a0 \u00a0 \u00a0 \"Resource\": \"projects/253401481285/locations/us-central1/deliveryPipelines/dv-pipeline/releases/test-release-101/rollouts/test-release-101-to-dev-0001/jobRuns/b389224a-c259-4a00-ab75-c22e48bc3136\",\u00a0 \u00a0 \u00a0 \u00a0 \"ResourceType\": \"JobRun\",\u00a0 \u00a0 \u00a0 \u00a0 \"RolloutId\": \"test-release-101-to-dev-0001\",\u00a0 \u00a0 \u00a0 \u00a0 \"TargetId\": \"dev\"\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \"messageId\": \"5573609905896436\",\u00a0 \u00a0 \u00a0 \"publishTime\": \"2022-09-07T15:35:37.906Z\"\u00a0 \u00a0 }\u00a0 },\n```\n## \u914d\u7f6e Cloud Deploy \u4ee5\u9032\u884c\u90e8\u7f72\u9a57\u8b49\n\u7232 Cloud Deploy \u76ee\u6a19\u5553\u7528\u90e8\u7f72\u9a57\u8b49\u5305\u62ec\u5728\u4ea4\u4ed8\u6d41\u6c34\u7dda\u904e\u7a0b\u4e2d\u5411\u4e00\u500b\u6216\u591a\u500b\u7d66\u5b9a\u76ee\u6a19\u6dfb\u52a0 [verify: true \u5c6c\u6027](https://cloud.google.com/deploy/docs/config-files?hl=zh-cn#pipeline_definition_and_progression) \uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a\n```\napiVersion: deploy.cloud.google.com/v1kind: DeliveryPipelinemetadata:\u00a0name: my-demo-appdescription: main application pipelineserialPipeline:\u00a0stages:\u00a0- targetId: dev\u00a0 \u00a0profiles: []\u00a0 \u00a0strategy:\u00a0 \u00a0 \u00a0standard:\u00a0 \u00a0 \u00a0 \u00a0verify: true\u00a0- targetId: prod\u00a0 \u00a0profiles: []\u00a0 \u00a0strategy:\u00a0 \u00a0 \u00a0standard:\u00a0 \u00a0 \u00a0 \u00a0verify: false\n```\n\u5728\u6b64\u914d\u7f6e\u4e2d\uff0c\u5c0d `dev` \u76ee\u6a19\u5553\u7528\u90e8\u7f72\u9a57\u8b49\uff0c\u4f46\u4e0d\u5c0d `prod` \u76ee\u6a19\u5553\u7528\u3002 `verify: false` \u76f8\u7576\u65bc\u7701\u7565 `verify` \u5c6c\u6027\u6216\u6574\u500b `strategy` \u7bc0\u3002\n\u9a57\u8b49\u64cd\u4f5c\u5728\u5176\u81ea\u5df1\u7684\u57f7\u884c\u74b0\u5883 [](https://cloud.google.com/deploy/docs/execution-environment?hl=zh-cn) \u4e2d\u57f7\u884c\u3002\u60a8\u53ef\u4ee5\u7232 `VERIFY` \u914d\u7f6e\u6b64\u57f7\u884c\u74b0\u5883\uff0c\u64cd\u4f5c\u65b9\u5f0f\u8207\u7232 `RENDER` \u548c `DEPLOY` \u914d\u7f6e\u76f8\u540c\u3002\n## \u914d\u7f6e Skaffold \u4ee5\u9032\u884c\u90e8\u7f72\u9a57\u8b49\n\u7232\u76ee\u6a19\u5553\u7528\u90e8\u7f72\u9a57\u8b49\u6642\uff0c\u9700\u8981\u5728\u90e8\u7f72\u7684 `skaffold.yaml` \u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u500b `verify` \u7bc0\u3002\u5982\u679c\u60a8\u8981\u7232\u6bcf\u500b\u76ee\u6a19\u4f7f\u7528\u55ae\u7368\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5247\u6b64\u914d\u7f6e\u53ef\u7528\u65bc\u7279\u5b9a\u7684 Skaffold \u914d\u7f6e\u6587\u4ef6\u3002\n**\u6ce8\u610f** \uff1a\u60a8\u7684 `skaffold.yaml` \u5fc5\u9808\u6a19\u8b58 `apiVersion` \u7232 `skaffold/v3alpha1` \u6216\u66f4\u9ad8\u3002\n\u6b64 `verify` \u7bc0\u6a19\u8b58\u7232\u4e86\u9032\u884c\u9a57\u8b49\u800c\u8981\u904b\u884c\u7684\u5bb9\u5668\uff0c\u4f8b\u5982\u96c6\u6210\u6e2c\u8a66\u3002\n\u4ee5\u4e0b\u793a\u4f8b `skaffold.yaml` \u5305\u542b\u4e00\u500b `verify` \u7bc0\uff1a\n```\napiVersion: skaffold/v4beta7kind: Configbuild:\u00a0 artifacts:\u00a0 \u00a0 - image: integration-test\u00a0 \u00a0 \u00a0 context: integration-testmanifests:\u00a0 rawYaml:\u00a0 - kubernetes.yamldeploy:\u00a0 kubectl: {}verify:- name: verify-integration-test\u00a0 container:\u00a0 \u00a0 name: integration-test\u00a0 \u00a0 image: integration-test\u00a0 \u00a0 command: [\"./test-systems.sh\"]- name: verify-endpoint-test\u00a0 container:\u00a0 \u00a0 name: alpine\u00a0 \u00a0 image: alpine\u00a0 \u00a0 command: [\"/bin/sh\"]\u00a0 \u00a0 args: [\"-c\", \"wget #ENDPOINT_URL\"]\n```\n\u9019\u500b\u7c21\u55ae\u793a\u4f8b\u5c55\u793a\u4e86\u4e00\u500b [verify \u7bc0](https://skaffold-v2.web.app/docs/pipeline-stages/verify/) \uff0c\u7528\u65bc\u6a19\u8b58\u8981\u4f7f\u7528\u7684\u5bb9\u5668\u4ee5\u53ca\u8981\u5728\u8a72\u5bb9\u5668\u4e2d\u904b\u884c\u7684\u6e2c\u8a66\u8173\u672c\u3002\u6b64\u793a\u4f8b\u4e2d\u7684 `#ENDPOINT_URL` \u53ea\u662f\u61c9\u7528\u7db2\u5740\u7684\u4f54\u4f4d\u7b26\uff0c\u800c\u4e0d\u662f\u53ef\u7528\u7684 Cloud Deploy \u74b0\u5883\u8b8a\u91cf\u3002\n**\u6ce8\u610f** \uff1a\u60a8\u7121\u9700\u4f7f\u7528 Skaffold \u69cb\u5efa\u7528\u65bc\u9a57\u8b49\u7684\u5bb9\u5668\u3002\u6b64\u8655\u50c5\u4ee5\u793a\u4f8b\u5f62\u5f0f\u63d0\u4f9b\u3002\n## \u5728\u61c9\u7528\u96c6\u7fa3\u4e0a\u904b\u884c\u9a57\u8b49\u5bb9\u5668\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u90e8\u7f72\u9a57\u8b49\u5728 Cloud Deploy [\u57f7\u884c\u74b0\u5883](https://cloud.google.com/deploy/docs/execution-environment?hl=zh-cn) \u4e2d\u904b\u884c\u3002\u60a8\u9084\u53ef\u4ee5\u5c07 Skaffold \u914d\u7f6e\u7232\u5728\u904b\u884c\u60a8\u7684\u61c9\u7528\u7684\u540c\u4e00\u96c6\u7fa3\u4e0a\u904b\u884c\u9a57\u8b49\u5bb9\u5668\u3002\u5728 `skaffold.yaml` \u4e2d\u914d\u7f6e\u96c6\u7fa3\u5167\u9a57\u8b49\u4e26\u5c0d\u76ee\u6a19\u5553\u7528\u9a57\u8b49\u6642\uff0c\u9a57\u8b49\u6703\u5728\u8a72\u76ee\u6a19\u7684\u96c6\u7fa3\u4e2d\u81ea\u52d5\u904b\u884c\u3002\n\u6b64\u529f\u80fd\u50c5\u9069\u7528\u65bc\u90e8\u7f72\u5230 GKE \u548c GKE Enterprise\uff0c\u4e0d\u9069\u7528\u65bc Cloud Run\u3002\u90e8\u7f72\u5230 Cloud Run \u7684\u64cd\u4f5c\u53ea\u80fd\u5728 Cloud Deploy \u57f7\u884c\u74b0\u5883\u4e2d\u904b\u884c\u9a57\u8b49\u3002\n\u96c6\u7fa3\u5167\u9a57\u8b49\u9700\u8981 [Skaffold \u7248\u672c 2.3 \u6216\u66f4\u9ad8\u7248\u672c](https://cloud.google.com/deploy/docs/using-skaffold/select-skaffold?hl=zh-cn#supported_versions) \u3002\n**\u6ce8\u610f** \uff1a\u5c0d\u65bc [\u4e26\u884c\u90e8\u7f72](https://cloud.google.com/deploy/docs/parallel?hl=zh-cn) \uff0c\u9a57\u8b49\u5728 [multi-target](https://cloud.google.com/deploy/docs/terminology?hl=zh-cn#multi-target) \u4e0a\u914d\u7f6e\uff0c\u9a57\u8b49\u5bb9\u5668\u5728\u6bcf\u500b [\u5b50\u76ee\u6a19](https://cloud.google.com/deploy/docs/terminology?hl=zh-cn#child_target) \u4e0a\u904b\u884c\u3002\n\u5982\u9700\u5728\u96c6\u7fa3\u4e0a\u904b\u884c\u9a57\u8b49\u5bb9\u5668\uff0c\u8acb\u5728 `skaffold.yaml` \u914d\u7f6e\u6587\u4ef6\u4e2d\u5728\u7279\u5b9a\u9a57\u8b49\u5bb9\u5668\u7684 `verify` \u7bc0\u5167\u6dfb\u52a0 `executionMode.kubernetesCluster` \u7bc0\uff1a\n```\nverify:- name:\u00a0 container:\u00a0 \u00a0 name:\u00a0 \u00a0 image:\u00a0 \u00a0 command:\u00a0 \u00a0 args:\u00a0 executionMode:\u00a0 \u00a0 kubernetesCluster:\n```\n**\u6ce8\u610f** \uff1a\u60a8\u9084\u53ef\u4ee5\u5728 `kubernetesCluster` \u4e0b\u6dfb\u52a0 `jobManifestPath` \u548c `overrides` \u5c6c\u6027\uff0c\u4ee5\u6307\u5411\u9a57\u8b49\u5bb9\u5668\u7684\u6e05\u55ae\u4ee5\u53ca\u8981\u66ff\u63db\u7684\u4efb\u4f55\u503c\u3002\uff08 `overrides` \u63a5\u53d7\u5305\u542b\u8981\u66ff\u63db\u7684\u503c\u7684 Kubernetes \u5167\u5d4c JSON\u3002\uff09 [\u77ad\u89e3\u8a73\u60c5](https://skaffold.dev/docs/verify/) \u3002\n\u4ee5\u4e0b\u662f\u5305\u542b `executionMode` \u7684\u9a57\u8b49\u7bc0\u793a\u4f8b\uff0c\u7528\u65bc\u8abf\u7528\u61c9\u7528\u96c6\u7fa3\u4e0a\u7684\u9a57\u8b49\u5bb9\u5668\uff1a\n```\nverify:- name: integration-test-container\u00a0 container:\u00a0 \u00a0 name: integration-test-container\u00a0 \u00a0 image: integration-test-container\u00a0 executionMode:\u00a0 \u00a0 kubernetesCluster: {}\n```\n`executionMode` \u7bc0\u662f\u53ef\u9078\u7684\uff0c\u5982\u679c\u7701\u7565\u5b83\uff0cSkaffold \u6703\u5728 Cloud Deploy \u57f7\u884c\u74b0\u5883\u4e2d\u904b\u884c\u9a57\u8b49\u5bb9\u5668\u3002\n## \u91cd\u65b0\u5617\u8a66\u9a57\u8b49\n\u5982\u679c\u9a57\u8b49\u4f5c\u696d\u5931\u6557\uff0c\u60a8\u53ef\u4ee5\u91cd\u8a66\u9a57\u8b49\uff0c\u5275\u5efa\u4e00\u500b\u65b0\u7684\u904b\u884c\u4f5c\u696d\uff1a\n```\ngcloud deploy rollouts retry-job ROLLOUT_NAME \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0--job-id=JOB_ID \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0--phase-id=PHASE_ID \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0--delivery-pipeline=PIPELINE_NAME \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0--release=RELEASE_NAME \\\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0--region=REGION\n```\n\u91cd\u8a66\u9a57\u8b49\u6703\u5c07\u767c\u4f48\u72c0\u614b\u5f9e `FAILED` \u66f4\u6539\u7232 `IN_PROGRESS` \u3002\n\u60a8\u53ea\u80fd\u7232\u9a57\u8b49\u4f5c\u696d\u5931\u6557\u7684\u767c\u4f48\u91cd\u65b0\u5617\u8a66\u9a57\u8b49\u3002\n## \u53ef\u7528\u7684\u74b0\u5883\u8b8a\u91cf\nCloud Deploy \u5728 `VERIFY` [\u57f7\u884c\u74b0\u5883](https://cloud.google.com/deploy/docs/execution-environment?hl=zh-cn) \u4e2d\u63d0\u4f9b\u4e26\u586b\u5145\u4ee5\u4e0b\u74b0\u5883\u8b8a\u91cf\uff0c\u4f9b\u60a8\u7528\u65bc\u6e2c\u8a66\uff1a\n- ANTHOS_MEMBERSHIP\u5c0d\u65bc `ANTHOS` \u985e\u578b\u7684\u76ee\u6a19\uff0cAnthos \u6210\u54e1\u8cc7\u683c\u7684\u5b8c\u5168\u6307\u5b9a\u8cc7\u6e90\u540d\u7a31\u3002\n- CLOUD_RUN_LOCATION\u5c0d\u65bc `RUN` \u985e\u578b\u7684\u76ee\u6a19\uff0c\u5c07\u5728\u5176\u4e2d\u90e8\u7f72 Cloud Run \u670d\u52d9\u7684\u5340\u57df\u3002\n- CLOUD_RUN_PROJECT\u5c0d\u65bc `RUN` \u985e\u578b\u7684\u76ee\u6a19\uff0c\u8868\u793a\u5728\u5176\u4e2d\u5275\u5efa Cloud Run \u670d\u52d9\u7684\u9805\u76ee\u3002\n- CLOUD_RUN_SERVICE\u5c0d\u65bc `RUN` \u985e\u578b\u7684\u76ee\u6a19\uff0c\u5247\u7232\u5df2\u90e8\u7f72\u7684 Cloud Run \u670d\u52d9\u7684\u540d\u7a31\u3002\n- CLOUD_RUN_SERVICE_URLS\u5c0d\u65bc `RUN` \u985e\u578b\u7684\u76ee\u6a19\uff0c\u5247\u7232\u6700\u7d42\u7528\u6236\u5c07\u7528\u65bc\u8a2a\u554f\u60a8\u7684\u670d\u52d9\u7684\u4e00\u500b\u6216\u591a\u500b\u7db2\u5740\uff08\u4ee5\u82f1\u6587\u9017\u865f\u5206\u9694\u7684\u5217\u8868\uff09\u3002\u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u76f8\u61c9\u670d\u52d9\u7684 Cloud Run \u670d\u52d9\u8a73\u7d30\u4fe1\u606f\u4e2d\u627e\u5230\u9019\u4e9b\u8a73\u7d30\u4fe1\u606f\u3002\n- CLOUD_RUN_REVISION\u5c0d\u65bc `RUN` \u985e\u578b\u7684\u76ee\u6a19\uff0c\u9019\u662f Cloud Run \u670d\u52d9\u7684\u7279\u5b9a\u4fee\u8a02\u7248\u672c\u3002\n- GKE_CLUSTER\u5c0d\u65bc `GKE` \u985e\u578b\u7684\u76ee\u6a19\uff0c\u5247\u7232 Google Kubernetes Engine \u96c6\u7fa3\u7684\u5b8c\u6574\u8cc7\u6e90\u540d\u7a31\uff0c\u4f8b\u5982 `projects/p/locations/us-central1/clusters/dev` \u3002\n- TARGET_TYPE\u76ee\u6a19\u7684\u5177\u9ad4\u904b\u884c\u6642\u985e\u578b\u3002\u53ef\u4ee5\u9078\u64c7 `GKE` \u3001 `ANTHOS` \u6216 `RUN` \u3002\n- CLOUD_DEPLOY_LOCATION\u904b\u884c\u57f7\u884c\u74b0\u5883\u7684\u5340\u57df\u3002\n- CLOUD_DEPLOY_DELIVERY_PIPELINE\u57f7\u884c\u74b0\u5883\u6b63\u5728\u904b\u884c\u7684 ID \u50b3\u9001\u6d41\u6c34\u7dda\u3002\n- CLOUD_DEPLOY_TARGET\u57f7\u884c\u74b0\u5883\u6b63\u5728\u904b\u884c\u7684\u76ee\u6a19\u7684 ID\u3002\n- CLOUD_DEPLOY_PROJECT\u904b\u884c\u57f7\u884c\u74b0\u5883\u7684 Google Cloud \u9805\u76ee\u7684\u7de8\u865f\u3002\n- CLOUD_DEPLOY_RELEASE\u5c07\u5728\u5176\u4e2d\u904b\u884c\u9a57\u8b49\u7684\u7248\u672c\u7684 ID\u3002\n- CLOUD_DEPLOY_ROLLOUT\u5305\u542b\u5f85\u9a57\u8b49\u4f5c\u696d\u7684\u767c\u4f48 ID\u3002\n- CLOUD_DEPLOY_JOB_RUN\u8868\u793a\u4f5c\u696d\u7576\u524d\u57f7\u884c\u7684 [\u4f5c\u696d\u904b\u884c](https://cloud.google.com/deploy/docs/deployment-strategies/manage-rollout?hl=zh-cn#jobs_and_job_runs) \u7684 ID\u3002\n- CLOUD_DEPLOY_PHASE\u5305\u542b\u5f85\u9a57\u8b49\u4f5c\u696d\u7684\u767c\u4f48 [\u968e\u6bb5](https://cloud.google.com/deploy/docs/deployment-strategies/manage-rollout?hl=zh-cn#phases) \u3002", "guide": "Cloud Deploy"}