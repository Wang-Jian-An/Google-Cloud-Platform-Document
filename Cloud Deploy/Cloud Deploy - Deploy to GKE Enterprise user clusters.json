{"title": "Cloud Deploy - Deploy to GKE Enterprise user clusters", "url": "https://cloud.google.com/deploy/docs/anthos-targets", "abstract": "# Cloud Deploy - Deploy to GKE Enterprise user clusters\nThis document describes how to deploy your applications to [GKE Enterprise clusters](/anthos/clusters/docs) . Support for GKE Enterprise targets enables deployment to AWS, Azure, and on-premises clusters.\nCloud Deploy lets you deploy your container-based workloads to any GKE Enterprise user cluster that you can access using [Connect](/anthos/multicluster-management/gateway/using) gateway.\n", "content": "## Before you begin\n- Have a GKE Enterprise user cluster that you will deploy to.This cluster can be one which you created as an GKE Enterprise user cluster, or you can [register an existing Kubernetes cluster](/anthos/multicluster-management/connect/registering-a-cluster) . Clusters which you create for GKE Enterprise automatically receive memberships. For existing clusters which you [register to a fleet](/anthos/multicluster-management/fleets) , you designate a membership name when registering. You will need this membership name for the target configuration.If you're using Google Cloud CLI version 407.0.0 or newer, you need to include the `--install-connect-agent` flag on the [gcloud container fleet memberships register command](https://cloud.google.com/sdk/gcloud/reference/container/fleet/memberships/register) , when you register a Google Kubernetes Engine cluster. The Connect agent is no longer installed by default.\n- Set up [Connect gateway](/anthos/multicluster-management/gateway/setup) to connect the registered cluster or clusters to Google Cloud.Be sure to set up the gateway using the same service account that will be used as the [Cloud Deploy execution service account](/deploy/docs/cloud-deploy-service-account#execution_service_account) . If you don't, then the execution service account won't have the necessary permissions to deploy to the GKE Enterprise cluster. **Note:** Enable [Workload Identity](/kubernetes-engine/docs/how-to/workload-identity) on the GKE clusters in order to set up Connect gateway.## Set up your Cloud Deploy to deploy to GKE Enterprise\n- Create your [target configuration](/deploy/docs/config-files) .The target can be configured in your delivery pipeline YAML, or can be in a separate file. Also, you can configure more than one target in the same file, but they must be in different `kind: Target` stanzas.\n- Grant the [execution service account](/deploy/docs/execution-environment) the [roles that it needs](/anthos/multicluster-management/gateway/setup#grant_roles_to_users) so that it can interact with connected clusters through the gateway.This grant is necessary whether you're using the default Cloud Deploy service account or a [custom service account](/deploy/docs/execution-environment#changing_from_the_default_to_custom_execution_service_account) .\n- [Set up RBAC](/anthos/multicluster-management/gateway/setup#configure_role-based_access_control_rbac_policies) for the [execution service account](/deploy/docs/execution-environment) on the Kubernetes cluster that underlies the Anthos cluster.\n- Optional: if the underlying cluster is not a GKE cluster, you might need to [configure an imagePullSecret](/artifact-registry/docs/access-control#pullsecrets) to allow your cluster to pull from Artifact Registry.\n- In the target definition, create an `anthosCluster` stanza to point to the GKE Enterprise cluster:The syntax for specifying an GKE Enterprise cluster is as follows:```\nanthosCluster:\u00a0membership: projects/[project_name]/locations/global/memberships/[membership_name]\n```This GKE Enterprise resource identifier uses the following elements:- [ `project_name` ] is the name of the Google Cloud project in which you're running this cluster.The cluster you're deploying to, including GKE Enterprise clusters, does need to be in the same project as your delivery pipeline.\n- [ `membership_name` ] is the name that you chose when [registering the cluster](/anthos/multicluster-management/connect/registering-a-cluster) to a fleet.\nFor `location` , all GKE Enterprise cluster memberships are `global` , so you don't need to change `/locations/global/` in this resource identifier.\nThe following is an example target configuration, pointing to an GKE Enterprise user cluster:\n```\n\u00a0 \u00a0 \u00a0 apiVersion: deploy.cloud.google.com/v1\u00a0 \u00a0 \u00a0 kind: Target\u00a0 \u00a0 \u00a0 metadata:\u00a0 \u00a0 \u00a0 \u00a0name: qsdev\u00a0 \u00a0 \u00a0 description: development cluster\u00a0 \u00a0 \u00a0 anthosCluster:\u00a0 \u00a0 \u00a0 \u00a0membership: projects/my-app/locations/global/memberships/my-app-dev-cluster\n```\n## What's next\n- Learn more about [configuring Cloud Deploy targets](/deploy/docs/config-files#target_definitions) \n- Learn about Cloud Deploy [execution environments](/deploy/docs/execution-environment) .\n- Learn more about [GKE Enterprise](/anthos/docs) \n- Learn more about [Connect gateway](/anthos/multicluster-management/gateway) .", "guide": "Cloud Deploy"}