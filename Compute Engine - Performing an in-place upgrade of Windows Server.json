{"title": "Compute Engine - Performing an in-place upgrade of Windows\u00a0Server", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Performing an in-place upgrade of Windows\u00a0Server\nIf you have virtual machine (VM) instances running earlier versions of Windows Server, you can upgrade them to later versions of Windows\u00a0Server:\n| Upgrade from        | Upgrade to                   |\n|:--------------------------------------------|:-----------------------------------------------------------------------------------|\n| Windows\u00a0Server 2008 R2 (Desktop Experience) | Windows\u00a0Server 2012 R2 (Desktop Experience)          |\n| Windows\u00a0Server 2012 R2 (Core)    | Windows\u00a0Server 2016 (Core) Windows\u00a0Server 2019 (Core)        |\n| Windows\u00a0Server 2012 R2 (Desktop Experience) | Windows\u00a0Server 2016 (Desktop Experience) Windows\u00a0Server 2019 (Desktop Experience) |\n| Windows\u00a0Server 2016 (Core)     | Windows\u00a0Server 2019 (Core) Windows\u00a0Server 2022 (Core)        |\n| Windows\u00a0Server 2016 (Desktop Experience) | Windows\u00a0Server 2019 (Desktop Experience) Windows\u00a0Server 2022 (Desktop Experience) |\n| Windows\u00a0Server 2019 (Core)     | Windows\u00a0Server 2022 (Core)               |\n| Windows\u00a0Server 2019 (Desktop Experience) | Windows\u00a0Server 2022 (Desktop Experience)           |\nThis guide describes how to perform a manual in-place upgrade of Windows Server. For upgrades from Windows Server 2008 R2 to Windows Server 2012 R2, you can also perform [automated in-place upgrades by using the Google Cloud CLI](/compute/docs/tutorials/performing-an-automated-in-place-upgrade-windows-server) .\nUpgrades are subject to the following constraints:- Microsoft has [ended support for Windows Server 2012 R2](https://learn.microsoft.com/en-us/lifecycle/announcements/windows-server-2012-r2-end-of-support) and [Windows Server 2008 R2](https://support.microsoft.com/en-us/help/4456235/end-of-support-for-windows-server-2008-and-windows-server-2008-r2) . If you perform an in-place upgrade of either of these versions and encounter problems related to the Windows Setup process ( `setup.exe` ), Google might only be able to provide limited assistance.\n- If you plan to upgrade Windows Server 2008 R2 to a version later than Windows Server 2012 R2, you must first perform an upgrade to Windows Server 2012 R2, and then perform a second upgrade to Windows Server 2016 or later.\n **Important:** This guide only describes how to perform an in-place upgrade from Datacenter editions of Windows Server to Datacenter editions of Windows Server.", "content": "## ObjectivesThis guide describes how to perform an in-place upgrade of Windows Server by:- Planning the in-place upgrade\n- Performing the in-place upgrade\n- Troubleshooting the in-place upgrade\n- Cleaning up after the in-place upgrade\n## CostsThere is no charge for performing an in-place upgrade of Windows Server. You are only charged for the resources consumed during the upgrade, including:- [Compute Engine](/compute) \nUse the [pricing calculator](/products/calculator#id=beb5326f-90c3-4842-9c3f-%0Aa3761b40fbe3) to generate a cost estimate based on your projected usage.## Before you beginThe guide assumes that you have basic knowledge of:- [Compute Engine](/compute) \n- [Performing unattended Windows Serverinstallations by using Windows\u00a0Setup](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/automate-windows-setup) .\n## Plan the in-place upgradePerforming an in-place upgrade of a virtual machine (VM) instance that is running an earlier version of Windows\u00a0Server can be a pragmatic way to modernize your infrastructure and to mitigate the risks of approaching the end of the support lifecycle of Windows Server versions.\n### Alternatives to considerBefore you decide to use an in-place upgrade to migrate to a newer version of Windows\u00a0Server, be aware of the following limitations:- **Downtime:** Depending on the configuration and software installed, the upgrade might take an hour or longer. During the upgrade, access to the VM instance is limited because:- Workloads running on the VM instance are unavailable to users\n- Remote Desktop Protocol (RDP) is not available\n- There are limited ways to check the upgrade progress and the time remaining in the upgrade\n- **Risk:** Depending on the configurations of your existing instances and the installed software:- The upgrade can fail\n- Some configuration options can be overridden\n- Incompatibilities can cause your workload to malfunction on the upgraded instance\nDepending on the workload running on your Windows Server instance, you can reduce downtime and risk by pursuing different approaches.\n| Workload                              | Approach                                                                   |\n|:-----------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Your VM instance is running a workload that supports replication, such as: Active Directory Domain Services DNS SQL Server | Consider setting up a new VM instance that is running a more recent version of Windows\u00a0Server, and then use replication to shift the workload from your existing VM instance to the new VM instance.                   |\n| You have a VM instance that is running a multitude of workloads                | Consider migrating these workloads to separate VM instances so that each VM instance runs only a single workload. Even if you can't migrate all workloads, reducing the number of workloads running on a single VM instance can help reduce risks during an in-place upgrade. |\n### Product keysA Windows\u00a0Server product key is valid for only a specific version; when you perform an upgrade to a later version of Windows\u00a0Server, you must supply a new product key. There are two primary scenarios:- **You are upgrading a VM instance that is based on apublic operating system image provided by Google:** In this scenario, you must use the predefined [KMS client setup keys](https://docs.microsoft.com/en-us/windows-server/get-started/kmsclientkeys#earlier-versions-of-windows-server) for the version of Windows Server that you are upgrading to. The upgrade does not incur additional charges.\n- **You are upgrading a VM instance for which youbrought an existing license:** In [BYOL](/compute/docs/instances/windows/bring-your-own-license) , you need to acquire a product key from your license vendor to perform the upgrade. [Check the Microsoft documentation](https://docs.microsoft.com/en-us/windows-server/get-started/installation-and-upgrade#upgrading-to-windows-server-2012) to determine which edition you can upgrade to and whether you are eligible for license conversion.\n### Installation mediaTo perform the upgrade, you need an installation media. There are two primary scenarios:- **You are upgrading a VM instance that is based on apublic operating system image provided by Google:** In this scenario, you can use the volume license installation media provided by Google. The steps to access this installation media are [provided below](#attach_the_install_media) .\n- **You are upgrading a VM instance that is based on an imported disk or image:** In this scenario, you cannot use the installation media provided by Google. Instead, you have to use an installation media that matches the type of media that you used to install Windows Server on the imported disk or image. **Important:** If you use a custom install media to upgrade to Windows Server 2012 R2, make sure to [disable animations](https://mskb.pkisolutions.com/kb/2955372) before using it to perform an upgrade. Disabling animations is critical to prevent the `MSOOBE` process from causing the upgrade to stop responding indefinitely.\n### Other prerequisitesBefore you begin your upgrade, review the Microsoft documentation about prerequisites and potential limitations for the version of Windows Server you are planning to upgrade to:\n- Verify that your VM instance meets the [system requirements for Windows Server 2012](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134246(v%3Dws.11)#system-requirements) and has [sufficient free disk space](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134246(v%3Dws.11)#disk-space-requirements) .\n- Review [recommendations for upgrading serverroles](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ff972408(v=ws.10)#upgrading-server-roles) , [known issues](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ff972310(v=ws.10)) , and the [upgrade process](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ff972309(v=ws.10)) for Windows Server 2012 R2.\n- Review the [recommendations for planning an in-placeupgrade](https://www.microsoft.com/upgradecenter/scenario/WS2008R2-on-prem-to-WS2012) .\n- Verify that you aren't affected by [featuresremoved or deprecated](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn303411(v=ws.11)) in Windows Server 2012 R2.\n- Verify that any of your custom or third-party software is compatible with Windows Server 2012 R2.\n- Verify that your VM instance meets the [system requirements for Windows Server 2016](https://docs.microsoft.com/en-us/windows-server/get-started/system-requirements) and has [sufficient free disk space](https://docs.microsoft.com/en-us/windows-server/get-started/system-requirements#storage-controller-and-disk-space-requirements) .\n- Review the [server role upgrade and migration matrix for Windows Server 2016](https://docs.microsoft.com/en-us/windows-server/get-started/server-role-upgradeability-table) and [application compatibility table](https://docs.microsoft.com/en-us/windows-server/get-started/server-application-compatibility) \n- Verify that you aren't affected by [featuresremoved or planned for replacement](https://docs.microsoft.com/en-us/windows-server/get-started/deprecated-features) in Windows Server 2016.\n- Verify that any of your custom or third-party software is compatible with Windows Server 2016.\n- Verify that your VM instance meets the [system requirements for Windows Server 2019](https://docs.microsoft.com/en-us/windows-server/get-started-19/sys-reqs-19) and has [sufficient free disk space](https://docs.microsoft.com/en-us/windows-server/get-started-19/sys-reqs-19#storage-controller-and-disk-space-requirements) .\n- Review the [Windows Server 2019 and Microsoft Server application compatibility](https://docs.microsoft.com/en-us/windows-server/get-started-19/app-compat-19) list.\n- Verify that you aren't affected by [featuresremoved or planned for replacement](https://docs.microsoft.com/en-us/windows-server/get-started-19/removed-features-19) in Windows Server 2019.\n- Verify that any of your custom or third-party software is compatible with Windows Server 2019.\n- Verify that your VM instance meets the [system requirements for Windows Server 2022](https://docs.microsoft.com/en-us/windows-server/get-started/hardware-requirements) and has [sufficient free disk space](https://docs.microsoft.com/en-us/windows-server/get-started/hardware-requirements#storage-controller-and-disk-space-requirements) .\n- Review the [Windows Server 2022 and Microsoft Server application compatibility](https://docs.microsoft.com/en-us/windows-server/get-started/application-compatibility-windows-server-2022) list.\n- Verify that you aren't affected by [featuresremoved or planned for replacement](https://docs.microsoft.com/en-us/windows-server/get-started/removed-deprecated-features-windows-server-2022) in Windows Server 2022.\n- Verify that any of your custom or third-party software is compatible with Windows Server 2022.\n## Perform the in-place upgradeThe following sections guide you through the process of upgrading your VM instance.\n### Create a snapshotBefore you start the upgrade, we recommend that you [create a snapshot of yourVM instance](https://cloud.google.com/compute/docs/disks/create-snapshots#creating_snapshots) , so that you can revert to a safe state in case anything goes wrong:- Create a [regular snapshot](/compute/docs/instances/windows/creating-windows-persistent-disk-snapshot#create_the_snapshot) for the boot disk of your VM instance.\n- If the VM instance has additional data disks attached, create snapshots for the data disks by using [the Volume Shadow Copy Service (VSS)](/compute/docs/instances/windows/creating-windows-persistent-disk-snapshot#create-snapshot) .\n### Prepare your Windows\u00a0Server configurationVerify the configuration of your Windows Server VM instance:- [Connect to your VM instance](/compute/docs/instances/connecting-to-windows#windows_gui) with an RDP client.\n- Verify that Windows\u00a0Server is up to date [by using Windows Update](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731322(v=ws.11)#downloading-and-installing-updates) .\n- Disable or uninstall antivirus, antispyware, and other agents that can interfere with the upgrade or are incompatible with the Windows Server version that you're upgrading to.\n### Attach the install mediaBefore you can perform the upgrade, attach the necessary installation media to the VM instance. The right media to use depends on your scenario:- **You are upgrading a VM instance that is based on a public operating system\nimage provided by Google:** In this scenario, you only need to attach the volume license installation media provided by Google. This media contains both the necessary scripts to run the upgrade and the files for the new version of Windows Server.\n- **You are upgrading a VM instance that is based on an imported disk or image:** In this scenario, you also need to attach the volume license installation media provided by Google so that you can access the necessary scripts.Additionally, you have to attach a custom installation media that matches the type of media that you used to install Windows Server on the imported disk or image.\nTo attach the volume license installation media provided by Google, follow these steps:- In the Google Cloud console, open [Cloud Shell](/shell/docs/starting-cloud-shell) by clicking the **Activate Cloud Shell** button. [Go to the Google Cloud console](https://console.cloud.google.com/) \n- Set the default project ID. Replace `` with the name of your Compute Engine project:```\ngcloud config set project PROJECT_ID\n```\n- Create a disk based on the installation media. Replace `` with the name of the zone where the VM is located:```\ngcloud compute disks create win-installers --image-family=windows-install-media --image-project=compute-image-tools --zone=ZONE\n```This command adds a disk named `win-installers` to your project. This disk is not attached to any VM instance.\n- Attach the disk to your VM by using read-only ( `ro` ) mode, so that you can attach the disk to multiple VMs if necessary:```\ngcloud compute instances attach-disk VM_NAME --disk=win-installers --mode=ro --zone=ZONE\n```Replace the following:- ``: the name of the VM instance to upgrade\n- ``: the name of the zone where the VM is located\nYou can use the same disk for multiple and parallel VM upgrades within the same zone, but if you want to upgrade a VM in a different zone, you must create another disk in that zone.\nIf you are upgrading a VM that is based on an imported disk or image, attach the custom installation media as an additional disk:- Follow the steps in [Creating an image from an ISO file](https://cloud.google.com/compute/docs/images/creating-an-image-from-an-iso-file) to create a disk from the ISO image that you want to use as custom installation media.\n- Attach the disk to your VM, by using read-only ( `ro` ) mode so that you can attach the disk to multiple VMs if necessary:```\ngcloud compute instances attach-disk VM_NAME --disk=CUSTOM_MEDIA_DISK --mode=ro --zone=ZONE\n```Replace the following:- ``: the name of the VM to upgrade\n- ``: the name of the disk containing your custom installation media\n- ``: the name of the zone where the VM is located\n### Start the upgradeBy default, Windows Setup prompts you for input at various points during an upgrade. Because you can't connect to the VM by using RDP during the upgrade and therefore can't provide any input, run the upgrade in [unattended mode](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/automate-windows-setup) .- Connect to your VM with an RDP client. For more information, see [Connecting to instances](/compute/docs/instances/connecting-to-windows) .\n- Open an elevated command prompt:- If you use Server Core, an elevated command prompt should open automatically after login.\n- If you use Windows Server with full Desktop Experience, right-click the **Start** button and select **Command Prompt (Admin)** .\n- Change the working directory to the installation media. The correct working directory depends on the Windows Server version that you are upgrading to:\n```\ncd /d d:\\*2012*\n```\n```\ncd /d d:\\*2016*\n```\n```\ncd /d d:\\*2019*\n```\n```\ncd /d d:\\*2022*\n```\n **Important:** Adjust the drive letter if Windows assigned a different letter than `D:` to the disk containing the volume license installation media provided by Google.\n- Start the Windows upgrade. The required steps to start the upgrade depend on the Windows Server version that you are upgrading to and whether your VM is based on a public operating system image or on an imported disk or image:\nRun `upgrade.ps1` to start the Windows upgrade. The script completes the following steps:- Install the latest [Google driver packages](https://github.com/GoogleCloudPlatform/compute-windows-drivers) , which are critical for the Windows\u00a0Server upgrade to succeed.\n- Apply Windows settings that are required for [Compute Engine](/compute/docs/images#windows_server) .\n- Enable access to the [Emergency Management Services (EMS) console](/compute/docs/troubleshooting/troubleshooting-windows#connectems) during the upgrade.\n- Launch Windows Setup (`setup.exe`) from the install media to perform an upgrade in unattended mode.\n- Selects the correct edition of Windows Server 2012 R2 to install.\n- Provides the Generic Volume License Key (GVLK) for the new version of Windows Server.\n```\npowershell -ExecutionPolicy Bypass -File upgrade.ps1\n```\nRun `upgrade.ps1` to start the Windows upgrade. The script completes the following steps:- Install the latest [Google driver packages](https://github.com/GoogleCloudPlatform/compute-windows-drivers) , which are critical for the Windows\u00a0Server upgrade to succeed.\n- Apply Windows settings that are required for [Compute Engine](/compute/docs/images#windows_server) .\n- Enable access to the [Emergency Management Services (EMS) console](/compute/docs/troubleshooting/troubleshooting-windows#connectems) during the upgrade.\n- Launch Windows Setup (`setup.exe`) from the install media to perform an upgrade in unattended mode.\n- Selects the correct edition of Windows Server 2012 R2 to install.\n- Provides the user provided license key for the new version of Windows Server.\n```\npowershell -ExecutionPolicy Bypass -File upgrade.ps1 -SetupExePath SETUP_PATH -ProductKey PRODUCT_KEY\n```\nReplace the following:- ``: the path to`setup.exe`on your custom installation media\n- ``: a valid product key for Windows Server 2016.\nThe `-ProductKey` parameter is only required if you are upgrading a VM instance for which you brought an existing license (BYOL)\nRun `upgrade.ps1` to start the Windows upgrade. The script completes the following steps:- Install the latest [Google driver packages](https://github.com/GoogleCloudPlatform/compute-windows-drivers) , which are critical for the Windows\u00a0Server upgrade to succeed.\n- Apply Windows settings that are required for [Compute Engine](/compute/docs/images#windows_server) .\n- Enable access to the [Emergency Management Services (EMS) console](/compute/docs/troubleshooting/troubleshooting-windows#connectems) during the upgrade.\n- Launch Windows Setup (`setup.exe`) from the install media to perform an upgrade in silent mode.\n- Provide a product key for the new version of Windows Server.\n```\npowershell -ExecutionPolicy Bypass -File upgrade.ps1\n```\nIn some cases, Windows Setup might show a **Select Image** screen. If you see this screen, select the configuration that matches your current configuration:- If you currently use Server Core, select **Datacenter** .\n- If you currently use Windows Server with full desktop experience, select **Datacenter (Desktop Experience)** .\n- Click **Next** to begin the upgrade.\nIt might take several minutes for the setup to initialize.\nRun `upgrade.ps1` to start the Windows upgrade. The script completes the following steps:- Install the latest [Google driver packages](https://github.com/GoogleCloudPlatform/compute-windows-drivers) , which are critical for the Windows\u00a0Server upgrade to succeed.\n- Apply Windows settings that are required for [Compute Engine](/compute/docs/images#windows_server) .\n- Enable access to the [Emergency Management Services (EMS) console](/compute/docs/troubleshooting/troubleshooting-windows#connectems) during the upgrade.\n- Launch Windows Setup (`setup.exe`) from the install media to perform an upgrade in silent mode.\n```\npowershell -ExecutionPolicy Bypass -File upgrade.ps1 -SetupExePath SETUP-PATH -ProductKey PRODUCT-KEY\n```\nReplace the following:- ``: the path to`setup.exe`on your custom installation media\n- ``: a valid product key for the version of Windows Server that is being upgraded to. For example, if upgrading from Windows Server 2016 Datacenter to Windows Server 2019 Datacenter, provide a valid Windows Server 2019 Datacenter key.\nThe `-ProductKey` parameter is only required if you are upgrading a VM instance for which you brought an existing license (BYOL).\nIn some cases, Windows Setup might show a **Select Image** screen. If you see this screen, select the configuration that matches your current configuration:- If you currently use Server Core, select **Windows Server Datacenter** .\n- If you currently use Windows Server with full desktop experience, select **Windows Server Datacenter (Desktop Experience)** .\n- Click **Next** to begin the upgrade.\nIt might take several minutes for the setup to initialize.\nThe upgrade process might issue the following warning. If so, you can ignore it:```\n[package name] or a newer version is already installed on the system\n```The system can become temporarily unresponsive while installing the `netkvm` driver. If this happens, don't close the RDP connection or stop the VM instance unless the system is unresponsive for more than 5 minutes. If you do lose RDP connectivity, wait approximately 5 minutes before you reconnect to the VM instance.The Setup Wizard might require you to restart the system first. In this case, restart the VM instance and run Windows Setup again, using the same command.After about 5 minutes, the machine reboots, and RDP disconnects.\n### Observe the upgrade processDepending on the machine type of your VM instance and your Windows\u00a0Server configuration, the upgrade might take between 10 and 60 minutes to complete. During that time, you can observe the status through the [serial port output](/compute/docs/instances/viewing-serial-port-output) :- In Cloud Shell, observe the boot process by running the following command:```\ngcloud compute instances tail-serial-port-output VM_NAME --zone=ZONE\n```Replace the following:- ``: name of your VM instance\n- ``: name of the zone where the VM instance is located\n- Wait until the machine has rebooted four times. Depending on the configuration of your VM instance, it might take 30 minutes or more for these reboots to occur. You can recognize a reboot by output that looks similar to this:```\nSeaBIOS (version 1.8.2-20190620_103534-google)\nTotal RAM Size = 0x00000001e0000000 = 7680 MiB\nCPUs found: 2  Max CPUs supported: 2\n```\n- After the fourth reboot, wait until the output `GCEMetadataScripts: Finished running startup scripts` or `No startup scripts to run` appears.\n### Perform post-upgrade stepsYou can now connect to the VM instance to verify that the upgrade has been successfully completed.- Connect to the VM instance by using an RDP client. For more information, see [Connecting to instances](/compute/docs/instances/connecting-to-windows) .\n- Log in using a user account with local administrator privileges.\n- Open an elevated command prompt:- If you use Server Core, an elevated command prompt should open automatically after login.\n- If you use Windows Server with full desktop experience, right-click the **Start** button and select **Command Prompt (Admin)** .\n- Run the following command to query the version of Windows Server:\n```\nver\n```\n```\nwinver\n```\nVerify that the version matches the expected version of Windows Server.\n- Change the working directory to the installation media. The correct working directory depends on the Windows Server version that you are upgrading to:\n```\ncd /d d:\\*2012*\n```\n```\ncd /d d:\\*2016*\n```\n```\ncd /d d:\\*2019*\n```\n```\ncd /d d:\\*2022*\n```\n **Important:** Adjust the drive letter if Windows assigned a different letter than `D:` to the disk containing the volume license installation media provided by Google.\n- Run `upgrade.ps1` again to re-apply specific Compute Engine settings that might have been lost during the upgrade:```\npowershell -ExecutionPolicy Bypass -File upgrade.ps1\n```\n- Restart the VM instance to ensure all changes take effect. It might take 1 to 2 minutes for the reboot to complete before you can connect to the VM instance again.\n### Detach the installation diskYou can now detach the installation disk from the VM instance:- In Cloud Shell, detach the installation disk from your VM instance, replacing `` with the name of your VM instance:```\ngcloud compute instances detach-disk VM_NAME --disk=win-installers\n```\n### Install updates and restore access\nAfter the upgrade is complete, run Windows Update to download and install any security updates. To install the security updates, follow these steps:\n- Connect to the machine by using an RDP client. For more information, see [Connecting to instances](/compute/docs/instances/connecting-to-windows) .\n- Use Windows Update to [install the latest Windows updates](https://support.microsoft.com/en-us/help/12373/windows-update-faq) . You might have to restart the VM instance multiple times during this process.\n- Re-enable any agents, antivirus, or antimalware software that you disabled before the upgrade.\n## Troubleshoot the in-place upgradeWhile running Windows Setup, you can't connect to the VM instance with RDP. If you suspect that the upgrade failed or is not progressing, use the following approaches, in order, to diagnose the situation:\n### Check the serial port outputTo check the progress of the upgrade process, view the [serial port output](/compute/docs/instances/viewing-serial-port-output) of the VM instance:- Serial port 1 captures the boot status\n- Serial port 3 captures the log output of Windows Setup\nDuring the upgrade, you should observe four reboots. If you don't observe any progress for more than 30 minutes after the first reboot, it is likely that the upgrade failed.\n### Check CPU and I/O metricsRunning a Windows\u00a0Server upgrade is a CPU and disk I/O intensive operation. By checking the CPU and I/O metrics, you can get an indication for whether the setup is progressing.\nView the CPU and I/O metrics in the Google Cloud console:- In the Google Cloud console, go to the **VM instances** page. [Go to VM instances](https://console.cloud.google.com/compute/instances) \n- Click the instance that you're upgrading.\n- Click the **Monitoring** tab.\n### Connect to the Emergency Management Services consoleBoth during and after running Windows Setup, you can connect to the [Emergency Management Services (EMS) console](/compute/docs/troubleshooting/troubleshooting-windows#connectems) . Using the EMS console, check the [Windows Setup log files](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/deployment-troubleshooting-and-log-files#windows-%0Asetup-scenario) and the [event log](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-eventlog?view=powershell-5.1) for indications that the upgrade is still progressing or for information about any errors that might have occurred.\n### Connect remotely by using WinRMIf connecting by using RDP or EMS fails, you can try using WinRM to establish a remote PowerShell session:- Connect to a different Windows\u00a0Server instance in the same VPC.\n- Open PowerShell.\n- Establish a remote PowerShell session, replacing `` with the name of the instance to upgrade:```\nEnter-PSSession -ComputerName VM_NAME -UseSSL -SessionOption (New-PsSessionOption -SkipCACheck) -Credential (Get-Credential)\n```\n- When prompted for credentials, enter the username and password of an administrative user account.\n- Use the remote PowerShell session to check the [Windows Setup log files](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/deployment-troubleshooting-and-log-files#windows-setup-scenario) and the [event log](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-eventlog?view=powershell-5.1) .\n### Analyze log files offlineIf you can't connect to the instance by using Windows Remote Management (WinRM), you can cancel the upgrade and analyze the log files from a different VM instance. To do this, follow these steps:- [Stop the VM instance](/compute/docs/instances/stop-start-instance) .This can take several minutes if Windows\u00a0Server is unresponsive.\n- [Detach the boot disk](/compute/docs/disks/detach-reattach-boot-disk#detach_disk) from the instance.\n- Create a new, temporary Windows Server instance, and attach the boot disk of the original instance as an additional disk.\n- Use the temporary Windows Server instance to analyze the [setup log and event log files](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/windows-setup-log-files-and-event-logs) of the instance that you were trying to upgrade.\n- After you have completed the analysis, detach the disk from the temporary instance and [reattach it as a boot disk](/compute/docs/disks/detach-reattach-boot-disk#attach_disk) to the original VM instance.\n### Troubleshoot RDPFor information about troubleshooting RDP, see [Troubleshooting RDP](/compute/docs/troubleshooting/troubleshooting-rdp) .\n### Troubleshoot your Windows Server instancesFor information about troubleshooting your Windows\u00a0Server instances, see [Tips and troubleshooting for Windows instances](/compute/docs/troubleshooting/troubleshooting-windows) .## Clean upTo avoid incurring further costs after you have completed this process, delete the installation disk.\n### Delete the installation diskYou can create an installation disk based on the Google-provided image at any time. If you don't plan to upgrade more VM instances in the same zone, delete the installation disk:- In Cloud Shell, delete the `win-installers` disk that you created earlier:```\ngcloud compute disks delete win-installers\n```\n## What's next\n- Learn how to [bring existing licenses to Compute Engine](/compute/docs/instances/windows/bring-your-own-license) .\n- Learn how to [connect to Windows instances](/compute/docs/instances/connecting-to-windows) .\n- Learn about [sole-tenant nodes on Compute Engine](/compute/docs/nodes) .\n- Work through more [Windows tutorials](/compute/docs/tutorials#windows) .", "guide": "Compute Engine"}