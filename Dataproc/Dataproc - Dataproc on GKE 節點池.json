{"title": "Dataproc - Dataproc on GKE \u7bc0\u9ede\u6c60", "url": "https://cloud.google.com/dataproc/docs/guides/dpgke/dataproc-gke-nodepools?hl=zh-cn", "abstract": "# Dataproc - Dataproc on GKE \u7bc0\u9ede\u6c60\n[\u5275\u5efa](https://cloud.google.com/dataproc/docs/guides/dpgke/quickstarts/dataproc-gke-quickstart-create-cluster?hl=zh-cn) \u6216 [\u66f4\u65b0](https://cloud.google.com/dataproc/docs/guides/dpgke/dataproc-gke-recreate-cluster?hl=zh-cn) Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u6642\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u4e00\u500b\u6216\u591a\u500b\u7bc0\u9ede\u6c60\uff0c\u4f9b\u865b\u64ec\u96c6\u7fa3\u7528\u65bc\u904b\u884c\u4f5c\u696d\uff08\u6b64\u96c6\u7fa3\u7a31\u7232\u201c\u7531\u6307\u5b9a\u7bc0\u9ede\u6c60\u4f7f\u7528\u201d\u6216\u201c\u95dc\u806f\u201d\u7684\u96c6\u7fa3\uff09\u3002\u5982\u679c\u60a8\u7684 GKE \u96c6\u7fa3\u4e2d\u4e0d\u5b58\u5728\u6307\u5b9a\u7684\u7bc0\u9ede\u6c60\uff0cDataproc on GKE \u5c07\u4f7f\u7528\u60a8\u6307\u5b9a\u7684\u8a2d\u7f6e\u5728 GKE \u96c6\u7fa3\u4e0a\u5275\u5efa\u7bc0\u9ede\u6c60\u3002\u5982\u679c\u7bc0\u9ede\u6c60\u5b58\u5728\u4e26\u4e14\u662f\u7531 Dataproc \u5275\u5efa\u7684\uff0c\u5247\u7cfb\u7d71\u5c07\u5c0d\u5176\u9032\u884c\u9a57\u8b49\uff0c\u4ee5\u78ba\u8a8d\u5176\u8a2d\u7f6e\u8207\u6307\u5b9a\u8a2d\u7f6e\u5339\u914d\u3002\n#", "content": "## Dataproc on GKE \u7bc0\u9ede\u6c60\u8a2d\u7f6e\n\u60a8\u53ef\u4ee5\u5c0d Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u4f7f\u7528\u7684\u7bc0\u9ede\u6c60\u6307\u5b9a\u4ee5\u4e0b [\u8a2d\u7f6e](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters?hl=zh-cn#gkenodeconfig) \uff08\u9019\u4e9b\u8a2d\u7f6e\u662f [GKE \u7bc0\u9ede\u6c60\u8a2d\u7f6e](https://cloud.google.com/kubernetes-engine/docs/reference/rest/v1/NodeConfig?hl=zh-cn) \u7684\u4e00\u90e8\u5206\uff09\uff1a\n- `accelerators`\n- `acceleratorCount`\n- `acceleratorType`\n- `gpuPartitionSize`*\n- `localSsdCount`\n- `machineType`\n- `minCpuPlatform`\n- `minNodeCount`\n- `maxNodeCount`\n- `preemptible`\n- `spot`*\n\u5099\u8a3b\uff1a\n- \u53ef\u4ee5\u5728 Dataproc API [GkeNodePoolAcceleratorConfig](https://cloud.google.com/dataproc/docs/reference/rest/v1/GkeClusterConfig?hl=zh-cn#gkenodepoolacceleratorconfig) \u4e2d\u8a2d\u7f6e`gpuPartitionSize`\u3002\n- \u60a8\u53ef\u4ee5\u5728 Dataproc API [GkeNodeConfig](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters?hl=zh-cn#gkenodeconfig) \u4e2d\u8a2d\u7f6e`spot`\u3002## \u522a\u9664\u7bc0\u9ede\u6c60\n\u522a\u9664 Dataproc on GKE \u96c6\u7fa3\u6642\uff0c\u8a72\u96c6\u7fa3\u4f7f\u7528\u7684\u7bc0\u9ede\u6c60\u4e0d\u6703\u88ab\u522a\u9664\u3002\u8acb\u53c3\u95b1 [\u522a\u9664\u7bc0\u9ede\u6c60](https://cloud.google.com/kubernetes-engine/docs/how-to/node-pools?hl=zh-cn#deleting_a_node_pool) \u4ee5\u522a\u9664 Dataproc on GKE \u96c6\u7fa3\u4e0d\u518d\u4f7f\u7528\u7684\u7bc0\u9ede\u6c60\u3002\n## \u7bc0\u9ede\u6c60\u4f4d\u7f6e\n\u60a8\u53ef\u4ee5\u5728\u5275\u5efa\u6216\u66f4\u65b0\u865b\u64ec\u96c6\u7fa3\u6642\uff0c\u6307\u5b9a\u8207 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u95dc\u806f\u7684\u7bc0\u9ede\u6c60\u7684 [\u53ef\u7528\u5340](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters?hl=zh-cn#GkeNodePoolConfig.FIELDS.locations) \u4f4d\u7f6e\u3002\u7bc0\u9ede\u6c60\u5340\u57df\u5fc5\u9808\u4f4d\u65bc\u95dc\u806f\u865b\u64ec\u96c6\u7fa3\u7684\u5340\u57df\u4e2d\u3002\n## \u89d2\u8272\u5230\u7bc0\u9ede\u6c60\u7684\u6620\u5c04\n\u6211\u5011\u7232 Spark \u9a45\u52d5\u7a0b\u5e8f\u548c\u57f7\u884c\u7a0b\u5e8f\u5de5\u4f5c\u5b9a\u7fa9\u4e86\u7bc0\u9ede\u6c60 [\u89d2\u8272](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters?hl=zh-cn#Role) \uff0c\u4f75\u7232\u7bc0\u9ede\u6c60\u7232\u6240\u6709\u985e\u578b\u7684\u5de5\u4f5c\u5b9a\u7fa9\u4e86\u4e00\u500b\u9ed8\u8a8d\u89d2\u8272\u3002Dataproc on GKE \u96c6\u7fa3\u5fc5\u9808\u81f3\u5c11\u6709\u4e00\u500b\u5206\u914d\u4e86 `default` \u89d2\u8272\u7684\u7bc0\u9ede\u6c60\u3002\u60a8\u53ef\u4ee5\u9078\u64c7\u5206\u914d\u5176\u4ed6\u89d2\u8272\u3002\n**\u5efa\u8b70** \uff1a\u7232\u6bcf\u500b\u89d2\u8272\u985e\u578b\u5275\u5efa\u55ae\u7368\u7684\u7bc0\u9ede\u6c60\uff0c\u7bc0\u9ede\u985e\u578b\u548c\u5927\u5c0f\u53d6\u6c7a\u65bc\u89d2\u8272\u8981\u6c42\u3002\ngcloud CLI \u865b\u64ec\u96c6\u7fa3\u5275\u5efa\u793a\u4f8b\uff1a\n```\ngcloud dataproc clusters gke create \"${DP_CLUSTER}\" \\\n\u00a0\u00a0--region=${REGION} \\\n\u00a0\u00a0--gke-cluster=${GKE_CLUSTER} \\\n\u00a0\u00a0--spark-engine-version=latest \\\n\u00a0\u00a0--staging-bucket=${BUCKET} \\\n\u00a0\u00a0--pools=\"name=${DP_POOLNAME},roles=default \\\n\u00a0\u00a0--setup-workload-identity\n\u00a0\u00a0--pools=\"name=${DP_CTRL_POOLNAME},roles=default,machineType=e2-standard-4\" \\\n\u00a0\u00a0--pools=\"name=${DP_DRIVER_POOLNAME},min=1,max=3,roles=spark-driver,machineType=n2-standard-4\" \\\n\u00a0\u00a0--pools=\"name=${DP_EXEC_POOLNAME},min=1,max=10,roles=spark-executor,machineType=n2-standard-8\"\n```", "guide": "Dataproc"}