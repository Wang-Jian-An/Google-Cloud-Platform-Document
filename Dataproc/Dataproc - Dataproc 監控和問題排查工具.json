{"title": "Dataproc - Dataproc \u76e3\u63a7\u548c\u554f\u984c\u6392\u67e5\u5de5\u5177", "url": "https://cloud.google.com/dataproc/docs/support/troubleshoot-monitor?hl=zh-cn", "abstract": "# Dataproc - Dataproc \u76e3\u63a7\u548c\u554f\u984c\u6392\u67e5\u5de5\u5177\n**\u76ee\u6a19** \uff1a\u672c\u9801\u9762\u4ecb\u7d39\u53ef\u7528\u65bc\u5c0d Dataproc \u96c6\u7fa3\u548c\u4f5c\u696d\u9032\u884c\u554f\u984c\u6392\u67e5\u548c\u76e3\u63a7\u7684\u5de5\u5177\u3002\n", "content": "## \u7c21\u4ecb\nDataproc \u662f\u4e00\u9805\u4f38\u7e2e\u6975\u5f37\u7684\u5168\u4ee3\u7ba1\u5f0f\u670d\u52d9\uff0c\u7528\u65bc\u904b\u884c\u958b\u6e90\u5206\u4f48\u5f0f\u8655\u7406\u5e73\u81fa\uff0c\u5982 Apache Hadoop\u3001Apache Spark\u3001Apache Flink \u548c Trino\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u5e7e\u90e8\u5206\u4e2d\u4ecb\u7d39\u7684\u6587\u4ef6\u548c\u5de5\u5177\u5c0d Dataproc \u96c6\u7fa3\u548c\u4f5c\u696d\u9032\u884c\u554f\u984c\u6392\u67e5\u4e26\u76e3\u63a7\u3002\n## \u958b\u6e90\u7db2\u9801\u754c\u9762\n\u8a31\u591a Dataproc \u96c6\u7fa3\u958b\u6e90\u7d44\u4ef6\uff08\u5982 Apache Hadoop \u548c Apache Spark\uff09\u90fd\u63d0\u4f9b\u4e86\u7db2\u9801\u754c\u9762\u3002\u9019\u4e9b\u63a5\u53e3\u53ef\u7528\u65bc\u76e3\u63a7\u96c6\u7fa3\u8cc7\u6e90\u548c\u4f5c\u696d\u6027\u80fd\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 YARN Resource Manager \u754c\u9762\u67e5\u770b Dataproc \u96c6\u7fa3\u4e0a\u7684 YARN \u61c9\u7528\u8cc7\u6e90\u5206\u914d\u60c5\u6cc1\u3002\n\uff1a\u5982\u9700\u5141\u8a31\u8a2a\u554f\u96c6\u7fa3\u4e0a\u53ef\u7528\u7684\u7d44\u4ef6\u7db2\u9801\u754c\u9762\uff0c\u8acb\u5728\u5275\u5efa\u96c6\u7fa3\u6642\u5553\u7528 [Dataproc \u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn) \u3002\n### Persistent History Server\n\u5728\u96c6\u7fa3\u4e0a\u904b\u884c\u7684\u958b\u6e90\u7db2\u9801\u754c\u9762\u5728\u96c6\u7fa3\u904b\u884c\u6642\u53ef\u7528\uff0c\u4f46\u5728\u60a8\u522a\u9664\u96c6\u7fa3\u540e\u5b83\u5011\u6703\u7d42\u6b62\u3002\u5982\u9700\u5728\u522a\u9664\u96c6\u7fa3\u540e\u67e5\u770b\u96c6\u7fa3\u548c\u4f5c\u696d\u6578\u64da\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa [\u6c38\u4e45\u6027\u6b77\u53f2\u8a18\u9304\u670d\u52d9\u5668](https://cloud.google.com/dataproc/docs/concepts/jobs/history-server?hl=zh-cn) (PHS)\u3002\n\u793a\u4f8b\uff1a\u60a8\u9047\u5230\u60f3\u8981\u5206\u6790\u7684\u4f5c\u696d\u932f\u8aa4\u6216\u904b\u884c\u901f\u5ea6\u6e1b\u6162\u3002\u60a8\u53ef\u4ee5\u505c\u6b62\u6216\u522a\u9664\u4f5c\u696d\u96c6\u7fa3\uff0c\u7136\u5f8c\u4f7f\u7528 PHS \u67e5\u770b\u548c\u5206\u6790\u4f5c\u696d\u6b77\u53f2\u6578\u64da\u3002\n\u5275\u5efa PHS \u5f8c\uff0c\u5728\u5275\u5efa\u96c6\u7fa3\u6216\u63d0\u4ea4\u6279\u91cf\u5de5\u4f5c\u8ca0\u8f09\u6642\uff0c\u60a8\u53ef\u4ee5\u5c0d Dataproc \u96c6\u7fa3\u6216 Dataproc \u7121\u670d\u52d9\u5668\u6279\u91cf\u5de5\u4f5c\u8ca0\u8f09\u5553\u7528 PHS\u3002PHS \u53ef\u4ee5\u8a2a\u554f\u5728\u591a\u500b\u96c6\u7fa3\u4e0a\u904b\u884c\u7684\u4f5c\u696d\u7684\u6b77\u53f2\u8a18\u9304\u6578\u64da\uff0c\u5f9e\u800c\u53ef\u4ee5\u76e3\u63a7\u6574\u500b\u9805\u76ee\u4e2d\u7684\u4f5c\u696d\uff0c\u800c\u4e0d\u662f\u76e3\u63a7\u5728\u4e0d\u540c\u96c6\u7fa3\u4e0a\u904b\u884c\u7684\u55ae\u7368\u754c\u9762\u3002\n## Dataproc \u65e5\u8a8c\nDataproc \u6703\u6536\u96c6\u7531\u96c6\u7fa3\u4e0a\u904b\u884c\u7684 Apache Hadoop\u3001Spark\u3001Hive\u3001Zookeeper \u548c\u5176\u4ed6\u958b\u6e90\u7cfb\u7d71\u751f\u6210\u7684\u65e5\u8a8c\uff0c\u4e26\u5c07\u5b83\u5011\u767c\u9001\u5230 [Logging](https://cloud.google.com/logging/docs?hl=zh-cn) \u3002\u9019\u4e9b\u65e5\u8a8c\u6839\u64da\u65e5\u8a8c\u4f86\u6e90\u9032\u884c\u5206\u7d44\uff0c\u4ee5\u4fbf\u60a8\u9078\u64c7\u548c\u67e5\u770b\u611f\u8208\u8da3\u7684\u65e5\u8a8c\uff1a\u4f8b\u5982\uff0c\u5728\u96c6\u7fa3\u4e0a\u751f\u6210\u7684 YARN NodeManager \u548c Spark Executor \u65e5\u8a8c\u6703\u55ae\u7368\u6dfb\u52a0\u6a19\u7c64\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Dataproc \u65e5\u8a8c\u5167\u5bb9\u548c\u9078\u9805\uff0c\u8acb\u53c3\u95b1 [Dataproc \u65e5\u8a8c](https://cloud.google.com/dataproc/docs/guides/logging?hl=zh-cn) \u3002\n### Cloud Logging\nLogging \u662f\u4e00\u500b\u5168\u4ee3\u7ba1\u5f0f\u5be6\u6642\u65e5\u8a8c\u7ba1\u7406\u7cfb\u7d71\u3002\u5b83\u5b58\u5132\u5f9e Google Cloud \u670d\u52d9\u548c\u5de5\u5177\u4e2d\u63d0\u53d6\u7684\u65e5\u8a8c\uff0c\u4ee5\u4fbf\u5927\u898f\u6a21\u641c\u7d22\u3001\u904e\u6ffe\u548c\u5206\u6790\u65e5\u8a8c\u3002Dataproc \u96c6\u7fa3\u6703\u751f\u6210\u591a\u500b\u65e5\u8a8c\uff0c\u5305\u62ec [Dataproc \u670d\u52d9\u4ee3\u7406](https://cloud.google.com/dataproc/docs/concepts/iam/dataproc-principals?hl=zh-cn#service_agent_control_plane_identity) \u65e5\u8a8c\u3001\u96c6\u7fa3\u5553\u52d5\u65e5\u8a8c\u548c OSS \u7d44\u4ef6\u65e5\u8a8c\uff08\u5982 YARN NodeManager \u65e5\u8a8c\uff09\u3002\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cDataproc \u96c6\u7fa3\u548c Dataproc Serverless \u6279\u91cf\u5de5\u4f5c\u8ca0\u8f09\u6703\u5553\u7528 Logging\u3002\u65e5\u8a8c\u6703\u5b9a\u671f\u5c0e\u51fa\u5230 Logging\uff0c\u5728\u96c6\u7fa3\u522a\u9664\u6216\u5de5\u4f5c\u8ca0\u8f09\u5b8c\u6210\u5f8c\uff0c\u65e5\u8a8c\u6703\u4fdd\u7559\u5728 Logging \u4e2d\u3002\n## Dataproc \u6307\u6a19\n[Dataproc \u96c6\u7fa3\u548c\u4f5c\u696d\u6307\u6a19](https://cloud.google.com/dataproc/docs/guides/dataproc-metrics?hl=zh-cn#dataproc_resource_metric_collection) \uff08\u4ee5 `dataproc.googleapis.com/` \u7232\u524d\u7db4\uff09\u5305\u542b\u6642\u9593\u5e8f\u5217\u6578\u64da\uff0c\u53ef\u63d0\u4f9b\u95dc\u65bc\u96c6\u7fa3\u6027\u80fd\uff08\u4f8b\u5982 CPU \u5229\u7528\u7387\u6216\u4f5c\u696d\u72c0\u614b\uff09\u7684\u6578\u64da\u6d1e\u898b\u3002Dataproc [\u81ea\u5b9a\u7fa9\u6307\u6a19](https://cloud.google.com/dataproc/docs/guides/dataproc-metrics?hl=zh-cn#custom_metric_collection) \u4ee5 `custom.googleapis.com/` \u7232\u524d\u7db4\uff0c\u5305\u542b\u96c6\u7fa3\u4e0a\u904b\u884c\u7684\u958b\u6e90\u7cfb\u7d71\u767c\u51fa\u7684\u6307\u6a19\uff0c\u4f8b\u5982 YARN `running applications` \u6307\u6a19\u3002\u6df1\u5165\u77ad\u89e3 Dataproc \u6307\u6a19\u53ef\u4ee5\u5e6b\u52a9\u60a8\u9ad8\u6548\u5730\u914d\u7f6e\u96c6\u7fa3\u3002\u8a2d\u7f6e\u57fa\u65bc\u6307\u6a19\u7684\u63d0\u9192\u53ef\u5e6b\u52a9\u60a8\u5feb\u901f\u8b58\u5225\u554f\u984c\u4e26\u505a\u51fa\u97ff\u61c9\u3002\n\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u901a\u904e Monitoring \u7684 [Metrics Explorer](https://console.cloud.google.com/monitoring/metrics-explorer?hl=zh-cn) \u6216 Dataproc **\u96c6\u7fa3\u8a73\u60c5** \u9801\u9762\u4e0a\u7684 **Monitoring** \u6a19\u7c64\u9801\u67e5\u770b [Dataproc \u6307\u6a19](https://cloud.google.com/dataproc/docs/guides/dataproc-metrics?hl=zh-cn) \u3002\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u7cfb\u7d71\u6703\u514d\u8cbb\u6536\u96c6 Dataproc \u96c6\u7fa3\u548c\u4f5c\u696d\u6307\u6a19\u3002 \u6211\u5011\u6703 [\u5411\u5ba2\u6236\u6536\u53d6](https://cloud.google.com/stackdriver/pricing?hl=zh-cn#metrics-chargeable)  [\u81ea\u5b9a\u7fa9\u6307\u6a19](https://cloud.google.com/dataproc/docs/guides/dataproc-metrics?hl=zh-cn#custom_metric_collection) \u7684\u6536\u96c6\u8cbb\u7528\u3002\u60a8\u53ef\u4ee5\u5728\u5275\u5efa\u96c6\u7fa3\u6642 [\u5553\u7528\u81ea\u5b9a\u7fa9\u6307\u6a19\u6536\u96c6](https://cloud.google.com/dataproc/docs/guides/dataproc-metrics?hl=zh-cn#enable_custom_metric_collection) \u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u7cfb\u7d71\u6703\u5c0d Spark \u6279\u91cf\u5de5\u4f5c\u8ca0\u8f09\u5553\u7528 Dataproc Serverless [Spark \u6307\u6a19](https://cloud.google.com/dataproc-serverless/docs/concepts/metrics?hl=zh-cn#available_spark_metrics) \u96c6\u5408\u3002\n## Cloud Monitoring\n[Monitoring](https://cloud.google.com/monitoring/docs?hl=zh-cn) \u4f7f\u7528\u96c6\u7fa3\u5143\u6578\u64da\u548c\u6307\u6a19\uff08\u5305\u62ec HDFS\u3001YARN\u3001\u4f5c\u696d\u548c\u64cd\u4f5c\u6307\u6a19\uff09\u4f86\u6df1\u5165\u77ad\u89e3 Dataproc \u96c6\u7fa3\u548c\u4f5c\u696d\u7684\u904b\u884c\u72c0\u6cc1\u3001\u6027\u80fd\u548c\u53ef\u7528\u6027\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Monitoring \u4f86\u63a2\u7d22\u6307\u6a19\u3001\u6dfb\u52a0\u5716\u8868\u3001\u69cb\u5efa\u4fe1\u606f\u4e2d\u5fc3\u548c\u5275\u5efa\u63d0\u9192\u3002\n### Metrics Explorer\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [Metrics Explorer](https://console.cloud.google.com/monitoring/metrics-explorer?hl=zh-cn) \u67e5\u770b [Dataproc \u6307\u6a19](https://cloud.google.com/dataproc/docs/guides/dataproc-metrics?hl=zh-cn) \u3002Dataproc \u96c6\u7fa3\u3001\u4f5c\u696d\u548c\u7121\u670d\u52d9\u5668\u6279\u8655\u7406\u6307\u6a19\u5217\u5728 `Cloud Dataproc Cluster` \u3001 `Cloud Dataproc Job` \u548c `Cloud Dataproc Batch` \u8cc7\u6e90\u4e0b\u3002Dataproc \u81ea\u5b9a\u7fa9\u6307\u6a19\u5217\u5728 `VM Instances` \u8cc7\u6e90\u7684 `Custom` \u985e\u5225\u4e0b\u3002\n### \u5716\u8868\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Metrics Explorer [\u5275\u5efa\u5716\u8868](https://cloud.google.com/monitoring/charts/metrics-explorer?hl=zh-cn) \u4f86\u76f4\u89c0\u5448\u73fe Dataproc \u6307\u6a19\u3002\n\u793a\u4f8b\uff1a\u60a8\u53ef\u4ee5\u5275\u5efa\u4e00\u500b\u5716\u8868\u4f86\u67e5\u770b\u96c6\u7fa3\u4e0a\u904b\u884c\u7684\u6d3b\u8e8d Yarn \u61c9\u7528\u7684\u6578\u91cf\uff0c\u7136\u5f8c\u6dfb\u52a0\u904e\u6ffe\u689d\u4ef6\u4ee5\u6309\u96c6\u7fa3\u540d\u7a31\u6216\u5340\u57df\u9078\u64c7\u53ef\u8996\u5316\u6307\u6a19\u3002\n### \u4fe1\u606f\u4e2d\u5fc3\n\u60a8\u53ef\u4ee5 [\u69cb\u5efa\u4fe1\u606f\u4e2d\u5fc3](https://cloud.google.com/dataproc/docs/guides/dataproc-metrics?hl=zh-cn#build_a_dashboard) \uff0c\u4f7f\u7528\u591a\u500b\u9805\u76ee\u548c\u4e0d\u540c Google Cloud \u7522\u54c1\u7684\u6307\u6a19\u4f86\u76e3\u63a7 Dataproc \u96c6\u7fa3\u548c\u4f5c\u696d\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u5728 [Metrics Explorer](https://console.cloud.google.com/monitoring/metrics-explorer?hl=zh-cn) \u9801\u9762\u4e2d\u9ede\u64ca\u3001\u5275\u5efa\u4e26\u4fdd\u5b58\u5716\u8868\uff0c\u5f9e\u800c\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 [\u4fe1\u606f\u4e2d\u5fc3\u6982\u89bd](https://console.cloud.google.com/monitoring/dashboards?hl=zh-cn) \u9801\u9762\u4e2d\u69cb\u5efa\u4fe1\u606f\u4e2d\u5fc3\u3002\n### \u63d0\u9192\n\u60a8\u53ef\u4ee5\u5275\u5efa [Dataproc \u6307\u6a19\u63d0\u9192](https://cloud.google.com/dataproc/docs/guides/dataproc-alerts?hl=zh-cn) \uff0c\u53ca\u6642\u63a5\u6536\u96c6\u7fa3\u6216\u4f5c\u696d\u554f\u984c\u7684\u901a\u77e5\u3002\n## \u5982\u9700\u6df1\u5165\u77ad\u89e3\n\u5982\u9700\u66f4\u591a\u6307\u5c0e\uff0c\u8acb\u53c3\u95b1\n- [\u6392\u67e5 Dataproc \u932f\u8aa4\u6d88\u606f\u554f\u984c](https://cloud.google.com/dataproc/docs/support/troubleshoot-errors?hl=zh-cn) \n- [\u8a3a\u65b7 Dataproc \u96c6\u7fa3](https://cloud.google.com/dataproc/docs/support/diagnose-command?hl=zh-cn) \n- [Dataproc \u5e38\u898b\u554f\u984c\u89e3\u7b54 ](https://cloud.google.com/dataproc/docs/resources/faq?hl=zh-cn)", "guide": "Dataproc"}