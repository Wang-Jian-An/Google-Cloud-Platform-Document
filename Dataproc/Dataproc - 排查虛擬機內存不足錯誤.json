{"title": "Dataproc - \u6392\u67e5\u865b\u64ec\u6a5f\u5167\u5b58\u4e0d\u8db3\u932f\u8aa4", "url": "https://cloud.google.com/dataproc/docs/support/troubleshoot-oom-errors?hl=zh-cn", "abstract": "# Dataproc - \u6392\u67e5\u865b\u64ec\u6a5f\u5167\u5b58\u4e0d\u8db3\u932f\u8aa4\n**\u76ee\u6a19** \uff1a\u672c\u9801\u9762\u4ecb\u7d39\u4e86\u6709\u95dc Compute Engine \u865b\u64ec\u6a5f\u5167\u5b58\u4e0d\u8db3 (OOM) \u932f\u8aa4\u7684 Dataproc\uff0c\u4e26\u8aaa\u660e\u4e86\u6392\u67e5\u548c\u89e3\u6c7a OOM \u932f\u8aa4\u7684\u6b65\u9a5f\u3002\n", "content": "## OOM \u5f71\u97ff\n\u7576 Compute Engine \u865b\u64ec\u6a5f\u4e0a\u7684 Dataproc \u9047\u5230\u5167\u5b58\u4e0d\u8db3 (OOM) \u932f\u8aa4\u6642\uff1a\n- \u4e3b\u5be6\u4f8b\u548c\u5de5\u4f5c\u5668\u865b\u64ec\u6a5f\u6703\u51cd\u7d50\u4e00\u6bb5\u6642\u9593\u3002\n- \u4e3b\u865b\u64ec\u6a5f OOM \u932f\u8aa4\u6703\u5c0e\u81f4\u4f5c\u696d\u5931\u6557\uff0c\u4e26\u986f\u793a\u201c\u7121\u6cd5\u7372\u53d6\u4efb\u52d9\u201d\u932f\u8aa4\u3002\n- \u5de5\u4f5c\u5668\u865b\u64ec\u6a5f OOM \u932f\u8aa4\u6703\u5c0e\u81f4 YARN HDFS \u4e0a\u7684\u7bc0\u9ede\u4e1f\u5931\uff0c\u5f9e\u800c\u5ef6\u9072 Dataproc \u4f5c\u696d\u7684\u57f7\u884c\u3002## Yarn \u5167\u5b58\u63a7\u5236\nYarn \u63d0\u4f9b\u4e09\u7a2e\u985e\u578b\u7684 [\u5167\u5b58\u63a7\u4ef6](https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/NodeManagerCGroupsMemory.html) \uff1a\n- \u57fa\u65bc\u8f2a\u8a62\uff08\u820a\u7248\uff09\n- \u56b4\u683c\u6a21\u5f0f\n- Elastic\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cDataproc \u4e0d\u6703\u5c07 `yarn.nodemanager.resource.memory.enabled` \u8a2d\u7f6e\u7232\u5553\u7528 YARN \u5167\u5b58\u63a7\u4ef6\uff0c\u539f\u56e0\u5982\u4e0b\uff1a\n- \u5982\u679c\u672a\u6b63\u78ba\u914d\u7f6e\u5bb9\u5668\u5927\u5c0f\uff0c\u56b4\u683c\u7684\u5167\u5b58\u63a7\u5236\u53ef\u80fd\u6703\u5c0e\u81f4\u6709\u8db3\u5920\u7684\u5167\u5b58\uff0c\u5f9e\u800c\u7d42\u6b62\u5bb9\u5668\u3002\n- \u5f48\u6027\u5167\u5b58\u63a7\u5236\u8981\u6c42\u53ef\u80fd\u6703\u5c0d\u4f5c\u696d\u57f7\u884c\u7522\u751f\u4e0d\u5229\u5f71\u97ff\u3002\n- \u7576\u9032\u7a0b\u904e\u5ea6\u4f54\u7528\u5167\u5b58\u6642\uff0cYARN \u5167\u5b58\u63a7\u4ef6\u53ef\u80fd\u7121\u6cd5\u963b\u6b62 OOM \u932f\u8aa4\u3002## Dataproc \u5167\u5b58\u4fdd\u8b77\n\u7576 Dataproc \u96c6\u7fa3\u865b\u64ec\u6a5f\u9762\u81e8\u5167\u5b58\u58d3\u529b\u6642\uff0cDataproc \u5167\u5b58\u4fdd\u8b77\u6703\u7d42\u6b62\u9032\u7a0b\u6216\u5bb9\u5668\uff0c\u76f4\u5230 OOM \u689d\u4ef6\u79fb\u9664\u3002\n\u4ee5\u4e0b [Compute Engine \u4e0a\u7684 Dataproc \u6620\u50cf\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-version-clusters?hl=zh-cn) \u4e2d\u7232\u4ee5\u4e0b\u96c6\u7fa3\u7bc0\u9ede\u63d0\u4f9b\u4e86 Dataproc \u5167\u5b58\u4fdd\u8b77\uff1a\n| \u89d2\u8272    | 1.5  | 2.0  | 2.1  |\n|:-----------------|:--------|:--------|:--------|\n| \u4e3b\u865b\u64ec\u6a5f   | 1.5.74+ | 2.0.48+ | \u5168\u90e8 |\n| \u5de5\u4f5c\u5668\u865b\u64ec\u6a5f  | \u4e0d\u53ef\u7528 | 2.0.76+ | 2.1.24+ |\n| \u9a45\u52d5\u7a0b\u5e8f\u6c60\u865b\u64ec\u6a5f | \u4e0d\u53ef\u7528 | 2.0.76+ | 2.1.24+ |\n**\u5efa\u8b70** \uff1a\u4f7f\u7528\u5177\u6709\u5167\u5b58\u4fdd\u8b77\u7684 Dataproc \u6620\u50cf\u7248\u672c\uff0c\u4ee5\u5e6b\u52a9\u907f\u514d\u865b\u64ec\u6a5f OOM \u932f\u8aa4\u3002\n### \u5982\u4f55\u8b58\u5225 Dataproc \u5167\u5b58\u4fdd\u8b77\u7d42\u6b62\n- Dataproc \u5167\u5b58\u4fdd\u8b77\u529f\u80fd\u4ee5\u4ee3\u78bc`137`\u6216`143`\u7d42\u6b62\u9000\u51fa\u7684\u9032\u7a0b\u3002\n- \u5de5\u4f5c\u5668\u7bc0\u9ede\u7d42\u6b62\uff1a- Dataproc \u6703\u905e\u589e`dataproc.googleapis.com/node/problem_count`\u7684\u7d2f\u8a08\u6307\u6a19\uff0c\u4e26\u5c07`reason`\u8a2d\u7f6e\u7232`ProcessKilledDueToMemoryPressure`\u3002\n- \u5982\u679c\u5553\u7528\u4e86 Cloud Logging\uff0cDataproc \u5c07\u5beb\u5165`google.dataproc.oom-killer`\u65e5\u8a8c\uff0c\u5176\u4e2d\u986f\u793a\u201cA process is killed due to memory information: [process name]\u201d\u3002\n- \u5982\u679c YARN \u5bb9\u5668\u7d42\u6b62\uff0cDataproc \u6703\u5728 YARN \u8cc7\u6e90\u7ba1\u7406\u5668\u4e2d\u5beb\u5165\u4ee5\u4e0b\u6d88\u606f\uff1a\u201c[container id] exited with code 137, which \u53ef\u80fd\u8868\u793a [node id] \u4e0a\u7684\u5167\u5b58\u58d3\u529b\u201d\n- \u4e3b\u7d44\u4ef6\u6216\u9a45\u52d5\u7a0b\u5e8f\u6c60\u7bc0\u9ede\u7d42\u6b62\uff1a\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u5931\u6557\u4e26\u986f\u793a`Driver received SIGTERM/SIGKILL signal and exited with [INT] code`\u3002## OOM \u89e3\u6c7a\u65b9\u6848\n\u672c\u90e8\u5206\u4ecb\u7d39\u4e86\u53ef\u80fd\u56e0 OOM \u554f\u984c\u800c\u5c0e\u81f4\u7684\u4f5c\u696d\u548c\u5bb9\u5668\u7d42\u6b62\u3002\n**\u4f5c\u696d\u5931\u6557\u4e26\u986f\u793a\u201c\u9a45\u52d5\u7a0b\u5e8f\u63a5\u6536\u5230 SIGTERM/SIGKILL \u4fe1\u865f\uff0c\u4e26\u9000\u51fa\u4e86 [INT] \u4ee3\u78bc\u201d**\n\u5efa\u8b70\uff1a\n- \u5982\u679c\u96c6\u7fa3\u5177\u6709 [\u9a45\u52d5\u7a0b\u5e8f\u6c60](https://cloud.google.com/dataproc/docs/guides/node-groups/dataproc-driver-node-groups?hl=zh-cn) \uff0c\u8acb\u63d0\u9ad8`driver-required-memory-mb`\u4ee5\u589e\u52a0\u81e8\u6642\u4f5c\u696d\u5167\u5b58\u7528\u91cf\u3002\n- \u5982\u679c\u96c6\u7fa3\u6c92\u6709\u9a45\u52d5\u7a0b\u5e8f\u6c60\uff0c\u8acb\u91cd\u65b0\u5275\u5efa\u96c6\u7fa3\uff0c\u5f9e\u800c\u964d\u4f4e\u4f75\u767c\u4f5c\u696d\u6578\u4e0a\u9650\uff08\u8a08\u7b97\u65b9\u5f0f\u7232`(total master memory in MB - 3584MB) / driver-size-mb`\uff09\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u65b9\u5f0f\u964d\u4f4e\u6b64\u6578\u5b57\uff1a- \u8a2d\u7f6e`dataproc:dataproc.scheduler.max-concurrent-jobs`\uff0c\u6216\n- \u5c07`dataproc:dataproc.scheduler.driver-size-mb`\u8a2d\u7f6e\u7232\u66f4\u5927\u7684\u6578\u5b57\uff08\u9ed8\u8a8d\u503c\u7232`1024MB`\uff09\u3002\n- \u8acb\u8003\u616e\u4f7f\u7528\u5177\u6709\u984d\u5916\u5167\u5b58\u7684\u4e3b\u7bc0\u9ede\u6a5f\u5668\u985e\u578b\u3002\n**\u4f7f\u7528\u9000\u51fa\u4ee3\u78bc 137 \u6216 143 \u9000\u51fa\u5bb9\u5668**\n\u5efa\u8b70\uff1a\n- \u5982\u679c Dataproc \u5167\u5b58\u4fdd\u8b77\u529f\u80fd\u7d42\u6b62\u4e86\u5bb9\u5668\uff08\u8acb\u53c3\u95b1 [\u5982\u4f55\u8b58\u5225 Dataproc \u5167\u5b58\u4fdd\u8b77\u529f\u80fd\u7d42\u6b62](#how_to_identify_memory_protection_terminations) \uff09\uff1a- \u6aa2\u67e5\u5bb9\u5668\u5927\u5c0f\u914d\u7f6e\u662f\u5426\u6b63\u78ba\u3002\n- \u8acb\u8003\u616e\u964d\u4f4e`yarn.nodemanager.resource.memory-mb`\u3002\u6b64\u5c6c\u6027\u63a7\u5236\u7528\u65bc\u8abf\u5ea6 YARN \u5bb9\u5668\u7684\u5167\u5b58\u91cf\u3002\n- \u5982\u679c\u4f5c\u696d\u5bb9\u5668\u6301\u7e8c\u5931\u6557\uff0c\u8acb\u6aa2\u67e5\u6578\u64da\u50be\u659c\u662f\u5426\u5c0e\u81f4\u7279\u5b9a\u5bb9\u5668\u7684\u4f7f\u7528\u91cf\u589e\u52a0\u3002\u5982\u679c\u51fa\u73fe\u9019\u7a2e\u60c5\u6cc1\uff0c\u8acb\u91cd\u65b0\u5c0d\u4f5c\u696d\u9032\u884c\u5206\u5340\u6216\u589e\u52a0\u5de5\u4f5c\u5668\u5927\u5c0f\uff0c\u4ee5\u6eff\u8db3\u984d\u5916\u7684\u5167\u5b58\u8981\u6c42\u3002", "guide": "Dataproc"}