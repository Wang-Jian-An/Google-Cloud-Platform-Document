{"title": "Dataproc - Dataproc \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44", "url": "https://cloud.google.com/dataproc/docs/guides/node-groups/dataproc-driver-node-groups?hl=zh-cn", "abstract": "# Dataproc - Dataproc \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\n", "content": "## \u6982\u89bd\nDataproc `NodeGroup` \u8cc7\u6e90\u662f\u4e00\u7d44\u57f7\u884c\u5df2\u5206\u914d\u89d2\u8272\u7684 Dataproc \u96c6\u7fa3\u7bc0\u9ede\u3002\u672c\u9801\u9762\u4ecb\u7d39 **\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44** \uff0c\u9019\u662f\u4e00\u7d44\u88ab\u5206\u914d `Driver` \u89d2\u8272\u7684 Compute Engine \u865b\u64ec\u6a5f\uff0c\u7528\u65bc\u5728 Dataproc \u96c6\u7fa3\u4e0a\u904b\u884c\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u3002\n**\u6ce8\u610f** \uff1a\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u901a\u5e38\u7528\u65bc\u9577\u6642\u9593\u904b\u884c\u7684\u5171\u4eab\u96c6\u7fa3\u3002\u4f46\u4f7f\u7528\u6b64\u65b9\u6cd5\u6642\u8981\u8b39\u614e\u3002\u9577\u6642\u9593\u904b\u884c\u7684\u5171\u4eab\u96c6\u7fa3\u901a\u5e38\u4ee3\u8868\u55ae\u9ede\u6545\u969c\uff1a\u904b\u884c\u72c0\u6cc1\u4e0d\u4f73\u6216\u8655\u65bc\u932f\u8aa4\u72c0\u614b\u7684\u96c6\u7fa3\u53ef\u80fd\u6703\u963b\u585e\u6574\u500b\u6578\u64da\u6d41\u6c34\u7dda\u3002\u8acb\u6539\u7528 [\u81e8\u6642\u96c6\u7fa3](https://cloud.google.com/dataproc/docs/support/spark-job-tuning?hl=zh-cn#use_ephemeral_clusters) \uff0c\u5b83\u5011\u50c5\u5728\u55ae\u500b\u4f5c\u696d\u7684\u751f\u547d\u9031\u671f\u5167\u5b58\u5728\u3002\n## \u4f55\u6642\u4f7f\u7528\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\n- \u50c5\u7576\u60a8\u9700\u8981\u5728\u5171\u4eab\u96c6\u7fa3\u4e0a\u904b\u884c\u591a\u500b\u4f75\u767c\u4f5c\u696d\u6642\uff0c\u624d\u4f7f\u7528\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u3002\n- \u5728\u4f7f\u7528\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u4e4b\u524d\uff0c\u8acb\u589e\u52a0\u4e3b\u7bc0\u9ede\u8cc7\u6e90\uff0c\u4ee5\u907f\u514d [\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u9650\u5236](#limitations_and_considerations) \u3002## \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u5982\u4f55\u5e6b\u52a9\u60a8\u904b\u884c\u4f75\u767c\u4f5c\u696d\nDataproc \u6703\u5728 Dataproc \u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u7232\u6bcf\u500b\u4f5c\u696d\u5553\u52d5\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u9032\u7a0b\u3002\u9a45\u52d5\u7a0b\u5e8f\u9032\u7a0b\u7e7c\u800c\u904b\u884c\u61c9\u7528\u9a45\u52d5\u7a0b\u5e8f\uff08\u5982 `spark-submit` \uff09\u4f5c\u7232\u5176\u5b50\u9032\u7a0b\u3002\u4f46\u662f\uff0c\u5728\u4e3b\u7bc0\u9ede\u4e0a\u904b\u884c\u7684\u4f75\u767c\u4f5c\u696d\u6578\u91cf\u53d7\u4e3b\u7bc0\u9ede\u4e0a\u53ef\u7528\u7684\u8cc7\u6e90\u9650\u5236\uff0c\u800c\u4e14\u7531\u65bc Dataproc \u4e3b\u7bc0\u9ede\u7121\u6cd5\u64f4\u7e2e\uff0c\u56e0\u6b64\u7576\u4e3b\u7bc0\u9ede\u8cc7\u6e90\u4e0d\u8db3\u4ee5\u904b\u884c\u4f5c\u696d\u6642\uff0c\u4f5c\u696d\u53ef\u80fd\u6703\u5931\u6557\u6216\u53d7\u5230\u9650\u5236\u3002\n\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u662f\u7531 YARN \u7ba1\u7406\u7684\u7279\u6b8a\u7bc0\u9ede\u7d44\uff0c\u56e0\u6b64\u4f5c\u696d\u4f75\u767c\u4e0d\u53d7\u4e3b\u7bc0\u9ede\u8cc7\u6e90\u9650\u5236\u3002\u5728\u5177\u6709\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u7684\u96c6\u7fa3\u4e2d\uff0c\u61c9\u7528\u9a45\u52d5\u7a0b\u5e8f\u5728\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u4e0a\u904b\u884c\u3002\u6bcf\u500b\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u5982\u679c\u6709\u8db3\u5920\u7684\u8cc7\u6e90\uff0c\u5247\u53ef\u904b\u884c\u591a\u500b\u61c9\u7528\u9a45\u52d5\u7a0b\u5e8f\u3002\n## \u512a\u52e2\n\u4f7f\u7528\u5177\u6709\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u7684 Dataproc \u96c6\u7fa3\uff0c\u60a8\u53ef\u4ee5\uff1a\n- \u6a6b\u5411\u64f4\u7e2e\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u8cc7\u6e90\u4ee5\u904b\u884c\u66f4\u591a\u4f75\u767c\u4f5c\u696d\n- \u5c07\u9a45\u52d5\u7a0b\u5e8f\u8cc7\u6e90\u8207\u5de5\u4f5c\u5668\u8cc7\u6e90\u5206\u958b\u64f4\u7e2e\n- \u5728 Dataproc 2.0 \u53ca\u66f4\u9ad8\u7248\u672c\u7684\u6620\u50cf\u96c6\u7fa3\u4e0a\u5be6\u73fe\u66f4\u5feb\u7684\u7e2e\u5bb9\u3002\u5728\u9019\u4e9b\u96c6\u7fa3\u4e0a\uff0c\u61c9\u7528\u4e3b\u5be6\u4f8b\u5728\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u4e2d\u7684 Spark \u9a45\u52d5\u7a0b\u5e8f\u4e2d\u904b\u884c\uff08`spark.yarn.unmanagedAM.enabled`\u9ed8\u8a8d\u8a2d\u7f6e\u7232`true`\uff09\u3002\n- \u81ea\u5b9a\u7fa9\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u5553\u52d5\u3002\u60a8\u53ef\u4ee5\u5728 [\u521d\u59cb\u5316\u8173\u672c](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/init-actions?hl=zh-cn) \u4e2d\u6dfb\u52a0`{ROLE} == 'Driver'`\uff0c\u8b93\u8a72\u8173\u672c\u5728 [\u7bc0\u9ede\u9078\u64c7](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/init-actions?hl=zh-cn#node_selection) \u4e2d\u7232\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u57f7\u884c\u64cd\u4f5c\u3002## \u9650\u5236\n- [Dataproc \u5de5\u4f5c\u6d41\u6a21\u677f](https://cloud.google.com/dataproc/docs/concepts/workflows/overview?hl=zh-cn) \u4e0d\u652f\u6301\u7bc0\u9ede\u7d44\u3002\n- \u7121\u6cd5\u505c\u6b62\u3001\u91cd\u5553\u6216\u81ea\u52d5\u64f4\u7e2e\u7bc0\u9ede\u7d44\u96c6\u7fa3\u3002\n- MapReduce \u61c9\u7528\u4e3b\u5be6\u4f8b\u5728\u5de5\u4f5c\u5668\u7bc0\u9ede\u4e0a\u904b\u884c\u3002\u5982\u679c\u5553\u7528 [\u5b89\u5168\u505c\u7528](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/scaling-clusters?hl=zh-cn#graceful_decommissioning) \uff0c\u5de5\u4f5c\u5668\u7bc0\u9ede\u7684\u7e31\u5411\u7e2e\u5bb9\u901f\u5ea6\u53ef\u80fd\u6703\u5f88\u6162\u3002\n- \u4f5c\u696d\u4f75\u767c\u53d7`dataproc:agent.process.threads.job.max` [\u96c6\u7fa3\u5c6c\u6027](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/cluster-properties?hl=zh-cn#dataproc_service_properties_table) \u7684\u5f71\u97ff\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6709\u4e09\u500b\u4e3b\u5be6\u4f8b\u4e14\u6b64\u5c6c\u6027\u8a2d\u7f6e\u7232\u9ed8\u8a8d\u503c`100`\uff0c\u5247\u96c6\u7fa3\u7d1a\u4f5c\u696d\u4f75\u767c\u6578\u4e0a\u9650\u7232`300`\u3002\n**\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u8207 Spark \u96c6\u7fa3\u6a21\u5f0f\u7684\u5c0d\u6bd4**\n| \u529f\u80fd    | Spark \u96c6\u7fa3\u6a21\u5f0f                        | \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44                              |\n|:-------------------|:-------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------|\n| \u5de5\u4f5c\u5668\u7bc0\u9ede\u7e31\u5411\u7e2e\u5bb9 | \u9577\u671f\u6709\u6548\u7684\u9a45\u52d5\u7a0b\u5e8f\u8207\u77ed\u671f\u6709\u6548\u7684\u5bb9\u5668\u5728\u540c\u4e00\u5de5\u4f5c\u5668\u7bc0\u9ede\u4e0a\u904b\u884c\uff0c\u56e0\u800c\u4f7f\u7528\u5b89\u5168\u505c\u7528\u529f\u80fd\u5c0d\u5de5\u4f5c\u5668\u9032\u884c\u7e2e\u6e1b\u7684\u901f\u5ea6\u6703\u5f88\u6162\u3002 | \u7576\u9a45\u52d5\u7a0b\u5e8f\u5728\u7bc0\u9ede\u7d44\u4e0a\u904b\u884c\u6642\uff0c\u5de5\u4f5c\u5668\u7bc0\u9ede\u7684\u7e2e\u6e1b\u901f\u5ea6\u6703\u66f4\u5feb\u3002                    |\n| \u6d41\u5f0f\u9a45\u52d5\u7a0b\u5e8f\u8f38\u51fa | \u9700\u8981\u5728 YARN \u65e5\u8a8c\u4e2d\u641c\u7d22\u4ee5\u67e5\u627e\u8abf\u5ea6\u9a45\u52d5\u7a0b\u5e8f\u7684\u7bc0\u9ede\u3002                | \u9a45\u52d5\u7a0b\u5e8f\u8f38\u51fa\u6703\u6d41\u5f0f\u50b3\u8f38\u5230 Cloud Storage\uff0c\u4f5c\u696d\u5b8c\u6210\u5f8c\uff0c\u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u548c gcloud dataproc jobs wait \u547d\u4ee4\u8f38\u51fa\u4e2d\u67e5\u770b\u9019\u4e9b\u8f38\u51fa\u3002 |\n## \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44 IAM \u6b0a\u9650\n\u4ee5\u4e0b IAM \u6b0a\u9650\u8207\u4ee5\u4e0b Dataproc \u7bc0\u9ede\u7d44\u76f8\u95dc\u64cd\u4f5c\u76f8\u95dc\u806f\u3002\n| \u6b0a\u9650      | \u64cd\u4f5c                    |\n|:---------------------------|:----------------------------------------------------------------------------------|\n| dataproc.nodeGroups.create | \u5275\u5efa Dataproc \u7bc0\u9ede\u7d44\u3002\u5982\u679c\u7528\u6236\u7684\u9805\u76ee\u5177\u6709 dataproc.clusters.create\uff0c\u5247\u6388\u4e88\u6b64\u6b0a\u9650\u3002 |\n| dataproc.nodeGroups.get | \u7372\u53d6 Dataproc \u7bc0\u9ede\u7d44\u7684\u8a73\u7d30\u4fe1\u606f\u3002             |\n| dataproc.nodeGroups.update | \u8abf\u6574 Dataproc \u7bc0\u9ede\u7d44\u7684\u5927\u5c0f\u3002              |\n## \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u64cd\u4f5c\n\u60a8\u53ef\u4ee5\u4f7f\u7528 gcloud CLI \u548c Dataproc API \u5275\u5efa\u3001\u7372\u53d6\u3001\u8abf\u6574\u5927\u5c0f\u3001\u522a\u9664\u4f5c\u696d\uff0c\u4ee5\u53ca\u5c07\u4f5c\u696d\u63d0\u4ea4\u5230 Dataproc \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u3002\n### \u5275\u5efa\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u96c6\u7fa3\n\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u8207\u4e00\u500b Dataproc \u96c6\u7fa3\u76f8\u95dc\u806f\u3002 \u60a8\u53ef\u4ee5\u5728 [\u5275\u5efa Dataproc \u96c6\u7fa3](https://cloud.google.com/dataproc/docs/guides/create-cluster?hl=zh-cn#creating_a_cloud_dataproc_cluster) \u7684\u904e\u7a0b\u4e2d\u5275\u5efa\u7bc0\u9ede\u7d44\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 gcloud CLI \u6216 Dataproc REST API \u5275\u5efa\u5177\u6709\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u7684 Dataproc \u96c6\u7fa3\u3002\n**\u6ce8\u610f** \uff1a\u4f7f\u7528 [2.0.52](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-release-2.0?hl=zh-cn) \u53ca\u66f4\u9ad8\u7248\u672c\u7684 [\u6620\u50cf\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-version-clusters?hl=zh-cn#supported_dataproc_versions) \u5275\u5efa\u7684\u96c6\u7fa3\u652f\u6301 Dataproc \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u3002\n```\ngcloud dataproc clusters create CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--driver-pool-size=SIZE \\\n\u00a0\u00a0\u00a0\u00a0--driver-pool-id=NODE_GROUP_ID\n```\n **\u5fc5\u9700\u6a19\u8a8c** \uff1a- \uff1a\u96c6\u7fa3\u540d\u7a31\uff0c\u5728\u9805\u76ee\u4e2d\u5fc5\u9808\u662f\u552f\u4e00\u7684\u3002\u540d\u7a31\u5fc5\u9808\u4ee5\u5c0f\u5beb\u5b57\u6bcd\u958b\u982d\uff0c\u6700\u591a\u53ef\u4ee5\u5305\u542b 51 \u500b\u5c0f\u5beb\u5b57\u6bcd\u3001\u6578\u5b57\u548c\u9023\u5b57\u7b26\u3002\u4f46\u4e0d\u80fd\u4ee5\u9023\u5b57\u7b26\u7d50\u5c3e\u3002\u5df2\u522a\u9664\u7684\u96c6\u7fa3\u7684\u540d\u7a31\u53ef\u4ee5\u91cd\u8907\u4f7f\u7528\u3002\n- \uff1a\u96c6\u7fa3\u6240\u5728\u7684 [\u5340\u57df](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#available) \u3002\n- \uff1a\u7bc0\u9ede\u7d44\u4e2d\u7684\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u6578\u3002\u6240\u9700\u7684\u7bc0\u9ede\u6578\u53d6\u6c7a\u65bc\u4f5c\u696d\u8ca0\u8f09\u548c\u9a45\u52d5\u7a0b\u5e8f\u6c60\u6a5f\u5668\u985e\u578b\u3002\u9a45\u52d5\u7a0b\u5e8f\u7d44\u7bc0\u9ede\u7684\u6578\u91cf\u4e0b\u9650\u7b49\u65bc\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u6240\u9700\u7684\u7e3d\u5167\u5b58\u6216 vCPU \u6578\u9664\u4ee5\u6bcf\u500b\u9a45\u52d5\u7a0b\u5e8f\u6c60\u7684\u6a5f\u5668\u5167\u5b58\u6216 vCPU \u6578\u3002\n- \uff1a\u53ef\u9078\uff0c\u5efa\u8b70\u63d0\u4f9b\u3002\u6b64 ID \u5728\u96c6\u7fa3\u4e2d\u5fc5\u9808\u662f\u552f\u4e00\u7684\u3002\u4f7f\u7528\u6b64 ID \u53ef\u5728\u5c07\u4f86\u7684\u64cd\u4f5c\u4e2d\u8b58\u5225\u9a45\u52d5\u7a0b\u5e8f\u7d44\uff0c\u4f8b\u5982\u8abf\u6574\u7bc0\u9ede\u7d44\u7684\u5927\u5c0f\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0cDataproc \u6703\u751f\u6210\u7bc0\u9ede\u7d44 ID\u3002\n **\u5efa\u8b70\u7684\u6a19\u8a8c** \uff1a- `--enable-component-gateway`\uff1a\u6dfb\u52a0\u6b64\u6a19\u8a8c\u53ef\u4ee5\u5553\u7528 [Dataproc \u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn) \uff0c\u8a72\u7db2\u95dc\u63d0\u4f9b\u5c0d YARN \u7db2\u9801\u754c\u9762\u7684\u8a2a\u554f\u6b0a\u9650\u3002YARN \u754c\u9762\u201c\u61c9\u7528\u201d\u548c\u201c\u8abf\u5ea6\u5668\u201d\u9801\u9762\u986f\u793a\u96c6\u7fa3\u548c\u4f5c\u696d\u72c0\u614b\u3001\u61c9\u7528\u968a\u5217\u5167\u5b58\u3001\u6838\u5fc3\u5bb9\u91cf\u4ee5\u53ca\u5176\u4ed6\u6307\u6a19\u3002\n **\u5176\u4ed6\u6a19\u8a8c** \uff1a\u60a8\u53ef\u4ee5\u5c07\u4ee5\u4e0b\u53ef\u9078\u7684 `driver-pool` \u6a19\u8a8c\u6dfb\u52a0\u5230 `gcloud dataproc clusters create` \u547d\u4ee4\u4ee5\u81ea\u5b9a\u7fa9\u7bc0\u9ede\u7d44\u3002\n| \u6a19\u8a8c        | \u9ed8\u8a8d\u503c                             |\n|:----------------------------------|:-----------------------------------------------------------------------------------------------------------------------|\n| --driver-pool-id     | \u5b57\u7b26\u4e32\u6a19\u8b58\u7b26\uff0c\u5982\u679c\u672a\u901a\u904e\u6a19\u8a8c\u8a2d\u7f6e\uff0c\u5247\u7531\u670d\u52d9\u751f\u6210\u3002\u6b64 ID \u53ef\u7528\u65bc\u5728\u5c07\u4f86\u57f7\u884c\u7bc0\u9ede\u6c60\u64cd\u4f5c\uff08\u4f8b\u5982\u8abf\u6574\u7bc0\u9ede\u7d44\u7684\u5927\u5c0f\uff09\u6642\u6a19\u8b58\u7bc0\u9ede\u7d44\u3002 |\n| --driver-pool-machine-type  | n1-standard-4                           |\n| --driver-pool-accelerator   | \u7121\u9ed8\u8a8d\u503c\u3002\u6307\u5b9a\u52a0\u901f\u5668\u6642\uff0c\u5fc5\u9808\u6307\u5b9a GPU \u985e\u578b\uff0c\u800c GPU \u7684\u6578\u91cf\u5247\u662f\u53ef\u9078\u5167\u5bb9\u3002             |\n| --num-driver-pool-local-ssds  | \u7121\u9ed8\u8a8d\u53d6\u666f\u65b9\u5f0f                           |\n| --driver-pool-local-ssd-interface | \u7121\u9ed8\u8a8d\u53d6\u666f\u65b9\u5f0f                           |\n| --driver-pool-boot-disk-type  | pd-standard                           |\n| --driver-pool-boot-disk-size  | 1000 GB                            |\n| --driver-pool-min-cpu-platform | AUTOMATIC                            |\u5c07 [AuxiliaryNodeGroup](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#AuxiliaryNodeGroup) \u4f5c\u7232 Dataproc API [cluster.create](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters/create?hl=zh-cn) \u8acb\u6c42\u7684\u4e00\u90e8\u5206\u5b8c\u6210\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5fc5\u586b\u3002Google Cloud \u9805\u76ee ID\u3002\n- \uff1a\u5fc5\u586b\u3002Dataproc \u96c6\u7fa3 [\u5340\u57df](https://cloud.google.com/compute/docs/regions-zones/regions-zones?hl=zh-cn#available) \u3002\n- \uff1a\u5fc5\u586b\u3002\u96c6\u7fa3\u540d\u7a31\uff0c\u8a72\u540d\u7a31\u5728\u9805\u76ee\u4e2d\u5fc5\u9808\u662f\u552f\u4e00\u7684\u3002\u540d\u7a31\u5fc5\u9808\u4ee5\u5c0f\u5beb\u5b57\u6bcd\u958b\u982d\uff0c\u6700\u591a\u53ef\u4ee5\u5305\u542b 51 \u500b\u5c0f\u5beb\u5b57\u6bcd\u3001\u6578\u5b57\u548c\u9023\u5b57\u7b26\u3002\u4f46\u4e0d\u80fd\u4ee5\u9023\u5b57\u7b26\u7d50\u5c3e\u3002\u5df2\u522a\u9664\u96c6\u7fa3\u7684\u540d\u7a31\u53ef\u4ee5\u91cd\u7528\u3002\n- \uff1a\u5fc5\u586b\u3002\u7bc0\u9ede\u7d44\u4e2d\u7684\u7bc0\u9ede\u6578\u3002\n- \uff1a\u53ef\u9078\uff0c\u5efa\u8b70\u63d0\u4f9b\u3002\u6b64 ID \u5728\u96c6\u7fa3\u4e2d\u5fc5\u9808\u662f\u552f\u4e00\u7684\u3002\u4f7f\u7528\u6b64 ID \u53ef\u5728\u5c07\u4f86\u7684\u64cd\u4f5c\u4e2d\u8b58\u5225\u9a45\u52d5\u7a0b\u5e8f\u7d44\uff0c\u4f8b\u5982\u8abf\u6574\u7bc0\u9ede\u7d44\u7684\u5927\u5c0f\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0cDataproc \u5c07\u751f\u6210\u7bc0\u9ede\u7d44 ID\u3002\n **\u5176\u4ed6\u9078\u9805** \uff1a\u8acb\u53c3\u95b1 [NodeGroup](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters.nodeGroups?hl=zh-cn#resource:-nodegroup) \u3002\n\u5c07 [EndpointConfig.enableHttpPortAccess](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#EndpointConfig) \u5c6c\u6027\u8a2d\u7f6e\u7232`true`\u4ee5\u5553\u7528 [Dataproc \u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn) \uff0c\u4ee5\u63d0\u4f9b\u5c0d YARN \u7db2\u9801\u754c\u9762\u7684\u8a2a\u554f\u6b0a\u9650\u3002YARN \u754c\u9762\u201c\u61c9\u7528\u201d\u548c\u201c\u8abf\u5ea6\u5668\u201d\u9801\u9762\u6703\u986f\u793a\u96c6\u7fa3\u548c\u4f5c\u696d\u72c0\u614b\u3001\u61c9\u7528\u968a\u5217\u5167\u5b58\u3001\u6838\u5fc3\u5bb9\u91cf\u548c\u5176\u4ed6\u6307\u6a19\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://dataproc.googleapis.com/v1/projects/PROJECT_ID/regions/REGION/clusters\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"clusterName\":\"CLUSTER_NAME\",\n \"config\": {\n \"softwareConfig\": {\n  \"imageVersion\":\"\"\n },\n \"endpointConfig\": {\n  \"enableHttpPortAccess\": true\n },\n \"auxiliaryNodeGroups\": [{\n  \"nodeGroup\":{\n   \"roles\":[\"DRIVER\"],\n   \"nodeGroupConfig\": {\n    \"numInstances\": SIZE\n    }\n   },\n  \"nodeGroupId\": \"NODE_GROUP_ID\"\n }]\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"projectId\": \"PROJECT_ID\",\n \"clusterName\": \"CLUSTER_NAME\",\n \"config\": {\n ...\n \"auxiliaryNodeGroups\": [  {\n  \"nodeGroup\": {\n\"name\": \"projects/PROJECT_ID/regions/REGION/clusters/CLUSTER_NAME/nodeGroups/NODE_GROUP_ID\",\n   \"roles\": [   \"DRIVER\"\n   ],\n   \"nodeGroupConfig\": {\n   \"numInstances\": SIZE,\n   \"instanceNames\": [    \"CLUSTER_NAME-np-q1gp\",\n    \"CLUSTER_NAME-np-xfc0\"\n   ],\n   \"imageUri\": \"https://www.googleapis.com/compute/v1/projects/cloud-dataproc-ci/global/images/dataproc-2-0-deb10-...-rc01\",\n   \"machineTypeUri\": \"https://www.googleapis.com/compute/v1/projects/PROJECT_ID/zones/REGION-a/machineTypes/n1-standard-4\",\n   \"diskConfig\": {\n    \"bootDiskSizeGb\": 1000,\n    \"bootDiskType\": \"pd-standard\"\n   },\n   \"managedGroupConfig\": {\n    \"instanceTemplateName\": \"dataproc-2a8224d2-...\",\n    \"instanceGroupManagerName\": \"dataproc-2a8224d2-...\"\n   },\n   \"minCpuPlatform\": \"AUTOMATIC\",\n   \"preemptibility\": \"NON_PREEMPTIBLE\"\n   }\n  },\n  \"nodeGroupId\": \"NODE_GROUP_ID\"\n  }\n ]\n },\n}\n```### \u7372\u53d6\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u96c6\u7fa3\u5143\u6578\u64da\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [gcloud dataproc node-groups describe](https://cloud.google.com/sdk/gcloud/reference/dataproc/node-groups/describe?hl=zh-cn) \u547d\u4ee4\u6216 [Dataproc API](https://cloud.google.com/dataproc/docs/reference/rest?hl=zh-cn) \u7372\u53d6\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u5143\u6578\u64da\u3002\n```\ngcloud dataproc node-groups describe NODE_GROUP_ID \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION\n```\n **\u5fc5\u9700\u6a19\u8a8c** \uff1a- \uff1a\u60a8\u53ef\u4ee5\u904b\u884c`gcloud dataproc clusters describe` ``\u4f86\u5217\u51fa\u7bc0\u9ede\u7d44 ID\u3002\n- \uff1a\u96c6\u7fa3\u540d\u7a31\u3002\n- \uff1a\u96c6\u7fa3\u5340\u57df\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5fc5\u586b\u3002Google Cloud \u9805\u76ee ID\u3002\n- \uff1a\u5fc5\u586b\u3002\u96c6\u7fa3\u5340\u57df\u3002\n- \uff1a\u5fc5\u586b\u3002\u96c6\u7fa3\u540d\u7a31\u3002\n- \uff1a\u5fc5\u586b\u3002\u60a8\u53ef\u4ee5\u904b\u884c`gcloud dataproc clusters describe` ``\u4f86\u5217\u51fa\u7bc0\u9ede\u7d44 ID\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://dataproc.googleapis.com/v1/projects/PROJECT_ID/regions/REGION/clusters/CLUSTER_NAMEnodeGroups/Node_GROUP_ID\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_ID/regions/REGION/clusters/CLUSTER_NAME/nodeGroups/NODE_GROUP_ID\",\n \"roles\": [ \"DRIVER\"\n ],\n \"nodeGroupConfig\": {\n \"numInstances\": 5,\n \"imageUri\": \"https://www.googleapis.com/compute/v1/projects/cloud-dataproc-ci/global/images/dataproc-2-0-deb10-...-rc01\",\n \"machineTypeUri\": \"https://www.googleapis.com/compute/v1/projects/PROJECT_ID/zones/REGION-a/machineTypes/n1-standard-4\",\n \"diskConfig\": {\n  \"bootDiskSizeGb\": 1000,\n  \"bootDiskType\": \"pd-standard\"\n },\n \"managedGroupConfig\": {\n  \"instanceTemplateName\": \"dataproc-driver-pool-mcia3j656h2fy\",\n  \"instanceGroupManagerName\": \"dataproc-driver-pool-mcia3j656h2fy\"\n },\n \"minCpuPlatform\": \"AUTOMATIC\",\n \"preemptibility\": \"NON_PREEMPTIBLE\"\n }\n}\n```### \u8abf\u6574\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u7684\u5927\u5c0f\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [gcloud dataproc node-groups \u91cd\u65b0\u8abf\u6574](https://cloud.google.com/sdk/gcloud/reference/dataproc/node-groups/resize?hl=zh-cn) \u547d\u4ee4\u6216 [Dataproc API](https://cloud.google.com/dataproc/docs/reference/rest?hl=zh-cn) \u5728\u96c6\u7fa3\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u4e2d\u6dfb\u52a0\u6216\u79fb\u9664\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u3002\n```\ngcloud dataproc node-groups resize NODE_GROUP_ID \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--size=SIZE\n```\n **\u5fc5\u9700\u6a19\u8a8c** \uff1a- \uff1a\u60a8\u53ef\u4ee5\u904b\u884c`gcloud dataproc clusters describe` ``\u4f86\u5217\u51fa\u7bc0\u9ede\u7d44 ID\u3002\n- \uff1a\u96c6\u7fa3\u540d\u7a31\u3002\n- \uff1a\u96c6\u7fa3\u5340\u57df\u3002\n- \uff1a\u6307\u5b9a\u7bc0\u9ede\u7d44\u4e2d\u7684\u65b0\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u6578\u3002\n **\u53ef\u9078\u6a19\u8a8c** \uff1a- `--graceful-decommission-timeout=` ``\uff1a\u5c0d\u7bc0\u9ede\u7d44\u9032\u884c\u7e31\u5411\u7e2e\u5bb9\u6642\uff0c\u60a8\u53ef\u4ee5\u6dfb\u52a0\u6b64\u6a19\u8a8c\u4f86\u6307\u5b9a [\u5b89\u5168\u505c\u7528](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/scaling-clusters?hl=zh-cn#graceful_decommissioning) \uff0c\u4ee5\u907f\u514d\u7acb\u5373\u7d42\u6b62\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u3002 **\u5efa\u8b70** \uff1a\u8a2d\u7f6e\u7684\u8d85\u6642\u6642\u9577\u81f3\u5c11\u7b49\u65bc\u7bc0\u9ede\u7d44\u4e0a\u904b\u884c\u7684\u6700\u9577\u4f5c\u696d\u6642\u9577\uff08\u4e0d\u652f\u6301\u6062\u5fa9\u5931\u6557\u7684\u9a45\u52d5\u7a0b\u5e8f\uff09\u3002\n\u793a\u4f8b\uff1agcloud CLI `NodeGroup` \u7e31\u5411\u64f4\u5bb9\u547d\u4ee4\uff1a\n```\ngcloud dataproc node-groups resize NODE_GROUP_ID \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--size=4\n```\n\u793a\u4f8b\uff1agcloud CLI `NodeGroup` Scale down \u547d\u4ee4\uff1a\n```\ngcloud dataproc node-groups resize NODE_GROUP_ID \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--size=1 \\\n\u00a0\u00a0\u00a0\u00a0--graceful-decommission-timeout=\"100s\"\n```\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5fc5\u586b\u3002Google Cloud \u9805\u76ee ID\u3002\n- \uff1a\u5fc5\u586b\u3002\u96c6\u7fa3\u5340\u57df\u3002\n- \uff1a\u5fc5\u586b\u3002\u60a8\u53ef\u4ee5\u904b\u884c`gcloud dataproc  clusters describe` ``\u4f86\u5217\u51fa\u7bc0\u9ede\u7d44 ID\u3002\n- \uff1a\u5fc5\u586b\u3002\u7bc0\u9ede\u7d44\u4e2d\u7684\u65b0\u7bc0\u9ede\u6578\u3002\n- \uff1a\u53ef\u9078\u3002\u5c0d\u7bc0\u9ede\u7d44\u9032\u884c\u7e2e\u6e1b\u6642\uff0c\u60a8\u53ef\u4ee5\u5728\u8acb\u6c42\u6b63\u6587\u4e2d\u6dfb\u52a0 [gracefulDecommissionTimeout](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters.nodeGroups/resize?hl=zh-cn#body.request_body.FIELDS.graceful_decommission_timeout) \uff0c\u4ee5\u907f\u514d\u7acb\u5373\u7d42\u6b62\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u3002 **\u5efa\u8b70** \uff1a\u8a2d\u7f6e\u7684\u8d85\u6642\u6642\u9577\u81f3\u5c11\u7b49\u65bc\u5728\u7bc0\u9ede\u7d44\u4e0a\u904b\u884c\u7684\u6700\u9577\u4f5c\u696d\u7684\u6642\u9577\uff08\u4e0d\u652f\u6301\u6062\u5fa9\u5931\u6557\u7684\u9a45\u52d5\u7a0b\u5e8f\uff09\u3002\u793a\u4f8b\uff1a```\n{ \"size\": SIZE,\n \"gracefulDecommissionTimeout\": \"TIMEOUT_DURATION\"\n}\n \n```\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://dataproc.googleapis.com/v1/projects/PROJECT_ID/regions/REGION/clusters/CLUSTER_NAME/nodeGroups/Node_GROUP_ID:resize\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"size\": SIZE,\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_ID/regions/REGION/operations/OPERATION_ID\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.dataproc.v1.NodeGroupOperationMetadata\",\n \"nodeGroupId\": \"NODE_GROUP_ID\",\n \"clusterUuid\": \"CLUSTER_UUID\",\n \"status\": {\n  \"state\": \"PENDING\",\n  \"innerState\": \"PENDING\",\n  \"stateStartTime\": \"2022-12-01T23:34:53.064308Z\"\n },\n \"operationType\": \"RESIZE\",\n \"description\": \"Scale \"up or \"down\" a GCE node pool to SIZE nodes.\"\n }\n}\n```### \u522a\u9664\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u96c6\u7fa3\n\u7576\u60a8 [\u522a\u9664 Dataproc \u96c6\u7fa3](https://cloud.google.com/dataproc/docs/guides/manage-cluster?hl=zh-cn#delete_a_cluster) \u6642\uff0c\u7cfb\u7d71\u6703\u522a\u9664\u8207\u8a72\u96c6\u7fa3\u95dc\u806f\u7684\u7bc0\u9ede\u7d44\u3002\n### \u63d0\u4ea4\u4f5c\u696d\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [gcloud dataproc job submit](https://cloud.google.com/sdk/gcloud/reference/dataproc/jobs/submit?hl=zh-cn) \u547d\u4ee4\u6216 [Dataproc API](https://cloud.google.com/dataproc/docs/reference/rest?hl=zh-cn) \uff0c\u901a\u904e\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44 [\u5c07\u4f5c\u696d\u63d0\u4ea4\u5230\u96c6\u7fa3](https://cloud.google.com/dataproc/docs/guides/submit-job?hl=zh-cn#how_to_submit_a_job) \u3002\n```\ngcloud dataproc jobs submit JOB_COMMAND \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-memory-mb=DRIVER_MEMORY \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-vcores=DRIVER_VCORES \\\n\u00a0\u00a0\u00a0\u00a0DATAPROC_FLAGS \\\n\u00a0\u00a0\u00a0\u00a0-- JOB_ARGS\n```\n **\u5fc5\u9700\u6a19\u8a8c** \uff1a- \uff1a\u6307\u5b9a [\u4f5c\u696d\u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/dataproc/jobs/submit?hl=zh-cn#COMMAND) \u3002\n- \uff1a\u96c6\u7fa3\u540d\u7a31\u3002\n- \uff1a\u904b\u884c\u4f5c\u696d\u6240\u9700\u7684\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u5167\u5b58\u91cf\uff08\u4ee5 MB \u7232\u55ae\u4f4d\uff0c\u8acb\u53c3\u95b1 [Yarn \u5167\u5b58\u63a7\u5236](https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/NodeManagerCGroupsMemory.html) \uff09\u3002\n- \uff1a\u904b\u884c\u4f5c\u696d\u6240\u9700\u7684 vCPU \u6578\u91cf\u3002\n **\u5176\u4ed6\u6a19\u8a8c** \uff1a- \uff1a\u6dfb\u52a0\u8207\u4f5c\u696d\u985e\u578b\u76f8\u95dc\u7684\u4efb\u4f55\u5176\u4ed6 [gcloud dataproc \u4f5c\u696d\u63d0\u4ea4](https://cloud.google.com/sdk/gcloud/reference/dataproc/jobs/submit?hl=zh-cn) \u6a19\u8a8c\u3002\n- \uff1a\u6dfb\u52a0\u4efb\u4f55\u53c3\u6578\uff08\u4f4d\u65bc\u8981\u50b3\u905e\u7d66\u4f5c\u696d\u7684`--`\u4e4b\u5f8c\uff09\u3002\n **\u793a\u4f8b** \uff1a\u60a8\u53ef\u4ee5\u5728 Dataproc \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u96c6\u7fa3\u4e0a\u7684 [SSH \u7d42\u7aef\u6703\u8a71](https://cloud.google.com/dataproc/docs/concepts/accessing/ssh?hl=zh-cn) \u4e2d\u904b\u884c\u4ee5\u4e0b\u793a\u4f8b\u3002- \u7528\u65bc\u4f30\u7b97 `pi` \u503c\u7684 Spark \u4f5c\u696d\uff1a```\ngcloud dataproc jobs submit spark \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-memory-mb=2048 \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-vcores=2 \\\n\u00a0\u00a0\u00a0\u00a0--class=org.apache.spark.examples.SparkPi \\\n\u00a0\u00a0\u00a0\u00a0--jars=file:///usr/lib/spark/examples/jars/spark-examples.jar \\\n\u00a0\u00a0\u00a0\u00a0-- 1000\n```\n- Spark Wordcount \u4f5c\u696d\uff1a```\ngcloud dataproc jobs submit spark \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-memory-mb=2048 \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-vcores=2 \\\n\u00a0\u00a0\u00a0\u00a0--class=org.apache.spark.examples.JavaWordCount \\\n\u00a0\u00a0\u00a0\u00a0--jars=file:///usr/lib/spark/examples/jars/spark-examples.jar \\\n\u00a0\u00a0\u00a0\u00a0-- 'gs://apache-beam-samples/shakespeare/macbeth.txt'\n```\n- \u7528\u65bc\u4f30\u7b97 `pi` \u7684\u503c\u7684 PySpark \u4f5c\u696d\uff1a```\ngcloud dataproc jobs submit pyspark \\\n\u00a0\u00a0\u00a0\u00a0file:///usr/lib/spark/examples/src/main/python/pi.py \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-memory-mb=2048 \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-vcores=2 \\\n\u00a0\u00a0\u00a0\u00a0-- 1000\n```\n- Hadoop [TeraGen](https://hadoop.apache.org/docs/r3.2.0/api/org/apache/hadoop/examples/terasort/package-summary.html) MapReduce \u4f5c\u696d\uff1a```\ngcloud dataproc jobs submit hadoop \\\n\u00a0\u00a0\u00a0\u00a0--cluster=CLUSTER_NAME \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-memory-mb=2048 \\\n\u00a0\u00a0\u00a0\u00a0--driver-required-vcores=2 \\\n\u00a0\u00a0\u00a0\u00a0--jar file:///usr/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar \\\n\u00a0\u00a0\u00a0\u00a0-- teragen 1000 \\\n\u00a0\u00a0\u00a0\u00a0hdfs:///gen1/test\n```\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5fc5\u586b\u3002Google Cloud \u9805\u76ee ID\u3002\n- \uff1a\u5fc5\u586b\u3002Dataproc \u96c6\u7fa3 [\u5340\u57df](https://cloud.google.com/compute/docs/regions-zones/regions-zones?hl=zh-cn#available) \n- \uff1a\u5fc5\u586b\u3002\u96c6\u7fa3\u540d\u7a31\uff0c\u8a72\u540d\u7a31\u5728\u9805\u76ee\u4e2d\u5fc5\u9808\u662f\u552f\u4e00\u7684\u3002\u540d\u7a31\u5fc5\u9808\u4ee5\u5c0f\u5beb\u5b57\u6bcd\u958b\u982d\uff0c\u6700\u591a\u53ef\u4ee5\u5305\u542b 51 \u500b\u5c0f\u5beb\u5b57\u6bcd\u3001\u6578\u5b57\u548c\u9023\u5b57\u7b26\u3002\u4f46\u4e0d\u80fd\u4ee5\u9023\u5b57\u7b26\u7d50\u5c3e\u3002\u5df2\u522a\u9664\u96c6\u7fa3\u7684\u540d\u7a31\u53ef\u4ee5\u91cd\u7528\u3002\n- \uff1a\u5fc5\u586b\u3002\u904b\u884c\u4f5c\u696d\u6240\u9700\u7684\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u5167\u5b58\u91cf\uff08\u4ee5 MB \u7232\u55ae\u4f4d\uff0c\u8acb\u53c3\u95b1 [Yarn \u5167\u5b58\u63a7\u5236](https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/NodeManagerCGroupsMemory.html) \uff09\u3002\n- \uff1a\u5fc5\u586b\u3002\u904b\u884c\u4f5c\u696d\u6240\u9700\u7684 vCPU \u6578\u91cf\u3002\n **\u5176\u4ed6\u5b57\u6bb5** \n\uff1a\u6dfb\u52a0\u8207\n [\u4f5c\u696d\u985e\u578b](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.jobs?hl=zh-cn#Job.FIELDS.oneof_type_job) \n\u548c\u4f5c\u696d\u53c3\u6578\u76f8\u95dc\u7684\u5176\u4ed6\u5b57\u6bb5\uff08\u793a\u4f8b\u8acb\u6c42\u5305\u542b\u63d0\u4ea4\u4f30\u7b97\n`pi`\n\u503c\u7684 Spark \u4f5c\u696d\u6240\u9700\u7684\u5b57\u6bb5\uff09\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://dataproc.googleapis.com/v1/projects/PROJECT_ID/regions/REGION/jobs:submit\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"job\": {\n \"placement\": {\n \"clusterName\": \"CLUSTER_NAME\",\n },\n \"driverSchedulingConfig\": {\n  \"memoryMb]\": DRIVER_MEMORY,\n  \"vcores\": DRIVER_VCORES\n },\n \"sparkJob\": {\n  \"jarFileUris\": \"file:///usr/lib/spark/examples/jars/spark-examples.jar\",\n  \"args\": [  \"10000\"\n  ],\n  \"mainClass\": \"org.apache.spark.examples.SparkPi\"\n }\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"reference\": {\n \"projectId\": \"PROJECT_ID\",\n \"jobId\": \"job-id\"\n },\n \"placement\": {\n \"clusterName\": \"CLUSTER_NAME\",\n \"clusterUuid\": \"cluster-Uuid\"\n },\n \"sparkJob\": {\n \"mainClass\": \"org.apache.spark.examples.SparkPi\",\n \"args\": [  \"1000\"\n ],\n \"jarFileUris\": [  \"file:///usr/lib/spark/examples/jars/spark-examples.jar\"\n ]\n },\n \"status\": {\n \"state\": \"PENDING\",\n \"stateStartTime\": \"start-time\"\n },\n \"jobUuid\": \"job-Uuid\"\n}\n```\n## \u67e5\u770b\u4f5c\u696d\u65e5\u8a8c\n\u5982\u9700\u67e5\u770b\u4f5c\u696d\u72c0\u614b\u4e26\u5e6b\u52a9\u8abf\u8a66\u4f5c\u696d\u554f\u984c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 gcloud CLI \u6216 Google Cloud \u63a7\u5236\u6aaf\u67e5\u770b\u9a45\u52d5\u7a0b\u5e8f\u65e5\u8a8c\u3002\n\u5728\u4f5c\u696d\u57f7\u884c\u671f\u9593\uff0c\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u65e5\u8a8c\u6703\u6d41\u5f0f\u50b3\u8f38\u5230 gcloud CLI \u8f38\u51fa\u6216 Google Cloud \u63a7\u5236\u6aaf\u3002\u9a45\u52d5\u7a0b\u5e8f\u65e5\u8a8c\u6703\u4fdd\u7559\u5728 Cloud Storage \u7684 Dataproc \u96c6\u7fa3 [\u66ab\u5b58\u5b58\u5132\u6876](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/staging-bucket?hl=zh-cn) \u4e2d\u3002\n\u904b\u884c\u4ee5\u4e0b gcloud CLI \u547d\u4ee4\u4ee5\u5217\u51fa Cloud Storage \u4e2d\u9a45\u52d5\u7a0b\u5e8f\u65e5\u8a8c\u7684\u4f4d\u7f6e\uff1a\n```\ngcloud dataproc jobs describe JOB_ID \\\n\u00a0\u00a0\u00a0\u00a0--region=REGION\n \n```\n\u9a45\u52d5\u7a0b\u5e8f\u65e5\u8a8c\u7684 Cloud Storage \u4f4d\u7f6e\u5728\u547d\u4ee4\u8f38\u51fa\u4e2d\u4ee5 `driverOutputResourceUri` \u7684\u5f62\u5f0f\u5217\u51fa\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a\n```\ndriverOutputResourceUri: gs://CLUSTER_STAGING_BUCKET/google-cloud-dataproc-metainfo/CLUSTER_UUID/jobs/JOB_ID\n```\u5982\u9700\u67e5\u770b\u7bc0\u9ede\u7d44\u96c6\u7fa3\u65e5\u8a8c\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- [\u5553\u7528 Logging](https://cloud.google.com/dataproc/docs/guides/logging?hl=zh-cn) \u3002\n- \u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b [\u65e5\u8a8c\u700f\u89bd\u5668](https://console.cloud.google.com/logs/query?hl=zh-cn) \u67e5\u8a62\u683c\u5f0f\u67e5\u627e\u65e5\u8a8c\uff1a```\nresource.type=\"cloud_dataproc_cluster\"\nresource.labels.project_id=\"PROJECT_ID\"\nresource.labels.cluster_name=\"CLUSTER_NAME\"\nlog_name=\"projects/PROJECT_ID/logs/LOG_TYPE>\"\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1aGoogle Cloud \u9805\u76ee ID\u3002\n- \uff1a\u96c6\u7fa3\u540d\u7a31\u3002\n- \uff1a- Yarn \u7528\u6236\u65e5\u8a8c\uff1a`yarn-userlogs`\n- Yarn \u8cc7\u6e90\u7ba1\u7406\u5668\u65e5\u8a8c\uff1a`hadoop-yarn-resourcemanager`\n- Yarn \u7bc0\u9ede\u7ba1\u7406\u5668\u65e5\u8a8c\uff1a`hadoop-yarn-nodemanager`\n## \u76e3\u63a7\u6307\u6a19\nDataproc \u7bc0\u9ede\u7d44\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u5728 `dataproc-driverpool` \u5206\u5340\u4e0b\u7684 `dataproc-driverpool-driver-queue` \u5b50\u968a\u5217\u4e2d\u904b\u884c\u3002\n### \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u6307\u6a19\n\u4e0b\u8868\u5217\u51fa\u4e86\u95dc\u806f\u7684\u7bc0\u9ede\u7d44\u9a45\u52d5\u7a0b\u5e8f\u6307\u6a19\uff0c\u9019\u4e9b\u6307\u6a19\u662f\u91dd\u5c0d\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u9ed8\u8a8d\u6536\u96c6\u7684\u3002\n| \u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u6307\u6a19            | \u8aaa\u660e                       |\n|:---------------------------------------------------------------|:-----------------------------------------------------------------------------------------------|\n| yarn:ResourceManager:DriverPoolsQueueMetrics:AvailableMB  | dataproc-driverpool-driver-queue \u4e2d dataproc-driverpool \u5206\u5340\u4e0b\u7684\u53ef\u7528\u5167\u5b58\u91cf\uff08\u4ee5 MB \u7232\u55ae\u4f4d\uff09\u3002 |\n| yarn:ResourceManager:DriverPoolsQueueMetrics:PendingContainers | dataproc-driverpool-driver-queue \u4e2d dataproc-driverpool \u5206\u5340\u4e0b\u5f85\u8655\u7406\uff08\u5df2\u52a0\u5165\u968a\u5217\uff09\u7684\u5bb9\u5668\u6578\u91cf\u3002 |\n### \u5b50\u968a\u5217\u6307\u6a19\n\u4e0b\u8868\u5217\u51fa\u4e86\u5b50\u968a\u5217\u6307\u6a19\u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u7cfb\u7d71\u6703\u6536\u96c6\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u7684\u6307\u6a19\uff0c\u4e26\u5728\u4efb\u4f55 Dataproc \u96c6\u7fa3\u4e0a\u5553\u7528\u9019\u4e9b\u6307\u6a19\u4ee5\u9032\u884c\u6536\u96c6\u3002\n| \u5b50\u968a\u5217\u6307\u6a19            | \u8aaa\u660e                |\n|:---------------------------------------------------------|:------------------------------------------------------------------|\n| nan              | nan                |\n| yarn:ResourceManager:ChildQueueMetrics:AvailableMB  | \u6b64\u968a\u5217\u4e2d\u9ed8\u8a8d\u5206\u5340\u4e0b\u7684\u53ef\u7528\u5167\u5b58\u91cf\uff08\u4ee5 MB \u7232\u55ae\u4f4d\uff09\u3002     |\n| yarn:ResourceManager:ChildQueueMetrics:PendingContainers | \u6b64\u968a\u5217\u4e2d\u9ed8\u8a8d\u5206\u5340\u4e0b\u5f85\u8655\u7406\uff08\u5df2\u52a0\u5165\u968a\u5217\uff09\u7684\u5bb9\u5668\u6578\u3002     |\n| yarn:ResourceManager:ChildQueueMetrics:running_0   | \u6b64\u968a\u5217\u4e2d\u6240\u6709\u5206\u5340\u4e0b\u904b\u884c\u6642\u6642\u9577\u4ecb\u65bc 0 \u5230 60 \u5206\u9418\u4e4b\u9593\u7684\u4f5c\u696d\u6578\u91cf\u3002  |\n| yarn:ResourceManager:ChildQueueMetrics:running_60  | \u6b64\u968a\u5217\u4e2d\u6240\u6709\u5206\u5340\u4e0b\u904b\u884c\u6642\u6642\u9577\u4ecb\u65bc 60 \u5230 300 \u5206\u9418\u4e4b\u9593\u7684\u4f5c\u696d\u6578\u91cf\u3002 |\n| yarn:ResourceManager:ChildQueueMetrics:running_300  | \u6b64\u968a\u5217\u4e2d\u6240\u6709\u5206\u5340\u4e0b\u904b\u884c\u6642\u6642\u9577\u4ecb\u65bc 300 \u5230 1440 \u5206\u9418\u4e4b\u9593\u7684\u4f5c\u696d\u6578\u91cf\u3002 |\n| yarn:ResourceManager:ChildQueueMetrics:running_1440  | \u6b64\u968a\u5217\u4e2d\u6240\u6709\u5206\u5340\u4e0b\u904b\u884c\u6642\u6642\u9577\u8d85\u904e 1440 \u5206\u9418\u7684\u4f5c\u696d\u6578\u91cf\u3002   |\n| yarn:ResourceManager:ChildQueueMetrics:AppsSubmitted  | \u63d0\u4ea4\u5230\u6b64\u968a\u5217\uff08\u6240\u6709\u5206\u5340\u4e0b\uff09\u7684\u61c9\u7528\u6578\u3002        |\n\u5982\u9700\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u67e5\u770b `YARN ChildQueueMetrics` \u548c `DriverPoolsQueueMetrics` \uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5728 [Metrics Explorer](https://console.cloud.google.com/monitoring/metrics-explorer?hl=zh-cn) \u4e2d\uff0c\u9078\u64c7 **\u865b\u64ec\u6a5f\u5be6\u4f8b \u2192 \u81ea\u5b9a\u7fa9** \u8cc7\u6e90\u3002\n## \u7bc0\u9ede\u7d44\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u8abf\u8a66\n\u672c\u90e8\u5206\u4ecb\u7d39\u9a45\u52d5\u7a0b\u5e8f\u7bc0\u9ede\u7d44\u689d\u4ef6\u548c\u932f\u8aa4\uff0c\u4ee5\u53ca\u4fee\u6b63\u76f8\u61c9\u689d\u4ef6\u6216\u932f\u8aa4\u7684\u5efa\u8b70\u3002\n### \u689d\u4ef6\n- **\u689d\u4ef6** \uff1a `yarn:ResourceManager:DriverPoolsQueueMetrics:AvailableMB` \u5373\u5c07\u9054\u5230 `0` \u3002\u9019\u8868\u793a\u96c6\u7fa3\u9a45\u52d5\u7a0b\u5e8f\u6c60\u968a\u5217\u5167\u5b58\u4e0d\u8db3\u3002 **\u5efa\u8b70** \uff1a\u7e31\u5411\u64f4\u5bb9\u9a45\u52d5\u7a0b\u5e8f\u6c60\u7684\u5927\u5c0f\u3002\n- **\u689d\u4ef6** \uff1a `yarn:ResourceManager:DriverPoolsQueueMetrics:PendingContainers` \u5927\u65bc 0\u3002\u9019\u53ef\u80fd\u8868\u793a\u96c6\u7fa3\u9a45\u52d5\u7a0b\u5e8f\u6c60\u968a\u5217\u5167\u5b58\u4e0d\u8db3\uff0c\u4e14 YARN \u6b63\u5728\u5c07\u4f5c\u696d\u52a0\u5165\u968a\u5217\u3002 **\u5efa\u8b70** \uff1a\u7e31\u5411\u64f4\u5bb9\u9a45\u52d5\u7a0b\u5e8f\u6c60\u7684\u5927\u5c0f\u3002\n### \u932f\u8aa4\n- **\u932f\u8aa4** \uff1a `Cluster <var>CLUSTER_NAME</var> requires driver scheduling config to run SPARK job because it contains a node pool with role DRIVER. Positive values are required for all driver scheduling config values.` **\u5efa\u8b70** \uff1a\u5c07 `driver-required-memory-mb` \u548c `driver-required-vcores` \u8a2d\u7f6e\u7232\u6b63\u6578\u3002\n- **\u932f\u8aa4** \uff1a `Container exited with a non-zero exit code 137` \u3002 **\u5efa\u8b70** \uff1a\u589e\u52a0 `driver-required-memory-mb` \u4ee5\u589e\u52a0\u4f5c\u696d\u5167\u5b58\u7528\u91cf\u3002", "guide": "Dataproc"}