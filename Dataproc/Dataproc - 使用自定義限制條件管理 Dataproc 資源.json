{"title": "Dataproc - \u4f7f\u7528\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u7ba1\u7406 Dataproc \u8cc7\u6e90", "url": "https://cloud.google.com/dataproc/docs/concepts/dataproc-custom-constraints?hl=zh-cn", "abstract": "# Dataproc - \u4f7f\u7528\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u7ba1\u7406 Dataproc \u8cc7\u6e90\n# \u4f7f\u7528\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u7ba1\u7406 Dataproc \u8cc7\u6e90\nGoogle Cloud \u7d44\u7e54\u653f\u7b56\u53ef\u8b93\u60a8\u4ee5\u7de8\u7a0b\u65b9\u5f0f\u96c6\u4e2d\u63a7\u5236\u7d44\u7e54\u7684\u8cc7\u6e90\u3002\u4f5c\u7232 [\u7d44\u7e54\u653f\u7b56\u7ba1\u7406\u54e1](https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints?hl=zh-cn#add-org-policy-admin) \uff0c\u60a8\u53ef\u4ee5\u5b9a\u7fa9\u7d44\u7e54\u653f\u7b56\uff0c\u9019\u662f\u4e00\u7d44\u7a31\u7232\u9650\u5236\u689d\u4ef6\u7684\u9650\u5236\uff0c\u6703\u61c9\u7528\u65bc [Google Cloud \u8cc7\u6e90\u5c64\u6b21\u7d50\u69cb](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy?hl=zh-cn) \u4e2d\u7684 Google Cloud \u8cc7\u6e90\u53ca\u5176\u5f8c\u4ee3\u3002\u60a8\u53ef\u4ee5\u5728\u7d44\u7e54\u3001\u6587\u4ef6\u593e\u6216\u9805\u76ee\u7d1a\u5f37\u5236\u57f7\u884c\u7d44\u7e54\u653f\u7b56\u3002\n\u7d44\u7e54\u653f\u7b56\u7232\u5404\u7a2e Google Cloud \u670d\u52d9\u63d0\u4f9b [\u9810\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints?hl=zh-cn) \u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u60f3\u8981\u66f4\u7cbe\u7d30\u5730\u63a7\u5236\u548c\u81ea\u5b9a\u7fa9\u7d44\u7e54\u653f\u7b56\u4e2d\u53d7\u9650\u7684\u7279\u5b9a\u5b57\u6bb5\uff0c\u9084\u53ef\u4ee5\u5275\u5efa\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u4e26\u5728\u81ea\u5b9a\u7fa9\u7d44\u7e54\u653f\u7b56\u4e2d\u4f7f\u7528\u9019\u4e9b\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u3002\n", "content": "## \u512a\u52e2\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u7fa9\u7d44\u7e54\u653f\u7b56\u4f86\u5141\u8a31\u6216\u62d2\u7d55 Dataproc \u96c6\u7fa3\u4e0a\u7684\u5177\u9ad4\u64cd\u4f5c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5275\u5efa\u6216\u66f4\u65b0\u96c6\u7fa3\u7684\u8acb\u6c42\u672a\u80fd\u6eff\u8db3\u7d44\u7e54\u653f\u7b56\u8a2d\u7f6e\u7684\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u9a57\u8b49\uff0c\u8a72\u8acb\u6c42\u5c07\u5931\u6557\uff0c\u4e26\u5411\u8abf\u7528\u65b9\u8fd4\u56de\u932f\u8aa4\u3002\n## \u653f\u7b56\u7e7c\u627f\n\u5982\u679c\u60a8\u5c0d\u8cc7\u6e90\u5f37\u5236\u57f7\u884c\u653f\u7b56\uff0c\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u8a72\u8cc7\u6e90\u7684\u5f8c\u4ee3\u6703\u7e7c\u627f\u7d44\u7e54\u653f\u7b56\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5c0d\u67d0\u500b\u6587\u4ef6\u593e\u5f37\u5236\u57f7\u884c\u4e00\u9805\u653f\u7b56\uff0cGoogle Cloud \u6703\u5c0d\u8a72\u6587\u4ef6\u593e\u4e2d\u7684\u6240\u6709\u9805\u76ee\u5f37\u5236\u57f7\u884c\u8a72\u653f\u7b56\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6b64\u884c\u7232\u53ca\u5176\u66f4\u6539\u65b9\u5f0f\uff0c\u8acb\u53c3\u95b1 [\u5c64\u6b21\u7d50\u69cb\u8a55\u4f30\u898f\u5247](https://cloud.google.com/resource-manager/docs/organization-policy/understanding-hierarchy?hl=zh-cn#disallow_inheritance) \u3002\n## \u50f9\u683c\n\u7d44\u7e54\u653f\u7b56\u670d\u52d9\uff08\u5305\u62ec\u9810\u5b9a\u7fa9\u7d44\u7e54\u653f\u7b56\u548c\u81ea\u5b9a\u7fa9\u7d44\u7e54\u653f\u7b56\uff09\u53ef\u514d\u8cbb\u4f7f\u7528\u3002\n## \u6e96\u5099\u5de5\u4f5c\n- **\u8a2d\u7f6e\u9805\u76ee** - Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u78ba\u4fdd\u60a8\u77e5\u9053\u60a8\u7684 [\u7d44\u7e54 ID](https://cloud.google.com/resource-manager/docs/creating-managing-organization?hl=zh-cn#retrieving_your_organization_id) \u3002### \u6240\u9700\u7684\u89d2\u8272\n\u5982\u9700\u7372\u53d6\u7ba1\u7406\u7d44\u7e54\u653f\u7b56\u6240\u9700\u7684\u6b0a\u9650\uff0c\u8acb\u8b93\u7ba1\u7406\u54e1\u6388\u4e88\u60a8\u4ee5\u4e0b IAM \u89d2\u8272\uff1a\n- \u7d44\u7e54\u8cc7\u6e90\u7684 [Organization Policy Administrator ](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#orgpolicy.policyAdmin) (`roles/orgpolicy.policyAdmin`)\n- \u5982\u9700\u5275\u5efa\u6216\u66f4\u65b0 Dataproc \u96c6\u7fa3\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u91dd\u5c0d\u9805\u76ee\u8cc7\u6e90\u7684 [Dataproc Admin \u6216 Dataproc Editor](https://cloud.google.com/dataproc/docs/concepts/iam/iam?hl=zh-cn#roles) \uff08`roles/dataproc.admin`\u6216`roles/dataproc.editor`\uff09\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u6388\u4e88\u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [\u7ba1\u7406\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/iam/docs/granting-changing-revoking-access?hl=zh-cn) \u3002\n\u9019\u4e9b\u9810\u5b9a\u7fa9\u89d2\u8272\u5305\u542b\u7ba1\u7406\u7d44\u7e54\u653f\u7b56\u6240\u9700\u7684\u6b0a\u9650\u3002\u5982\u9700\u67e5\u770b\u6240\u9700\u7684\u78ba\u5207\u6b0a\u9650\uff0c\u8acb\u5c55\u958b **\u6240\u9700\u6b0a\u9650** \u90e8\u5206\uff1a\n\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528 [\u81ea\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/creating-custom-roles?hl=zh-cn) \u6216\u5176\u4ed6 [\u9810\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn) \u4f86\u7372\u53d6\u9019\u4e9b\u6b0a\u9650\u3002\n## \u5275\u5efa\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\n\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u5728 YAML \u6587\u4ef6\u4e2d\u7531\u61c9\u7528\u8a72\u9650\u5236\u689d\u4ef6\u7684\u8cc7\u6e90\u3001\u65b9\u6cd5\u3001\u689d\u4ef6\u548c\u64cd\u4f5c\u5b9a\u7fa9\u3002Dataproc \u652f\u6301\u61c9\u7528\u65bc `CLUSTER` \u8cc7\u6e90\u7684 `CREATE` \u548c `UPDATE` \u65b9\u6cd5\u7684\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\uff08\u8acb\u53c3\u95b1 [Dataproc \u8cc7\u6e90\u548c\u64cd\u4f5c\u9650\u5236\u689d\u4ef6](#supported_resources) \uff09\u3002\n\u5982\u9700\u7232 Dataproc \u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u5275\u5efa YAML \u6587\u4ef6\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n```\nname: organizations/ORGANIZATION_ID/customConstraints/CONSTRAINT_NAMEresourceTypes:- dataproc.googleapis.com/ClustermethodTypes:- METHODcondition: \"CONDITION\"actionType: ACTIONdisplayName: DISPLAY_NAMEdescription: DESCRIPTION\n```\n\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- `` \uff1a\u60a8\u7684\u7d44\u7e54 ID\uff0c\u4f8b\u5982 `123456789` \u3002\n- `` \uff1a\u65b0\u7684\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u7684\u540d\u7a31\u3002 \u6b64\u5b57\u6bb5\u7684\u9577\u5ea6\u4e0a\u9650\u7232 100 \u500b\u5b57\u7b26\uff0c\u4e0d\u8a08\u7b97\u524d\u7db4\uff08\u4f8b\u5982\uff0c `organizations/123456789/customConstraints/` \uff09\u3002\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u5fc5\u9808\u4ee5 `custom.` \u958b\u982d\u3002\u4f8b\u5982 `custom.dataprocEnableComponentGateway` \u3002- ``\uff1a\u5275\u5efa\u96c6\u7fa3\u5275\u5efa\u9650\u5236\u689d\u4ef6\u6642\uff0c\u6307\u5b9a`CREATE`\u3002\u5275\u5efa\u96c6\u7fa3`UPDATE`\u9650\u5236\u689d\u4ef6\u6642\uff0c\u8acb\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a\u9019\u5169\u8005\uff1a```\nmethodTypes:\n- CREATE\n- UPDATE\n```\n- `` \uff1a\u91dd\u5c0d\u53d7\u652f\u6301\u7684\u670d\u52d9\u8cc7\u6e90\u7684\u8868\u793a\u6cd5\u7de8\u5beb\u7684 [CEL \u689d\u4ef6](https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-custom-constraints?hl=zh-cn#common_expression_language) \u3002\u6b64\u5b57\u6bb5\u7684\u6700\u5927\u9577\u5ea6\u7232 1,000 \u500b\u5b57\u7b26\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u53ef\u7528\u65bc\u5beb\u5165\u689d\u4ef6\u7684\u8cc7\u6e90\uff0c\u8acb\u53c3\u95b1 [\u652f\u6301\u7684\u8cc7\u6e90](#supported_resources) \u3002 \u4f8b\u5982 `\"resource.config.endpointConfig.enableHttpPortAccess==true\"` \u3002\n- `` \uff1a\u6eff\u8db3 `condition` \u6642\u8981\u57f7\u884c\u7684\u64cd\u4f5c\u3002\u53ef\u4ee5\u662f `ALLOW` \u6216 `DENY` \u3002\n- `` \uff1a\u9650\u5236\u689d\u4ef6\u7684\u6613\u8a18\u540d\u7a31\uff0c\u4f8b\u5982\u201c\u5f37\u5236\u5553\u7528 Dataproc \u7d44\u4ef6\u7db2\u95dc\u201d\u3002\u6b64\u5b57\u6bb5\u7684\u6700\u5927\u9577\u5ea6\u7232 200 \u500b\u5b57\u7b26\u3002\n- `` \uff1a\u6709\u95dc\u9650\u5236\u689d\u4ef6\u7684\u76f4\u89c0\u8aaa\u660e\uff0c\u5728\u9055\u53cd\u653f\u7b56\u6642\u986f\u793a\u7232\u932f\u8aa4\u6d88\u606f\uff0c\u4f8b\u5982\u201c\u50c5\u5141\u8a31\u5728\u5df2\u5553\u7528\u7d44\u4ef6\u7db2\u95dc\u7684\u60c5\u6cc1\u4e0b\u5275\u5efa Dataproc \u96c6\u7fa3\u201d\u3002\u6b64\u5b57\u6bb5\u7684\u6700\u5927\u9577\u5ea6\u7232 2000 \u500b\u5b57\u7b26\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5275\u5efa\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\uff0c\u8acb\u53c3\u95b1 [\u5b9a\u7fa9\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6](https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-custom-constraints?hl=zh-cn#defining_custom_constraints) \u3002\n## \u8a2d\u7f6e\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\n`gcloud org-policies set-custom-constraint`\n```\ngcloud org-policies set-custom-constraint CONSTRAINT_PATH\n```\n``\n`/home/user/customconstraint.yaml`\n`gcloud org-policies list-custom-constraints`\n```\ngcloud org-policies list-custom-constraints --organization=ORGANIZATION_ID\n```\n``\n[\u67e5\u770b\u7d44\u7e54\u653f\u7b56](https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-policies?hl=zh-cn#viewing_organization_policies)\n## \u5f37\u5236\u57f7\u884c\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\n\u5982\u9700\u5f37\u5236\u57f7\u884c\u5e03\u723e\u503c\u9650\u5236\u689d\u4ef6\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u6253\u958b Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684 **\u7d44\u7e54\u653f\u7b56** \u9801\u9762\u3002 [\u6253\u958b\u201c\u7d44\u7e54\u653f\u7b56\u201d\u9801\u9762](https://console.cloud.google.com/iam-admin/orgpolicies?hl=zh-cn) \n- \u9078\u64c7\u9801\u9762\u9802\u90e8\u7684\u9805\u76ee\u9078\u64c7\u5668\u3002\n- \u5f9e\u9805\u76ee\u9078\u64c7\u5668\u4e2d\uff0c\u9078\u64c7\u8981\u7232\u5176\u8a2d\u7f6e\u7d44\u7e54\u653f\u7b56\u7684\u9805\u76ee\u3002\n- \u5f9e **\u7d44\u7e54\u653f\u7b56** \u9801\u9762\u7684\u5217\u8868\u4e2d\u9078\u64c7\u9650\u5236\u689d\u4ef6\u3002   \u6b64\u6642\u61c9\u986f\u793a\u8a72\u9650\u5236\u689d\u4ef6\u7684 **\u653f\u7b56\u8a73\u60c5** \u9801\u9762\u3002\n- \u5982\u9700\u7232\u8a72\u8cc7\u6e90\u81ea\u5b9a\u7fa9\u7d44\u7e54\u653f\u7b56\uff0c\u8acb\u9ede\u64ca **\u7ba1\u7406\u653f\u7b56** \u3002\n- \u5728 **\u4fee\u6539\u653f\u7b56** \u9801\u9762\u4e0a\uff0c\u9078\u64c7 **\u81ea\u5b9a\u7fa9** \u3002\n- \u9ede\u64ca **\u6dfb\u52a0\u898f\u5247** \u3002\n- \u5728 **\u5f37\u5236\u57f7\u884c** \u4e0b\uff0c\u9078\u64c7\u61c9\u958b\u5553\u6216\u95dc\u9589\u6b64\u7d44\u7e54\u653f\u7b56\u7684\u5f37\u5236\u57f7\u884c\u529f\u80fd\u3002\n- \uff08\u53ef\u9078\uff09\u5982\u9700\u4f7f\u7d44\u7e54\u653f\u7b56\u6210\u7232\u57fa\u65bc\u67d0\u500b\u6a19\u8a18\u7684\u689d\u4ef6\u6027\u653f\u7b56\uff0c\u8acb\u9ede\u64ca **\u6dfb\u52a0\u689d\u4ef6** \u3002\u8acb\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u5411\u7d44\u7e54\u653f\u7b56\u6dfb\u52a0\u689d\u4ef6\u898f\u5247\uff0c\u5247\u5fc5\u9808\u81f3\u5c11\u6dfb\u52a0\u4e00\u500b\u7121\u689d\u4ef6\u898f\u5247\uff0c\u5426\u5247\u7121\u6cd5\u4fdd\u5b58\u653f\u7b56\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528\u6a19\u8a18\u8a2d\u7f6e\u7d44\u7e54\u653f\u7b56](https://cloud.google.com/resource-manager/docs/organization-policy/tags-organization-policy?hl=zh-cn) \u3002\n- \u5982\u679c\u9019\u662f\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\uff0c\u60a8\u53ef\u4ee5\u9ede\u64ca **\u6e2c\u8a66\u66f4\u6539** \u4f86\u6a21\u64ec\u6b64\u7d44\u7e54\u653f\u7b56\u7684\u6548\u679c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 Policy Simulator \u6e2c\u8a66\u7d44\u7e54\u653f\u7b56\u66f4\u6539](https://cloud.google.com/policy-intelligence/docs/test-organization-policies?hl=zh-cn) \u3002\n- \u5982\u9700\u5b8c\u6210\u4e26\u61c9\u7528\u7d44\u7e54\u653f\u7b56\uff0c\u8acb\u9ede\u64ca **\u8a2d\u7f6e\u653f\u7b56** \u3002\u6b64\u653f\u7b56\u6700\u591a\u9700\u8981 15 \u5206\u9418\u624d\u80fd\u751f\u6548\u3002\n\u5982\u9700\u5275\u5efa\u5f37\u5236\u57f7\u884c\u5e03\u723e\u503c\u9650\u5236\u689d\u4ef6\u7684\u7d44\u7e54\u653f\u7b56\uff0c\u8acb\u5275\u5efa\u5f15\u7528\u8a72\u9650\u5236\u689d\u4ef6\u7684 YAML \u653f\u7b56\u6587\u4ef6\uff1a\n```\n\u00a0 \u00a0 \u00a0 name: projects/PROJECT_ID/policies/CONSTRAINT_NAME\u00a0 \u00a0 \u00a0 spec:\u00a0 \u00a0 \u00a0 \u00a0 rules:\u00a0 \u00a0 \u00a0 \u00a0 - enforce: true\u00a0 \u00a0 \n```\n\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u8981\u5c0d\u5176\u5be6\u65bd\u9650\u5236\u689d\u4ef6\u7684\u9805\u76ee\u3002\n- ``\uff1a\u60a8\u7232\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u5b9a\u7fa9\u7684\u540d\u7a31\u3002\u4f8b\u5982\uff0c`custom.dataprocEnableComponentGateway`\u3002\n\u5982\u9700\u5f37\u5236\u57f7\u884c\u5305\u542b\u9650\u5236\u689d\u4ef6\u7684\u7d44\u7e54\u653f\u7b56\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\n\u00a0 \u00a0 gcloud org-policies set-policy POLICY_PATH\u00a0 \u00a0 \n```\n\u5c07 `` \u66ff\u63db\u7232\u7d44\u7e54\u653f\u7b56 YAML \u6587\u4ef6\u7684\u5b8c\u6574\u8def\u5f91\u3002\u8a72\u653f\u7b56\u5c07\u5728 15 \u5206\u9418\u5167\u751f\u6548\u3002\n## \u6e2c\u8a66\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\n\u4ee5\u4e0b\u96c6\u7fa3\u5275\u5efa\u793a\u4f8b\u5047\u5b9a\u5df2\u5275\u5efa\u81ea\u5b9a\u7fa9\u7d44\u7e54\u653f\u7b56\uff0c\u4e26\u5728\u5275\u5efa\u96c6\u7fa3\u6642\u5f37\u5236\u57f7\u884c\u8a72\u653f\u7b56\uff0c\u4ee5\u8981\u6c42\u5553\u7528 [\u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn#creating_a_cluster_with_component_gateway) ( `resource.config.endpointConfig.enableHttpPortAccess==true` )\u3002\n```\ngcloud dataproc clusters create example-cluster \\\u00a0 \u00a0 --project=PROJECT_ID \\\u00a0 \u00a0 --zone=COMPUTE_ZONE\n```\n\u793a\u4f8b\u8f38\u51fa\uff08\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u5275\u5efa Dataproc \u96c6\u7fa3\u6642\u672a\u5553\u7528\u7d44\u4ef6\u7db2\u95dc\uff09\uff1a\n```\nOperation denied by custom org policies: [\"customConstraints/custom.dataprocEnableComponentGateway\": \"Only allow Dataproc cluster creation if the Component Gateway is enabled\"]\n```\n## Dataproc \u5c0d\u8cc7\u6e90\u548c\u64cd\u4f5c\u7684\u9650\u5236\n**\u5275\u5efa\u6216\u66f4\u65b0 Dataproc \u96c6\u7fa3** \u6642\uff0c\u53ef\u4f7f\u7528\u4ee5\u4e0b Dataproc \u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u5b57\u6bb5\u3002\u8acb\u6ce8\u610f\uff0c\u66f4\u65b0\u96c6\u7fa3\u6642\uff0c\u50c5\u652f\u6301\u8207\u53ef\u4fee\u6539\u7684\u96c6\u7fa3\u53c3\u6578\u76f8\u95dc\u7684\u9650\u5236\u689d\u4ef6\uff08\u8acb\u53c3\u95b1 [\u66f4\u65b0\u96c6\u7fa3](https://cloud.google.com/dataproc/docs/guides/manage-cluster?hl=zh-cn#updating_a_cluster) \uff09\u3002\n- [Compute Engine \u7db2\u7d61\u914d\u7f6e](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#GceClusterConfig) \uff08networkUri\u3001internalIpOnly\u3001serviceAccount \u548c metadata\uff09- `resource.config.gceClusterConfig.networkUri`\n- `resource.config.gceClusterConfig.internalIpOnly`\n- `resource.config.gceClusterConfig.serviceAccount`\n- `resource.config.gceClusterConfig.metadata`\n- [Compute Engine \u5be6\u4f8b\u7d44\u914d\u7f6e](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#instancegroupconfig) \uff08imageUri \u548c machineTypeUri\uff09- `resource.config.masterConfig.imageUri`\n- `resource.config.masterConfig.machineTypeUri`\n- `resource.config.workerConfig.imageUri`\n- `resource.config.workerConfig.machineTypeUri`\n- `resource.config.secondaryWorkerConfig.imageUri`\n- `resource.config.secondaryWorkerConfig.machineTypeUri`\n- [\u521d\u59cb\u5316\u64cd\u4f5c](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#nodeinitializationaction) (executableFile)- `resource.config.initializationActions.executableFile`\n- [\u8edf\u4ef6\u914d\u7f6e](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#softwareconfig) \uff08imageVersion\u3001\u5c6c\u6027\u548c\u53ef\u9078\u5c6c\u6027\uff09- `resource.config.softwareConfig.imageVersion`\n- `resource.config.softwareConfig.properties`\n- `resource.config.softwareConfig.optionalComponents`\n- [Kerberos \u914d\u7f6e](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#kerberosconfig) \uff08\u5553\u7528 Kerberos \u548c crossRealmTrustKdc\uff09- `resource.config.securityConfig.kerberosConfig.enableKerberos`\n- `resource.config.securityConfig.kerberosConfig.crossRealmTrustKdc`\n- [\u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#endpointconfig) (enableHttpPortAccess)- `resource.config.endpointConfig.enableHttpPortAccess`\n- [Metastore \u914d\u7f6e](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#metastoreconfig) (dataprocMetastoreService)- `resource.config.metastoreConfig.dataprocMetastoreService`\n- [\u6c38\u4e45\u6027\u78c1\u76e4 CMEK](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/customer-managed-encryption?hl=zh-cn) (gcePdKmsKeyName)- `resource.config.encryptionConfig.gcePdKmsKeyName`\n- [\u96c6\u7fa3\u6a19\u7c64](https://cloud.google.com/dataproc/docs/guides/creating-managing-labels?hl=zh-cn) - `resource.labels`\n- [\u96c6\u7fa3\u5927\u5c0f](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/scaling-clusters?hl=zh-cn) - `resource.config.masterConfig.numInstances`\n- `resource.config.workerConfig.numInstances`\n- `resource.config.secondaryWorkerConfig.numInstances`\n- [\u81ea\u52d5\u64f4\u7e2e](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/autoscaling?hl=zh-cn) - `resource.config.autoscalingConfig.policyUri`\n## \u5e38\u898b\u7528\u4f8b\u7684\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u793a\u4f8b\n\u4e0b\u8868\u63d0\u4f9b\u4e86\u81ea\u5b9a\u7fa9\u9650\u5236\u689d\u4ef6\u7684\u793a\u4f8b\uff1a\n| \u8aaa\u660e                | \u9650\u5236\u689d\u4ef6\u8a9e\u6cd5                                                                                                                             |\n|:-------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| \u5275\u5efa\u96c6\u7fa3\u6216\u66f4\u65b0\u6642\uff0c\u5c07 Dataproc \u5de5\u4f5c\u5668\u5be6\u4f8b\u7684\u6578\u91cf\u9650\u5236\u7232\u4e0d\u8d85\u904e 10 \u500b\u3002 | name: organizations/ORGANIZATION_ID/customConstraints/custom.dataprocNoMoreThan10Workers resourceTypes: - dataproc.googleapis.com/Cluster methodTypes: - CREATE - UPDATE condition: \"resource.config.workerConfig.numInstances + resource.config.secondaryWorkerConfig.numInstances > 10\" actionType: DENY displayName: Total number of worker instances cannot be larger than 10 description: Cluster cannot have more than 10 workers, including primary and secondary workers.         |\n| \u963b\u6b62\u61c9\u7528\u4e3b\u5be6\u4f8b\u5728 Dataproc \u96c6\u7fa3\u6436\u4f54\u5f0f\u5de5\u4f5c\u5668\u4e0a\u904b\u884c\u3002     | name: organizations/ORGANIZATION_ID/customConstraints/custom.dataprocAmPrimaryOnlyEnforced resourceTypes: - dataproc.googleapis.com/Cluster methodTypes: - CREATE condition: \"('dataproc:am.primary_only' in resource.config.softwareConfig.properties) && (resource.config.softwareConfig.properties['dataproc:am.primary_only']==true)\" actionType: ALLOW displayName: Application master cannot run on preemptible workers description: Property \"dataproc:am.primary_only\" must be \"true\".      |\n| \u7981\u6b62 Dataproc \u96c6\u7fa3\u4e0a\u7684\u81ea\u5b9a\u7fa9 Hive \u5c6c\u6027\u3002       | name: organizations/ORGANIZATION_ID/customConstraints/custom.dataprocNoCustomHiveProperties resourceTypes: - dataproc.googleapis.com/Cluster methodTypes: - CREATE condition: \"resource.config.softwareConfig.properties.all(p, !p.startsWith('hive:'))\" actionType: ALLOW displayName: Cluster cannot have custom Hive properties description: Only allow Dataproc cluster creation if no property starts with Hive prefix \"hive:\".                     |\n| \u7981\u6b62\u5c07 n1-standard-2 \u6a5f\u5668\u985e\u578b\u7528\u65bc Dataproc \u4e3b\u5be6\u4f8b\u3002    | name: organizations/ORGANIZATION_ID/customConstraints/custom.dataprocMasterMachineType resourceTypes: - dataproc.googleapis.com/Cluster methodTypes: - CREATE condition: \"resource.config.masterConfig.machineTypeUri.contains('n1-standard-2')\" actionType: DENY displayName: Master cannot use the n1-standard-2 machine type description: Prevent Dataproc cluster creation if the master machine type is n1-standard-2.                       |\n| \u5f37\u5236\u4f7f\u7528\u6307\u5b9a\u7684\u521d\u59cb\u5316\u64cd\u4f5c\u8173\u672c\u3002          | name: organizations/ORGANIZATION_ID/customConstraints/custom.dataprocInitActionScript resourceTypes: - dataproc.googleapis.com/Cluster methodTypes: - CREATE condition: \"resource.config.initializationActions.exists(action, action.executableFile=='gs://some/init-action.sh')\" actionType: ALLOW displayName: Initialization action script \"gs://some/init-action.sh\" must be used description: Only allow Dataproc cluster creation if the \"gs://some/init-action.sh\". initialization action script is used.  |\n| \u5f37\u5236\u4f7f\u7528\u6307\u5b9a\u7684\u6c38\u4e45\u6027\u78c1\u76e4\u52a0\u5bc6\u5bc6\u9470\u3002         | name: organizations/ORGANIZATION_ID/custom.dataprocPdCmek resourceTypes: - dataproc.googleapis.com/Cluster methodTypes: - CREATE condition: \"resource.config.encryptionConfig.gcePdKmsKeyName == 'projects/project-id/locations/global/keyRings/key-ring-name/cryptoKeys/key-name'\" actionType: ALLOW displayName: Cluster PD must be encrypted with \"key-name\" from \"key-ring-name\" key-ring description: Only allow Dataproc cluster creation if the PD is encrypted with \"key-name\" from \"key-ring-name\" key-ring. |\n| \u5f37\u5236\u57f7\u884c\u96c6\u7fa3\u6a19\u7c64\u9650\u5236\u3002            | name: organizations/ORGANIZATION_ID/customConstraints/custom.dataprocEnvLabel resourceTypes: - dataproc.googleapis.com/Cluster methodTypes: - CREATE - UPDATE condition: \"('env' in resource.labels) && (resource.labels.env=='test')\" actionType: DENY displayName: Cluster cannot have the \"env=test\" label description: Deny Dataproc cluster creation or update if the cluster will be labeled \"env=test\".                          |\n| \u5f37\u5236\u4f7f\u7528\u975e\u9ed8\u8a8d\u7db2\u7d61\u3002            | name: organizations/ORGANIZATION_ID/customConstraints/custom.dataprocNoDefaultNetwork resourceTypes: - dataproc.googleapis.com/Cluster methodTypes: - CREATE condition: \"resource.config.gceClusterConfig.networkUri.contains('networks/default')\" actionType: DENY displayName: Cluster cannot be created in the default network description: Deny Dataproc cluster creation if the cluster will be created in the default network.                     |\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u8acb\u53c3\u95b1 [\u7d44\u7e54\u653f\u7b56\u670d\u52d9\u7c21\u4ecb](https://cloud.google.com/resource-manager/docs/organization-policy/overview?hl=zh-cn) \uff0c\u8a73\u7d30\u77ad\u89e3\u7d44\u7e54\u653f\u7b56\u3002\n- \u8a73\u7d30\u77ad\u89e3\u5982\u4f55 [\u5275\u5efa\u548c\u7ba1\u7406\u7d44\u7e54\u653f\u7b56](https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints?hl=zh-cn) \u3002\n- \u67e5\u770b\u9810\u5b9a\u7fa9\u7684 [\u7d44\u7e54\u653f\u7b56\u9650\u5236\u689d\u4ef6](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints?hl=zh-cn) \u7684\u5b8c\u6574\u5217\u8868\u3002", "guide": "Dataproc"}