{"title": "Dataproc - Dataproc on GKE node pools", "url": "https://cloud.google.com/dataproc/docs/guides/dpgke/dataproc-gke-nodepools", "abstract": "# Dataproc - Dataproc on GKE node pools\nWhen you [create](/dataproc/docs/guides/dpgke/quickstarts/dataproc-gke-quickstart-create-cluster) or [update](/dataproc/docs/guides/dpgke/dataproc-gke-recreate-cluster) a Dataproc on GKE virtual cluster, you specify one or more node pools that the virtual cluster will use to run jobs (this cluster is referred to as the cluster \"used by\" or \"associated\" with the specified node pools). If a specified node pool does not exist on your GKE cluster, Dataproc on GKE will create the node pool on the GKE cluster with settings you specify. If the node pool exists and was created by Dataproc, it will be validated to confirm that its settings match the specified settings.\n#", "content": "## Dataproc on GKE node pool settings\nYou can specify the following [settings](/dataproc/docs/reference/rest/v1/projects.regions.clusters#gkenodeconfig) on node pools used by your Dataproc on GKE virtual clusters (these settings are a subset of [GKE node pool settings](/kubernetes-engine/docs/reference/rest/v1/NodeConfig) ):\n- `accelerators`\n- `acceleratorCount`\n- `acceleratorType`\n- `gpuPartitionSize`*\n- `localSsdCount`\n- `machineType`\n- `minCpuPlatform`\n- `minNodeCount`\n- `maxNodeCount`\n- `preemptible`\n- `spot`*\nNotes:\n- `gpuPartitionSize`can be set in the Dataproc API [GkeNodePoolAcceleratorConfig](/dataproc/docs/reference/rest/v1/GkeClusterConfig#gkenodepoolacceleratorconfig) .\n- `spot`can be set in the Dataproc API [GkeNodeConfig](/dataproc/docs/reference/rest/v1/projects.regions.clusters#gkenodeconfig) .## Node pool deletion\nWhen a Dataproc on GKE cluster is deleted, the node pools used by the cluster are not deleted. See [Delete a node pool](/kubernetes-engine/docs/how-to/node-pools#deleting_a_node_pool) to delete node pools no longer in use by Dataproc on GKE clusters.\n## Node pool location\nYou can specify the [zone](/dataproc/docs/reference/rest/v1/projects.regions.clusters#GkeNodePoolConfig.FIELDS.locations) location of node pools associated with your Dataproc on GKE virtual cluster when you create or update the virtual cluster. The node pool zones must be located in the region of the associated virtual cluster.\n## Role to node pool mapping\nNode pool [roles](/dataproc/docs/reference/rest/v1/projects.regions.clusters#Role) are defined for Spark driver and executor work, with a default role defined for all types of work by a node pool. Dataproc on GKE clusters must have at least one a node pool that is assigned the `default` role. Assigning other roles is optional.\n**Recommendation:** Create separate node pools for each role type, with node type and size based on role requirements.\ngcloud CLI virtual cluster creation example:\n```\ngcloud dataproc clusters gke create \"${DP_CLUSTER}\" \\\n\u00a0\u00a0--region=${REGION} \\\n\u00a0\u00a0--gke-cluster=${GKE_CLUSTER} \\\n\u00a0\u00a0--spark-engine-version=latest \\\n\u00a0\u00a0--staging-bucket=${BUCKET} \\\n\u00a0\u00a0--pools=\"name=${DP_POOLNAME},roles=default \\\n\u00a0\u00a0--setup-workload-identity\n\u00a0\u00a0--pools=\"name=${DP_CTRL_POOLNAME},roles=default,machineType=e2-standard-4\" \\\n\u00a0\u00a0--pools=\"name=${DP_DRIVER_POOLNAME},min=1,max=3,roles=spark-driver,machineType=n2-standard-4\" \\\n\u00a0\u00a0--pools=\"name=${DP_EXEC_POOLNAME},min=1,max=10,roles=spark-executor,machineType=n2-standard-8\"\n```", "guide": "Dataproc"}