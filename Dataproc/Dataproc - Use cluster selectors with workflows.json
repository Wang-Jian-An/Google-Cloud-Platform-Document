{"title": "Dataproc - Use cluster selectors with workflows", "url": "https://cloud.google.com/dataproc/docs/concepts/workflows/cluster-selectors", "abstract": "# Dataproc - Use cluster selectors with workflows\nAs an alternative to running a workflow on a [managed cluster](/dataproc/docs/concepts/workflows/using-workflows#configuring_or_selecting_a_cluster) , you can use a cluster selector to choose an existing cluster for your workflow. At the conclusion of the workflow, the selected cluster is not deleted.\nSelectors specify one or more [Dataproc user labels](/dataproc/docs/concepts/labels) . Clusters in same [region](/compute/docs/regions-zones#available) as the workflow whose labels match all of the selector labels are eligible to run workflow jobs. If multiple clusters match the selector, Dataproc will choose the cluster with the most free YARN memory.\n", "content": "## Adding a cluster selector to a template\nYou can add a cluster selector to a workflow template using the Google Cloud CLI or the Dataproc API.\n```\ngcloud dataproc workflow-templates set-cluster-selector template-id \\\n\u00a0\u00a0\u00a0\u00a0--region=region \\\n\u00a0\u00a0\u00a0\u00a0--cluster-labels=name=value[[,name=value]...]\n```\nSee\n [WorkflowTemplatePlacement.ClusterSelector](/dataproc/docs/reference/rest/v1/projects.locations.workflowTemplates#clusterselector) \n. This field is provided as part of a completed\n [WorkflowTemplate](/dataproc/docs/reference/rest/v1/projects.regions.workflowTemplates#resource-workflowtemplate) \nsubmitted with a\n [workflowTemplates.create](/dataproc/docs/reference/rest/v1/projects.regions.workflowTemplates/create) \nor\n [workflowTemplates.update](/dataproc/docs/reference/rest/v1/projects.regions.workflowTemplates/update) \nrequest.\nYou can view existing workflow templates and instantiated workflows from the Dataproc [Workflows](https://console.cloud.google.com/dataproc/workflows/instances) page in Google Cloud console.\n## Using Automatically Applied Labels\nYou can point a cluster selector to an existing cluster by using one of the following [automatically-applied cluster labels](/dataproc/docs/concepts/labels#automatically-applied_labels) :\n- `goog-dataproc-cluster-name`\n- `goog-dataproc-cluster-uuid`\n**Example:**\n```\ngcloud dataproc workflow-templates set-cluster-selector template-id \\\n\u00a0\u00a0\u00a0\u00a0--region=region \\\n\u00a0\u00a0\u00a0\u00a0--cluster-labels=goog-dataproc-cluster-name=my-cluster\n```\n## Selecting from a Cluster Pool\nYou can let Dataproc choose a cluster from a pool of clusters. The cluster pools can be defined with labels.\n**Example:**\n```\ngcloud dataproc clusters create cluster-1 --labels cluster-pool=pool-1 \\\n\u00a0\u00a0\u00a0\u00a0--region=region\ngcloud dataproc clusters create cluster-2 --labels cluster-pool=pool-1 \\\n\u00a0\u00a0\u00a0\u00a0--region=region\ngcloud dataproc clusters create cluster-3 --labels cluster-pool=pool-2 \\\n\u00a0\u00a0\u00a0\u00a0--region=region\n```\nAfter cluster creation ...\n```\ngcloud dataproc workflow-templates create my-template \\\n\u00a0\u00a0\u00a0\u00a0--region=region\ngcloud dataproc workflow-templates set-cluster-selector my-template \\\n\u00a0\u00a0\u00a0\u00a0--region=region \\\n\u00a0\u00a0\u00a0\u00a0--cluster-labels=cluster-pool=pool-1\n```\nThe workflow will be run on either cluster-1 or cluster-2, but not on cluster-3.", "guide": "Dataproc"}