{"title": "Dataproc - \u7ba1\u7406 Apache Spark \u7684 Java \u548c Scala \u4f9d\u8cf4\u9805", "url": "https://cloud.google.com/dataproc/docs/guides/manage-spark-dependencies?hl=zh-cn", "abstract": "# Dataproc - \u7ba1\u7406 Apache Spark \u7684 Java \u548c Scala \u4f9d\u8cf4\u9805\nSpark \u61c9\u7528\u901a\u5e38\u4f9d\u8cf4\u65bc\u7b2c\u4e09\u65b9 Java \u6216 Scala \u5eab\u3002\u4ee5\u4e0b\u662f\u5728\u5411 Dataproc \u96c6\u7fa3\u63d0\u4ea4 Spark \u4f5c\u696d\u6642\u6dfb\u52a0\u9019\u4e9b\u4f9d\u8cf4\u9805\u7684\u5efa\u8b70\u65b9\u6cd5\uff1a\n- \u4f7f\u7528 [gcloud dataproc jobs submit](https://cloud.google.com/dataproc/docs/guides/submit-job?hl=zh-cn#submitting_a_job) \u547d\u4ee4\u5f9e\u672c\u5730\u6a5f\u5668\u63d0\u4ea4\u4f5c\u696d\u6642\uff0c\u8acb\u4f7f\u7528 `--properties spark.jars.packages=[DEPENDENCIES]` \u6a19\u8a8c\u3002 **\u793a\u4f8b** \uff1a```\ngcloud dataproc jobs submit spark \\\n\u00a0\u00a0\u00a0\u00a0--cluster=my-cluster \\\n\u00a0\u00a0\u00a0\u00a0--region=region \\\n\u00a0\u00a0\u00a0\u00a0--properties=spark.jars.packages='com.google.cloud:google-cloud-translate:1.35.0,org.apache.bahir:spark-streaming-pubsub_2.11:2.2.0'\n```\n- \u7576 [\u60a8\u76f4\u63a5\u5728\u96c6\u7fa3\u4e0a\u63d0\u4ea4\u4f5c\u696d](https://cloud.google.com/dataproc/docs/guides/submit-job?hl=zh-cn#submit_a_job_directly_on_your_cluster) \u6642\uff0c\u8acb\u4f7f\u7528\u5e36\u6709 `--packages=[DEPENDENCIES]` \u53c3\u6578\u7684 `spark-submit` \u547d\u4ee4\u3002 **\u793a\u4f8b** \uff1a```\nspark-submit --packages='com.google.cloud:google-cloud-translate:1.35.0,org.apache.bahir:spark-streaming-pubsub_2.11:2.2.0'\n```", "content": "## \u907f\u514d\u4f9d\u8cf4\u9805\u885d\u7a81\n\u5982\u679c Spark \u61c9\u7528\u4f9d\u8cf4\u9805\u8207 Hadoop \u7684\u4f9d\u8cf4\u9805\u885d\u7a81\uff0c\u5247\u4e0a\u8ff0\u65b9\u6cd5\u53ef\u80fd\u6703\u5931\u6557\u3002\u5c0e\u81f4\u9019\u7a2e\u885d\u7a81\u7684\u539f\u56e0\u5982\u4e0b\uff1a\u7531\u65bc Hadoop \u5c07\u5176\u4f9d\u8cf4\u9805\u6ce8\u5165\u61c9\u7528\u7684 [\u985e\u8def\u5f91](https://en.wikipedia.org/wiki/Classpath_(Java)) \uff0c\u56e0\u6b64\u5176\u4f9d\u8cf4\u9805\u7684\u512a\u5148\u7d1a\u9ad8\u65bc\u61c9\u7528\u7684\u4f9d\u8cf4\u9805\u3002\u51fa\u73fe\u885d\u7a81\u6642\uff0c\u53ef\u80fd\u6703\u7522\u751f `NoSuchMethodError` \u6216\u5176\u4ed6\u932f\u8aa4\u3002\n**\u793a\u4f8b** \uff1a [Guava](https://github.com/google/guava) \u662f Google \u7684 Java \u6838\u5fc3\u5eab\uff0c\u53ef\u4f9b\u591a\u7a2e\u5eab\u548c\u6846\u67b6\uff08\u5305\u62ec Hadoop\uff09\u4f7f\u7528\u3002\u5982\u679c\u4f5c\u696d\u6216\u5176\u4f9d\u8cf4\u9805\u9700\u8981\u4f7f\u7528\u7684 Guava \u7248\u672c\u6bd4 Hadoop \u4f7f\u7528\u7684\u7248\u672c\u66f4\u9ad8\uff0c\u5247\u53ef\u80fd\u51fa\u73fe\u4f9d\u8cf4\u9805\u885d\u7a81\u3002\nHadoop v3.0 [\u89e3\u6c7a\u4e86](https://issues.apache.org/jira/browse/HADOOP-11804) \u9019\u500b\u554f\u984c\uff0c\u4f46\u4f9d\u8cf4\u65e9\u671f Hadoop \u7248\u672c\u7684\u61c9\u7528\u9700\u8981\u901a\u904e\u4ee5\u4e0b\u5169\u500b\u74b0\u7bc0\u7684\u89e3\u6c7a\u65b9\u6cd5\u4f86\u907f\u514d\u53ef\u80fd\u7684\u4f9d\u8cf4\u9805\u885d\u7a81\u3002\n- \u5275\u5efa\u4e00\u500b\u55ae\u7368\u7684 JAR\uff0c\u5176\u4e2d\u5305\u542b\u61c9\u7528\u7684\u8edf\u4ef6\u5305\u53ca\u5176\u6240\u6709\u4f9d\u8cf4\u9805\u3002\n- \u91cd\u65b0\u5b9a\u4f4d\u8d85\u7d1a JAR \u4e2d\u885d\u7a81\u7684\u4f9d\u8cf4\u9805\u8edf\u4ef6\u5305\uff0c\u4ee5\u9632\u6b62\u5176\u8def\u5f91\u540d\u8207 Hadoop \u7684\u4f9d\u8cf4\u9805\u8edf\u4ef6\u5305\u885d\u7a81\u3002 \u53ef\u5728\u6253\u5305\u904e\u7a0b\u4e2d\u4f7f\u7528\u63d2\u4ef6\uff08\u8acb\u53c3\u95b1\u4e0b\u6587\uff09\u81ea\u52d5\u57f7\u884c\u6b64\u91cd\u5b9a\u4f4d\uff08\u4e5f\u7a31\u7232\u201c\u6dfb\u52a0\u9670\u5f71\u201d\uff09\uff0c\u800c\u7121\u9700\u4fee\u6539\u60a8\u7684\u4ee3\u78bc\u3002\n### \u7528 Maven \u5275\u5efa\u4e00\u500b\u8d85\u7d1a\u9670\u5f71 JAR\n[Maven](https://maven.apache.org/) \u662f\u7528\u65bc\u69cb\u5efa Java \u61c9\u7528\u7684\u8edf\u4ef6\u5305\u7ba1\u7406\u5de5\u5177\u3002 [Maven scala](https://davidb.github.io/scala-maven-plugin/) \u63d2\u4ef6\u53ef\u7528\u65bc\u69cb\u5efa\u7528 Scala\uff08\u5373 Spark \u61c9\u7528\u4f7f\u7528\u7684\u8a9e\u8a00\uff09\u7de8\u5beb\u7684\u61c9\u7528\u3002 [Maven shade](http://maven.apache.org/plugins/maven-shade-plugin/) \u63d2\u4ef6\u53ef\u7528\u65bc\u5275\u5efa\u9670\u5f71 JAR\u3002\n\u4ee5\u4e0b\u662f `pom.xml` \u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\uff0c\u7528\u65bc\u7232\u4f4d\u65bc `com.google.common` \u8edf\u4ef6\u5305\u4e2d\u7684 Guava \u5eab\u6dfb\u52a0\u9670\u5f71\u3002\u6b64\u914d\u7f6e\u6307\u793a Maven \u5c07 `com.google.common` \u8edf\u4ef6\u5305\u91cd\u547d\u540d\u7232 `repackaged.com.google.common` \uff0c\u4e26\u66f4\u65b0\u539f\u59cb\u8edf\u4ef6\u5305\u4e2d\u5c0d\u985e\u7684\u6240\u6709\u5f15\u7528\u3002\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\"?><project xmlns=\"http://maven.apache.org/POM/4.0.0\"\u00a0 xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\u00a0 xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\u00a0 <modelVersion>4.0.0</modelVersion>\u00a0 <properties>\u00a0 \u00a0 <maven.compiler.source>1.8</maven.compiler.source>\u00a0 \u00a0 <maven.compiler.target>1.8</maven.compiler.target>\u00a0 </properties>\u00a0 <groupId><!-- YOUR_GROUP_ID --></groupId>\u00a0 <artifactId><!-- YOUR_ARTIFACT_ID --></artifactId>\u00a0 <version><!-- YOUR_PACKAGE_VERSION --></version>\u00a0 <dependencies>\u00a0 \u00a0 <dependency>\u00a0 \u00a0 \u00a0 <groupId>org.apache.spark</groupId>\u00a0 \u00a0 \u00a0 <artifactId>spark-sql_2.11</artifactId>\u00a0 \u00a0 \u00a0 <version><!-- YOUR_SPARK_VERSION --></version>\u00a0 \u00a0 \u00a0 <scope>provided</scope>\u00a0 \u00a0 </dependency>\u00a0 \u00a0 <!-- YOUR_DEPENDENCIES -->\u00a0 </dependencies>\u00a0 <build>\u00a0 \u00a0 <plugins>\u00a0 \u00a0 \u00a0 <plugin>\u00a0 \u00a0 \u00a0 \u00a0 <groupId>net.alchim31.maven</groupId>\u00a0 \u00a0 \u00a0 \u00a0 <artifactId>scala-maven-plugin</artifactId>\u00a0 \u00a0 \u00a0 \u00a0 <executions>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <execution>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <goals>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <goal>compile</goal>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <goal>testCompile</goal>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </goals>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </execution>\u00a0 \u00a0 \u00a0 \u00a0 </executions>\u00a0 \u00a0 \u00a0 \u00a0 <configuration>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <scalaVersion><!-- YOUR_SCALA_VERSION --></scalaVersion>\u00a0 \u00a0 \u00a0 \u00a0 </configuration>\u00a0 \u00a0 \u00a0 </plugin>\u00a0 \u00a0 \u00a0 <plugin>\u00a0 \u00a0 \u00a0 \u00a0 <groupId>org.apache.maven.plugins</groupId>\u00a0 \u00a0 \u00a0 \u00a0 <artifactId>maven-shade-plugin</artifactId>\u00a0 \u00a0 \u00a0 \u00a0 <executions>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <execution>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <phase>package</phase>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <goals>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <goal>shade</goal>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </goals>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <configuration>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <transformers>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <transformer implementation=\"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <mainClass><!-- YOUR_APPLICATION_MAIN_CLASS --></mainClass>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </transformer>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <!-- This is needed if you have dependencies that use Service Loader. Most Google Cloud client libraries do. -->\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <transformer implementation=\"org.apache.maven.plugins.shade.resource.ServicesResourceTransformer\"/>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </transformers>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <filters>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <filter>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <artifact>*:*</artifact>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <excludes>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <exclude>META-INF/maven/**</exclude>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <exclude>META-INF/*.SF</exclude>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <exclude>META-INF/*.DSA</exclude>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <exclude>META-INF/*.RSA</exclude>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </excludes>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </filter>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </filters>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <relocations>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <relocation>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <pattern>com</pattern>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <shadedPattern>repackaged.com.google.common</shadedPattern>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <includes>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <include>com.google.common.**</include>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </includes>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </relocation>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </relocations>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </configuration>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </execution>\u00a0 \u00a0 \u00a0 \u00a0 </executions>\u00a0 \u00a0 \u00a0 </plugin>\u00a0 \u00a0 </plugins>\u00a0 </build></project>\n```\n\u8981\u904b\u884c\u8a72\u69cb\u5efa\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n```\nmvn package\n```\n**\u95dc\u65bc pom.xml \u7684\u5099\u8a3b** \uff1a\n- [ManifestResourceTransformer](https://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html#ManifestResourceTransformer) \u6703\u8655\u7406\u8d85\u7d1a JAR \u6e05\u55ae\u6587\u4ef6\uff08`MANIFEST.MF`\uff09\u4e2d\u7684\u5c6c\u6027\u3002\u6b64\u6e05\u55ae\u9084\u53ef\u4ee5\u6307\u5b9a\u61c9\u7528\u7684\u5165\u53e3\u9ede\u3002\n- \u7531\u65bc Spark \u5b89\u88dd\u5728 Dataproc \u4e0a\uff0c\u56e0\u6b64 Spark \u7684 [\u7bc4\u570d](https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope) \u662f`provided`\u3002\n- \u6307\u5b9a Dataproc \u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Spark \u7248\u672c\uff08\u8acb\u53c3\u95b1 [Dataproc \u7248\u672c\u5217\u8868](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn) \uff09\u3002\u5982\u679c\u60a8\u7684\u61c9\u7528\u9700\u8981\u4f7f\u7528\u7684 Spark \u7248\u672c\u8207 Dataproc \u96c6\u7fa3\u4e2d\u5b89\u88dd\u7684\u7248\u672c\u4e0d\u540c\uff0c\u60a8\u53ef\u4ee5\u7de8\u5beb [\u521d\u59cb\u5316\u64cd\u4f5c](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/init-actions?hl=zh-cn) \uff0c\u6216\u69cb\u5efa\u4e00\u500b [\u81ea\u5b9a\u7fa9\u6620\u50cf](https://cloud.google.com/dataproc/docs/guides/dataproc-images?hl=zh-cn) \uff08\u8a72\u6620\u50cf\u6703\u5b89\u88dd\u60a8\u7684\u61c9\u7528\u4f7f\u7528\u7684 Spark \u7248\u672c\uff09\u3002\n- `<filters>`\u689d\u76ee\u6703\u5f9e\u4f9d\u8cf4\u9805\u7684`META-INF`\u76ee\u9304\u4e2d\u6392\u9664\u7c3d\u540d\u6587\u4ef6\u3002\u5982\u679c\u6c92\u6709\u6b64\u689d\u76ee\uff0c\u5247\u53ef\u80fd\u6703\u767c\u751f`java.lang.SecurityException: Invalid signature file digest for Manifest main attributes`\u904b\u884c\u6642\u7570\u5e38\uff0c\u56e0\u7232\u7c3d\u540d\u6587\u4ef6\u5728\u8d85\u7d1a JAR \u74b0\u5883\u4e2d\u7121\u6548\u3002\n- \u60a8\u53ef\u80fd\u9700\u8981\u7232\u591a\u500b\u5eab\u6dfb\u52a0\u9670\u5f71\u3002\u7232\u6b64\uff0c\u8acb\u6dfb\u52a0\u591a\u500b\u8def\u5f91\u3002 \u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u77ad\u5982\u4f55\u7232 Guava \u548c Protobuf \u5eab\u6dfb\u52a0\u9670\u5f71\u3002```\n<relocation>\u00a0 <pattern>com</pattern>\u00a0 <shadedPattern>repackaged.com</shadedPattern>\u00a0 <includes>\u00a0 \u00a0 <include>com.google.protobuf.**</include>\u00a0 \u00a0 <include>com.google.common.**</include>\u00a0 </includes></relocation>\n```\n### \u7528 SBT \u5275\u5efa\u4e00\u500b\u8d85\u7d1a\u9670\u5f71 JAR\n[SBT](https://www.scala-sbt.org/) \u662f\u7528\u65bc\u69cb\u5efa Scala \u61c9\u7528\u7684\u5de5\u5177\u3002\u8981\u4f7f\u7528 SBT \u5275\u5efa\u9670\u5f71 JAR\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u5411\u69cb\u5efa\u5b9a\u7fa9\u4e2d\u6dfb\u52a0 [sbt-assembly](https://github.com/sbt/sbt-assembly) \u63d2\u4ef6\u3002\u9996\u5148\uff0c\u5728 `project/` \u76ee\u9304\u4e0b\u5275\u5efa\u4e00\u500b\u540d\u7232 `assembly.sbt` \u7684\u6587\u4ef6\uff1a\n```\n\u251c\u2500\u2500 src/\n\u2514\u2500\u2500 build.sbt\n\u2514\u2500\u2500 project/\n \u2514\u2500\u2500 assembly.sbt\n```\n\u7136\u5f8c\u5728 `assembly.sbt` \u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u884c\uff1a\n```\naddSbtPlugin(\"com.eed3si9n\" % \"sbt-assembly\" % \"0.14.6\")\n```\n\u4ee5\u4e0b\u662f `build.sbt` \u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\uff0c\u7528\u65bc\u7232\u4f4d\u65bc `com.google.common package` \u8edf\u4ef6\u5305\u4e2d\u7684 Guava \u5eab\u6dfb\u52a0\u9670\u5f71\u3002\n```\nlazy val commonSettings = Seq(\u00a0organization := \"YOUR_GROUP_ID\",\u00a0name := \"YOUR_ARTIFACT_ID\",\u00a0version := \"YOUR_PACKAGE_VERSION\",\u00a0scalaVersion := \"YOUR_SCALA_VERSION\",)lazy val shaded = (project in file(\".\"))\u00a0.settings(commonSettings)mainClass in (Compile, packageBin) := Some(\"YOUR_APPLICATION_MAIN_CLASS\")libraryDependencies ++= Seq(\u00a0\"org.apache.spark\" % \"spark-sql_2.11\" % \"YOUR_SPARK_VERSION\" % \"provided\",\u00a0// YOUR_DEPENDENCIES)assemblyShadeRules in assembly := Seq(\u00a0 ShadeRule.rename(\"com.google.common.**\" -> \"repackaged.com.google.common.@1\").inAll)\n```\n\u8981\u904b\u884c\u8a72\u69cb\u5efa\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n```\nsbt assembly\n```\n**\u95dc\u65bc build.sbt \u7684\u5099\u8a3b** \uff1a\n- \u4e0a\u8ff0\u793a\u4f8b\u4e2d\u7684\u9670\u5f71\u898f\u5247\u53ef\u80fd\u7121\u6cd5\u89e3\u6c7a\u6240\u6709\u4f9d\u8cf4\u9805\u885d\u7a81\uff0c\u56e0\u7232 SBT \u4f7f\u7528\u56b4\u683c\u7684\u885d\u7a81\u89e3\u6c7a\u7b56\u7565\u3002\u56e0\u6b64\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u63d0\u4f9b\u66f4\u7cbe\u7d30\u7684\u898f\u5247\uff0c\u9019\u4e9b\u898f\u5247\u4f7f\u7528`MergeStrategy.first`\u3001`last`\u3001`concat`\u3001`filterDistinctLines`\u3001`rename`\u6216`discard`\u7b56\u7565\u660e\u78ba\u5408\u4f75\u7279\u5b9a\u985e\u578b\u7684\u885d\u7a81\u6587\u4ef6\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1`sbt-assembly`\u7684 [\u5408\u4f75\u7b56\u7565](https://github.com/sbt/sbt-assembly#merge-strategy) \u3002\n- \u60a8\u53ef\u80fd\u9700\u8981\u7232\u591a\u500b\u5eab\u6dfb\u52a0\u9670\u5f71\u3002\u7232\u6b64\uff0c\u8acb\u6dfb\u52a0\u591a\u500b\u8def\u5f91\u3002 \u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u77ad\u5982\u4f55\u7232 Guava \u548c Protobuf \u5eab\u6dfb\u52a0\u9670\u5f71\u3002```\nassemblyShadeRules in assembly := Seq(\u00a0 ShadeRule.rename(\"com.google.common.**\" -> \"repackaged.com.google.common.@1\").inAll,\u00a0 ShadeRule.rename(\"com.google.protobuf.**\" -> \"repackaged.com.google.protobuf.@1\").inAll)\n```## \u5411 Dataproc \u63d0\u4ea4\u8d85\u7d1a JAR\n\u5728\u5275\u5efa\u5305\u542b Spark \u61c9\u7528\u53ca\u5176\u4f9d\u8cf4\u9805\u7684\u8d85\u7d1a\u9670\u5f71 JAR \u4e4b\u5f8c\uff0c\u60a8\u5c31\u53ef\u4ee5\u5411 Dataproc [\u63d0\u4ea4\u4f5c\u696d](https://cloud.google.com/dataproc/docs/guides/submit-job?hl=zh-cn) \u4e86\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u8acb\u53c3\u95b1 Spark \u793a\u4f8b\u61c9\u7528 [spark-translate](https://github.com/GoogleCloudDataproc/cloud-dataproc/tree/master/spark-translate) \uff0c\u5176\u4e2d\u5305\u542b\u4e86 Maven \u548c SBT \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n- \u5728 Dataproc \u4e0a [\u7de8\u5beb\u4e26\u904b\u884c Spark Scala \u4f5c\u696d](https://cloud.google.com/dataproc/docs/tutorials/spark-scala?hl=zh-cn) \u3002\u8acb\u6309\u7167\u5feb\u901f\u5165\u9580\u4e2d\u7684\u8aaa\u660e\u4e86\u89e3\u5982\u4f55\u5728 Dataproc \u96c6\u7fa3\u4e0a\u7de8\u5beb\u4e26\u904b\u884c Spark Scala \u4f5c\u696d\u3002", "guide": "Dataproc"}