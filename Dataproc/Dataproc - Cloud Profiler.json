{"title": "Dataproc - Cloud Profiler", "url": "https://cloud.google.com/dataproc/docs/guides/profiling?hl=zh-cn", "abstract": "# Dataproc - Cloud Profiler\n[Cloud Profiler](https://cloud.google.com/profiler/docs?hl=zh-cn) \u6703\u6301\u7e8c\u6536\u96c6\u548c\u5831\u544a\u61c9\u7528\u7684 CPU \u4f7f\u7528\u7387\u548c\u5167\u5b58\u5206\u914d\u4fe1\u606f\u3002\n**\u8981\u6c42\uff1a**\n- Profiler \u50c5\u652f\u6301 Dataproc Hadoop \u548c Spark \u4f5c\u696d\u985e\u578b\uff08Spark\u3001PySpark\u3001SparkSql \u548c SparkR\uff09\u3002\n- \u4f5c\u696d\u5fc5\u9808\u904b\u884c\u8d85\u904e 3 \u5206\u9418\uff0cProfiler \u624d\u80fd\u6536\u96c6\u6578\u64da\u4e26\u5c07\u5176\u4e0a\u50b3\u5230\u60a8\u7684\u9805\u76ee\u4e2d\u3002\nDataproc \u6703\u8b58\u5225 `cloud.profiler.enable` \u548c\u5176\u4ed6 `cloud.profiler.*` \u5c6c\u6027\uff08\u8acb\u53c3\u95b1 [Profiler \u9078\u9805](#submit_a_job_with_options) \uff09\uff0c\u7136\u5f8c\u5c07\u76f8\u95dc\u7684\u6027\u80fd\u5256\u6790\u5668 JVM \u9078\u9805\u9644\u52a0\u5230\u4ee5\u4e0b\u914d\u7f6e\uff1a\n- Spark\uff1a`spark.driver.extraJavaOptions`\u548c`spark.executor.extraJavaOptions`\n- MapReduce\uff1a`mapreduce.task.profile`\u548c\u5176\u4ed6`mapreduce.task.profile.*`\u5c6c\u6027\n**\u6ce8\u610f** \uff1a\u5982\u679c\u5728\u4f5c\u696d\u4e2d\u66ff\u63db\u4e0a\u8ff0 Spark \u6216 MapReduce \u5c6c\u6027\uff08\u4f8b\u5982\uff0c\u901a\u904e\u624b\u52d5\u69cb\u5efa SparkConf \u4e26\u8a2d\u7f6e `spark.executor.extraJavaOptions` \uff09\uff0c\u5247\u7cfb\u7d71\u5c07\u963b\u6b62\u8a2d\u7f6e\u6027\u80fd\u5256\u6790\u5668\u9078\u9805\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u4f7f\u7528 `gcloud dataproc jobs submit (spark|hadoop) --properties` \u6a19\u8a8c\u63d0\u4f9b `extraJavaOptions` \uff0cDataproc \u5c07\u4fdd\u7559\u4e26\u8a2d\u7f6e\u6027\u80fd\u5256\u6790\u5668\u9078\u9805\u3002\n", "content": "## \u5553\u7528\u5206\u6790\n\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9a5f\u4ee5\u5728 Dataproc Spark \u548c Hadoop \u4f5c\u696d\u4e0a\u5553\u7528\u548c\u4f7f\u7528 Profiler\u3002\n- [\u5553\u7528 Profiler](https://cloud.google.com/profiler/docs/profiling-java?hl=zh-cn#enabling-profiler) \u3002\n- [\u5275\u5efa Dataproc \u96c6\u7fa3](https://cloud.google.com/dataproc/docs/guides/create-cluster?hl=zh-cn#creating_a_cloud_dataproc_cluster) \uff0c\u4e26\u5c07 [\u670d\u52d9\u8cec\u865f\u7bc4\u570d](https://cloud.google.com/sdk/gcloud/reference/dataproc/clusters/create?hl=zh-cn#--scopes) \u8a2d\u7f6e\u7232 `monitoring` \u4ee5\u5141\u8a31\u96c6\u7fa3\u8207 Profiler \u670d\u52d9\u901a\u4fe1\u3002\n```\ngcloud dataproc clusters create cluster-name \\\n\u00a0\u00a0\u00a0\u00a0--scopes=cloud-platform \\\n\u00a0\u00a0\u00a0\u00a0--region=region \\\n\u00a0\u00a0\u00a0\u00a0other args ...\n```\n## \u4f7f\u7528 Profiler \u9078\u9805\u63d0\u4ea4 Dataproc \u4f5c\u696d\n- \u4f7f\u7528\u4ee5\u4e0b\u4e00\u500b\u6216\u591a\u500b Profiler \u9078\u9805 [\u63d0\u4ea4 Dataproc Spark \u6216 Hadoop \u4f5c\u696d](https://cloud.google.com/dataproc/docs/guides/submit-job?hl=zh-cn#submitting_a_job) \uff1a| \u9078\u9805       | \u8aaa\u660e                 | \u503c      | \u5fc5\u9700/\u53ef\u9078 | \u9ed8\u8a8d    | Notes       |\n|:-------------------------------|:---------------------------------------------------------------------|:-------------------------|:------------|:-------------------|:-------------------------------|\n| cloud.profiler.enable   | \u5553\u7528\u5c0d\u4f5c\u696d\u7684\u5206\u6790              | true \u6216 false   | \u9700\u8981  | false    | nan       |\n| cloud.profiler.name   | \u7528\u65bc\u5728 Profiler \u670d\u52d9\u4e0a\u5275\u5efa\u914d\u7f6e\u6587\u4ef6\u7684\u540d\u7a31        | profile-name    | \u53ef\u9078  | Dataproc \u4f5c\u696d UUID | nan       |\n| cloud.profiler.service.version | \u7528\u6236\u63d0\u4f9b\u7684\u5b57\u7b26\u4e32\uff0c\u7528\u65bc\u8b58\u5225\u548c\u5340\u5206 Profiler \u7d50\u679c\u3002      | Profiler Service Version | \u53ef\u9078  | Dataproc \u4f5c\u696d UUID | nan       |\n| mapreduce.task.profile.maps | \u8981\u5206\u6790\u7684\u6620\u5c04\u4efb\u52d9\u7684\u6578\u91cf\u7bc4\u570d\uff08\u4f8b\u5982\uff0c\u5982\u679c\u6700\u591a 100 \u500b\uff0c\u8acb\u6307\u5b9a\u201c0-100\u201d\uff09 | number range    | \u53ef\u9078  | 0-10000   | \u50c5\u9069\u7528\u65bc Hadoop mapreduce \u4f5c\u696d |\n| mapreduce.task.profile.reduces | \u8981\u5206\u6790\u7684\u7e2e\u6e1b\u5668\u4efb\u52d9\u7684\u6578\u91cf\u7bc4\u570d\uff08\u4f8b\u5982\uff0c\u5982\u679c\u6700\u591a 100 \u500b\uff0c\u8acb\u6307\u5b9a\u201c0-100\u201d\uff09 | number range    | \u53ef\u9078  | 0-10000   | \u50c5\u9069\u7528\u65bc Hadoop mapreduce \u4f5c\u696d |\n### PySpark \u793a\u4f8b\n\u5553\u7528\u4e86\u5206\u6790\u7684 PySpark \u4f5c\u696d\u63d0\u4ea4\u793a\u4f8b\uff1a\n```\ngcloud dataproc jobs submit pyspark python-job-file \\\n\u00a0\u00a0\u00a0\u00a0--cluster=cluster-name \\\n\u00a0\u00a0\u00a0\u00a0--region=region \\\n\u00a0\u00a0\u00a0\u00a0--properties=cloud.profiler.enable=true,cloud.profiler.name=profiler_name,cloud.profiler.service.version=version \\\n\u00a0\u00a0\u00a0\u00a0--\u00a0\u00a0job args\n```\n\u5c07\u5275\u5efa\u5169\u500b\u914d\u7f6e\u6587\u4ef6\uff1a- `` `-driver`\uff0c\u7528\u65bc\u5206\u6790 Spark \u9a45\u52d5\u7a0b\u5e8f\u4efb\u52d9\n- `` `-executor`\uff0c\u7528\u65bc\u5206\u6790 Spark \u57f7\u884c\u7a0b\u5e8f\u4efb\u52d9\n\u4f8b\u5982\uff0c\u5982\u679c `profiler_name` \u662f\u201cspark_word_count_job\u201d\uff0c\u5247\u6703\u5275\u5efa `spark_word_count_job-driver` \u548c `spark_word_count_job-executor` \u914d\u7f6e\u6587\u4ef6\u3002\n### Hadoop \u793a\u4f8b\n\u5553\u7528\u4e86\u5206\u6790\u7684 Hadoop (teragen mapreduce) \u4f5c\u696d\u63d0\u4ea4\u793a\u4f8b\uff1a\n```\ngcloud dataproc jobs submit hadoop \\\n\u00a0\u00a0\u00a0\u00a0--cluster=cluster-name \\\n\u00a0\u00a0\u00a0\u00a0--region=region \\\n\u00a0\u00a0\u00a0\u00a0--jar=jar-file \\\n\u00a0\u00a0\u00a0\u00a0--properties=cloud.profiler.enable=true,cloud.profiler.name=profiler_name,cloud.profiler.service.version=version \\\n\u00a0\u00a0\u00a0\u00a0--\u00a0\u00a0teragen 100000 gs://bucket-name\n```\n## \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\n\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 [Profiler](https://console.cloud.google.com/profiler?hl=zh-cn) \u4e2d\u67e5\u770b\u914d\u7f6e\u6587\u4ef6\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u8acb\u53c3\u95b1 [Monitoring \u6587\u6a94](https://cloud.google.com/monitoring/docs?hl=zh-cn) \n- \u8acb\u53c3\u95b1 [Logging \u6587\u6a94](https://cloud.google.com/logging/docs?hl=zh-cn) \n- \u63a2\u7d22 [Google Cloud \u53ef\u89c0\u6e2c\u6027](https://cloud.google.com/stackdriver/docs?hl=zh-cn)", "guide": "Dataproc"}