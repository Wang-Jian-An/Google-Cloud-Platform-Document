{"title": "Dataproc - Dataproc \u53ef\u9078 Flink \u7d44\u4ef6", "url": "https://cloud.google.com/dataproc/docs/concepts/components/flink?hl=zh-cn", "abstract": "# Dataproc - Dataproc \u53ef\u9078 Flink \u7d44\u4ef6\n\u4f7f\u7528 [\u53ef\u9078\u7d44\u4ef6](https://cloud.google.com/dataproc/docs/concepts/components/overview?hl=zh-cn#available_optional_components) \u529f\u80fd\u5275\u5efa Dataproc \u96c6\u7fa3\u6642\uff0c\u53ef\u4ee5\u6fc0\u6d3b\u5176\u4ed6\u7d44\u4ef6\uff0c\u4f8b\u5982 Flink\u3002\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u5275\u5efa\u5553\u7528\u4e86 [Apache Flink](https://flink.apache.org/) \u53ef\u9078\u7d44\u4ef6\u7684 Dataproc \u96c6\u7fa3\uff08Flink \u96c6\u7fa3\uff09\uff0c\u7136\u5f8c\u5728\u8a72\u96c6\u7fa3\u4e0a\u904b\u884c Flink \u4f5c\u696d\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Flink \u96c6\u7fa3\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u901a\u904e Google Cloud \u63a7\u5236\u6aaf\u3001Google Cloud CLI \u6216 Dataproc API [\u4f7f\u7528 Dataproc Jobs \u8cc7\u6e90\u904b\u884c Flink \u4f5c\u696d](#run_flink_jobs_using_the_jobs_resource) \u3002\n- [\u4f7f\u7528\u5728 Flink \u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u904b\u884c\u7684 flink CLI \u904b\u884c Flink \u4f5c\u696d](#run_flink_jobs_using_the_flink_cli) \u3002\n- [\u5728 Flink \u4e0a\u904b\u884c Apache Beam \u4f5c\u696d](#run_apache_beam_jobs_on_flink) \n- [\u5728 Kerberos \u5316\u7684\u96c6\u7fa3\u4e0a\u904b\u884c Flink](#run_flink_on_a_kerberized_cluster) ", "content": "## \u5275\u5efa Dataproc Flink \u96c6\u7fa3\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u3001Google Cloud CLI \u6216 Dataproc API \u4f86\u5275\u5efa Dataproc \u96c6\u7fa3\uff0c\u4e26\u5728\u96c6\u7fa3\u4e0a\u6fc0\u6d3b Flink \u7d44\u4ef6\u3002\n**\u5efa\u8b70** \uff1a\u642d\u914d\u4f7f\u7528\u6a19\u6e96\u7684\u55ae\u4e3b\u6a5f\u865b\u64ec\u6a5f\u96c6\u7fa3\u8207 Flink \u7d44\u4ef6\u3002 [Dataproc \u9ad8\u53ef\u7528\u6027\u6a21\u5f0f\u96c6\u7fa3](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/high-availability?hl=zh-cn) \uff08\u5177\u6709 3 \u500b\u4e3b\u865b\u64ec\u6a5f\uff09\u4e0d\u652f\u6301 [Flink \u9ad8\u53ef\u7528\u6027\u6a21\u5f0f](https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/ha/overview/) \u3002\n\u5982\u9700\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u5275\u5efa Dataproc Flink \u96c6\u7fa3\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a- \u6253\u958b Dataproc [\u5728 Compute Engine \u4e0a\u5275\u5efa Dataproc \u96c6\u7fa3](https://console.cloud.google.com/dataproc/clustersAdd?hl=zh-cn) \u9801\u9762\u3002- \u5df2\u9078\u64c7 **\u8a2d\u7f6e\u96c6\u7fa3** \u9762\u677f\u3002- \u5728 **\u7248\u672c\u63a7\u5236** \u90e8\u5206\u4e2d\uff0c\u78ba\u8a8d\u6216\u66f4\u6539 **\u6620\u50cf\u985e\u578b\u548c\u7248\u672c** \u3002\u96c6\u7fa3\u6620\u50cf\u7248\u672c\u6c7a\u5b9a\u4e86\u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Flink \u7d44\u4ef6\u7684\u7248\u672c\u3002- \u6620\u50cf\u7248\u672c\u5fc5\u9808\u7232 1.5 \u6216\u66f4\u9ad8\u7248\u672c\u624d\u80fd\u5728\u96c6\u7fa3\u4e0a\u6fc0\u6d3b Flink \u7d44\u4ef6\uff08\u5982\u9700\u67e5\u770b\u6bcf\u500b Dataproc \u6620\u50cf\u7248\u672c\u4e2d\u5305\u542b\u7684\u7d44\u4ef6\u7248\u672c\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [\u652f\u6301\u7684 Dataproc \u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn#supported_dataproc_versions) \uff09\u3002\n- \u6620\u50cf\u7248\u672c\u5fc5\u9808\u7232 [TBD] \u6216\u66f4\u9ad8\u7248\u672c\u624d\u80fd\u901a\u904e Dataproc Jobs API \u904b\u884c Flink \u4f5c\u696d\uff08\u8acb\u53c3\u95b1 [\u904b\u884c Dataproc Flink \u4f5c\u696d](#run_flink_jobs) \uff09\u3002\n- \u5728 **\u7d44\u4ef6** \u90e8\u5206\uff1a- \u5728 **\u7d44\u4ef6\u7db2\u95dc** \u4e0b\uff0c\u9078\u64c7 **\u5553\u7528\u7d44\u4ef6\u7db2\u95dc** \u3002\u60a8\u5fc5\u9808\u5553\u7528 [\u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn#console_1) \u624d\u80fd\u6fc0\u6d3b\u6307\u5411 Flink \u6b77\u53f2\u8a18\u9304\u670d\u52d9\u5668\u754c\u9762\u7684\u7d44\u4ef6\u7db2\u95dc\u93c8\u63a5\u3002\u5553\u7528\u7d44\u4ef6\u7db2\u95dc\u9084\u6703\u5141\u8a31\u8a2a\u554f\u5728 Flink \u96c6\u7fa3\u4e0a\u904b\u884c\u7684 [Flink Job Manager \u7db2\u9801\u754c\u9762](#flink-job-manager-ui) \u3002\n- \u5728 **\u53ef\u9078\u7d44\u4ef6** \u4e0b\uff0c\u9078\u64c7\u8981\u5728\u96c6\u7fa3\u4e0a\u6fc0\u6d3b\u7684 **Flink** \u548c\u5176\u4ed6\u53ef\u9078\u7d44\u4ef6\u3002\n- \u9ede\u64ca **\u81ea\u5b9a\u7fa9\u96c6\u7fa3\uff08\u53ef\u9078\uff09** \u9762\u677f\u3002- \u5728 **\u96c6\u7fa3\u5c6c\u6027** \u90e8\u5206\u4e2d\uff0c\u9ede\u64ca\u8981\u6dfb\u52a0\u5230\u96c6\u7fa3\u7684\u6bcf\u500b\u53ef\u9078 [\u96c6\u7fa3\u5c6c\u6027](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/cluster-properties?hl=zh-cn) \u5c0d\u61c9\u7684 **\u6dfb\u52a0\u5c6c\u6027** \u3002\u60a8\u53ef\u4ee5\u6dfb\u52a0\u5e36\u6709 `flink` \u524d\u7db4\u7684\u5c6c\u6027\u4f86\u914d\u7f6e `/etc/flink/conf/flink-conf.yaml` \u4e2d\u7684 Flink \u5c6c\u6027\uff0c\u9019\u4e9b\u5c6c\u6027\u5c07\u5145\u7576\u60a8\u5728\u96c6\u7fa3\u4e0a\u904b\u884c\u7684 Flink \u61c9\u7528\u7684\u9ed8\u8a8d\u503c\u3002\u793a\u4f8b\uff1a- \u8a2d\u7f6e`flink:historyserver.archive.fs.dir`\u4ee5\u6307\u5b9a\u5beb\u5165 Flink \u4f5c\u696d\u6b77\u53f2\u8a18\u9304\u6587\u4ef6\u7684 Cloud Storage \u4f4d\u7f6e\uff08\u6b64\u4f4d\u7f6e\u5c07\u4f9b Flink \u96c6\u7fa3\u4e0a\u904b\u884c\u7684 Flink \u6b77\u53f2\u8a18\u9304\u670d\u52d9\u5668\u4f7f\u7528\uff09\u3002\n- \u4f7f\u7528`flink:taskmanager.numberOfTaskSlots=` ``\u8a2d\u7f6e Flink \u4efb\u52d9\u69fd\u3002\n- \u5728 **\u81ea\u5b9a\u7fa9\u96c6\u7fa3\u5143\u6578\u64da** \u90e8\u5206\u4e2d\uff0c\u9ede\u64ca **\u6dfb\u52a0\u5143\u6578\u64da** \u4ee5\u6dfb\u52a0\u53ef\u9078\u7684\u5143\u6578\u64da\u3002\u4f8b\u5982\uff0c\u6dfb\u52a0 `flink-start-yarn-session` `true` \u4ee5\u5728\u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u5728\u5f8c\u81fa\u904b\u884c Flink YARN \u5b88\u8b77\u7a0b\u5e8f ( `/usr/bin/flink-yarn-daemon` )\uff0c\u4ee5\u5553\u52d5 Flink YARN \u6703\u8a71\uff08\u8acb\u53c3\u95b1 [Flink \u6703\u8a71\u6a21\u5f0f](#session_mode) \uff09\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Dataproc \u6620\u50cf\u7248\u672c 2.0 \u6216\u66f4\u4f4e\u7248\u672c\uff0c\u8acb\u9ede\u64ca **\u7ba1\u7406\u5b89\u5168\u6027\uff08\u53ef\u9078\uff09** \u9762\u677f\uff0c\u7136\u5f8c\u5728 **\u9805\u76ee\u8a2a\u554f\u6b0a\u9650** \u4e0b\u9078\u64c7 `Enables the cloud-platform scope for this cluster` \u3002\u7576\u60a8\u5275\u5efa\u4f7f\u7528 Dataproc \u6620\u50cf 2.1 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa3\u6642\uff0c\u7cfb\u7d71\u6703\u9ed8\u8a8d\u5553\u7528 `cloud-platform` \u7bc4\u570d\u3002\n- \u9ede\u64ca **\u5275\u5efa** \u4ee5\u5275\u5efa\u96c6\u7fa3\u3002\n\u5982\u9700\u4f7f\u7528 gcloud CLI \u5275\u5efa Dataproc Flink \u96c6\u7fa3\uff0c\u8acb\u5728\u7d42\u7aef\u7a97\u53e3\u6216 [Cloud Shell](https://console.cloud.google.com/?cloudshell=true&hl=zh-cn) \u4e2d\u672c\u5730\u904b\u884c\u4ee5\u4e0b [gcloud dataproc clusters create](https://cloud.google.com/sdk/gcloud/reference/dataproc/clusters/create?hl=zh-cn) \u547d\u4ee4\uff1a\n```\ngcloud dataproc clusters create CLUSTER_NAME \\\u00a0 \u00a0 --region=REGION \\\u00a0 \u00a0 --image-version=DATAPROC_IMAGE_VERSION \\\u00a0 \u00a0 --optional-components=FLINK \\\u00a0 \u00a0 --enable-component-gateway \\\u00a0 \u00a0 --properties=PROPERTIES\u00a0 \u00a0 ... other flags\n```\n\u5099\u8a3b\uff1a- \uff1a\u6307\u5b9a\u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \uff1a\u6307\u5b9a\u96c6\u7fa3\u6240\u5728\u7684 [Compute Engine \u5340\u57df](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#available) \u3002\n- \uff1a\uff08\u53ef\u9078\uff09\u6307\u5b9a\u8981\u5728\u96c6\u7fa3\u4e0a\u4f7f\u7528\u7684\u6620\u50cf\u7248\u672c\u3002\u96c6\u7fa3\u6620\u50cf\u7248\u672c\u6c7a\u5b9a\u4e86\u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Flink \u7d44\u4ef6\u7684\u7248\u672c\u3002- \u6620\u50cf\u7248\u672c\u5fc5\u9808\u7232 1.5 \u6216\u66f4\u9ad8\u7248\u672c\u624d\u80fd\u5728\u96c6\u7fa3\u4e0a\u6fc0\u6d3b Flink \u7d44\u4ef6\uff08\u5982\u9700\u67e5\u770b\u6bcf\u500b Dataproc \u6620\u50cf\u7248\u672c\u4e2d\u5305\u542b\u7684\u7d44\u4ef6\u7248\u672c\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [\u652f\u6301\u7684 Dataproc \u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn#supported_dataproc_versions) \uff09\u3002\n- \u6620\u50cf\u7248\u672c\u5fc5\u9808\u7232 [TBD] \u6216\u66f4\u9ad8\u7248\u672c\u624d\u80fd\u901a\u904e Dataproc Jobs API \u904b\u884c Flink \u4f5c\u696d\uff08\u8acb\u53c3\u95b1 [\u904b\u884c Dataproc Flink \u4f5c\u696d](#run_flink_jobs) \uff09\u3002\n- `--optional-components` \uff1a\u60a8\u5fc5\u9808\u6307\u5b9a `FLINK` \u7d44\u4ef6\uff0c\u4ee5\u5728\u96c6\u7fa3\u4e0a\u904b\u884c Flink \u4f5c\u696d\u548c Flink HistoryServer \u7db2\u7d61\u670d\u52d9\u3002\n- `--enable-component-gateway` \uff1a\u60a8\u5fc5\u9808\u5553\u7528 [\u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn#console_1) \u624d\u80fd\u6fc0\u6d3b\u6307\u5411 Flink \u6b77\u53f2\u8a18\u9304\u670d\u52d9\u5668\u754c\u9762\u7684\u7d44\u4ef6\u7db2\u95dc\u93c8\u63a5\u3002\u5553\u7528\u7d44\u4ef6\u7db2\u95dc\u9084\u6703\u5141\u8a31\u8a2a\u554f\u5728 Flink \u96c6\u7fa3\u4e0a\u904b\u884c\u7684 [Flink Job Manager \u7db2\u9801\u754c\u9762](#flink-job-manager-ui) \u3002\n- \u3002\uff08\u53ef\u9078\uff09\u6307\u5b9a\u4e00\u500b\u6216\u591a\u500b [\u96c6\u7fa3\u5c6c\u6027](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/cluster-properties?hl=zh-cn) \u3002- \u4f7f\u7528\u6620\u50cf\u7248\u672c `2.0.67` + \u548c `2.1.15` + \u5275\u5efa Dataproc \u96c6\u7fa3\u6642\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 `--properties` \u6a19\u8a8c\u5728 `/etc/flink/conf/flink-conf.yaml` \u4e2d\u914d\u7f6e Flink \u5c6c\u6027\uff0c\u9019\u4e9b\u5c6c\u6027\u5c07\u7528\u4f5c\u60a8\u5728\u96c6\u7fa3\u4e0a\u904b\u884c\u7684 Flink \u61c9\u7528\u7684\u9ed8\u8a8d\u503c\u3002\n- \u60a8\u53ef\u4ee5\u8a2d\u7f6e `flink:historyserver.archive.fs.dir` \uff0c\u4ee5\u6307\u5b9a\u5beb\u5165 Flink \u4f5c\u696d\u6b77\u53f2\u8a18\u9304\u6587\u4ef6\u7684 Cloud Storage \u4f4d\u7f6e\uff08\u6b64\u4f4d\u7f6e\u5c07\u4f9b Flink \u96c6\u7fa3\u4e0a\u904b\u884c\u7684 Flink \u6b77\u53f2\u8a18\u9304\u670d\u52d9\u5668\u4f7f\u7528\uff09\u3002\n- \u591a\u500b\u5c6c\u6027\u793a\u4f8b\uff1a\n```\n--properties=flink:historyserver.archive.fs.dir=gs://my-bucket/my-flink-cluster/completed-jobs,flink:taskmanager.numberOfTaskSlots=2\n```\n- \u5176\u4ed6\u6a19\u8a8c\uff1a- \u60a8\u53ef\u4ee5\u6dfb\u52a0\u53ef\u9078\u7684`--metadata flink-start-yarn-session=true`\u6a19\u8a8c\uff0c\u4ee5\u5728\u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u5728\u5f8c\u81fa\u904b\u884c Flink YARN \u5b88\u8b77\u7a0b\u5e8f (`/usr/bin/flink-yarn-daemon`) \u4f86\u5553\u52d5 Flink YARN \u6703\u8a71\uff08\u8acb\u53c3\u95b1 [Flink \u6703\u8a71\u6a21\u5f0f](#session_mode) \uff09\u3002\n- \u4f7f\u7528 2.0 \u6216\u66f4\u65e9\u7248\u672c\u7684\u6620\u50cf\u6642\uff0c\u60a8\u53ef\u4ee5\u6dfb\u52a0 `--scopes=https://www.googleapis.com/auth/cloud-platform` \u6a19\u8a8c\uff0c\u4ee5\u4f7f\u96c6\u7fa3\u80fd\u5920\u8a2a\u554f Google Cloud API\uff08\u8acb\u53c3\u95b1 [\u7bc4\u570d\u6700\u4f73\u505a\u6cd5](https://cloud.google.com/compute/docs/access/service-accounts?hl=zh-cn#scopes_best_practice) \uff09\u3002\u7576\u60a8\u5275\u5efa\u4f7f\u7528 Dataproc \u6620\u50cf 2.1 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa3\u6642\uff0c\u7cfb\u7d71\u6703\u9ed8\u8a8d\u5553\u7528 `cloud-platform` \u7bc4\u570d\u3002\n\u5982\u9700\u4f7f\u7528 Dataproc API \u5275\u5efa Dataproc Flink \u96c6\u7fa3\uff0c\u8acb\u63d0\u4ea4 [clusters.create](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters/create?hl=zh-cn) \u8acb\u6c42\uff0c\u5982\u4e0b\u6240\u793a\uff1a\n\u5099\u8a3b\uff1a- \u5c07 [SoftwareConfig.Component](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#SoftwareConfig.FIELDS.optional_components) \u8a2d\u7f6e\u7232 `FLINK` \u3002\n- \u60a8\u53ef\u4ee5\u9078\u64c7\u8a2d\u7f6e [SoftwareConfig.imageVersion](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#softwareconfig) \uff0c\u4ee5\u6307\u5b9a\u8981\u5728\u96c6\u7fa3\u4e0a\u4f7f\u7528\u7684\u6620\u50cf\u7248\u672c\u3002\u96c6\u7fa3\u6620\u50cf\u7248\u672c\u6c7a\u5b9a\u4e86\u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Flink \u7d44\u4ef6\u7684\u7248\u672c\u3002- \u6620\u50cf\u7248\u672c\u5fc5\u9808\u7232 1.5 \u6216\u66f4\u9ad8\u7248\u672c\u624d\u80fd\u5728\u96c6\u7fa3\u4e0a\u6fc0\u6d3b Flink \u7d44\u4ef6\uff08\u5982\u9700\u67e5\u770b\u6bcf\u500b Dataproc \u6620\u50cf\u7248\u672c\u4e2d\u5305\u542b\u7684\u7d44\u4ef6\u7248\u672c\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [\u652f\u6301\u7684 Dataproc \u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn#supported_dataproc_versions) \uff09\u3002\n- \u6620\u50cf\u7248\u672c\u5fc5\u9808\u7232 [TBD] \u6216\u66f4\u9ad8\u7248\u672c\u624d\u80fd\u901a\u904e Dataproc Jobs API \u904b\u884c Flink \u4f5c\u696d\uff08\u8acb\u53c3\u95b1 [\u904b\u884c Dataproc Flink \u4f5c\u696d](#run_flink_jobs) \uff09\u3002\n- \u5c07 [EndpointConfig.enableHttpPortAccess](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#endpointconfig) \u8a2d\u7f6e\u7232 `true` \u53ef [\u5553\u7528\u6307\u5411 Flink \u6b77\u53f2\u8a18\u9304\u670d\u52d9\u5668\u754c\u9762\u7684\u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn#console_1) \u93c8\u63a5\u3002\u5553\u7528\u7d44\u4ef6\u7db2\u95dc\u9084\u6703\u5141\u8a31\u8a2a\u554f\u5728 Flink \u96c6\u7fa3\u4e0a\u904b\u884c\u7684 [Flink Job Manager \u7db2\u9801\u754c\u9762](#flink-job-manager-ui) \u3002\n- \u60a8\u53ef\u4ee5\u9078\u64c7\u8a2d\u7f6e [SoftwareConfig.properties](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#softwareconfig) \u4ee5\u6307\u5b9a\u4e00\u500b\u6216\u591a\u500b [\u96c6\u7fa3\u5c6c\u6027](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/cluster-properties?hl=zh-cn) \u3002- \u60a8\u53ef\u4ee5\u6307\u5b9a Flink \u5c6c\u6027\uff0c\u9019\u4e9b\u5c6c\u6027\u5c07\u7528\u4f5c\u60a8\u5728\u96c6\u7fa3\u4e0a\u904b\u884c\u7684 Flink \u61c9\u7528\u7684\u9ed8\u8a8d\u5c6c\u6027\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u8a2d\u7f6e`flink:historyserver.archive.fs.dir`\uff0c\u4ee5\u6307\u5b9a\u5beb\u5165 Flink \u4f5c\u696d\u6b77\u53f2\u8a18\u9304\u6587\u4ef6\u7684 Cloud Storage \u4f4d\u7f6e\uff08\u6b64\u4f4d\u7f6e\u5c07\u7531 Flink \u96c6\u7fa3\u4e0a\u904b\u884c\u7684 Flink History Server \u4f7f\u7528\uff09\u3002\n- \u60a8\u53ef\u4ee5\u9078\u64c7\u8a2d\u7f6e\uff1a- [GceClusterConfig.metadata](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#GceClusterConfig.FIELDS.metadata) \u3002\u4f8b\u5982\uff0c\u6307\u5b9a`flink-start-yarn-session``true`\u4ee5\u5728\u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u5728\u5f8c\u81fa\u904b\u884c Flink YARN \u5b88\u8b77\u7a0b\u5e8f (`/usr/bin/flink-yarn-daemon`) \u4ee5\u5553\u52d5 Flink YARN \u6703\u8a71\uff08\u8acb\u53c3\u95b1 [Flink \u6703\u8a71\u6a21\u5f0f](#session_mode) \uff09\u3002\n- [GceClusterConfig.serviceAccountScopes](https://cloud.google.com/dataproc/docs/reference/rest/v1/ClusterConfig?hl=zh-cn#GceClusterConfig.FIELDS.service_account_scopes) \u8a2d\u7f6e\u7232`https://www.googleapis.com/auth/cloud-platform`\uff08`cloud-platform`\u7bc4\u570d\uff09\uff0c\u4ee5\u4fbf\u96c6\u7fa3\u5553\u7528\u5c0d Google Cloud API \u7684\u8a2a\u554f\u6b0a\u9650\uff08\u8acb\u53c3\u95b1 [\u7bc4\u570d\u6700\u4f73\u505a\u6cd5](https://cloud.google.com/compute/docs/access/service-accounts?hl=zh-cn#scopes_best_practice) \uff09\u3002\u7576\u60a8\u5275\u5efa\u4f7f\u7528 Dataproc \u6620\u50cf 2.1 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa3\u6642\uff0c\u7cfb\u7d71\u6703\u9ed8\u8a8d\u5553\u7528`cloud-platform`\u7bc4\u570d\u3002\n### \u5275\u5efa Flink \u96c6\u7fa3\u540e\n- \u4f7f\u7528 [\u7d44\u4ef6\u7db2\u95dc](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn#viewing_and_accessing_component_gateway_urls) \u4e2d\u7684`Flink History Server`\u93c8\u63a5\u53ef\u67e5\u770b\u5728 Flink \u96c6\u7fa3\u4e0a\u904b\u884c\u7684 Flink \u6b77\u53f2\u8a18\u9304\u670d\u52d9\u5668\u3002\n- \u4f7f\u7528\u7d44\u4ef6\u7db2\u95dc\u4e2d\u7684`YARN ResourceManager link`\u67e5\u770b Flink \u96c6\u7fa3\u4e0a\u904b\u884c\u7684 [Flink Job Manager \u7db2\u9801\u754c\u9762](#flink-job-manager-ui) \u3002\n- \u5275\u5efa [Dataproc \u6c38\u4e45\u6027\u6b77\u53f2\u8a18\u9304\u670d\u52d9\u5668](https://cloud.google.com/dataproc/docs/concepts/jobs/history-server?hl=zh-cn) \uff0c\u4ee5\u67e5\u770b\u7531\u73fe\u6709\u548c\u5df2\u522a\u9664\u7684 Flink \u96c6\u7fa3\u5beb\u5165\u7684 Flink \u4f5c\u696d\u6b77\u53f2\u8a18\u9304\u6587\u4ef6\u3002## \u4f7f\u7528 Dataproc Jobs \u8cc7\u6e90\u904b\u884c Flink \u4f5c\u696d\n\u60a8\u53ef\u4ee5\u901a\u904e Google Cloud \u63a7\u5236\u6aaf\u3001Google Cloud CLI \u6216 Dataproc API \u4f7f\u7528 Dataproc `Jobs` \u8cc7\u6e90\u904b\u884c Flink \u4f5c\u696d\u3002\n**\u6ce8\u610f** \uff1a\u6b64\u529f\u80fd\u5728 Compute Engine 2.0.71 \u53ca\u66f4\u9ad8\u7248\u672c\u30012.1.19 \u53ca\u66f4\u9ad8\u7248\u672c\u6620\u50cf\u4e0a\u7684 Dataproc \u4e2d\u63d0\u4f9b\u3002**    \u975e\u516c\u958b\u9810\u89bd\u7248     ** \u672c\u7522\u54c1\u6216\u529f\u80fd\u9808\u9075\u5b88 [\u670d\u52d9\u5c08\u7528\u689d\u6b3e](https://cloud.google.com/terms/service-terms?hl=zh-cn#1) \u7684\u201c\u901a\u7528\u670d\u52d9\u689d\u6b3e\u201d\u90e8\u5206\u4e2d\u7684\u201c\u975e\u6b63\u5f0f\u7248\u7522\u54c1\u689d\u6b3e\u201d\u3002 \u6b63\u5f0f\u767c\u4f48\u524d\u7522\u54c1\u548c\u529f\u80fd\u201c\u6309\u539f\u6a23\u201d\u63d0\u4f9b\uff0c\u53ef\u80fd\u50c5\u63d0\u4f9b\u6709\u9650\u652f\u6301\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u767c\u4f48\u968e\u6bb5\u8aaa\u660e](https://cloud.google.com/products?hl=zh-cn#product-launch-stages) \u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u8a2a\u554f\u6b64\u7248\u672c\uff0c\u8acb\u53c3\u95b1 [\u8a2a\u554f\u7533\u8acb\u9801\u9762](https://cloud.google.com/dataproc/docs/support/getting-support?hl=zh-cn#dataproc-allowlist) \u3002\n\u5982\u9700\u5f9e\u63a7\u5236\u6aaf\u63d0\u4ea4 Flink Wordcount \u4f5c\u696d\u793a\u4f8b\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5728\u700f\u89bd\u5668\u4e2d\u7684 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u6253\u958b Dataproc [\u63d0\u4ea4\u4f5c\u696d](https://console.cloud.google.com/dataproc/jobs/jobsSubmit?hl=zh-cn) \u9801\u9762\u3002\n- \u586b\u5beb **\u63d0\u4ea4\u4f5c\u696d** \u9801\u9762\u4e0a\u7684\u5b57\u6bb5\uff1a- \u5f9e\u96c6\u7fa3\u5217\u8868\u4e2d\u9078\u64c7 **\u96c6\u7fa3** \u540d\u7a31\u3002\n- \u5c07 **\u4f5c\u696d\u985e\u578b** \u8a2d\u7f6e\u7232`Flink`\u3002\n- \u5c07 **\u4e3b\u985e\u6216 jar** \u8a2d\u7f6e\u7232`org.apache.flink.examples.java.wordcount.WordCount`\u3002\n- \u5c07 **Jar \u6587\u4ef6** \u8a2d\u7f6e\u7232`file:///usr/lib/flink/examples/batch/WordCount.jar`\u3002- `file:///`\u8868\u793a\u4f4d\u65bc\u96c6\u7fa3\u4e0a\u7684\u6587\u4ef6\u3002Dataproc \u5728\u5275\u5efa Flink \u96c6\u7fa3\u6642\u5b89\u88dd\u4e86`WordCount.jar`\u3002\n- \u6b64\u5b57\u6bb5\u9084\u63a5\u53d7 Cloud Storage \u8def\u5f91 (`gs://` `` `/` ``) \u6216 Hadoop \u5206\u4f48\u5f0f\u6587\u4ef6\u7cfb\u7d71 (HDFS) \u8def\u5f91 (`hdfs://` ``)\u3002\n- \u9ede\u64ca **\u63d0\u4ea4** \u3002- \u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u8f38\u51fa\u6703\u986f\u793a\u5728 **\u4f5c\u696d\u8a73\u60c5** \u9801\u9762\u4e0a\u3002\n- Flink \u4f5c\u696d\u5217\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Dataproc [\u4f5c\u696d](https://console.cloud.google.com/dataproc/jobs?hl=zh-cn) \u9801\u9762\u4e0a\u3002\n- \u5728 **\u4f5c\u696d** \u6216 **\u4f5c\u696d\u8a73\u60c5** \u9801\u9762\u4e2d\u9ede\u64ca **\u505c\u6b62** \u6216 **\u522a\u9664** \uff0c\u4ee5\u505c\u6b62\u6216\u522a\u9664\u4f5c\u696d\u3002\n\u5982\u9700\u5c07 Flink \u4f5c\u696d\u63d0\u4ea4\u5230 Dataproc Flink \u96c6\u7fa3\uff0c\u8acb\u5728\u7d42\u7aef\u7a97\u53e3\u6216 [Cloud Shell](https://console.cloud.google.com/?cloudshell=true&hl=zh-cn) \u4e2d\u672c\u5730\u904b\u884c gcloud CLI [gcloud dataproc job submit](https://cloud.google.com/sdk/gcloud/reference/dataproc/jobs/submit?hl=zh-cn) \u547d\u4ee4\u3002\n```\ngcloud dataproc jobs submit flink \\\u00a0 \u00a0 --cluster=CLUSTER_NAME \\\u00a0 \u00a0 --region=REGION \\\u00a0 \u00a0 --class=MAIN_CLASS \\\u00a0 \u00a0 --jar=JAR_FILE \\\u00a0 \u00a0 -- JOB_ARGS\n```\n\u5099\u8a3b\uff1a- \uff1a\u6307\u5b9a\u8981\u5411\u5176\u63d0\u4ea4\u4f5c\u696d\u7684 Dataproc Flink \u96c6\u7fa3\u7684\u540d\u7a31\u3002\n- \uff1a\u6307\u5b9a\u96c6\u7fa3\u6240\u5728\u7684 [Compute Engine \u5340\u57df](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#available) \u3002\n- \uff1a\u6307\u5b9a Flink \u61c9\u7528\u7684`main`\u985e\uff0c\u4f8b\u5982\uff1a- `org.apache.flink.examples.java.wordcount.WordCount`\n- \uff1a\u6307\u5b9a Flink \u61c9\u7528 jar \u6587\u4ef6\u3002\u60a8\u53ef\u4ee5\u6307\u5b9a\uff1a- \u4f7f\u7528file:///` \u524d\u7db4\u5728\u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 jar \u6587\u4ef6\uff1a- `file:///usr/lib/flink/examples/streaming/TopSpeedWindowing.jar`\n- `file:///usr/lib/flink/examples/batch/WordCount.jar`\n- Cloud Storage \u4e2d\u7684 jar \u6587\u4ef6\uff1a`gs://` `` `/` ``\n- HDFS \u4e2d\u7684 jar \u6587\u4ef6\uff1a`hdfs://` ``\n- \uff1a\uff08\u53ef\u9078\uff09\u5728\u96d9\u77ed\u5283\u7dda ( `--` ) \u5f8c\u9762\u6dfb\u52a0\u4f5c\u696d\u53c3\u6578\u3002\n- \u63d0\u4ea4\u4f5c\u696d\u5f8c\uff0c\u4f5c\u696d\u9a45\u52d5\u7a0b\u5e8f\u8f38\u51fa\u5c07\u986f\u793a\u5728\u672c\u5730\u6216 Cloud Shell \u7d42\u7aef\u4e2d\u3002```\nProgram execution finishedJob with JobID 829d48df4ebef2817f4000dfba126e0f has finished.Job Runtime: 13610 ms...(after,1)(and,12)(arrows,1)(ay,1)(be,4)(bourn,1)(cast,1)(coil,1)(come,1)\n```\n **\u6ce8\u610f** \uff1a\u60a8\u53ef\u4ee5\u4f7f\u7528 [gcloud dataproc jobs kill JOB_ID](https://cloud.google.com/sdk/gcloud/reference/dataproc/jobs/kill?hl=zh-cn) \u547d\u4ee4\u505c\u6b62\u4f5c\u696d\uff0c\u4f7f\u7528 [gcloud dataproc jobs delete JOB_ID](https://cloud.google.com/sdk/gcloud/reference/dataproc/jobs/delete?hl=zh-cn) \u547d\u4ee4\u522a\u9664\u4f5c\u696d\u3002\n\u672c\u90e8\u5206\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528 Dataproc [jobs.submit](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.jobs/submit?hl=zh-cn) API \u5c07 Flink \u4f5c\u696d\u63d0\u4ea4\u5230 Dataproc Flink \u96c6\u7fa3\u3002\n\u60a8\u53ef\u4ee5\u5c07`clusterLabels`\u5b57\u6bb5\u6dfb\u52a0\u5230\u5982\u4e0b\u6240\u793a\u7684 API \u8acb\u6c42\u4e2d\uff0c\u4ee5\u6307\u5b9a\u4e00\u500b\u6216\u591a\u500b\u96c6\u7fa3\u6a19\u7c64\u3002Dataproc \u6703\u5c07\u4f5c\u696d\u63d0\u4ea4\u5230\u8207\u6307\u5b9a\u96c6\u7fa3\u6a19\u7c64\u5339\u914d\u7684\u96c6\u7fa3\uff08\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [jobs.submit](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.jobs?hl=zh-cn#JobPlacement.FIELDS.cluster_labels) API\uff09\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1aGoogle Cloud \u9805\u76ee ID\n- \uff1a [\u96c6\u7fa3\u5730\u5340](https://cloud.google.com/dataproc/docs/guides/create-cluster?hl=zh-cn#cluster-region) \n- \uff1a\u6307\u5b9a\u8981\u5411\u5176\u63d0\u4ea4\u4f5c\u696d\u7684 Dataproc Flink \u96c6\u7fa3\u7684\u540d\u7a31\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://dataproc.googleapis.com/v1/projects/PROJECT_ID/regions/REGION/jobs:submit\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"job\": {\n \"placement\": {\n  \"clusterName\": \"CLUSTER_NAME\"\n },\n \"flinkJob\": {\n  \"mainClass\": \"org.apache.flink.examples.java.wordcount.WordCount\",\n  \"jarFileUris\": [  \"file:///usr/lib/flink/examples/batch/WordCount.jar\"\n  ]\n }\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"reference\": {\n \"projectId\": \"PROJECT_ID\",\n \"jobId\": \"JOB_ID\"\n },\n \"placement\": {\n \"clusterName\": \"CLUSTER_NAME\",\n \"clusterUuid\": \"CLUSTER_UUID\"\n },\n \"flinkJob\": {\n \"mainClass\": \"org.apache.flink.examples.java.wordcount.WordCount\",\n \"args\": [  \"1000\"\n ],\n \"jarFileUris\": [  \"file:///usr/lib/flink/examples/batch/WordCount.jar\"\n ]\n },\n \"status\": {\n \"state\": \"PENDING\",\n \"stateStartTime\": \"2020-10-07T20:16:21.759Z\"\n },\n \"jobUuid\": \"JOB_UUID\"\n}\n```\n **\u6ce8\u610f** \uff1a\u60a8\u53ef\u4ee5\u9ede\u64ca Dataproc Google Cloud \u63a7\u5236\u6aaf [\u63d0\u4ea4\u4f5c\u696d](https://console.cloud.google.com/dataproc/jobs/jobsSubmit?hl=zh-cn) \u9801\u9762\u5e95\u90e8\u7684 **\u7b49\u6548 REST** \u93c8\u63a5\uff0c\u8b93 Google Cloud \u63a7\u5236\u6aaf\u69cb\u5efa\u4e00\u500b\u7b49\u6548\u7684 API REST \u8acb\u6c42\uff0c\u7528\u65bc\u5728\u4ee3\u78bc\u4e2d\u5c07\u4f5c\u696d\u63d0\u4ea4\u5230\u96c6\u7fa3\u3002- Flink \u4f5c\u696d\u5217\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Dataproc [\u4f5c\u696d](https://console.cloud.google.com/dataproc/jobs?hl=zh-cn) \u9801\u9762\u4e0a\u3002\n- \u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 **\u4f5c\u696d** \u6216 **\u4f5c\u696d\u8a73\u60c5** \u9801\u9762\u4e2d\u9ede\u64ca **\u505c\u6b62** \u6216 **\u522a\u9664** \uff0c\u4ee5\u505c\u6b62\u6216\u522a\u9664\u4f5c\u696d\u3002\n## \u4f7f\u7528 flink CLI \u904b\u884c Flink \u4f5c\u696d\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `flink` CLI \u5728 Flink \u96c6\u7fa3\u7684\u4e3b\u7bc0\u9ede\u4e0a\u904b\u884c Flink \u4f5c\u696d\uff0c\u800c\u4e0d\u662f [\u4f7f\u7528 Dataproc Jobs \u8cc7\u6e90\u904b\u884c Flink \u4f5c\u696d](#run_flink_jobs_using_the_jobs_resource) \u3002\n**\u6ce8\u610f** \uff1a\u5982\u9700\u5728\u60a8\u7684\u96c6\u7fa3\u4e0a\u4f7f\u7528 `flink` CLI\uff0c\u60a8\u5fc5\u9808\u5728\u5275\u5efa\u96c6\u7fa3\u6642\u6fc0\u6d3b Flink \u53ef\u9078\u7d44\u4ef6\u3002\u8acb\u53c3\u95b1 [\u5275\u5efa Dataproc Flink \u96c6\u7fa3](#create_a_flink_cluster) \u3002\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u5728 Dataproc Flink \u96c6\u7fa3\u4e0a\u904b\u884c `flink` CLI \u4f5c\u696d\u7684\u4e0d\u540c\u65b9\u6cd5\u3002\n- **\u901a\u904e SSH \u9023\u63a5\u5230\u4e3b\u7bc0\u9ede** \uff1a\u4f7f\u7528 [SSH](https://cloud.google.com/dataproc/docs/concepts/accessing/ssh?hl=zh-cn) \u5be6\u7528\u7a0b\u5e8f\u5728\u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u865b\u64ec\u6a5f\u4e0a\u6253\u958b\u4e00\u500b\u7d42\u7aef\u7a97\u53e3\u3002\n- **\u8a2d\u7f6e\u985e\u8def\u5f91** \uff1a\u5728 Flink \u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u865b\u64ec\u6a5f\u4e0a\u7684 SSH \u7d42\u7aef\u7a97\u53e3\u4e2d\u521d\u59cb\u5316 Hadoop \u985e\u8def\u5f91\uff1a```\nexport HADOOP_CLASSPATH=$(hadoop classpath)\n``` **\u6ce8\u610f** \uff1aFlink \u547d\u4ee4\u8a9e\u6cd5\u53ef\u80fd\u6703\u56e0 Dataproc \u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Flink \u7248\u672c\u800c\u7570\u3002\u8acb\u53c3\u95b1 [Dataproc \u6620\u50cf\u7248\u672c\u5217\u8868](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn) \u6216\u5728\u96c6\u7fa3\u4e0a\u904b\u884c `flink --version` \uff0c\u4ee5\u6aa2\u67e5 Flink \u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Flink \u7d44\u4ef6\u7248\u672c\u3002\u5982\u9700\u77ad\u89e3\u5176\u4ed6\u6a19\u8a8c\u4fe1\u606f\uff0c\u8acb\u904b\u884c `flink` \u547d\u4ee4\u5e6b\u52a9\u3002\n- **\u904b\u884c Flink \u4f5c\u696d** \uff1a\u60a8\u53ef\u4ee5\u5728 [YARN \u4e0a\u7684\u4e0d\u540c\u90e8\u7f72\u6a21\u5f0f](https://nightlies.apache.org/flink/flink-docs-stable/docs/deployment/resource-providers/yarn/#deployment-modes-supported-by-flink-on-yarn) \uff08\u61c9\u7528\u3001\u6bcf\u500b\u4f5c\u696d\u548c\u6703\u8a71\u6a21\u5f0f\uff09\u4e0b\u904b\u884c Flink \u4f5c\u696d\u3002- **\u61c9\u7528\u6a21\u5f0f** \uff1aDataproc \u6620\u50cf 2.0 \u53ca\u66f4\u9ad8\u7248\u672c\u652f\u6301 Flink \u61c9\u7528\u6a21\u5f0f\u3002 \u6b64\u6a21\u5f0f\u5728 YARN \u4f5c\u696d\u7ba1\u7406\u5668\u4e0a\u57f7\u884c\u4f5c\u696d\u7684 `main()` \u65b9\u6cd5\u3002\u96c6\u7fa3\u6703\u5728\u4f5c\u696d\u5b8c\u6210\u5f8c\u95dc\u9589\u3002\u4f5c\u696d\u63d0\u4ea4\u793a\u4f8b\uff1a```\nflink run-application \\\n\u00a0\u00a0\u00a0\u00a0-t yarn-application \\\n\u00a0\u00a0\u00a0\u00a0-Djobmanager.memory.process.size=1024m \\\n\u00a0\u00a0\u00a0\u00a0-Dtaskmanager.memory.process.size=2048m \\\n\u00a0\u00a0\u00a0\u00a0-Djobmanager.heap.mb=820 \\\n\u00a0\u00a0\u00a0\u00a0-Dtaskmanager.heap.mb=1640 \\\n\u00a0\u00a0\u00a0\u00a0-Dtaskmanager.numberOfTaskSlots=2 \\\n\u00a0\u00a0\u00a0\u00a0-Dparallelism.default=4 \\\n\u00a0\u00a0\u00a0\u00a0/usr/lib/flink/examples/batch/WordCount.jar\n```\u5217\u51fa\u6b63\u5728\u904b\u884c\u7684\u4f5c\u696d\uff1a```\n./bin/flink list -t yarn-application -Dyarn.application.id=application_XXXX_YY\n```\u53d6\u6d88\u6b63\u5728\u904b\u884c\u7684\u4f5c\u696d\uff1a```\n./bin/flink cancel -t yarn-application -Dyarn.application.id=application_XXXX_YY <jobId>\n```\n- **\u6309\u4f5c\u696d\u6a21\u5f0f** \uff1a\u6b64 Flink \u6a21\u5f0f\u5728\u5ba2\u6236\u7aef\u57f7\u884c\u4f5c\u696d\u7684 `main()` \u65b9\u6cd5\u3002\u4f5c\u696d\u63d0\u4ea4\u793a\u4f8b\uff1a```\nflink run \\\n\u00a0\u00a0\u00a0\u00a0-m yarn-cluster \\\n\u00a0\u00a0\u00a0\u00a0-p 4 \\\n\u00a0\u00a0\u00a0\u00a0-ys 2 \\\n\u00a0\u00a0\u00a0\u00a0-yjm 1024m \\\n\u00a0\u00a0\u00a0\u00a0-ytm 2048m \\\n\u00a0\u00a0\u00a0\u00a0/usr/lib/flink/examples/batch/WordCount.jar\n```\n- **\u6703\u8a71\u6a21\u5f0f** \uff1a\u5553\u52d5\u4e00\u500b\u9577\u6642\u9593\u904b\u884c\u7684 Flink YARN \u6703\u8a71\uff0c\u7136\u5f8c\u5411\u8a72\u6703\u8a71\u63d0\u4ea4\u4e00\u500b\u6216\u591a\u500b\u4f5c\u696d\u3002- **\u5553\u52d5\u6703\u8a71** \uff1a\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u4efb\u4e00\u65b9\u5f0f\u5553\u52d5 Flink \u6703\u8a71\uff1a- [\u5275\u5efa Flink \u96c6\u7fa3](#install_the_component) \uff0c\u4e26\u5c07 `--metadata flink-start-yarn-session=true` \u6a19\u8a8c\u6dfb\u52a0\u5230 `gcloud dataproc clusters create` \u547d\u4ee4\uff08\u8acb\u53c3\u95b1 [\u5275\u5efa Dataproc Flink \u96c6\u7fa3](#create_a_flink_cluster) \uff09\u3002\u5553\u7528\u6b64\u6a19\u8a8c\u5f8c\uff0c\u5275\u5efa\u96c6\u7fa3\u540e\uff0cDataproc \u5c07\u904b\u884c `/usr/bin/flink-yarn-daemon` \u4ee5\u5728\u96c6\u7fa3\u4e0a\u5553\u52d5 Flink \u6703\u8a71\u3002\u6703\u8a71\u7684 YARN \u61c9\u7528 ID \u4fdd\u5b58\u5728 `/tmp/.yarn-properties-${USER}` \u4e2d\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 `yarn application -list` \u547d\u4ee4\u5217\u51fa\u6b64 ID\u3002\n- \u4f7f\u7528\u81ea\u5b9a\u7fa9\u8a2d\u7f6e\u904b\u884c\u9810\u5b89\u88dd\u5728\u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u865b\u64ec\u6a5f\u4e0a\u7684 Flink [yarn-session.sh](https://github.com/apache/flink/blob/master/flink-dist/src/main/flink-bin/yarn-bin/yarn-session.sh) \u8173\u672c\uff1a\u4f7f\u7528\u81ea\u5b9a\u7fa9\u8a2d\u7f6e\u7684\u793a\u4f8b\uff1a```\n/usr/lib/flink/bin/yarn-session.sh \\\n\u00a0\u00a0\u00a0\u00a0-s 1 \\\n\u00a0\u00a0\u00a0\u00a0-jm 1024m \\\n\u00a0\u00a0\u00a0\u00a0-tm 2048m \\\n\u00a0\u00a0\u00a0\u00a0-nm flink-dataproc \\\n\u00a0\u00a0\u00a0\u00a0--detached\n```\n- \u4f7f\u7528\u9ed8\u8a8d\u8a2d\u7f6e\u904b\u884c Flink `/usr/bin/flink-yarn-daemon` \u5c01\u88dd\u5bb9\u5668\u8173\u672c\uff1a```\n. /usr/bin/flink-yarn-daemon\n```\n- **\u5c07\u4f5c\u696d\u63d0\u4ea4\u5230\u6703\u8a71** \uff1a\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c07 Flink \u4f5c\u696d\u63d0\u4ea4\u5230\u6703\u8a71\u3002```\nflink run -m <var>FLINK_MASTER_URL</var>/usr/lib/flink/examples/batch/WordCount.jar\n```- \uff1a\u57f7\u884c\u4f5c\u696d\u7684 Flink \u4e3b\u865b\u64ec\u6a5f\u7684\u7db2\u5740\uff08\u5305\u62ec\u4e3b\u6a5f\u548c\u7aef\u53e3\uff09\u3002 **\u5f9e\u7db2\u5740\u4e2d\u79fb\u9664 http:// prefix** \u3002\u5553\u52d5 Flink \u6703\u8a71\u6642\uff0c\u547d\u4ee4\u8f38\u51fa\u4e2d\u6703\u5217\u51fa\u8a72\u7db2\u5740\u3002\u60a8\u53ef\u4ee5\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5728`Tracking-URL`\u5b57\u6bb5\u4e2d\u5217\u51fa\u6b64\u7db2\u5740\uff1a\n```\nyarn application -list -appId=<yarn-app-id> | sed 's#http://\n##'\n ```\n```\n- **\u5217\u51fa\u6703\u8a71\u4e2d\u7684\u4f5c\u696d** \uff1a\u5982\u9700\u5217\u51fa\u6703\u8a71\u4e2d\u7684 Flink \u4f5c\u696d\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u4e4b\u4e00\uff1a- \u904b\u884c\u4e0d\u5e36\u5be6\u53c3\u7684 `flink list` \u3002\u8a72\u547d\u4ee4\u6703\u5728 `/tmp/.yarn-properties-${USER}` \u4e2d\u67e5\u627e\u6703\u8a71\u7684 YARN \u61c9\u7528 ID\u3002\n- \u5f9e `/tmp/.yarn-properties-${USER}` \u6216 `yarn application -list` \u7684\u8f38\u51fa\u7372\u53d6\u6703\u8a71\u7684 YARN \u61c9\u7528 ID\uff0c\u7136\u5f8c\u904b\u884c `<code>` flink list -yid \u3002\n- \u904b\u884c `flink list -m` `` \u3002\n- **\u505c\u6b62\u6703\u8a71** \uff1a\u5982\u9700\u505c\u6b62\u6703\u8a71\uff0c\u8acb\u5f9e `/tmp/.yarn-properties-${USER}` \u6216 `yarn application -list` \u7684\u8f38\u51fa\u7372\u53d6\u6703\u8a71\u7684 YARN \u61c9\u7528 ID\uff0c\u7136\u5f8c\u904b\u884c\u4ee5\u4e0b\u4efb\u4e00\u547d\u4ee4\uff1a```\necho \"stop\" | /usr/lib/flink/bin/yarn-session.sh -id YARN_APPLICATION_ID\n``````\nyarn application -kill YARN_APPLICATION_ID\n```## \u5728 Flink \u4e0a\u904b\u884c Apache Beam \u4f5c\u696d\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [FlinkRunner](https://beam.apache.org/documentation/runners/flink/) \u5728 Dataproc \u4e0a\u904b\u884c [Apache Beam](https://beam.apache.org/) \u4f5c\u696d\u3002\n**\u6ce8\u610f** \uff1a\u5728 Beam 2.18 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u9700\u8981\u55ae\u7368\u7684 Beam \u4f5c\u696d\u670d\u52d9\u4f86\u5c01\u88dd\u7528 Python \u7de8\u5beb\u7684\u4f5c\u696d\u4e26\u5c07\u5176\u63d0\u4ea4\u5230 Flink\u3002\u5f9e Beam 2.18 \u958b\u59cb\uff0c\u4e0d\u518d\u9700\u8981 Beam \u4f5c\u696d\u670d\u52d9\u3002\n\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u65b9\u5f0f\u5728 Flink \u4e0a\u904b\u884c Beam \u4f5c\u696d\uff1a\n- Java Beam \u4f5c\u696d\n- \u53ef\u79fb\u690d\u7684 Beam \u4f5c\u696d\n### Java Beam \u4f5c\u696d\n[\u5c07 Beam \u4f5c\u696d\u6253\u5305\u6210\u4e00\u500b JAR \u6587\u4ef6](https://beam.apache.org/documentation/runners/flink/#executing-a-beam-pipeline-on-a-flink-cluster) \u3002\u7232\u6346\u7d81\u7684 JAR \u6587\u4ef6\u63d0\u4f9b\u904b\u884c\u4f5c\u696d\u6240\u9700\u7684\u4f9d\u8cf4\u9805\u3002\n\u4ee5\u4e0b\u793a\u4f8b\u5f9e Dataproc \u96c6\u7fa3\u7684\u4e3b\u7bc0\u9ede\u904b\u884c Java Beam \u4f5c\u696d\u3002\n**\u6ce8\u610f** \uff1a\u5c0d\u65bc Dataproc 1.5\u3001Flink 1.9 \u548c [\u517c\u5bb9\u7684 Beam \u7248\u672c](https://beam.apache.org/documentation/runners/flink/#flink-version-compatibility) \uff0c\u6b64\u793a\u4f8b\u53ef\u6210\u529f\u57f7\u884c\u3002\u4f46\u662f\uff0c\u5c0d\u65bc Dataproc 2.0\u3001Flink 1.12 \u548c Beam 2.30 \u53ca\u66f4\u9ad8\u7248\u672c\uff0c\u8acb\u53c3\u95b1\u6b64 JIRA \u554f\u984c [BEAM-10430](https://issues.apache.org/jira/browse/BEAM-10430) \u3002\n- \u5275\u5efa\u5553\u7528\u4e86 [Flink \u7d44\u4ef6](https://cloud.google.com/dataproc/docs/concepts/components/flink?hl=zh-cn) \u7684 Dataproc \u96c6\u7fa3\u3002```\ngcloud dataproc clusters create CLUSTER_NAME \\\n --optional-components=FLINK \\\n --image-version=DATAPROC_IMAGE_VERSION \\\n --region=REGION \\\n --enable-component-gateway \\\n --scopes=https://www.googleapis.com/auth/cloud-platform\n```- `--optional-components`\uff1aFlink\u3002\n- `--image-version`\uff1a [\u96c6\u7fa3\u7684\u6620\u50cf\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn#supported_cloud_dataproc_versions) \uff0c\u7528\u65bc\u78ba\u5b9a\u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Flink \u7248\u672c\uff08\u4f8b\u5982\uff0c\u8acb\u53c3\u95b1\u91dd\u5c0d\u6700\u8fd1 4 \u500b [2.0.x \u6620\u50cf\u767c\u4f48\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-release-2.0?hl=zh-cn) \u5217\u51fa\u7684 Apache Flink \u7d44\u4ef6\u7248\u672c\uff09\u3002\n- `--region`\uff1a\u53d7\u652f\u6301\u7684 Dataproc [\u5340\u57df](https://cloud.google.com/dataproc/docs/concepts/regional-endpoints?hl=zh-cn#regional_endpoint_semantics) \u3002\n- `--enable-component-gateway`\uff1a\u5553\u7528\u5c0d Flink Job Manager \u754c\u9762\u7684\u8a2a\u554f\u6b0a\u9650\u3002\n- `--scopes`\uff1a\u5553\u7528\u96c6\u7fa3\u5c0d Google Cloud API \u7684\u8a2a\u554f\u6b0a\u9650\uff08\u8acb\u53c3\u95b1 [\u7bc4\u570d\u6700\u4f73\u505a\u6cd5](https://cloud.google.com/compute/docs/access/service-accounts?hl=zh-cn#scopes_best_practice) \uff09\u3002\u7576\u60a8\u5275\u5efa\u4f7f\u7528 Dataproc \u6620\u50cf 2.1 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa3\u6642\uff0c\u7cfb\u7d71\u6703\u9ed8\u8a8d\u5553\u7528`cloud-platform`\u7bc4\u570d\uff08\u7121\u9700\u5305\u62ec\u6b64\u6a19\u8a8c\u8a2d\u7f6e\uff09\u3002\n- \u4f7f\u7528 [SSH \u5be6\u7528\u7a0b\u5e8f](https://cloud.google.com/dataproc/docs/concepts/accessing/cluster-web-interfaces?hl=zh-cn#create_an_ssh_tunnel) \u5728 Flink \u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u6253\u958b\u4e00\u500b\u7d42\u7aef\u7a97\u53e3\u3002\n- \u5728 Dataproc \u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u5553\u52d5 Flink YARN \u6703\u8a71\u3002```\n. /usr/bin/flink-yarn-daemon\n```\u8a18\u4e0b Dataproc \u96c6\u7fa3\u4e0a\u7684 Flink \u7248\u672c\u3002```\nflink --version\n```\n- \u5728\u672c\u5730\u6a5f\u5668\u4e0a\uff0c [\u4f7f\u7528 Java \u751f\u6210\u898f\u7bc4\u7684 Beam \u5b57\u6578\u7d71\u8a08\u793a\u4f8b](https://beam.apache.org/get-started/quickstart-java/) \u3002\u9078\u64c7\u8207 Dataproc \u96c6\u7fa3\u4e0a\u7684 Flink \u7248\u672c\u517c\u5bb9\u7684 Beam \u7248\u672c\u3002\u8acb\u53c3\u95b1 [Flink \u7248\u672c\u517c\u5bb9\u6027](https://beam.apache.org/documentation/runners/flink/#flink-version-compatibility) \u8868\uff0c\u5176\u4e2d\u5217\u51fa\u4e86 Beam \u8207 Flink \u4e4b\u9593\u7684\u7248\u672c\u517c\u5bb9\u6027\u3002\u6253\u958b\u751f\u6210\u7684 POM \u6587\u4ef6\u3002\u6aa2\u67e5 `<flink.artifact.name>` \u6a19\u8a18\u6307\u5b9a\u7684 Beam Flink \u904b\u884c\u7a0b\u5e8f\u7248\u672c\u3002\u5982\u679c Flink \u5de5\u4ef6\u540d\u7a31\u4e2d\u7684 Beam Flink \u904b\u884c\u7a0b\u5e8f\u7248\u672c\u8207\u60a8\u7684\u96c6\u7fa3\u4e0a\u7684 Flink \u7248\u672c\u4e0d\u5339\u914d\uff0c\u8acb\u66f4\u65b0\u7248\u672c\u865f\u4ee5\u4f7f\u5176\u76f8\u5339\u914d\u3002```\nmvn archetype:generate \\\n -DarchetypeGroupId=org.apache.beam \\\n -DarchetypeArtifactId=beam-sdks-java-maven-archetypes-examples \\\n -DarchetypeVersion=BEAM_VERSION \\\n -DgroupId=org.example \\\n -DartifactId=word-count-beam \\\n -Dversion=\"0.1\" \\\n -Dpackage=org.apache.beam.examples \\\n -DinteractiveMode=false\n```\n- \u6253\u5305\u5b57\u6578\u7d71\u8a08\u793a\u4f8b\u3002```\nmvn package -Pflink-runner\n```\n- \u5c07\u6253\u5305\u7684\u8d85\u7d1a JAR \u6587\u4ef6 `word-count-beam-bundled-0.1.jar` \uff08\u7d04 135 MB\uff09\u4e0a\u50b3\u5230\u60a8\u7684 Dataproc \u96c6\u7fa3\u7684\u4e3b\u7bc0\u9ede\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 [gsutil cp](https://cloud.google.com/storage/docs/gsutil/commands/cp?hl=zh-cn) \u52a0\u5feb\u5f9e Cloud Storage \u5411 Dataproc \u96c6\u7fa3\u50b3\u8f38\u6587\u4ef6\u7684\u901f\u5ea6\u3002- \u5728\u672c\u5730\u7d42\u7aef\u4e0a\uff0c\u5275\u5efa\u4e00\u500b Cloud Storage \u5b58\u5132\u6876\uff0c\u7136\u5f8c\u4e0a\u50b3\u8d85\u7d1a JAR\u3002```\ngsutil mb BUCKET_NAME\ngsutil cp target/word-count-beam-bundled-0.1.jar gs://BUCKET_NAME/\n```\n- \u5728 Dataproc \u7684\u4e3b\u7bc0\u9ede\u4e0a\uff0c\u4e0b\u8f09\u8d85\u7d1a JAR\u3002```\ngsutil cp gs://BUCKET_NAME/word-count-beam-bundled-0.1.jar .\n```\n- \u5728 Dataproc \u96c6\u7fa3\u7684\u4e3b\u7bc0\u9ede\u4e0a\u904b\u884c Java Beam \u4f5c\u696d\u3002```\nflink run -c org.apache.beam.examples.WordCount word-count-beam-bundled-0.1.jar \\\n --runner=FlinkRunner \\\n --output=gs://BUCKET_NAME/java-wordcount-out\n```\n- \u6aa2\u67e5\u7d50\u679c\u662f\u5426\u5df2\u5beb\u5165 Cloud Storage \u5b58\u5132\u6876\u3002```\ngsutil cat gs://BUCKET_NAME/java-wordcount-out-SHARD_ID\n```\n- \u505c\u6b62 Flink YARN \u6703\u8a71\u3002```\nyarn application -list\nyarn application -kill YARN_APPLICATION_ID\n```\n### \u53ef\u79fb\u690d\u7684 Beam \u4f5c\u696d\n\u5982\u9700\u904b\u884c\u4ee5 Python\u3001Go \u548c\u5176\u4ed6\u652f\u6301\u7684\u8a9e\u8a00\u7de8\u5beb\u7684 Beam \u4f5c\u696d\uff0c\u60a8\u53ef\u4ee5\u6309\u7167 Beam \u7684 [Flink \u904b\u884c\u7a0b\u5e8f](https://beam.apache.org/documentation/runners/flink/) \u9801\u9762\u4e2d\u7684\u8aaa\u660e\u4f7f\u7528 `FlinkRunner` \u548c `PortableRunner` \uff08\u53e6\u8acb\u53c3\u95b1 [\u53ef\u79fb\u690d\u6027\u6846\u67b6\u8def\u7dda\u5716](https://beam.apache.org/roadmap/portability/) \uff09\u3002\n\u4ee5\u4e0b\u793a\u4f8b\u5f9e Dataproc \u96c6\u7fa3\u7684\u4e3b\u7bc0\u9ede\u904b\u884c\u4ee5 Python \u7de8\u5beb\u7684\u53ef\u79fb\u690d Beam \u4f5c\u696d\u3002\n**\u6ce8\u610f** \uff1a\u5c0d\u65bc Dataproc 1.5\u3001Flink 1.9 \u548c [\u517c\u5bb9\u7684 Beam \u7248\u672c](https://beam.apache.org/documentation/runners/flink/#flink-version-compatibility) \uff0c\u6b64\u793a\u4f8b\u53ef\u6210\u529f\u57f7\u884c\u3002\u4f46\u662f\uff0c\u5c0d\u65bc Dataproc 2.0\u3001Flink 1.12 \u548c Beam 2.30 \u53ca\u66f4\u9ad8\u7248\u672c\uff0c\u8acb\u53c3\u95b1\u6b64 JIRA \u554f\u984c [BEAM-10430](https://issues.apache.org/jira/browse/BEAM-10430) \u3002\n- \u5275\u5efa\u540c\u6642\u5553\u7528\u4e86 [Flink](https://cloud.google.com/dataproc/docs/concepts/components/flink?hl=zh-cn) \u548c [Docker](https://cloud.google.com/dataproc/docs/concepts/components/docker?hl=zh-cn) \u7d44\u4ef6\u7684 Dataproc \u96c6\u7fa3\u3002```\ngcloud dataproc clusters create CLUSTER_NAME \\\n --optional-components=FLINK,DOCKER \\\n --image-version=DATAPROC_IMAGE_VERSION \\\n --region=REGION \\\n --enable-component-gateway \\\n --scopes=https://www.googleapis.com/auth/cloud-platform\n```\u5099\u8a3b\uff1a- `--optional-components`\uff1aFlink \u548c Docker\u3002\n- `--image-version`\uff1a [\u96c6\u7fa3\u7684\u6620\u50cf\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn#supported_cloud_dataproc_versions) \uff0c\u7528\u65bc\u78ba\u5b9a\u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Flink \u7248\u672c\uff08\u4f8b\u5982\uff0c\u8acb\u53c3\u95b1\u91dd\u5c0d\u6700\u65b0\u548c\u4e4b\u524d\u7684\u56db\u500b [2.0.x \u6620\u50cf\u767c\u4f48\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-release-2.0?hl=zh-cn) \u5217\u51fa\u7684 Apache Flink \u7d44\u4ef6\u7248\u672c\uff09\u3002\n- `--region`\uff1a\u53ef\u7528\u7684 Dataproc [\u5340\u57df](https://cloud.google.com/dataproc/docs/concepts/regional-endpoints?hl=zh-cn#regional_endpoint_semantics) \u3002\n- `--enable-component-gateway`\uff1a\u5553\u7528\u5c0d Flink Job Manager \u754c\u9762\u7684\u8a2a\u554f\u6b0a\u9650\u3002\n- `--scopes`\uff1a\u5553\u7528\u96c6\u7fa3\u5c0d Google Cloud API \u7684\u8a2a\u554f\u6b0a\u9650\uff08\u8acb\u53c3\u95b1 [\u7bc4\u570d\u6700\u4f73\u505a\u6cd5](https://cloud.google.com/compute/docs/access/service-accounts?hl=zh-cn#scopes_best_practice) \uff09\u3002\u7576\u60a8\u5275\u5efa\u4f7f\u7528 Dataproc \u6620\u50cf 2.1 \u7248\u6216\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa3\u6642\uff0c\u7cfb\u7d71\u6703\u9ed8\u8a8d\u5553\u7528`cloud-platform`\u7bc4\u570d\uff08\u7121\u9700\u5305\u62ec\u6b64\u6a19\u8a8c\u8a2d\u7f6e\uff09\u3002\n- \u5728\u672c\u5730\u6216 [Cloud Shell](https://console.cloud.google.com/?cloudshell=true&hl=zh-cn) \u4e2d\u4f7f\u7528 `gsutil` \u4f86\u5275\u5efa Cloud Storage \u5b58\u5132\u6876\u3002\u5728\u904b\u884c\u793a\u4f8b Wordcount \u7a0b\u5e8f\u6642\uff0c\u60a8\u9700\u8981\u6307\u5b9a \u3002```\ngsutil mb BUCKET_NAME\n```\n- \u5728\u96c6\u7fa3\u865b\u64ec\u6a5f\u7684\u7d42\u7aef\u7a97\u53e3\u4e2d\uff0c\u5553\u52d5 Flink YARN \u6703\u8a71\u3002 \u6ce8\u610f Flink \u4e3b\u5be6\u4f8b\u7db2\u5740\uff0c\u5373\u57f7\u884c\u4f5c\u696d\u7684 Flink \u4e3b\u5be6\u4f8b\u7684\u5730\u5740\u3002\u5728\u904b\u884c\u793a\u4f8b Wordcount \u7a0b\u5e8f\u6642\uff0c\u60a8\u9700\u8981\u6307\u5b9a \u3002```\n. /usr/bin/flink-yarn-daemon\n```\u986f\u793a\u4e26 **\u8a18\u4e0b\u904b\u884c Dataproc \u96c6\u7fa3\u7684 Flink \u7248\u672c** \u3002\u5728\u904b\u884c\u793a\u4f8b Wordcount \u7a0b\u5e8f\u6642\uff0c\u60a8\u9700\u8981\u6307\u5b9a \u3002```\nflink --version\n```\n- \u5728\u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u5b89\u88dd\u4f5c\u696d\u6240\u9700\u7684 Python \u5eab\u3002\n- \u5b89\u88dd\u8207\u96c6\u7fa3\u4e0a\u7684 Flink \u7248\u672c\u517c\u5bb9\u7684 [Beam \u7248\u672c](https://beam.apache.org/documentation/runners/flink/#flink-version-compatibility) \u3002```\npython -m pip install apache-beam[gcp]==BEAM_VERSION\n```\n- \u5728\u96c6\u7fa3\u4e3b\u670d\u52d9\u5668\u7bc0\u9ede\u4e0a\u904b\u884c\u5b57\u6578\u7d71\u8a08\u793a\u4f8b\u3002```\npython -m apache_beam.examples.wordcount \\\n --runner=FlinkRunner \\\n --flink_version=FLINK_VERSION \\\n --flink_master=FLINK_MASTER_URL\n --flink_submit_uber_jar \\\n --output=gs://BUCKET_NAME/python-wordcount-out\n```\u5099\u8a3b\uff1a- `--runner`\uff1a`FlinkRunner`\u3002\n- `--flink_version`\uff1a\uff08\u5982\u524d\u6240\u8ff0\uff09\u3002\n- `--flink_master`\uff1a\uff08\u5982\u524d\u6240\u8ff0\uff09\u3002\n- `--flink_submit_uber_jar`\uff1a\u4f7f\u7528\u8d85\u7d1a JAR \u57f7\u884c Beam \u4f5c\u696d\u3002\n- `--output`\uff1a\u4e4b\u524d\u5275\u5efa\u7684\u3002\n- \u9a57\u8b49\u7d50\u679c\u662f\u5426\u5df2\u5beb\u5165\u60a8\u7684\u5b58\u5132\u6876\u3002```\ngsutil cat gs://BUCKET_NAME/python-wordcount-out-SHARD_ID\n```\n- \u505c\u6b62 Flink YARN \u6703\u8a71\u3002- \u7372\u53d6\u61c9\u7528 ID\u3002\n```\nyarn application -list\n1. Insert the <var>YARN_APPLICATION_ID</var>, then stop the session.\nyarn application -kill \n```## \u5728 Kerberos \u5316\u7684\u96c6\u7fa3\u4e0a\u904b\u884c Flink\nDataproc Flink \u7d44\u4ef6\u652f\u6301 [Kerberos \u5316\u7684\u96c6\u7fa3](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/security?hl=zh-cn) \u3002\u5982\u9700\u63d0\u4ea4\u548c\u4fdd\u7559 Flink \u4f5c\u696d\u6216\u5553\u52d5 Flink \u96c6\u7fa3\uff0c\u9700\u8981\u6709\u6548\u7684 Kerberos \u7968\u64da\u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cKerberos \u7968\u64da\u7684\u6709\u6548\u671f\u7232 7 \u5929\u3002\n## \u8a2a\u554f Flink Job Manager \u754c\u9762\n\u7576 Flink \u4f5c\u696d\u6216 Flink \u6703\u8a71\u96c6\u7fa3\u904b\u884c\u6642\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Flink Job Manager \u7db2\u9801\u754c\u9762\u3002\u5982\u9700\u4f7f\u7528\u7db2\u9801\u754c\u9762\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- [\u5275\u5efa Dataproc Flink \u96c6\u7fa3](#create_a_flink_cluster) \u3002\n- \u5275\u5efa\u96c6\u7fa3\u540e\uff0c\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 **\u96c6\u7fa3\u8a73\u60c5** \u9801\u9762\u4e0a\u9ede\u64ca\u7db2\u9801\u754c\u9762\u6a19\u7c64\u9801\u4e2d\u7684 **\u7d44\u4ef6\u7db2\u95dc** [YARN ResourceManager \u93c8\u63a5](https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways?hl=zh-cn#console_1) \u3002\n- \u5728 **YARN Resource Manager** \u754c\u9762\u4e2d\uff0c\u8b58\u5225 Flink \u96c6\u7fa3\u61c9\u7528\u689d\u76ee\u3002\u6839\u64da\u4f5c\u696d\u7684\u5b8c\u6210\u72c0\u614b\uff0c\u7cfb\u7d71\u5c07\u5217\u51fa **ApplicationMaster** \u6216 **\u6b77\u53f2\u8a18\u9304** \u93c8\u63a5\u3002\n- \u5c0d\u65bc\u9577\u6642\u9593\u904b\u884c\u7684\u6d41\u5f0f\u4f5c\u696d\uff0c\u8acb\u9ede\u64ca **ApplicationManager** \u93c8\u63a5\u4ee5\u6253\u958b Flink \u4fe1\u606f\u4e2d\u5fc3\uff1b\u5c0d\u65bc\u5df2\u5b8c\u6210\u7684\u4f5c\u696d\uff0c\u8acb\u9ede\u64ca **\u6b77\u53f2\u8a18\u9304** \u93c8\u63a5\u4ee5\u67e5\u770b\u4f5c\u696d\u8a73\u7d30\u4fe1\u606f\u3002", "guide": "Dataproc"}