{"title": "Dataproc - Recreate and update a Dataproc on GKE virtual cluster", "url": "https://cloud.google.com/dataproc/docs/guides/dpgke/dataproc-gke-recreate-cluster", "abstract": "# Dataproc - Recreate and update a Dataproc on GKE virtual cluster\nYou can copy an existing Dataproc on GKE virtual cluster's configuration, update the copied configuration, and then create a new Dataproc on GKE cluster using the updated configuration.\n", "content": "## Steps to recreate and update a Dataproc on GKE cluster\n1. Set environment variables:\n```\nCLUSTER=existing Dataproc on GKE cluster name \\\n\u00a0\u00a0REGION=region\n \n```\n- Export the existing Dataproc on GKE cluster configuration to a YAML file.```\ngcloud dataproc clusters export $CLUSTER \\\n\u00a0\u00a0\u00a0\u00a0--region=$REGION > \"${CLUSTER}-config.yaml\"\n```\n- Update the configuration.- Remove the [kubernetesNamespace](/dataproc/docs/reference/rest/v1/projects.regions.clusters#KubernetesClusterConfig.FIELDS.kubernetes_namespace) field. Removing this field is necessary to avoid a namespace conflict when you create the updated cluster.Sample `sed` command to remove the `kubernetesNamespace` field:```\nsed -E \"s/kubernetesNamespace: .+$//g\" ${CLUSTER}-config.yaml\n```\n- Make additional changes to update Dataproc on GKE virtual cluster configuration settings, such as changing the Spark [componentVersion](/dataproc/docs/reference/rest/v1/projects.regions.clusters#KubernetesSoftwareConfig.FIELDS.component_version) .\n- [Delete the existing Dataproc on GKE virtual cluster](/dataproc/docs/guides/dpgke/dataproc-gke-delete-cluster) if you will create a cluster that has the same name as the cluster it is updating (if you are replacing the original cluster).\n- Wait for the previous delete operation to finish, and then import the updated cluster configuration to create a new Dataproc on GKE virtual cluster with the updated config settings.```\ngcloud dataproc clusters import $CLUSTER \\\n\u00a0\u00a0\u00a0\u00a0--region=$REGION \\\n\u00a0\u00a0\u00a0\u00a0--source=\"${CLUSTER}-config.yaml\"\n```1. Set environment variables:\n```\nCLUSTER=existing Dataproc on GKE cluster name \\\n\u00a0\u00a0REGION=region\n \n```\n- Export the existing Dataproc on GKE cluster configuration to a YAML file.```\ncurl -X GET -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \"https://dataproc.googleapis.com/v1/projects/${PROJECT}/regions/${REGION}/clusters/${CLUSTER}?alt=json\" > \"${CLUSTER}-config.json\"\n```\n- Remove the [kubernetesNamespace](/dataproc/docs/reference/rest/v1/projects.regions.clusters#KubernetesClusterConfig.FIELDS.kubernetes_namespace) field. Removal of this field is necessary to avoid a namespace conflict when you create the updated cluster.Sample `jq` command to remove `kubernetesNamespace` field:```\njq 'del(.virtualClusterConfig.kubernetesClusterConfig.kubernetesNamespace)'\n \n```- Make additional changes to update Dataproc on GKE virtual cluster configuration settings, such as changing the Spark [componentVersion](/dataproc/docs/reference/rest/v1/projects.regions.clusters#KubernetesSoftwareConfig.FIELDS.component_version) .\n- Delete the existing Dataproc on GKE virtual cluster if you will create a cluster that has the same name as the cluster it is updating (if you are replacing the original cluster).```\ncurl -X DELETE -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \"https://dataproc.googleapis.com/v1/projects/${PROJECT}/regions/${REGION}/clusters/${CLUSTER}\"\n```\n- Wait for the previous delete operation to finish, and then import the updated cluster configuration to create a new Dataproc on GKE virtual cluster with the updated settings.```\ncurl -i -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" -H \"Content-Type: application/json; charset=utf-8\" -d \"@${CLUSTER}-config.json\" \"https://dataproc.googleapis.com/v1/projects/${PROJECT}/regions/${REGION}/clusters?alt=json\"\n```The Google Cloud console does not support recreating a Dataproc on GKE virtual cluster by importing an existing cluster's configuration.", "guide": "Dataproc"}