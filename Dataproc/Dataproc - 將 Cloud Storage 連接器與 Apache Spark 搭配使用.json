{"title": "Dataproc - \u5c07 Cloud Storage \u9023\u63a5\u5668\u8207 Apache Spark \u642d\u914d\u4f7f\u7528", "url": "https://cloud.google.com/dataproc/docs/tutorials/gcs-connector-spark-tutorial?hl=zh-cn", "abstract": "# Dataproc - \u5c07 Cloud Storage \u9023\u63a5\u5668\u8207 Apache Spark \u642d\u914d\u4f7f\u7528\n\u672c\u6559\u7a0b\u4ecb\u7d39\u77ad\u5982\u4f55\u57f7\u884c\u5c07\n [Cloud Storage \u9023\u63a5\u5668](https://cloud.google.com/dataproc/docs/concepts/connectors/cloud-storage?hl=zh-cn#clusters) \n\u8207\n [Apache Spark](https://spark.apache.org) \n\u642d\u914d\u4f7f\u7528\u7684\u793a\u4f8b\u4ee3\u78bc\u3002\n", "content": "## \u76ee\u6a19\u4f7f\u7528 Java\u3001Scala \u6216 Python \u7de8\u5beb\u7c21\u55ae\u7684 wordcount Spark \u4f5c\u696d\uff0c\u7136\u5f8c\u5728 Dataproc \u96c6\u7fa3\u4e0a\u904b\u884c\u8a72\u4f5c\u696d\u3002\nDataproc \u96c6\u7fa3\u9810\u88dd\u4e86\u672c\u6559\u7a0b\u6240\u9700\u7684 Spark \u7d44\u4ef6\u7684\u3002\n## \u8cbb\u7528\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Google Cloud \u7684\u4ee5\u4e0b\u6536\u8cbb\u7d44\u4ef6\uff1a- Compute Engine\n- Dataproc\n- Cloud Storage\n\u60a8\u53ef\u4f7f\u7528 [\u50f9\u683c\u8a08\u7b97\u5668](https://cloud.google.com/products/calculator?hl=zh-cn) \u6839\u64da\u60a8\u7684\u9810\u8a08\u4f7f\u7528\u60c5\u6cc1\u4f86\u4f30\u7b97\u8cbb\u7528\u3002 \n## \u6e96\u5099\u5de5\u4f5c\u904b\u884c\u4ee5\u4e0b\u6b65\u9a5f\u7232\u904b\u884c\u672c\u6559\u7a0b\u4e2d\u7684\u4ee3\u78bc\u505a\u6e96\u5099\u3002- **\u8a2d\u7f6e\u9805\u76ee** \u3002\u5982\u6709\u5fc5\u8981\uff0c\u8acb\u8a2d\u7f6e\u4e00\u500b\u5553\u7528\u4e86 Dataproc\u3001Compute Engine \u548c Cloud Storage API \u4e26\u5728\u672c\u5730\u6a5f\u5668\u4e0a\u5b89\u88dd\u4e86 Google Cloud CLI \u7684\u9805\u76ee\u3002   - Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them- **\u5275\u5efa Cloud Storage \u5b58\u5132\u5206\u5340\u3002** \u60a8\u9700\u8981\u4f7f\u7528 Cloud Storage \u4f86\u4fdd\u5b58\u6559\u7a0b\u6578\u64da\u3002\u5982\u679c\u60a8\u6c92\u6709\u53ef\u7528\u7684 Cloud Storage \u5b58\u5132\u5206\u5340\uff0c\u8acb\u5728\u9805\u76ee\u4e2d\u5275\u5efa\u65b0\u5b58\u5132\u5206\u5340\u3002 - Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u9032\u5165 Cloud Storage **\u5b58\u5132\u6876** \u9801\u9762\u3002 [\u9032\u5165\u201c\u5b58\u5132\u6876\u201d\u9801\u9762](https://console.cloud.google.com/storage/browser?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa\u5b58\u5132\u5206\u5340** \u3002\n- \u5728 **\u5275\u5efa\u5b58\u5132\u5206\u5340** \u9801\u9762\u4e0a\uff0c\u8f38\u5165\u60a8\u7684\u5b58\u5132\u5206\u5340\u4fe1\u606f\u3002\u8981\u8f49\u5230\u4e0b\u4e00\u6b65\uff0c\u8acb\u9ede\u64ca **\u7e7c\u7e8c** \u3002- \u5728 **\u6307\u5b9a\u5b58\u5132\u5206\u5340\u7684\u540d\u7a31** \u4e2d\uff0c\u8f38\u5165\u7b26\u5408 [\u5b58\u5132\u5206\u5340\u547d\u540d\u8981\u6c42](https://cloud.google.com/storage/docs/bucket-naming?hl=zh-cn#requirements) \u7684\u540d\u7a31\u3002\n- \u5c0d\u65bc **\u9078\u64c7\u6578\u64da\u5b58\u5132\u4f4d\u7f6e** \uff0c\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u9078\u64c7 **\u4f4d\u7f6e\u985e\u578b** \u9078\u9805\u3002\n- \u9078\u64c7 **\u4f4d\u7f6e** \u9078\u9805\u3002\n- \u5c0d\u65bc **\u7232\u6578\u64da\u9078\u64c7\u4e00\u500b\u9ed8\u8a8d\u5b58\u5132\u985e\u5225** \uff0c\u8acb\u9078\u64c7\u4e00\u500b [\u5b58\u5132\u985e\u5225](https://cloud.google.com/storage/docs/storage-classes?hl=zh-cn) \u3002\n- \u5c0d\u65bc **\u9078\u64c7\u5982\u4f55\u63a7\u5236\u5c0d\u8c61\u7684\u8a2a\u554f\u6b0a\u9650** \uff0c\u8acb\u9078\u64c7 **\u8a2a\u554f\u6b0a\u9650\u63a7\u5236** \u9078\u9805\u3002\n- \u5c0d\u65bc **\u9ad8\u7d1a\u8a2d\u7f6e\uff08\u53ef\u9078\uff09** \uff0c\u8acb\u6307\u5b9a [\u52a0\u5bc6\u65b9\u6cd5](https://cloud.google.com/storage/docs/encryption?hl=zh-cn) \u3001 [\u4fdd\u7559\u653f\u7b56](https://cloud.google.com/storage/docs/bucket-lock?hl=zh-cn) \u6216 [\u5b58\u5132\u5206\u5340\u6a19\u7c64](https://cloud.google.com/storage/docs/tags-and-labels?hl=zh-cn#bucket-labels) \u3002\n- \u9ede\u64ca **\u5275\u5efa** \u3002- **\u8a2d\u7f6e\u672c\u5730\u74b0\u5883\u8b8a\u91cf** \u3002\u5728\u672c\u5730\u6a5f\u5668\u4e0a\u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\u3002\u8a2d\u7f6e Google Cloud \u9805\u76ee ID \u4ee5\u53ca\u60a8\u5c07\u5728\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684 Cloud Storage \u5b58\u5132\u5206\u5340\u7684\u540d\u7a31\u3002\u6b64\u5916\uff0c\u9084\u8981\u63d0\u4f9b\u73fe\u6709\u6216\u65b0 Dataproc \u96c6\u7fa3\u7684\u540d\u7a31\u548c [\u5340\u57df](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn#available) \u3002\u60a8\u53ef\u4ee5\u5728\u4e0b\u4e00\u6b65\u4e2d\u5275\u5efa\u8981\u7528\u65bc\u672c\u6559\u7a0b\u7684\u96c6\u7fa3\u3002```\nPROJECT=project-id\n``````\nBUCKET_NAME=bucket-name\n``````\nCLUSTER=cluster-name\n``````\nREGION=cluster-region Example: \"us-central1\"\n```\n- **\u5275\u5efa Dataproc \u96c6\u7fa3** \u3002\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5728\u6307\u5b9a\u7684 [Compute Engine \u5730\u5340](https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn) \u4e2d\u5275\u5efa [\u55ae\u7bc0\u9ede](https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/single-node-clusters?hl=zh-cn) Dataproc \u96c6\u7fa3\u3002```\ngcloud dataproc clusters create ${CLUSTER} \\\n\u00a0\u00a0\u00a0\u00a0--project=${PROJECT} \\\n\u00a0\u00a0\u00a0\u00a0--region=${REGION} \\\n\u00a0\u00a0\u00a0\u00a0--single-node\n```\u4ee5\u4e0a\u547d\u4ee4\u7528\u65bc\u5b89\u88dd\u9ed8\u8a8d\u7684 [\u96c6\u7fa3\u6620\u50cf\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn#supported_cloud_dataproc_versions) \u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 [--image-version](https://cloud.google.com/sdk/gcloud/reference/dataproc/clusters/create?hl=zh-cn#--image) \u6a19\u8a8c\u7232\u96c6\u7fa3\u9078\u64c7\u6620\u50cf\u7248\u672c\u3002\u6bcf\u500b\u6620\u50cf\u7248\u672c\u90fd\u6703\u5b89\u88dd\u7279\u5b9a\u7248\u672c\u7684 Spark \u548c Scala \u5eab\u7d44\u4ef6\u3002\u5982\u679c\u60a8 [\u6e96\u5099 Java \u6216 Scala \u4e2d\u7684 Spark wordcount \u4f5c\u696d](#prepare_the_spark_wordcount_job) \uff0c\u5247\u5728\u6e96\u5099\u4f5c\u696d\u8edf\u4ef6\u5305\u6642\u5c07\u5f15\u7528\u96c6\u7fa3\u4e0a\u5b89\u88dd\u7684 Spark \u548c Scala \u7248\u672c\u3002\n- **\u5c07\u516c\u5171\u6578\u64da\u8907\u88fd\u5230 Cloud Storage \u5b58\u5132\u5206\u5340\u3002** \u5c07\u516c\u5171\u6578\u64da\u201c\u838e\u58eb\u6bd4\u4e9e\u201d\u6587\u672c\u7247\u6bb5\u8907\u88fd\u5230 Cloud Storage \u5b58\u5132\u5206\u5340\u7684 `input` \u6587\u4ef6\u593e\u4e2d\uff1a```\ngsutil cp gs://pub/shakespeare/rose.txt \\\n\u00a0\u00a0\u00a0\u00a0gs://${BUCKET_NAME}/input/rose.txt\n```\n- **\u8a2d\u7f6e Java (Apache Maven)\u3001Scala (SBT) \u6216 Python \u958b\u767c\u74b0\u5883\u3002** **\u4f7f\u7528 Cloud Shell** \u3002 [Cloud Shell](https://cloud.google.com/shell/docs/features?hl=zh-cn#tools) \u5305\u62ec\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u5de5\u5177\uff0c\u5305\u62ec Apache Maven\u3001Python \u4ee5\u53ca`gcloud`\u548c`gsutil`Google Cloud CLI \u547d\u4ee4\u884c\u5de5\u5177\u3002\n## \u6e96\u5099 Spark wordcount \u4f5c\u696d\u5728\u4e0b\u9762\u9078\u64c7\u4e00\u500b\u6a19\u7c64\u9801\uff0c\u6309\u7167\u6b65\u9a5f\u6e96\u5099\u4f5c\u696d\u8edf\u4ef6\u5305\u6216\u6587\u4ef6\u4ee5\u63d0\u4ea4\u5230\u96c6\u7fa3\u3002\u60a8\u53ef\u4ee5\u6e96\u5099\u4ee5\u4e0b\u4f5c\u696d\u985e\u578b\u4e4b\u4e00\uff1a- **Java \u4e2d\u7684 Spark \u4f5c\u696d** \u4f7f\u7528 [Apache Maven](https://maven.apache.org/) \u5275\u5efa\u4e00\u500b [JAR](https://en.wikipedia.org/wiki/JAR) \u8edf\u4ef6\u5305\n- **Scala \u4e2d\u7684 Spark \u4f5c\u696d** \u4f7f\u7528 [SBT](https://www.scala-sbt.org/) \u5275\u5efa\u4e00\u500b [JAR](https://en.wikipedia.org/wiki/JAR) \u8edf\u4ef6\u5305\n- **Python (PySpark) \u4e2d\u7684 Spark \u4f5c\u696d** \n- **\u5c07 pom.xml \u6587\u4ef6\u8907\u88fd\u5230\u672c\u5730\u6a5f\u5668** \u3002  \u4ee5\u4e0b`pom.xml`\u6587\u4ef6\u6307\u5b9a Scala \u548c Spark \u5eab\u4f9d\u8cf4\u9805\uff0c\u5b83\u5011\u5177\u6709`provided`\u7bc4\u570d\uff0c\u6307\u793a Dataproc \u96c6\u7fa3\u5c07\u5728\u904b\u884c\u6642\u63d0\u4f9b\u9019\u4e9b\u5eab\u3002`pom.xml`\u6587\u4ef6\u672a\u6307\u5b9a Cloud Storage \u4f9d\u8cf4\u9805\uff0c\u56e0\u7232\u9023\u63a5\u5668\u5be6\u73fe\u4e86\u6a19\u6e96 HDFS \u63a5\u53e3\u3002\u7576 Spark \u4f5c\u696d\u8a2a\u554f Cloud Storage \u96c6\u7fa3\u6587\u4ef6\u6642\uff08URI \u958b\u982d\u7232`gs://`\u7684\u6587\u4ef6\uff09\uff0c\u7cfb\u7d71\u6703\u81ea\u52d5\u4f7f\u7528 Cloud Storage \u9023\u63a5\u5668\u8a2a\u554f Cloud Storage \u4e2d\u7684\u6587\u4ef6 **\u6aa2\u67e5\u60a8\u7684\u96c6\u7fa3\u6620\u50cf\u7248\u672c** \u3002\u66ff\u63db\u6587\u4ef6\u4e2d\u7684\u4f54\u4f4d\u7b26\uff0c\u4ee5\u986f\u793a\u96c6\u7fa3\u7684 [\u6620\u50cf\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn) \u4f7f\u7528\u7684 Spark \u548c Scala \u5eab\u7248\u672c\u3002\u8acb\u6ce8\u610f\uff0c`spark-core_`\u5de5\u4ef6\u6578\u662f Scala`major.minor`\u7248\u672c\u865f\u3002```\n<?xml version=\"1.0\" encoding=\"UTF-8\"?><project xmlns=\"http://maven.apache.org/POM/4.0.0\"\u00a0 \u00a0 xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\u00a0 \u00a0 xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\u00a0 <modelVersion>4.0.0</modelVersion>\u00a0 <groupId>dataproc.codelab</groupId>\u00a0 <artifactId>word-count</artifactId>\u00a0 <version>1.0</version>\u00a0 <properties>\u00a0 \u00a0 <maven.compiler.source>1.8</maven.compiler.source>\u00a0 \u00a0 <maven.compiler.target>1.8</maven.compiler.target>\u00a0 </properties>\u00a0 <dependencies>\u00a0 \u00a0 <dependency>\u00a0 \u00a0 \u00a0 <groupId>org.scala-lang</groupId>\u00a0 \u00a0 \u00a0 <artifactId>scala-library</artifactId>\u00a0 \u00a0 \u00a0 <version>Scala version, for example, 2.11.8</version>\u00a0 \u00a0 \u00a0 <scope>provided</scope>\u00a0 \u00a0 </dependency>\u00a0 \u00a0 <dependency>\u00a0 \u00a0 \u00a0 <groupId>org.apache.spark</groupId>\u00a0 \u00a0 \u00a0 <artifactId>spark-core_Scala major.minor.version, for example, 2.11</artifactId>\u00a0 \u00a0 \u00a0 <version>Spark version, for example, 2.3.1</version>\u00a0 \u00a0 \u00a0 <scope>provided</scope>\u00a0 \u00a0 </dependency>\u00a0 </dependencies></project>\n```\n- **\u5c07\u4e0b\u9762\u5217\u51fa\u7684 WordCount.java \u4ee3\u78bc\u8907\u88fd\u5230\u60a8\u7684\u672c\u5730\u6a5f\u5668** \u3002\n- \u5275\u5efa\u4e00\u7d44\u8def\u5f91\u7232`src/main/java/dataproc/codelab`\u7684\u76ee\u9304\uff1a```\nmkdir -p src/main/java/dataproc/codelab\n```\n- \u5c07`WordCount.java`\u8907\u88fd\u5230\u60a8\u7684\u672c\u5730\u6a5f\u5668\u7684`src/main/java/dataproc/codelab`\uff1a```\ncp WordCount.java src/main/java/dataproc/codelab\n```\nWordCount.java \u662f Java \u4e2d\u4e00\u500b\u7c21\u55ae\u7684 Spark \u4f5c\u696d\uff0c\u53ef\u5f9e Cloud Storage \u8b80\u53d6\u6587\u672c\u6587\u4ef6\u3001\u57f7\u884c\u5b57\u6578\u7d71\u8a08\uff0c\u7136\u5f8c\u5c07\u6587\u672c\u6587\u4ef6\u7d50\u679c\u5beb\u5165 Cloud Storage\u3002```\npackage dataproc.codelab;import java.util.Arrays;import org.apache.spark.SparkConf;import org.apache.spark.api.java.JavaPairRDD;import org.apache.spark.api.java.JavaRDD;import org.apache.spark.api.java.JavaSparkContext;import scala.Tuple2;public class WordCount {\u00a0 public static void main(String[] args) {\u00a0 \u00a0 if (args.length != 2) {\u00a0 \u00a0 \u00a0 throw new IllegalArgumentException(\"Exactly 2 arguments are required: <inputUri> <outputUri>\");\u00a0 \u00a0 }\u00a0 \u00a0 String inputPath = args[0];\u00a0 \u00a0 String outputPath = args[1];\u00a0 \u00a0 JavaSparkContext sparkContext = new JavaSparkContext(new SparkConf().setAppName(\"Word Count\"));\u00a0 \u00a0 JavaRDD<String> lines = sparkContext.textFile(inputPath);\u00a0 \u00a0 JavaRDD<String> words = lines.flatMap(\u00a0 \u00a0 \u00a0 \u00a0 (String line) -> Arrays.asList(line.split(\" \")).iterator()\u00a0 \u00a0 );\u00a0 \u00a0 JavaPairRDD<String, Integer> wordCounts = words.mapToPair(\u00a0 \u00a0 \u00a0 \u00a0 (String word) -> new Tuple2<>(word, 1)\u00a0 \u00a0 ).reduceByKey(\u00a0 \u00a0 \u00a0 \u00a0 (Integer count1, Integer count2) -> count1 + count2\u00a0 \u00a0 );\u00a0 \u00a0 wordCounts.saveAsTextFile(outputPath);\u00a0 }}\n```\n- **\u69cb\u5efa\u8edf\u4ef6\u5305** \u3002```\nmvn clean package\n```\u5982\u679c\u69cb\u5efa\u6210\u529f\uff0c\u5247\u7cfb\u7d71\u6703\u5275\u5efa\u4e00\u500b`target/spark-with-gcs-1.0-SNAPSHOT.jar`\u3002\n- **\u5c07\u8edf\u4ef6\u5305\u66ab\u5b58\u5230 Cloud Storage** \u3002```\ngsutil cp target/word-count-1.0.jar \\\n\u00a0\u00a0\u00a0\u00a0gs://${BUCKET_NAME}/java/word-count-1.0.jar\n```\n- **\u5c07 build.sbt \u6587\u4ef6\u8907\u88fd\u5230\u672c\u5730\u6a5f\u5668** \u3002  \u4ee5\u4e0b`build.sbt`\u6587\u4ef6\u6307\u5b9a Scala \u548c Spark \u5eab\u4f9d\u8cf4\u9805\uff0c\u5b83\u5011\u5177\u6709`provided`\u7bc4\u570d\uff0c\u6307\u793a Dataproc \u96c6\u7fa3\u5c07\u5728\u904b\u884c\u6642\u63d0\u4f9b\u9019\u4e9b\u5eab\u3002`build.sbt`\u6587\u4ef6\u672a\u6307\u5b9a Cloud Storage \u4f9d\u8cf4\u9805\uff0c\u56e0\u7232\u9023\u63a5\u5668\u5be6\u73fe\u4e86\u6a19\u6e96 HDFS \u63a5\u53e3\u3002\u7576 Spark \u4f5c\u696d\u8a2a\u554f Cloud Storage \u96c6\u7fa3\u6587\u4ef6\u6642\uff08URI \u958b\u982d\u7232`gs://`\u7684\u6587\u4ef6\uff09\uff0c\u7cfb\u7d71\u6703\u81ea\u52d5\u4f7f\u7528 Cloud Storage \u9023\u63a5\u5668\u8a2a\u554f Cloud Storage \u4e2d\u7684\u6587\u4ef6 **\u6aa2\u67e5\u60a8\u7684\u96c6\u7fa3\u6620\u50cf\u7248\u672c** \u3002\u66ff\u63db\u6587\u4ef6\u4e2d\u7684\u4f54\u4f4d\u7b26\uff0c\u4ee5\u986f\u793a\u96c6\u7fa3\u7684 [\u6620\u50cf\u7248\u672c](https://cloud.google.com/dataproc/docs/concepts/versioning/dataproc-versions?hl=zh-cn) \u4f7f\u7528\u7684 Spark \u548c Scala \u5eab\u7248\u672c\u3002```\nscalaVersion := \"Scala version, for example, 2.11.8\"name := \"word-count\"organization := \"dataproc.codelab\"version := \"1.0\"libraryDependencies ++= Seq(\u00a0 \"org.scala-lang\" % \"scala-library\" % scalaVersion.value % \"provided\",\u00a0 \"org.apache.spark\" %% \"spark-core\" % \"Spark version, for example, 2.3.1\" % \"provided\")\n```\n- **\u5c07 word-count.scala \u8907\u88fd\u5230\u672c\u5730\u6a5f\u5668** \u3002  \u9019\u662f Java \u4e2d\u4e00\u500b\u7c21\u55ae\u7684 Spark \u4f5c\u696d\uff0c\u53ef\u5f9e Cloud Storage \u8b80\u53d6\u6587\u672c\u6587\u4ef6\u3001\u57f7\u884c\u5b57\u6578\u7d71\u8a08\uff0c\u7136\u5f8c\u5c07\u6587\u672c\u6587\u4ef6\u7d50\u679c\u5beb\u5165 Cloud Storage\u3002```\npackage dataproc.codelabimport org.apache.spark.SparkContextimport org.apache.spark.SparkConfobject WordCount {\u00a0 def main(args: Array[String]) {\u00a0 \u00a0 if (args.length != 2) {\u00a0 \u00a0 \u00a0 throw new IllegalArgumentException(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Exactly 2 arguments are required: <inputPath> <outputPath>\")\u00a0 \u00a0 }\u00a0 \u00a0 val inputPath = args(0)\u00a0 \u00a0 val outputPath = args(1)\u00a0 \u00a0 val sc = new SparkContext(new SparkConf().setAppName(\"Word Count\"))\u00a0 \u00a0 val lines = sc.textFile(inputPath)\u00a0 \u00a0 val words = lines.flatMap(line => line.split(\" \"))\u00a0 \u00a0 val wordCounts = words.map(word => (word, 1)).reduceByKey(_ + _)\u00a0 \u00a0 wordCounts.saveAsTextFile(outputPath)\u00a0 }}\n```\n- **\u69cb\u5efa\u8edf\u4ef6\u5305** \u3002```\nsbt clean package\n```\u5982\u679c\u69cb\u5efa\u6210\u529f\uff0c\u5247\u7cfb\u7d71\u6703\u5275\u5efa\u4e00\u500b`target/scala-2.11/word-count_2.11-1.0.jar`\u3002\n- **\u5c07\u8edf\u4ef6\u5305\u66ab\u5b58\u5230 Cloud Storage** \u3002```\ngsutil cp target/scala-2.11/word-count_2.11-1.0.jar \\\n\u00a0\u00a0\u00a0\u00a0gs://${BUCKET_NAME}/scala/word-count_2.11-1.0.jar\n```\n- **\u5c07 word-count.py \u8907\u88fd\u5230\u672c\u5730\u6a5f\u5668** \u3002  \u9019\u662f Python \u4e2d\u4e00\u500b\u7c21\u55ae\u7684\u4f7f\u7528 PySpark \u7684 Spark \u4f5c\u696d\uff0c\u53ef\u5f9e Cloud Storage \u8b80\u53d6\u6587\u672c\u6587\u4ef6\u3001\u57f7\u884c\u5b57\u6578\u7d71\u8a08\uff0c\u7136\u5f8c\u5c07\u6587\u672c\u6587\u4ef6\u7d50\u679c\u5beb\u5165 Cloud Storage\u3002```\n#!/usr/bin/env pythonimport pysparkimport sysif len(sys.argv) != 3:\u00a0 raise Exception(\"Exactly 2 arguments are required: <inputUri> <outputUri>\")inputUri=sys.argv[1]outputUri=sys.argv[2]sc = pyspark.SparkContext()lines = sc.textFile(sys.argv[1])words = lines.flatMap(lambda line: line.split())wordCounts = words.map(lambda word: (word, 1)).reduceByKey(lambda count1, count2: count1 + count2)wordCounts.saveAsTextFile(sys.argv[2])\n```## \u63d0\u4ea4\u4f5c\u696d\u904b\u884c\u4ee5\u4e0b `gcloud` \u547d\u4ee4\uff0c\u5c07 Wordcount \u4f5c\u696d\u63d0\u4ea4\u5230 Dataproc \u96c6\u7fa3\u3002```\ngcloud dataproc jobs submit spark \\\n\u00a0\u00a0\u00a0\u00a0--cluster=${CLUSTER} \\\n\u00a0\u00a0\u00a0\u00a0--class=dataproc.codelab.WordCount \\\n\u00a0\u00a0\u00a0\u00a0--jars=gs://${BUCKET_NAME}/java/word-count-1.0.jar \\\n\u00a0\u00a0\u00a0\u00a0--region=${REGION} \\\n\u00a0\u00a0\u00a0\u00a0-- gs://${BUCKET_NAME}/input/ gs://${BUCKET_NAME}/output/\n``````\ngcloud dataproc jobs submit spark \\\n\u00a0\u00a0\u00a0\u00a0--cluster=${CLUSTER} \\\n\u00a0\u00a0\u00a0\u00a0--class=dataproc.codelab.WordCount \\\n\u00a0\u00a0\u00a0\u00a0--jars=gs://${BUCKET_NAME}/scala/word-count_2.11-1.0.jar \\\n\u00a0\u00a0\u00a0\u00a0--region=${REGION} \\\n\u00a0\u00a0\u00a0\u00a0-- gs://${BUCKET_NAME}/input/ gs://${BUCKET_NAME}/output/\n``````\ngcloud dataproc jobs submit pyspark word-count.py \\\n\u00a0\u00a0\u00a0\u00a0--cluster=${CLUSTER} \\\n\u00a0\u00a0\u00a0\u00a0--region=${REGION} \\\n\u00a0\u00a0\u00a0\u00a0-- gs://${BUCKET_NAME}/input/ gs://${BUCKET_NAME}/output/\n```\n## \u67e5\u770b\u8f38\u51fa\u4f5c\u696d\u5b8c\u6210\u5f8c\uff0c\u904b\u884c\u4ee5\u4e0b `gcloud` CLI `gsutil` \u547d\u4ee4\u4ee5\u67e5\u770b\u55ae\u8a5e\u6578\u8f38\u51fa\u3002\n```\ngsutil cat gs://${BUCKET_NAME}/output/*\n```\n\u5b57\u6578\u7d71\u8a08\u8f38\u51fa\u61c9\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\n(a,2)\n(call,1)\n(What's,1)\n(sweet.,1)\n(we,1)\n(as,1)\n(name?,1)\n(any,1)\n(other,1)\n(rose,1)\n(smell,1)\n(name,1)\n(would,1)\n(in,1)\n(which,1)\n(That,1)\n(By,1)\n```\n## \u6e05\u9664\u6578\u64da\n\u5b8c\u6210\u672c\u6559\u7a0b\u5f8c\uff0c\u60a8\u53ef\u4ee5\u6e05\u7406\u60a8\u5275\u5efa\u7684\u8cc7\u6e90\uff0c\u8b93\u5b83\u5011\u505c\u6b62\u4f7f\u7528\u914d\u984d\uff0c\u4ee5\u514d\u7522\u751f\u8cbb\u7528\u3002\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u5982\u4f55\u522a\u9664\u6216\u95dc\u9589\u9019\u4e9b\u8cc7\u6e90\u3002\n### \u522a\u9664\u9805\u76ee\n\u7232\u4e86\u907f\u514d\u7522\u751f\u8cbb\u7528\uff0c\u6700\u7c21\u55ae\u7684\u65b9\u6cd5\u662f\u522a\u9664\u60a8\u7232\u672c\u6559\u7a0b\u5275\u5efa\u7684\u9805\u76ee\u3002\n\u8981\u522a\u9664\u9805\u76ee\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- **\u8b66\u544a** \uff1a\u522a\u9664\u9805\u76ee\u6703\u7522\u751f\u4ee5\u4e0b\u5f71\u97ff- **\u9805\u76ee\u4e2d\u7684\u6240\u6709\u5167\u5bb9\u90fd\u6703\u88ab\u522a\u9664\u3002** \u5982\u679c\u60a8\u5c07\u73fe\u6709\u9805\u76ee\u7528\u65bc\u672c\u6587\u6a94\u4e2d\u7684\u4efb\u52d9\uff0c\u5247\u522a\u9664\u8a72\u9805\u76ee\u5f8c\uff0c\u9084\u5c07\u522a\u9664\u60a8\u5df2\u5728\u8a72\u9805\u76ee\u4e2d\u5b8c\u6210\u7684\u4efb\u4f55\u5176\u4ed6\u5de5\u4f5c\u3002\n- **\u81ea\u5b9a\u7fa9\u9805\u76ee ID \u4e1f\u5931\u3002** \u5275\u5efa\u6b64\u9805\u76ee\u6642\uff0c\u60a8\u53ef\u80fd\u5275\u5efa\u4e86\u8981\u5728\u5c07\u4f86\u4f7f\u7528\u7684\u81ea\u5b9a\u7fa9\u9805\u76ee ID\u3002\u8981\u4fdd\u7559\u4f7f\u7528\u8a72\u9805\u76ee ID \u7684\u7db2\u5740\uff08\u4f8b\u5982`appspot.com`\u7db2\u5740\uff09\uff0c\u8acb\u522a\u9664\u9805\u76ee\u5167\u7684\u6240\u9078\u8cc7\u6e90\uff0c\u800c\u4e0d\u662f\u522a\u9664\u6574\u500b\u9805\u76ee\u3002\n\u5982\u679c\u60a8\u6253\u7b97\u63a2\u7d22\u591a\u500b\u67b6\u69cb\u3001\u6559\u7a0b\u6216\u5feb\u901f\u5165\u9580\uff0c\u5247\u91cd\u8907\u4f7f\u7528\u9805\u76ee\u53ef\u4ee5\u5e6b\u52a9\u60a8\u907f\u514d\u8d85\u51fa\u9805\u76ee\u914d\u984d\u9650\u5236\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u9032\u5165 **\u7ba1\u7406\u8cc7\u6e90** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u7ba1\u7406\u8cc7\u6e90\u201d](https://console.cloud.google.com/iam-admin/projects?hl=zh-cn) \n- \u5728\u9805\u76ee\u5217\u8868\u4e2d\uff0c\u9078\u64c7\u8981\u522a\u9664\u7684\u9805\u76ee\uff0c\u7136\u5f8c\u9ede\u64ca **\u522a\u9664** \u3002\n- \u5728\u5c0d\u8a71\u6846\u4e2d\u8f38\u5165\u9805\u76ee ID\uff0c\u7136\u5f8c\u9ede\u64ca **\u95dc\u9589** \u4ee5\u522a\u9664\u9805\u76ee\u3002\n### \u522a\u9664 Dataproc \u96c6\u7fa3\u60a8\u53ef\u80fd\u5e0c\u671b\u53ea [\u522a\u9664\u9805\u76ee\u4e2d\u7684\u96c6\u7fa3](https://cloud.google.com/dataproc/docs/guides/manage-cluster?hl=zh-cn#deleting_a_cluster) \uff0c\u800c\u4e0d\u662f\u9805\u76ee\u3002\n### \u522a\u9664 Cloud Storage \u5b58\u5132\u5206\u5340\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 Cloud Storage **\u5b58\u5132\u5206\u5340** \u9801\u9762\u3002 [\u9032\u5165\u201c\u5b58\u5132\u6876\u201d](https://console.cloud.google.com/storage/browser?hl=zh-cn) \n- \u9ede\u64ca\u8981\u522a\u9664\u7684\u5b58\u5132\u6876\u5c0d\u61c9\u7684\u8907\u9078\u6846\u3002\n- \u5982\u9700\u522a\u9664\u5b58\u5132\u6876\uff0c\u8acb\u9ede\u64cadelete **\u522a\u9664** \uff0c\u7136\u5f8c\u6309\u7167\u8aaa\u660e\u64cd\u4f5c\u3002\n- \u522a\u9664\u5b58\u5132\u6876\uff1a\n- ```\ngcloud storage buckets delete BUCKET_NAME\n```\n- **\u91cd\u8981\u63d0\u793a** \uff1a\u5fc5\u9808\u5148\u6e05\u7a7a\u5b58\u5132\u6876\uff0c\u7136\u5f8c\u624d\u80fd\u5c07\u5176\u522a\u9664\u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u8acb\u53c3\u95b1 [Spark \u4f5c\u696d\u5fae\u8abf\u63d0\u793a](https://cloud.google.com/dataproc/docs/support/spark-job-tuning?hl=zh-cn)", "guide": "Dataproc"}