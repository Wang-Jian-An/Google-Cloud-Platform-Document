{"title": "Dataproc - \u91cd\u65b0\u5275\u5efa\u548c\u66f4\u65b0 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3", "url": "https://cloud.google.com/dataproc/docs/guides/dpgke/dataproc-gke-recreate-cluster?hl=zh-cn", "abstract": "# Dataproc - \u91cd\u65b0\u5275\u5efa\u548c\u66f4\u65b0 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\n\u60a8\u53ef\u4ee5\u8907\u88fd\u73fe\u6709 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u7684\u914d\u7f6e\uff0c\u66f4\u65b0\u8907\u88fd\u7684\u914d\u7f6e\uff0c\u7136\u5f8c\u4f7f\u7528\u66f4\u65b0\u5f8c\u7684\u914d\u7f6e\u5275\u5efa\u65b0\u7684 Dataproc on GKE \u96c6\u7fa3\u3002\n", "content": "## \u91cd\u65b0\u5275\u5efa\u548c\u66f4\u65b0 Dataproc on GKE \u96c6\u7fa3\u7684\u6b65\u9a5f\n1. \u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\uff1a\n```\nCLUSTER=existing Dataproc on GKE cluster name \\\n\u00a0\u00a0REGION=region\n \n```\n- \u5c07\u73fe\u6709\u7684 Dataproc on GKE \u96c6\u7fa3\u914d\u7f6e\u5c0e\u51fa\u5230 YAML \u6587\u4ef6\u3002```\ngcloud dataproc clusters export $CLUSTER \\\n\u00a0\u00a0\u00a0\u00a0--region=$REGION > \"${CLUSTER}-config.yaml\"\n```\n- \u66f4\u65b0\u914d\u7f6e\u3002- \u79fb\u9664 [kubernetesNamespace](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters?hl=zh-cn#KubernetesClusterConfig.FIELDS.kubernetes_namespace) \u5b57\u6bb5\u3002\u5fc5\u9808\u79fb\u9664\u6b64\u5b57\u6bb5\uff0c\u4ee5\u514d\u5728\u5275\u5efa\u66f4\u65b0\u5f8c\u7684\u96c6\u7fa3\u6642\u767c\u751f\u547d\u540d\u7a7a\u9593\u885d\u7a81\u3002\u79fb\u9664 `kubernetesNamespace` \u5b57\u6bb5\u7684\u793a\u4f8b `sed` \u547d\u4ee4\uff1a```\nsed -E \"s/kubernetesNamespace: .+$//g\" ${CLUSTER}-config.yaml\n```\n- \u9032\u884c\u5176\u4ed6\u66f4\u6539\u4ee5\u66f4\u65b0 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u914d\u7f6e\u8a2d\u7f6e\uff0c\u4f8b\u5982\u66f4\u6539 Spark [componentVersion](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters?hl=zh-cn#KubernetesSoftwareConfig.FIELDS.component_version) \u3002\n- \u5982\u679c\u60a8\u8981\u5275\u5efa\u7684\u96c6\u7fa3\u8207\u5176\u66f4\u65b0\u7684\u96c6\u7fa3\u5177\u6709\u76f8\u540c\u7684\u540d\u7a31\uff08\u5982\u679c\u60a8\u8981\u66ff\u63db\u539f\u59cb\u96c6\u7fa3\uff09\uff0c\u8acb [\u522a\u9664\u73fe\u6709\u7684 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3](https://cloud.google.com/dataproc/docs/guides/dpgke/dataproc-gke-delete-cluster?hl=zh-cn) \u3002\n- \u7b49\u5f85\u4e4b\u524d\u7684\u522a\u9664\u64cd\u4f5c\u5b8c\u6210\uff0c\u7136\u5f8c\u5c0e\u5165\u66f4\u65b0\u5f8c\u7684\u96c6\u7fa3\u914d\u7f6e\uff0c\u4ee5\u4f7f\u7528\u66f4\u65b0\u5f8c\u7684\u914d\u7f6e\u8a2d\u7f6e\u5275\u5efa\u65b0\u7684 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u3002```\ngcloud dataproc clusters import $CLUSTER \\\n\u00a0\u00a0\u00a0\u00a0--region=$REGION \\\n\u00a0\u00a0\u00a0\u00a0--source=\"${CLUSTER}-config.yaml\"\n```1. \u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\uff1a\n```\nCLUSTER=existing Dataproc on GKE cluster name \\\n\u00a0\u00a0REGION=region\n \n```\n- \u5c07\u73fe\u6709\u7684 Dataproc on GKE \u96c6\u7fa3\u914d\u7f6e\u5c0e\u51fa\u5230 YAML \u6587\u4ef6\u3002```\ncurl -X GET -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \"https://dataproc.googleapis.com/v1/projects/${PROJECT}/regions/${REGION}/clusters/${CLUSTER}?alt=json\" > \"${CLUSTER}-config.json\"\n```\n- \u79fb\u9664 [kubernetesNamespace](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters?hl=zh-cn#KubernetesClusterConfig.FIELDS.kubernetes_namespace) \u5b57\u6bb5\u3002\u5275\u5efa\u66f4\u65b0\u5f8c\u7684\u96c6\u7fa3\u6642\uff0c\u5fc5\u9808\u79fb\u9664\u6b64\u5b57\u6bb5\u4ee5\u907f\u514d\u547d\u540d\u7a7a\u9593\u885d\u7a81\u3002\u79fb\u9664 `kubernetesNamespace` \u5b57\u6bb5\u7684\u793a\u4f8b `jq` \u547d\u4ee4\uff1a```\njq 'del(.virtualClusterConfig.kubernetesClusterConfig.kubernetesNamespace)'\n \n```- \u9032\u884c\u5176\u4ed6\u66f4\u6539\u4ee5\u66f4\u65b0 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u914d\u7f6e\u8a2d\u7f6e\uff0c\u4f8b\u5982\u66f4\u6539 Spark [componentVersion](https://cloud.google.com/dataproc/docs/reference/rest/v1/projects.regions.clusters?hl=zh-cn#KubernetesSoftwareConfig.FIELDS.component_version) \u3002\n- \u5982\u679c\u60a8\u8981\u5275\u5efa\u7684\u96c6\u7fa3\u8207\u6240\u66f4\u65b0\u7684\u96c6\u7fa3\u540c\u540d\uff08\u5982\u679c\u60a8\u8981\u66ff\u63db\u539f\u59cb\u96c6\u7fa3\uff09\uff0c\u8acb\u522a\u9664\u73fe\u6709\u7684 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u3002```\ncurl -X DELETE -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \"https://dataproc.googleapis.com/v1/projects/${PROJECT}/regions/${REGION}/clusters/${CLUSTER}\"\n```\n- \u7b49\u5f85\u4e4b\u524d\u7684\u522a\u9664\u64cd\u4f5c\u5b8c\u6210\uff0c\u7136\u5f8c\u5c0e\u5165\u66f4\u65b0\u5f8c\u7684\u96c6\u7fa3\u914d\u7f6e\uff0c\u4ee5\u4f7f\u7528\u66f4\u65b0\u5f8c\u7684\u8a2d\u7f6e\u5275\u5efa\u65b0\u7684 Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u3002```\ncurl -i -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" -H \"Content-Type: application/json; charset=utf-8\" -d \"@${CLUSTER}-config.json\" \"https://dataproc.googleapis.com/v1/projects/${PROJECT}/regions/${REGION}/clusters?alt=json\"\n```Google Cloud \u63a7\u5236\u6aaf\u4e0d\u652f\u6301\u901a\u904e\u5c0e\u5165\u73fe\u6709\u96c6\u7fa3\u7684\u914d\u7f6e\u4f86\u91cd\u65b0\u5275\u5efa Dataproc on GKE \u865b\u64ec\u96c6\u7fa3\u3002", "guide": "Dataproc"}