{"title": "Vertex AI - Vertex AI Model Monitoring for batch predictions", "url": "https://cloud.google.com/vertex-ai/docs/start/introduction-unified-platform", "abstract": "# Vertex AI - Vertex AI Model Monitoring for batch predictions\n**  Preview ** This feature is covered by the [Pre-GA Offerings Terms](/terms/service-terms#1) of the Google Cloud   Terms of Service. For this feature, you can process personal data  as outlined in the [Data Processing Security Terms](/terms/data-processing-terms) ,  subject to the restrictions described in the [Google Cloud Platform Terms of Service](/terms) .  Pre-GA products and features might have limited support, and changes to   pre-GA products and features might not be compatible with other pre-GA versions.  For more information, see the [launch stage descriptions](/products#product-launch-stages) .\nThis page describes how to configure [batch prediction job requests](/vertex-ai/docs/predictions/get-batch-predictions) to include one-time Model Monitoring analysis. For batch predictions, Model Monitoring supports feature skew detection for categorical and numerical input features.\nTo create a batch prediction job with Model Monitoring skew analysis, you must include both your batch prediction input data and original training data for your model in the request. You can only add Model Monitoring analysis when creating new batch prediction jobs.\nFor more information about skew, see [Introduction toModel Monitoring](/vertex-ai/docs/model-monitoring/overview) .\nFor instructions on how to set up Model Monitoring for online (real-time) predictions, see [UsingModel Monitoring](/vertex-ai/docs/model-monitoring/using-model-monitoring) .\n", "content": "## Prerequisites\nTo use Model Monitoring with batch predictions, complete the following:\n- Have an available model in Vertex AI Model Registry that is either a [tabularAutoML](/vertex-ai/docs/start/automl-model-types#tabular) or tabular [custom training](/vertex-ai/docs/training/overview) type.\n- Upload your training data to [Cloud Storage](/storage/docs/uploading-objects) or [BigQuery](/bigquery/docs/loading-data) and obtain the URI link to the data.- For models trained with AutoML, you can use the [dataset id](/vertex-ai/docs/datasets/export-metadata-annotations#export_a_dataset_using_the_or_the_api) for your training dataset instead.\n- Model Monitoring compares the training data to the batch prediction output. Make sure you use supported file formats for the training data and batch prediction output:| Model type  | Training data         | Batch prediction output      |\n|:---------------|:-------------------------------------------------|:-----------------------------------------------|\n| Custom-trained | CSV, JSONL, BigQuery, TfRecord(tf.train.Example) | JSONL           |\n| AutoML tabular | CSV, JSONL, BigQuery, TfRecord(tf.train.Example) | CSV, JSONL, BigQuery, TfRecord(Protobuf.Value) |\n- Optional: For custom-trained models, upload the [schema](/vertex-ai/docs/model-monitoring/schemas#parse-batch-schemas) for your model to Cloud Storage. Model Monitoring requires the schema to calculate the baseline distribution for skew detection.## Request a batch prediction\nYou can use the following methods to add Model Monitoring configurations to batch prediction jobs:\nFollow the instructions to make a batch prediction request with Model Monitoring enabled:- [Tabular AutoML classification and regression](/vertex-ai/docs/tabular-data/classification-regression/get-batch-predictions#make-batch-request) \n- [Tabular AutoML forecasting](/vertex-ai/docs/tabular-data/forecasting/get-predictions#make_a_batch_prediction_request_to_your_model) \n- [Tabular custom training](/vertex-ai/docs/predictions/get-batch-predictions) \nFollow the instructions to make a batch prediction request using the REST API:- [Tabular AutoML classification and regression](/vertex-ai/docs/tabular-data/classification-regression/get-batch-predictions#make-batch-request) \n- [Tabular AutoML forecasting](/vertex-ai/docs/tabular-data/forecasting/get-predictions#make_a_batch_prediction_request_to_your_model) \n- [Tabular custom training](/vertex-ai/docs/predictions/get-batch-predictions) \nWhen you create the batch prediction request, add the following Model Monitoring configuration to the request JSON body:\n```\n\"modelMonitoringConfig\": {\n \"alertConfig\": {\n \"emailAlertConfig\": {\n  \"userEmails\": \"EMAIL_ADDRESS\"\n },\n \"notificationChannels\": [NOTIFICATION_CHANNELS]\n },\n \"objectiveConfigs\": [ {\n  \"trainingDataset\": {\n  \"dataFormat\": \"csv\",\n  \"gcsSource\": {\n   \"uris\": [   \"TRAINING_DATASET\"\n   ]\n  }\n  },\n  \"trainingPredictionSkewDetectionConfig\": {\n  \"skewThresholds\": {\n   \"FEATURE_1\": {\n   \"value\": VALUE_1\n   },\n   \"FEATURE_2\": {\n   \"value\": VALUE_2\n   }\n  }\n  }\n }\n ]\n}\n```\nwhere:- is the email address where you want to receive alerts from Model Monitoring. For example, `example@example.com` .\n- : a list of [Cloud Monitoring notification channels](/monitoring/support/notification-options) where you want to receive alerts from Model Monitoring. Use the resource names for the notification channels, which you can retrieve by [listing the notification channelsin your project](/monitoring/alerts/using-channels-api#api-list-channels) . For example, `\"projects/my-project/notificationChannels/1355376463305411567\", \"projects/my-project/notificationChannels/1355376463305411568\"` .\n- is the link to the training dataset stored in Cloud Storage.- To use a link to a BigQuery training dataset, replace the the`gcsSource`field with the following:\n```\n\"bigquerySource\": {\n {\n  \"inputUri\": \"TRAINING_DATASET\"\n }\n }\n```- To use a link to an AutoML model, replace the`gcsSource`field with the following:\n```\n\"dataset\": \"TRAINING_DATASET\"\n```\n- : and : is the alerting threshold for each feature you want to monitor. For example, if you specify `Age=0.4` , Model Monitoring logs an alert when the [statisticaldistance](/vertex-ai/docs/model-monitoring/overview#stat-distance) between the input and baseline distributions for the `Age` feature exceeds 0.4. By default, every categorical and numerical feature is monitored with threshold values of 0.3.\nFor more information about Model Monitoring configurations, see the [Monitoring job reference](/vertex-ai/docs/reference/rest/v1/projects.locations.modelDeploymentMonitoringJobs) .\nSee the [example notebook](https://colab.sandbox.google.com/github/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/batch_prediction_model_monitoring.ipynb) to run a batch prediction job with Model Monitoring for a custom tabular model.\nModel Monitoring automatically notifies you of job updates and alerts through email.\n## Access skew metrics\nYou can use the following methods to access skew metrics for batch prediction jobs:\nUse the Google Cloud console to view the feature distribution histograms for each monitored feature and learn which changes led to skew over time:- Go to the **Batch predictions** page: [Go to Batch predictions](https://console.cloud.google.com/vertex-ai/batch-predictions) \n- On the **Batch predictions** page, click the batch prediction job you want to analyze.\n- Click the **Model Monitoring Alerts** tab to view a list of the model's input features, along with pertinent information, such as the alert threshold for each feature.\n- To analyze a feature, click the name of the feature. A page shows the feature distribution histograms for that feature.Visualizing data distribution as histograms lets you quickly focus on the changes that occurred in the data. Afterward, you might decide to adjust your feature generation pipeline or retrain the model.\nUse the Google Cloud console to access the metrics in JSON format:- Go to the **Batch predictions** page: [Go to Batch predictions](https://console.cloud.google.com/vertex-ai/batch-predictions) \n- Click on the name of the batch prediction monitoring job.\n- Click the **Monitoring properties** tab.\n- Click the **Monitoring output directory** link, which directs you to a Cloud Storage bucket.\n- Click on the **metrics/** folder.\n- Click on the **skew/** folder.\n- Click on the `feature_skew.json` file, which directs you to the **Objectdetails** page.\n- Open the JSON file using either option:\n- Click **Download** and open the file in your local text editor.\n- Use the **gsutil URI** file path to run `gsutil cat` `` in the Cloud Shell or your local terminal.\nThe `feature_skew.json` file includes a dictionary where the key is the feature name and the value is the feature skew. For example:\n```\n{\n \"cnt_ad_reward\": 0.670936,\n \"cnt_challenge_a_friend\": 0.737924,\n \"cnt_completed_5_levels\": 0.549467,\n \"month\": 0.293332,\n \"operating_system\": 0.05758,\n \"user_pseudo_id\": 0.1\n}\n```\nSee the [example notebook](https://colab.sandbox.google.com/github/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/batch_prediction_model_monitoring.ipynb) to access skew metrics for a custom tabular model after running a batch prediction job with Model Monitoring.\n## Debug batch prediction monitoring failures\nIf your batch prediction monitoring job fails, you can find debugging logs in the Google Cloud console:\n- Go to the **Batch predictions** page. [Go to Batch predictions](https://console.cloud.google.com/vertex-ai/batch-predictions) \n- Click on the name of the failed batch prediction monitoring job.\n- Click the **Monitoring properties** tab.\n- Click the **Monitoring output directory** link, which directs you to a Cloud Storage bucket.\n- Click on the **logs/** folder.\n- Click on either of the `.INFO` files, which directs you to the **Objectdetails** page.\n- Open the logs file using either option:- Click **Download** and open the file in your local text editor.\n- Use the **gsutil URI** file path to run `gsutil cat` `` in the Cloud Shell or your local terminal.\n## Notebook tutorials\nLearn more about how to use Vertex AI Model Monitoring to get visualizations and statistics for models with these end-to-end tutorials.\n### AutoML\n- [Vertex AI Model Monitoring for AutoML tabular models](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/get_started_with_model_monitoring_automl.ipynb) \n- [Vertex AI Model Monitoring for batch prediction in AutoML image models](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/get_started_with_model_monitoring_automl_image_batch.ipynb) \n- [Vertex AI Model Monitoring for online prediction in AutoML image models](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/get_started_with_model_monitoring_automl_image_online.ipynb) \n### Custom\n- [Vertex AI Model Monitoring for custom tabular models](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/get_started_with_model_monitoring_custom.ipynb) \n- [Vertex AI Model Monitoring for custom tabular models with TensorFlow Serving container](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/get_started_with_model_monitoring_custom_tf_serving.ipynb) \n### XGBoost models\n- [Vertex AI Model Monitoring for XGBoost models](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/get_started_with_model_monitoring_xgboost.ipynb) \n### Explainable AI Feature Attributions\n- [Vertex AI Model Monitoring with Explainable AI Feature Attributions](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/model_monitoring.ipynb) \n### Batch prediction\n- [Vertex AI Batch Prediction with Model Monitoring](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/batch_prediction_model_monitoring.ipynb) \n### Setup for tabular models\n- [Vertex AI Model Monitoring for setup for tabular models](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/model_monitoring/get_started_with_model_monitoring_setup.ipynb) ## What's next\n- Learn how to use [Model Monitoring](/vertex-ai/docs/model-monitoring/using-model-monitoring) .\n- Learn how Model Monitoring [calculates training-servingskew and prediction drift](/vertex-ai/docs/model-monitoring/overview) .", "guide": "Vertex AI"}