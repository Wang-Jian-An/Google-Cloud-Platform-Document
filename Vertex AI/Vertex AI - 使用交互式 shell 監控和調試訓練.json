{"title": "Vertex AI - \u4f7f\u7528\u4ea4\u4e92\u5f0f shell \u76e3\u63a7\u548c\u8abf\u8a66\u8a13\u7df4", "url": "https://cloud.google.com/vertex-ai/docs/training/monitor-debug-interactive-shell?hl=zh-cn", "abstract": "# Vertex AI - \u4f7f\u7528\u4ea4\u4e92\u5f0f shell \u76e3\u63a7\u548c\u8abf\u8a66\u8a13\u7df4\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528\u4ea4\u4e92\u5f0f shell \u6aa2\u67e5\u904b\u884c\u8a13\u7df4\u4ee3\u78bc\u7684\u5bb9\u5668\u3002\u60a8\u53ef\u4ee5\u700f\u89bd\u6587\u4ef6\u7cfb\u7d71\uff0c\u4e26\u5728 Vertex AI \u4e0a\u904b\u884c\u7684\u6bcf\u500b [\u9810\u69cb\u5efa\u5bb9\u5668](https://cloud.google.com/vertex-ai/docs/training/pre-built-containers?hl=zh-cn) \u6216 [\u81ea\u5b9a\u7fa9\u5bb9\u5668](https://cloud.google.com/vertex-ai/docs/training/containers-overview?hl=zh-cn) \u4e2d\u904b\u884c\u8abf\u8a66\u5be6\u7528\u7a0b\u5e8f\u3002\n\u4f7f\u7528\u4ea4\u4e92\u5f0f shell \u6aa2\u67e5\u8a13\u7df4\u5bb9\u5668\u53ef\u5e6b\u52a9\u60a8\u8abf\u8a66\u8a13\u7df4\u4ee3\u78bc\u6216 Vertex AI \u914d\u7f6e\u76f8\u95dc\u7684\u554f\u984c\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ea4\u4e92\u5f0f shell \u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u904b\u884c\u8ddf\u8e64\u548c\u5256\u6790\u5de5\u5177\u3002\n- \u5206\u6790 GPU \u4f7f\u7528\u60c5\u6cc1\u3002\n- \u67e5\u770b\u5bb9\u5668\u53ef\u7528\u7684 Google Cloud \u6b0a\u9650\u3002\nVertex AI \u9084\u8207 TensorFlow Profiler \u96c6\u6210\uff0c\u53ef\u7528\u65bc\u8abf\u8a66\u81ea\u5b9a\u7fa9\u8a13\u7df4\u4f5c\u696d\u7684\u6a21\u578b\u8a13\u7df4\u6027\u80fd\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 Profiler \u5206\u6790\u6a21\u578b\u8a13\u7df4\u6027\u80fd](https://cloud.google.com/vertex-ai/docs/training/tensorboard-profiler?hl=zh-cn) \u3002\n", "content": "## \u6e96\u5099\u5de5\u4f5c\n\u4f7f\u7528 `CustomJob` \u8cc7\u6e90\u3001 `HyperparameterTuningJob` \u8cc7\u6e90\u6216\u81ea\u5b9a\u7fa9 `TrainingPipeline` \u8cc7\u6e90\u57f7\u884c\u81ea\u5b9a\u7fa9\u8a13\u7df4\u6642\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ea4\u4e92\u5f0f shell\u3002 [\u6e96\u5099\u8a13\u7df4\u4ee3\u78bc](https://cloud.google.com/vertex-ai/docs/training/code-requirements?hl=zh-cn) \u548c [\u914d\u7f6e\u81ea\u5b9a\u7fa9\u8a13\u7df4\u8cc7\u6e90](https://cloud.google.com/vertex-ai/docs/training/custom-training-methods?hl=zh-cn) \u6642\uff0c\u8acb\u52d9\u5fc5\u6eff\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a\n- \u78ba\u4fdd\u8a13\u7df4\u5bb9\u5668\u5df2\u5b89\u88dd [bash](https://www.gnu.org/software/bash/) \u3002\u6240\u6709 [\u9810\u69cb\u5efa\u8a13\u7df4\u5bb9\u5668](https://cloud.google.com/vertex-ai/docs/training/pre-built-containers?hl=zh-cn) \u90fd\u5b89\u88dd\u4e86 `bash` \u3002\u5982\u679c\u60a8 [\u5275\u5efa\u81ea\u5b9a\u7fa9\u5bb9\u5668\u9032\u884c\u8a13\u7df4](https://cloud.google.com/vertex-ai/docs/training/create-custom-container?hl=zh-cn) \uff0c\u8acb\u4f7f\u7528\u5305\u542b `bash` \u7684\u57fa\u790e\u5bb9\u5668\u6216\u5728 Dockerfile \u4e2d\u5b89\u88dd `bash` \u3002\n- \u5728 [\u652f\u6301\u4ea4\u4e92\u5f0f shell \u7684\u5340\u57df](https://cloud.google.com/vertex-ai/docs/general/locations?hl=zh-cn#feature-availability) \u4e2d\u57f7\u884c\u81ea\u5b9a\u7fa9\u8a13\u7df4\u3002\n- \u78ba\u4fdd\u60f3\u8981\u8a2a\u554f\u4ea4\u4e92\u5f0f Shell \u7684\u4efb\u4f55\u4eba\u90fd\u64c1\u6709\u6b63\u5728\u904b\u884c\u81ea\u5b9a\u7fa9\u8a13\u7df4\u7684 Google Cloud \u9805\u76ee\u7684\u4ee5\u4e0b\u6b0a\u9650\uff1a- `aiplatform.customJobs.create`\n- `aiplatform.customJobs.get`\n- `aiplatform.customJobs.cancel`\n\u5982\u679c\u60a8\u81ea\u884c\u5553\u52d5\u81ea\u5b9a\u7fa9\u8a13\u7df4\uff0c\u5247\u60a8\u5f88\u53ef\u80fd\u5df2\u5177\u6709\u9019\u4e9b\u6b0a\u9650\uff0c\u4e26\u53ef\u4ee5\u8a2a\u554f\u4ea4\u4e92\u5f0f shell\u3002\u4f46\u662f\uff0c\u5982\u679c\u8981\u4f7f\u7528\u4ea4\u4e92\u5f0f shell \u6aa2\u67e5\u7d44\u7e54\u4e2d\u5176\u4ed6\u4eba\u5275\u5efa\u7684\u81ea\u5b9a\u7fa9\u8a13\u7df4\u8cc7\u6e90\uff0c\u5247\u53ef\u80fd\u9700\u8981\u7372\u53d6\u9019\u4e9b\u6b0a\u9650\u3002\u7372\u53d6\u9019\u4e9b\u6b0a\u9650\u7684\u4e00\u7a2e\u65b9\u6cd5\u662f\u8981\u6c42\u7d44\u7e54\u7ba1\u7406\u54e1\u6388\u4e88\u60a8 [Vertex AI User \u89d2\u8272](https://cloud.google.com/vertex-ai/docs/general/access-control?hl=zh-cn#predefined-roles) ( `roles/aiplatform.user` )\u3002\n### \u9ad8\u7d1a\u6848\u4f8b\u7684\u8981\u6c42\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u7279\u5b9a\u9ad8\u7d1a\u529f\u80fd\uff0c\u8acb\u6eff\u8db3\u4ee5\u4e0b\u984d\u5916\u8981\u6c42\uff1a\n- \u5982\u679c\u60a8\u7232\u81ea\u5b9a\u7fa9\u8a13\u7df4\u8cc7\u6e90 [\u9644\u52a0\u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f](https://cloud.google.com/vertex-ai/docs/general/custom-service-account?hl=zh-cn#attach) \uff0c\u8acb\u78ba\u4fdd\u4efb\u4f55\u60f3\u8981\u8a2a\u554f\u4ea4\u4e92\u5f0f Shell \u7684\u7528\u6236\u90fd\u5177\u6709\u6240\u9644\u52a0\u7684\u670d\u52d9\u8cec\u865f\u7684 `iam.serviceAccounts.actAs` \u6b0a\u9650\u3002\u81ea\u5b9a\u7fa9\u670d\u52d9\u8cec\u865f\u6307\u5357\u6307\u660e\u77ad\u60a8\u5fc5\u9808\u64c1\u6709\u6b64\u6b0a\u9650\u624d\u80fd\u9644\u52a0\u670d\u52d9\u8cec\u865f\u3002\u6b64\u5916\uff0c\u5fc5\u9808\u5177\u6709\u6b64\u6b0a\u9650\u624d\u80fd\u5728\u81ea\u5b9a\u7fa9\u8a13\u7df4\u671f\u9593\u67e5\u770b\u4ea4\u4e92\u5f0f Shell\u3002\u4f8b\u5982\uff0c\u5982\u9700\u4f7f\u7528\u9644\u52a0\u7684\u670d\u52d9\u8cec\u865f\u5275\u5efa `CustomJob` \uff0c\u5fc5\u9808\u5177\u6709\u8a72\u670d\u52d9\u8cec\u865f\u7684 `iam.serviceAccounts.actAs` \u6b0a\u9650\u3002\u5982\u679c\u60a8\u7684\u67d0\u500b\u540c\u4e8b\u96a8\u5f8c\u60f3\u8981\u67e5\u770b\u6b64 `CustomJob` \u7684\u4ea4\u4e92\u5f0f Shell\uff0c\u5247\u4ed6\u5011\u9084\u5fc5\u9808\u5177\u6709\u76f8\u540c\u7684 `iam.serviceAccounts.actAs` \u6b0a\u9650\u3002\n- \u5982\u679c\u60a8\u5df2\u5c07\u9805\u76ee\u914d\u7f6e\u7232 [\u5c07 VPC Service Controls \u8207 Vertex AI \u642d\u914d\u4f7f\u7528](https://cloud.google.com/vertex-ai/docs/general/vpc-service-controls?hl=zh-cn) \uff0c\u5247\u9700\u8981\u8003\u616e\u4ee5\u4e0b\u984d\u5916\u9650\u5236\uff1a- \u60a8\u7121\u6cd5\u4f7f\u7528 [\u5c08\u7528 IP \u9032\u884c\u81ea\u5b9a\u7fa9\u8a13\u7df4](https://cloud.google.com/vertex-ai/docs/training/using-private-ip?hl=zh-cn) \u3002\n- \u5728\u4ea4\u4e92\u5f0f shell \u4e2d\uff0c\u60a8\u7121\u6cd5\u8a2a\u554f\u516c\u5171\u4e92\u806f\u7db2\u6216\u670d\u52d9\u908a\u754c\u5916\u7684 Google Cloud \u8cc7\u6e90\u3002\n- \u5982\u9700\u4fdd\u8b77\u5c0d\u4ea4\u4e92\u5f0f Shell \u7684\u8a2a\u554f\uff0c\u9664\u4e86 `aiplatform.googleapis.com` \u4e4b\u5916\uff0c\u60a8\u9084\u5fc5\u9808\u5728\u670d\u52d9\u908a\u754c\u5167\u6dfb\u52a0 `notebooks.googleapis.com` \u4f5c\u7232\u53d7\u9650\u670d\u52d9\u3002\u5982\u679c\u60a8\u50c5\u9650\u5236 `aiplatform.googleapis.com` \u800c\u4e0d\u9650\u5236 `notebooks.googleapis.com` \uff0c\u5247\u7528\u6236\u53ef\u4ee5\u5f9e\u670d\u52d9\u908a\u754c\u5916\u7684\u6a5f\u5668\u8a2a\u554f\u4ea4\u4e92\u5f0f Shell\uff0c\u5f9e\u800c\u964d\u4f4e\u4f7f\u7528 VPC Service Controls \u6642\u7684\u5b89\u5168\u512a\u52e2\u3002 **\u6ce8\u610f** \uff1a\u7e3d\u9ad4\u800c\u8a00\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u5728\u5275\u5efa\u670d\u52d9\u908a\u754c\u6642\u9650\u5236\u6240\u6709\u670d\u52d9\u3002\u8acb\u6309\u7167 [VPC Service Controls \u6307\u5357\u5275\u5efa\u670d\u52d9\u908a\u754c](https://cloud.google.com/vpc-service-controls/docs/create-service-perimeters?hl=zh-cn) \u3002\n## \u5553\u7528\u4ea4\u4e92\u5f0f shell\n\u8981\u7232\u81ea\u5b9a\u7fa9\u8a13\u7df4\u8cc7\u6e90\u5553\u7528\u4ea4\u4e92\u5f0f shell\uff0c\u8acb\u5728\u5275\u5efa `CustomJob` \u3001 `HyperparameterTuningJob` \u6216\u81ea\u5b9a\u7fa9 `TrainingPipeline` \u6642\u5c07 [enableWebAccess API \u5b57\u6bb5](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/CustomJobSpec?hl=zh-cn#FIELDS.enable_web_access) \u8a2d\u7f6e\u7232 `true` \u3002\n\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u77ad\u5982\u4f55\u4f7f\u7528\u591a\u7a2e\u4e0d\u540c\u7684\u5de5\u5177\u57f7\u884c\u6b64\u64cd\u4f5c\uff1a\n\u6309\u7167\u6307\u5357 [\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u5275\u5efa\u81ea\u5b9a\u7fa9 TrainingPipeline](https://cloud.google.com/vertex-ai/docs/training/create-training-pipeline?hl=zh-cn#custom-job-model-upload) \u3002\u5728 **\u8a13\u7df4\u65b0\u6a21\u578b** \u7a97\u683c\u4e2d\uff0c\u7576\u60a8\u5230\u9054 **\u6a21\u578b\u8a73\u60c5** \u6b65\u9a5f\u6642\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u9ede\u64ca **\u9ad8\u7d1a\u9078\u9805** \u3002\n- \u9078\u4e2d **\u5553\u7528\u8a13\u7df4\u8abf\u8a66\u529f\u80fd** \u8907\u9078\u6846\u3002\n\u7136\u5f8c\uff0c\u5b8c\u6210 **\u8a13\u7df4\u65b0\u6a21\u578b** \u5de5\u4f5c\u6d41\u7684\u5176\u9918\u90e8\u5206\u3002\n- \u5982\u679c\u8981\u5275\u5efa `CustomJob` \uff0c\u8acb\u904b\u884c [gcloud ai custom-jobs create \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/ai/custom-jobs/create?hl=zh-cn) \uff0c\u4e26\u5728\u6b64\u547d\u4ee4\u4e2d\u6307\u5b9a `--enable-web-access` \u6a19\u8a8c\u3002\n- \u5982\u679c\u8981\u5275\u5efa `HyperparameterTuningJob` \uff0c\u8acb\u904b\u884c [gcloud ai hp-tuning-jobs create \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/ai/hp-tuning-jobs/create?hl=zh-cn) \uff0c\u4e26\u5728\u6b64\u547d\u4ee4\u4e2d\u6307\u5b9a `--enable-web-access` \u6a19\u8a8c\u3002\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u4f7f\u7528\u9019\u4e9b\u547d\u4ee4\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa CustomJob](https://cloud.google.com/vertex-ai/docs/training/create-custom-job?hl=zh-cn#create) \u6307\u5357\u548c [\u5275\u5efa HyperparameterTuningJob](https://cloud.google.com/vertex-ai/docs/training/using-hyperparameter-tuning?hl=zh-cn#create) \u6307\u5357\u3002\u4ee5\u4e0b\u90e8\u5206 REST \u8acb\u6c42\u6b63\u6587\u986f\u793a\u77ad\u5982\u4f55\u7232\u6bcf\u7a2e\u985e\u578b\u7684\u81ea\u5b9a\u7fa9\u8a13\u7df4\u8cc7\u6e90\u6307\u5b9a `enableWebAccess` \u5b57\u6bb5\uff1a\n\u4ee5\u4e0b\u793a\u4f8b\u662f [projects.locations.customJobs.create API \u65b9\u6cd5](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.customJobs/create?hl=zh-cn) \u7684\u90e8\u5206\u8acb\u6c42\u6b63\u6587\uff1a\n```\n{\u00a0 ...\u00a0 \"jobSpec\": {\u00a0 \u00a0 ...\u00a0 \u00a0 \"enableWebAccess\": true\u00a0 }\u00a0 ...}\n```\n\u5982\u9700\u67e5\u770b\u767c\u9001 API \u8acb\u6c42\u4ee5\u5275\u5efa `CustomJob` \u7684\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u81ea\u5b9a\u7fa9\u8a13\u7df4\u4f5c\u696d](https://cloud.google.com/vertex-ai/docs/training/create-custom-job?hl=zh-cn) \u3002\n\u4ee5\u4e0b\u793a\u4f8b\u662f [projects.locations.hyperparameterTuningJobs.create API \u65b9\u6cd5](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.hyperparameterTuningJobs/create?hl=zh-cn) \u7684\u90e8\u5206\u8acb\u6c42\u6b63\u6587\uff1a\n```\n{\u00a0 ...\u00a0 \"trialJobSpec\": {\u00a0 \u00a0 ...\u00a0 \u00a0 \"enableWebAccess\": true\u00a0 }\u00a0 ...}\n```\n\u5982\u9700\u67e5\u770b\u767c\u9001 API \u8acb\u6c42\u4ee5\u5275\u5efa `HyperparameterTuningJob` \u7684\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528\u8d85\u53c3\u6578\u8abf\u7bc0](https://cloud.google.com/vertex-ai/docs/training/using-hyperparameter-tuning?hl=zh-cn) \u3002\n\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86 [projects.locations.trainingPipelines.create API \u65b9\u6cd5](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.trainingPipelines/create?hl=zh-cn) \u7684\u90e8\u5206\u8acb\u6c42\u6b63\u6587\u3002\u6839\u64da\u662f\u5426\u8981\u4f7f\u7528\u8d85\u53c3\u6578\u8abf\u7bc0\u529f\u80fd\uff0c\u9078\u64c7\u4ee5\u4e0b\u6a19\u7c64\u9801\u4e4b\u4e00\uff1a\n```\n{\u00a0 ...\u00a0 \"trainingTaskInputs\": {\u00a0 \u00a0 ...\u00a0 \u00a0 \"enableWebAccess\": true\u00a0 }\u00a0 ...}\n```\n```\n{\u00a0 ...\u00a0 \"trainingTaskInputs\": {\u00a0 \u00a0 ...\u00a0 \u00a0 \"trialJobSpec\": {\u00a0 \u00a0 \u00a0 ...\u00a0 \u00a0 \u00a0 \"enableWebAccess\": true\u00a0 \u00a0 }\u00a0 }\u00a0 ...}\n```\u5982\u9700\u67e5\u770b\u767c\u9001 API \u8acb\u6c42\u4ee5\u5275\u5efa\u81ea\u5b9a\u7fa9 `TrainingPipeline` \u7684\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u8a13\u7df4\u6d41\u6c34\u7dda](https://cloud.google.com/vertex-ai/docs/training/create-training-pipeline?hl=zh-cn) \u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u6216\u66f4\u65b0 Python\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Python \u7248 Vertex AI SDK](https://cloud.google.com/vertex-ai/docs/start/use-vertex-ai-python-sdk?hl=zh-cn) \u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Python API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/python/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n\u904b\u884c\u4ee5\u4e0b\u65b9\u6cd5\u4e4b\u4e00\u6642\uff0c\u5c07 `enable_web_access` \u53c3\u6578\u8a2d\u7f6e\u7232 `true` \uff1a- \u5982\u679c\u60a8\u8981\u5275\u5efa `CustomJob` \uff0c\u8acb\u4f7f\u7528 [CustomJob.run \u65b9\u6cd5](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.CustomJob?hl=zh-cn#google_cloud_aiplatform_CustomJob_run) \u3002\n- \u5982\u679c\u60a8\u8981\u5275\u5efa `HyperparameterTuningJob` \uff0c\u8acb\u4f7f\u7528 [HyperparameterTuningJob.run \u65b9\u6cd5](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.HyperparameterTuningJob?hl=zh-cn#google_cloud_aiplatform_HyperparameterTuningJob_run) \u3002\n- \u5982\u679c\u8981\u5275\u5efa\u81ea\u5b9a\u7fa9 `TrainingPipeline` \uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u4e4b\u4e00\uff1a- [CustomTrainingJob.run](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.CustomTrainingJob?hl=zh-cn#google_cloud_aiplatform_CustomTrainingJob_run) \n- [CustomContainerTrainingJob.run](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.CustomContainerTrainingJob?hl=zh-cn#google_cloud_aiplatform_CustomContainerTrainingJob_run) \n- [CustomPythonPackageTrainingJob.run](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.CustomPythonPackageTrainingJob?hl=zh-cn#google_cloud_aiplatform_CustomPythonPackageTrainingJob_run) \n## \u6253\u958b\u4ea4\u4e92\u5f0f Shell\n\u6839\u64da\u4e0a\u4e00\u90e8\u5206\u4e2d\u7684\u8aaa\u660e\u5553\u52d5\u81ea\u5b9a\u7fa9\u8a13\u7df4\u5f8c\uff0cVertex AI \u6703\u751f\u6210\u4e00\u500b\u6216\u591a\u500b URI\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u9019\u4e9b URI \u4f86\u8a2a\u554f\u4ea4\u4e92\u5f0f shell\u3002Vertex AI \u6703\u7232\u4f5c\u696d\u4e2d\u7684\u6bcf\u500b [\u8a13\u7df4\u7bc0\u9ede](https://cloud.google.com/vertex-ai/docs/training/distributed-training?hl=zh-cn) \u751f\u6210\u552f\u4e00\u7684 URI\u3002\n\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u4efb\u4e00\u65b9\u5f0f\u5c0e\u822a\u5230\u4ea4\u4e92\u5f0f shell\uff1a\n- \u9ede\u64ca Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7684\u93c8\u63a5\n- \u4f7f\u7528 Vertex AI API \u7372\u53d6 shell \u7684\u7db2\u7d61\u8a2a\u554f URI\n### \u5f9e Google Cloud \u63a7\u5236\u6aaf\u5c0e\u822a\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 **Vertex AI** \u90e8\u5206\u4e2d\uff0c\u8f49\u5230\u4ee5\u4e0b\u9801\u9762\u4e4b\u4e00\uff1a- \u5982\u679c\u60a8\u6c92\u6709\u4f7f\u7528\u8d85\u53c3\u6578\u8abf\u7bc0\uff0c\u8acb\u8f49\u5230 **\u81ea\u5b9a\u7fa9\u4f5c\u696d** \u9801\u9762\uff1a [\u6253\u958b\u201c\u81ea\u5b9a\u7fa9\u4f5c\u696d\u201d](https://console.cloud.google.com/vertex-ai/training/custom-jobs?hl=zh-cn) \n- \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u8d85\u53c3\u6578\u5fae\u8abf\uff0c\u8acb\u8f49\u5230 **\u8d85\u53c3\u6578\u5fae\u8abf\u4f5c\u696d** \u9801\u9762\uff1a [\u8f49\u5230\u201c\u8d85\u53c3\u6578\u8abf\u7bc0\u4f5c\u696d\u201d](https://console.cloud.google.com/vertex-ai/training/hyperparameter-tuning-jobs?hl=zh-cn) \n- \u9ede\u64ca\u81ea\u5b9a\u7fa9\u8a13\u7df4\u8cc7\u6e90\u7684\u540d\u7a31\u3002\u5982\u679c\u60a8\u7232\u81ea\u5b9a\u7fa9\u8a13\u7df4\u5275\u5efa\u4e86 `TrainingPipeline` \uff0c\u8acb\u9ede\u64ca `TrainingPipeline` \u5275\u5efa\u7684 `CustomJob` \u6216 `HyperparameterTuningJob` \u7684\u540d\u7a31\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684\u6d41\u6c34\u7dda\u540d\u7232 `` \uff0c\u5247\u8a72\u540d\u7a31\u53ef\u80fd\u7232 `` `-custom-job` \u6216 `` `-hyperparameter-tuning-job` \u3002\n- \u5728\u4f5c\u696d\u9801\u9762\u4e0a\uff0c\u9ede\u64ca **\u5553\u52d5\u7db2\u7d61\u7d42\u7aef** \u3002\u5982\u679c\u60a8\u7684\u4f5c\u696d\u4f7f\u7528\u591a\u500b\u7bc0\u9ede\uff0c\u8acb\u9ede\u64ca\u8981\u4f7f\u7528\u4ea4\u4e92\u5f0f shell \u7684\u7bc0\u9ede\u65c1\u908a\u7684 **\u5553\u52d5\u7db2\u7d61\u7d42\u7aef** \u3002\u8acb\u6ce8\u610f\uff0c\u60a8\u53ea\u80fd\u5728\u4f5c\u696d\u904b\u884c\u6642\u8a2a\u554f\u4ea4\u4e92\u5f0f shell\u3002\u5982\u679c\u6c92\u6709\u770b\u5230 **\u5553\u52d5\u7db2\u7d61\u7d42\u7aef** \uff0c\u53ef\u80fd\u662f\u56e0\u7232 Vertex AI \u5c1a\u672a\u958b\u59cb\u904b\u884c\u4f5c\u696d\uff0c\u6216\u8005\u4f5c\u696d\u5df2\u5b8c\u6210\u6216\u5931\u6557\u3002\u5982\u679c\u4f5c\u696d\u7684 **\u72c0\u614b** \u662f `Queued` \u6216 `Pending` \uff0c\u8acb\u7a0d\u7b49\u7247\u523b\uff0c\u7136\u5f8c\u5617\u8a66\u5237\u65b0\u9801\u9762\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u8d85\u53c3\u6578\u8abf\u7bc0\uff0c\u5247\u6bcf\u500b\u8a66\u9a57\u90fd\u6709\u55ae\u7368\u7684 **\u5553\u52d5\u7db2\u7d61\u7d42\u7aef** \u93c8\u63a5\u3002\n### \u5f9e API \u7372\u53d6 Web \u8a2a\u554f URI\n\u4f7f\u7528 [projects.locations.customJobs.get API \u65b9\u6cd5](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.customJobs/get?hl=zh-cn) \u6216 [projects.locations.hyperparameterTuningJobs.get API \u65b9\u6cd5](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.hyperparameterTuningJobs/get?hl=zh-cn) \u67e5\u770b\u60a8\u53ef\u4ee5\u7528\u4f86\u8a2a\u554f shell \u7684 URI\u3002\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u7232\u81ea\u5b9a\u7fa9\u8a13\u7df4\u5275\u5efa\u4e86 `TrainingPipeline` \uff0c\u8acb\u5728 `CustomJob` \uff08\u7531 `TrainingPipeline` \u7684 `trainingTaskMetadata.backingCustomJob` \u5b57\u6bb5\u6a19\u8b58\uff09\u6216 `HyperparameterTuningJob` \uff08\u7531 `TrainingPipeline` \u7684 `trainingTaskMetadata.backingHyperparameterTuningJob` \u5b57\u6bb5\u6a19\u8b58\uff09\u4e0a\u904b\u884c\u76f8\u61c9\u7684 `get` \u65b9\u6cd5\u3002\n\u6839\u64da\u60a8\u4f7f\u7528\u7684\u81ea\u5b9a\u7fa9\u8a13\u7df4\u8cc7\u6e90\u985e\u578b\uff0c\u9078\u64c7\u4ee5\u4e0b\u6a19\u7c64\u9801\u4e4b\u4e00\u4ee5\u67e5\u770b\u6709\u95dc\u5982\u4f55\u67e5\u627e `webAccessUris` API \u5b57\u6bb5\u7684\u793a\u4f8b\uff0c\u5176\u4e2d\u5305\u542b\u4f5c\u696d\u4e2d\u6bcf\u500b\u7bc0\u9ede\u7684\u4ea4\u4e92\u5f0f shell URI\uff1a\n\u4ee5\u4e0b\u6a19\u7c64\u9801\u986f\u793a\u4e86\u767c\u9001 `projects.locations.customJobs.get` \u8acb\u6c42\u7684\u4e0d\u540c\u65b9\u5f0f\uff1a\n\u904b\u884c [gcloud ai custom-jobs describe \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/ai/custom-jobs/describe?hl=zh-cn) \uff1a\n```\ngcloud ai custom-jobs describe JOB_ID \\\u00a0 --region=LOCATION \\\u00a0 --format=json\n```\n\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1a\u4f5c\u696d\u7684\u6578\u5b57 ID\u3002\u6b64 ID \u662f\u4f5c\u696d\u7684 `name` \u5b57\u6bb5\u7684\u6700\u5f8c\u4e00\u90e8\u5206\u3002\u60a8\u5728\u5275\u5efa\u4f5c\u696d\u6642\u53ef\u80fd\u5df2\u770b\u5230\u8a72 ID\u3002\uff08\u5982\u60a8\u4e0d\u77e5\u9053\u4f5c\u696d ID\uff0c\u5247\u53ef\u4ee5\u904b\u884c [gcloud ai custom-jobs list \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/ai/custom-jobs/list?hl=zh-cn) \u4e26\u67e5\u627e\u76f8\u61c9\u7684\u4f5c\u696d\u3002\uff09\n- \uff1a\u60a8\u5728\u5176\u4e2d\u5275\u5efa\u4f5c\u696d\u7684\u5340\u57df\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u60a8\u5728\u5176\u4e2d\u5275\u5efa\u4f5c\u696d\u7684\u5340\u57df\u3002\n- \uff1a\u60a8\u7684 [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n- \uff1a\u4f5c\u696d\u7684\u6578\u5b57 ID\u3002\u6b64 ID \u662f\u4f5c\u696d\u7684 `name` \u5b57\u6bb5\u7684\u6700\u5f8c\u4e00\u90e8\u5206\u3002\u60a8\u5728\u5275\u5efa\u4f5c\u696d\u6642\u53ef\u80fd\u5df2\u770b\u5230\u8a72 ID\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://LOCATION-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/customJobs/JOB_ID\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u5728\u8f38\u51fa\u4e2d\uff0c\u67e5\u627e\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\n{\u00a0 ...\u00a0 \"state\": \"JOB_STATE_RUNNING\",\u00a0 ...\u00a0 \"webAccessUris\": {\u00a0 \u00a0 \"workerpool0-0\": \"INTERACTIVE_SHELL_URI\"\u00a0 }}\n```\n\u5982\u679c\u60a8\u6c92\u6709\u770b\u5230 `webAccessUris` \u5b57\u6bb5\uff0c\u53ef\u80fd\u662f\u56e0\u7232 Vertex AI \u5c1a\u672a\u958b\u59cb\u904b\u884c\u60a8\u7684\u4f5c\u696d\u3002\u9a57\u8b49\u60a8\u662f\u5426\u5728 `state` \u5b57\u6bb5\u4e2d\u770b\u5230 `JOB_STATE_RUNNING` \u3002\u5982\u679c\u72c0\u614b\u7232 `JOB_STATE_QUEUED` \u6216 `JOB_STATE_PENDING` \uff0c\u8acb\u7a0d\u7b49\u7247\u523b\uff0c\u7136\u5f8c\u518d\u6b21\u5617\u8a66\u7372\u53d6\u9805\u76ee\u4fe1\u606f\u3002\n\u4ee5\u4e0b\u6a19\u7c64\u9801\u986f\u793a\u4e86\u767c\u9001 `projects.locations.hyperparameterTuningJobs.get` \u8acb\u6c42\u7684\u4e0d\u540c\u65b9\u5f0f\uff1a\n\u904b\u884c [gcloud ai hp-tuning-jobs describe \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/ai/hp-tuning-jobs/describe?hl=zh-cn) \uff1a\n```\ngcloud ai hp-tuning-jobs describe JOB_ID \\\u00a0 --region=LOCATION \\\u00a0 --format=json\n```\n\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1a\u4f5c\u696d\u7684\u6578\u5b57 ID\u3002\u6b64 ID \u662f\u4f5c\u696d\u7684 `name` \u5b57\u6bb5\u7684\u6700\u5f8c\u4e00\u90e8\u5206\u3002\u60a8\u5728\u5275\u5efa\u4f5c\u696d\u6642\u53ef\u80fd\u5df2\u770b\u5230\u8a72 ID\u3002\uff08\u5982\u60a8\u4e0d\u77e5\u9053\u4f5c\u696d ID\uff0c\u5247\u53ef\u4ee5\u904b\u884c [gcloud ai hp-tuning-jobs list \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/ai/hp-tuning-jobs/list?hl=zh-cn) \u4e26\u67e5\u627e\u76f8\u61c9\u7684\u4f5c\u696d\u3002\uff09\n- \uff1a\u60a8\u5728\u5176\u4e2d\u5275\u5efa\u4f5c\u696d\u7684\u5340\u57df\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u60a8\u5728\u5176\u4e2d\u5275\u5efa\u4f5c\u696d\u7684\u5340\u57df\u3002\n- \uff1a\u60a8\u7684 [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n- \uff1a\u4f5c\u696d\u7684\u6578\u5b57 ID\u3002\u6b64 ID \u662f\u4f5c\u696d\u7684 `name` \u5b57\u6bb5\u7684\u6700\u5f8c\u4e00\u90e8\u5206\u3002\u60a8\u5728\u5275\u5efa\u4f5c\u696d\u6642\u53ef\u80fd\u5df2\u770b\u5230\u8a72 ID\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://LOCATION-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/hyperparameterTuningJobs/JOB_ID\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u5728\u8f38\u51fa\u4e2d\uff0c\u67e5\u627e\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\n{\u00a0 ...\u00a0 \"state\": \"JOB_STATE_RUNNING\",\u00a0 ...\u00a0 \"trials\": [\u00a0 \u00a0 ...\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 ...\u00a0 \u00a0 \u00a0 \"state\": \"ACTIVE\",\u00a0 \u00a0 \u00a0 ...\u00a0 \u00a0 \u00a0 \"webAccessUris\": {\u00a0 \u00a0 \u00a0 \u00a0 \"workerpool0-0\": \"INTERACTIVE_SHELL_URI\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 ],}\n```\n\u5982\u679c\u60a8\u6c92\u6709\u770b\u5230 `webAccessUris` \u5b57\u6bb5\uff0c\u53ef\u80fd\u662f\u56e0\u7232 Vertex AI \u5c1a\u672a\u958b\u59cb\u904b\u884c\u60a8\u7684\u4f5c\u696d\u3002\u9a57\u8b49\u60a8\u662f\u5426\u5728 `state` \u5b57\u6bb5\u4e2d\u770b\u5230 `JOB_STATE_RUNNING` \u3002\u5982\u679c\u72c0\u614b\u7232 `JOB_STATE_QUEUED` \u6216 `JOB_STATE_PENDING` \uff0c\u8acb\u7a0d\u7b49\u7247\u523b\uff0c\u7136\u5f8c\u518d\u6b21\u5617\u8a66\u7372\u53d6\u9805\u76ee\u4fe1\u606f\u3002\n\u7576\u8a66\u7528\u9032\u5165 `ACTIVE` \u72c0\u614b\u6642\uff0cVertex AI \u6703\u7232\u6bcf\u6b21 [\u8d85\u53c3\u6578\u8abf\u7bc0\u8a66\u7528](https://cloud.google.com/vertex-ai/docs/training/hyperparameter-tuning-overview?hl=zh-cn#understanding-trials) \u63d0\u4f9b\u4e00\u7d44\u4ea4\u4e92\u5f0f Shell URI\u3002\u5982\u679c\u60a8\u5e0c\u671b\u7372\u53d6\u7528\u65bc\u4e4b\u5f8c\u8a66\u7528\u7684\u4ea4\u4e92\u5f0f shell URI\uff0c\u8acb\u5728\u9019\u4e9b\u8a66\u7528\u958b\u59cb\u5f8c\u518d\u6b21\u7372\u53d6\u4f5c\u696d\u4fe1\u606f\u3002\n\u4e0a\u8ff0\u793a\u4f8b\u986f\u793a\u4e86\u55ae\u526f\u672c\u8a13\u7df4\u7684\u9810\u671f\u8f38\u51fa\uff1a\u4e3b\u8a13\u7df4\u7bc0\u9ede\u7684\u4e00\u500b URI\u3002\u5982\u679c\u60a8\u8981\u57f7\u884c\u5206\u4f48\u5f0f\u8a13\u7df4\uff0c\u5247\u8f38\u51fa\u6703\u7232\u6bcf\u500b\u8a13\u7df4\u7bc0\u9ede\u5305\u542b\u4e00\u500b URI\uff08\u7531\u5de5\u4f5c\u5668\u6c60\u6a19\u8b58\uff09\u3002\n\u4f8b\u5982\uff0c\u5982\u679c\u4f5c\u696d\u64c1\u6709\u4e00\u500b\u5177\u6709\u4e00\u500b\u526f\u672c\u7684\u4e3b\u8981\u5de5\u4f5c\u5668\u6c60\u548c\u4e00\u500b\u5177\u6709\u5169\u500b\u526f\u672c\u7684\u8f14\u52a9\u5de5\u4f5c\u5668\u6c60\uff0c\u5247 `webAccessUris` \u5b57\u6bb5\u5982\u4e0b\u6240\u793a\uff1a\n```\n{\u00a0 \"workerpool0-0\": \"URI_FOR_PRIMARY\",\u00a0 \"workerpool1-0\": \"URI_FOR_FIRST_SECONDARY\",\u00a0 \"workerpool1-1\": \"URI_FOR_SECOND_SECONDARY\"}\n```\n## \u4f7f\u7528\u4ea4\u4e92\u5f0f shell\n\u5982\u9700\u5c07\u4ea4\u4e92\u5f0f shell \u7528\u65bc\u8a13\u7df4\u7bc0\u9ede\uff0c\u8acb\u5c0e\u822a\u5230\u60a8\u5728\u4e0a\u4e00\u90e8\u5206\u4e2d\u627e\u5230\u7684\u5176\u4e2d\u4e00\u500b URI\u3002Bash shell \u986f\u793a\u5728\u700f\u89bd\u5668\u4e2d\uff0c\u8b93\u60a8\u80fd\u5920\u8a2a\u554f Vertex AI \u5728\u5176\u4e2d\u904b\u884c\u8a13\u7df4\u4ee3\u78bc\u7684\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7d71\u3002\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u4e86\u60a8\u5728\u4f7f\u7528 shell \u6642\u9700\u8981\u8003\u616e\u7684\u4e00\u4e9b\u4e8b\u9805\uff0c\u4e26\u63d0\u4f9b\u4e86\u4e00\u4e9b\u53ef\u4ee5\u5728 shell \u4e2d\u4f7f\u7528\u7684\u76e3\u63a7\u5de5\u5177\u793a\u4f8b\u3002\n### \u9632\u6b62\u4f5c\u696d\u7d50\u675f\n\u7576 Vertex AI \u904b\u884c\u5b8c\u60a8\u7684\u4f5c\u696d\u6216\u8a66\u7528\u6642\uff0c\u60a8\u5c07\u7acb\u5373\u5931\u53bb\u5c0d\u4ea4\u4e92\u5f0f shell \u7684\u8a2a\u554f\u6b0a\u9650\u3002\u5982\u679c\u767c\u751f\u9019\u7a2e\u60c5\u6cc1\uff0c\u60a8\u53ef\u80fd\u6703\u770b\u5230\u6d88\u606f `command terminated with exit code 137` \uff0c\u6216\u8005 shell \u53ef\u80fd\u6703\u505c\u6b62\u97ff\u61c9\u3002\u5982\u679c\u60a8\u5728\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7d71\u4e2d\u5275\u5efa\u4e86\u4efb\u4f55\u6587\u4ef6\uff0c\u5247\u4f5c\u696d\u7d50\u675f\u5f8c\uff0c\u9019\u4e9b\u6587\u4ef6\u5c07\u4e0d\u6703\u4fdd\u7559\u3002\n\u5728\u67d0\u4e9b\u60c5\u6cc1\u4e0b\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u6545\u610f\u5ef6\u9577\u4f5c\u696d\u904b\u884c\u6642\u9593\uff0c\u4ee5\u4fbf\u4f7f\u7528\u4ea4\u4e92\u5f0f shell \u9032\u884c\u8abf\u8a66\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5c07\u5982\u4e0b\u6240\u793a\u7684\u4ee3\u78bc\u6dfb\u52a0\u5230\u8a13\u7df4\u4ee3\u78bc\u4e2d\uff0c\u4ee5\u4fbf\u8b93\u4f5c\u696d\u5728\u7570\u5e38\u767c\u751f\u5f8c\u81f3\u5c11\u7e7c\u7e8c\u904b\u884c\u4e00\u5c0f\u6642\uff1a\n```\nimport timeimport tracebacktry:\u00a0 \u00a0 # Replace with a function that runs your training code\u00a0 \u00a0 train_model()except Exception as e:\u00a0 \u00a0 traceback.print_exc()\u00a0 \u00a0 time.sleep(60 * 60) \u00a0# 1 hour\n```\n\u4f46\u8acb\u6ce8\u610f\uff0c\u53ea\u8981\u4f5c\u696d\u7e7c\u7e8c\u904b\u884c\uff0c\u60a8\u5c31\u9700\u8981\u652f\u4ed8 [Vertex AI \u8a13\u7df4\u8cbb\u7528](https://cloud.google.com/vertex-ai/pricing?hl=zh-cn) \u3002\n### \u6aa2\u67e5\u6b0a\u9650\u554f\u984c\n\u4ea4\u4e92\u5f0f Shell \u74b0\u5883\u4f7f\u7528 Vertex AI \u7528\u65bc\u904b\u884c\u8a13\u7df4\u4ee3\u78bc\u7684\u670d\u52d9\u8cec\u865f\u7684 [\u61c9\u7528\u9ed8\u8a8d\u6191\u64da (ADC)](https://cloud.google.com/docs/authentication?hl=zh-cn#adc) \u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u60a8\u53ef\u4ee5\u5728 shell \u4e2d\u904b\u884c `gcloud auth list` \u3002\n\u5728 shell \u4e2d\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 [gsutil](https://cloud.google.com/storage/docs/gsutil?hl=zh-cn) \u3001 [bq](https://cloud.google.com/bigquery/docs/bq-command-line-tool?hl=zh-cn) \u548c\u5176\u4ed6\u652f\u6301 ADC \u7684\u5de5\u5177\u3002\u9019\u53ef\u4ee5\u5e6b\u52a9\u60a8\u9a57\u8b49\u4f5c\u696d\u662f\u5426\u80fd\u5920\u8a2a\u554f\u8a13\u7df4\u4ee3\u78bc\u6240\u9700\u7684\u7279\u5b9a Cloud Storage \u5b58\u5132\u6876\u3001BigQuery \u8868\u6216\u5176\u4ed6 Google Cloud \u8cc7\u6e90\u3002\n### \u4f7f\u7528 py-spy \u76f4\u89c0\u5448\u73fe Python \u7684\u57f7\u884c\n\u901a\u904e [py-spy](https://github.com/benfred/py-spy) \uff0c\u60a8\u53ef\u4ee5\u5256\u6790\u6b63\u5728\u57f7\u884c\u7684 Python \u7a0b\u5e8f\uff0c\u800c\u7121\u9700\u9032\u884c\u4fee\u6539\u3002\u5982\u9700\u5728\u4ea4\u4e92\u5f0f shell \u4e2d\u4f7f\u7528 `py-spy` \uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5b89\u88dd `py-spy` \uff1a```\npip3 install py-spy\n```\n- \u5728 shell \u4e2d\u904b\u884c `ps aux` \uff0c\u4e26\u67e5\u627e Python \u8a13\u7df4\u7a0b\u5e8f\u7684 PID\u3002\n- \u4f7f\u7528\u60a8\u5728\u4e0a\u4e00\u6b65\u4e2d\u627e\u5230\u7684 PID \u904b\u884c [py-spy \u6587\u6a94](https://github.com/benfred/py-spy) \u4e2d\u63cf\u8ff0\u7684\u4efb\u4f55\u5b50\u547d\u4ee4\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528 `py-spy record` \u5275\u5efa SVG \u6587\u4ef6\uff0c\u8acb\u5c07\u6b64\u6587\u4ef6\u8907\u88fd\u5230 Cloud Storage \u5b58\u5132\u6876\uff0c\u4ee5\u4fbf\u7a0d\u5f8c\u5728\u672c\u5730\u8a08\u7b97\u6a5f\u4e0a\u67e5\u770b\u3002\u4f8b\u5982\uff1a```\ngsutil cp profile.svg gs://BUCKET\n```\u5c07 \u66ff\u63db\u7232\u60a8\u6709\u6b0a\u8a2a\u554f\u7684\u5b58\u5132\u6876\u7684\u540d\u7a31\u3002\n### \u4f7f\u7528 perf \u5206\u6790\u6027\u80fd\n[perf](https://perf.wiki.kernel.org/) \u53ef\u8b93\u60a8\u5206\u6790\u8a13\u7df4\u7bc0\u9ede\u7684\u6027\u80fd\u3002\u5982\u9700\u5b89\u88dd\u9069\u5408\u7bc0\u9ede Linux \u5167\u6838\u7684 `perf` \u7248\u672c\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\napt-get updateapt-get install -y linux-tools-genericrm /usr/bin/perfLINUX_TOOLS_VERSION=$(ls /usr/lib/linux-tools | tail -n 1)ln -s \"/usr/lib/linux-tools/${LINUX_TOOLS_VERSION}/perf\" /usr/bin/perf\n```\n\u4e4b\u5f8c\uff0c\u60a8\u53ef\u4ee5\u904b\u884c [perf \u6587\u6a94](https://perf.wiki.kernel.org/) \u4e2d\u4ecb\u7d39\u7684\u4efb\u610f\u5b50\u547d\u4ee4\u3002\n### \u6aa2\u7d22\u6709\u95dc GPU \u4f7f\u7528\u60c5\u6cc1\u7684\u4fe1\u606f\n\u5728\u5177\u6709 GPU \u7684\u7bc0\u9ede\u4e0a\u904b\u884c\u7684\u652f\u6301 GPU \u7684\u5bb9\u5668\u901a\u5e38\u9810\u88dd\u4e86\u5e7e\u500b\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u53ef\u4ee5\u5e6b\u52a9\u60a8\u76e3\u63a7 GPU \u4f7f\u7528\u60c5\u6cc1\u3002\u4f8b\u5982\uff1a\n- \u4f7f\u7528 [nvidia-smi](https://developer.nvidia.com/nvidia-system-management-interface) \u76e3\u63a7\u5404\u7a2e\u9032\u7a0b\u7684 GPU \u5229\u7528\u7387\u3002\n- \u4f7f\u7528 [nvprof](https://docs.nvidia.com/cuda/profiler-users-guide/index.html) \u6536\u96c6\u5404\u7a2e GPU \u5256\u6790\u4fe1\u606f\u3002\u7531\u65bc `nvprof` \u7121\u6cd5\u9644\u52a0\u5230\u73fe\u6709\u9032\u7a0b\uff0c\u56e0\u6b64\u60a8\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u8a72\u5de5\u5177\u5553\u52d5\u904b\u884c\u8a13\u7df4\u4ee3\u78bc\u7684\u5176\u4ed6\u9032\u7a0b\u3002\uff08\u9019\u610f\u5473\u7740\u60a8\u7684\u8a13\u7df4\u4ee3\u78bc\u5c07\u5728\u7bc0\u9ede\u4e0a\u904b\u884c\u5169\u6b21\u3002\uff09\u4f8b\u5982\uff1a```\nnvprof -o prof.nvvp python3 -m MODULE_NAME\n```\u5c07 \u66ff\u63db\u7232 [\u8a13\u7df4\u61c9\u7528\u7684\u5165\u53e3\u9ede\u6a21\u584a](https://cloud.google.com/vertex-ai/docs/training/create-python-pre-built-container?hl=zh-cn#python-modules) \u7684\u5b8c\u5168\u9650\u5b9a\u540d\u7a31\uff1b\u4f8b\u5982 `trainer.task` \u3002\u7136\u5f8c\u5c07\u8f38\u51fa\u6587\u4ef6\u8f49\u79fb\u5230 Cloud Storage \u5b58\u5132\u6876\uff0c\u4ee5\u4fbf\u7a0d\u5f8c\u5728\u672c\u5730\u8a08\u7b97\u6a5f\u4e0a\u9032\u884c\u5206\u6790\u3002\u4f8b\u5982\uff1a```\ngsutil cp prof.nvvp gs://BUCKET\n```\u5c07 \u66ff\u63db\u7232\u60a8\u6709\u6b0a\u8a2a\u554f\u7684\u5b58\u5132\u6876\u7684\u540d\u7a31\u3002\n- \u5982\u679c\u9047\u5230 GPU \u932f\u8aa4\uff08\u4e0d\u662f\u914d\u7f6e\u6216 Vertex AI \u554f\u984c\uff09\uff0c\u8acb\u4f7f\u7528 [nvidia-bug-report.sh](https://forums.developer.nvidia.com/t/if-you-have-a-problem-please-read-this-first/27131) \u5275\u5efa\u932f\u8aa4\u5831\u544a\u3002\u7136\u5f8c\u5c07\u5831\u544a\u8f49\u79fb\u5230 Cloud Storage \u5b58\u5132\u6876\uff0c\u4ee5\u4fbf\u7a0d\u5f8c\u5728\u672c\u5730\u8a08\u7b97\u6a5f\u4e0a\u5206\u6790\u6216\u5c07\u5176\u767c\u9001\u5230 NVIDIA\u3002\u4f8b\u5982\uff1a```\ngsutil cp nvidia-bug-report.log.gz gs://BUCKET\n```\u5c07 \u66ff\u63db\u7232\u60a8\u6709\u6b0a\u8a2a\u554f\u7684\u5b58\u5132\u6876\u7684\u540d\u7a31\u3002\n\u5982\u679c `bash` \u627e\u4e0d\u5230\u4e0a\u8ff0\u4efb\u4f55 NVIDIA \u547d\u4ee4\uff0c\u8acb\u5617\u8a66\u5c07 `/usr/local/nvidia/bin` \u548c `/usr/local/cuda/bin` \u6dfb\u52a0\u5230 shell \u7684 `PATH` \uff1a\n```\nexport PATH=\"/usr/local/nvidia/bin:/usr/local/cuda/bin:${PATH}\"\n```\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3\u5982\u4f55\u4f7f\u7528 [Vertex AI TensorBoard Profiler](https://cloud.google.com/vertex-ai/docs/training/tensorboard-profiler?hl=zh-cn) \u512a\u5316\u81ea\u5b9a\u7fa9\u8a13\u7df4\u4f5c\u696d\u7684\u6027\u80fd\u3002\n- \u8a73\u7d30\u77ad\u89e3 [Vertex AI \u5982\u4f55\u7de8\u6392\u81ea\u5b9a\u7fa9\u8a13\u7df4](https://cloud.google.com/vertex-ai/docs/training/understanding-training-service?hl=zh-cn) \u3002\n- \u77ad\u89e3 [\u8a13\u7df4\u4ee3\u78bc\u8981\u6c42](https://cloud.google.com/vertex-ai/docs/training/code-requirements?hl=zh-cn) \u3002", "guide": "Vertex AI"}