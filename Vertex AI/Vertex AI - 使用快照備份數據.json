{"title": "Vertex AI - \u4f7f\u7528\u5feb\u7167\u5099\u4efd\u6578\u64da", "url": "https://cloud.google.com/vertex-ai/docs/workbench/user-managed/backup-snapshot?hl=zh-cn", "abstract": "# Vertex AI - \u4f7f\u7528\u5feb\u7167\u5099\u4efd\u6578\u64da\n# \u4f7f\u7528\u5feb\u7167\u5099\u4efd\u6578\u64da\nVertex AI Workbench \u7528\u6236\u7ba1\u7406\u7684\u7b46\u8a18\u672c [\u5df2\u68c4\u7528](https://cloud.google.com/vertex-ai/docs/deprecations?hl=zh-cn) \u3002\u81ea 2025 \u5e74 1 \u6708 30 \u65e5\u8d77\uff0c\u6211\u5011\u5c07\u7d42\u6b62\u5c0d\u7528\u6236\u7ba1\u7406\u7684\u7b46\u8a18\u672c\u7684\u652f\u6301\uff0c\u4e26\u4e14\u5c07\u4e0d\u518d\u652f\u6301\u5275\u5efa\u7528\u6236\u7ba1\u7406\u7684\u7b46\u8a18\u672c\u5be6\u4f8b\u3002\u73fe\u6709\u5be6\u4f8b\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\uff0c\u4f46\u6211\u5011\u5c07\u4e0d\u518d\u63d0\u4f9b\u88dc\u4e01\u3001\u66f4\u65b0\u548c\u5347\u7d1a\u3002\u5982\u9700\u7e7c\u7e8c\u4f7f\u7528 Vertex AI Workbench\uff0c\u6211\u5011\u5efa\u8b70\u60a8 [\u5c07\u7528\u6236\u7ba1\u7406\u7684\u7b46\u8a18\u672c\u5be6\u4f8b\u9077\u79fb\u5230 Vertex AI Workbench \u5be6\u4f8b](https://cloud.google.com/vertex-ai/docs/workbench/user-managed/migrate-to-instances?hl=zh-cn) \u3002\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u901a\u904e\u5275\u5efa\u5feb\u7167\u4f86\u5099\u4efd\u5b58\u5132\u5728 Vertex AI Workbench \u7528\u6236\u7ba1\u7406\u7684\u7b46\u8a18\u672c\u5be6\u4f8b\u4e0a\u7684\u6578\u64da\u3002\n\u5be6\u4f8b\u4e0a\u7684\u6578\u64da\u5b58\u5132\u5728\u53ef\u7528\u5340\u7d1a [\u6c38\u4e45\u6027\u78c1\u76e4](https://cloud.google.com/compute/docs/disks?hl=zh-cn#disk-types) \u4e2d\u3002\u60a8\u53ef\u4ee5\u5275\u5efa\u4e26\u4f7f\u7528\u6b64\u78c1\u76e4\u7684\u5feb\u7167\u4f86\u5099\u4efd\u6578\u64da\uff0c\u5275\u5efa\u9031\u671f\u6027\u5099\u4efd\u8a08\u5283\uff0c\u4ee5\u53ca\u5c07\u6578\u64da\u6062\u5fa9\u5230\u65b0\u5be6\u4f8b\u3002\n", "content": "## \u5275\u5efa\u5feb\u7167\n\u5373\u4f7f\u78c1\u76e4\u5df2\u639b\u63a5\u5230\u4e86\u6b63\u5728\u904b\u884c\u7684\u5be6\u4f8b\u4e0a\uff0c\u60a8\u4e5f\u53ef\u4ee5\u7232\u9019\u4e9b\u78c1\u76e4\u5275\u5efa\u5feb\u7167\u3002\u5feb\u7167\u662f [\u5168\u7403\u6027\u8cc7\u6e90](https://cloud.google.com/compute/docs/regions-zones/global-regional-zonal-resources?hl=zh-cn#globalresources) \uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u4f7f\u7528\u5feb\u7167 [\u5c07\u6578\u64da\u6062\u5fa9\u5230](https://cloud.google.com/compute/docs/disks/restore-snapshot?hl=zh-cn) \u540c\u4e00\u9805\u76ee\u5167\u7684\u65b0\u78c1\u76e4\u6216\u5be6\u4f8b\u3002\u60a8\u9084\u53ef\u4ee5\u5728\u591a\u500b\u9805\u76ee\u4e4b\u9593 [\u5171\u4eab\u5feb\u7167](https://cloud.google.com/compute/docs/disks/create-snapshots?hl=zh-cn#sharing_snapshots) \u3002\n**\u6ce8\u610f** \uff1aJupyter \u7b46\u8a18\u672c\u6587\u4ef6\u5b58\u5132\u5728\u540d\u7232 `` `-data` \u7684\u78c1\u76e4\u4e2d\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **\u865b\u64ec\u6a5f\u5be6\u4f8b** \u9801\u9762\u3002 [   \u9032\u5165\u201c\u865b\u64ec\u6a5f\u5be6\u4f8b\u201d](https://console.cloud.google.com/compute/instances?walkthrough_id=compute--storage--back-up-persistent-disk&hl=zh-cn)  school \u5176\u9918\u6b65\u9a5f\u5c07\u81ea\u52d5\u986f\u793a\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u3002\n- \u9078\u64c7\u5305\u542b\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u9805\u76ee\u3002\n- \u5728 **\u540d\u7a31** \u5217\u4e2d\uff0c\u9ede\u64ca\u64c1\u6709\u8981\u5099\u4efd\u7684\u6c38\u4e45\u6027\u78c1\u76e4\u7684\u865b\u64ec\u6a5f\u7684\u540d\u7a31\u3002\n- \u5728\u90e8\u5206\uff1a- \u82e5\u8981\u5099\u4efd\u5553\u52d5\u78c1\u76e4\uff0c\u8acb\u5728 **\u5553\u52d5\u78c1\u76e4** \u90e8\u5206\u9ede\u64ca\u5553\u52d5\u78c1\u76e4\u7684 **\u540d\u7a31** \u3002\n- \u82e5\u8981\u5099\u4efd\u639b\u63a5\u7684\u6c38\u4e45\u6027\u78c1\u76e4\uff0c\u8acb\u5728 **\u984d\u5916\u78c1\u76e4** \u90e8\u5206\u9ede\u64ca\u639b\u63a5\u7684\u6c38\u4e45\u6027\u78c1\u76e4\u7684 **\u540d\u7a31** \u3002\n- \u9ede\u64ca\u3002\n- \u5728 **\u540d\u7a31** \u4e2d\uff0c\u8f38\u5165\u4e00\u500b\u552f\u4e00\u7684\u540d\u7a31\u4ee5\u5e6b\u52a9\u6a19\u8b58\u5feb\u7167\u7684\u7528\u9014\uff0c\u4f8b\u5982\uff1a- `boot-disk-snapshot`\n- `attached-persistent-disk-snapshot`\n- \u5728 **\u985e\u578b** \u4e2d\uff0c\u9ed8\u8a8d\u503c\u7232\u5e38\u898f\u5feb\u7167\uff0c\u6700\u9069\u5408\u9577\u671f\u5099\u4efd\u548c\u707d\u96e3\u6062\u5fa9\u3002\u9078\u64c7 **\u6b78\u6a94\u5feb\u7167** \uff0c\u5be6\u73fe\u66f4\u7d93\u6fdf\u9ad8\u6548\u7684\u6578\u64da\u4fdd\u7559\u3002\n- \u5728 **\u4f4d\u7f6e** \u90e8\u5206\uff0c [\u9078\u64c7\u5feb\u7167\u5b58\u5132\u4f4d\u7f6e](https://cloud.google.com/compute/docs/disks/snapshots?hl=zh-cn#selecting_a_storage_location) \u3002\u7cfb\u7d71\u6703\u81ea\u52d5\u9078\u64c7\u5feb\u7167\u8a2d\u7f6e\u4e2d\u5b9a\u7fa9\u7684\u9810\u5b9a\u7fa9\u6216\u81ea\u5b9a\u7fa9\u9ed8\u8a8d\u4f4d\u7f6e\u3002\uff08\u53ef\u9078\uff09\u60a8\u53ef\u4ee5\u901a\u904e\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u4f86\u66ff\u63db\u5feb\u7167\u8a2d\u7f6e\u4e26\u5c07\u5feb\u7167\u5b58\u5132\u5728\u81ea\u5b9a\u7fa9\u5b58\u5132\u4f4d\u7f6e\uff1a- \u9078\u64c7\u5feb\u7167\u7684\u5b58\u5132\u4f4d\u7f6e\u985e\u578b\u3002- \u9078\u64c7 **\u591a\u5340\u57df** \uff0c\u8a72\u9078\u9805\u4ee5\u66f4\u9ad8\u7684\u8cbb\u7528\u5be6\u73fe\u66f4\u9ad8\u7684\u53ef\u7528\u6027\u3002\n- \u9078\u64c7 **\u5340\u57df\u7d1a\u5feb\u7167** \uff0c\u8a72\u9078\u9805\u4f7f\u60a8\u80fd\u5920\u66f4\u597d\u5730\u63a7\u5236\u6578\u64da\u7684\u5be6\u969b\u4f4d\u7f6e\uff0c\u4e26\u4e14\u8cbb\u7528\u4e5f\u6703\u66f4\u4f4e\u3002\n- \u5728 **\u9078\u64c7\u4f4d\u7f6e** \u5b57\u6bb5\u4e2d\uff0c\u9078\u64c7\u8981\u4f7f\u7528\u7684\u5177\u9ad4\u5340\u57df\u6216\u591a\u5340\u57df\u3002\u5982\u9700\u4f7f\u7528\u6700\u9760\u8fd1\u6e90\u78c1\u76e4\u7684\u5340\u57df\u6216\u591a\u5340\u57df\uff0c\u8acb\u9078\u64c7 **\u57fa\u65bc\u78c1\u76e4\u7684\u4f4d\u7f6e** \u3002- \u5982\u9700\u5275\u5efa\u624b\u52d5\u5feb\u7167\uff0c\u8acb\u9ede\u64ca **\u5275\u5efa** \u3002 - Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u6fc0\u6d3b Cloud Shell\u3002 [\u6fc0\u6d3b Cloud Shell](https://console.cloud.google.com/?cloudshell=true&hl=zh-cn)  [Cloud Shell](https://cloud.google.com/shell/docs/how-cloud-shell-works?hl=zh-cn) \u6703\u8a71\u96a8\u5373\u6703\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5e95\u90e8\u5553\u52d5\uff0c\u4e26\u986f\u793a\u547d\u4ee4\u884c\u63d0\u793a\u7b26\u3002Cloud Shell \u662f\u4e00\u500b\u5df2\u5b89\u88dd Google Cloud CLI \u4e14\u5df2\u7232\u7576\u524d\u9805\u76ee\u8a2d\u7f6e\u503c\u7684 Shell \u74b0\u5883\u3002\u8a72\u6703\u8a71\u53ef\u80fd\u9700\u8981\u5e7e\u79d2\u9418\u6642\u9593\u4f86\u5b8c\u6210\u521d\u59cb\u5316\u3002\n- \u4f7f\u7528 [\u5feb\u7167\u8a2d\u7f6e](https://cloud.google.com/compute/docs/disks/snapshot-settings?hl=zh-cn) \u5b9a\u7fa9\u7684\u5b58\u5132\u4f4d\u7f6e\u653f\u7b56\u6216\u4f7f\u7528\u60a8\u9078\u64c7\u7684\u5176\u4ed6\u5b58\u5132\u4f4d\u7f6e\u5275\u5efa\u5feb\u7167\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u9078\u64c7\u5feb\u7167\u5b58\u5132\u4f4d\u7f6e](https://cloud.google.com/compute/docs/disks/snapshots?hl=zh-cn#selecting_a_storage_location) \u3002 \u60a8\u5fc5\u9808\u6307\u5b9a\u5feb\u7167\u540d\u7a31\u3002\u540d\u7a31\u7684\u9577\u5ea6\u5fc5\u9808\u7232 1-63 \u500b\u5b57\u7b26\uff0c\u4e26\u4e14\u7b26\u5408 [RFC 1035](https://www.ietf.org/rfc/rfc1035.txt) \u7684\u8981\u6c42\u3002- \u5982\u9700\u5728\u5feb\u7167\u8a2d\u7f6e\u4e2d\u914d\u7f6e\u7684\u9810\u5b9a\u7fa9\u6216\u81ea\u5b9a\u7fa9\u9ed8\u8a8d\u4f4d\u7f6e\u5275\u5efa Persistent Disk \u5377\u7684\u5feb\u7167\uff0c\u8acb\u4f7f\u7528 [gcloud compute snapshots create \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/snapshots/create?hl=zh-cn) \u3002```\ngcloud compute snapshots create SNAPSHOT_NAME \\\n --source-disk SOURCE_DISK \\\n --snapshot-type SNAPSHOT_TYPE \\\n --source-disk-zone SOURCE_DISK_ZONE\n```\n- \u6216\u8005\uff0c\u5982\u9700\u66ff\u63db\u5feb\u7167\u8a2d\u7f6e\u4e26\u5728\u81ea\u5b9a\u7fa9\u5b58\u5132\u4f4d\u7f6e\u5275\u5efa\u5feb\u7167\uff0c\u8acb\u6dfb\u52a0 `--storage-location` \u6a19\u8a8c\u4ee5\u6307\u5b9a\u5feb\u7167\u7684\u5b58\u5132\u4f4d\u7f6e\uff1a```\ngcloud compute snapshots create SNAPSHOT_NAME \\\n --source-disk SOURCE_DISK \\\n --source-disk-zone SOURCE_DISK_ZONE \\\n --storage-location STORAGE_LOCATION \\\n --snapshot-type SNAPSHOT_TYPE\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1a\u5feb\u7167\u7684\u540d\u7a31\u3002\n- \uff1a\u53ef\u7528\u5340\u7d1a\u6c38\u4e45\u6027\u78c1\u76e4\u5377\u7684\u540d\u7a31\uff0c\u60a8\u5c07\u6839\u64da\u5b83\u5275\u5efa\u5feb\u7167\u3002\n- \uff1a\u5feb\u7167\u985e\u578b\uff1a **STANDARD** \u6216 **ARCHIVE** \u3002\u5982\u679c\u672a\u6307\u5b9a\u5feb\u7167\u985e\u578b\uff0c\u7cfb\u7d71\u6703\u5275\u5efa **STANDARD** \u5feb\u7167\u3002 \u9078\u64c7\u6b78\u6a94\uff0c\u5be6\u73fe\u66f4\u7d93\u6fdf\u9ad8\u6548\u7684\u6578\u64da\u4fdd\u7559\u3002\n- \uff1a\u53ef\u7528\u5340\u7d1a\u6c38\u4e45\u6027\u78c1\u76e4\u5377\u7684\u53ef\u7528\u5340\uff0c\u60a8\u5c07\u6839\u64da\u8a72\u5377\u5275\u5efa\u5feb\u7167\u3002\n- \uff1a\u5c0d\u65bc\u81ea\u5b9a\u7fa9\u5b58\u5132\u4f4d\u7f6e\uff0c\u9019\u662f\u60a8\u8981\u5b58\u5132\u5feb\u7167\u7684 [Cloud Storage \u591a\u5340\u57df](https://cloud.google.com/storage/docs/bucket-locations?hl=zh-cn#location-mr) \u6216 [Cloud Storage \u5340\u57df](https://cloud.google.com/storage/docs/bucket-locations?hl=zh-cn#location-r) \u3002\u8acb\u6ce8\u610f\uff0c\u60a8\u53ea\u80fd\u6307\u5b9a\u4e00\u500b\u5b58\u5132\u4f4d\u7f6e\u3002\n\u53ea\u6709\u5728\u60a8\u60f3\u8981\u66ff\u63db\u5728\u5feb\u7167\u8a2d\u7f6e\u4e2d\u914d\u7f6e\u7684\u9810\u5b9a\u7fa9\u6216\u81ea\u5b9a\u7fa9\u9ed8\u8a8d\u5b58\u5132\u4f4d\u7f6e\u6642\uff0c\u624d\u61c9\u4f7f\u7528 `--storage-location` \u6a19\u8a8c\u3002\ngcloud CLI \u6703\u7b49\u5f85\u64cd\u4f5c\u8fd4\u56de `READY` \u6216 `FAILED` \u72c0\u614b\uff0c\u6216\u9054\u5230\u8d85\u6642\u6642\u9593\u4e0a\u9650\u4e26\u8fd4\u56de\u5feb\u7167\u7684\u6700\u5f8c\u5df2\u77e5\u8a73\u60c5\u3002 **\u6ce8\u610f\uff1a** Google \u5efa\u8b70\u4f7f\u7528 [gcloud compute snapshots create \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/snapshots/create?hl=zh-cn) \uff08\u800c\u4e0d\u662f [gcloud compute disks snapshot \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/disks/snapshot?hl=zh-cn) \uff09\uff0c\u56e0\u7232\u5b83\u652f\u6301\u66f4\u591a\u529f\u80fd\uff0c\u4f8b\u5982\u5728\u4e0d\u540c\u65bc\u4f86\u6e90\u78c1\u76e4\u9805\u76ee\u7684\u9805\u76ee\u4e2d\u5275\u5efa\u5feb\u7167\u3002\n\u5982\u9700\u5275\u5efa\u53ef\u7528\u5340\u6c38\u4e45\u6027\u78c1\u76e4\u7684\u5feb\u7167\uff0c\u8acb\u4f7f\u7528 [google_compute_snapshot](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_snapshot) \u8cc7\u6e90\u3002\n [  compute/disk/main.tf ](https://github.com/terraform-google-modules/terraform-docs-samples/blob/HEAD/compute/disk/main.tf) [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/terraform-google-modules/terraform-docs-samples/blob/HEAD/compute/disk/main.tf) \n```\nresource \"google_compute_snapshot\" \"snapdisk\" {\n name  = \"snapshot-name\"\n source_disk = google_compute_disk.default.name\n zone  = \"us-central1-a\"\n}\n```\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u61c9\u7528\u6216\u79fb\u9664 Terraform \u914d\u7f6e\uff0c\u8acb\u53c3\u95b1 [\u57fa\u672c Terraform \u547d\u4ee4](https://cloud.google.com/docs/terraform/basic-commands?hl=zh-cn) \u3002\n\u4f7f\u7528 [\u5feb\u7167\u8a2d\u7f6e](https://cloud.google.com/compute/docs/disks/snapshot-settings?hl=zh-cn) \u5b9a\u7fa9\u7684\u5b58\u5132\u4f4d\u7f6e\u653f\u7b56\u6216\u4f7f\u7528\u60a8\u9078\u64c7\u7684\u5176\u4ed6\u5b58\u5132\u4f4d\u7f6e\u5275\u5efa\u5feb\u7167\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u9078\u64c7\u5feb\u7167\u5b58\u5132\u4f4d\u7f6e](https://cloud.google.com/compute/docs/disks/snapshots?hl=zh-cn#selecting_a_storage_location) \u3002- \u5982\u9700\u5728\u5feb\u7167\u8a2d\u7f6e\u4e2d\u914d\u7f6e\u7684\u9810\u5b9a\u7fa9\u6216\u81ea\u5b9a\u7fa9\u9ed8\u8a8d\u4f4d\u7f6e\u5275\u5efa\u5feb\u7167\uff0c\u8acb\u5411 [snapshots.insert \u65b9\u6cd5](https://cloud.google.com/compute/docs/reference/rest/v1/snapshots/insert?hl=zh-cn) \u767c\u51fa `POST` \u8acb\u6c42\uff1a```\nPOST https://compute.googleapis.com/compute/v1/projects/DESTINATION_PROJECT_ID/global/snapshots{\u00a0 \"name\": SNAPSHOT_NAME\u00a0 \"sourceDisk\": \"projects/SOURCE_PROJECT_ID/zones/SOURCE_ZONE/disks/SOURCE_DISK_NAME\u00a0 \"snapshotType\": SNAPSHOT_TYPE}\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1a\u60a8\u8981\u5728\u5176\u4e2d\u5275\u5efa\u5feb\u7167\u7684\u9805\u76ee\u7684 ID\u3002\n- \uff1a\u5feb\u7167\u7684\u540d\u7a31\u3002\n- \uff1a\u4f86\u6e90\u78c1\u76e4\u9805\u76ee\u7684 ID\u3002\n- \uff1a\u4f86\u6e90\u78c1\u76e4\u7684\u53ef\u7528\u5340\u3002\n- \uff1a\u8981\u5f9e\u4e2d\u5275\u5efa\u5feb\u7167\u7684\u6c38\u4e45\u6027\u78c1\u76e4\u7684\u540d\u7a31\u3002\n- \uff1a\u5feb\u7167\u985e\u578b\uff1a **STANDARD** \u6216 **ARCHIVE** \u3002\u5982\u679c\u672a\u6307\u5b9a\u5feb\u7167\u985e\u578b\uff0c\u7cfb\u7d71\u6703\u5275\u5efa **STANDARD** \u5feb\u7167\u3002\n- \u6216\u8005\uff0c\u5982\u9700\u66ff\u63db\u5feb\u7167\u8a2d\u7f6e\u4e26\u5728\u81ea\u5b9a\u7fa9\u5b58\u5132\u4f4d\u7f6e\u5275\u5efa\u5feb\u7167\uff0c\u8acb\u5411 [snapshots.insert \u65b9\u6cd5](https://cloud.google.com/compute/docs/reference/rest/v1/snapshots/insert?hl=zh-cn) \u767c\u51fa `POST` \u8acb\u6c42\uff0c\u4e26\u5728\u8acb\u6c42\u4e2d\u6dfb\u52a0 `storageLocations` \u5c6c\u6027\uff1a```\nPOST https://compute.googleapis.com/compute/v1/projects/DESTINATION_PROJECT_ID/global/snapshots{\u00a0 \"name\": SNAPSHOT_NAME\u00a0 \"sourceDisk\": \"projects/SOURCE_PROJECT_ID/zones/SOURCE_ZONE/disks/SOURCE_DISK_NAME\u00a0 \"snapshotType\": SNAPSHOT_TYPE\u00a0 \"storageLocations\": STORAGE_LOCATION}\n```\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1a\u60a8\u8981\u5728\u5176\u4e2d\u5275\u5efa\u5feb\u7167\u7684\u9805\u76ee\u7684 ID\u3002\n- \uff1a\u5feb\u7167\u7684\u540d\u7a31\u3002\n- \uff1a\u4f86\u6e90\u78c1\u76e4\u9805\u76ee\u7684 ID\u3002\n- \uff1a\u4f86\u6e90\u78c1\u76e4\u7684\u53ef\u7528\u5340\u3002\n- \uff1a\u8981\u5f9e\u4e2d\u5275\u5efa\u5feb\u7167\u7684\u6c38\u4e45\u6027\u78c1\u76e4\u7684\u540d\u7a31\u3002\n- \uff1a\u5feb\u7167\u985e\u578b\uff1a **STANDARD** \u6216 **ARCHIVE** \u3002\u5982\u679c\u672a\u6307\u5b9a\u5feb\u7167\u985e\u578b\uff0c\u7cfb\u7d71\u6703\u5275\u5efa **STANDARD** \u5feb\u7167\u3002\n- \uff1a\u60a8\u8981\u5b58\u5132\u5feb\u7167\u7684 [Cloud Storage \u591a\u5340\u57df](https://cloud.google.com/storage/docs/bucket-locations?hl=zh-cn#location-mr) \u6216 [Cloud Storage \u5340\u57df](https://cloud.google.com/storage/docs/bucket-locations?hl=zh-cn#location-r) \u3002\u8acb\u6ce8\u610f\uff0c\u60a8\u53ea\u80fd\u6307\u5b9a\u4e00\u500b\u5b58\u5132\u4f4d\u7f6e\u3002\u50c5\u7576\u60a8\u60f3\u8981\u66ff\u63db\u5feb\u7167\u8a2d\u7f6e\u4e2d\u914d\u7f6e\u7684\u9810\u5b9a\u7fa9\u6216\u81ea\u5b9a\u7fa9\u9ed8\u8a8d\u5b58\u5132\u4f4d\u7f6e\u6642\uff0c\u624d\u61c9\u4f7f\u7528 `storageLocations` \u53c3\u6578\u3002 **\u6ce8\u610f\uff1a** Google \u5efa\u8b70\u4f7f\u7528 [snapshots.insert \u65b9\u6cd5](https://cloud.google.com/compute/docs/reference/rest/v1/snapshots/insert?hl=zh-cn) \uff08\u800c\u4e0d\u662f [disks.createSnapshot \u65b9\u6cd5](https://cloud.google.com/compute/docs/reference/rest/v1/disks/createSnapshot?hl=zh-cn) \uff09\uff0c\u56e0\u7232\u5b83\u652f\u6301\u66f4\u591a\u529f\u80fd\uff0c\u4f8b\u5982\u5728\u4e0d\u540c\u65bc\u4f86\u6e90\u78c1\u76e4\u9805\u76ee\u7684\u9805\u76ee\u4e2d\u5275\u5efa\u5feb\u7167\u3002### Go\n\u8a66\u7528\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167\n [Compute Engine \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab](https://cloud.google.com/compute/docs/api/libraries?hl=zh-cn) \n\u4e2d\u7684\u8a2d\u7f6e\u8aaa\u660e\u9032\u884c\u64cd\u4f5c\u3002\n\u5982\u9700\u5411 Compute Engine \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/golang-samples/blob/HEAD/compute/snapshots/create_snapshot.go) \n```\nimport (\u00a0 \u00a0 \u00a0 \u00a0 \"context\"\u00a0 \u00a0 \u00a0 \u00a0 \"fmt\"\u00a0 \u00a0 \u00a0 \u00a0 \"io\"\u00a0 \u00a0 \u00a0 \u00a0 compute \"cloud.google.com/go/compute/apiv1\"\u00a0 \u00a0 \u00a0 \u00a0 computepb \"google.golang.org/genproto/googleapis/cloud/compute/v1\"\u00a0 \u00a0 \u00a0 \u00a0 \"google.golang.org/protobuf/proto\")// createSnapshot creates a snapshot of a disk.func createSnapshot(\u00a0 \u00a0 \u00a0 \u00a0 w io.Writer,\u00a0 \u00a0 \u00a0 \u00a0 projectID, diskName, snapshotName, zone, region, location, diskProjectID string,) error {\u00a0 \u00a0 \u00a0 \u00a0 // projectID := \"your_project_id\"\u00a0 \u00a0 \u00a0 \u00a0 // diskName := \"your_disk_name\"\u00a0 \u00a0 \u00a0 \u00a0 // snapshotName := \"your_snapshot_name\"\u00a0 \u00a0 \u00a0 \u00a0 // zone := \"europe-central2-b\"\u00a0 \u00a0 \u00a0 \u00a0 // region := \"eupore-central2\"\u00a0 \u00a0 \u00a0 \u00a0 // location = \"eupore-central2\"\u00a0 \u00a0 \u00a0 \u00a0 // diskProjectID = \"YOUR_DISK_PROJECT_ID\"\u00a0 \u00a0 \u00a0 \u00a0 ctx := context.Background()\u00a0 \u00a0 \u00a0 \u00a0 snapshotsClient, err := compute.NewSnapshotsRESTClient(ctx)\u00a0 \u00a0 \u00a0 \u00a0 if err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"NewSnapshotsRESTClient: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 defer snapshotsClient.Close()\u00a0 \u00a0 \u00a0 \u00a0 if zone == \"\" && region == \"\" {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"you need to specify `zone` or `region` for this function to work\")\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 if zone != \"\" && region != \"\" {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"you can't set both `zone` and `region` parameters\")\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 if diskProjectID == \"\" {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 diskProjectID = projectID\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 disk := &computepb.Disk{}\u00a0 \u00a0 \u00a0 \u00a0 locations := []string{}\u00a0 \u00a0 \u00a0 \u00a0 if location != \"\" {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 locations = append(locations, location)\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 if zone != \"\" {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 disksClient, err := compute.NewDisksRESTClient(ctx)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"NewDisksRESTClient: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 defer disksClient.Close()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 getDiskReq := &computepb.GetDiskRequest{\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Project: projectID,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Zone: \u00a0 \u00a0zone,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Disk: \u00a0 \u00a0diskName,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 disk, err = disksClient.Get(ctx, getDiskReq)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"unable to get disk: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 } else {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 regionDisksClient, err := compute.NewRegionDisksRESTClient(ctx)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"NewRegionDisksRESTClient: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 defer regionDisksClient.Close()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 getDiskReq := &computepb.GetRegionDiskRequest{\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Project: projectID,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Region: \u00a0region,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Disk: \u00a0 \u00a0diskName,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 disk, err = regionDisksClient.Get(ctx, getDiskReq)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"unable to get disk: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 req := &computepb.InsertSnapshotRequest{\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Project: projectID,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 SnapshotResource: &computepb.Snapshot{\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Name: \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 proto.String(snapshotName),\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 SourceDisk: \u00a0 \u00a0 \u00a0 proto.String(disk.GetSelfLink()),\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 StorageLocations: locations,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 op, err := snapshotsClient.Insert(ctx, req)\u00a0 \u00a0 \u00a0 \u00a0 if err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"unable to create snapshot: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 if err = op.Wait(ctx); err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"unable to wait for the operation: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 fmt.Fprintf(w, \"Snapshot created\\n\")\u00a0 \u00a0 \u00a0 \u00a0 return nil}\n```\n### Java\n\u8a66\u7528\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167\n [Compute Engine \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab](https://cloud.google.com/compute/docs/api/libraries?hl=zh-cn) \n\u4e2d\u7684\u8a2d\u7f6e\u8aaa\u660e\u9032\u884c\u64cd\u4f5c\u3002\n\u5982\u9700\u5411 Compute Engine \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/compute/cloud-client/src/main/java/compute/disks/CreateSnapshot.java) \n```\nimport com.google.cloud.compute.v1.Disk;import com.google.cloud.compute.v1.DisksClient;import com.google.cloud.compute.v1.Operation;import com.google.cloud.compute.v1.RegionDisksClient;import com.google.cloud.compute.v1.Snapshot;import com.google.cloud.compute.v1.SnapshotsClient;import java.io.IOException;import java.util.concurrent.ExecutionException;import java.util.concurrent.TimeUnit;import java.util.concurrent.TimeoutException;public class CreateSnapshot {\u00a0 public static void main(String[] args)\u00a0 \u00a0 \u00a0 throws IOException, ExecutionException, InterruptedException, TimeoutException {\u00a0 \u00a0 // TODO(developer): Replace these variables before running the sample.\u00a0 \u00a0 // You need to pass `zone` or `region` parameter relevant to the disk you want to\u00a0 \u00a0 // snapshot, but not both. Pass `zone` parameter for zonal disks and `region` for\u00a0 \u00a0 // regional disks.\u00a0 \u00a0 // Project ID or project number of the Cloud project you want to use.\u00a0 \u00a0 String projectId = \"YOUR_PROJECT_ID\";\u00a0 \u00a0 // Name of the disk you want to create.\u00a0 \u00a0 String diskName = \"YOUR_DISK_NAME\";\u00a0 \u00a0 // Name of the snapshot that you want to create.\u00a0 \u00a0 String snapshotName = \"YOUR_SNAPSHOT_NAME\";\u00a0 \u00a0 // The zone of the source disk from which you create the snapshot (for zonal disks).\u00a0 \u00a0 String zone = \"europe-central2-b\";\u00a0 \u00a0 // The region of the source disk from which you create the snapshot (for regional disks).\u00a0 \u00a0 String region = \"your-disk-region\";\u00a0 \u00a0 // The Cloud Storage multi-region or the Cloud Storage region where you\u00a0 \u00a0 // want to store your snapshot.\u00a0 \u00a0 // You can specify only one storage location. Available locations:\u00a0 \u00a0 // https://cloud.google.com/storage/docs/locations#available-locations\u00a0 \u00a0 String location = \"europe-central2\";\u00a0 \u00a0 // Project ID or project number of the Cloud project that\u00a0 \u00a0 // hosts the disk you want to snapshot. If not provided, the value will be defaulted\u00a0 \u00a0 // to 'projectId' value.\u00a0 \u00a0 String diskProjectId = \"YOUR_DISK_PROJECT_ID\";\u00a0 \u00a0 createSnapshot(projectId, diskName, snapshotName, zone, region, location, diskProjectId);\u00a0 }\u00a0 // Creates a snapshot of a disk.\u00a0 public static void createSnapshot(String projectId, String diskName, String snapshotName,\u00a0 \u00a0 \u00a0 String zone, String region, String location, String diskProjectId)\u00a0 \u00a0 \u00a0 throws IOException, ExecutionException, InterruptedException, TimeoutException {\u00a0 \u00a0 // Initialize client that will be used to send requests. This client only needs to be created\u00a0 \u00a0 // once, and can be reused for multiple requests. After completing all of your requests, call\u00a0 \u00a0 // the `snapshotsClient.close()` method on the client to safely\u00a0 \u00a0 // clean up any remaining background resources.\u00a0 \u00a0 try (SnapshotsClient snapshotsClient = SnapshotsClient.create()) {\u00a0 \u00a0 \u00a0 if (zone.isEmpty() && region.isEmpty()) {\u00a0 \u00a0 \u00a0 \u00a0 throw new Error(\"You need to specify 'zone' or 'region' for this function to work\");\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 if (!zone.isEmpty() && !region.isEmpty()) {\u00a0 \u00a0 \u00a0 \u00a0 throw new Error(\"You can't set both 'zone' and 'region' parameters\");\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 // If Disk's project id is not specified, then the projectId parameter will be used.\u00a0 \u00a0 \u00a0 if (diskProjectId.isEmpty()) {\u00a0 \u00a0 \u00a0 \u00a0 diskProjectId = projectId;\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 // If zone is not empty, use the DisksClient to create a disk.\u00a0 \u00a0 \u00a0 // Else, use the RegionDisksClient.\u00a0 \u00a0 \u00a0 Disk disk;\u00a0 \u00a0 \u00a0 if (!zone.isEmpty()) {\u00a0 \u00a0 \u00a0 \u00a0 DisksClient disksClient = DisksClient.create();\u00a0 \u00a0 \u00a0 \u00a0 disk = disksClient.get(projectId, zone, diskName);\u00a0 \u00a0 \u00a0 } else {\u00a0 \u00a0 \u00a0 \u00a0 RegionDisksClient regionDisksClient = RegionDisksClient.create();\u00a0 \u00a0 \u00a0 \u00a0 disk = regionDisksClient.get(diskProjectId, region, diskName);\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 // Set the snapshot properties.\u00a0 \u00a0 \u00a0 Snapshot snapshotResource;\u00a0 \u00a0 \u00a0 if (!location.isEmpty()) {\u00a0 \u00a0 \u00a0 \u00a0 snapshotResource = Snapshot.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setName(snapshotName)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setSourceDisk(disk.getSelfLink())\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .addStorageLocations(location)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 } else {\u00a0 \u00a0 \u00a0 \u00a0 snapshotResource = Snapshot.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setName(snapshotName)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setSourceDisk(disk.getSelfLink())\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 // Wait for the operation to complete.\u00a0 \u00a0 \u00a0 Operation operation = snapshotsClient.insertAsync(projectId, snapshotResource)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .get(3, TimeUnit.MINUTES);\u00a0 \u00a0 \u00a0 if (operation.hasError()) {\u00a0 \u00a0 \u00a0 \u00a0 System.out.println(\"Snapshot creation failed!\" + operation);\u00a0 \u00a0 \u00a0 \u00a0 return;\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 // Retrieve the created snapshot.\u00a0 \u00a0 \u00a0 Snapshot snapshot = snapshotsClient.get(projectId, snapshotName);\u00a0 \u00a0 \u00a0 System.out.printf(\"Snapshot created: %s\", snapshot.getName());\u00a0 \u00a0 }\u00a0 }}\n```\n### Node.js\n\u8a66\u7528\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167\n [Compute Engine \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab](https://cloud.google.com/compute/docs/api/libraries?hl=zh-cn) \n\u4e2d\u7684\u8a2d\u7f6e\u8aaa\u660e\u9032\u884c\u64cd\u4f5c\u3002\n\u5982\u9700\u5411 Compute Engine \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/nodejs-docs-samples/blob/HEAD/compute/snapshots/createSnapshot.js) \n```\n/**\u00a0* TODO(developer): Uncomment and replace these variables before running the sample.\u00a0*/// const projectId = 'YOUR_PROJECT_ID';// const diskName = 'YOUR_DISK_NAME';// const snapshotName = 'YOUR_SNAPSHOT_NAME';// const zone = 'europe-central2-b';// const region = '';// const location = 'europe-central2';// let diskProjectId = 'YOUR_DISK_PROJECT_ID';const compute = require('@google-cloud/compute');async function createSnapshot() {\u00a0 const snapshotsClient = new compute.SnapshotsClient();\u00a0 let disk;\u00a0 if (!zone && !region) {\u00a0 \u00a0 throw new Error(\u00a0 \u00a0 \u00a0 'You need to specify `zone` or `region` for this function to work.'\u00a0 \u00a0 );\u00a0 }\u00a0 if (zone && region) {\u00a0 \u00a0 throw new Error(\"You can't set both `zone` and `region` parameters\");\u00a0 }\u00a0 if (!diskProjectId) {\u00a0 \u00a0 diskProjectId = projectId;\u00a0 }\u00a0 if (zone) {\u00a0 \u00a0 const disksClient = new compute.DisksClient();\u00a0 \u00a0 [disk] = await disksClient.get({\u00a0 \u00a0 \u00a0 project: diskProjectId,\u00a0 \u00a0 \u00a0 zone,\u00a0 \u00a0 \u00a0 disk: diskName,\u00a0 \u00a0 });\u00a0 } else {\u00a0 \u00a0 const regionDisksClient = new compute.RegionDisksClient();\u00a0 \u00a0 [disk] = await regionDisksClient.get({\u00a0 \u00a0 \u00a0 project: diskProjectId,\u00a0 \u00a0 \u00a0 region,\u00a0 \u00a0 \u00a0 disk: diskName,\u00a0 \u00a0 });\u00a0 }\u00a0 const snapshotResource = {\u00a0 \u00a0 name: snapshotName,\u00a0 \u00a0 sourceDisk: disk.selfLink,\u00a0 };\u00a0 if (location) {\u00a0 \u00a0 snapshotResource.storageLocations = [location];\u00a0 }\u00a0 const [response] = await snapshotsClient.insert({\u00a0 \u00a0 project: projectId,\u00a0 \u00a0 snapshotResource,\u00a0 });\u00a0 let operation = response.latestResponse;\u00a0 const operationsClient = new compute.GlobalOperationsClient();\u00a0 // Wait for the create snapshot operation to complete.\u00a0 while (operation.status !== 'DONE') {\u00a0 \u00a0 [operation] = await operationsClient.wait({\u00a0 \u00a0 \u00a0 operation: operation.name,\u00a0 \u00a0 \u00a0 project: projectId,\u00a0 \u00a0 });\u00a0 }\u00a0 console.log('Snapshot created.');}createSnapshot();\n```\n### Python\n\u8a66\u7528\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167\n [Compute Engine \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab](https://cloud.google.com/compute/docs/api/libraries?hl=zh-cn) \n\u4e2d\u7684\u8a2d\u7f6e\u8aaa\u660e\u9032\u884c\u64cd\u4f5c\u3002\n\u5982\u9700\u5411 Compute Engine \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/python-docs-samples/blob/HEAD/compute/client_library/snippets/snapshots/create.py) \n```\nfrom __future__ import annotationsimport sysfrom typing import Anyfrom google.api_core.extended_operation import ExtendedOperationfrom google.cloud import compute_v1def wait_for_extended_operation(\u00a0 \u00a0 operation: ExtendedOperation, verbose_name: str = \"operation\", timeout: int = 300) -> Any:\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 Waits for the extended (long-running) operation to complete.\u00a0 \u00a0 If the operation is successful, it will return its result.\u00a0 \u00a0 If the operation ends with an error, an exception will be raised.\u00a0 \u00a0 If there were any warnings during the execution of the operation\u00a0 \u00a0 they will be printed to sys.stderr.\u00a0 \u00a0 Args:\u00a0 \u00a0 \u00a0 \u00a0 operation: a long-running operation you want to wait on.\u00a0 \u00a0 \u00a0 \u00a0 verbose_name: (optional) a more verbose name of the operation,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 used only during error and warning reporting.\u00a0 \u00a0 \u00a0 \u00a0 timeout: how long (in seconds) to wait for operation to finish.\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 If None, wait indefinitely.\u00a0 \u00a0 Returns:\u00a0 \u00a0 \u00a0 \u00a0 Whatever the operation.result() returns.\u00a0 \u00a0 Raises:\u00a0 \u00a0 \u00a0 \u00a0 This method will raise the exception received from `operation.exception()`\u00a0 \u00a0 \u00a0 \u00a0 or RuntimeError if there is no exception set, but there is an `error_code`\u00a0 \u00a0 \u00a0 \u00a0 set for the `operation`.\u00a0 \u00a0 \u00a0 \u00a0 In case of an operation taking longer than `timeout` seconds to complete,\u00a0 \u00a0 \u00a0 \u00a0 a `concurrent.futures.TimeoutError` will be raised.\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 result = operation.result(timeout=timeout)\u00a0 \u00a0 if operation.error_code:\u00a0 \u00a0 \u00a0 \u00a0 print(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 f\"Error during {verbose_name}: [Code: {operation.error_code}]: {operation.error_message}\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 file=sys.stderr,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 flush=True,\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 print(f\"Operation ID: {operation.name}\", file=sys.stderr, flush=True)\u00a0 \u00a0 \u00a0 \u00a0 raise operation.exception() or RuntimeError(operation.error_message)\u00a0 \u00a0 if operation.warnings:\u00a0 \u00a0 \u00a0 \u00a0 print(f\"Warnings during {verbose_name}:\\n\", file=sys.stderr, flush=True)\u00a0 \u00a0 \u00a0 \u00a0 for warning in operation.warnings:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 print(f\" - {warning.code}: {warning.message}\", file=sys.stderr, flush=True)\u00a0 \u00a0 return resultdef create_snapshot(\u00a0 \u00a0 project_id: str,\u00a0 \u00a0 disk_name: str,\u00a0 \u00a0 snapshot_name: str,\u00a0 \u00a0 *,\u00a0 \u00a0 zone: str | None = None,\u00a0 \u00a0 region: str | None = None,\u00a0 \u00a0 location: str | None = None,\u00a0 \u00a0 disk_project_id: str | None = None,) -> compute_v1.Snapshot:\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 Create a snapshot of a disk.\u00a0 \u00a0 You need to pass `zone` or `region` parameter relevant to the disk you want to\u00a0 \u00a0 snapshot, but not both. Pass `zone` parameter for zonal disks and `region` for\u00a0 \u00a0 regional disks.\u00a0 \u00a0 Args:\u00a0 \u00a0 \u00a0 \u00a0 project_id: project ID or project number of the Cloud project you want\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 to use to store the snapshot.\u00a0 \u00a0 \u00a0 \u00a0 disk_name: name of the disk you want to snapshot.\u00a0 \u00a0 \u00a0 \u00a0 snapshot_name: name of the snapshot to be created.\u00a0 \u00a0 \u00a0 \u00a0 zone: name of the zone in which is the disk you want to snapshot (for zonal disks).\u00a0 \u00a0 \u00a0 \u00a0 region: name of the region in which is the disk you want to snapshot (for regional disks).\u00a0 \u00a0 \u00a0 \u00a0 location: The Cloud Storage multi-region or the Cloud Storage region where you\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 want to store your snapshot.\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 You can specify only one storage location. Available locations:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 https://cloud.google.com/storage/docs/locations#available-locations\u00a0 \u00a0 \u00a0 \u00a0 disk_project_id: project ID or project number of the Cloud project that\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 hosts the disk you want to snapshot. If not provided, will look for\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 the disk in the `project_id` project.\u00a0 \u00a0 Returns:\u00a0 \u00a0 \u00a0 \u00a0 The new snapshot instance.\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 if zone is None and region is None:\u00a0 \u00a0 \u00a0 \u00a0 raise RuntimeError(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"You need to specify `zone` or `region` for this function to work.\"\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 if zone is not None and region is not None:\u00a0 \u00a0 \u00a0 \u00a0 raise RuntimeError(\"You can't set both `zone` and `region` parameters.\")\u00a0 \u00a0 if disk_project_id is None:\u00a0 \u00a0 \u00a0 \u00a0 disk_project_id = project_id\u00a0 \u00a0 if zone is not None:\u00a0 \u00a0 \u00a0 \u00a0 disk_client = compute_v1.DisksClient()\u00a0 \u00a0 \u00a0 \u00a0 disk = disk_client.get(project=disk_project_id, zone=zone, disk=disk_name)\u00a0 \u00a0 else:\u00a0 \u00a0 \u00a0 \u00a0 regio_disk_client = compute_v1.RegionDisksClient()\u00a0 \u00a0 \u00a0 \u00a0 disk = regio_disk_client.get(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 project=disk_project_id, region=region, disk=disk_name\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 snapshot = compute_v1.Snapshot()\u00a0 \u00a0 snapshot.source_disk = disk.self_link\u00a0 \u00a0 snapshot.name = snapshot_name\u00a0 \u00a0 if location:\u00a0 \u00a0 \u00a0 \u00a0 snapshot.storage_locations = [location]\u00a0 \u00a0 snapshot_client = compute_v1.SnapshotsClient()\u00a0 \u00a0 operation = snapshot_client.insert(project=project_id, snapshot_resource=snapshot)\u00a0 \u00a0 wait_for_extended_operation(operation, \"snapshot creation\")\u00a0 \u00a0 return snapshot_client.get(project=project_id, snapshot=snapshot_name)\n```\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u5617\u8a66\u5275\u5efa\u5feb\u7167\uff0c\u4f46\u5275\u5efa\u5feb\u7167\u7684\u904e\u7a0b\u5931\u6557\u4e86\uff0c\u90a3\u9ebc\u60a8\u5fc5\u9808\u5148\u6e05\u7406\u5931\u6557\u7684\u5feb\u7167\uff0c\u7136\u5f8c\u624d\u80fd\u522a\u9664\u539f\u59cb\u6c38\u4e45\u6027\u78c1\u76e4\u3002\u9019\u7a2e\u6545\u969c\u5b89\u5168\u6a5f\u5236\u6709\u52a9\u65bc\u9632\u6b62\u5728\u5099\u4efd\u5931\u6557\u7684\u60c5\u6cc1\u4e0b\u610f\u5916\u522a\u9664\u6e90\u6578\u64da\u3002\n## \u5b89\u6392\u9031\u671f\u6027\u5099\u4efd\n\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\u6642\uff0c\u60a8\u9700\u8981\u5275\u5efa\u4e00\u9805\u53ef\u61c9\u7528\u65bc\u4e00\u500b\u6216\u591a\u500b\u6c38\u4e45\u6027\u78c1\u76e4\u7684 [\u8cc7\u6e90\u653f\u7b56](https://cloud.google.com/compute/docs/reference/rest/v1/resourcePolicies?hl=zh-cn) \u3002\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u65b9\u5f0f\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\uff1a\n- [\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868](#create_schedule) \uff0c\u7136\u5f8c [\u5c07\u5176\u9644\u52a0\u5230\u73fe\u6709\u7684\u6c38\u4e45\u6027\u78c1\u76e4](#attach_schedule) \u3002\n- [\u4f7f\u7528\u5feb\u7167\u6642\u9593\u8868\u5275\u5efa\u65b0\u7684\u6c38\u4e45\u6027\u78c1\u76e4](https://cloud.google.com/compute/docs/disks/scheduled-snapshots?hl=zh-cn#create_disk_add_policy) \u3002\n\u5feb\u7167\u6642\u9593\u8868\u5305\u62ec\u4ee5\u4e0b\u5c6c\u6027\uff1a\n- \u6642\u9593\u8868\u540d\u7a31\n- \u6642\u9593\u8868\u8aaa\u660e\n- \u5feb\u7167\u983b\u7387\uff08\u6bcf\u5c0f\u6642\u3001\u6bcf\u5929\u3001\u6bcf\u9031\uff09\n- \u5feb\u7167\u958b\u59cb\u6642\u9593\n- \u5feb\u7167\u6642\u9593\u8868\u53ef\u7528\u5340\u57df\n- \u4f86\u6e90\u78c1\u76e4\u522a\u9664\u653f\u7b56\uff08\u7528\u65bc\u5728\u4f86\u6e90\u78c1\u76e4\u906d\u5230\u522a\u9664\u5f8c\u8655\u7406\u81ea\u52d5\u751f\u6210\u7684\u5feb\u7167\uff09\n- \u4fdd\u7559\u653f\u7b56\uff08\u7528\u65bc\u5b9a\u7fa9\u4fdd\u7559\u5feb\u7167\u6642\u9593\u8868\u6240\u7522\u751f\u5feb\u7167\u7684\u6642\u9593\u9577\u77ed\uff09\n### \u9650\u5236\n- \u4e00\u500b\u6c38\u4e45\u6027\u78c1\u76e4\u4e00\u6b21\u6700\u591a\u53ef\u4ee5\u639b\u63a5 10 \u500b\u5feb\u7167\u6642\u9593\u8868\u3002\n- \u60a8\u7121\u6cd5\u4f7f\u7528\u5feb\u7167\u6642\u9593\u8868\u5275\u5efa\u6b78\u6a94\u5feb\u7167\u3002\n- \u60a8\u6700\u591a\u53ef\u4ee5\u7232\u6bcf\u500b\u5340\u57df\u5275\u5efa 1000 \u500b\u4f7f\u7528\u4e2d\u7684\u5feb\u7167\u6642\u9593\u8868\u3002\n- \u5feb\u7167\u6642\u9593\u8868\u50c5\u9069\u7528\u65bc\u5275\u5efa\u5b83\u5011\u7684\u9805\u76ee\u3002\u5feb\u7167\u6642\u9593\u8868\u4e0d\u80fd\u5728\u5176\u4ed6\u9805\u76ee\u6216\u7d44\u7e54\u4e2d\u4f7f\u7528\u3002\n- \u5982\u679c\u60a8\u6240\u5728\u5340\u57df\u9700\u8981\u66f4\u591a\u8cc7\u6e90\uff0c\u5247\u53ef\u80fd\u9700\u8981\u901a\u904e\u63a7\u5236\u6aaf\u7533\u8acb\u589e\u52a0 [\u8cc7\u6e90\u914d\u984d](https://cloud.google.com/compute/quotas?hl=zh-cn) \u3002\n- \u5982\u679c\u5feb\u7167\u6642\u9593\u8868\u5df2\u639b\u63a5\u5230\u78c1\u76e4\uff0c\u4fbf\u7121\u6cd5\u88ab\u522a\u9664\u3002\u60a8\u5fc5\u9808\u5148\u5f9e\u6240\u6709\u78c1\u76e4\u4e2d [\u5206\u96e2\u6642\u9593\u8868](https://cloud.google.com/compute/docs/disks/scheduled-snapshots?hl=zh-cn#change_snapshot_schedule) \uff0c\u7136\u5f8c\u624d\u80fd\u522a\u9664\u6642\u9593\u8868\u3002\n- \u60a8\u53ef\u4ee5\u66f4\u65b0\u73fe\u6709\u5feb\u7167\u6642\u9593\u8868\uff0c\u4ee5\u66f4\u6539\u8aaa\u660e\u3001\u6642\u9593\u8868\u548c\u6a19\u7c64\u3002\u5982\u9700\u66f4\u65b0\u5feb\u7167\u6642\u9593\u8868\u7684\u5176\u4ed6\u503c\uff0c\u60a8\u5fc5\u9808\u522a\u9664\u8a72\u5feb\u7167\u6642\u9593\u8868\u4e26\u5275\u5efa\u65b0\u7684\u5feb\u7167\u6642\u9593\u8868\u3002\n- \u5c0d\u65bc\u4f7f\u7528 [\u5ba2\u6236\u63d0\u4f9b\u7684\u52a0\u5bc6\u5bc6\u9470 (CSEK)](https://cloud.google.com/security/encryption/customer-supplied-encryption-keys?hl=zh-cn) \u7684\u6c38\u4e45\u6027\u78c1\u76e4\uff0c\u60a8\u7121\u6cd5\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\u3002\n- \u5c0d\u65bc\u4f7f\u7528 [\u5ba2\u6236\u7ba1\u7406\u7684\u52a0\u5bc6\u5bc6\u9470 (CMEK)](https://cloud.google.com/kms/docs/cmek?hl=zh-cn) \u7684\u6c38\u4e45\u6027\u78c1\u76e4\uff0c\u4f7f\u7528\u5feb\u7167\u6642\u9593\u8868\u5275\u5efa\u7684\u6240\u6709\u5feb\u7167\u90fd\u5c07\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u9470\u81ea\u52d5\u52a0\u5bc6\u3002\n### \u5275\u5efa\u6642\u9593\u8868\n\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u3001Google Cloud CLI \u6216 Compute Engine API \u7232\u6c38\u4e45\u6027\u78c1\u76e4\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\u3002\u60a8\u5fc5\u9808\u5728\u6c38\u4e45\u6027\u78c1\u76e4\u6240\u5728\u7684\u540c\u4e00\u500b\u5340\u57df\u4e2d\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684\u6c38\u4e45\u6027\u78c1\u76e4\u4f4d\u65bc\u53ef\u7528\u5340 `us-west1-a` \u4e2d\uff0c\u5247\u5feb\u7167\u6642\u9593\u8868\u5fc5\u9808\u4f4d\u65bc `us-west1` \u5340\u57df\u4e2d\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u9078\u64c7\u5b58\u5132\u4f4d\u7f6e](https://cloud.google.com/compute/docs/disks/snapshots?hl=zh-cn#selecting_a_storage_location) \u3002\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u4f7f\u7528 gcloud CLI \u6216 Google Cloud \u63a7\u5236\u6aaf\uff0c\u5247\u5728\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\u6642\u5fc5\u9808\u59cb\u7d42\u8a2d\u7f6e\u4fdd\u7559\u653f\u7b56\u3002\u5982\u679c\u60a8\u76f4\u63a5\u5411 API \u767c\u51fa\u8acb\u6c42\uff0c\u5247\u53ef\u4ee5\u5ffd\u7565\u6b64\u5b57\u6bb5\uff0c\u7cfb\u7d71\u6703\u7121\u9650\u671f\u5730\u4fdd\u7559\u60a8\u7684\u5feb\u7167\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **\u865b\u64ec\u6a5f\u5be6\u4f8b** \u9801\u9762\u3002 [\u9032\u5165\u201c\u865b\u64ec\u6a5f\u5be6\u4f8b\u201d](https://console.cloud.google.com/compute/instances?walkthrough_id=compute--storage--create-snapshot-schedule&hl=zh-cn)  school \u5176\u9918\u6b65\u9a5f\u5c07\u81ea\u52d5\u986f\u793a\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u3002\n- \u9078\u64c7\u5305\u542b\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u9805\u76ee\u3002\n- \u5728 **\u540d\u7a31** \u5217\u4e2d\uff0c\u9ede\u64ca\u5305\u542b\u8981\u7232\u5176\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\u7684\u6c38\u4e45\u6027\u78c1\u76e4\u7684\u865b\u64ec\u6a5f\u3002\n- \u5728\u90e8\u5206\uff0c\u9ede\u64ca\u8981\u7232\u5176\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\u7684 **\u5553\u52d5\u78c1\u76e4** \u6216 **\u984d\u5916\u78c1\u76e4** \u7684\u540d\u7a31\u3002\n- \u9ede\u64caedit **\u4fee\u6539** \u3002\u60a8\u53ef\u80fd\u9700\u8981\u9ede\u64camore_vert **\u66f4\u591a\u64cd\u4f5c** \u83dc\u55ae\uff0c\u7136\u5f8c\u518d\u9ede\u64caedit **\u4fee\u6539** \u3002\n- \u5728 **\u5feb\u7167\u6642\u9593\u8868** \u4e2d\uff0c\u9078\u64c7 **\u5275\u5efa\u6642\u9593\u8868** \u3002\n- \u5728 **\u540d\u7a31** \u4e2d\uff0c\u7232\u5feb\u7167\u6642\u9593\u8868\u8f38\u5165\u4ee5\u4e0b\u540d\u7a31\u4e4b\u4e00\uff1a- `boot-disk-snapshot-schedule`\n- `attached-persistent-disk-snapshot-schedule`\n- \u5728 **\u4f4d\u7f6e** \u90e8\u5206\uff0c [\u9078\u64c7\u5feb\u7167\u5b58\u5132\u4f4d\u7f6e](https://cloud.google.com/compute/docs/disks/snapshots?hl=zh-cn#selecting_a_storage_location) \u3002\u7cfb\u7d71\u6703\u81ea\u52d5\u9078\u64c7\u5feb\u7167\u8a2d\u7f6e\u4e2d\u5b9a\u7fa9\u7684\u9810\u5b9a\u7fa9\u6216\u81ea\u5b9a\u7fa9\u9ed8\u8a8d\u4f4d\u7f6e\u3002\uff08\u53ef\u9078\uff09\u60a8\u53ef\u4ee5\u901a\u904e\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u4f86\u66ff\u63db\u5feb\u7167\u8a2d\u7f6e\u4e26\u5c07\u5feb\u7167\u5b58\u5132\u5728\u81ea\u5b9a\u7fa9\u5b58\u5132\u4f4d\u7f6e\uff1a- \u9078\u64c7\u5feb\u7167\u7684\u5b58\u5132\u4f4d\u7f6e\u985e\u578b\u3002- \u9078\u64c7 **\u591a\u5340\u57df** \uff0c\u8a72\u9078\u9805\u4ee5\u66f4\u9ad8\u7684\u8cbb\u7528\u5be6\u73fe\u66f4\u9ad8\u7684\u53ef\u7528\u6027\u3002\n- \u9078\u64c7 **\u5340\u57df\u7d1a\u5feb\u7167** \uff0c\u8a72\u9078\u9805\u4f7f\u60a8\u80fd\u5920\u66f4\u597d\u5730\u63a7\u5236\u6578\u64da\u7684\u5be6\u969b\u4f4d\u7f6e\uff0c\u4e26\u4e14\u8cbb\u7528\u4e5f\u6703\u66f4\u4f4e\u3002\n- \u5728 **\u9078\u64c7\u4f4d\u7f6e** \u5b57\u6bb5\u4e2d\uff0c\u9078\u64c7\u8981\u4f7f\u7528\u7684\u5177\u9ad4\u5340\u57df\u6216\u591a\u5340\u57df\u3002\u5982\u9700\u4f7f\u7528\u6700\u9760\u8fd1\u6e90\u78c1\u76e4\u7684\u5340\u57df\u6216\u591a\u5340\u57df\uff0c\u8acb\u9078\u64c7 **\u57fa\u65bc\u78c1\u76e4\u7684\u4f4d\u7f6e** \u3002- \u5982\u9700\u5b8c\u6210\u5feb\u7167\u6642\u9593\u8868\u7684\u5275\u5efa\uff0c\u8acb\u9ede\u64ca **\u5275\u5efa** \u3002\n- \u5982\u9700\u5c07\u6b64\u5feb\u7167\u6642\u9593\u8868\u639b\u63a5\u5230\u6c38\u4e45\u6027\u78c1\u76e4\uff0c\u8acb\u9ede\u64ca **\u4fdd\u5b58** \u3002\u5982\u9700\u7232\u6c38\u4e45\u6027\u78c1\u76e4\u5275\u5efa\u5feb\u7167\u6642\u9593\u8868\uff0c\u8acb\u4f7f\u7528 [compute resource-policies create snapshot-schedule](https://cloud.google.com/sdk/gcloud/reference/compute/resource-policies/create/snapshot-schedule?hl=zh-cn) `gcloud` \u547d\u4ee4\u3002\u4e26\u5c07\u6642\u9593\u8868\u983b\u7387\u8a2d\u7232\u6bcf\u5c0f\u6642\u3001\u6bcf\u5929\u6216\u6bcf\u9031\u3002\n```\n\u00a0 gcloud compute resource-policies create snapshot-schedule [SCHEDULE_NAME] \\\u00a0 \u00a0 \u00a0 --description \"[SCHEDULE_DESCRIPTION]\" \\\u00a0 \u00a0 \u00a0 --max-retention-days [MAX_RETENTION_DAYS] \\\u00a0 \u00a0 \u00a0 --start-time [START_TIME] \\\u00a0 \u00a0 \u00a0 --hourly-schedule [SNAPSHOT_INTERVAL] \\\u00a0 \u00a0 \u00a0 --daily-schedule \\\u00a0 \u00a0 \u00a0 --weekly-schedule [SNAPSHOT_INTERVAL] \\\u00a0 \u00a0 \u00a0 --weekly-schedule-from-file [FILE_NAME] \\\u00a0 \u00a0 \u00a0 --on-source-disk-delete [DELETION_OPTION]\n```\n\u5176\u4e2d\uff1a- `[SCHEDULE_NAME]`\u662f\u65b0\u5feb\u7167\u6642\u9593\u8868\u7684\u540d\u7a31\u3002\n- `\"[SCHEDULE_DESCRIPTION]\"`\u662f\u5feb\u7167\u6642\u9593\u8868\u7684\u8aaa\u660e\u3002\u8acb\u4f7f\u7528\u5f15\u865f\u5c07\u60a8\u7684\u8aaa\u660e\u62ec\u8d77\u4f86\u3002\n- `[MAX_RETENTION_DAYS]`\u662f\u4fdd\u7559\u5feb\u7167\u7684\u5929\u6578\u3002\u4f8b\u5982\uff0c\u8a2d\u7232`3`\u8868\u793a\u5feb\u7167\u5728\u522a\u9664\u4e4b\u524d\u6703\u4fdd\u7559 3 \u5929\u3002\u60a8\u5fc5\u9808\u5c07\u4fdd\u7559\u653f\u7b56\u8a2d\u7232\u81f3\u5c11 1 \u5929\u3002\n- `[START_TIME]`\u7232 UTC \u958b\u59cb\u6642\u9593\u3002\u6642\u9593\u5fc5\u9808\u5f9e\u6574\u9ede\u958b\u59cb\u3002\u4f8b\u5982\uff1a\n- \u592a\u5e73\u6d0b\u6a19\u6e96\u6642\u9593\u4e0b\u5348 2 \u9ede\u7232`22:00`\u3002\n- \u5982\u679c\u60a8\u5c07\u958b\u59cb\u6642\u9593\u8a2d\u7f6e\u7232`22:13`\uff0c\u5247\u6703\u6536\u5230\u932f\u8aa4\u6d88\u606f\u3002\n- `[SNAPSHOT_INTERVAL]` \u7528\u65bc\u5b9a\u7fa9\u622a\u53d6\u5feb\u7167\u7684\u6642\u9593\u9593\u9694\u3002\u8acb\u4f7f\u7528\u4ecb\u65bc 1 \u5230 23 \u7684\u6574\u6578\u8a2d\u7f6e\u6bcf\u5c0f\u6642\u6642\u9593\u8868\u3002\u540c\u6642\uff0c\u8acb\u9078\u64c7\u4e00\u500b\u53ef\u4ee5\u6574\u9664 24 \u7684\u5c0f\u6642\u6578\u3002 \u4f8b\u5982\uff0c\u5c07 `--hourly-schedule` \u8a2d\u7f6e\u7232 12 \u8868\u793a\u6bcf 12 \u5c0f\u6642\u751f\u6210\u4e00\u6b21\u5feb\u7167\u3002\u5c0d\u65bc\u6bcf\u9031\u6642\u9593\u8868\uff0c\u8acb\u5b9a\u7fa9\u60a8\u8981\u5728\u54ea\u4e00\u5929\u622a\u53d6\u5feb\u7167\uff0c\u4e26\u52d9\u5fc5\u5beb\u6e05\u695a\u662f\u5468\u5e7e\uff08\u4e0d\u5340\u5206\u5927\u5c0f\u5beb\uff09\u3002 `hourly-schedule` \u3001 `daily-schedule` \u548c `weekly-schedule` \u9019\u4e09\u7a2e\u5feb\u7167\u983b\u7387\u6a19\u8a8c\u662f\u4e92\u65a5\u7684\u3002\u60a8\u5fc5\u9808\u7232\u5feb\u7167\u6642\u9593\u8868\u9078\u64c7\u5176\u4e2d\u4e00\u500b\u6a19\u8a8c\u3002 **\u6ce8\u610f** \uff1a\u82e5\u8981\u7232\u6bcf\u9031\u6642\u9593\u8868\u6307\u5b9a\u4e00\u9031\u4e2d\u7684\u4e0d\u540c\u65e5\u5b50\u548c\u4e0d\u540c\u7684\u958b\u59cb\u6642\u9593\uff0c\u8acb\u6539\u7528 `--weekly-schedule-from-file` \u3002\n- \u5982\u679c\u60a8\u9078\u64c7\u4ee5\u9019\u7a2e\u683c\u5f0f\u63d0\u4f9b\u6bcf\u9031\u5feb\u7167\u6642\u9593\u8868\uff0c\u5247 `[FILE_NAME]` \u662f\u5305\u542b\u8a72\u6642\u9593\u8868\u7684\u6587\u4ef6\u7684\u540d\u7a31\u3002 \u8acb\u6ce8\u610f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u6587\u4ef6\u4f86\u7232\u6bcf\u9031\u6642\u9593\u8868\u6307\u5b9a\u4e0d\u540c\u7684\u661f\u671f\u5e7e\u548c\u4e0d\u540c\u7684\u6642\u9593\uff08\u4f46\u4e0d\u80fd\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u4e0a\u6307\u5b9a\u591a\u500b\u6bcf\u9031\u6642\u9593\u8868\uff09\u3002\u4f8b\u5982\uff0c\u60a8\u7684\u6587\u4ef6\u7232\u5feb\u7167\u6642\u9593\u8868\u6307\u5b9a\u4e86\u9031\u4e00\u548c\u9031\u4e09\uff1a `[{\"day\": \"MONDAY\", \"startTime\": \"04:00\"}, {\"day\": \"WEDNESDAY\", \"startTime\": \"02:00\"}]` \uff0c\u5982\u679c\u60a8\u5728\u6587\u4ef6\u4e2d\u6dfb\u52a0\u958b\u59cb\u6642\u9593\uff0c\u5247\u7121\u9700\u8a2d\u7f6e `--start-time` \u6a19\u8a8c\u3002\u6642\u9593\u8868\u4f7f\u7528 UTC \u6642\u9593\u6a19\u6e96\u3002\n- `[DELETION_OPTION]` \u7528\u65bc\u78ba\u5b9a\u5728\u4f86\u6e90\u78c1\u76e4\u906d\u5230\u522a\u9664\u5f8c\u7cfb\u7d71\u5c0d\u5feb\u7167\u57f7\u884c\u7684\u64cd\u4f5c\u3002\u9078\u64c7\u9ed8\u8a8d\u7684 `keep-auto-snapshots` \u53ef\u7701\u7565\u6b64\u6a19\u8a8c\uff0c\u800c\u4f7f\u7528 `apply-retention-policy` \u5247\u6703\u61c9\u7528\u4fdd\u7559\u653f\u7b56\u3002\n\u4e0b\u6587\u4ecb\u7d39\u4e86\u8a2d\u7f6e\u5feb\u7167\u6642\u9593\u8868\u7684\u5176\u4ed6\u793a\u4f8b\u3002\u5728\u4e0b\u9762\u7684\u6240\u6709\u793a\u4f8b\u4e2d\uff1a- \u5305\u542b\u4e86\u78c1\u76e4\u522a\u9664\u898f\u5247\uff1b`--on-source-disk-delete`\u6a19\u8a8c\u8a2d\u7232\u9ed8\u8a8d\u503c`keep-auto-snapshots`\uff0c\u4ee5\u6c38\u4e45\u4fdd\u7559\u6240\u6709\u81ea\u52d5\u751f\u6210\u7684\u5feb\u7167\u3002\u53e6\u4e00\u7a2e\u65b9\u6cd5\u662f\u5c07\u6b64\u6a19\u8a8c\u8a2d\u7232`apply-retention-policy`\uff0c\u4ee5\u4f7f\u7528\u60a8\u7684\u5feb\u7167\u4fdd\u7559\u653f\u7b56\u3002\n- \u5b58\u5132\u4f4d\u7f6e\u8a2d\u7232`US`\uff0c\u56e0\u6b64\u6240\u6709\u751f\u6210\u7684\u5feb\u7167\u5c07\u5b58\u5132\u5728 US \u591a\u5340\u57df\u4e2d\u3002\n- \u5411\u6240\u6709\u751f\u6210\u7684\u5feb\u7167\u61c9\u7528\u4e86\u6a19\u7c64`env=dev`\u548c`media=images`\u3002\n- \u4fdd\u7559\u653f\u7b56\u8a2d\u7232 10 \u5929\u3002\n **\u6bcf\u5c0f\u6642\u6642\u9593\u8868** \uff1a\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u5feb\u7167\u6642\u9593\u8868\u7684\u958b\u59cb\u6642\u9593\u7232\u4e16\u754c\u5354\u8abf\u6642\u9593 (UTC) \u665a\u4e0a 10 \u9ede\uff0c\u6bcf 4 \u5c0f\u6642\u904b\u884c 1 \u6b21\u3002\n```\n\u00a0 gcloud compute resource-policies create snapshot-schedule SCHEDULE_NAME \\\u00a0 \u00a0 \u00a0 --description \"MY HOURLY SNAPSHOT SCHEDULE\" \\\u00a0 \u00a0 \u00a0 --max-retention-days 10 \\\u00a0 \u00a0 \u00a0 --start-time 22:00 \\\u00a0 \u00a0 \u00a0 --hourly-schedule 4 \\\u00a0 \u00a0 \u00a0 --region us-west1 \\\u00a0 \u00a0 \u00a0 --on-source-disk-delete keep-auto-snapshots \\\u00a0 \u00a0 \u00a0 --snapshot-labels env=dev,media=images \\\u00a0 \u00a0 \u00a0 --storage-location US\n```\n **\u6bcf\u65e5\u6642\u9593\u8868** \uff1a\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u5feb\u7167\u6642\u9593\u8868\u7684\u958b\u59cb\u6642\u9593\u7232\u4e16\u754c\u5354\u8abf\u6642\u9593 (UTC) \u665a\u4e0a 10 \u9ede\uff0c\u4e26\u5728\u6bcf\u5929\u540c\u4e00\u6642\u9593\u904b\u884c 1 \u6b21\u3002 `--daily-schedule` \u6a19\u8a8c\u5fc5\u9808\u5b58\u5728\uff0c\u4f46\u4e0d\u7528\u8a2d\u7f6e\u4efb\u4f55\u503c\u3002\n```\ngcloud compute resource-policies create snapshot-schedule SCHEDULE_NAME \\\u00a0 \u00a0 --description \"MY DAILY SNAPSHOT SCHEDULE\" \\\u00a0 \u00a0 --max-retention-days 10 \\\u00a0 \u00a0 --start-time 22:00 \\\u00a0 \u00a0 --daily-schedule \\\u00a0 \u00a0 --region us-west1 \\\u00a0 \u00a0 --on-source-disk-delete keep-auto-snapshots \\\u00a0 \u00a0 --snapshot-labels env=dev,media=images \\\u00a0 \u00a0 --storage-location US\n```\n **\u6bcf\u9031\u6642\u9593\u8868** \uff1a\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u5feb\u7167\u6642\u9593\u8868\u7684\u958b\u59cb\u6642\u9593\u7232\u4e16\u754c\u5354\u8abf\u6642\u9593 (UTC) \u665a\u4e0a 10 \u9ede\uff0c\u4e26\u5728\u6bcf\u500b\u661f\u671f\u4e8c\u548c\u661f\u671f\u56db\u5404\u904b\u884c 1 \u6b21\u3002\n```\ngcloud compute resource-policies create snapshot-schedule SCHEDULE_NAME \\\u00a0 \u00a0 --description \"MY WEEKLY SNAPSHOT SCHEDULE\" \\\u00a0 \u00a0 --max-retention-days 10 \\\u00a0 \u00a0 --start-time 22:00 \\\u00a0 \u00a0 --weekly-schedule tuesday,thursday \\\u00a0 \u00a0 --region us-west1 \\\u00a0 \u00a0 --on-source-disk-delete keep-auto-snapshots \\\u00a0 \u00a0 --snapshot-labels env=dev,media=images \\\u00a0 \u00a0 --storage-location US\n```\n\u5728 API \u4e2d\u69cb\u5efa\u4e00\u500b\u5c0d [resourcePolicies.insert](https://cloud.google.com/compute/docs/reference/rest/v1/resourcePolicies/insert?hl=zh-cn) \u7684 `POST` \u8acb\u6c42\uff0c\u4ee5\u5275\u5efa\u5feb\u7167\u8a08\u5283\u3002\u60a8\u5fc5\u9808\u81f3\u5c11\u5305\u62ec\u5feb\u7167\u6642\u9593\u8868\u540d\u7a31\u3001\u5feb\u7167\u5b58\u5132\u5340\u57df\u4f4d\u7f6e\u548c\u5feb\u7167\u983b\u7387\u3002\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c `onSourceDiskDelete` \u53c3\u6578\u8a2d\u7f6e\u7232 `keepAutoSnapshots` \u3002\u9019\u610f\u5473\u7740\uff0c\u5982\u679c\u4f86\u6e90\u78c1\u76e4\u906d\u5230\u522a\u9664\uff0c\u7cfb\u7d71\u6703\u7121\u9650\u671f\u5730\u4fdd\u7559\u7232\u8a72\u78c1\u76e4\u81ea\u52d5\u751f\u6210\u7684\u5feb\u7167\u3002\u6b64\u5916\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5c07\u8a72\u6a19\u8a8c\u8a2d\u7232 `applyRetentionPolicy` \uff0c\u4ee5\u61c9\u7528\u60a8\u7684\u4fdd\u7559\u653f\u7b56\u3002\n\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u6bcf\u65e5\u5feb\u7167\u6642\u9593\u8868\u7684\u958b\u59cb\u6642\u9593\u8a2d\u7232\u4e16\u754c\u5354\u8abf\u6642\u9593 (UTC) \u4e2d\u5348 12 \u9ede\uff0c\u4e26\u6bcf\u5929\u91cd\u8907\u3002\u8a72\u793a\u4f8b\u9084\u8a2d\u7f6e\u4e86 5 \u5929\u7684\u4fdd\u7559\u653f\u7b56\uff1b5 \u5929\u540e\uff0c\u7cfb\u7d71\u5c07\u81ea\u52d5\u79fb\u9664\u5feb\u7167\u3002\n\u60a8\u9084\u53ef\u4ee5\u5728\u8acb\u6c42\u4e2d\u5305\u542b [\u5feb\u7167\u5b58\u653e\u5340\u57df\u9078\u9805](https://cloud.google.com/compute/docs/disks/create-snapshots?hl=zh-cn#selecting_a_storage_location) \u548c [\u5feb\u7167\u6a19\u7c64](https://cloud.google.com/compute/docs/labeling-resources?hl=zh-cn#adding_or_updating_labels_to_existing_resources) \uff0c\u4ee5\u78ba\u4fdd\u5feb\u7167\u6703\u5b58\u5132\u5728\u60a8\u9078\u64c7\u7684\u4f4d\u7f6e\u3002\n```\nPOST https://compute.googleapis.com/compute/v1/projects/[PROJECT_ID]/regions/[REGION]/resourcePolicies{\u00a0\"name\": \"[SCHEDULE_NAME]\",\u00a0\"description\": \"[SCHEDULE_DESCRIPTION]\",\u00a0\"snapshotSchedulePolicy\": {\u00a0 \u00a0\"schedule\": {\u00a0 \u00a0 \u00a0\"dailySchedule\": {\u00a0 \u00a0 \u00a0 \u00a0\"startTime\": \"12:00\",\u00a0 \u00a0 \u00a0 \u00a0\"daysInCycle\": \"1\"\u00a0 \u00a0 \u00a0}\u00a0 \u00a0},\u00a0 \u00a0\"retentionPolicy\": {\u00a0 \u00a0 \u00a0\"maxRetentionDays\": \"5\"\u00a0 \u00a0},\u00a0 \u00a0\"snapshotProperties\": {\u00a0 \u00a0 \u00a0\"guestFlush\": \"False\",\u00a0 \u00a0 \u00a0\"labels\": {\u00a0 \u00a0 \u00a0 \u00a0\"env\": \"dev\",\u00a0 \u00a0 \u00a0 \u00a0\"media\": \"images\"\u00a0 \u00a0 \u00a0},\u00a0 \u00a0 \u00a0\"storageLocations\": [\"US\"]\u00a0 \u00a0}\u00a0}}\n```\n\u5176\u4e2d\uff1a- `[PROJECT_ID]`\u662f\u9805\u76ee\u540d\u7a31\u3002\n- `[REGION]`\u662f\u5feb\u7167\u6642\u9593\u8868\u8cc7\u6e90\u653f\u7b56\u7684\u4f4d\u7f6e\u3002\n- `[SCHEDULE_DESCRIPTION]`\u662f\u5feb\u7167\u6642\u9593\u8868\u7684\u8aaa\u660e\u3002\n- `[SCHEDULE_NAME]`\u662f\u5feb\u7167\u6642\u9593\u8868\u7684\u540d\u7a31\u3002\n\u540c\u6a23\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5275\u5efa\u6bcf\u9031\u6216\u6bcf\u6708\u6642\u9593\u8868\u3002\u8acb\u67e5\u770b [API \u53c3\u8003](https://cloud.google.com/compute/docs/reference/rest/v1/resourcePolicies/insert?hl=zh-cn) \uff0c\u4ee5\u77ad\u89e3\u6709\u95dc\u8a2d\u7f6e\u6bcf\u9031\u6216\u6bcf\u6708\u6642\u9593\u8868\u7684\u8a73\u7d30\u4fe1\u606f\u3002\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8acb\u6c42\u5c07\u5275\u5efa\u4e00\u500b\u6bcf\u500b\u661f\u671f\u4e00\u7684 9 \u9ede\u548c\u661f\u671f\u56db\u7684 2 \u9ede\u904b\u884c\u7684\u6bcf\u9031\u6642\u9593\u8868\u3002\n```\nPOST https://compute.googleapis.com/compute/v1/projects/[PROJECT_ID]/regions/[REGION]/resourcePolicies{\u00a0\"name\": \"[SCHEDULE_NAME]\",\u00a0\"description\": \"[SCHEDULE_DESCRIPTION]\",\u00a0\"snapshotSchedulePolicy\": {\u00a0 \u00a0\"schedule\": {\u00a0 \u00a0 \u00a0\"weeklySchedule\": {\u00a0 \u00a0 \u00a0 \u00a0\"dayOfWeeks\": [\u00a0 \u00a0 \u00a0 \u00a0{\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"day\": \"Monday\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"startTime\": \"9:00\"\u00a0 \u00a0 \u00a0 \u00a0},\u00a0 \u00a0 \u00a0 \u00a0{\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"day\": \"Thursday\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"startTime\": \"2:00\"\u00a0 \u00a0 \u00a0 \u00a0}\u00a0 \u00a0 \u00a0 \u00a0]\u00a0 \u00a0 \u00a0}\u00a0 \u00a0},\u00a0 \"retentionPolicy\": {\u00a0 \u00a0 \"maxRetentionDays\": \"5\"\u00a0 },\u00a0 \"snapshotProperties\": {\u00a0 \u00a0 \"guestFlush\": \"False\",\u00a0 \u00a0 \"labels\": {\u00a0 \u00a0 \u00a0 \"production\": \"webserver\"\u00a0 \u00a0 },\u00a0 \u00a0 \"storageLocations\": [\"US\"]\u00a0 }\u00a0}}\n```\n### \u5c07\u5feb\u7167\u6642\u9593\u8868\u639b\u63a5\u5230\u78c1\u76e4\n\u5275\u5efa\u6642\u9593\u8868\u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u63a7\u5236\u6aaf\u3001 `gcloud` \u547d\u4ee4\u6216 Compute Engine API \u65b9\u6cd5\u5c07\u5176\u639b\u63a5\u5230\u73fe\u6709\u78c1\u76e4\u3002\n\u5c07\u5feb\u7167\u6642\u9593\u8868\u639b\u63a5\u5230\u73fe\u6709\u78c1\u76e4\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **\u78c1\u76e4** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u78c1\u76e4\u201d\u9801\u9762](https://console.cloud.google.com/compute/disks?hl=zh-cn) \n- \u9078\u64c7\u8981\u639b\u63a5\u5feb\u7167\u6642\u9593\u8868\u7684\u78c1\u76e4\u7684\u540d\u7a31\u3002\u6b64\u6642\u6703\u6253\u958b **\u7ba1\u7406\u78c1\u76e4** \u9801\u9762\u3002\n- \u5728 **\u7ba1\u7406\u78c1\u76e4** \u9801\u9762\u4e0a\uff0c\u61f8\u505c\u9f20\u6a19\uff0c\u9ede\u64camore_vert **\u66f4\u591a\u64cd\u4f5c** \u83dc\u55ae\u4e26\u9078\u64c7edit **\u4fee\u6539** \u3002\n- \u4f7f\u7528 **\u5feb\u7167\u6642\u9593\u8868** \u4e0b\u62c9\u83dc\u55ae\u5c07\u6642\u9593\u8868\u6dfb\u52a0\u5230\u5c0d\u61c9\u78c1\u76e4\uff0c\u6216\u8005\u5275\u5efa\u4e00\u500b\u65b0\u7684\u6642\u9593\u8868\u3002\n- \u5982\u679c\u60a8\u5275\u5efa\u4e86\u65b0\u7684\u6642\u9593\u8868\uff0c\u8acb\u9ede\u64ca **\u5275\u5efa** \u3002\n- \u9ede\u64ca **\u4fdd\u5b58** \uff0c\u4ee5\u5b8c\u6210\u8a72\u4efb\u52d9\u3002\n\u5982\u9700\u5c07\u5feb\u7167\u6642\u9593\u8868\u639b\u63a5\u5230\u78c1\u76e4\uff0c\u8acb\u4f7f\u7528 [disks add-resource-policies](https://cloud.google.com/sdk/gcloud/reference/compute/disks/add-resource-policies?hl=zh-cn) `gcloud` \u547d\u4ee4\u3002\n```\ngcloud compute disks add-resource-policies [DISK_NAME] \\\u00a0 \u00a0 --resource-policies [SCHEDULE_NAME] \\\u00a0 \u00a0 --zone [ZONE]\n```\n\u5176\u4e2d\uff1a- `[DISK_NAME]`\u662f\u73fe\u6709\u78c1\u76e4\u7684\u540d\u7a31\u3002\n- `[SCHEDULE_NAME]`\u662f\u5feb\u7167\u6642\u9593\u8868\u7684\u540d\u7a31\u3002\n- `[ZONE]`\u662f\u78c1\u76e4\u7684\u4f4d\u7f6e\u3002\n\u5728 API \u4e2d\uff0c\u69cb\u5efa\u5c0d [disks.addResourcePolicies](https://cloud.google.com/compute/docs/reference/rest/v1/disks/addResourcePolicies?hl=zh-cn) \u65b9\u6cd5\u7684 `POST` \u8acb\u6c42\uff0c\u4ee5\u5c07\u5feb\u7167\u6642\u9593\u8868\u639b\u63a5\u5230\u73fe\u6709\u78c1\u76e4\u3002\n```\nPOST https://compute.googleapis.com/compute/v1/projects/[PROJECT_ID]/zones/[ZONE]/disks/[DISK_NAME]/addResourcePolicies{\u00a0 \"resourcePolicies\": [\u00a0 \u00a0 \"regions/[REGION]/resourcePolicies/[SCHEDULE_NAME]\"\u00a0 ]}\n```\n\u5176\u4e2d\uff1a- `[PROJECT_ID]`\u662f\u9805\u76ee\u540d\u7a31\u3002\n- `[ZONE]`\u662f\u78c1\u76e4\u7684\u4f4d\u7f6e\u3002\n- `[REGION]`\u662f\u5feb\u7167\u6642\u9593\u8868\u7684\u5340\u57df\u3002\n- `[DISK_NAME]`\u662f\u78c1\u76e4\u7684\u540d\u7a31\u3002\n- `[SCHEDULE_NAME]`\u662f\u60a8\u8981\u61c9\u7528\u5230\u6b64\u78c1\u76e4\u4e2d\u7684\u5340\u57df\u6240\u542b\u5feb\u7167\u6642\u9593\u8868\u7684\u540d\u7a31\u3002## \u5f9e\u5feb\u7167\u6062\u5fa9\u6578\u64da\n\u5982\u679c\u60a8\u4f7f\u7528\u5feb\u7167\u5099\u4efd\u4e86\u5553\u52d5\u78c1\u76e4\u6216\u975e\u5553\u52d5\u78c1\u76e4\uff0c\u5247\u53ef\u4ee5\u6839\u64da\u8a72\u5feb\u7167\u5275\u5efa\u65b0\u78c1\u76e4\u3002\n### \u9650\u5236\n- \u65b0\u78c1\u76e4\u7684\u5927\u5c0f\u81f3\u5c11\u61c9\u8207\u5feb\u7167\u6700\u521d\u7684\u4f86\u6e90\u78c1\u76e4\u7684\u5927\u5c0f\u76f8\u540c\u3002\u5982\u679c\u60a8\u5275\u5efa\u7684\u78c1\u76e4\u5bb9\u91cf\u5927\u65bc\u5feb\u7167\u6700\u521d\u7684\u4f86\u6e90\u78c1\u76e4\uff0c\u5247\u5fc5\u9808 [\u8abf\u6574\u8a72\u6c38\u4e45\u6027\u78c1\u76e4\u4e0a\u7684\u6587\u4ef6\u7cfb\u7d71\u5927\u5c0f](https://cloud.google.com/compute/docs/disks/resize-persistent-disk?hl=zh-cn) \u624d\u80fd\u6dfb\u52a0\u984d\u5916\u7684\u78c1\u76e4\u7a7a\u9593\u3002\u60a8\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u5176\u4ed6\u6587\u4ef6\u7cfb\u7d71\u5927\u5c0f\u8abf\u6574\u5de5\u5177\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u60a8\u7684\u64cd\u4f5c\u7cfb\u7d71\u548c\u6587\u4ef6\u7cfb\u7d71\u985e\u578b\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u64cd\u4f5c\u7cfb\u7d71\u6587\u6a94\u3002\n### \u6839\u64da\u5feb\u7167\u5275\u5efa\u78c1\u76e4\u4e26\u5c07\u5176\u639b\u63a5\u5230\u865b\u64ec\u6a5f\n**\u6ce8\u610f** \uff1a\u60a8\u5fc5\u9808\u5728\u8207\u5be6\u4f8b\u76f8\u540c\u7684\u53ef\u7528\u5340\u4e2d\u5275\u5efa\u78c1\u76e4\u3002- \u5728 Google Cloud Console \u4e2d\uff0c\u8f49\u5230 **\u5feb\u7167** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u5feb\u7167\u201d](https://console.cloud.google.com/compute/snapshots?hl=zh-cn) \n- \u627e\u5230\u8981\u6062\u5fa9\u7684\u5feb\u7167\u7684\u540d\u7a31\u3002\n- \u8f49\u5230 **\u78c1\u76e4** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u78c1\u76e4\u201d\u9801\u9762](https://console.cloud.google.com/compute/disks?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa\u65b0\u78c1\u76e4** \u3002\n- \u6307\u5b9a\u4ee5\u4e0b\u914d\u7f6e\u53c3\u6578\uff1a- \u78c1\u76e4\u7684\u540d\u7a31\u3002\n- \u78c1\u76e4\u7684\u985e\u578b\u3002\n- \uff08\u53ef\u9078\uff09\u60a8\u53ef\u4ee5\u8986\u84cb\u6240\u9078\u7684\u9ed8\u8a8d\u5340\u57df\u548c\u5730\u5340\u3002 \u60a8\u53ef\u4ee5\u9078\u64c7\u4efb\u4f55\u5340\u57df\u548c\u5730\u5340\uff0c\u7121\u8ad6\u4f86\u6e90\u5feb\u7167\u5b58\u5132\u5728\u4ec0\u9ebc\u4f4d\u7f6e\u3002\n- \u5728 **\u4f86\u6e90\u985e\u578b** \u4e0b\u65b9\uff0c\u9ede\u64ca **\u5feb\u7167** \u3002\n- \u9078\u64c7\u8981\u6062\u5fa9\u7684\u5feb\u7167\u7684\u540d\u7a31\u3002\n- \u9078\u64c7\u65b0\u78c1\u76e4\u7684\u5927\u5c0f\uff08\u4ee5 GB \u7232\u55ae\u4f4d\uff09\u3002\u6b64\u6578\u5b57\u5fc5\u9808\u7b49\u65bc\u6216\u5927\u65bc\u5feb\u7167\u6700\u521d\u7684\u4f86\u6e90\u78c1\u76e4\u5927\u5c0f\u3002\n- \u9ede\u64ca **\u5275\u5efa** \u4ee5\u5275\u5efa\u78c1\u76e4\u3002\n\u60a8\u96a8\u5f8c\u53ef\u4ee5\u5c07\u65b0\u78c1\u76e4\u639b\u63a5\u5230\u73fe\u6709\u5be6\u4f8b\u3002- \u8f49\u5230 **\u865b\u64ec\u6a5f\u5be6\u4f8b** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u865b\u64ec\u6a5f\u5be6\u4f8b\u201d\u9801\u9762](https://console.cloud.google.com/compute/instances?hl=zh-cn) \n- \u9ede\u64ca\u8981\u5728\u5176\u4e2d\u6062\u5fa9\u975e\u5553\u52d5\u78c1\u76e4\u7684\u5be6\u4f8b\u7684\u540d\u7a31\u3002\n- \u5728\u5be6\u4f8b\u8a73\u60c5\u9801\u9762\u9802\u90e8\uff0c\u9ede\u64ca **\u4fee\u6539** \u3002\n- \u5728 **\u984d\u5916\u78c1\u76e4** \u4e0b\uff0c\u9ede\u64ca **\u639b\u63a5\u73fe\u6709\u78c1\u76e4** \u3002\n- \u9078\u64c7\u57fa\u65bc\u5feb\u7167\u5275\u5efa\u7684\u65b0\u78c1\u76e4\u7684\u540d\u7a31\u3002\n- \u9ede\u64ca **\u5b8c\u6210** \u4ee5\u639b\u63a5\u78c1\u76e4\u3002\n- \u5728\u5be6\u4f8b\u8a73\u60c5\u9801\u9762\u7684\u5e95\u90e8\uff0c\u9ede\u64ca **\u4fdd\u5b58** \u4ee5\u5c07\u66f4\u6539\u61c9\u7528\u65bc\u5be6\u4f8b\u3002\n- \u4f7f\u7528 [gcloud compute snapshots list \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/snapshots/list?hl=zh-cn) \u627e\u5230\u8981\u6062\u5fa9\u7684\u5feb\u7167\u7684\u540d\u7a31\uff1a```\ngcloud compute snapshots list\n```\n- \u4f7f\u7528 [gcloud compute snapshots describe \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/snapshots/describe?hl=zh-cn) \u627e\u5230\u8981\u6062\u5fa9\u7684\u5feb\u7167\u7684\u5927\u5c0f\uff1a```\ngcloud compute snapshots describe SNAPSHOT_NAME\n```\u5c07 \u66ff\u63db\u7232\u8981\u6062\u5fa9\u7684\u5feb\u7167\u7684\u540d\u7a31\u3002\n- \u4f7f\u7528 [gcloud compute disks create\u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/disks/create?hl=zh-cn) \u4f86\u5275\u5efa\u4e00\u500b\u65b0 [\u5340\u57df](https://cloud.google.com/compute/docs/disks?hl=zh-cn#repds) \u6216 [\u53ef\u7528\u5340](https://cloud.google.com/compute/docs/disks?hl=zh-cn#pdspecs) \u78c1\u76e4\u3002\u5982\u679c\u60a8\u9700\u8981\u4f7f\u7528 SSD \u6c38\u4e45\u6027\u78c1\u76e4\u4f86\u5be6\u73fe\u66f4\u9ad8\u7684\u541e\u5410\u91cf\u6216 IOPS\uff0c\u8acb\u6dfb\u52a0 `--type` \u6a19\u8a8c\u4e26\u6307\u5b9a `pd-ssd` \u3002```\ngcloud compute disks create DISK_NAME \\\u00a0 \u00a0 --size=DISK_SIZE \\\u00a0 \u00a0 --source-snapshot=SNAPSHOT_NAME \\\u00a0 \u00a0 --type=DISK_TYPE\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1a\u65b0\u78c1\u76e4\u7684\u540d\u7a31\u3002\n- \uff1a\u65b0\u78c1\u76e4\u7684\u5927\u5c0f\uff08\u4ee5 GB \u7232\u55ae\u4f4d\uff09\u3002\u6b64\u6578\u5b57\u5fc5\u9808\u7b49\u65bc\u6216\u5927\u65bc\u5feb\u7167\u6700\u521d\u7684\u4f86\u6e90\u78c1\u76e4\u5927\u5c0f\u3002\n- \uff1a\u8981\u6062\u5fa9\u7684\u5feb\u7167\u7684\u540d\u7a31\u3002\n- \uff1a\u78c1\u76e4 [\u985e\u578b](https://cloud.google.com/compute/docs/disks?hl=zh-cn#disk-types) \u7684\u5b8c\u6574\u6216\u90e8\u5206\u7db2\u5740\u3002\u4f8b\u5982`https://www.googleapis.com/compute/v1/projects/` `` `/zones/` `` `/diskTypes/pd-ssd`\u3002\n- \u4f7f\u7528 [gcloud compute instances attach-disk \u547d\u4ee4](https://cloud.google.com/sdk/gcloud/reference/compute/instances/attach-disk?hl=zh-cn) \u5c07\u65b0\u78c1\u76e4\u639b\u63a5\u5230\u73fe\u6709\u5be6\u4f8b\uff1a```\ngcloud compute instances attach-disk INSTANCE_NAME \\\u00a0 \u00a0 --disk DISK_NAME\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \u662f\u5be6\u4f8b\u7684\u540d\u7a31\u3002\n- \u662f\u901a\u904e\u5feb\u7167\u5275\u5efa\u7684\u78c1\u76e4\u7684\u540d\u7a31\u3002- \u69cb\u5efa\u5c0d [snapshots.list](https://cloud.google.com/compute/docs/reference/rest/v1/snapshots/list?hl=zh-cn) \u7684 `GET` \u8acb\u6c42\uff0c\u4ee5\u5728\u60a8\u7684\u9805\u76ee\u4e2d\u986f\u793a\u5feb\u7167\u5217\u8868\u3002GET https://compute.googleapis.com/compute/v1/projects/ /global/snapshots\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\n- \u4f7f\u7528 [disks.insert](https://cloud.google.com/compute/docs/reference/rest/v1/disks/insert?hl=zh-cn) \u65b9\u6cd5\u69cb\u5efa `POST` \u8acb\u6c42\u4ee5\u5275\u5efa\u53ef\u7528\u5340\u78c1\u76e4\u3002\u8acb\u6c42\u61c9\u5305\u542b `name` \u3001 `sizeGb` \u548c `type` \u5c6c\u6027\u3002\u5982\u9700\u4f7f\u7528\u5feb\u7167\u6062\u5fa9\u78c1\u76e4\uff0c\u60a8\u5fc5\u9808\u6dfb\u52a0 `sourceSnapshot` \u5c6c\u6027\u3002```\nPOST https://compute.googleapis.com/compute/v1/projects/PROJECT_ID/zones/ZONE/disks{\u00a0\"name\": \"DISK_NAME\",\u00a0\"sizeGb\": \"DISK_SIZE\",\u00a0\"type\": \"zones/ZONE/diskTypes/DISK_TYPE\"\u00a0\"sourceSnapshot\": \"SNAPSHOT_NAME\"}\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1a\u60a8\u7684\u9805\u76ee ID\u3002\n- \uff1a\u60a8\u7684\u5be6\u4f8b\u548c\u65b0\u78c1\u76e4\u6240\u5728\u7684\u53ef\u7528\u5340\u3002\n- \uff1a\u65b0\u78c1\u76e4\u7684\u540d\u7a31\u3002\n- \uff1a\u65b0\u78c1\u76e4\u7684\u5927\u5c0f\uff08\u4ee5 GB \u7232\u55ae\u4f4d\uff09\u3002\u6b64\u6578\u5b57\u5fc5\u9808\u7b49\u65bc\u6216\u5927\u65bc\u5feb\u7167\u6700\u521d\u7684\u4f86\u6e90\u78c1\u76e4\u5927\u5c0f\u3002\n- \uff1a\u78c1\u76e4 [\u985e\u578b](https://cloud.google.com/compute/docs/disks?hl=zh-cn#disk-types) \u7684\u5b8c\u6574\u6216\u90e8\u5206\u7db2\u5740\u3002\u4f8b\u5982\uff1a`https://www.googleapis.com/compute/v1/projects/` `` `/zones/` `` `/diskTypes/pd-ssd`\u3002\n- \uff1a\u8981\u6062\u5fa9\u7684\u78c1\u76e4\u7684\u4f86\u6e90\u5feb\u7167\u3002\n- \u7136\u5f8c\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u65b9\u6cd5\u5c07\u65b0\u78c1\u76e4\u639b\u63a5\u5230\u73fe\u6709\u5be6\u4f8b\uff1a\u69cb\u5efa\u4e00\u500b\u5c0d [instances.attachDisk \u65b9\u6cd5](https://cloud.google.com/compute/docs/reference/rest/v1/instances/attachDisk?hl=zh-cn) \u7684 `POST` \u8acb\u6c42\uff0c\u4e26\u6dfb\u52a0\u60a8\u525b\u525b\u6839\u64da\u5feb\u7167\u5275\u5efa\u7684\u53ef\u7528\u5340\u7d1a\u78c1\u76e4\u7684\u7db2\u5740\u3002```\nPOST https://compute.googleapis.com/compute/v1/projects/PROJECT_ID/zones/ZONE/instances/INSTANCE_NAME/attachDisk{\u00a0\"source\": \"/compute/v1/projects/PROJECT_ID/zones/ZONE/disks/DISK_NAME\"}\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \u662f\u9805\u76ee ID\u3002\n- \u662f\u60a8\u7684\u5be6\u4f8b\u548c\u65b0\u78c1\u76e4\u6240\u5728\u7684\u5730\u5340\u3002\n- \u662f\u60a8\u8981\u5728\u5176\u4e2d\u6dfb\u52a0\u65b0\u78c1\u76e4\u7684\u5be6\u4f8b\u540d\u7a31\u3002\n- \u662f\u65b0\u78c1\u76e4\u7684\u540d\u7a31\u3002\n### Go\u5728\u5617\u8a66\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167 [\u300aVertex AI \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab\u300b](https://cloud.google.com/vertex-ai/docs/start/client-libraries?hl=zh-cn) \u4e2d\u7684 Go \u8a2d\u7f6e\u8aaa\u660e\u57f7\u884c\u64cd\u4f5c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Vertex AI Go API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/go/docs/reference/cloud.google.com/go/aiplatform/latest/apiv1?hl=zh-cn) \u3002\n\u5982\u9700\u5411 Vertex AI \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/golang-samples/blob/HEAD/compute/disks/create_disk_from_snapshot.go) \n```\nimport (\u00a0 \u00a0 \u00a0 \u00a0 \"context\"\u00a0 \u00a0 \u00a0 \u00a0 \"fmt\"\u00a0 \u00a0 \u00a0 \u00a0 \"io\"\u00a0 \u00a0 \u00a0 \u00a0 compute \"cloud.google.com/go/compute/apiv1\"\u00a0 \u00a0 \u00a0 \u00a0 computepb \"google.golang.org/genproto/googleapis/cloud/compute/v1\"\u00a0 \u00a0 \u00a0 \u00a0 \"google.golang.org/protobuf/proto\")// createDiskFromSnapshot creates a new disk in a project in given zone.func createDiskFromSnapshot(\u00a0 \u00a0 \u00a0 \u00a0 w io.Writer,\u00a0 \u00a0 \u00a0 \u00a0 projectID, zone, diskName, diskType, snapshotLink string,\u00a0 \u00a0 \u00a0 \u00a0 diskSizeGb int64,) error {\u00a0 \u00a0 \u00a0 \u00a0 // projectID := \"your_project_id\"\u00a0 \u00a0 \u00a0 \u00a0 // zone := \"us-west3-b\" // should match diskType below\u00a0 \u00a0 \u00a0 \u00a0 // diskName := \"your_disk_name\"\u00a0 \u00a0 \u00a0 \u00a0 // diskType := \"zones/us-west3-b/diskTypes/pd-ssd\"\u00a0 \u00a0 \u00a0 \u00a0 // snapshotLink := \"projects/your_project_id/global/snapshots/snapshot_name\"\u00a0 \u00a0 \u00a0 \u00a0 // diskSizeGb := 120\u00a0 \u00a0 \u00a0 \u00a0 ctx := context.Background()\u00a0 \u00a0 \u00a0 \u00a0 disksClient, err := compute.NewDisksRESTClient(ctx)\u00a0 \u00a0 \u00a0 \u00a0 if err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"NewDisksRESTClient: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 defer disksClient.Close()\u00a0 \u00a0 \u00a0 \u00a0 req := &computepb.InsertDiskRequest{\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Project: projectID,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Zone: \u00a0 \u00a0zone,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 DiskResource: &computepb.Disk{\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Name: \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 proto.String(diskName),\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Zone: \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 proto.String(zone),\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Type: \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 proto.String(diskType),\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 SourceSnapshot: proto.String(snapshotLink),\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 SizeGb: \u00a0 \u00a0 \u00a0 \u00a0 proto.Int64(diskSizeGb),\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 op, err := disksClient.Insert(ctx, req)\u00a0 \u00a0 \u00a0 \u00a0 if err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"unable to create disk: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 if err = op.Wait(ctx); err != nil {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return fmt.Errorf(\"unable to wait for the operation: %w\", err)\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 fmt.Fprintf(w, \"Disk created\\n\")\u00a0 \u00a0 \u00a0 \u00a0 return nil}\n```\n### Java\u5728\u5617\u8a66\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167 [\u300aVertex AI \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab\u300b](https://cloud.google.com/vertex-ai/docs/start/client-libraries?hl=zh-cn) \u4e2d\u7684 Java \u8a2d\u7f6e\u8aaa\u660e\u57f7\u884c\u64cd\u4f5c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Vertex AI Java API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/java/docs/reference/google-cloud-aiplatform/latest/com.google.cloud.aiplatform.v1?hl=zh-cn) \u3002\n\u5982\u9700\u5411 Vertex AI \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/compute/cloud-client/src/main/java/compute/disks/CreateDiskFromSnapshot.java) \n```\nimport com.google.cloud.compute.v1.Disk;import com.google.cloud.compute.v1.DisksClient;import com.google.cloud.compute.v1.InsertDiskRequest;import com.google.cloud.compute.v1.Operation;import java.io.IOException;import java.util.concurrent.ExecutionException;import java.util.concurrent.TimeUnit;import java.util.concurrent.TimeoutException;public class CreateDiskFromSnapshot {\u00a0 public static void main(String[] args)\u00a0 \u00a0 \u00a0 throws IOException, ExecutionException, InterruptedException, TimeoutException {\u00a0 \u00a0 // TODO(developer): Replace these variables before running the sample.\u00a0 \u00a0 // Project ID or project number of the Cloud project you want to use.\u00a0 \u00a0 String projectId = \"YOUR_PROJECT_ID\";\u00a0 \u00a0 // Name of the zone in which you want to create the disk.\u00a0 \u00a0 String zone = \"europe-central2-b\";\u00a0 \u00a0 // Name of the disk you want to create.\u00a0 \u00a0 String diskName = \"YOUR_DISK_NAME\";\u00a0 \u00a0 // The type of disk you want to create. This value uses the following format:\u00a0 \u00a0 // \"zones/{zone}/diskTypes/(pd-standard|pd-ssd|pd-balanced|pd-extreme)\".\u00a0 \u00a0 // For example: \"zones/us-west3-b/diskTypes/pd-ssd\"\u00a0 \u00a0 String diskType = String.format(\"zones/%s/diskTypes/pd-ssd\", zone);\u00a0 \u00a0 // Size of the new disk in gigabytes.\u00a0 \u00a0 long diskSizeGb = 10;\u00a0 \u00a0 // The full path and name of the snapshot that you want to use as the source for the new disk.\u00a0 \u00a0 // This value uses the following format:\u00a0 \u00a0 // \"projects/{projectName}/global/snapshots/{snapshotName}\"\u00a0 \u00a0 String snapshotLink = String.format(\"projects/%s/global/snapshots/%s\", projectId,\u00a0 \u00a0 \u00a0 \u00a0 \"SNAPSHOT_NAME\");\u00a0 \u00a0 createDiskFromSnapshot(projectId, zone, diskName, diskType, diskSizeGb, snapshotLink);\u00a0 }\u00a0 // Creates a new disk in a project in given zone, using a snapshot.\u00a0 public static void createDiskFromSnapshot(String projectId, String zone, String diskName,\u00a0 \u00a0 \u00a0 String diskType, long diskSizeGb, String snapshotLink)\u00a0 \u00a0 \u00a0 throws IOException, ExecutionException, InterruptedException, TimeoutException {\u00a0 \u00a0 // Initialize client that will be used to send requests. This client only needs to be created\u00a0 \u00a0 // once, and can be reused for multiple requests. After completing all of your requests, call\u00a0 \u00a0 // the `disksClient.close()` method on the client to safely\u00a0 \u00a0 // clean up any remaining background resources.\u00a0 \u00a0 try (DisksClient disksClient = DisksClient.create()) {\u00a0 \u00a0 \u00a0 // Set the disk properties and the source snapshot.\u00a0 \u00a0 \u00a0 Disk disk = Disk.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setName(diskName)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setZone(zone)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setSizeGb(diskSizeGb)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setType(diskType)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setSourceSnapshot(snapshotLink)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 // Create the insert disk request.\u00a0 \u00a0 \u00a0 InsertDiskRequest insertDiskRequest = InsertDiskRequest.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setProject(projectId)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setZone(zone)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setDiskResource(disk)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 // Wait for the create disk operation to complete.\u00a0 \u00a0 \u00a0 Operation response = disksClient.insertAsync(insertDiskRequest)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .get(3, TimeUnit.MINUTES);\u00a0 \u00a0 \u00a0 if (response.hasError()) {\u00a0 \u00a0 \u00a0 \u00a0 System.out.println(\"Disk creation failed!\" + response);\u00a0 \u00a0 \u00a0 \u00a0 return;\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 System.out.println(\"Disk created. Operation Status: \" + response.getStatus());\u00a0 \u00a0 }\u00a0 }}\n```\n### Node.js\u5728\u5617\u8a66\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167 [\u300aVertex AI \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab\u300b](https://cloud.google.com/vertex-ai/docs/start/client-libraries?hl=zh-cn) \u4e2d\u7684 Node.js \u8a2d\u7f6e\u8aaa\u660e\u57f7\u884c\u64cd\u4f5c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Vertex AI Node.js API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/nodejs/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n\u5982\u9700\u5411 Vertex AI \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/nodejs-docs-samples/blob/HEAD/compute/disks/createDiskFromSnapshot.js) \n```\n/**\u00a0* TODO(developer): Uncomment and replace these variables before running the sample.\u00a0*/// const projectId = 'YOUR_PROJECT_ID';// const zone = 'europe-central2-b';// const diskName = 'YOUR_DISK_NAME';// const diskType = 'zones/us-west3-b/diskTypes/pd-ssd';// const diskSizeGb = 10;// const snapshotLink = 'projects/project_name/global/snapshots/snapshot_name';const compute = require('@google-cloud/compute');async function createDiskFromSnapshot() {\u00a0 const disksClient = new compute.DisksClient();\u00a0 const [response] = await disksClient.insert({\u00a0 \u00a0 project: projectId,\u00a0 \u00a0 zone,\u00a0 \u00a0 diskResource: {\u00a0 \u00a0 \u00a0 sizeGb: diskSizeGb,\u00a0 \u00a0 \u00a0 name: diskName,\u00a0 \u00a0 \u00a0 zone,\u00a0 \u00a0 \u00a0 type: diskType,\u00a0 \u00a0 \u00a0 sourceSnapshot: snapshotLink,\u00a0 \u00a0 },\u00a0 });\u00a0 let operation = response.latestResponse;\u00a0 const operationsClient = new compute.ZoneOperationsClient();\u00a0 // Wait for the create disk operation to complete.\u00a0 while (operation.status !== 'DONE') {\u00a0 \u00a0 [operation] = await operationsClient.wait({\u00a0 \u00a0 \u00a0 operation: operation.name,\u00a0 \u00a0 \u00a0 project: projectId,\u00a0 \u00a0 \u00a0 zone: operation.zone.split('/').pop(),\u00a0 \u00a0 });\u00a0 }\u00a0 console.log('Disk created.');}createDiskFromSnapshot();\n```\n### Python\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u6216\u66f4\u65b0 Python\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Python \u7248 Vertex AI SDK](https://cloud.google.com/vertex-ai/docs/start/use-vertex-ai-python-sdk?hl=zh-cn) \u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [   Python API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/python/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/python-docs-samples/blob/HEAD/compute/client_library/snippets/disks/create_from_snapshot.py) \n```\nfrom __future__ import annotationsimport sysfrom typing import Anyfrom google.api_core.extended_operation import ExtendedOperationfrom google.cloud import compute_v1def wait_for_extended_operation(\u00a0 \u00a0 operation: ExtendedOperation, verbose_name: str = \"operation\", timeout: int = 300) -> Any:\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 Waits for the extended (long-running) operation to complete.\u00a0 \u00a0 If the operation is successful, it will return its result.\u00a0 \u00a0 If the operation ends with an error, an exception will be raised.\u00a0 \u00a0 If there were any warnings during the execution of the operation\u00a0 \u00a0 they will be printed to sys.stderr.\u00a0 \u00a0 Args:\u00a0 \u00a0 \u00a0 \u00a0 operation: a long-running operation you want to wait on.\u00a0 \u00a0 \u00a0 \u00a0 verbose_name: (optional) a more verbose name of the operation,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 used only during error and warning reporting.\u00a0 \u00a0 \u00a0 \u00a0 timeout: how long (in seconds) to wait for operation to finish.\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 If None, wait indefinitely.\u00a0 \u00a0 Returns:\u00a0 \u00a0 \u00a0 \u00a0 Whatever the operation.result() returns.\u00a0 \u00a0 Raises:\u00a0 \u00a0 \u00a0 \u00a0 This method will raise the exception received from `operation.exception()`\u00a0 \u00a0 \u00a0 \u00a0 or RuntimeError if there is no exception set, but there is an `error_code`\u00a0 \u00a0 \u00a0 \u00a0 set for the `operation`.\u00a0 \u00a0 \u00a0 \u00a0 In case of an operation taking longer than `timeout` seconds to complete,\u00a0 \u00a0 \u00a0 \u00a0 a `concurrent.futures.TimeoutError` will be raised.\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 result = operation.result(timeout=timeout)\u00a0 \u00a0 if operation.error_code:\u00a0 \u00a0 \u00a0 \u00a0 print(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 f\"Error during {verbose_name}: [Code: {operation.error_code}]: {operation.error_message}\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 file=sys.stderr,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 flush=True,\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 print(f\"Operation ID: {operation.name}\", file=sys.stderr, flush=True)\u00a0 \u00a0 \u00a0 \u00a0 raise operation.exception() or RuntimeError(operation.error_message)\u00a0 \u00a0 if operation.warnings:\u00a0 \u00a0 \u00a0 \u00a0 print(f\"Warnings during {verbose_name}:\\n\", file=sys.stderr, flush=True)\u00a0 \u00a0 \u00a0 \u00a0 for warning in operation.warnings:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 print(f\" - {warning.code}: {warning.message}\", file=sys.stderr, flush=True)\u00a0 \u00a0 return resultdef create_disk_from_snapshot(\u00a0 \u00a0 project_id: str,\u00a0 \u00a0 zone: str,\u00a0 \u00a0 disk_name: str,\u00a0 \u00a0 disk_type: str,\u00a0 \u00a0 disk_size_gb: int,\u00a0 \u00a0 snapshot_link: str,) -> compute_v1.Disk:\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 Creates a new disk in a project in given zone.\u00a0 \u00a0 Args:\u00a0 \u00a0 \u00a0 \u00a0 project_id: project ID or project number of the Cloud project you want to use.\u00a0 \u00a0 \u00a0 \u00a0 zone: name of the zone in which you want to create the disk.\u00a0 \u00a0 \u00a0 \u00a0 disk_name: name of the disk you want to create.\u00a0 \u00a0 \u00a0 \u00a0 disk_type: the type of disk you want to create. This value uses the following format:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"zones/{zone}/diskTypes/(pd-standard|pd-ssd|pd-balanced|pd-extreme)\".\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 For example: \"zones/us-west3-b/diskTypes/pd-ssd\"\u00a0 \u00a0 \u00a0 \u00a0 disk_size_gb: size of the new disk in gigabytes\u00a0 \u00a0 \u00a0 \u00a0 snapshot_link: a link to the snapshot you want to use as a source for the new disk.\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 This value uses the following format: \"projects/{project_name}/global/snapshots/{snapshot_name}\"\u00a0 \u00a0 Returns:\u00a0 \u00a0 \u00a0 \u00a0 An unattached Disk instance.\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 disk_client = compute_v1.DisksClient()\u00a0 \u00a0 disk = compute_v1.Disk()\u00a0 \u00a0 disk.zone = zone\u00a0 \u00a0 disk.size_gb = disk_size_gb\u00a0 \u00a0 disk.source_snapshot = snapshot_link\u00a0 \u00a0 disk.type_ = disk_type\u00a0 \u00a0 disk.name = disk_name\u00a0 \u00a0 operation = disk_client.insert(project=project_id, zone=zone, disk_resource=disk)\u00a0 \u00a0 wait_for_extended_operation(operation, \"disk creation\")\u00a0 \u00a0 return disk_client.get(project=project_id, zone=zone, disk=disk_name)\n```\n### \u88dd\u8f09\u78c1\u76e4\n- \u5728\u7d42\u7aef\u4e2d\uff0c\u4f7f\u7528 `lsblk` \u547d\u4ee4\u5217\u51fa\u639b\u63a5\u5230\u5be6\u4f8b\u7684\u78c1\u76e4\uff0c\u4e26\u627e\u5230\u60a8\u8981\u88dd\u8f09\u7684\u78c1\u76e4\u3002```\n$ sudo lsblk\nNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT\nsda  8:0 0 10G 0 disk\n\u2514\u2500sda1 8:1 0 10G 0 part /\nsdb  8:16 0 250G 0 disk\n```\u5728\u672c\u793a\u4f8b\u4e2d\uff0c `sdb` \u662f\u65b0\u7684\u7a7a\u767d\u6c38\u4e45\u6027\u78c1\u76e4\u7684\u8a2d\u5099\u540d\u7a31\u3002\n- \u4f7f\u7528 [mount \u5de5\u5177](http://manpages.ubuntu.com/manpages/xenial/man8/mount.8.html) \u5c07\u78c1\u76e4\u88dd\u8f09\u5230\u5be6\u4f8b\uff0c\u4e26\u5553\u7528 `discard` \u9078\u9805\uff1a```\n$ sudo mount -o discard,defaults /dev/DEVICE_NAME /home/jupyter\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u8981\u88dd\u8f09\u7684\u78c1\u76e4\u7684\u8a2d\u5099\u540d\u7a31\u3002\n- \u914d\u7f6e\u5c0d\u78c1\u76e4\u7684\u8b80\u5beb\u6b0a\u9650\u3002\u5c0d\u65bc\u672c\u793a\u4f8b\uff0c\u8acb\u7232\u6240\u6709\u7528\u6236\u6388\u4e88\u5c0d\u78c1\u76e4\u7684\u5beb\u5165\u6b0a\u9650\u3002```\n$ sudo chmod a+w /home/jupyter\n```## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3\u5982\u4f55 [\u5c07\u7b46\u8a18\u672c\u4fdd\u5b58\u5230 GitHub](https://cloud.google.com/vertex-ai/docs/workbench/user-managed/save-to-github?hl=zh-cn) \u3002\n- \u8a73\u7d30\u77ad\u89e3\u5982\u4f55 [\u5275\u5efa\u5feb\u7167](https://cloud.google.com/compute/docs/disks/create-snapshots?hl=zh-cn) \u3002\n- \u8a73\u7d30\u77ad\u89e3\u5982\u4f55 [\u8a08\u5283\u5feb\u7167](https://cloud.google.com/compute/docs/disks/scheduled-snapshots?hl=zh-cn) \u3002", "guide": "Vertex AI"}