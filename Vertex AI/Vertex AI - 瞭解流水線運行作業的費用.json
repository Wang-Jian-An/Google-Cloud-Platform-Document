{"title": "Vertex AI - \u77ad\u89e3\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u8cbb\u7528", "url": "https://cloud.google.com/vertex-ai/docs/pipelines/understand-pipeline-cost-labels?hl=zh-cn", "abstract": "# Vertex AI - \u77ad\u89e3\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u8cbb\u7528\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u5c07 Cloud Billing \u6578\u64da\u5c0e\u51fa\u5230 BigQuery \u9019\u4e00\u529f\u80fd](https://cloud.google.com/billing/docs/how-to/export-data-bigquery?hl=zh-cn) \u4f86\u67e5\u770b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u8cbb\u7528\u3002\n\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u552f\u4e00\u7d50\u7b97 ID \u4f86\u67e5\u770b\u8a72\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u5275\u5efa\u7684\u8cc7\u6e90\u7684\u8cbb\u7528\uff0c\u5177\u9ad4\u5982\u4e0b\u6240\u793a\uff1a\n- Vertex AI Pipelines \u6703\u81ea\u52d5\u5c07 `vertex-ai-pipelines-run-billing-id` \u6a19\u7c64\u95dc\u806f\u5230\u60a8\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u3002\u6b64\u6a19\u7c64\u7684\u503c\u662f\u60a8\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u552f\u4e00\u7d50\u7b97 ID\u3002\n- Vertex AI Pipelines \u6703\u5c07\u6b64\u6a19\u7c64\u50b3\u64ad\u5230\u6d41\u6c34\u7dda\u7d44\u4ef6\u5728\u8a72\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u671f\u9593\u751f\u6210\u7684 Google Cloud \u8cc7\u6e90\u3002\u8acb\u6ce8\u610f\uff0c\u5c0d\u65bc\u67d0\u4e9b\u7d44\u4ef6\u548c\u8cc7\u6e90\uff0c\u60a8\u9700\u8981\u5347\u7d1a Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK \u6216\u66f4\u65b0\u81ea\u5df1\u7684\u7d44\u4ef6\u4ee3\u78bc\u624d\u80fd\u50b3\u64ad\u6a19\u7c64\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u7232 Google Cloud \u8cc7\u6e90\u52a0\u6a19\u7c64\uff0c\u8acb\u53c3\u95b1 [Vertex AI Pipelines \u4e2d\u7684\u8cc7\u6e90\u52a0\u6a19\u7c64\u529f\u80fd](https://cloud.google.com/vertex-ai/docs/pipelines/gcpc-label-propagation?hl=zh-cn) \u3002\n- `vertex-ai-pipelines-run-billing-id` \u6a19\u7c64\u6703\u5728\u7d50\u7b97\u5831\u544a\u4e2d\u95dc\u806f\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u751f\u6210\u7684 Google Cloud \u8cc7\u6e90\u7684\u7528\u91cf\u3002\u6709\u4e86\u6b64\u6a19\u7c64\u7684\u503c\uff0c\u60a8\u4fbf\u53ef\u4ee5\u4f7f\u7528 [\u5c07 Cloud Billing \u6578\u64da\u5c0e\u51fa\u5230 BigQuery \u9019\u4e00\u529f\u80fd](https://cloud.google.com/billing/docs/how-to/export-data-bigquery?hl=zh-cn) \u4f86\u67e5\u770b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u8cc7\u6e90\u4f7f\u7528\u8cbb\u3002\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- [\u5217\u51fa\u8cbb\u7528\u6700\u9ad8\u7684\u524d 10 \u500b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d](#retrieve_ten_most_expensive_pipelines) \n- [\u4f7f\u7528\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u7d50\u7b97 ID \u4f86\u67e5\u627e\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d](#locate_pipeline_run) \n- [\u901a\u904e Cloud Billing \u67e5\u8a62\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684 Google Cloud \u8cc7\u6e90\u7684\u8cbb\u7528](#view_pipeline_resources_cost) ", "content": "## \u6e96\u5099\u5de5\u4f5c\n\u5728\u4f7f\u7528 Cloud Billing \u77ad\u89e3\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u8cbb\u7528\u4e4b\u524d\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u8a2d\u7f6e\u60a8\u7684 Google Cloud \u9805\u76ee\u548c\u958b\u767c\u74b0\u5883\uff1a\n- [\u8a2d\u7f6e\u5c07 Cloud Billing \u6578\u64da\u5c0e\u51fa\u5230 BigQuery](https://cloud.google.com/billing/docs/how-to/export-data-bigquery-setup?hl=zh-cn) \n- [\u5b89\u88dd Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c](https://cloud.google.com/vertex-ai/docs/pipelines/components-quickstart?hl=zh-cn#install_latest_release) \n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Cloud Billing \u6a19\u6e96\u4f7f\u7528\u8cbb\u6578\u64da\u7684\u67b6\u69cb\uff0c\u8acb\u53c3\u95b1 [\u6a19\u6e96\u4f7f\u7528\u8cbb\u6578\u64da\u7684\u67b6\u69cb](https://cloud.google.com/billing/docs/how-to/export-data-bigquery-tables/standard-usage?hl=zh-cn#usage-cost-export-more-info) \u3002\n## \u5217\u51fa\u8cbb\u7528\u6700\u9ad8\u7684\u524d 10 \u500b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\n\u904b\u884c\u4ee5\u4e0b\u67e5\u8a62\u4ee5\u67e5\u770b\u6307\u5b9a\u6642\u9593\u6bb5\u5167\u8cbb\u7528\u6700\u9ad8\u7684\u524d 10 \u500b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u5217\u8868\uff1a\n**\u6a19\u6e96 SQL**\n```\nSELECT\u00a0 project.id,\u00a0 location.region,\u00a0 L.value,\u00a0 SUM(cost) AS total_costFROM\u00a0 `project.dataset.gcp_billing_export_v1_XXXXXX_XXXXXX_XXXXXX` B,\u00a0 UNNEST (B.labels) LWHERE\u00a0 DATE(_PARTITIONTIME) >= \"START_DATE\"\u00a0 AND DATE(_PARTITIONTIME) < \"END_DATE\"\u00a0 AND L.key = \"vertex-ai-pipelines-run-billing-id\"GROUP BY\u00a0 project.id,\u00a0 location.region,\u00a0 L.valueORDER BY\u00a0 total_cost DESCLIMIT\u00a0 10;\n```\n\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- \uff1a\u6642\u9593\u6bb5\u7684\u958b\u59cb\u65e5\u671f\u3002\n- \uff1a\u6642\u9593\u6bb5\u7684\u7d50\u675f\u65e5\u671f\u3002\n\u60a8\u61c9\u8a72\u6703\u5728\u67e5\u8a62\u7d50\u679c\u4e2d\u770b\u5230\u5982\u4e0b\u5217\u6578\u64da\uff1a\n- `project_id`\n- `region`\n- `pipeline_run_billing_id`\n- `total_cost`\n\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u67e5\u8a62\u7d50\u679c\u7684 `pipeline_run_billing_id` \u5217\u4e2d\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u552f\u4e00\u7d50\u7b97 ID \u4f86\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- [\u67e5\u627e\u6216\u6aa2\u7d22\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d](#locate_pipeline_run) \n- [\u67e5\u770b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684 Google Cloud \u8cc7\u6e90\u7684\u8cbb\u7528](#view_pipeline_resources_cost) \n**\u63d0\u793a** \uff1a\u67e5\u8a62\u7d50\u679c\u6703\u6309\u8cbb\u7528\u964d\u5e8f\u986f\u793a\u9019\u4e9b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u3002\u5373\uff0c\u7b2c\u4e00\u884c\u6578\u64da\u4ee3\u8868\u8cbb\u7528\u6700\u9ad8\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u3002\n## \u4f7f\u7528\u7d50\u7b97 ID \u67e5\u627e\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u5217\u51fa\u8cbb\u7528\u6700\u9ad8\u7684\u524d 10 \u500b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d](#retrieve_ten_most_expensive_pipelines) \u90e8\u5206\u7684\u67e5\u8a62\u7d50\u679c\u4e2d\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u552f\u4e00\u7d50\u7b97 ID \u4f86\u67e5\u627e\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u3002\n\u8acb\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u6aa2\u7d22\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80 **\u6d41\u6c34\u7dda** \u9801\u9762\u3002 [\u6253\u958b\u201c\u6d41\u6c34\u7dda\u201d](https://console.cloud.google.com/vertex-ai/pipelines?hl=zh-cn) \n- \u5982\u9700\u67e5\u627e\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\uff0c\u8acb\u4f7f\u7528 [\u5217\u51fa\u8cbb\u7528\u6700\u9ad8\u7684\u524d 10 \u500b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d](#retrieve_ten_most_expensive_pipelines) \u90e8\u5206\u7684\u67e5\u8a62\u7d50\u679c\u4e2d\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u552f\u4e00\u7d50\u7b97 ID \u4f86\u904e\u6ffe\u5217\u8868\u3002\u7232\u6b64\uff0c\u8acb\u6309\u4ee5\u4e0b\u8aaa\u660e\u64cd\u4f5c\uff1a- \u9ede\u64ca **\u904e\u6ffe\u689d\u4ef6** \uff0c\u7136\u5f8c\u9ede\u64ca **\u6a19\u7c64** \u3002\n- \u6309\u4ee5\u4e0b\u683c\u5f0f\u8f38\u5165\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u552f\u4e00\u7d50\u7b97 ID\uff0c\u7136\u5f8c\u6309 **Enter** \u9375\uff1a `labels.vertex-ai-pipelines-run-billing-id=` `` \u5176\u4e2d \u662f\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u552f\u4e00\u7d50\u7b97 ID\u3002\n\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u78bc\u793a\u4f8b\u6aa2\u7d22\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\uff1a\n```\nruns = aip.PipelineJob.list(\u00a0 project=PROJECT_ID,\u00a0 location=LOCATION,\u00a0 filter=\"labels.vertex-ai-pipelines-run-billing-id=PIPELINE_RUN_BILLING_ID\")\n```\n\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- \uff1a\u5728\u5176\u4e2d\u904b\u884c\u6b64\u6d41\u6c34\u7dda\u7684 Google Cloud \u9805\u76ee\u3002\n- \uff1a\u6d41\u6c34\u7dda\u5728\u5176\u4e2d\u904b\u884c\u7684\u5340\u57df\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u652f\u6301 Vertex AI Pipelines \u7684\u5340\u57df\uff0c\u8acb\u53c3\u95b1 [Vertex AI \u4f4d\u7f6e\u6307\u5357](https://cloud.google.com/vertex-ai/docs/general/locations?hl=zh-cn#feature-availability) \u3002\n- \uff1a [\u5217\u51fa\u8cbb\u7528\u6700\u9ad8\u7684\u524d 10 \u500b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d](#retrieve_ten_most_expensive_pipelines) \u90e8\u5206\u7684\u67e5\u8a62\u7d50\u679c\u4e2d\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u552f\u4e00\u7d50\u7b97 ID\u3002## \u67e5\u770b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684 Google Cloud \u8cc7\u6e90\u7684\u8cbb\u7528\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u5217\u51fa\u8cbb\u7528\u6700\u9ad8\u7684\u524d 10 \u500b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d](#retrieve_ten_most_expensive_pipelines) \u90e8\u5206\u7684\u67e5\u8a62\u7d50\u679c\u4e2d\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u552f\u4e00\u7d50\u7b97 ID \u4f86\u67e5\u770b\u8a72\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u751f\u6210\u7684 Google Cloud \u8cc7\u6e90\u7684\u8cbb\u7528\u3002\n\u904b\u884c\u4ee5\u4e0b\u67e5\u8a62\uff0c\u4ee5\u67e5\u770b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u751f\u6210\u7684 Google Cloud \u8cc7\u6e90\u4ee5\u53ca\u6bcf\u9805\u8cc7\u6e90\u7684\u8cbb\u7528\u7684\u5217\u8868\uff1a\n**\u6a19\u6e96 SQL**\n```\nSELECT\u00a0 service,\u00a0 sku,\u00a0 costFROM\u00a0 `project.dataset.gcp_billing_export_v1_XXXXXX_XXXXXX_XXXXXX` B,\u00a0 UNNEST (B.labels) LWHERE\u00a0 DATE(_PARTITIONTIME) >= \u00a0\"START_DATE\"\u00a0 AND DATE(_PARTITIONTIME) < \u00a0\"END_DATE\"\u00a0 AND L.key = \"vertex-ai-pipelines-run-billing-id\"\u00a0 AND L.value = \"PIPELINE_RUN_BILLING_ID\";\n```\n\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- \uff1a\u6642\u9593\u6bb5\u7684\u958b\u59cb\u65e5\u671f\u3002\n- \uff1a\u6642\u9593\u6bb5\u7684\u7d50\u675f\u65e5\u671f\u3002\n- \uff1a [\u5217\u51fa\u8cbb\u7528\u6700\u9ad8\u7684\u524d 10 \u500b\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d](#retrieve_ten_most_expensive_pipelines) \u90e8\u5206\u7684\u67e5\u8a62\u7d50\u679c\u4e2d\u7684\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u552f\u4e00\u7d50\u7b97 ID\u3002\n\u60a8\u61c9\u8a72\u6703\u5728\u67e5\u8a62\u7d50\u679c\u4e2d\u770b\u5230\u5982\u4e0b\u5217\u6578\u64da\uff1a\n- `service.id`\n- `service.description`\n- `sku.id`\n- `sku_description`\n- `cost`\n`cost` \u5217\u8868\u793a\u8207\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684 `sku.id` \u76f8\u5c0d\u61c9\u7684\u8cc7\u6e90\u7684\u8cbb\u7528\u3002", "guide": "Vertex AI"}