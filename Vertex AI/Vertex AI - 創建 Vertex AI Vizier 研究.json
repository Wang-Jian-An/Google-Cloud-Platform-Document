{"title": "Vertex AI - \u5275\u5efa Vertex AI Vizier \u7814\u7a76", "url": "https://cloud.google.com/vertex-ai/docs/vizier/using-vizier?hl=zh-cn", "abstract": "# Vertex AI - \u5275\u5efa Vertex AI Vizier \u7814\u7a76\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528 Python \u5411 Vertex AI Vizier \u767c\u51fa API \u8acb\u6c42\u3002\u5982\u9700\u77ad\u89e3 Vertex AI Vizier \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u8acb\u53c3\u95b1 [Vertex AI Vizier \u6982\u89bd](https://cloud.google.com/vertex-ai/docs/vizier/overview?hl=zh-cn) \u3002\n\u5982\u9700\u67e5\u770b\u5728\u66f4\u5168\u9762\u7684\u5de5\u4f5c\u6d41\u4e2d\u512a\u5316\u591a\u500b\u76ee\u6a19\u7684\u793a\u4f8b\uff0c\u8acb\u5728\u4ee5\u4e0b\u4efb\u4e00\u74b0\u5883\u4e2d\u904b\u884c\u201c\u512a\u5316\u591a\u500b\u76ee\u6a19\u201dJupyter \u7b46\u8a18\u672c\uff1a [\u5728 Colab \u4e2d\u904b\u884c](https://colab.research.google.com/github/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/vizier/gapic-vizier-multi-objective-optimization.ipynb?hl=zh-cn) | [\u5728 Vertex AI Workbench \u7528\u6236\u7ba1\u7406\u7684\u7b46\u8a18\u672c\u4e2d\u6253\u958b](https://console.cloud.google.com/vertex-ai/workbench/deploy-notebook?download_url=https%3A%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fvertex-ai-samples%2Fmain%2Fnotebooks%2Fofficial%2Fvizier%2Fgapic-vizier-multi-objective-optimization.ipynb&hl=zh-cn) | [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/vizier/gapic-vizier-multi-objective-optimization.ipynb)\n", "content": "## \u6e96\u5099\u5de5\u4f5c- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- [\u5b89\u88dd Python \u7248 Vertex AI SDK](https://cloud.google.com/vertex-ai/docs/start/client-libraries?hl=zh-cn) \u3002\n## \u5b9a\u7fa9\u5e38\u91cf\n\u5982\u9700\u5b9a\u7fa9\u5e38\u91cf\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c07 `` \u548c `` \u66ff\u63db\u7232\u60a8\u7684\u5340\u57df\u548c\u9805\u76ee ID\u3002\u5275\u5efa\u60a8\u81ea\u5df1\u7684\u7814\u7a76\u540d\u7a31\u6216\u4f7f\u7528\u5efa\u8b70\u503c\u3002\n```\nimport jsonimport datetimefrom google.cloud import aiplatformREGION = \"REGION\"PROJECT_ID = \"PROJECT_ID\"# The following placeholder variables are automatically filled in.STUDY_DISPLAY_NAME = '{}_study_{}'.format(PROJECT_ID.replace('-', ''), datetime.datetime.now().strftime('%Y%m%d_%H%M%S')) #@param {type: 'string'}ENDPOINT = REGION + '-aiplatform.googleapis.com'PARENT = 'projects/{}/locations/{}'.format(PROJECT_ID, REGION)\n```\n## \u69cb\u5efa API \u8acb\u6c42\n\u4ee5\u4e0b\u547d\u4ee4\u884c API \u8acb\u6c42\u4f7f\u7528 Python \u7de8\u5beb\u3002\n### \u5275\u5efa\u7814\u7a76\n\u7814\u7a76\u662f\u4e00\u7cfb\u5217\u5be6\u9a57\u6216\u8a66\u9a57 \uff0c\u53ef\u5e6b\u52a9\u60a8\u512a\u5316\u8d85\u53c3\u6578\u6216\u53c3\u6578\u3002\n\u4ee5\u4e0b\u793a\u4f8b\u7684\u76ee\u6a19\u662f\u8a08\u7b97 `y = x^2` \u7684\u6700\u5927\u503c\uff0c\u5176\u4e2d `x` \u7684\u7bc4\u570d\u7232 [-10. 10]\u3002\u6b64\u793a\u4f8b\u53ea\u6709\u4e00\u500b\u53c3\u6578\uff0c\u4e26\u4f7f\u7528\u6613\u65bc\u8a08\u7b97\u7684\u51fd\u6578\u4f86\u5e6b\u52a9\u6f14\u793a\u5982\u4f55\u4f7f\u7528 Vertex AI Vizier\u3002\n```\nparam_x = {\u00a0 \u00a0 'parameter_id': 'x',\u00a0 \u00a0 'double_value_spec': {\u00a0 \u00a0 \u00a0 \u00a0 'min_value': -10.0,\u00a0 \u00a0 \u00a0 \u00a0 'max_value': 10.0\u00a0 \u00a0 }}metric_y = {\u00a0 \u00a0 'metric_id': 'y',\u00a0 \u00a0 'goal': 'MAXIMIZE'}study = {\u00a0 \u00a0 'display_name': STUDY_DISPLAY_NAME,\u00a0 \u00a0 'study_spec': {\u00a0 \u00a0 \u00a0 'algorithm': 'RANDOM_SEARCH',\u00a0 \u00a0 \u00a0 'parameters': [param_x],\u00a0 \u00a0 \u00a0 'metrics': [metric_y],\u00a0 \u00a0 }}\n```\n\u5982\u9700\u4f7f\u7528\u7814\u7a76\u914d\u7f6e\u5275\u5efa\u7814\u7a76\uff0c\u8acb\u901a\u904e `VizierServiceClient` \u767c\u9001\u4ee5\u4e0b\u8acb\u6c42\u3002\u4f7f\u7528\u8fd4\u56de\u7684 `STUDY_NAME` \u4f86\u67e5\u8a62\u7814\u7a76\u3002\n```\nvizier_client = aiplatform.gapic.VizierServiceClient(client_options=dict(api_endpoint=ENDPOINT))study = vizier_client.create_study(parent=PARENT, study=study)STUDY_NAME = study.name\n```\n### \u67e5\u770b\u60a8\u7684\u7814\u7a76\n\u5275\u5efa\u7814\u7a76\u5f8c\uff0c\u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\u7684 **\u5be6\u9a57** \u9801\u9762\u4e0a\u627e\u5230\u8a72\u7814\u7a76\u3002\n[\u8f49\u5230\u201c\u5be6\u9a57\u201d\u9801\u9762](https://console.cloud.google.com/vertex-ai/experiments?hl=zh-cn)\n### \u7372\u53d6\u7814\u7a76\u5831\u544a\n\u5982\u9700\u7372\u53d6\u7814\u7a76\uff0c\u8acb\u767c\u9001\u4ee5\u4e0b\u8acb\u6c42\u3002\n```\nvizier_client.get_study({'name': STUDY_NAME})\n```\n### \u5217\u51fa\u7814\u7a76\n\u5982\u9700\u5217\u51fa\u7279\u5b9a\u9805\u76ee\u548c\u5340\u57df\u4e2d\u7684\u7814\u7a76\uff0c\u8acb\u767c\u9001\u4ee5\u4e0b\u8acb\u6c42\uff1a\n```\nvizier_client.list_studies({'parent': PARENT})\n```\n### \u7372\u53d6\u5efa\u8b70\u7684\u8a66\u9a57\n\u5982\u9700\u5f9e Vertex AI Vizier \u7372\u5f97\u8a66\u9a57\u5efa\u8b70\uff0c\u8acb\u5275\u5efa\u4e00\u500b\u5305\u542b `` \u548c `` \u7684\u8acb\u6c42\u3002\u901a\u904e\u767c\u9001\u8acb\u6c42\uff0c\u5c07\u6b64\u4fe1\u606f\u50b3\u905e\u7d66 Vertex AI Vizier\u3002\n\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5275\u5efa\u8acb\u6c42\u3002\u5c07 `` \u66f4\u6539\u7232\u60a8\u5e0c\u671b\u5f9e\u6bcf\u500b\u8acb\u6c42\u4e2d\u7372\u5f97\u7684\u5efa\u8b70\u6578\u91cf\u3002\n```\nsuggest_response = vizier_client.suggest_trials({\u00a0 \u00a0 'parent': STUDY_NAME,\u00a0 \u00a0 'suggestion_count': SUGGEST_COUNT,\u00a0 \u00a0 'client_id': CLIENT_ID\u00a0 \u00a0 })\n```\n`suggest_trials` \u6703\u5553\u52d5\u9577\u6642\u9593\u904b\u884c\u7684\u64cd\u4f5c\u4f86\u751f\u6210\u8a66\u9a57\u3002\u901a\u904e\u5176\u97ff\u61c9\uff0c\u60a8\u53ef\u4ee5\u77ad\u89e3 Vertex AI Vizier \u662f\u5426\u6b63\u5728\u751f\u6210\u8a66\u9a57\u5efa\u8b70\u3002\n\u8981\u7b49\u5f85\u8fd4\u56de\u7684\u7d50\u679c\uff0c\u8acb\u4f7f\u7528 `result()` \u51fd\u6578\u3002\n```\nsuggest_response.result().trials\n```\n\u4ee5\u4e0b\u683c\u5f0f\u986f\u793a\u4e86\u793a\u4f8b\u8a66\u9a57\u3002\u6b64\u8a66\u9a57\u5efa\u8b70\u7232\u53c3\u6578 `x` \u4f7f\u7528\u503c `0.1` \u3002\n```\nname: \"TRIAL_ID\"state: ACTIVEparameters {\u00a0 parameter_id: \"x\"\u00a0 value {\u00a0 \u00a0 number_value: 0.1\u00a0 }}start_time {\u00a0 seconds: 1618011215}\n```\n\u4f7f\u7528\u4e0a\u4e00\u500b\u97ff\u61c9\u4e2d\u7684 `` \u7372\u53d6\u8a66\u9a57\uff1a\n```\nvizier_client.get_trial({\u00a0 \u00a0 \u00a0 \u00a0 'name': TRIAL_ID\u00a0 \u00a0 \u00a0 })\n```\n### \u8a55\u4f30\u6548\u679c\n\u5728\u6536\u5230\u8a66\u9a57\u5efa\u8b70\u5f8c\uff0c\u60a8\u53ef\u4ee5\u8a08\u7b97\u6bcf\u500b\u8a66\u9a57\uff0c\u4e26\u5c07\u6bcf\u500b\u7d50\u679c\u8a18\u9304\u7232\u8a08\u7b97\u7d50\u679c \u3002\n\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5617\u8a66\u512a\u5316\u7684\u51fd\u6578\u7232 `y = x^2` \uff0c\u5247\u4f7f\u7528\u8a66\u9a57\u63d0\u4f9b\u7684 `x` \u7684\u5efa\u8b70\u503c\u4f86\u8a08\u7b97\u51fd\u6578\u3002 \u4f7f\u7528\u5efa\u8b70\u503c `0.1` \uff0c\u51fd\u6578\u7684\u8a08\u7b97\u7d50\u679c\u7232 `y = 0.1 * 0.1` \uff0c\u5f97\u6578\u7232 `0.01` \u3002\n### \u6dfb\u52a0\u8a08\u7b97\u7d50\u679c\n\u6309\u7167\u8a66\u9a57\u5efa\u8b70\u8a08\u7b97\u4ee5\u7372\u5f97\u8a08\u7b97\u7d50\u679c\u5f8c\uff0c\u5c07\u6b64\u8a08\u7b97\u7d50\u679c\u6dfb\u52a0\u5230\u8a66\u9a57\u4e2d\u3002\n\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b58\u5132\u6e2c\u91cf\u7d50\u679c\u4f75\u767c\u9001\u8acb\u6c42\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u5c07 `` \u66ff\u63db\u7232\u6e2c\u91cf\u503c\u3002\u5982\u679c\u60a8\u8981\u512a\u5316\u7684\u51fd\u6578\u662f `y = x^2` \uff0c\u5efa\u8b70\u7684 `x` \u503c\u7232 `0.1` \uff0c\u5247\u7d50\u679c\u7232 `0.01` \u3002\n```\nvizier_client.add_trial_measurement({\u00a0 \u00a0 \u00a0 \u00a0 'trial_name': TRIAL_ID,\u00a0 \u00a0 \u00a0 \u00a0 'measurement': {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'metrics': [{'metric_id': 'y', 'value':RESULT }]\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 })\n```\n**\u6ce8\u610f** \uff1a\u5982\u679c\u8a55\u4f30\u904e\u7a0b\u6d89\u53ca\u591a\u500b\u6b65\u9a5f\uff0c\u4e14\u53ef\u4ee5\u751f\u6210\u591a\u7b87\u4e2d\u9593\u8861\u91cf\u7d50\u679c\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684 `stepCount` \u548c `metrics` \u503c\u5c0d\u8a72\u65b9\u6cd5\u9032\u884c\u591a\u6b21\u8abf\u7528\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u8981\u8a13\u7df4\u6a5f\u5668\u5b78\u7fd2\u6a21\u578b\uff0c\u5247\u53ef\u4ee5\u91dd\u5c0d\u6bcf\u500b [\u9031\u671f](https://developers.google.com/machine-learning/glossary?hl=zh-cn#epoch) \u5831\u544a\u4e2d\u9593\u8a08\u7b97\u7d50\u679c\u3002\n### \u5b8c\u6210\u8a66\u9a57\n\u5728\u7232\u67d0\u500b\u8a66\u9a57\u6dfb\u52a0\u6240\u6709\u8a08\u7b97\u7d50\u679c\u5f8c\uff0c\u60a8\u5fc5\u9808\u901a\u904e\u767c\u9001\u547d\u4ee4\u5b8c\u6210\u8a66\u9a57\u3002\n\u5b8c\u6210\u8a66\u9a57\u5f8c\uff0c\u60a8\u53ef\u4ee5\u767c\u9001\u4e00\u500b\u547d\u4ee4\u4ee5\u50c5\u5b8c\u6210\u8a66\u9a57\uff0c\u4e5f\u53ef\u4ee5\u767c\u9001\u547d\u4ee4\u4f86\u6dfb\u52a0\u6700\u7d42\u8a08\u7b97\u7d50\u679c\u4e26\u5b8c\u6210\u8a66\u9a57\u3002\n\u5982\u9700\u5b8c\u6210\u8a66\u9a57\u4e14\u4e0d\u6dfb\u52a0\u6700\u7d42\u8a08\u7b97\u7d50\u679c\uff0c\u8acb\u767c\u9001\u4ee5\u4e0b\u8acb\u6c42\u3002\n```\nvizier_client.complete_trial({\u00a0 \u00a0 \u00a0 'name': TRIAL_ID\u00a0 })\n```\n\u5982\u9700\u5b8c\u6210\u8a66\u9a57\u4e26\u6dfb\u52a0\u6700\u7d42\u8a08\u7b97\u7d50\u679c\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4e26\u5c07 `` \u66ff\u63db\u7232\u6700\u7d42\u8a08\u7b97\u7d50\u679c\u3002\n```\nvizier_client.complete_trial({\u00a0 \u00a0 \u00a0 'name': TRIAL_ID\u00a0 \u00a0 \u00a0 'final_measurement': {\u00a0 \u00a0 \u00a0 \u00a0 'metrics': [{'metric_id': 'y', 'value': RESULT}]\u00a0 \u00a0 \u00a0 }\u00a0 })\n```\n### \u5217\u51fa\u8a66\u9a57\n\u5982\u9700\u5217\u51fa\u7279\u5b9a\u7814\u7a76\u4e2d\u7684\u8a66\u9a57\uff0c\u8acb\u767c\u9001\u4ee5\u4e0b\u8acb\u6c42\u3002\n```\nvizier_client.list_trials({\u00a0 \u00a0 'parent': STUDY_NAME})\n```\n\u5b8c\u6210\u6240\u6709\u5f85\u8655\u7406\u7684\u8a66\u9a57\u5f8c\uff0c\u60a8\u53ef\u4ee5\u8abf\u7528 `suggestTrials` \u7372\u5f97\u66f4\u591a\u5efa\u8b70\u4e26\u91cd\u8907\u8a66\u9a57\u8a08\u7b97\u904e\u7a0b\u3002\n### \u5217\u51fa\u6700\u512a\u8a66\u9a57\n\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86 `list_optimal_trials` \uff0c\u5b83\u8fd4\u56de\u4e86\u591a\u76ee\u6a19\u7814\u7a76\u7684\u6700\u512a\u8a66\u9a57\uff0c\u6216\u55ae\u76ee\u6a19\u7814\u7a76\u7684\u6700\u4f73\u8a66\u9a57\uff1a\n```\nvizier_client.list_optimal_trials({\u00a0 \u00a0 'parent': STUDY_NAME})\n```\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u67e5\u770b\u76f8\u95dc [\u7814\u7a76](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.studies?hl=zh-cn) \u7684 REST \u53c3\u8003\u6587\u6a94\u3002", "guide": "Vertex AI"}