{"title": "Vertex AI - Understand pipeline run costs", "url": "https://cloud.google.com/vertex-ai/docs/pipelines/understand-pipeline-cost-labels", "abstract": "# Vertex AI - Understand pipeline run costs\nYou can review the cost of your pipeline runs using [Cloud Billing export to BigQuery](/billing/docs/how-to/export-data-bigquery) .\nYou can also use the unique pipeline run billing ID of your pipeline run to review the costs of resources created by the pipeline run, as follows:\n- Vertex AI Pipelines automatically attaches the `vertex-ai-pipelines-run-billing-id` label to your pipeline run. The value of this label is your unique pipeline run billing ID.\n- Vertex AI Pipelines propagates this label to Google Cloud resources generated by pipeline components during the pipeline run. Note that for some components and resources, you need to either upgrade the Google Cloud Pipeline Components SDK or update your component code to propagate the labels. For more information about labeling Google Cloud resources, see [Resource labeling by Vertex AI Pipelines](/vertex-ai/docs/pipelines/gcpc-label-propagation) .\n- The `vertex-ai-pipelines-run-billing-id` label connects the usage of Google Cloud resources generated by the pipeline run in billing reports. Using the value of this label, you can review the cost of the resource usage in the pipeline run with [Cloud Billing export to BigQuery](/billing/docs/how-to/export-data-bigquery) .\nThis page shows you how to do the following:\n- [List your ten most expensive pipeline runs](#retrieve_ten_most_expensive_pipelines) \n- [Use a pipeline run billing ID to locate a pipeline run](#locate_pipeline_run) \n- [Query the costs of Google Cloud resources in a pipeline run from Cloud Billing](#view_pipeline_resources_cost) ", "content": "## Before you begin\nBefore you use Cloud Billing to understand the cost of a pipeline run, use the following instructions to set up your Google Cloud project and development environment:\n- [Set up Cloud Billing data export to BigQuery](/billing/docs/how-to/export-data-bigquery-setup) .\n- [Install v1.0.31 or higher of the Google Cloud Pipeline Components SDK](/vertex-ai/docs/pipelines/components-quickstart#install_latest_release) \nFor more information about the schema of Cloud Billing standard usage cost data, see [Schema of the standard usage cost data](/billing/docs/how-to/export-data-bigquery-tables/standard-usage#usage-cost-export-more-info) .\n## List your ten most expensive pipeline runs\nRun the following query to view a list of your ten most expensive pipeline runs over a specified time period:\n**Standard SQL**\n```\nSELECT\u00a0 project.id,\u00a0 location.region,\u00a0 L.value,\u00a0 SUM(cost) AS total_costFROM\u00a0 `project.dataset.gcp_billing_export_v1_XXXXXX_XXXXXX_XXXXXX` B,\u00a0 UNNEST (B.labels) LWHERE\u00a0 DATE(_PARTITIONTIME) >= \"START_DATE\"\u00a0 AND DATE(_PARTITIONTIME) < \"END_DATE\"\u00a0 AND L.key = \"vertex-ai-pipelines-run-billing-id\"GROUP BY\u00a0 project.id,\u00a0 location.region,\u00a0 L.valueORDER BY\u00a0 total_cost DESCLIMIT\u00a0 10;\n```\nReplace the following:\n- : Start date of the time period.\n- : End date of the time period.\nYou should see the following columns in the query results:\n- `project_id`\n- `region`\n- `pipeline_run_billing_id`\n- `total_cost`\nYou can now use the unique pipeline run billing ID from the `pipeline_run_billing_id` column of the query results to do the following:\n- [Locate or retrieve a pipeline run](#locate_pipeline_run) \n- [View the costs of Google Cloud resources in a pipeline run](#view_pipeline_resources_cost) \n**Tip:** The query results display the pipeline runs in the descending order of the cost. The first row represents the most expensive pipeline run.\n## Use the billing ID to locate a pipeline run\nYou can use the unique pipeline run billing ID from the query results in [List your ten most expensive pipeline runs](#retrieve_ten_most_expensive_pipelines) to locate a pipeline run.\nUse the following instructions to retrieve a pipeline run in the Google Cloud console.- In the Google Cloud console, in the Vertex AI section, go to the **Pipelines** page. [Go to Pipelines](https://console.cloud.google.com/vertex-ai/pipelines) \n- To locate the pipeline run, filter the list using a unique pipeline run billing ID from the query results in [List your ten most expensive pipeline runs](#retrieve_ten_most_expensive_pipelines) . To do this:- Click **Filter** and then click **Labels** .\n- Enter the unique pipeline run billing ID in the following format and press **Enter** : `labels.vertex-ai-pipelines-run-billing-id=` `` where is the unique pipeline run billing ID.\nUse the following code sample to retrieve the pipeline run:\n```\nruns = aip.PipelineJob.list(\u00a0 project=PROJECT_ID,\u00a0 location=LOCATION,\u00a0 filter=\"labels.vertex-ai-pipelines-run-billing-id=PIPELINE_RUN_BILLING_ID\")\n```\nReplace the following:- : The Google Cloud project that this pipeline runs in.\n- : The region that the pipeline runs in. For more information about the regions that Vertex AI Pipelines is available in, see the [Vertex AI locations guide](/vertex-ai/docs/general/locations#feature-availability) .\n- : Unique pipeline run billing ID from the query results in [List your ten most expensive pipeline runs](#retrieve_ten_most_expensive_pipelines) .## View the costs of Google Cloud resources in a pipeline run\nYou can use the unique pipeline run billing ID from the query results in [List your ten most expensive pipeline runs](#retrieve_ten_most_expensive_pipelines) to view the costs of Google Cloud resources generated by the pipeline run.\nRun the following query to view the list of Google Cloud resources generated in a pipeline run, along with the cost of each resource:\n**Standard SQL**\n```\nSELECT\u00a0 service,\u00a0 sku,\u00a0 costFROM\u00a0 `project.dataset.gcp_billing_export_v1_XXXXXX_XXXXXX_XXXXXX` B,\u00a0 UNNEST (B.labels) LWHERE\u00a0 DATE(_PARTITIONTIME) >= \u00a0\"START_DATE\"\u00a0 AND DATE(_PARTITIONTIME) < \u00a0\"END_DATE\"\u00a0 AND L.key = \"vertex-ai-pipelines-run-billing-id\"\u00a0 AND L.value = \"PIPELINE_RUN_BILLING_ID\";\n```\nReplace the following:\n- : Start date of the time period.\n- : End date of the time period.\n- : Unique pipeline run billing ID from the query results in [List your ten most expensive pipeline runs](#retrieve_ten_most_expensive_pipelines) .\nYou should see the following columns in the query results:\n- `service.id`\n- `service.description`\n- `sku.id`\n- `sku_description`\n- `cost`\nThe `cost` column represents the cost of a resource corresponding to the `sku.id` in the pipeline run.", "guide": "Vertex AI"}