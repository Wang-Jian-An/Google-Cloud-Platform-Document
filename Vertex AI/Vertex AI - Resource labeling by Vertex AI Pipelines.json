{"title": "Vertex AI - Resource labeling by Vertex AI Pipelines", "url": "https://cloud.google.com/vertex-ai/docs/pipelines/gcpc-label-propagation", "abstract": "# Vertex AI - Resource labeling by Vertex AI Pipelines\nDepending on the type of component, resource, and the Google Cloud Pipeline Components SDK version, Vertex AI Pipelines either automatically propagates the labels from your pipeline run to the resources generated from Google Cloud Pipeline Components or requires you to label the generated resources. For user-defined components, you need to author your component code to attach the labels from an environment variable. For more information, see [Resources generated from user-defined components](#user_defined_components) .\n", "content": "## Resources with automatic labeling\nVertex AI Pipelines automatically labels the following resources, regardless of the Google Cloud Pipeline Components SDK version:\n### CustomJob resources\nVertex AI Pipelines automatically propagates the labels from your pipeline run to [CustomJob](/vertex-ai/docs/pipelines/customjob-component) resources. This is supported by the following components in all versions of the Google Cloud Pipeline Components SDK:\n- [CustomTrainingJobOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/custom_job.html#v1.custom_job.CustomTrainingJobOp) \n- [create_custom_training_job_from_component](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/custom_job.html#v1.custom_job.create_custom_training_job_from_component) \n- [ForecastingValidationOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/forecasting.html#v1.forecasting.ForecastingValidationOp) \n- [ForecastingPrepareDataForTrainOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/forecasting.html#v1.forecasting.ForecastingPrepareDataForTrainOp) ## Resources with automatic labeling in Google Cloud Pipeline Components SDK v1.0.31 or later\nVertex AI Pipelines automatically labels the following resources if you use Google Cloud Pipeline Components SDK v1.0.31 or later:\n### BatchPredictionJob resources\nVertex AI Pipelines automatically propagates labels from your pipeline run to `BatchPredictionJob` resources generated from the [ModelBatchPredictOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/batch_predict_job.html#v1.batch_predict_job.ModelBatchPredictOp) component if you use v1.0.31 or later of the Google Cloud Pipeline Components SDK.\n### Vertex AI endpoint resources\nVertex AI Pipelines automatically propagates labels from your pipeline run to Vertex AI `endpoint` resources generated from the [EndpointCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/endpoint.html#v1.endpoint.EndpointCreateOp) component if you use v1.0.31 or later of the Google Cloud Pipeline Components SDK.\n### HyperparameterTuningJob resources\nVertex AI Pipelines automatically propagates labels from your pipeline run to `HyperparameterTuningJob` resources generated from the [HyperparameterTuningJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/hyperparameter_tuning_job.html#v1.hyperparameter_tuning_job.HyperparameterTuningJobRunOp) component if you use v1.0.31 or later of the Google Cloud Pipeline Components SDK.\n### Vertex AI dataset resources\nVertex AI Pipelines automatically propagates labels from your pipeline run to Vertex AI dataset resources generated from the following [Vertex AI components](/vertex-ai/docs/pipelines/vertex-automl-component#dataset_operators) if you use v1.0.31 or later of the Google Cloud Pipeline Components SDK:\n- [ImageDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/dataset.html#v1.dataset.ImageDatasetCreateOp) \n- [TabularDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/dataset.html#v1.dataset.TabularDatasetCreateOp) \n- [TextDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/dataset.html#v1.dataset.TextDatasetCreateOp) \n- [TimeSeriesDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/dataset.html#v1.dataset.TimeSeriesDatasetCreateOp) \n- [VideoDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/dataset.html#v1.dataset.VideoDatasetCreateOp) \n### Google Cloud BigQuery Job resources\nVertex AI Pipelines automatically propagates labels from your pipeline run to Google Cloud BigQuery Job resources resources generated from any of the [BigQuery ML components](/vertex-ai/docs/pipelines/gcpc-list#bqml_components) if you use v1.0.31 or later of the Google Cloud Pipeline Components SDK.\n### Google Cloud Dataproc Job resources\nVertex AI Pipelines automatically propagates labels from your pipeline run to Google Cloud Dataproc Job resources resources generated from any of the [Dataproc Serverless components](/vertex-ai/docs/pipelines/gcpc-list#dataproc_sl_components) if you use v1.0.31 or later of the Google Cloud Pipeline Components SDK.\n### TrainingPipeline and Model resources\nVertex AI Pipelines automatically propagates labels from your pipeline run to `TrainingPipeline` and `Model` resources resources generated from the following [AutoML components](/vertex-ai/docs/pipelines/gcpc-list#experimental_automl_components) if you use v1.0.31 or later of the Google Cloud Pipeline Components SDK:\n- [AutoMLImageTrainingJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/automl/training_job.html#v1.automl.training_job.AutoMLImageTrainingJobRunOp) \n- [AutoMLTextTrainingJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/automl/training_job.html#v1.automl.training_job.AutoMLTextTrainingJobRunOp) \n- [AutoMLVideoTrainingJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/automl/training_job.html#v1.automl.training_job.AutoMLVideoTrainingJobRunOp) \n- [AutoMLForecastingTrainingJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/automl/training_job.html#v1.automl.training_job.AutoMLForecastingTrainingJobRunOp) \n### Google Cloud BigQuery table resources\nVertex AI Pipelines automatically propagates labels from your pipeline run Google Cloud BigQuery table resources resources generated from the [ForecastingPreprocessingOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/forecasting.html#v1.forecasting.ForecastingPreprocessingOp) component if you use v1.0.31 or later of the Google Cloud Pipeline Components SDK.\n## Resources without automatic labeling\nVertex AI Pipelines doesn't label the following resources automatically, regardless of the Google Cloud Pipeline Components SDK version:\n### Google Cloud Dataflow resources\nVertex AI Pipelines doesn't automatically label Dataflow resources generated by the [DataflowPythonJobOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/dataflow.html#v1.dataflow.DataflowPythonJobOp) component. You can include instructions in your code to label the resources.\nUse the following code sample to propagate billing labels from your pipeline run to any Google Cloud Dataflow resource generated using the [DataflowPythonJobOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.11.0/api/v1/dataflow.html#v1.dataflow.DataflowPythonJobOp) component:\n```\n\u00a0 import argparse\u00a0 import apache_beam as beam\u00a0 ...\u00a0 def run(argv=None):\u00a0 \u00a0 parser = argparse.ArgumentParser()\u00a0 \u00a0 # Don't add `--labels` to the argument list, so that they will be passed to the pipeline_options \u00a0 \u00a0 parser.add_argument('--input', \u2026)\u00a0 \u00a0 parser.add_argument('--output', \u2026)\u00a0 ...\u00a0 \u00a0 known_args, pipeline_args = parser.parse_known_args(argv)\u00a0 \u00a0 pipeline_options = PipelineOptions(pipeline_args)\u00a0 \u00a0 with beam.Pipeline(options=pipeline_options) as p:\n```\n### Resources generated from user-defined components\nVertex AI Pipelines doesn't automatically label Google Cloud resources generated from user-defined components. You can include instructions in your code to retrieve the labels from the environment variable `VERTEX_AI_PIPELINES_RUN_LABELS` and attach those labels to the Google Cloud resources generated using the component at runtime.\nThe environment variable `VERTEX_AI_PIPELINE_RUN_LABELS` contains the labels in JSON format as key-value pairs.\nFor example: `{ \"label1_key\": \"label1_value\", \"label2_key\": \"label2_value\", ...}`\nIf you're using the Vertex AI SDK for Python, use the following code sample in your component code to propagate labels from the environment variable to a new resource generated from the component:\n```\nimport osimport jsonfrom google.cloud import aiplatformaiplatform.init(\u00a0 project='PROJECT_ID',\u00a0 location='LOCATION')aiplatform.RESOURCE.create(\u00a0 ...\u00a0 json.loads(os.getenv(\"VERTEX_AI_PIPELINES_RUN_LABELS\")))\n```\nReplace the following:\n- : The Google Cloud project that this pipeline runs in.\n- : The location or region that this pipeline runs in.\n- : Google Cloud resource generated from the component, for example, `CustomJob` or `Model` .\nYou can also use the `gcp_labels_util.attach_system_labels` utility if you want to use Python to parse the environment variable. You can use this utility only if you have access to the Google Cloud Pipeline Components library and are using Python. For more information, see the [source code of the utility function in GitHub](https://github.com/kubeflow/pipelines/blob/master/components/google-cloud/google_cloud_pipeline_components/container/v1/gcp_launcher/utils/gcp_labels_util.py) .\n## Resources without labeling support\nVertex AI Pipelines doesn't support billing label propagation to the following resources:\n### ML Metadata resources\nML Metadata resources are billed at the store level. You can't use billing labels to understand the resource-level cost.\n### Cloud Storage resources\nVertex AI Pipelines doesn't propagate billing labels to Cloud Storage resources, such as Cloud Storage buckets.\n## What's next\n- [Understand pipeline run costs](/vertex-ai/docs/pipelines/understand-pipeline-cost-labels)", "guide": "Vertex AI"}