{"title": "Vertex AI - Migrate from user-managed notebooks to Vertex AI Workbench instances", "url": "https://cloud.google.com/vertex-ai/docs/workbench/user-managed/migrate-to-instances", "abstract": "# Vertex AI - Migrate from user-managed notebooks to Vertex AI Workbench instances\n# Migrate from user-managed notebooks to Vertex AI Workbench instances\nVertex AI Workbench user-managed notebooks is [deprecated](/vertex-ai/docs/deprecations) .  On January 30, 2025, support for user-managed notebooks will end and  the ability to create user-managed notebooks instances  will be removed. Existing instances will continue to function  but patches, updates, and upgrades won't be available. To continue using  Vertex AI Workbench, complete the steps on this page to [migrate your user-managed notebooks instances to Vertex AI Workbench instances](/vertex-ai/docs/workbench/user-managed/migrate-to-instances) .\nThis page describes how to migrate from a user-managed notebooks instance to a Vertex AI Workbench instance. You can migrate by using the Vertex AI Workbench migration tool or migrate your instance's data and files manually.\n", "content": "## Overview of the migration tool\nVertex AI Workbench provides a migration tool for migrating from a user-managed notebooks instance to a Vertex AI Workbench instance.\nThe migration tool creates a Vertex AI Workbench instance with a configuration similar to the user-managed notebooks instance that you want to migrate. For example, the migration tool creates an instance that has the same or similar machine type, network configuration, idle shutdown settings, and other specifications. Then, the files on your user-managed notebooks instance's data disk are copied to the Vertex AI Workbench instance.\nVertex AI Workbench doesn't delete or change your user-managed notebooks instance, so after migration you can continue to use it. If you don't need the user-managed notebooks instance anymore, [delete it](#delete) to avoid further charges for that instance.\n## Billing\nIf your user-managed notebooks instance uses Extreme Persistent Disks, then your migration generates charges for I/O operations. See \"Extreme provisioned IOPS\" in the [Persistent Disk and Hyperdisk pricing section ofDisk pricing](/compute/disks-image-pricing#disk) .\nAfter migration, the user-managed notebooks instance still exists and generates charges as before. If you don't need the user-managed notebooks instance anymore, [delete it](#delete) to avoid further charges for that instance.\n## Default migration tool behaviors\nThe Vertex AI Workbench migration tool attempts to migrate your user-managed notebooks instance to a Vertex AI Workbench instance with matching specifications. When a specification in your user-managed notebooks instance isn't available in Vertex AI Workbench instances, Vertex AI Workbench uses a default specification when possible. When the migration tool can't migrate a specification of your user-managed notebooks instance, it doesn't migrate the instance.\nThe following table lists some of the key default migration behaviors for the migration tool.\n| Category  | user-managed notebooks specification  | Migration result                                                       |\n|:-------------|:-------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| OS   | Any Ubuntu version       | Debian 11                                                         |\n| OS   | Any Debian version       | Debian 11                                                         |\n| Framework | Any CUDA version       | CUDA 11.3                                                         |\n| Framework | Any Python version       | Python 3.10                                                         |\n| Framework | Any PyTorch version      | PyTorch 1.13                                                        |\n| Framework | Any TensorFlow version      | TensorFlow 2.11                                                        |\n| Framework | Any R version        | Not migrated; see Add a conda environment                                                 |\n| Framework | Any local PySpark version     | Not migrated; see Add a conda environment                                                 |\n| Framework | Any XGBoost version      | Not migrated; see Add a conda environment                                                 |\n| Framework | Any Kaggle Python version     | Not migrated; see Add a conda environment                                                 |\n| Framework | Any Jax version       | Not migrated; see Add a conda environment                                                 |\n| Framework | Any Apache Beam version     | Not migrated; see Add a conda environment                                                 |\n| Machine type | A supported machine type     | Identical machine type                                                      |\n| Machine type | An unsupported machine type    | e2-standard-4                                                        |\n| Accelerators | Supported accelerators      | Identical accelerators                                                      |\n| Accelerators | Unsupported accelerators     | Migration doesn't include accelerators                                                  |\n| Setting  | Idle shutdown        | Migrated                                                         |\n| Setting  | Delete to trash       | Migrated                                                         |\n| Setting  | nbconvert         | Migrated                                                         |\n| Setting  | File downloading       | Migrated                                                         |\n| Setting  | Terminal access       | Migrated                                                         |\n| Other  | Identity and Access Management permissions | Migrated, though new permissions might be required to use the Vertex AI Workbench instance                                     |\n| Other  | Access mode        | Migrated                                                         |\n| Other  | Network         | Migrated                                                         |\n| Other  | Post-startup script      | When using the Google Cloud console, the instance is migrated without the post-startup script; to migrate the instance with the post-startup script, use the Google Cloud CLI or REST API to specify the PostStartupScriptOption option |\n| Other  | Dataproc Hub        | Not migrated; must migrate manually                                                   |\n## Specifying the post-startup script\nUser-managed notebooks instances that use a post-startup script must be migrated to an instance with the [PostStartupScriptOption](/vertex-ai/docs/workbench/reference/rest/v1/projects.locations.instances/migrate#poststartupscriptoption) option specified. Use this option to indicate whether you want to skip or rerun the post-startup script in your new Vertex AI Workbench instance.\nSpecifying the `PostStartupScriptOption` option isn't supported in the Google Cloud console. To specify the `PostStartupScriptOption` option when you migrate your user-managed notebooks instance, you must use the Google Cloud CLI or REST API.\n## Before you begin\n- If you haven't already, [create a user-managed notebooks instance](/vertex-ai/docs/workbench/user-managed/create-new#create-with-options) .\n### Required roles\nTo ensure that your user account has the necessary  permissions to migrate a user-managed notebooks instance to a Vertex AI Workbench instance,   ask your administrator to grant your user account the   Notebooks Runner ( [roles/notebooks.runner](/vertex-ai/docs/workbench/user-managed/iam#notebooks.runner) ) IAM role on the project.    For more information about granting roles, see [Manage access](/iam/docs/granting-changing-revoking-access) .\nThis predefined role contains     the permissions required to migrate a user-managed notebooks instance to a Vertex AI Workbench instance. To see the exact permissions that are   required, expand the **Required permissions** section:\nYour administrator might also be able to give your user account   these permissions  with [custom roles](/iam/docs/creating-custom-roles) or  other [predefined roles](/iam/docs/understanding-roles) .\n## Pre-migration check\nBefore you migrate, check your user-managed notebooks instance's migration eligibility by listing your instances and checking the output for any migration warnings or errors.\n### List your instances\nTo list your user-managed notebooks instances that aren't migrated yet, use the [projects.locations.instances.list](/vertex-ai/docs/workbench/reference/rest/v1/projects.locations.instances/list) method with the filter `migrated:false` . You can list them by using the gcloud CLI or REST API:\nBefore using any of the command data below, make the following replacements:- ``: Your project ID\n- ``: The region where your user-managed notebooks instance is located, or use`-`to list instances from all regions\nExecute the  following  command:\nBefore using any of the request data, make the following replacements:- ``: Your project ID\n- ``: The region where your user-managed notebooks instance is located, or use`-`to list instances from all regions\nHTTP method and URL:\n```\nGET https://notebooks.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/instances?filter=migrated:false\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nExecute the following command:\n```\ncurl -X GET \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ \"https://notebooks.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/instances?filter=migrated:false\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nExecute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method GET ` -Headers $headers ` -Uri \"https://notebooks.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/instances?filter=migrated:false\" | Select-Object -Expand Content\n```\n### Check the output for warnings or errors\nIf migration warnings or errors are detected, the output of the `projects.locations.instances.list` method includes this information.\nWarnings appear when specific components in your user-managed notebooks instance's configuration won't migrate to the same specification in a Vertex AI Workbench instance. For example, if your user-managed notebooks instance uses an unsupported accelerator, a warning appears in the output. In this case, the instance is migrated without any accelerators. You can attach accelerators after migration. Review the warnings in the output, consider the [migration tool's default behaviors](#defaults) , and assess whether the migration tool is acceptable for your migration.\nOne or more errors in the output means that you can't migrate the user-managed notebooks instance by using the migration tool. You must [migrate the instance manually](#migrate-manual) .\nFor more information about migration warnings and errors, see [warnings](/vertex-ai/docs/workbench/reference/rest/v1/projects.locations.instances#warning) and [errors](/vertex-ai/docs/workbench/reference/rest/v1/projects.locations.instances#error) in the `InstanceMigrationEligibility` documentation.\n## Migrate by using the migration tool\nYou can migrate your user-managed notebooks instance by using the Google Cloud console, the gcloud CLI, or REST API.\n- In the Google Cloud console, go to the **User-managed notebooks** page. [Go to User-managed notebooks](https://console.cloud.google.com/vertex-ai/workbench/user-managed) \n- Click the **Migrate** button.\n- On the **Migrate user-managed notebooks to instances** page, on the **Ready** tab, select the instance that you want to migrate.\n- Click **Migrate** .\n- After the migration is finished, go to the **Instances** page to view your new Vertex AI Workbench instance. [Go to Instances](https://console.cloud.google.com/vertex-ai/workbench/instances) Before using any of the command data below, make the following replacements:- ``: Your project ID\n- ``: The region where your user-managed notebooks instance is located\n- ``: The ID of the user-managed notebooks instance\n- ``: Optional: One of the [post-startup script options](/vertex-ai/docs/workbench/reference/rest/v1/projects.locations.instances/migrate#poststartupscriptoption) \nExecute the  following  command:\nBefore using any of the request data, make the following replacements:- ``: Your project ID\n- ``: The region where your user-managed notebooks instance is located\n- ``: The ID of the user-managed notebooks instance\n- ``: Optional: One of the [post-startup script options](/vertex-ai/docs/workbench/reference/rest/v1/projects.locations.instances/migrate#poststartupscriptoption) \nHTTP method and URL:\n```\nPOST https://notebooks.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/instances/INSTANCE_ID:migrate\n```\nRequest JSON body:\n```\n{\n \"postStartupScriptOption\": (POST_STARTUP_SCRIPT_OPTION)\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X POST \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://notebooks.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/instances/INSTANCE_ID:migrate\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method POST ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://notebooks.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/instances/INSTANCE_ID:migrate\" | Select-Object -Expand Content\n```\n## Migrate manually\nTo migrate your instance to a Vertex AI Workbench instance manually, consider using the following methods:\n- **Use Cloud Storage and the terminal** : Copy your data and files to Cloud Storage and then to another instance by using the terminal.\n- **Use GitHub** : Copy your data and files to a GitHub repository by using the Git extension for JupyterLab.\nThis guide describes how to migrate data and files by using Cloud Storage and the terminal.\n### Requirements\nYou must have terminal access to your user-managed notebooks instance. Terminal access is manually set when you create an instance. The terminal access setting cannot be changed after the instance is created.\n### Migrate manually by using Cloud Storage and the terminal\nTo migrate data and files to a new Vertex AI Workbench instance by using Cloud Storage and the terminal, do the following.\n- [Create a Cloud Storage bucket](/storage/docs/creating-buckets) in the same project where your user-managed notebooks instance is located.\n- In that same project, [Createa Vertex AI Workbench instance](/vertex-ai/docs/workbench/instances/create) to migrate your data to. When you create this instance:- Enable terminal access.\n- Specify the machine type, network, and other characteristics to match what you need.\n- In your user-managed notebooks instance's JupyterLab interface, select **File\u00a0>New\u00a0> Terminal** to open a terminal window.\n- Use the [gsutil tool](/storage/docs/gsutil) to copy your user data to a Cloud Storage bucket. The following example command copies all of the files from your instance's `/home/jupyter/` directory to a directory in a Cloud Storage bucket.```\ngsutil cp -R /home/jupyter/* gs://BUCKET_NAMEPATH\n```Replace the following:- ``: The name of your Cloud Storage bucket\n- ``: The path to the directory where you want to copy your files, for example:`/copy/jupyter/`\n- In your new Vertex AI Workbench instance's JupyterLab interface, select **File\u00a0>New\u00a0> Terminal** to open a terminal window.\n- Use the `gsutil tool` to copy your data to the new instance. The following example command copies all of the files from a Cloud Storage directory to the your new instance's `/home/jupyter/` directory.```\ngsutil cp gs://BUCKET_NAMEPATH* /home/jupyter/\n```## Confirm the migration\nAfter the migration, the original user-managed notebooks instance continues to work as before. Confirm that your migration was a success before you delete the original instance.\n## Delete the user-managed notebooks instance\nIf you don't need the user-managed notebooks instance that you migrated from, delete it to avoid further charges for that instance.\n- In the Google Cloud console, go to the **User-managed notebooks** page. [Go to User-managed notebooks](https://console.cloud.google.com/vertex-ai/workbench/user-managed) \n- Select the instance that you want to delete.\n- Click delete **Delete** . (Depending on the size of your window, the **Delete** button might be in the more_vert options menu.)\n- To confirm, click **Delete** .## Troubleshoot\nTo find methods for diagnosing and resolving migration issues, see [TroubleshootingVertex AI Workbench](/vertex-ai/docs/general/troubleshooting-workbench#migrating-to-instances-user-managed) .\n## What's next\n- Learn more about [Vertex AI Workbench instances](/vertex-ai/docs/workbench/instances/introduction) .", "guide": "Vertex AI"}