{"title": "Vertex AI - Search using embeddings", "url": "https://cloud.google.com/vertex-ai/docs/featurestore/latest/embeddings-search", "abstract": "# Vertex AI - Search using embeddings\n**    Preview     ** This feature is subject to the \"Pre-GA Offerings Terms\" in the General Service Terms section   of the [Service Specific Terms](/terms/service-terms#1) .     Pre-GA features are available \"as is\" and might have limited support.    For more information, see the [launch stage descriptions](/products#product-launch-stages) .\nIf you've configured your online store to support embeddings, you can perform a vector similarity search to retrieve a list of semantically similar or related entities, also called approximate nearest neighbors. You can search based on either an entity ID or an embedding.\nTo search for approximate nearest neighbors, you need to first do the following:\n- Set up the BigQuery data source to support embeddings by including the `embedding` column. Optionally, include filtering and crowding columns. For more information, see [Data source preparation guidelines](/vertex-ai/docs/featurestore/latest/prepare-data-source#guidelines) .\n- Create an online store instance that supports embedding management. For more information about how to create an online store instance that supports embedding management, see [Configure embedding management for an online store](/vertex-ai/docs/featurestore/latest/create-onlinestore#config-embedding) .\n- Specify the `embedding` column while creating the feature view. For more information about how to create a feature view that supports embeddings, see [Configure vector retrieval for a feature view](/vertex-ai/docs/featurestore/latest/create-featureview#configure-vectorretrieval) .\nThis page describes how you can do the following:\n- [Retrieve the public endpoint domain name for the online store](#retrieve-publicendpoint) \n- [Retrieve nearest neighbor matches of an embedding](#search-embeddingvalue) \n- [Retrieve nearest neighbor matches of an entity](#search-entityid) ", "content": "## Retrieve the public endpoint domain name for the online store\nWhen you create and configure an online store instance for embedding management, Vertex AI Feature Store generates a public endpoint domain name for the online store. Before you can start searching for nearest neighbors from a feature view in the online store, you must retrieve the public endpoint domain name from the online store details.\nUse the following sample to retrieve the details of an online store instance.\nTo retrieve the details of a [FeatureOnlineStore](/vertex-ai/docs/reference/rest/v1beta1/projects.locations.featureOnlineStores#resource:-featureOnlineStore) resource in your project, send a `GET` request by using the [featureOnlineStores.get](/vertex-ai/docs/reference/rest/v1beta1/projects.locations.featureOnlineStores/get) method.\nBefore using any of the request data, make the following replacements:- : Region where the online store is located, such as`us-central1`.\n- : Your project ID.\n- : The name of the online store instance.\nHTTP method and URL:\n```\nGET https://LOCATION_ID-aiplatform.googleapis.com/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nExecute the following command:\n```\ncurl -X GET \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ \"https://LOCATION_ID-aiplatform.googleapis.com/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nExecute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method GET ` -Headers $headers ` -Uri \"https://LOCATION_ID-aiplatform.googleapis.com/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"name\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME_1\",\n \"createTime\": \"2023-09-06T23:25:04.256314Z\",\n \"updateTime\": \"2023-09-06T23:25:04.256314Z\",\n \"etag\": \"AMEw9yMgoV0bAsYuKwVxz4Y7lOmxV7riNVHg217KaQAKORqvdqGCrQ1DIt8yHgoGXf8=\",\n \"state\": \"STABLE\",\n \"dedicatedServingEndpoint\": {\n \"publicEndpointDomainName\": \"PUBLIC_ENDPOINT_DOMAIN_NAME\"\n },\n \"optimized\": {}\n}\n```\nYou'll need the from the response to retrieve approximate nearest neighbors in the following step.\n## Retrieve approximate nearest neighbors of an embedding\nUse the following sample to use an embedding to perform search for semantically related entities by specifying an embedding.\nTo search nearest neighbors for an embedding, send a `POST` request by using the [featureViews.searchNearestEntities](/vertex-ai/docs/reference/rest/v1beta1/projects.locations.featureOnlineStores.featureViews/searchNearestEntities) method.\nBefore using any of the request data, make the following replacements:- : The public endpoint domain name for the online store instance that you retrieved using the [featureOnlineStores.get](/vertex-ai/docs/reference/rest/v1beta1/projects.locations.featureOnlineStores/get) method.\n- : Your project ID.\n- : Region where the online store instance is located, such as`us-central1`.\n- : The name of the online store instance containing the feature view where you want to search for approximate nearest neighbor matches.\n- : The name of the feature view where you want to search for approximate nearest neighbor matches.\n- : Embedding for which you want to retrieve approximate nearest neighbor matches. An embedding is represented by an array of`double`values.\n- : Optional: Specify whether you want to include or exclude the features for the entities in the response. To include the features along with the entities in the response, enter`true`. The default value is`false`.\n- : Number of approximate nearest neighbors you want to retrieve.\nHTTP method and URL:\n```\nPOST https://PUBLIC_ENDPOINT_DOMAIN_NAME/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME/featureViews/FEATUREVIEW_NAME:searchNearestEntities\n```\nRequest JSON body:\n```\n{\n \"query\": {\n \"embedding\": {\n  \"value\": EMBEDDING\n },\n \"neighbor_count\": NEIGHBOR_COUNT\n },\n \"return_full_entity\": BOOLEAN\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X POST \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://PUBLIC_ENDPOINT_DOMAIN_NAME/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME/featureViews/FEATUREVIEW_NAME:searchNearestEntities\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method POST ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://PUBLIC_ENDPOINT_DOMAIN_NAME/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME/featureViews/FEATUREVIEW_NAME:searchNearestEntities\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"nearestNeighbors\": {\n \"neighbors\": [ {\n  \"entityId\": \"305281\",\n  \"distance\": -41.115459442138672\n },\n {\n  \"entityId\": \"80280\",\n  \"distance\": -38.703567504882812\n },\n {\n  \"entityId\": \"80280\",\n  \"distance\":-38.703567504882812\n },\n {\n  \"entityId\": \"903779\",\n  \"distance\": -38.214759826660156\n },\n {\n  \"entityId\": \"1008145\",\n  \"distance\": -36.271354675292969\n },\n {\n  \"entityId\": \"606431\",\n  \"distance\": -34.791431427001953\n } ]\n }\n}\n```\n## Retrieve approximate nearest neighbors of an entity\nUse the following sample to use an embedding to perform search for semantically related entities by specifying an entity ID.\nTo search nearest neighbors for an entity ID, send a `POST` request by using the [featureViews.searchNearestEntities](/vertex-ai/docs/reference/rest/v1beta1/projects.locations.featureOnlineStores.featureViews/searchNearestEntities) method.\nBefore using any of the request data, make the following replacements:- : The public endpoint domain name for the online store instance that you retrieved using the [featureOnlineStores.get](/vertex-ai/docs/reference/rest/v1beta1/projects.locations.featureOnlineStores/get) method.\n- : Your project ID.\n- : Region where the online store instance is located, such as`us-central1`.\n- : The name of the online store instance containing the feature view where you want to search for approximate nearest neighbor matches.\n- : The name of the feature view where you want to search for approximate nearest neighbor matches.\n- : Entity ID of the entity for which you want to retrieve approximate nearest neighbor matches.\n- : Optional: Specify whether you want to include or exclude the features for the entities in the response. To include the features along with the entities in the response, enter`true`. The default value is`false`.\n- : Number of approximate nearest neighbors you want to retrieve.\nHTTP method and URL:\n```\nPOST https://PUBLIC_ENDPOINT_DOMAIN_NAME/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME/featureViews/FEATUREVIEW_NAME:searchNearestEntities\n```\nRequest JSON body:\n```\n{\n \"query\": {\n \"entity_id\": ENTITY_ID,\n \"neighbor_count\": NEIGHBOR_COUNT\n },\n \"return_full_entity\": BOOLEAN\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X POST \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://PUBLIC_ENDPOINT_DOMAIN_NAME/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME/featureViews/FEATUREVIEW_NAME:searchNearestEntities\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method POST ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://PUBLIC_ENDPOINT_DOMAIN_NAME/v1beta1/projects/PROJECT_ID/locations/LOCATION_ID/featureOnlineStores/FEATUREONLINESTORE_NAME/featureViews/FEATUREVIEW_NAME:searchNearestEntities\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"nearestNeighbors\": {\n \"neighbors\": [ {\n  \"entityId\": \"305281\",\n  \"distance\": -41.115459442138672\n },\n {\n  \"entityId\": \"80280\",\n  \"distance\": -38.703567504882812\n },\n {\n  \"entityId\": \"80280\",\n  \"distance\":-38.703567504882812\n },\n {\n  \"entityId\": \"903779\",\n  \"distance\": -38.214759826660156\n },\n {\n  \"entityId\": \"1008145\",\n  \"distance\": -36.271354675292969\n },\n {\n  \"entityId\": \"606431\",\n  \"distance\": -34.791431427001953\n } ]\n }\n}\n```", "guide": "Vertex AI"}