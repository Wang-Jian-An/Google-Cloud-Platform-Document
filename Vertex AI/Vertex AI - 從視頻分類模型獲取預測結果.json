{"title": "Vertex AI - \u5f9e\u8996\u983b\u5206\u985e\u6a21\u578b\u7372\u53d6\u9810\u6e2c\u7d50\u679c", "url": "https://cloud.google.com/vertex-ai/docs/video-data/classification/get-predictions?hl=zh-cn", "abstract": "# Vertex AI - \u5f9e\u8996\u983b\u5206\u985e\u6a21\u578b\u7372\u53d6\u9810\u6e2c\u7d50\u679c\n\u672c\u9801\u9762\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u6216 Vertex AI API \u5f9e\u8996\u983b\u5206\u985e\u8b58\u5225\u6a21\u578b\u7372\u53d6 \u3002\u6279\u91cf\u9810\u6e2c\u662f\u7570\u6b65\u8acb\u6c42\u3002\u60a8\u53ef\u4ee5\u76f4\u63a5\u5f9e\u6a21\u578b\u8cc7\u6e90\u8acb\u6c42\u6279\u91cf\u9810\u6e2c\uff0c\u800c\u7121\u9700\u5c07\u6a21\u578b\u90e8\u7f72\u5230\u7aef\u9ede\u3002\nAutoML \u8996\u983b\u6a21\u578b\u4e0d\u652f\u6301\u5728\u7dda\u9810\u6e2c\u3002\n", "content": "## \u9032\u884c\u6279\u91cf\u9810\u6e2c\n\u5982\u9700\u767c\u51fa\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\uff0c\u8acb\u6307\u5b9a [\u8f38\u5165\u6e90](#input_data) \u548c Vertex AI \u5b58\u5132\u9810\u6e2c\u7d50\u679c\u6240\u63a1\u7528\u7684 [\u8f38\u51fa\u683c\u5f0f](#output_format) \u3002\n**\u6ce8\u610f** \uff1a\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u5275\u5efa\u6279\u91cf\u9810\u6e2c\u6642\uff0c\u7232\u4e86\u6700\u5927\u9650\u5ea6\u5730\u6e1b\u5c11\u8655\u7406\u6642\u9593\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u9078\u64c7\u7684\u8f38\u5165\u548c\u8f38\u51fa\u4f4d\u7f6e\u8207\u6a21\u578b\u4f4d\u65bc\u540c\u4e00\u5340\u57df\u3002\u5982\u679c\u4f7f\u7528 API \u5275\u5efa\u6279\u91cf\u9810\u6e2c\uff0c\u8acb\u5411\u4f4d\u65bc\u8f38\u5165\u548c\u8f38\u51fa\u4f4d\u7f6e\u6240\u5728\u5340\u57df\u6216\u5728\u5730\u7406\u4f4d\u7f6e\u4e0a\u9760\u8fd1\u8f38\u5165\u548c\u8f38\u51fa\u4f4d\u7f6e\u7684\u670d\u52d9\u7aef\u9ede\uff08\u4f8b\u5982 `https://us-central1-aiplatform.googleapis.com` \uff09\u767c\u9001\u8acb\u6c42\u3002\n### \u8f38\u5165\u6578\u64da\u8981\u6c42\n\u6279\u91cf\u8acb\u6c42\u7684\u8f38\u5165\u6307\u5b9a\u8981\u767c\u9001\u5230\u6a21\u578b\u9032\u884c\u9810\u6e2c\u7684\u5167\u5bb9\u3002AutoML \u8996\u983b\u6a21\u578b\u985e\u578b\u7684\u6279\u91cf\u9810\u6e2c\u4f7f\u7528 JSON \u884c\u6587\u4ef6\u6307\u5b9a\u8981\u9032\u884c\u9810\u6e2c\u7684\u8996\u983b\u5217\u8868\uff0c\u7136\u5f8c\u5c07 JSON \u884c\u6587\u4ef6\u5b58\u5132\u5728 Cloud Storage \u5b58\u5132\u6876\u4e2d\u3002\u60a8\u53ef\u4ee5\u7232 `timeSegmentEnd` \u5b57\u6bb5\u6307\u5b9a `Infinity` \uff0c\u4ee5\u6307\u5b9a\u8996\u983b\u672b\u5c3e\u3002\u4ee5\u4e0b\u793a\u4f8b\u986f\u793a\u4e86\u8f38\u5165 JSON \u884c\u6587\u4ef6\u4e2d\u7684\u4e00\u884c\u3002\n```\n{'content': 'gs://sourcebucket/datasets/videos/source_video.mp4', 'mimeType': 'video/mp4', 'timeSegmentStart': '0.0s', 'timeSegmentEnd': '2.366667s'}\n```\n### \u8acb\u6c42\u6279\u91cf\u9810\u6e2c\n\u5c0d\u65bc\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u6216 Vertex AI API\u3002\u6279\u91cf\u9810\u6e2c\u4efb\u52d9\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u6642\u9593\u624d\u80fd\u5b8c\u6210\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u63d0\u4ea4\u7684\u8f38\u5165\u6578\u64da\u9805\u6578\u91cf\u3002\n\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u8acb\u6c42\u6279\u91cf\u9810\u6e2c\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80 **\u6279\u91cf\u9810\u6e2c** \u9801\u9762\u3002 [\u524d\u5f80\u201c\u6279\u91cf\u9810\u6e2c\u201d\u9801\u9762](https://console.cloud.google.com/vertex-ai/batch-predictions?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa** \u4ee5\u6253\u958b **\u65b0\u5efa\u6279\u91cf\u9810\u6e2c** \u7a97\u53e3\uff0c\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9a5f\uff1a- \u8f38\u5165\u6279\u91cf\u9810\u6e2c\u7684\u540d\u7a31\u3002\n- \u5c0d\u65bc **\u6a21\u578b\u540d\u7a31** \uff0c\u9078\u64c7\u8981\u7528\u65bc\u6b64\u6279\u91cf\u9810\u6e2c\u7684\u6a21\u578b\u7684\u540d\u7a31\u3002\n- \u5c0d\u65bc **\u4f86\u6e90\u8def\u5f91** \uff0c\u6307\u5b9a JSON \u884c\u8f38\u5165\u6587\u4ef6\u6240\u5728\u7684 Cloud Storage \u4f4d\u7f6e\u3002\n- \u5c0d\u65bc **\u76ee\u6a19\u8def\u5f91** \uff0c\u6307\u5b9a\u5b58\u5132\u6279\u91cf\u9810\u6e2c\u7d50\u679c\u7684 Cloud Storage \u4f4d\u7f6e\u3002 **\u8f38\u51fa** \u683c\u5f0f\u53d6\u6c7a\u65bc\u6a21\u578b\u7684\u76ee\u6a19\u3002\u7528\u65bc\u5716\u7247\u76ee\u6a19\u7684 AutoML \u6a21\u578b\u6703\u8f38\u51fa JSON \u884c\u6587\u4ef6\u3002\n\u4f7f\u7528 Vertex AI API \u767c\u9001\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5b58\u5132\u6a21\u578b\u548c\u57f7\u884c\u6279\u91cf\u9810\u6e2c\u4f5c\u696d\u7684\u5340\u57df\u3002\u4f8b\u5982`us-central1`\u3002\n- \uff1a\u60a8\u7684 [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \n- \uff1a\u6279\u8655\u7406\u4f5c\u696d\u7684\u986f\u793a\u540d\n- \uff1a\u7528\u65bc\u57f7\u884c\u9810\u6e2c\u7684\u6a21\u578b\u7684 ID\n- \uff08\u53ef\u9078\uff09\uff1a\u6a21\u578b\u50c5\u8fd4\u56de\u7f6e\u4fe1\u5ea6\u5206\u6578\u81f3\u5c11\u7232\u6b64\u503c\u7684\u9810\u6e2c\n- \uff08\u53ef\u9078\uff09\uff1a\u4e00\u500b\u5e03\u723e\u503c\uff0c\u7528\u65bc\u78ba\u5b9a\u662f\u5426\u8acb\u6c42\u7247\u6bb5\u7d1a\u5206\u985e\u3002Vertex AI \u6703\u8fd4\u56de\u60a8\u5728\u8f38\u5165\u5be6\u4f8b\u4e2d\u6307\u5b9a\u7684\u8996\u983b\u7684\u6574\u500b\u6642\u9593\u6bb5\u7684\u6a19\u7c64\u53ca\u5176\u7f6e\u4fe1\u5ea6\u5206\u6578\u3002\u9ed8\u8a8d\u503c\u7232`true`\u3002\n- \uff08\u53ef\u9078\uff09\uff1a\u4e00\u500b\u5e03\u723e\u503c\uff0c\u7528\u65bc\u78ba\u5b9a\u662f\u5426\u8acb\u6c42\u93e1\u982d\u7d1a\u5206\u985e\u3002Vertex AI \u78ba\u5b9a\u60a8\u5728\u8f38\u5165\u5be6\u4f8b\u4e2d\u6307\u5b9a\u7684\u8996\u983b\u7684\u6574\u500b\u6642\u9593\u6bb5\u4e2d\u6bcf\u500b\u93e1\u982d\u7684\u908a\u754c\u3002\u7136\u5f8c\uff0cVertex AI \u6703\u8fd4\u56de\u6bcf\u500b\u6aa2\u6e2c\u5230\u7684\u93e1\u982d\u7684\u6a19\u7c64\u53ca\u5176\u7f6e\u4fe1\u5ea6\u5206\u6578\uff0c\u4ee5\u53ca\u93e1\u982d\u7684\u958b\u59cb\u548c\u7d50\u675f\u6642\u9593\u3002\u9ed8\u8a8d\u503c\u7232`false`\u3002\n- \uff08\u53ef\u9078\uff09\uff1a\u4e00\u500b\u5e03\u723e\u503c\uff0c\u7528\u65bc\u78ba\u5b9a\u662f\u5426\u4ee5 1 \u79d2\u9418\u7232\u9593\u9694\u8acb\u6c42\u8996\u983b\u5206\u985e\u3002Vertex AI \u6703\u8fd4\u56de\u60a8\u5728\u8f38\u5165\u5be6\u4f8b\u4e2d\u6307\u5b9a\u7684\u8996\u983b\u7684\u6574\u500b\u6642\u9593\u6bb5\u4e2d\u6bcf\u4e00\u79d2\u7684\u6a19\u7c64\u53ca\u5176\u7f6e\u4fe1\u5ea6\u5206\u6578\u3002\u9ed8\u8a8d\u503c\u7232`false`\u3002\n- \uff1a\u8f38\u5165 JSON \u884c\u6587\u4ef6\u6240\u5728\u7684 Cloud Storage URI\u3002\n- \uff1a\u60a8\u7684 Cloud Storage \u5b58\u5132\u6876\n- \uff1a\u81ea\u52d5\u751f\u6210\u7684 [\u9805\u76ee\u7de8\u865f](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"displayName\": \"BATCH_JOB_NAME\",\n \"model\": \"projects/PROJECT_ID/locations/LOCATION_ID/models/MODEL_ID\",\n \"modelParameters\": {\n  \"confidenceThreshold\": THRESHOLD_VALUE,\n  \"segmentClassification\": SEGMENT_CLASSIFICATION,\n  \"shotClassification\": SHOT_CLASSIFICATION,\n  \"oneSecIntervalClassification\": ONE_SEC_INTERVAL_CLASSIFICATION\n },\n \"inputConfig\": {\n  \"instancesFormat\": \"jsonl\",\n  \"gcsSource\": {\n   \"uris\": [\"URI\"],\n  },\n },\n \"outputConfig\": {\n  \"predictionsFormat\": \"jsonl\",\n  \"gcsDestination\": {\n   \"outputUriPrefix\": \"OUTPUT_BUCKET\",\n  },\n },\n}\n```\n\u5982\u9700\u767c\u9001\u8acb\u6c42\uff0c\u8acb\u9078\u64c7\u4ee5\u4e0b\u65b9\u5f0f\u4e4b\u4e00\uff1a\n **\u6ce8\u610f** \uff1a\u4ee5\u4e0b\u547d\u4ee4\u5047\u5b9a\u60a8\u5df2\u4f7f\u7528\u60a8\u7684\u7528\u6236\u8cec\u865f\u901a\u904e\u904b\u884c [gcloud init](https://cloud.google.com/sdk/gcloud/reference/init?hl=zh-cn) \u6216 [gcloud auth login](https://cloud.google.com/sdk/gcloud/reference/auth/login?hl=zh-cn) \u767b\u9304`gcloud`CLI\uff0c\u6216\u8005\u4f7f\u7528\u4e86 [Cloud Shell](https://cloud.google.com/shell/docs?hl=zh-cn) \uff0c\u9019\u6703\u4f7f\u60a8\u81ea\u52d5\u767b\u9304`gcloud`CLI\u3002\u60a8\u53ef\u4ee5\u904b\u884c [gcloud auth list](https://cloud.google.com/sdk/gcloud/reference/auth/list?hl=zh-cn) \u4f86\u6aa2\u67e5\u7576\u524d\u6d3b\u8e8d\u7684\u8cec\u865f\u3002\n\u5c07\u8acb\u6c42\u6b63\u6587\u4fdd\u5b58\u5728\u540d\u7232 `request.json` \u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u5f8c\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ncurl -X POST \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\"\n``` **\u6ce8\u610f** \uff1a\u4ee5\u4e0b\u547d\u4ee4\u5047\u5b9a\u60a8\u5df2\u4f7f\u7528\u60a8\u7684\u7528\u6236\u8cec\u865f\u901a\u904e\u904b\u884c [gcloud init](https://cloud.google.com/sdk/gcloud/reference/init?hl=zh-cn) \u6216 [gcloud auth login](https://cloud.google.com/sdk/gcloud/reference/auth/login?hl=zh-cn) \u767b\u9304`gcloud`CLI\uff0c\u6216\u8005\u4f7f\u7528\u4e86 [Cloud Shell](https://cloud.google.com/shell/docs?hl=zh-cn) \uff0c\u9019\u6703\u4f7f\u60a8\u81ea\u52d5\u767b\u9304`gcloud`CLI\u3002\u60a8\u53ef\u4ee5\u904b\u884c [gcloud auth list](https://cloud.google.com/sdk/gcloud/reference/auth/list?hl=zh-cn) \u4f86\u6aa2\u67e5\u7576\u524d\u6d3b\u8e8d\u7684\u8cec\u865f\u3002\n\u5c07\u8acb\u6c42\u6b63\u6587\u4fdd\u5b58\u5728\u540d\u7232 `request.json` \u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u5f8c\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method POST ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\" | Select-Object -Expand Content\n```\n\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_NUMBER/locations/us-central1/batchPredictionJobs/BATCH_JOB_ID\",\n \"displayName\": \"BATCH_JOB_NAME\",\n \"model\": \"projects/PROJECT_NUMBER/locations/us-central1/models/MODEL_ID\",\n \"inputConfig\": {\n \"instancesFormat\": \"jsonl\",\n \"gcsSource\": {\n  \"uris\": [  \"CONTENT\"\n  ]\n }\n },\n \"outputConfig\": {\n \"predictionsFormat\": \"jsonl\",\n \"gcsDestination\": {\n  \"outputUriPrefix\": \"BUCKET\"\n }\n },\n \"state\": \"JOB_STATE_PENDING\",\n \"createTime\": \"2020-05-30T02:58:44.341643Z\",\n \"updateTime\": \"2020-05-30T02:58:44.341643Z\",\n \"modelDisplayName\": \"MODEL_NAME\",\n \"modelObjective\": \"MODEL_OBJECTIVE\"\n}\n```\n\u60a8\u53ef\u4ee5\u4f7f\u7528 \u8f2a\u8a62\u6279\u91cf\u4f5c\u696d\u7684\u72c0\u614b\uff0c\u76f4\u5230\u4f5c\u696d `state` \u7232 `JOB_STATE_SUCCEEDED` \u3002\n\u5728\u5617\u8a66\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167 [\u300aVertex AI \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab\u300b](https://cloud.google.com/vertex-ai/docs/start/client-libraries?hl=zh-cn) \u4e2d\u7684 Java \u8a2d\u7f6e\u8aaa\u660e\u57f7\u884c\u64cd\u4f5c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Vertex AI Java API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/java/docs/reference/google-cloud-aiplatform/latest/com.google.cloud.aiplatform.v1?hl=zh-cn) \u3002\n\u5982\u9700\u5411 Vertex AI \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/aiplatform/src/main/java/aiplatform/CreateBatchPredictionJobVideoClassificationSample.java) \n```\nimport com.google.cloud.aiplatform.util.ValueConverter;import com.google.cloud.aiplatform.v1.BatchDedicatedResources;import com.google.cloud.aiplatform.v1.BatchPredictionJob;import com.google.cloud.aiplatform.v1.BatchPredictionJob.InputConfig;import com.google.cloud.aiplatform.v1.BatchPredictionJob.OutputConfig;import com.google.cloud.aiplatform.v1.BatchPredictionJob.OutputInfo;import com.google.cloud.aiplatform.v1.BigQueryDestination;import com.google.cloud.aiplatform.v1.BigQuerySource;import com.google.cloud.aiplatform.v1.CompletionStats;import com.google.cloud.aiplatform.v1.GcsDestination;import com.google.cloud.aiplatform.v1.GcsSource;import com.google.cloud.aiplatform.v1.JobServiceClient;import com.google.cloud.aiplatform.v1.JobServiceSettings;import com.google.cloud.aiplatform.v1.LocationName;import com.google.cloud.aiplatform.v1.MachineSpec;import com.google.cloud.aiplatform.v1.ManualBatchTuningParameters;import com.google.cloud.aiplatform.v1.ModelName;import com.google.cloud.aiplatform.v1.ResourcesConsumed;import com.google.cloud.aiplatform.v1.schema.predict.params.VideoClassificationPredictionParams;import com.google.protobuf.Any;import com.google.protobuf.Value;import com.google.rpc.Status;import java.io.IOException;import java.util.List;public class CreateBatchPredictionJobVideoClassificationSample {\u00a0 public static void main(String[] args) throws IOException {\u00a0 \u00a0 String batchPredictionDisplayName = \"YOUR_VIDEO_CLASSIFICATION_DISPLAY_NAME\";\u00a0 \u00a0 String modelId = \"YOUR_MODEL_ID\";\u00a0 \u00a0 String gcsSourceUri =\u00a0 \u00a0 \u00a0 \u00a0 \"gs://YOUR_GCS_SOURCE_BUCKET/path_to_your_video_source/[file.csv/file.jsonl]\";\u00a0 \u00a0 String gcsDestinationOutputUriPrefix =\u00a0 \u00a0 \u00a0 \u00a0 \"gs://YOUR_GCS_SOURCE_BUCKET/destination_output_uri_prefix/\";\u00a0 \u00a0 String project = \"YOUR_PROJECT_ID\";\u00a0 \u00a0 createBatchPredictionJobVideoClassification(\u00a0 \u00a0 \u00a0 \u00a0 batchPredictionDisplayName, modelId, gcsSourceUri, gcsDestinationOutputUriPrefix, project);\u00a0 }\u00a0 static void createBatchPredictionJobVideoClassification(\u00a0 \u00a0 \u00a0 String batchPredictionDisplayName,\u00a0 \u00a0 \u00a0 String modelId,\u00a0 \u00a0 \u00a0 String gcsSourceUri,\u00a0 \u00a0 \u00a0 String gcsDestinationOutputUriPrefix,\u00a0 \u00a0 \u00a0 String project)\u00a0 \u00a0 \u00a0 throws IOException {\u00a0 \u00a0 JobServiceSettings jobServiceSettings =\u00a0 \u00a0 \u00a0 \u00a0 JobServiceSettings.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setEndpoint(\"us-central1-aiplatform.googleapis.com:443\")\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 // Initialize client that will be used to send requests. This client only needs to be created\u00a0 \u00a0 // once, and can be reused for multiple requests. After completing all of your requests, call\u00a0 \u00a0 // the \"close\" method on the client to safely clean up any remaining background resources.\u00a0 \u00a0 try (JobServiceClient jobServiceClient = JobServiceClient.create(jobServiceSettings)) {\u00a0 \u00a0 \u00a0 String location = \"us-central1\";\u00a0 \u00a0 \u00a0 LocationName locationName = LocationName.of(project, location);\u00a0 \u00a0 \u00a0 VideoClassificationPredictionParams modelParamsObj =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 VideoClassificationPredictionParams.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setConfidenceThreshold(((float) 0.5))\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setMaxPredictions(10000)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setSegmentClassification(true)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setShotClassification(true)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setOneSecIntervalClassification(true)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 Value modelParameters = ValueConverter.toValue(modelParamsObj);\u00a0 \u00a0 \u00a0 ModelName modelName = ModelName.of(project, location, modelId);\u00a0 \u00a0 \u00a0 GcsSource.Builder gcsSource = GcsSource.newBuilder();\u00a0 \u00a0 \u00a0 gcsSource.addUris(gcsSourceUri);\u00a0 \u00a0 \u00a0 InputConfig inputConfig =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 InputConfig.newBuilder().setInstancesFormat(\"jsonl\").setGcsSource(gcsSource).build();\u00a0 \u00a0 \u00a0 GcsDestination gcsDestination =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 GcsDestination.newBuilder().setOutputUriPrefix(gcsDestinationOutputUriPrefix).build();\u00a0 \u00a0 \u00a0 OutputConfig outputConfig =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 OutputConfig.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setPredictionsFormat(\"jsonl\")\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setGcsDestination(gcsDestination)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 BatchPredictionJob batchPredictionJob =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 BatchPredictionJob.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setDisplayName(batchPredictionDisplayName)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setModel(modelName.toString())\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setModelParameters(modelParameters)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setInputConfig(inputConfig)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setOutputConfig(outputConfig)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 BatchPredictionJob batchPredictionJobResponse =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 jobServiceClient.createBatchPredictionJob(locationName, batchPredictionJob);\u00a0 \u00a0 \u00a0 System.out.println(\"Create Batch Prediction Job Video Classification Response\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\tName: %s\\n\", batchPredictionJobResponse.getName());\u00a0 \u00a0 \u00a0 System.out.format(\"\\tDisplay Name: %s\\n\", batchPredictionJobResponse.getDisplayName());\u00a0 \u00a0 \u00a0 System.out.format(\"\\tModel %s\\n\", batchPredictionJobResponse.getModel());\u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"\\tModel Parameters: %s\\n\", batchPredictionJobResponse.getModelParameters());\u00a0 \u00a0 \u00a0 System.out.format(\"\\tState: %s\\n\", batchPredictionJobResponse.getState());\u00a0 \u00a0 \u00a0 System.out.format(\"\\tCreate Time: %s\\n\", batchPredictionJobResponse.getCreateTime());\u00a0 \u00a0 \u00a0 System.out.format(\"\\tStart Time: %s\\n\", batchPredictionJobResponse.getStartTime());\u00a0 \u00a0 \u00a0 System.out.format(\"\\tEnd Time: %s\\n\", batchPredictionJobResponse.getEndTime());\u00a0 \u00a0 \u00a0 System.out.format(\"\\tUpdate Time: %s\\n\", batchPredictionJobResponse.getUpdateTime());\u00a0 \u00a0 \u00a0 System.out.format(\"\\tLabels: %s\\n\", batchPredictionJobResponse.getLabelsMap());\u00a0 \u00a0 \u00a0 InputConfig inputConfigResponse = batchPredictionJobResponse.getInputConfig();\u00a0 \u00a0 \u00a0 System.out.println(\"\\tInput Config\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tInstances Format: %s\\n\", inputConfigResponse.getInstancesFormat());\u00a0 \u00a0 \u00a0 GcsSource gcsSourceResponse = inputConfigResponse.getGcsSource();\u00a0 \u00a0 \u00a0 System.out.println(\"\\t\\tGcs Source\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\t\\tUris %s\\n\", gcsSourceResponse.getUrisList());\u00a0 \u00a0 \u00a0 BigQuerySource bigQuerySource = inputConfigResponse.getBigquerySource();\u00a0 \u00a0 \u00a0 System.out.println(\"\\t\\tBigquery Source\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\t\\tInput_uri: %s\\n\", bigQuerySource.getInputUri());\u00a0 \u00a0 \u00a0 OutputConfig outputConfigResponse = batchPredictionJobResponse.getOutputConfig();\u00a0 \u00a0 \u00a0 System.out.println(\"\\tOutput Config\");\u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"\\t\\tPredictions Format: %s\\n\", outputConfigResponse.getPredictionsFormat());\u00a0 \u00a0 \u00a0 GcsDestination gcsDestinationResponse = outputConfigResponse.getGcsDestination();\u00a0 \u00a0 \u00a0 System.out.println(\"\\t\\tGcs Destination\");\u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"\\t\\t\\tOutput Uri Prefix: %s\\n\", gcsDestinationResponse.getOutputUriPrefix());\u00a0 \u00a0 \u00a0 BigQueryDestination bigQueryDestination = outputConfigResponse.getBigqueryDestination();\u00a0 \u00a0 \u00a0 System.out.println(\"\\t\\tBig Query Destination\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\t\\tOutput Uri: %s\\n\", bigQueryDestination.getOutputUri());\u00a0 \u00a0 \u00a0 BatchDedicatedResources batchDedicatedResources =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 batchPredictionJobResponse.getDedicatedResources();\u00a0 \u00a0 \u00a0 System.out.println(\"\\tBatch Dedicated Resources\");\u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"\\t\\tStarting Replica Count: %s\\n\", batchDedicatedResources.getStartingReplicaCount());\u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"\\t\\tMax Replica Count: %s\\n\", batchDedicatedResources.getMaxReplicaCount());\u00a0 \u00a0 \u00a0 MachineSpec machineSpec = batchDedicatedResources.getMachineSpec();\u00a0 \u00a0 \u00a0 System.out.println(\"\\t\\tMachine Spec\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\t\\tMachine Type: %s\\n\", machineSpec.getMachineType());\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\t\\tAccelerator Type: %s\\n\", machineSpec.getAcceleratorType());\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\t\\tAccelerator Count: %s\\n\", machineSpec.getAcceleratorCount());\u00a0 \u00a0 \u00a0 ManualBatchTuningParameters manualBatchTuningParameters =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 batchPredictionJobResponse.getManualBatchTuningParameters();\u00a0 \u00a0 \u00a0 System.out.println(\"\\tManual Batch Tuning Parameters\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tBatch Size: %s\\n\", manualBatchTuningParameters.getBatchSize());\u00a0 \u00a0 \u00a0 OutputInfo outputInfo = batchPredictionJobResponse.getOutputInfo();\u00a0 \u00a0 \u00a0 System.out.println(\"\\tOutput Info\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tGcs Output Directory: %s\\n\", outputInfo.getGcsOutputDirectory());\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tBigquery Output Dataset: %s\\n\", outputInfo.getBigqueryOutputDataset());\u00a0 \u00a0 \u00a0 Status status = batchPredictionJobResponse.getError();\u00a0 \u00a0 \u00a0 System.out.println(\"\\tError\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tCode: %s\\n\", status.getCode());\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tMessage: %s\\n\", status.getMessage());\u00a0 \u00a0 \u00a0 List<Any> details = status.getDetailsList();\u00a0 \u00a0 \u00a0 for (Status partialFailure : batchPredictionJobResponse.getPartialFailuresList()) {\u00a0 \u00a0 \u00a0 \u00a0 System.out.println(\"\\tPartial Failure\");\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tCode: %s\\n\", partialFailure.getCode());\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tMessage: %s\\n\", partialFailure.getMessage());\u00a0 \u00a0 \u00a0 \u00a0 List<Any> partialFailureDetailsList = partialFailure.getDetailsList();\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 ResourcesConsumed resourcesConsumed = batchPredictionJobResponse.getResourcesConsumed();\u00a0 \u00a0 \u00a0 System.out.println(\"\\tResources Consumed\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tReplica Hours: %s\\n\", resourcesConsumed.getReplicaHours());\u00a0 \u00a0 \u00a0 CompletionStats completionStats = batchPredictionJobResponse.getCompletionStats();\u00a0 \u00a0 \u00a0 System.out.println(\"\\tCompletion Stats\");\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tSuccessful Count: %s\\n\", completionStats.getSuccessfulCount());\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tFailed Count: %s\\n\", completionStats.getFailedCount());\u00a0 \u00a0 \u00a0 System.out.format(\"\\t\\tIncomplete Count: %s\\n\", completionStats.getIncompleteCount());\u00a0 \u00a0 }\u00a0 }}\n```\u5728\u5617\u8a66\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167 [\u300aVertex AI \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab\u300b](https://cloud.google.com/vertex-ai/docs/start/client-libraries?hl=zh-cn) \u4e2d\u7684 Node.js \u8a2d\u7f6e\u8aaa\u660e\u57f7\u884c\u64cd\u4f5c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Vertex AI Node.js API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/nodejs/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n\u5982\u9700\u5411 Vertex AI \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/nodejs-docs-samples/blob/HEAD/ai-platform/snippets/create-batch-prediction-job-video-classification.js) \n```\n/**\u00a0* TODO(developer): Uncomment these variables before running the sample.\\\u00a0* (Not necessary if passing values as arguments)\u00a0*/// const batchPredictionDisplayName = 'YOUR_BATCH_PREDICTION_DISPLAY_NAME';// const modelId = 'YOUR_MODEL_ID';// const gcsSourceUri = 'YOUR_GCS_SOURCE_URI';// const gcsDestinationOutputUriPrefix = 'YOUR_GCS_DEST_OUTPUT_URI_PREFIX';// \u00a0 \u00a0eg. \"gs://<your-gcs-bucket>/destination_path\"// const project = 'YOUR_PROJECT_ID';// const location = 'YOUR_PROJECT_LOCATION';const aiplatform = require('@google-cloud/aiplatform');const {params} = aiplatform.protos.google.cloud.aiplatform.v1.schema.predict;// Imports the Google Cloud Job Service Client libraryconst {JobServiceClient} = require('@google-cloud/aiplatform').v1;// Specifies the location of the api endpointconst clientOptions = {\u00a0 apiEndpoint: 'us-central1-aiplatform.googleapis.com',};// Instantiates a clientconst jobServiceClient = new JobServiceClient(clientOptions);async function createBatchPredictionJobVideoClassification() {\u00a0 // Configure the parent resource\u00a0 const parent = `projects/${project}/locations/${location}`;\u00a0 const modelName = `projects/${project}/locations/${location}/models/${modelId}`;\u00a0 // For more information on how to configure the model parameters object, see\u00a0 // https://cloud.google.com/ai-platform-unified/docs/predictions/batch-predictions\u00a0 const modelParamsObj = new params.VideoClassificationPredictionParams({\u00a0 \u00a0 confidenceThreshold: 0.5,\u00a0 \u00a0 maxPredictions: 1000,\u00a0 \u00a0 segmentClassification: true,\u00a0 \u00a0 shotClassification: true,\u00a0 \u00a0 oneSecIntervalClassification: true,\u00a0 });\u00a0 const modelParameters = modelParamsObj.toValue();\u00a0 const inputConfig = {\u00a0 \u00a0 instancesFormat: 'jsonl',\u00a0 \u00a0 gcsSource: {uris: [gcsSourceUri]},\u00a0 };\u00a0 const outputConfig = {\u00a0 \u00a0 predictionsFormat: 'jsonl',\u00a0 \u00a0 gcsDestination: {outputUriPrefix: gcsDestinationOutputUriPrefix},\u00a0 };\u00a0 const batchPredictionJob = {\u00a0 \u00a0 displayName: batchPredictionDisplayName,\u00a0 \u00a0 model: modelName,\u00a0 \u00a0 modelParameters,\u00a0 \u00a0 inputConfig,\u00a0 \u00a0 outputConfig,\u00a0 };\u00a0 const request = {\u00a0 \u00a0 parent,\u00a0 \u00a0 batchPredictionJob,\u00a0 };\u00a0 // Create batch prediction job request\u00a0 const [response] = await jobServiceClient.createBatchPredictionJob(request);\u00a0 console.log('Create batch prediction job video classification response');\u00a0 console.log(`Name : ${response.name}`);\u00a0 console.log('Raw response:');\u00a0 console.log(JSON.stringify(response, null, 2));}createBatchPredictionJobVideoClassification();\n```\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u6216\u66f4\u65b0 Python\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Python \u7248 Vertex AI SDK](https://cloud.google.com/vertex-ai/docs/start/use-vertex-ai-python-sdk?hl=zh-cn) \u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [   Python API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/python/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/googleapis/python-aiplatform/blob/HEAD/samples/model-builder/create_batch_prediction_job_sample.py) \n```\ndef create_batch_prediction_job_sample(\u00a0 \u00a0 project: str,\u00a0 \u00a0 location: str,\u00a0 \u00a0 model_resource_name: str,\u00a0 \u00a0 job_display_name: str,\u00a0 \u00a0 gcs_source: Union[str, Sequence[str]],\u00a0 \u00a0 gcs_destination: str,\u00a0 \u00a0 sync: bool = True,):\u00a0 \u00a0 aiplatform.init(project=project, location=location)\u00a0 \u00a0 my_model = aiplatform.Model(model_resource_name)\u00a0 \u00a0 batch_prediction_job = my_model.batch_predict(\u00a0 \u00a0 \u00a0 \u00a0 job_display_name=job_display_name,\u00a0 \u00a0 \u00a0 \u00a0 gcs_source=gcs_source,\u00a0 \u00a0 \u00a0 \u00a0 gcs_destination_prefix=gcs_destination,\u00a0 \u00a0 \u00a0 \u00a0 sync=sync,\u00a0 \u00a0 )\u00a0 \u00a0 batch_prediction_job.wait()\u00a0 \u00a0 print(batch_prediction_job.display_name)\u00a0 \u00a0 print(batch_prediction_job.resource_name)\u00a0 \u00a0 print(batch_prediction_job.state)\u00a0 \u00a0 return batch_prediction_job\n```\n### \u6aa2\u7d22\u6279\u91cf\u9810\u6e2c\u7d50\u679c\nVertex AI \u5c07\u6279\u91cf\u9810\u6e2c\u8f38\u51fa\u767c\u9001\u5230\u60a8\u6307\u5b9a\u7684\u76ee\u6a19\u4f4d\u7f6e\u3002\n\u6279\u91cf\u9810\u6e2c\u4efb\u52d9\u5b8c\u6210\u5f8c\uff0c\u9810\u6e2c\u7684\u8f38\u51fa\u5b58\u5132\u5728\u60a8\u5728\u8acb\u6c42\u4e2d\u6307\u5b9a\u7684 Cloud Storage \u5b58\u5132\u6876\u4e2d\u3002### \u6279\u91cf\u9810\u6e2c\u7d50\u679c\u793a\u4f8b\n\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u5f9e\u8996\u983b\u5206\u985e\u6a21\u578b\u7372\u53d6\u6279\u91cf\u9810\u6e2c\u7d50\u679c\u3002\n```\n{\n \"instance\": {\n \"content\": \"gs://bucket/video.mp4\",\n \"mimeType\": \"video/mp4\",\n \"timeSegmentStart\": \"1s\",\n \"timeSegmentEnd\": \"5s\"\n }\n \"prediction\": [{\n \"id\": \"1\",\n \"displayName\": \"cat\",\n \"type\": \"segment-classification\",\n \"timeSegmentStart\": \"1s\",\n \"timeSegmentEnd\": \"5s\",\n \"confidence\": 0.7\n }, {\n \"id\": \"1\",\n \"displayName\": \"cat\",\n \"type\": \"shot-classification\",\n \"timeSegmentStart\": \"1s\",\n \"timeSegmentEnd\": \"4s\",\n \"confidence\": 0.9\n }, {\n \"id\": \"2\",\n \"displayName\": \"dog\",\n \"type\": \"shot-classification\",\n \"timeSegmentStart\": \"4s\",\n \"timeSegmentEnd\": \"5s\",\n \"confidence\": 0.6\n }, {\n \"id\": \"1\",\n \"displayName\": \"cat\",\n \"type\": \"one-sec-interval-classification\",\n \"timeSegmentStart\": \"1s\",\n \"timeSegmentEnd\": \"1s\",\n \"confidence\": 0.95\n }, {\n \"id\": \"1\",\n \"displayName\": \"cat\",\n \"type\": \"one-sec-interval-classification\",\n \"timeSegmentStart\": \"2s\",\n \"timeSegmentEnd\": \"2s\",\n \"confidence\": 0.9\n }, {\n \"id\": \"1\",\n \"displayName\": \"cat\",\n \"type\": \"one-sec-interval-classification\",\n \"timeSegmentStart\": \"3s\",\n \"timeSegmentEnd\": \"3s\",\n \"confidence\": 0.85\n }, {\n \"id\": \"2\",\n \"displayName\": \"dog\",\n \"type\": \"one-sec-interval-classification\",\n \"timeSegmentStart\": \"4s\",\n \"timeSegmentEnd\": \"4s\",\n \"confidence\": 0.6\n }]\n}\n```", "guide": "Vertex AI"}