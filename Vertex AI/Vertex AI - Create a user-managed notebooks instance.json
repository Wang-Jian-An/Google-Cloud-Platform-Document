{"title": "Vertex AI - Create a user-managed notebooks instance", "url": "https://cloud.google.com/vertex-ai/docs/workbench/user-managed/create-new", "abstract": "# Vertex AI - Create a user-managed notebooks instance\n# Create a user-managed notebooks instance\nVertex AI Workbench user-managed notebooks is [deprecated](/vertex-ai/docs/deprecations) . On January 30, 2025, support for  user-managed notebooks will end and the ability to create user-managed notebooks instances  will be removed. Existing instances will continue to function  but patches, updates, and upgrades won't be available. To continue using  Vertex AI Workbench, we recommend that you [migrate your user-managed notebooks instances to Vertex AI Workbench instances](/vertex-ai/docs/workbench/user-managed/migrate-to-instances) .\nThis page shows you how to create a user-managed notebooks instance by using the Google Cloud console or the Google Cloud CLI. While creating your instance, you can configure your instance's hardware, encryption type, network, and other details.\n", "content": "## Before you begin\n- If you plan to use GPUs with your user-managed notebooks instance, [check the quotas page in the Google Cloud console](https://console.cloud.google.com/quotas) to ensure that you have enough GPUs available in your project. If GPUs are not listed on the quotas page, or you require additional GPU quota, you can request a quota increase. See [Requesting an increase in quota](/compute/quotas#requesting_additional_quota) on the Compute Engine [Resource quotas](/compute/quotas) page.### Required roles\nIf you created the project, you have the Owner ( `roles/owner` ) IAM role on the project, which includes all required permissions. Skip this section and start creating your user-managed notebooks instance. If you didn't create the project yourself, continue in this section.\nTo ensure that your user account has the necessary  permissions to create a Vertex AI Workbench user-managed notebooks instance,   ask your administrator to grant your user account the  following IAM roles on the project:\n- Notebooks Admin ( [roles/notebooks.admin](/vertex-ai/docs/workbench/user-managed/iam#notebooks.admin) )\n- Service Account User ( [roles/iam.serviceAccountUser](/iam/docs/understanding-roles#iam.serviceAccountUser) )\nFor more information about granting roles, see [Manage access](/iam/docs/granting-changing-revoking-access) .\nYour administrator might also be able to give your user account  the required permissions through [custom  roles](/iam/docs/creating-custom-roles) or other [predefined  roles](/iam/docs/understanding-roles) .\n[](None)\n## Create a user-managed notebooks instance\nYou can create a user-managed notebooks instance by using the Google Cloud console, the Google Cloud CLI, or Terraform.\nTo create a user-managed notebooks instance by using the Google Cloud console, do the following:- In the Google Cloud console, go to the **User-managed notebooks** page. Or go to [notebook.new](https://notebook.new) (https://notebook.new) and skip the next step. [Go to User-managed notebooks](https://console.cloud.google.com/vertex-ai/workbench/user-managed) \n- Click add_box **Create new** .The **New instance** window opens.\n- In the **New instance** window, click **Advanced options** .\n- In the **Details** section, provide the following information for your new instance:- **Name** : Provide a name for your new instance. The name must start with a letter followed by up to 62 lowercase letters, numbers, or hyphens (-), and cannot end with a hyphen.\n- **Region** and **Zone** : Select a region and zone for the new instance. For best network performance, select the region that is geographically closest to you. See the available [user-managed notebookslocations](/vertex-ai/docs/general/locations#user-managed-notebooks-locations) .\n- **Labels** : Optional. Provide custom key-value labels for the instance.\n- **Tags** : Optional. Provide [tags](/resource-manager/docs/tags/tags-overview) for the instance.\n- In the **Environment** section, provide the following:- **Operating system** : Select the operating system that you want to use.\n- **Environment** : Select the environment that you want to use.\n- **Version** : Use the latest version or a previous version of user-managed notebooks instances.\n- **Post-startup script** : Optional. Click **Browse** to select a script to run one time, after the instance is created. The path must be a URL or Cloud Storage path, for example:`gs://` `` `/` ``.\n- **Metadata** : Optional. Provide custom metadata keys for the instance.\n- In the **Machine type** section, provide the following:- **Machine type** : Select the number of CPUs and amount of RAM for your new instance. Vertex AI Workbench provides monthly cost estimates for each machine type that you select.\n- **GPU** : Optional. If you want GPUs, select the **GPU** type and **Number of GPUs** for your new instance. For information about the different GPUs, see [GPUs on Compute Engine](/compute/docs/gpus) .Select **Install NVIDIA GPU driver automatically for me** . **Note:** You can modify the machine type and GPU configuration for your instance after it is created. For more information, see [Change machine type and configure GPUs ofa user-managed notebooks instance](/vertex-ai/docs/workbench/user-managed/manage-hardware-accelerators) .\n- **Shielded VM** : Optional. Select or clear the following:- **Secure Boot** \n- **Virtual Trusted Platform Module (vTPM)** \n- **Integrity monitoring** \n- **Idle shutdown** : Optional.- To change the number of minutes before shutdown, in the **Time of inactivity before shutdown (Minutes)** field, change the value to an integer from 10 through 1440.\n- To turn off idle shutdown, clear **Enable Idle Shutdown** .\n- In the **Disks** section, provide the following:- **Disks** : Optional. To change the default boot or data disk settings, select a **Boot disk type** , **Boot disk size in GB** , **Data disk type** , and **Data disk size in GB** . For more information about disk types, see [Storage options](/compute/docs/disks#introduction) .\n- **Delete to trash** : Optional. Select this checkbox to use the operating system's default trash behavior, If you use the default trash behavior, files deleted by using the JupyterLab user interface are recoverable but these deleted files do use disk space.\n- **Backup** : Optional. To sync a Cloud Storage location with your instance's data disk, click **Browse** and specify the Cloud Storage location. To learn about storage costs, see [Cloud Storage pricing](/storage/pricing) .\n- **Encryption** : Select **Google-managed encryption key** or **Customer-managed encryption key (CMEK)** . To use CMEK, see [Customer-managed encryption keys](/vertex-ai/docs/workbench/user-managed/cmek) .\n- In the **Networking** section, provide the following:- **Networking** : Adjust the network options to use a network in your current project or a [Shared VPC network](/vpc/docs/shared-vpc) from a host project, if one is configured. If you are using a [Shared VPC](/vpc/docs/shared-vpc) in the host project, you must also grant the [Compute Network User role](/compute/docs/access/iam#compute.networkUser) ( `roles/compute.networkUser` ) to the [Notebooks ServiceAgent](/iam/docs/service-agents#cloud-ai-platform-notebooks-service-account) in the host project. **Note:** When you select **Include Google-provided role grants** in the **IAM & Admin** section, the Notebooks Service Agent is  automatically created in the visible service project.  The Notebooks Service Agent service account is `service-` `` `@gcp-sa-notebooks.iam.gserviceaccount.com` .- In the **Network** field, select the network that you want. You can select a VPC network, as long as the network has [Private Google Access](/vpc/docs/private-google-access) enabled or can access the internet. For more information, see [network configuration options](#network-options) .\n- In the **Subnetwork** field, select the subnetwork that you want.\n- To turn off the external IP address, clear the **Assign external IP address** checkbox.\n- To turn off proxy access, clear the **Allow proxy access** checkbox. **Note:** If you turn off proxy access, you must [use SSH to connect toyour instance's JupyterLab interface](/vertex-ai/docs/workbench/user-managed/ssh-access) .\n- In the **IAM and security** section, provide the following:- **IAM and security** : To grant access to the instance's JupyterLab interface, complete one of the following steps:- To grant access to JupyterLab through a service account, select **Service account** .- To use the default Compute Engine service account, select **Use default Compute Engine service account** .\n- To use a custom service account, clear **Usedefault Compute Engine service account** , and then, in the **Service account email** field, enter your custom service account email address.\n- To grant a single user access to the JupyterLab interface, do the following:- Select **Single user** , and then, in the **User email** field, enter the user account that you want to grant access. If the specified user is not the creator of the instance, you must grant the specified user the [Service Account Userrole](/iam/docs/service-account-permissions#user-role) ( `roles/iam.serviceAccountUser` ) on the instance's service account.\n- Your instance uses a service account to interact with Google Cloud services and APIs.- To use the default Compute Engine service account, select **Use default Compute Engine service account** .\n- To use a custom service account, clear **Usedefault Compute Engine service account** , and then, in the **Service account email** field, enter your custom service account email address.\n **Note:** To grant access to the instance through the service account  or single user option, you must use an individual's  user account email address. Group access is not supported.To learn more about granting access, see [Manage access](/vertex-ai/docs/workbench/user-managed/manage-access) . **Note:** After you create an instance with service account access,  the service account can't be changed. To use a different  service account, you must create a new instance specifying  the service account that you want. Attempting to change  the service account by using the Compute Engine API  can cause loss of functionality.\n- **Security options** : Select or clear the following checkboxes:- **Root access to the instance** \n- **nbconvert** \n- **File downloading** \n- **Terminal access** \n **Note:** User-managed notebooks instances that use the Dataproc Hub framework permit file downloading even if you don't select **File downloading** .\n- In the **System health** section, provide the following:- [](None) **Environment upgrade and system health** : To automatically upgrade to newly released environment versions, select **Environment auto-upgrade** and complete the **Upgrade schedule** .\n- In **Reporting** , select or clear the following checkboxes:- **Report system health** \n- **Report custom metrics to Cloud Monitoring** \n- **Install Cloud Monitoring** \n- **Report DNS status for required Google domains** \n- Click **Create** .Vertex AI Workbench creates and automatically starts your user-managed notebooks instance. When the instance is ready to use, Vertex AI Workbench activates an **Open JupyterLab** link.\n [](None)  [](None) By default, the Google Cloud CLI creates a user-managed notebooks instance with an external IP address. To create an instance without an external IP address, you must specify a subnet that has Private Google Access enabled. For more information, see [networking configuration options](#network-options) .- To create a user-managed notebooks instance from the command line, from [Cloud Shell](/shell/docs/starting-cloud-shell) or any terminal where the [Google Cloud CLI](/sdk/docs) is installed, use the [gcloud notebooks instancescreate](/sdk/gcloud/reference/notebooks/instances/create) command:```\ngcloud notebooks instances create INSTANCE_NAME \\\n --vm-image-project=deeplearning-platform-release \\\n --vm-image-family=VM_IMAGE_FAMILY \\\n --machine-type=MACHINE_TYPE \\\n --location=LOCATION\n```Replace the following:- ``: the name of your new instance; must start with a letter followed by up to 62 lowercase letters, numbers, or hyphens (-), and cannot end with a hyphen.\n- ``: the [image familyname](/vertex-ai/docs/workbench/user-managed/images#deciding) that you want to use to create your instance\n- ``: the [machinetype](/compute/docs/machine-types) of your instance's VM\n- ``: the Google Cloud [location](/vertex-ai/docs/general/locations#user-managed-notebooks-locations) where you want your new instance to be\n- Access your instance from the [Google Cloud console](https://console.cloud.google.com/vertex-ai/workbench/user-managed) .\nFor information about all commands for creating an instance from the command line, see the [gcloud CLIdocumentation](/sdk/gcloud/reference/notebooks/instances/create) .\nThe following sample uses the [google_notebooks_instance](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/notebooks_instance) Terraform resource to create a new user-managed notebooks instance named `notebooks-instance-basic` .\nTo learn how to apply or remove a Terraform configuration, see [Basic Terraform commands](/docs/terraform/basic-commands) .\n [View on GitHub](https://github.com/terraform-google-modules/terraform-docs-samples/blob/HEAD/vertex_ai/user_managed_notebooks_instance/main.tf) \n```\nresource \"google_notebooks_instance\" \"basic_instance\" {\n name   = \"notebooks-instance-basic\"\n location  = \"us-central1-a\"\n machine_type = \"e2-medium\"\n vm_image {\n project  = \"deeplearning-platform-release\"\n image_family = \"tf-ent-2-9-cu113-notebooks\"\n }\n}\n```\n## Open the notebook\n- In the Google Cloud console, next to your user-managed notebooks instance's name, click **Open JupyterLab** .\n- Your user-managed notebooks instance opens JupyterLab.## Network configuration options\nA user-managed notebooks instance must access service endpoints that are outside your VPC network.\nYou can provide this access in one of the following ways:\n- Assign an external IP address to the user-managed notebooks instance. This is done automatically when you [create a new instance with defaultproperties](#create_an_instance_with_default_properties) . Make sure your environment meets the [requirements for accessing Google APIs andservices](/vpc/docs/access-apis-external-ip#requirements) .\n- Connect the user-managed notebooks instance to a subnet where [Private Google Access](/vpc/docs/configure-private-google-access) is enabled. Make sure your environment meets the [requirements forPrivate Google Access](/vpc/docs/configure-private-google-access#requirements) .\nIf you use the `private.googleapis.com` or `restricted.googleapis.com` VIP to provide access to the service endpoints, [add DNS entries for each of the required serviceendpoints](/vpc/docs/configure-private-google-access#config-domain) :\n- `notebooks.googleapis.com`\n- `*.notebooks.cloud.google.com`\n- `*.notebooks.googleusercontent.com`## Network tags\nYour new user-managed notebooks instance automatically has the `deeplearning-vm` and `notebook-instance` network tags assigned.\nThese tags let you manage network access to and from your user-managed notebooks instance by referencing the tags in your VPC networking firewall rules. For more information about network tags, see [Add network tags](/vpc/docs/add-remove-network-tags) .\nTo view the network tags for a user-managed notebooks instance, do the following:\n- In the Google Cloud console, go to the **VM instances** page. [Go to VM instances](https://console.cloud.google.com/compute/instances) \n- Click the name of the instance.\n- In the **Networking** section, find **Network tags** .## Troubleshooting\nIf you encounter a problem when you create a notebook, see [TroubleshootingVertex AI Workbench](/vertex-ai/docs/general/troubleshooting-workbench#user-managed-notebooks) for help with common issues.\n## What's next\n- [Install dependencies](/vertex-ai/docs/workbench/user-managed/dependencies) on your new user-managed notebooks instance.\n- Learn about [monitoring the health status](/vertex-ai/docs/workbench/user-managed/monitor-health) of your user-managed notebooks instance.", "guide": "Vertex AI"}