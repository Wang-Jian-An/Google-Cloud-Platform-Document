{"title": "Vertex AI - \u9032\u884c\u9810\u6e2c", "url": "https://cloud.google.com/vertex-ai/docs/tutorials/tabular-bq-prediction/make-prediction?hl=zh-cn", "abstract": "# Vertex AI - \u9032\u884c\u9810\u6e2c\n`df_for_prediction`\n`df_for_prediction`\n", "content": "## \u6e96\u5099\u9810\u6e2c\u6e2c\u8a66\u6578\u64da\n\u60a8\u5fc5\u9808\u5148\u79fb\u9664 `species` \u5217\uff0c\u7136\u5f8c\u624d\u80fd\u4f7f\u7528\u6e2c\u8a66\u6578\u64da\u5275\u5efa\u9810\u6e2c\u3002\u7531\u65bc\u60a8\u8981\u9810\u6e2c\u7684\u7a2e\u985e\u662f\u4f01\u9d5d\uff0c\u56e0\u6b64\u4e0d\u80fd\u5c07\u5176\u5305\u542b\u5728\u7528\u65bc\u5275\u5efa\u9810\u6e2c\u7684\u6e2c\u8a66\u6578\u64da\u4e2d\u3002\u79fb\u9664 `species` \u5217\u5f8c\uff0c\u5c07\u6578\u64da\u8f49\u63db\u7232 Python \u5217\u8868\uff0c\u56e0\u7232\u9019\u662f `predict` \u65b9\u6cd5\u7528\u4f5c\u8f38\u5165\u7684\u5167\u5bb9\u3002\u904b\u884c\u4ee5\u4e0b\u4ee3\u78bc\uff0c\u5c07\u60a8\u7684\u6578\u64da\u8f49\u63db\u7232 Python \u5217\u8868\uff1a\n```\n# Remove the species columndf_for_prediction.pop(LABEL_COLUMN)# Convert data to a Python listtest_data_list = df_for_prediction.values.tolist()\n```\n## \uff08\u53ef\u9078\uff09\u67e5\u770b\u6e2c\u8a66\u6578\u64da\n\u7232\u4e86\u5e6b\u52a9\u60a8\u7406\u89e3\u6e2c\u8a66\u6578\u64da\uff0c\u60a8\u53ef\u4ee5\u904b\u884c\u4ee5\u4e0b\u4ee3\u78bc\u884c\u4f86\u67e5\u770b\u5b83\uff1a\n```\ntest_data_list\n```\n\u5728\u6bcf\u4e00\u884c\u4e2d\uff0c\u6bcf\u516d\u5217\u7684\u76f8\u61c9\u503c\u5747\u6307\u4e00\u96bb\u4f01\u9d5d\u7684\u4ee5\u4e0b\u7279\u5fb5\uff1a\n| \u5217 | \u4f01\u9d5d\u7279\u5fb5                       |\n|-----:|:----------------------------------------------------------------------------------------------------|\n| 0 | island - \u767c\u73fe\u67d0\u7a2e\u4f01\u9d5d\u7684\u5cf6\u5dbc\u3002\u5cf6\u5dbc\u503c\u6620\u5c04\u7232 0\uff08\u5c0d\u65bc Dream\uff09\u30011\uff08\u5c0d\u65bc Biscoe\uff09\u548c 2\uff08\u5c0d\u65bc Torgersen\uff09\u3002 |\n| 1 | culmen_length_mm - \u4f01\u9d5d\u5599\u9802\u90e8\u7a81\u51fa\u90e8\u4f4d\u7684\u9577\u5ea6\u3002              |\n| 2 | culmen_depth_mm - \u4f01\u9d5d\u5599\u7684\u9ad8\u5ea6\u3002                 |\n| 3 | flipper_length_mm - \u4f01\u9d5d\u9c2d\u72c0\u7fc5\u8180\u7684\u9577\u5ea6\u3002               |\n| 4 | body_mass_g - \u4f01\u9d5d\u7684\u9ad4\u91cd\u3002                   |\n| 5 | sex - \u4f01\u9d5d\u7684\u6027\u5225\u3002 0 \u662f FEMALE\uff0c1 \u662f MALE\u3002               |\n## \u767c\u9001\u9810\u6e2c\u8acb\u6c42\n\u5982\u9700\u5275\u5efa\u9810\u6e2c\u8acb\u6c42\uff0c\u8acb\u5c07\u60a8\u5275\u5efa\u7684 Python \u6e2c\u8a66\u6578\u64da\u5217\u8868\u50b3\u905e\u7d66 `endpoint` \u7684 [predict](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.Endpoint?hl=zh-cn#google_cloud_aiplatform_Endpoint_predict) \u65b9\u6cd5\u3002\n`predict` \u65b9\u6cd5\u6703\u8a55\u4f30\u6bcf\u884c\u4e2d\u7684\u7279\u5fb5\uff0c\u4e26\u4f7f\u7528\u9019\u4e9b\u7279\u5fb5\u9810\u6e2c\u5b83\u5011\u4ee3\u8868\u7684\u4f01\u9d5d\u7a2e\u985e\u3002\u904b\u884c\u4ee5\u4e0b\u4ee3\u78bc\u4ee5\u5275\u5efa\u9810\u6e2c\u3002\u8fd4\u56de\u7684\u9810\u6e2c\u7d50\u679c\u5305\u542b\u4e00\u500b\u884c\u5217\u8868\uff0c\u5176\u4e2d\u6bcf\u4e00\u884c\u5305\u542b\u4e09\u5217\uff1a \u963f\u5fb7\u5229\u4f01\u9d5d\uff08\u7b2c 1 \u5217\uff09\u3001 \u5357\u6975\u4f01\u9d5d\uff08\u7b2c 2 \u5217\uff09\u6216 \u767d\u7709\u4f01\u9d5d\uff08\u7b2c 3 \u5217\uff09\u3002\n```\n# Get your predictions.predictions = endpoint.predict(instances=test_data_list)# View the predictionspredictions.predictions\n```\n\u4e00\u884c\u4e2d\u7684\u6bcf\u4e00\u5217\u5305\u542b\u4e00\u500b\u503c\uff0c\u8a72\u503c\u8d8a\u9ad8\uff0c\u8a72\u5217\u8868\u793a\u7684\u4f01\u9d5d\u7a2e\u985e\u662f\u6b63\u78ba\u9810\u6e2c\u7684\u7f6e\u4fe1\u5ea6\u5c31\u8d8a\u9ad8\u3002\u4f8b\u5982\uff0c\u5728\u4ee5\u4e0b\u793a\u4f8b\u9810\u6e2c\u8f38\u51fa\u884c\u4e2d\uff0c\u6a21\u578b\u4f7f\u7528\u6a23\u672c\u4f01\u9d5d\u6578\u64da\u884c\u7684\u7279\u5fb5\u4f86\u9810\u6e2c\u4f01\u9d5d\u6700\u6709\u53ef\u80fd\u5c6c\u65bc \u963f\u5fb7\u5229\u4f01\u9d5d\u7a2e\u985e\u3002\u9019\u662f\u56e0\u7232\u6700\u9ad8\u503c `0.732703805` \u4f4d\u65bc\u7b2c\u4e00\u5217\u4e2d\u3002\n`[0.732703805, 0.233752429, 0.0335437432]`\n\u5728\u4ee5\u4e0b\u4ee3\u78bc\u4e2d\uff0cNumPy `argmax` \u65b9\u6cd5\u6703\u8fd4\u56de\u5305\u542b\u6700\u5927\u503c\u7684\u6bcf\u4e00\u884c\u7684\u5217\u3002\u6700\u5927\u503c\u5c0d\u61c9\u65bc\u6700\u6709\u53ef\u80fd\u6b63\u78ba\u7684\u9810\u6e2c\u3002\u7b2c\u4e8c\u884c\u986f\u793a\u9810\u6e2c\u6578\u7d44\u3002\n```\n# Get the prediction for each set of input data.species_predictions = np.argmax(predictions.predictions, axis=1)# View the best prediction for the penguin characteristics in each row.species_predictions\n```\n`species_predictions` \u6578\u7d44\u4e2d\u7684\u6bcf\u500b\u7d50\u679c\u5747\u9810\u6e2c\u76f8\u61c9\u6e2c\u8a66\u6578\u64da\u884c\u4e2d\u503c\u5c0d\u61c9\u7684\u4f01\u9d5d\u7a2e\u985e\u3002\u4f8b\u5982\uff0c\u7b2c\u4e00\u500b\u503c\u7232 `0` \uff0c\u5b83\u6620\u5c04\u5230 \u963f\u5fb7\u5229\u4f01\u9d5d\u7a2e\u985e\u3002\u9019\u610f\u5473\u7740\u60a8\u7684\u6a21\u578b\u9810\u6e2c\u5177\u6709\u6e2c\u8a66\u6578\u64da\u7b2c\u4e00\u884c\u7279\u5fb5\u7684\u4f01\u9d5d\u7a2e\u985e\u662f\u963f\u5fb7\u5229\u4f01\u9d5d \u3002\n## \u6e05\u7406\u8cc7\u6e90\n\u60a8\u5df2\u5b8c\u6210\u64cd\u4f5c\uff0c\u63a5\u4e0b\u4f86\u53ef\u4ee5\u7e7c\u7e8c\u4f7f\u7528\u7b46\u8a18\u672c\u4f86\u63a2\u7d22\u548c\u8a73\u7d30\u77ad\u89e3\u60a8\u5275\u5efa\u7684\u8cc7\u6e90\u53ca\u5176\u5de5\u4f5c\u539f\u7406\u3002\n### \u522a\u9664\u60a8\u7684\u8cc7\u6e90\n\u6e96\u5099\u5c31\u7dd2\u5f8c\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u522a\u9664\u5728\u672c\u6559\u7a0b\u4e2d\u5275\u5efa\u7684 Google Cloud \u8cc7\u6e90\uff0c\u4ee5\u514d\u7522\u751f\u4e0d\u5fc5\u8981\u7684\u8cbb\u7528\u3002\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u5169\u7a2e\u65b9\u5f0f\u522a\u9664\u8cc7\u6e90\uff1a\n- \u522a\u9664\u9805\u76ee\uff0c\u9019\u4e5f\u5c07\u522a\u9664\u8207\u9805\u76ee\u95dc\u806f\u7684\u6240\u6709\u8cc7\u6e90\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u95dc\u505c\uff08\u522a\u9664\uff09\u9805\u76ee](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#shutting_down_projects) \u3002\n- \u904b\u884c\u7528\u65bc\u522a\u9664\u8a13\u7df4\u4f5c\u696d\uff08 `CustomTrainingJob` \u5c0d\u8c61\uff09\u3001\u6a21\u578b\uff08 `Model` \u5c0d\u8c61\uff09\u3001\u7aef\u9ede\uff08 `Endpoint` \u5c0d\u8c61\uff09\u548c Cloud Storage \u5b58\u5132\u6876\u7684\u4ee3\u78bc\u3002\u6b64\u9078\u9805\u6703\u4fdd\u7559\u60a8\u7684\u9805\u76ee\uff0c\u4ee5\u53ca\u60a8\u53ef\u80fd\u5df2\u5275\u5efa\u4f46\u6c92\u6709\u4f7f\u7528\u4ee3\u78bc\u660e\u78ba\u522a\u9664\u7684\u4efb\u4f55\u5176\u4ed6\u8cc7\u6e90\u3002\u60a8\u5fc5\u9808\u5148\u901a\u904e\u5c07 `force=True` \u50b3\u905e\u7d66 [endpoint.delete](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.Endpoint?hl=zh-cn#google_cloud_aiplatform_Endpoint_delete) \u65b9\u6cd5\u53d6\u6d88\u90e8\u7f72\u6a21\u578b\uff0c\u7136\u5f8c\u624d\u80fd\u5c07\u5176\u522a\u9664\u3002\u5982\u9700\u4fdd\u7559\u9805\u76ee\u4e26\u50c5\u522a\u9664\u60a8\u5728\u672c\u6559\u7a0b\u4e2d\u5275\u5efa\u7684\u8cc7\u6e90\uff0c\u8acb\u5728\u7b46\u8a18\u672c\u4e2d\u904b\u884c\u4ee5\u4e0b\u4ee3\u78bc\uff1a\n```\nimport os# Delete the training jobjob.delete()# Delete the endpoint and undeploy the model from itendpoint.delete(force=True)# Delete the modelmodel.delete()# Delete the storage bucket and its contentsbucket.delete(force=True)\n```\n### \u522a\u9664 JupyterLab \u7b46\u8a18\u672c\u5be6\u4f8b\n\u60a8\u53ef\u4ee5\u4fdd\u7559 JupyterLab \u7b46\u8a18\u672c\u5be6\u4f8b\uff0c\u4f9b\u5c07\u4f86\u7684\u5de5\u4f5c\u4f7f\u7528\u3002\u5982\u679c\u8981\u4fdd\u7559\u5b83\uff0c\u8acb\u78ba\u4fdd\u77ad\u89e3\u5176\u6bcf\u6708\u8cbb\u7528\u3002\u5982\u9700\u67e5\u770b\u5176\u4f30\u7b97\u7684\u6bcf\u6708\u8cbb\u7528\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5de6\u5074\u5c0e\u822a\u7a97\u683c\u4e2d\u7684 **\u5de5\u5177** \u4e0b\uff0c\u9078\u64c7 **Workbench** \u3002\n- \u5728 **\u7528\u6236\u7ba1\u7406\u7684\u7b46\u8a18\u672c** \u4e2d\uff0c\u9ede\u64ca\u60a8\u7684\u7b46\u8a18\u672c\u7684\u540d\u7a31\u3002\u5728\u53f3\u5074\u7a97\u683c\u4e2d\uff0c\u60a8\u6703\u770b\u5230\u5176\u6bcf\u6708\u4f30\u7b97\u8cbb\u7528\u3002\u6709\u95dc\u8a73\u60c5\uff0c\u8acb\u5c55\u958b **\u8a73\u7d30\u4fe1\u606f** \u3002\n\u4ee5\u4e0b\u662f\u6bcf\u6708\u4f30\u7b97\u8cbb\u7528\u793a\u4f8b\u3002\u60a8\u7684\u6bcf\u6708\u4f30\u7b97\u8cbb\u7528\u53ef\u80fd\u6703\u6709\u6240\u4e0d\u540c\u3002\n\u5982\u9700\u522a\u9664 JupyterLab \u7b46\u8a18\u672c\u5be6\u4f8b\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a 1. \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5de6\u5074\u5c0e\u822a\u7a97\u683c\u4e2d\u7684 **\u5de5\u5177** \u4e0b\uff0c\u9078\u64c7 **Workbench** \u3002\n- \u5728 **\u7528\u6236\u7ba1\u7406\u7684\u7b46\u8a18\u672c** \u4e2d\uff0c\u9078\u64c7\u60a8\u7684\u7b46\u8a18\u672c\u5be6\u4f8b\u3002\n- \u5728\u4e0a\u65b9\u83dc\u55ae\u4e2d\uff0c\u9ede\u64ca **\u522a\u9664** \u3002\n- \u5728 **\u522a\u9664\u7b46\u8a18\u672c** \u78ba\u8a8d\u5c0d\u8a71\u6846\u4e2d\uff0c\u9ede\u64ca **\u522a\u9664** \u3002\u522a\u9664\u64cd\u4f5c\u9700\u8981\u5e7e\u5206\u9418\u6642\u9593\u624d\u80fd\u5b8c\u6210\u3002", "guide": "Vertex AI"}