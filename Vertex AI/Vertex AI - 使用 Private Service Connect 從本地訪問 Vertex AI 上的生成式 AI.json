{"title": "Vertex AI - \u4f7f\u7528 Private Service Connect \u5f9e\u672c\u5730\u8a2a\u554f Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI", "url": "https://cloud.google.com/vertex-ai/docs/general/vertex-psc-gen-ai?hl=zh-cn", "abstract": "# Vertex AI - \u4f7f\u7528 Private Service Connect \u5f9e\u672c\u5730\u8a2a\u554f Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI\n\u672c\u5730\u4e3b\u6a5f\u53ef\u4ee5\u901a\u904e\u5169\u7a2e\u65b9\u5f0f\u8a2a\u554f Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI\uff1a\u516c\u5171\u4e92\u806f\u7db2\uff0c\u6216\u901a\u904e Cloud VPN \u6216 Cloud Interconnect \u4f7f\u7528 Private Service Connect (PSC) \u7684\u6df7\u5408\u7db2\u7d61\u67b6\u69cb\uff08\u4ee5\u79c1\u5bc6\u65b9\u5f0f\u8a2a\u554f\uff09\u3002\u9019\u5169\u500b\u9078\u9805\u90fd\u63d0\u4f9b SSL/TLS \u52a0\u5bc6\u3002\u4f46\u662f\uff0c\u5c08\u7528\u9078\u9805\u53ef\u63d0\u4f9b\u66f4\u597d\u7684\u6027\u80fd\uff0c\u56e0\u6b64\u5efa\u8b70\u7528\u65bc\u95dc\u9375\u61c9\u7528\u3002\n\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 [\u9ad8\u53ef\u7528\u6027 VPN (HA VPN)](https://cloud.google.com/network-connectivity/docs/vpn/concepts/overview?hl=zh-cn#ha-vpn) \u901a\u904e Cloud NAT \u516c\u958b\u8a2a\u554f Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI\uff0c\u5728\u53ef\u7528\u4f5c\u591a\u96f2\u548c\u672c\u5730\u5c08\u7528\u9023\u63a5\u57fa\u790e\u7684\u5169\u500b Virtual Private Cloud (VPC) \u7db2\u7d61\u4e4b\u9593\u4ee5\u79c1\u5bc6\u65b9\u5f0f\u8a2a\u554f Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI\u3002\n\u672c\u6559\u7a0b\u9069\u7528\u65bc\u719f\u6089 Vertex AI\u3001VPC\u3001Google Cloud \u63a7\u5236\u6aaf\u548c [Cloud Shell](https://cloud.google.com/shell/docs/how-cloud-shell-works?hl=zh-cn) \u7684\u4f01\u696d\u7db2\u7d61\u7ba1\u7406\u54e1\u3001\u6578\u64da\u79d1\u5b78\u5bb6\u548c\u7814\u7a76\u4eba\u54e1\u3002\u719f\u6089 [Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI](https://cloud.google.com/vertex-ai/generative-ai/docs/learn/overview?hl=zh-cn) \u6703\u5f88\u6709\u5e6b\u52a9\uff0c\u4f46\u4e0d\u5f37\u5236\u8981\u6c42\u3002\n \n", "content": "## \u76ee\u6a19\n- \u5275\u5efa\u5169\u500b VPC \u7db2\u7d61\uff0c\u5982\u4e0a\u5716\u6240\u793a\uff1a- \u4e00\u500b (`onprem-vpc`) \u8868\u793a\u4e00\u500b\u672c\u5730\u7db2\u7d61\u3002\n- \u53e6\u4e00\u500b (`vertex-networking-vpc`) \u7528\u65bc\u8a2a\u554f Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI \u7684 REST API\u3002\n- \u90e8\u7f72\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\u3001Cloud VPN \u96a7\u9053\u548c Cloud Router \u8def\u7531\u5668\uff0c\u4ee5\u9023\u63a5`vertex-networking-vpc`\u548c`onprem-vpc`\u3002\n- \u5275\u5efa Private Service Connect (PSC) \u7aef\u9ede\uff0c\u4ee5\u5c07\u8acb\u6c42\u8f49\u767c\u5230 GenAI REST API\u3002\n- \u5728`vertex-networking-vpc`\u4e2d\u914d\u7f6e Cloud Router \u8def\u7531\u5668\u81ea\u5b9a\u7fa9\u8def\u7531\u901a\u544a\uff0c\u4ee5\u5411`onprem-vpc`\u901a\u544a Private Service Connect \u7aef\u9ede\u7684\u8def\u7531\u3002\n- \u5728`onprem-vpc`\u4e2d\u5275\u5efa Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u4ee5\u8868\u793a\u901a\u904e\u9ad8\u53ef\u7528\u6027 VPN \u5411 GenAI REST API \u767c\u9001\u8acb\u6c42\u7684\u5ba2\u6236\u7aef\u61c9\u7528\u3002\n## \u8cbb\u7528\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Google Cloud \u7684\u4ee5\u4e0b\u6536\u8cbb\u7d44\u4ef6\uff1a- [Artifact Registry](https://cloud.google.com/artifact-registry/pricing?hl=zh-cn) \n- [Cloud NAT](https://cloud.google.com/nat/pricing?hl=zh-cn) \n- [Cloud Storage](https://cloud.google.com/storage/pricing?hl=zh-cn) \n- [Cloud VPN](https://cloud.google.com/network-connectivity/pricing?hl=zh-cn#vpn-pricing) \n- [Compute Engine](https://cloud.google.com/compute/all-pricing?hl=zh-cn) \n- [Vertex AI](https://cloud.google.com/vertex-ai/pricing?hl=zh-cn) \n- [Virtual Private Cloud](https://cloud.google.com/vpc/pricing?hl=zh-cn) \n\u60a8\u53ef\u4f7f\u7528 [\u50f9\u683c\u8a08\u7b97\u5668](https://cloud.google.com/products/calculator?hl=zh-cn) \u6839\u64da\u60a8\u7684\u9810\u8a08\u4f7f\u7528\u60c5\u6cc1\u4f86\u4f30\u7b97\u8cbb\u7528\u3002 \nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5b8c\u6210\u672c\u6587\u6a94\u4e2d\u63cf\u8ff0\u7684\u4efb\u52d9\u5f8c\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u522a\u9664\u6240\u5275\u5efa\u7684\u8cc7\u6e90\u4f86\u907f\u514d\u7e7c\u7e8c\u8a08\u8cbb\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e05\u7406](#clean-up) \u3002## \u6e96\u5099\u5de5\u4f5c\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud Console \u4e2d\uff0c\u8f49\u5230\u9805\u76ee\u9078\u64c7\u5668\u9801\u9762\u3002 [\u8f49\u5230\u201c\u9805\u76ee\u9078\u64c7\u5668\u201d](https://console.cloud.google.com/projectselector2/home/dashboard?hl=zh-cn) \n- \u9078\u64c7\u6216\u5275\u5efa Google Cloud \u9805\u76ee\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- [\u78ba\u4fdd\u60a8\u7684 Google Cloud \u9805\u76ee\u5df2\u5553\u7528\u7d50\u7b97\u529f\u80fd](https://cloud.google.com/billing/docs/how-to/verify-billing-enabled?hl=zh-cn#console) \u3002\n- \u5982\u679c\u60a8\u4e0d\u662f\u9805\u76ee\u6240\u6709\u8005\uff0c\u5247\u9805\u76ee\u6240\u6709\u8005\u5fc5\u9808\u7232\u60a8\u6388\u4e88`roles/resourcemanager.projectIamAdmin`IAM \u89d2\u8272\u3002\u60a8\u9700\u8981\u5177\u6709\u6b64\u89d2\u8272\uff0c\u624d\u80fd\u7232\u60a8\u81ea\u5df1\u548c\u670d\u52d9\u8cec\u865f\u6388\u4e88 IAM \u89d2\u8272\u548c\u6b0a\u9650\u3002\n- \u6253\u958b [Cloud Shell](https://cloud.google.com/shell/docs/launching-cloud-shell-editor?hl=zh-cn) \u4ee5\u57f7\u884c\u672c\u6559\u7a0b\u4e2d\u5217\u51fa\u7684\u547d\u4ee4\u3002Cloud Shell \u662f Google Cloud \u7684\u4ea4\u4e92\u5f0f Shell \u74b0\u5883\uff0c\u53ef\u8b93\u60a8\u901a\u904e\u7db2\u7d61\u700f\u89bd\u5668\u7ba1\u7406\u9805\u76ee\u548c\u8cc7\u6e90\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u5c07\u7576\u524d\u9805\u76ee\u8a2d\u7f6e\u7232\u60a8\u7684 Google Cloud \u9805\u76ee ID\uff0c\u4e26\u5c07\u540c\u4e00\u9805\u76ee ID \u5b58\u5132\u5728`projectid`shell \u8b8a\u91cf\u4e2d\uff1a```\n projectid=\"PROJECT_ID\"\n gcloud config set project ${projectid}\n```\u5c07\u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\u5982\u6709\u5fc5\u8981\uff0c\u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u67e5\u627e\u9805\u76ee ID\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u67e5\u627e\u9805\u76ee ID](https://cloud.google.com/vertex-ai/docs/tutorials/tabular-bq-prediction/prerequisites?hl=zh-cn#find-project-id) \n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5411\u60a8\u7684 Google \u8cec\u865f\u6388\u4e88\u89d2\u8272\u3002\u5c0d\u4ee5\u4e0b\u6bcf\u500b IAM \u89d2\u8272\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e00\u6b21\uff1a `roles/compute.instanceAdmin.v1\u3001roles/compute.networkAdmin\u3001roles/compute.securityAdmin\u3001roles/dns.admin\u3001roles/iap.tunnelResourceAccessor\u3001roles/iam.serviceAccountCreator\u3001roles/iam.serviceAccountUser\u3001roles/iam.serviceAccountDeleter\u3001roles/resourcemanager.projectIamAdmin\u3001roles/servicedirectory.editor\u3001roles/servicemanagement.quotaAdmin\u3001roles/aiplatform.user````\ngcloud projects add-iam-policy-binding PROJECT_ID --member=\"user:EMAIL_ADDRESS\" --role=ROLE\n```- \u5c07``\u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\n- \u5c07``\u66ff\u63db\u7232\u60a8\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\u3002\n- \u5c07``\u66ff\u63db\u7232\u6bcf\u500b\u89d2\u8272\u3002-  Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them  \n- Enable the DNS\u3001IAM\u3001Compute Engine\u3001Service Usage \u548c Vertex AI APIs:```\ngcloud services enable dns.googleapis.com iam.googleapis.com compute.googleapis.com serviceusage.googleapis.com aiplatform.googleapis.com\n```\n## \u5275\u5efa\u5169\u500b VPC \u7db2\u7d61\uff1avertex-networking-vpc \u548c onprem-vpc\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u5169\u500b VPC \u7db2\u7d61\uff1a\u4e00\u500b\u662f\u7528\u65bc\u8a2a\u554f Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI\uff08\u4e5f\u7a31\u7232 GenAI\uff09API \u7684\u4e3b\u8981\u7db2\u7d61\uff0c\u53e6\u4e00\u500b\u7528\u65bc\u6a21\u64ec\u672c\u5730\u7db2\u7d61\u3002\n### \u5275\u5efa VPC \u7db2\u7d61\n- \u5275\u5efa\u7528\u65bc\u8a2a\u554f GenAI API \u7684 VPC \u7db2\u7d61 ( `vertex-networking-vpc` )\uff1a```\ngcloud compute networks create vertex-networking-vpc --subnet-mode custom\n```\n- \u5275\u5efa\u7528\u65bc\u6a21\u64ec\u672c\u5730\u7db2\u7d61\u7684 VPC \u7db2\u7d61 ( `onprem-vpc` )\uff1a```\ngcloud compute networks create onprem-vpc --subnet-mode custom\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `onprem-vpc-subnet1` \u7684\u5b50\u7db2\uff0c\u5176\u4e3b\u8981 IPv4 \u7bc4\u570d\u7232 `172.16.10.0/24` \uff1a```\ngcloud compute networks subnets create onprem-vpc-subnet1 \\\u00a0 \u00a0--range 172.16.10.0/24 \\\u00a0 \u00a0--network onprem-vpc \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 **VPC \u7db2\u7d61** \u9801\u9762\u7684 **\u7576\u524d\u9805\u76ee\u4e2d\u7684\u7db2\u7d61** \u6a19\u7c64\u9801\u3002 [\u524d\u5f80 VPC \u7db2\u7d61](https://console.cloud.google.com/networking/networks/list?pageTab=CURRENT_PROJECT_NETWORKS&hl=zh-cn) \n- \u5728 VPC \u7db2\u7d61\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa `vertex-networking-vpc` \u548c `onprem-vpc` \u9019\u5169\u500b\u7db2\u7d61\u3002\n- \u5728 **VPC \u7db2\u7d61** \u9801\u9762\u4e2d\uff0c\u9ede\u64ca **\u7576\u524d\u9805\u76ee\u4e2d\u7684\u5b50\u7db2** \u6a19\u7c64\u9801\u3002\n- \u5728 VPC \u5b50\u7db2\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\u5275\u5efa `onprem-vpc-subnet1` \u5b50\u7db2\u3002\n## \u914d\u7f6e\u6df7\u5408\u9023\u63a5\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u5169\u500b\u76f8\u4e92\u9023\u63a5\u7684\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\u3002\u4e00\u500b\u4f4d\u65bc `vertex-networking-vpc` VPC \u7db2\u7d61\u4e2d\u3002\u53e6\u4e00\u500b\u4f4d\u65bc `onprem-vpc` VPC \u7db2\u7d61\u4e2d\u3002\u6bcf\u500b\u7db2\u95dc\u5305\u542b\u4e00\u500b Cloud Router \u8def\u7531\u5668\u548c\u4e00\u5c0d VPN \u96a7\u9053\u3002\n### \u5275\u5efa\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\n- \u5728 Cloud Shell \u4e2d\uff0c\u7232 `vertex-networking-vpc` VPC \u7db2\u7d61\u5275\u5efa\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\uff1a```\ngcloud compute vpn-gateways create vertex-networking-vpn-gw1 \\\u00a0 \u00a0--network vertex-networking-vpc \\\u00a0 \u00a0--region us-central1\n```\n- \u7232 `onprem-vpc` VPC \u7db2\u7d61\u5275\u5efa\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\uff1a```\ngcloud compute vpn-gateways create onprem-vpn-gw1 \\\u00a0 \u00a0--network onprem-vpc \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 **VPN** \u9801\u9762\u4e2d\u7684 **Cloud VPN \u7db2\u95dc** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230 VPN](https://console.cloud.google.com/hybrid/vpn?tab=gateways&hl=zh-cn) \n- \u5728 VPN \u7db2\u95dc\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa\u5169\u500b\u7db2\u95dc\uff08 `vertex-networking-vpn-gw1` \u548c `onprem-vpn-gw1` \uff09\uff0c\u4e26\u4e14\u6bcf\u500b\u7db2\u95dc\u6709\u5169\u500b IP \u5730\u5740\u3002\n### \u5275\u5efa Cloud Router \u8def\u7531\u5668\n- \u5728 Cloud Shell \u4e2d\uff0c\u7232 `vertex-networking-vpc` VPC \u7db2\u7d61\u5275\u5efa\u4e00\u500b Cloud Router \u8def\u7531\u5668\uff1a```\ngcloud compute routers create vertex-networking-vpc-router1 \\\u00a0 \u00a0--region us-central1\\\u00a0 \u00a0--network vertex-networking-vpc \\\u00a0 \u00a0--asn 65001\n```\n- \u7232 `onprem-vpc` VPC \u7db2\u7d61\u5275\u5efa\u4e00\u500b Cloud Router \u8def\u7531\u5668\uff1a```\ngcloud compute routers create onprem-vpc-router1 \\\u00a0 \u00a0--region us-central1\\\u00a0 \u00a0--network onprem-vpc\\\u00a0 \u00a0--asn 65002\n```\n### \u5c07 Cloud NAT \u7db2\u95dc\u6dfb\u52a0\u5230 onprem-vpc VPC \u7db2\u7d61\u5728\u6b64\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u5411 `onprem-vpc` VPC \u7db2\u7d61\u7684 Cloud Router \u8def\u7531\u5668\u6dfb\u52a0 Cloud NAT \u7db2\u95dc\u3002Cloud NAT \u7db2\u95dc\u7232\u6c92\u6709\u5916\u90e8 IP \u5730\u5740\u7684 Compute Engine \u865b\u64ec\u6a5f (VM) \u5be6\u4f8b\u63d0\u4f9b\u50b3\u51fa\u9023\u63a5\u3002- \u5728 Cloud Shell \u4e2d\uff0c\u5c07 Cloud NAT \u7db2\u95dc\u6dfb\u52a0\u5230 `onprem-vpc-router1` Cloud Router \u8def\u7531\u5668\uff1a```\ngcloud compute routers nats create us-central-cloudnat-onprem \\\u00a0 \u00a0--router=onprem-vpc-router1 \\\u00a0 \u00a0--auto-allocate-nat-external-ips \\\u00a0 \u00a0--nat-all-subnet-ip-ranges \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 **Cloud Router \u8def\u7531\u5668** \u9801\u9762\u3002 [\u524d\u5f80\u201cCloud Router \u8def\u7531\u5668\u201d](https://console.cloud.google.com/hybrid/routers/list?hl=zh-cn) \n- \u5728 Cloud Router \u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa `vertex-networking-vpc-router1` \u548c `onprem-vpc-router1` \u3002\u60a8\u53ef\u80fd\u9700\u8981\u5237\u65b0 Google Cloud \u63a7\u5236\u6aaf\u700f\u89bd\u5668\u6a19\u7c64\u9801\u624d\u80fd\u67e5\u770b\u65b0\u503c\u3002\n- \u5728 Cloud Router \u8def\u7531\u5668\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `onprem-vpc-router1` \u3002\n- \u5728 **\u8def\u7531\u5668\u8a73\u60c5** \u9801\u9762\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa `us-central-cloudnat-onprem` Cloud NAT \u7db2\u95dc\u3002\n### \u5275\u5efa VPN \u96a7\u9053\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `vertex-networking-vpc-tunnel0` \u7684 VPN \u96a7\u9053\uff1a```\ngcloud compute vpn-tunnels create vertex-networking-vpc-tunnel0 \\\u00a0 \u00a0--peer-gcp-gateway onprem-vpn-gw1 \\\u00a0 \u00a0--region us-central1 \\\u00a0 \u00a0--ike-version 2 \\\u00a0 \u00a0--shared-secret [ZzTLxKL8fmRykwNDfCvEFIjmlYLhMucH] \\\u00a0 \u00a0--router vertex-networking-vpc-router1 \\\u00a0 \u00a0--vpn-gateway vertex-networking-vpn-gw1 \\\u00a0 \u00a0--interface 0\n```\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `vertex-networking-vpc-tunnel1` \u7684 VPN \u96a7\u9053\uff1a```\ngcloud compute vpn-tunnels create vertex-networking-vpc-tunnel1 \\\u00a0 \u00a0--peer-gcp-gateway onprem-vpn-gw1 \\\u00a0 \u00a0--region us-central1 \\\u00a0 \u00a0--ike-version 2 \\\u00a0 \u00a0--shared-secret [bcyPaboPl8fSkXRmvONGJzWTrc6tRqY5] \\\u00a0 \u00a0--router vertex-networking-vpc-router1 \\\u00a0 \u00a0--vpn-gateway vertex-networking-vpn-gw1 \\\u00a0 \u00a0--interface 1\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `onprem-vpc-tunnel0` \u7684 VPN \u96a7\u9053\uff1a```\ngcloud compute vpn-tunnels create onprem-vpc-tunnel0 \\\u00a0 \u00a0--peer-gcp-gateway vertex-networking-vpn-gw1 \\\u00a0 \u00a0--region us-central1\\\u00a0 \u00a0--ike-version 2 \\\u00a0 \u00a0--shared-secret [ZzTLxKL8fmRykwNDfCvEFIjmlYLhMucH] \\\u00a0 \u00a0--router onprem-vpc-router1 \\\u00a0 \u00a0--vpn-gateway onprem-vpn-gw1 \\\u00a0 \u00a0--interface 0\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `onprem-vpc-tunnel1` \u7684 VPN \u96a7\u9053\uff1a```\ngcloud compute vpn-tunnels create onprem-vpc-tunnel1 \\\u00a0 \u00a0--peer-gcp-gateway vertex-networking-vpn-gw1 \\\u00a0 \u00a0--region us-central1\\\u00a0 \u00a0--ike-version 2 \\\u00a0 \u00a0--shared-secret [bcyPaboPl8fSkXRmvONGJzWTrc6tRqY5] \\\u00a0 \u00a0--router onprem-vpc-router1 \\\u00a0 \u00a0--vpn-gateway onprem-vpn-gw1 \\\u00a0 \u00a0--interface 1\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **VPN** \u9801\u9762\u3002 [\u8f49\u5230 VPN](https://console.cloud.google.com/hybrid/vpn?hl=zh-cn) \n- \u5728 VPN \u96a7\u9053\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa\u9019\u56db\u500b VPN \u96a7\u9053\u3002\n## \u5efa\u7acb BGP \u6703\u8a71Cloud Router \u8def\u7531\u5668\u4f7f\u7528\u908a\u754c\u7db2\u95dc\u5354\u8b70 (BGP) \u5728 VPC \u7db2\u7d61\uff08\u5728\u672c\u4f8b\u4e2d\u7232 `vertex-networking-vpc` \uff09\u548c\u672c\u5730\u7db2\u7d61\uff08\u7531 `onprem-vpc` \u8868\u793a\uff09\u4e4b\u9593\u4ea4\u63db\u8def\u7531\u3002\u5728 Cloud Router \u8def\u7531\u5668\u4e0a\uff0c\u7232\u672c\u5730\u8def\u7531\u5668\u914d\u7f6e\u63a5\u53e3\u548c BGP \u5c0d\u7b49\u7aef\u3002\u6b64\u63a5\u53e3\u548c BGP \u5c0d\u7b49\u914d\u7f6e\u5171\u540c\u69cb\u6210\u4e86 BGP \u6703\u8a71\u3002\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5206\u5225\u7232 `vertex-networking-vpc` \u548c `onprem-vpc` \u5275\u5efa\u5169\u500b BGP \u6703\u8a71\u3002\n\u5728\u8def\u7531\u5668\u4e4b\u9593\u914d\u7f6e\u63a5\u53e3\u548c BGP \u5c0d\u7b49\u65b9\u5f8c\uff0c\u5b83\u5011\u5c07\u81ea\u52d5\u958b\u59cb\u4ea4\u63db\u8def\u7531\u3002\n### \u7232 vertex-networking-vpc \u5efa\u7acb BGP \u6703\u8a71\n- \u5728 Cloud Shell \u4e2d\uff0c\u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\u7232 `vertex-networking-vpc-tunnel0` \u5275\u5efa\u4e00\u500b BGP \u63a5\u53e3\uff1a```\ngcloud compute routers add-interface vertex-networking-vpc-router1 \\\u00a0 \u00a0--interface-name if-tunnel0-to-onprem \\\u00a0 \u00a0--ip-address 169.254.0.1 \\\u00a0 \u00a0--mask-length 30 \\\u00a0 \u00a0--vpn-tunnel vertex-networking-vpc-tunnel0 \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `bgp-onprem-tunnel0` \u5275\u5efa\u4e00\u500b BGP \u5c0d\u7b49\u65b9\uff1a```\ngcloud compute routers add-bgp-peer vertex-networking-vpc-router1 \\\u00a0 \u00a0--peer-name bgp-onprem-tunnel0 \\\u00a0 \u00a0--interface if-tunnel0-to-onprem \\\u00a0 \u00a0--peer-ip-address 169.254.0.2 \\\u00a0 \u00a0--peer-asn 65002 \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `vertex-networking-vpc-tunnel1` \u5275\u5efa\u4e00\u500b BGP \u63a5\u53e3\uff1a```\ngcloud compute routers add-interface vertex-networking-vpc-router1 \\\u00a0 \u00a0--interface-name if-tunnel1-to-onprem \\\u00a0 \u00a0--ip-address 169.254.1.1 \\\u00a0 \u00a0--mask-length 30 \\\u00a0 \u00a0--vpn-tunnel vertex-networking-vpc-tunnel1 \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `bgp-onprem-tunnel1` \u5275\u5efa\u4e00\u500b BGP \u5c0d\u7b49\u65b9\uff1a```\ngcloud compute routers add-bgp-peer vertex-networking-vpc-router1 \\\u00a0 \u00a0--peer-name bgp-onprem-tunnel1 \\\u00a0 \u00a0--interface if-tunnel1-to-onprem \\\u00a0 \u00a0--peer-ip-address 169.254.1.2 \\\u00a0 \u00a0--peer-asn 65002 \\\u00a0 \u00a0--region us-central1\n```\n### \u7232 onprem-vpc \u5efa\u7acb BGP \u6703\u8a71\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `onprem-vpc-tunnel0` \u5275\u5efa\u4e00\u500b BGP \u63a5\u53e3\uff1a```\ngcloud compute routers add-interface onprem-vpc-router1 \\\u00a0 \u00a0--interface-name if-tunnel0-to-vertex-networking-vpc \\\u00a0 \u00a0--ip-address 169.254.0.2 \\\u00a0 \u00a0--mask-length 30 \\\u00a0 \u00a0--vpn-tunnel onprem-vpc-tunnel0 \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `bgp-vertex-networking-vpc-tunnel0` \u5275\u5efa\u4e00\u500b BGP \u5c0d\u7b49\u65b9\uff1a```\ngcloud compute routers add-bgp-peer onprem-vpc-router1 \\\u00a0 \u00a0--peer-name bgp-vertex-networking-vpc-tunnel0 \\\u00a0 \u00a0--interface if-tunnel0-to-vertex-networking-vpc \\\u00a0 \u00a0--peer-ip-address 169.254.0.1 \\\u00a0 \u00a0--peer-asn 65001 \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `onprem-vpc-tunnel1` \u5275\u5efa\u4e00\u500b BGP \u63a5\u53e3\uff1a```\ngcloud compute routers add-interface onprem-vpc-router1 \u00a0\\\u00a0 \u00a0--interface-name if-tunnel1-to-vertex-networking-vpc \\\u00a0 \u00a0--ip-address 169.254.1.2 \\\u00a0 \u00a0--mask-length 30 \\\u00a0 \u00a0--vpn-tunnel onprem-vpc-tunnel1 \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `bgp-vertex-networking-vpc-tunnel1` \u5275\u5efa\u4e00\u500b BGP \u5c0d\u7b49\u65b9\uff1a```\ngcloud compute routers add-bgp-peer onprem-vpc-router1 \\\u00a0 \u00a0--peer-name bgp-vertex-networking-vpc-tunnel1 \\\u00a0 \u00a0--interface if-tunnel1-to-vertex-networking-vpc \\\u00a0 \u00a0--peer-ip-address 169.254.1.1 \\\u00a0 \u00a0--peer-asn 65001 \\\u00a0 \u00a0--region us-central1\n```\n### \u9a57\u8b49 BGP \u6703\u8a71\u5275\u5efa\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **VPN** \u9801\u9762\u3002 [\u8f49\u5230 VPN](https://console.cloud.google.com/hybrid/vpn/list?hl=zh-cn) \n- \u5728 VPN \u96a7\u9053\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u6bcf\u500b\u96a7\u9053\u7684 **BGP \u6703\u8a71\u72c0\u614b** \u5217\u4e2d\u7684\u503c\u662f\u5426\u5df2\u5f9e **\u914d\u7f6e BGP \u6703\u8a71** \u66f4\u6539\u7232 **BGP \u5df2\u5efa\u7acb** \u3002\u60a8\u53ef\u80fd\u9700\u8981\u5237\u65b0 Google Cloud \u63a7\u5236\u6aaf\u700f\u89bd\u5668\u6a19\u7c64\u9801\u624d\u80fd\u67e5\u770b\u65b0\u503c\u3002\n## \u5275\u5efa Private Service Connect (PSC) \u7aef\u9ede\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u7232 Google API \u5275\u5efa Private Service Connect (PSC) \u7aef\u9ede\uff0c\u4f9b `onprem-vpc` \u7db2\u7d61\u4e2d\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u7528\u65bc\u5f9e `onprem-vpc` \u7db2\u7d61\u8a2a\u554f GenAI API\u3002\nPrivate Service Connect (PSC) \u7aef\u9ede \u662f `onprem-vpc` \u7db2\u7d61\u4e2d\u7684\u5167\u90e8 IP \u5730\u5740\uff0c\u8a72\u7db2\u7d61\u4e2d\u7684\u5ba2\u6236\u7aef\u53ef\u4ee5\u76f4\u63a5\u8a2a\u554f\u8a72\u5730\u5740\u3002\u6b64\u7aef\u9ede\u7684\u5275\u5efa\u65b9\u5f0f\u662f\u90e8\u7f72\u4e00\u689d\u8f49\u767c\u898f\u5247\uff0c\u7528\u65bc\u5c07\u8207 PSC \u7aef\u9ede\u7684 IP \u5730\u5740\u5339\u914d\u7684\u7db2\u7d61\u6d41\u91cf\u5b9a\u5411\u5230 Google API \u8edf\u4ef6\u5305\uff08\u5177\u9ad4\u4f86\u8aaa [all-apis](https://cloud.google.com/vpc/docs/about-accessing-google-apis-endpoints?hl=zh-cn#supported-apis) \u8edf\u4ef6\u5305\uff09\u3002\nPSC \u7aef\u9ede\u7684 IP \u5730\u5740 ( `192.168.0.1` ) \u5c07\u5728\u5f8c\u9762\u7684\u6b65\u9a5f\u4e2d\u4f5c\u7232\u81ea\u5b9a\u7fa9\u8def\u7531\u901a\u544a\u5f9e `vertex-networking-vpc-router` Cloud Router \u8def\u7531\u5668\u901a\u544a\u7d66 `onprem-vpc` \u7db2\u7d61\u3002- \u9810\u7559\u8981\u5206\u914d\u7d66\u7aef\u9ede\u7684\u5168\u7403\u5167\u90e8 IP \u5730\u5740\uff1a```\ngcloud compute addresses create psc-googleapi-ip \\\u00a0 \u00a0--global \\\u00a0 \u00a0--purpose=PRIVATE_SERVICE_CONNECT \\\u00a0 \u00a0--addresses=192.168.0.1 \\\u00a0 \u00a0--network=vertex-networking-vpc\n```\n- \u5275\u5efa\u7aef\u9ede\uff0c\u4ee5\u53ca\u5c07\u7aef\u9ede\u9023\u63a5\u5230 Google API \u548c\u670d\u52d9\u7684\u8f49\u767c\u898f\u5247\uff1a```\ngcloud compute forwarding-rules create pscvertex \\\u00a0 \u00a0--global \\\u00a0 \u00a0--network=vertex-networking-vpc\\\u00a0 \u00a0--address=psc-googleapi-ip \\\u00a0 \u00a0--target-google-apis-bundle=all-apis\n```\n- \u5217\u51fa\u5df2\u914d\u7f6e\u7684 PSC \u7aef\u9ede\u4e26\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa `pscvertex` \u7aef\u9ede\uff1a```\ngcloud compute forwarding-rules list \u00a0\\\u00a0 \u00a0--filter target=\"(all-apis OR vpc-sc)\" --global\n```\n- \u7372\u53d6\u5df2\u914d\u7f6e\u7684 PSC \u7aef\u9ede\u7684\u8a73\u7d30\u4fe1\u606f\uff0c\u4e26\u9a57\u8b49 IP \u5730\u5740\u662f\u5426\u7232 `192.168.0.1` \uff1a```\ngcloud compute forwarding-rules describe \\\u00a0 \u00a0pscvertex --global\n```\n## \u7232 vertex-networking-vpc \u5275\u5efa\u81ea\u5b9a\u7fa9\u8def\u7531\u901a\u544a\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u7232 `vertex-networking-vpc-router1` \uff08 `vertex-networking-vpc` \u7684 Cloud Route \u8def\u7531\u5668\uff09\u5275\u5efa [\u81ea\u5b9a\u7fa9\u8def\u7531\u901a\u544a](https://cloud.google.com/network-connectivity/docs/router/how-to/advertising-custom-ip?hl=zh-cn) \uff0c\u4ee5\u5c07 PSC \u7aef\u9ede\u7684 IP \u5730\u5740\u901a\u544a\u7d66 `onprem-vpc` \u7db2\u7d61\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 **Cloud Router \u8def\u7531\u5668** \u9801\u9762\u3002 [\u524d\u5f80\u201cCloud Router \u8def\u7531\u5668\u201d](https://console.cloud.google.com/hybrid/routers/list?hl=zh-cn) \n- \u5728 Cloud Router \u8def\u7531\u5668\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `vertex-networking-vpc-router1` \u3002\n- \u5728 **\u8def\u7531\u5668\u8a73\u60c5** \u9801\u9762\u4e0a\uff0c\u9ede\u64ca edit **\u4fee\u6539** \u3002\n- \u5728 **\u901a\u544a\u7684\u8def\u7531** \u90e8\u5206\uff0c\u5c0d\u65bc **\u8def\u7531** \uff0c\u9078\u64c7 **\u5275\u5efa\u81ea\u5b9a\u7fa9\u8def\u7531** \u3002\n- \u9078\u4e2d **\u901a\u544a\u5411 Cloud Router \u8def\u7531\u5668\u516c\u958b\u7684\u6240\u6709\u5b50\u7db2** \u8907\u9078\u6846\uff0c\u4ee5\u7e7c\u7e8c\u901a\u544a Cloud Router \u8def\u7531\u5668\u53ef\u7528\u7684\u5b50\u7db2\u3002\u5553\u7528\u6b64\u9078\u9805\u53ef\u6a21\u64ec Cloud Router \u8def\u7531\u5668\u5728\u9ed8\u8a8d\u901a\u544a\u6a21\u5f0f\u4e0b\u7684\u884c\u7232\u3002\n- \u9ede\u64ca **\u6dfb\u52a0\u81ea\u5b9a\u7fa9\u8def\u7531** \u3002\n- \u5c0d\u65bc **\u4f86\u6e90** \uff0c\u9078\u64c7 **\u81ea\u5b9a\u7fa9 IP \u7bc4\u570d** \u3002\n- \u5728 **IP \u5730\u5740\u7bc4\u570d** \u5b57\u6bb5\u4e2d\uff0c\u8f38\u5165\u4ee5\u4e0b IP \u5730\u5740\uff1a```\n192.168.0.1\n```\n- \u5728 **\u8aaa\u660e** \u5b57\u6bb5\u4e2d\uff0c\u8f38\u5165\u4ee5\u4e0b\u6587\u672c\uff1a```\nCustom route to advertise Private Service Connect endpoint IP address\n```\n- \u9ede\u64ca **\u5b8c\u6210** \uff0c\u7136\u5f8c\u9ede\u64ca **\u4fdd\u5b58** \u3002\n### \u9a57\u8b49 onprem-vpc \u662f\u5426\u5df2\u77ad\u89e3\u901a\u544a\u7684\u8def\u7531\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **\u8def\u7531** \u9801\u9762\u3002 [\u9032\u5165\u201c\u8def\u7531\u201d](https://console.cloud.google.com/networking/routes/list?hl=zh-cn) \n- \u5728 **\u6709\u6548\u8def\u7531** \u6a19\u7c64\u9801\u4e0a\uff0c\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5728 **\u7db2\u7d61** \u5b57\u6bb5\u4e2d\uff0c\u9078\u64c7`onprem-vpc`\u3002\n- \u5728 **\u5340\u57df** \u5b57\u6bb5\u4e2d\uff0c\u9078\u64c7`us-central1 (Iowa)`\u3002\n- \u9ede\u64ca **\u8996\u5716** \u3002\n- \u5728\u8def\u7531\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5b58\u5728\u540d\u7a31\u4ee5 `onprem-vpc-router1-bgp-vertex-networking-vpc-tunnel0` \u548c `onprem-vpc-router1-bgp-vfertex-networking-vpc-tunnel1` \u958b\u982d\u7684\u689d\u76ee\uff0c\u4e26\u4e14\u5169\u8005\u7684 **\u76ee\u6a19 IP \u7bc4\u570d** \u7232 `192.168.0.1/32` \u3002\uff08 `192.168.0.1` \u662f PSC \u7aef\u9ede\u7684 IP \u5730\u5740\u3002\uff09\u5982\u679c\u9019\u4e9b\u689d\u76ee\u6c92\u6709\u7acb\u5373\u986f\u793a\uff0c\u8acb\u7b49\u5f85\u5e7e\u5206\u9418\uff0c\u7136\u5f8c\u5237\u65b0 Google Cloud \u63a7\u5236\u6aaf\u700f\u89bd\u5668\u6a19\u7c64\u9801\u3002## \u5728\u672c\u5730\u7db2\u7d61\u4e2d\u914d\u7f6e\u865b\u64ec\u6a5f\u5be6\u4f8b\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5728 `onprem-vpc` VPC \u7db2\u7d61\u4e2d\u5275\u5efa\u4e00\u500b Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\u3002\u6b64\u865b\u64ec\u6a5f\u5be6\u4f8b\u6a21\u64ec\u9023\u63a5\u5230 PSC \u7aef\u9ede\u4e26\u8a2a\u554f GenAI API \u7684\u672c\u5730\u5ba2\u6236\u7aef\u3002\n### \u5275\u5efa\u7528\u6236\u7ba1\u7406\u7684\u670d\u52d9\u8cec\u865f\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u6309\u7167 Compute Engine \u548c IAM [\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/iam/docs/service-account-types?hl=zh-cn#default) \u5275\u5efa\u7528\u6236\u7ba1\u7406\u7684\u670d\u52d9\u8cec\u865f\u3002- \u5728 Cloud Shell \u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\uff1a```\nprojectid=PROJECT_IDgcloud config set project ${projectid}\n```\n- \u5275\u5efa\u670d\u52d9\u8cec\u865f\uff1a```\ngcloud iam service-accounts create user-managed-sa\n```\n- \u5c07 [Vertex AI User (roles/aiplatform.user)](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#aiplatform.user) IAM \u89d2\u8272\u5206\u914d\u7d66\u8a72\u670d\u52d9\u8cec\u865f\uff1a```\ngcloud projects add-iam-policy-binding $projectid \\\u00a0 \u00a0--member=\"serviceAccount:user-managed-sa@$projectid.iam.gserviceaccount.com\" \\\u00a0 \u00a0--role=\"roles/aiplatform.user\"\n```\n### \u5275\u5efa on-prem-client \u865b\u64ec\u6a5f\u5be6\u4f8b\u5728\u6b64\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u8a72\u5be6\u4f8b\u5c07\u4f7f\u7528 Private Service Connect IP \u5730\u5740 ( `192.168.0.1` ) \u901a\u904e\u9ad8\u53ef\u7528\u6027 VPN \u8a2a\u554f Google API\u3002\n\u5982\u9700\u5141\u8a31 Identity-Aware Proxy (IAP) \u9023\u63a5\u5230\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u8acb\u5275\u5efa\u4e00\u689d\u9632\u706b\u7246\u898f\u5247\uff0c\u8a72\u898f\u5247\u61c9\uff1a- \u9069\u7528\u65bc\u60a8\u8981\u901a\u904e IAP \u8a2a\u554f\u7684\u6240\u6709\u865b\u64ec\u6a5f\u5be6\u4f8b\u3002 \uff08\u5728\u672c\u4f8b\u4e2d\uff0c\u53ea\u6709`on-prem-client`\u3002\uff09\n- \u5141\u8a31\u4f86\u81ea IP \u5730\u5740\u7bc4\u570d`35.235.240.0/20`\u7684\u3001\u901a\u904e\u7aef\u53e3 22 \u7684 TCP \u6d41\u91cf\u6b64\u7bc4\u570d\u5305\u542b IAP \u7528\u65bc [TCP \u8f49\u767c](https://cloud.google.com/iap/docs/using-tcp-forwarding?hl=zh-cn#gcloud) \u7684\u6240\u6709 IP \u5730\u5740\u3002\n- \u5275\u5efa `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\u3002\u4ee5\u4e0b\u547d\u4ee4\u9084\u6703\u5b89\u88dd `tcpdump` \u548c `dnsutils` \u8edf\u4ef6\u5305\uff0c\u5176\u4e2d\u5305\u542b\u4e4b\u5f8c\u7528\u65bc\u9a57\u8b49 API \u8acb\u6c42\u7684 `tcpdump` \u548c `dig` \u5be6\u7528\u7a0b\u5e8f\uff1a```\ngcloud compute instances create on-prem-client \\\u00a0 \u00a0--zone=us-central1-a \\\u00a0 \u00a0--image-family=debian-11 \\\u00a0 \u00a0--image-project=debian-cloud \\\u00a0 \u00a0--subnet=onprem-vpc-subnet1 \\\u00a0 \u00a0--scopes=https://www.googleapis.com/auth/cloud-platform \\\u00a0 \u00a0--no-address \\\u00a0 \u00a0--shielded-secure-boot \\\u00a0 \u00a0--service-account=user-managed-sa@$projectid.iam.gserviceaccount.com \\\u00a0 \u00a0--metadata startup-script=\"#! /bin/bash\u00a0 \u00a0 \u00a0 sudo apt-get update\u00a0 \u00a0 \u00a0 sudo apt-get install tcpdump dnsutils -y\"\n```\n- \u5275\u5efa\u4e00\u500b\u540d\u7232 `ssh-iap-on-prem-vpc` \u7684 IAP \u9632\u706b\u7246\u898f\u5247\uff1a```\ngcloud compute firewall-rules create ssh-iap-on-prem-vpc \\\u00a0 \u00a0--network onprem-vpc \\\u00a0 \u00a0--allow tcp:22 \\\u00a0 \u00a0--source-ranges=35.235.240.0/20\n```\n## \u9a57\u8b49\u5c0d Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI \u7684\u516c\u5171\u4e92\u806f\u7db2\u8a2a\u554f\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Identity-Aware Proxy \u767b\u9304 `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u7136\u5f8c\u901a\u904e\u5c0d\u516c\u5171 Vertex AI \u7db2\u57df ( `us-central1-aiplatform.googleapis.com` ) \u904b\u884c `dig` \u547d\u4ee4\u4f86\u9a57\u8b49\u8207 Vertex AI API\uff08\u5305\u62ec GenAI\uff09\u7684\u516c\u5171\u9023\u63a5\u3002- \u5728 Cloud Shell\uff08\u7b2c\u4e00\u500b\u6a19\u7c64\u9801\uff09\u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\uff1a```\nprojectid=PROJECT_IDgcloud config set project ${projectid}\n```\n- \u4f7f\u7528 IAP \u767b\u9304\u5230 `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a```\ngcloud compute ssh on-prem-client --project=$projectid --zone=us-central1-a --tunnel-through-iap\n```\n- \u904b\u884c `dig` \u547d\u4ee4\uff1a```\ndig us-central1-aiplatform.googleapis.com\n```\u60a8\u61c9\u8a72\u6703\u770b\u5230\u985e\u4f3c\u5982\u4e0b\u6240\u793a\u7684 `dig` \u8f38\u51fa\uff0c\u5176\u4e2d\u61c9\u7b54\u90e8\u5206\u4e2d\u7684 IP \u5730\u5740\u662f\u516c\u5171 IP \u5730\u5740\uff1a```\n; <<>> DiG 9.16.44-Debian <<>> us-central1.aiplatfom.googleapis.com;; global options: +cmd;; Got answer:;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 42506;; flags: qr rd ra; QUERY: 1, ANSWER: 16, AUTHORITY: 0, ADDITIONAL: 1;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 512;; QUESTION SECTION:;us-central1.aiplatfom.googleapis.com. IN A;; ANSWER SECTION:us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0173.194.192.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0142.250.152.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0172.217.219.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0209.85.146.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0209.85.147.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0142.250.125.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0142.250.136.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0142.250.148.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0209.85.200.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0209.85.234.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0142.251.171.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0108.177.112.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0142.250.128.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0142.251.6.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a0172.217.212.95us-central1.aiplatfom.googleapis.com. 300 IN A \u00a074.125.124.95;; Query time: 8 msec;; SERVER: 169.254.169.254#53(169.254.169.254);; WHEN: Wed Sep 27 04:10:16 UTC 2023;; MSG SIZE \u00a0rcvd: 321\n```\n## \u914d\u7f6e\u4e26\u9a57\u8b49\u5c0d Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI \u7684\u5c08\u7528\u8a2a\u554f\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u914d\u7f6e\u5c0d Vertex AI \u4e0a\u7684\u751f\u6210\u5f0f AI \u7684\u5c08\u7528\u8a2a\u554f\uff0c\u4ee5\u4fbf\u5728\u60a8\u5c07\u8acb\u6c42\u767c\u9001\u5230\u516c\u5171\u670d\u52d9\u7aef\u9ede ( `us-central1-aiplatform.googleapis.com` ) \u6642\uff0c\u5b83\u5011\u6703\u6539\u7232\u91cd\u5b9a\u5411\u5230 PSC \u7aef\u9ede\u3002\u7136\u5f8c\uff0cPSC \u7aef\u9ede\u6703\u8f49\u767c\u8acb\u6c42\u3002\n### \u5c07 /etc/hosts \u6587\u4ef6\u66f4\u65b0\u7232\u6307\u5411 PSC \u7aef\u9ede\u5728\u6b64\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u5728 `/etc/hosts` \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u884c\uff0c\u4ee5\u4f7f\u767c\u9001\u5230\u516c\u5171\u670d\u52d9\u7aef\u9ede ( `us-central1-aiplatform.googleapis.com` ) \u7684\u8acb\u6c42\u91cd\u5b9a\u5411\u5230 PSC \u7aef\u9ede ( `192.168.0.1` )\u3002- \u5728 `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\uff08\u7b2c\u4e00\u500b\u6a19\u7c64\u9801\uff09\u4e2d\uff0c\u4f7f\u7528\u6587\u672c\u7de8\u8f2f\u5668\uff08\u4f8b\u5982 [vim](https://www.cs.cmu.edu/%7E15131/f17/topics/vim/vim-cheatsheet.pdf) \u6216 [nano](https://www.nano-editor.org/dist/latest/cheatsheet.html) \uff09\u6253\u958b `/etc/hosts` \u6587\u4ef6\uff1a```\nsudo vim /etc/hosts\n```\n- \u5c07\u4ee5\u4e0b\u4ee3\u78bc\u884c\u6dfb\u52a0\u5230\u6587\u4ef6\u4e2d\uff1a```\n192.168.0.1 us-central1-aiplatform.googleapis.com\n```\u6b64\u884c\u5c07 PSC \u7aef\u9ede\u7684 IP \u5730\u5740 ( `192.168.0.1` ) \u5206\u914d\u7d66 Vertex AI Google API ( `us-central1-aiplatform.googleapis.com` ) \u7684\u5b8c\u5168\u9650\u5b9a\u57df\u540d\u3002\u4fee\u6539\u5f8c\u7684\u6587\u4ef6\u61c9\u5982\u4e0b\u6240\u793a\uff1a```\n127.0.0.1 \u00a0 \u00a0 \u00a0 localhost::1 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 localhost ip6-localhost ip6-loopbackff02::1 \u00a0 \u00a0 \u00a0 \u00a0 ip6-allnodesff02::2 \u00a0 \u00a0 \u00a0 \u00a0 ip6-allrouters192.168.0.1 us-central1-aiplatform.googleapis.com \u00a0# Added by you172.16.10.6 on-prem-client.us-central1-a.c.vertex-genai-400103.internal on-prem-client \u00a0# Added by Google169.254.169.254 metadata.google.internal \u00a0# Added by Google\n```\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u4fdd\u5b58\u6587\u4ef6\uff1a- \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f`vim`\uff0c\u8acb\u6309`Esc`\u9375\uff0c\u7136\u5f8c\u8f38\u5165`:wq`\u4ee5\u4fdd\u5b58\u6587\u4ef6\u4e26\u9000\u51fa\u3002\n- \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f`nano`\uff0c\u8acb\u8f38\u5165`Control+O`\u4e26\u6309`Enter`\u4ee5\u4fdd\u5b58\u8a72\u6587\u4ef6\uff0c\u7136\u5f8c\u8f38\u5165`Control+X`\u4ee5\u9000\u51fa\u3002\n- \u5c0d Vertex AI \u7aef\u9ede\u57f7\u884c ping \u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a```\nping us-central1-aiplatform.googleapis.com\n````ping` \u547d\u4ee4\u61c9\u8fd4\u56de\u4ee5\u4e0b\u8f38\u51fa\u3002 `192.168.0.1` \u662f PSC \u7aef\u9ede IP \u5730\u5740\uff1a```\nPING us-central1-aiplatform.googleapis.com (192.168.0.1) 56(84) bytes of data.\n```\n- \u8f38\u5165 `Control+C` \u4ee5\u9000\u51fa `ping` \u3002\n- \u5728\u5411\u7aef\u9ede\u767c\u9001\u5728\u7dda\u9810\u6e2c\u8acb\u6c42\u6642\uff0c\u904b\u884c\u4ee5\u4e0b `tcpdump` \u547d\u4ee4\u9a57\u8b49 DNS \u89e3\u6790\u548c IP \u6578\u64da\u8def\u5f91\uff1a```\n\u00a0sudo tcpdump -i any port 53 -n or host 192.168.0.1\n```\n### \u5275\u5efa\u4e0d\u516c\u958b\u8acb\u6c42\u5728\u6b64\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u4e00\u500b\u540d\u7232 `request.json` \u7684\u6587\u672c\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u60a8\u5411 GenAI REST API \u767c\u9001\u7684\u793a\u4f8b `curl` \u8acb\u6c42\u7684\u8f09\u8377\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u793a\u4f8b\u8acb\u6c42\uff0c\u8acb\u53c3\u95b1 [\u793a\u4f8b\u8acb\u6c42](https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/text?hl=zh-cn#sample_request) \u3002- \u5728\u7b2c\u4e00\u500b\u6a19\u7c64\u9801\u4e2d\u904b\u884c `tcpdump` \u547d\u4ee4\uff0c\u9ede\u64ca Cloud Shell \u4e2d\u7684 add **\u6253\u958b\u65b0\u7684\u6a19\u7c64\u9801** \uff0c\u4ee5\u6253\u958b\u65b0\u7684 Cloud Shell \u6703\u8a71\uff08\u7b2c\u4e8c\u500b\u6a19\u7c64\u9801\uff09\u3002\n- \u5728\u65b0\u7684 Cloud Shell \u6703\u8a71\uff08\u7b2c\u4e8c\u500b\u6a19\u7c64\u9801\uff09\u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\uff1a```\nprojectid=PROJECT_IDgcloud config set project ${projectid}\n```\n- \u4f7f\u7528 IAP \u767b\u9304\u5230 `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a```\ngcloud compute ssh on-prem-client --project=$projectid --zone=us-central1-a --tunnel-through-iap\n```\n- \u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\uff1a```\nprojectid=PROJECT_IDgcloud config set project ${projectid}\n```\n- \u4f7f\u7528\u6587\u672c\u7de8\u8f2f\u5668\uff08\u4f8b\u5982 `vim` \u6216 `nano` \uff09\u5275\u5efa\u4e00\u500b\u540d\u7232 `request.json` \u7684\u65b0\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4ee5\u4e0b\u6587\u672c\uff1a```\n{\u00a0 \u00a0\"instances\": [\u00a0 \u00a0 \u00a0 { \"prompt\": \"Give me ten interview questions for the role of program manager.\"}\u00a0 \u00a0],\u00a0 \u00a0\"parameters\": {\u00a0 \u00a0 \u00a0 \"temperature\": 0.2,\u00a0 \u00a0 \u00a0 \"maxOutputTokens\": 256,\u00a0 \u00a0 \u00a0 \"topK\": 40,\u00a0 \u00a0 \u00a0 \"topP\": 0.95\u00a0 \u00a0}}\n```\n- \u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5411 PSC \u7aef\u9ede\u767c\u9001\u8acb\u6c42\uff0c\u8a72\u7aef\u9ede\u6703\u5c07\u8acb\u6c42\u8f49\u767c\u5230 GenAI API\u3002\u7aef\u9ede\u6536\u5230\u97ff\u61c9\u5f8c\uff0c\u6703\u5c07\u5176\u8f49\u767c\u56de `on-prem-client` \u865b\u64ec\u6a5f\uff1a```\ncurl -X POST \\\u00a0 \u00a0-H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\u00a0 \u00a0-H \"Content-Type: application/json; charset=utf-8\" \\\u00a0 \u00a0-d @request.json \\\u00a0 \u00a0\"https://us-central1-aiplatform.googleapis.com/v1/projects/$projectid/locations/us-central1/publishers/google/models/text-bison:predict\"\n```\u60a8\u61c9\u8a72\u6703\u770b\u5230\u985e\u4f3c\u65bc\u4ee5\u4e0b\u793a\u4f8b\u7684\u97ff\u61c9\uff1a```\n{\u00a0 \u00a0\"predictions\": [\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"content\": \" 1. **What is your experience in managing programs?**\\n2. **What are your strengths and weaknesses as a program manager?**\\n3. **What is your approach to managing a program?**\\n4. **How do you handle risks and challenges in a program?**\\n5. **How do you communicate with stakeholders in a program?**\\n6. **How do you measure the success of a program?**\\n7. **What is your experience in working with cross-functional teams?**\\n8. **What is your experience in managing budgets and resources?**\\n9. **What is your experience in managing change in a program?**\\n10. **What are your career goals as a program manager?**\",\u00a0 \u00a0 \u00a0 \"citationMetadata\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"citations\": []\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \"safetyAttributes\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"categories\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"Finance\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"Health\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0],\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"blocked\": false,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"scores\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0.6,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0.1\u00a0 \u00a0 \u00a0 \u00a0 \u00a0]\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0],\u00a0 \u00a0\"metadata\": {\u00a0 \u00a0 \u00a0 \"tokenMetadata\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"outputTokenCount\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"totalBillableCharacters\": 505,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"totalTokens\": 153\u00a0 \u00a0 \u00a0 \u00a0 \u00a0},\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"inputTokenCount\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"totalBillableCharacters\": 54,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"totalTokens\": 12\u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0}}\n```\n- \u5728\u7b2c\u4e00\u500b\u6a19\u7c64\u9801\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u4f7f\u7528 PSC \u7aef\u9ede IP \u5730\u5740 ( `192.168.0.1` ) \u5f9e `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\uff08\u5b50\u7db2 `172.16.10.0/28` \uff09\u8a2a\u554f Vertex AI API\u3002\u5f9e Cloud Shell \u7b2c\u4e00\u500b\u6a19\u7c64\u9801\u4e2d\u7684 `tcpdump` \u7d42\u7aef\uff0c\u60a8\u53ef\u4ee5\u770b\u5230\u4e0d\u9700\u8981\u5c0d `us-central1-aiplatform.googleapis.com` \u9032\u884c DNS \u67e5\u627e\uff0c\u56e0\u7232\u5df2\u6dfb\u52a0\u5230 `/etc/hosts` \u6587\u4ef6\u7684\u884c\u512a\u5148\u7d1a\u66f4\u9ad8\uff0c\u4e26\u4e14\u6578\u64da\u8def\u5f91\u4e2d\u4f7f\u7528\u4e86 PSC \u7aef\u9ede\u7684 IP \u5730\u5740 ( `192.168.0.1` )\u3002\u60a8\u61c9\u8a72\u6703\u770b\u5230\u5982\u4e0b\u6240\u793a\u7684 `tcpdump` \u8f38\u51fa\uff1a```\n23:48:49.938797 ens4 \u00a0Out IP 172.16.10.9.38578 > 192.168.0.1.443: Flags [P.], seq 2054:2093, ack 6264, win 501, options [nop,nop,TS val 2943864305 ecr 2340789954], length 3923:48:49.938947 ens4 \u00a0Out IP 172.16.10.9.38578 > 192.168.0.1.443: Flags [P.], seq 2093:2117, ack 6264, win 501, options [nop,nop,TS val 2943864305 ecr 2340789954], length 2423:48:49.939839 ens4 \u00a0Out IP 172.16.10.9.38578 > 192.168.0.1.443: Flags [F.], seq 2117, ack 6264, win 501, options [nop,nop,TS val 2943864306 ecr 2340789954], length 023:48:49.940292 ens4 \u00a0In \u00a0IP 192.168.0.1.443 > 172.16.10.9.38578: Flags [.], ack 2117, win 272, options [nop,nop,TS val 2340789958 ecr 2943864305], length 023:48:49.940437 ens4 \u00a0In \u00a0IP 192.168.0.1.443 > 172.16.10.9.38578: Flags [F.], seq 6264, ack 2117, win 272, options [nop,nop,TS val 2340789958 ecr 2943864305], length 023:48:49.940442 ens4 \u00a0Out IP 172.16.10.9.38578 > 192.168.0.1.443: Flags [.], ack 6265, win 501, options [nop,nop,TS val 2943864307 ecr 2340789958], length 023:48:49.941193 ens4 \u00a0In \u00a0IP 192.168.0.1.443 > 172.16.10.9.38578: Flags [.], ack 2118, win 272, options [nop,nop,TS val 2340789959 ecr 2943864306], length 0\n```## \u6e05\u7406\u7232\u907f\u514d\u56e0\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u8cc7\u6e90\u5c0e\u81f4\u60a8\u7684 Google Cloud \u8cec\u865f\u7522\u751f\u8cbb\u7528\uff0c\u8acb [\u522a\u9664\u5305\u542b\u9019\u4e9b\u8cc7\u6e90\u7684\u9805\u76ee](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#shutting_down_projects) \uff0c\u6216\u8005\u4fdd\u7559\u9805\u76ee\u4f46\u522a\u9664\u5404\u500b\u8cc7\u6e90\u3002\n\u60a8\u53ef\u4ee5\u5728 Cloud Shell \u4e2d\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u522a\u9664\u9805\u76ee\u4e2d\u7684\u5404\u500b\u8cc7\u6e90\uff1a\n```\n\u00a0 \u00a0projectid=PROJECT_ID\u00a0 \u00a0gcloud config set project ${projectid}\n```\n```\n\u00a0 \u00a0gcloud compute firewall-rules delete ssh-iap-on-prem-vpc --quiet\n```\n```\n\u00a0 \u00a0gcloud compute instances delete on-prem-client --zone=us-central1-a --quiet\n```\n```\n\u00a0 \u00a0gcloud iam service-accounts delete user-managed-sa@$projectid.iam.gserviceaccount.com --quiet\n```\n```\n\u00a0 \u00a0gcloud compute forwarding-rules delete pscvertex --global --quiet\n```\n```\n\u00a0 \u00a0gcloud compute addresses delete psc-googleapi-ip --global --quiet\n```\n```\n\u00a0 \u00a0gcloud compute vpn-tunnels delete vertex-networking-vpc-tunnel0 vertex-networking-vpc-tunnel1 onprem-vpc-tunnel0 onprem-vpc-tunnel1 --region=us-central1 --quiet\n```\n```\n\u00a0 \u00a0gcloud compute routers nats delete us-central-cloudnat-onprem --router=onprem-vpc-router1 --region=us-central1 --quiet\n```\n```\n\u00a0 \u00a0gcloud compute routers delete vertex-networking-vpc-router1 onprem-vpc-router1 --region=us-central1 --quiet\n```\n```\n\u00a0 \u00a0gcloud compute vpn-gateways delete vertex-networking-vpn-gw1 onprem-vpn-gw1 --region=us-central1 --quiet\n```\n```\n\u00a0 \u00a0gcloud compute networks subnets delete onprem-vpc-subnet1 --region=us-central1 --quiet\n```\n```\n\u00a0 \u00a0gcloud compute networks delete onprem-vpc --quiet\n```\n```\n\u00a0 \u00a0gcloud compute networks delete vertex-networking-vpc --quiet\n```## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3 [\u7528\u65bc\u8a2a\u554f Vertex AI \u7aef\u9ede\u548c\u670d\u52d9\u7684\u4f01\u696d\u7db2\u7d61\u9078\u9805](https://cloud.google.com/vertex-ai/docs/general/netsec-overview?hl=zh-cn) \n- \u77ad\u89e3\u5982\u4f55 [\u901a\u904e\u7aef\u9ede\u8a2a\u554f\u5df2\u767c\u4f48\u7684\u670d\u52d9](https://cloud.google.com/vpc/docs/configure-private-service-connect-services?hl=zh-cn) \u3002\n- \u77ad\u89e3 [Private Service Connect \u7684\u5de5\u4f5c\u539f\u7406](https://cloud.google.com/vpc/docs/private-service-connect-architecture?hl=zh-cn) \u53ca\u5176\u63d0\u4f9b\u986f\u8457\u6027\u80fd\u512a\u52e2\u7684\u539f\u56e0\u3002\n- \u8a73\u7d30\u77ad\u89e3\u5982\u4f55 [\u901a\u904e\u7aef\u9ede\u8a2a\u554f Google API](https://cloud.google.com/vpc/docs/about-accessing-google-apis-endpoints?hl=zh-cn) \u3002\n- \u77ad\u89e3\u5982\u4f55\u4ee5\u53ca\u7232\u4f55\u5728\u5927\u578b\u548c [\u751f\u7522\u74b0\u5883](https://codelabs.developers.google.com/codelabs/vertex-psc-googleapis?hl=zh-cn#17) \u4e2d [\u4f7f\u7528 DNS \u8f49\u767c\u5340\u57df](https://cloud.google.com/dns/docs/zones/zones-overview?hl=zh-cn#forwarding_zones) \u800c\u4e0d\u662f\u66f4\u65b0`/etc/hosts`\u6587\u4ef6\u3002\n- \u8a73\u7d30\u77ad\u89e3 [\u81ea\u5b9a\u7fa9\u8def\u7531\u901a\u544a](https://cloud.google.com/network-connectivity/docs/router/concepts/overview?hl=zh-cn#route-advertisement) \u3002", "guide": "Vertex AI"}