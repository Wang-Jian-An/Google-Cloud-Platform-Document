{"title": "Vertex AI - Vector Search \u5feb\u901f\u5165\u9580", "url": "https://cloud.google.com/vertex-ai/docs/vector-search/quickstart?hl=zh-cn", "abstract": "# Vertex AI - Vector Search \u5feb\u901f\u5165\u9580\n\u5728 Vertex AI Vector Search \u5feb\u901f\u5165\u9580\u4e2d\uff0c\u77ad\u89e3\u5982\u4f55\u6839\u64da\u865b\u69cb\u96fb\u5b50\u5546\u52d9\u670d\u88dd\u7db2\u7ad9\u7684\u793a\u4f8b\u6578\u64da\u96c6\u5275\u5efa\u7d22\u5f15\u3002\u5728\u672c\u5feb\u901f\u5165\u9580\u4e2d\uff0c\u5df2\u7d93\u5275\u5efa\u4e86\u5d4c\u5165\u3002\u672c\u5feb\u901f\u5165\u9580\u65e8\u5728\u5e6b\u52a9\u60a8\u5728 30 \u5206\u9418\u5167\u958b\u59cb\u5275\u5efa\u548c\u90e8\u7f72\u7d22\u5f15\u3002\n", "content": "## \u524d\u63d0\u689d\u4ef6\n\u672c\u6559\u7a0b\u9700\u8981\u8207\u7d50\u7b97\u8cec\u865f\u95dc\u806f\u7684 Google Cloud \u9805\u76ee\u3002\u5982\u9700\u5275\u5efa\u65b0\u9805\u76ee\uff0c\u8acb\u53c3\u95b1 [\u8a2d\u7f6e\u9805\u76ee\u548c\u958b\u767c\u74b0\u5883](https://cloud.google.com/vertex-ai/docs/start/cloud-environment?hl=zh-cn) \u3002\u60a8\u9700\u8981\u5275\u5efa\u9805\u76ee\u4e26\u8a2d\u7f6e\u7d50\u7b97\u8cec\u865f\u3002\n### \u9078\u64c7\u904b\u884c\u6642\u74b0\u5883\n\u672c\u6559\u7a0b\u53ef\u4ee5\u5728 Colab \u6216 Vertex AI Workbench \u4e0a\u904b\u884c\u3002\n- **Colab** \uff1a\u5728 [Colab](https://colab.research.google.com/github/GoogleCloudPlatform/generative-ai/blob/main/embeddings/vector-search-quickstart.ipynb?hl=zh-cn) \u4e2d\u6253\u958b\u672c\u6559\u7a0b\n- **Vertex AI Workbench** \uff1a\u5728 [Vertex AI Workbench](https://console.cloud.google.com/vertex-ai/workbench/deploy-notebook?download_url=https%3A%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fembeddings%2Fvector-search-quickstart.ipynb&hl=zh-cn) \u4e2d\u6253\u958b\u672c\u6559\u7a0b\u3002\u5982\u679c\u9019\u662f\u60a8\u7b2c\u4e00\u6b21\u5728 Google Cloud \u9805\u76ee\u4e2d\u4f7f\u7528 Vertex AI Workbench\uff0c\u8acb\u8f49\u5230 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI Workbench \u90e8\u5206\uff0c\u7136\u5f8c\u9ede\u64ca **\u5553\u7528** \u4ee5\u5553\u7528 Notebooks API\u3002\n\u5982\u8981\u5728 GitHub \u4e2d\u67e5\u770b\u6b64\u7b46\u8a18\u672c\uff0c\u8acb\u53c3\u95b1 [GitHub](https://github.com/GoogleCloudPlatform/generative-ai/blob/main/embeddings/vector-search-quickstart.ipynb) \u3002\n### \u5b8c\u6210\u672c\u5feb\u901f\u5165\u9580\u7684\u8cbb\u7528\n\u5b8c\u6210\u672c\u6559\u7a0b\u5927\u7d04\u82b1\u8cbb\u5e7e\u7f8e\u5143\u3002\u4ee5\u4e0b\u9801\u9762\u63d0\u4f9b\u4e86\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684 Google Cloud \u670d\u52d9\u7684\u50f9\u683c\uff1a\n- [Vertex AI Vector Search](https://cloud.google.com/vertex-ai/pricing?hl=zh-cn#matchingengine) \n- [Cloud Storage](https://cloud.google.com/storage/pricing?hl=zh-cn) \n- [Vertex AI Workbench](https://cloud.google.com/vertex-ai/pricing?hl=zh-cn#notebooks) \n\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 [\u50f9\u683c\u8a08\u7b97\u5668](https://cloud.google.com/vertex-ai/pricing?hl=zh-cn#generative_ai_models) \u6839\u64da\u9810\u8a08\u4f7f\u7528\u91cf\u8a08\u7b97\u4f30\u7b97\u8cbb\u7528\u3002\n**\u91cd\u8981\u63d0\u793a** \uff1a\u5b8c\u6210\u672c\u6559\u7a0b\u5f8c\uff0c\u8acb\u522a\u9664\u60a8\u7684\u5c0d\u8c61\u3002\u5982\u679c\u60a8\u5728\u5b8c\u6210\u672c\u6559\u7a0b\u5f8c\u4f7f\u7528\u7d22\u5f15\u3001\u7d22\u5f15\u7aef\u9ede\u3001Cloud Storage \u5b58\u5132\u6876\u548c Vertex AI Workbench \u5be6\u4f8b\uff0c\u8acb\u78ba\u4fdd\u522a\u9664\u6240\u6709\u7d22\u5f15\u3001\u7d22\u5f15\u7aef\u9ede\u3001Cloud Storage \u5b58\u5132\u6876\u548c Vertex AI Workbench \u5be6\u4f8b\u3002\u5982\u679c\u4e0d\u522a\u9664\u9019\u4e9b\u5c0d\u8c61\uff0c\u5247\u9019\u4e9b\u5269\u9918\u7684\u8cc7\u7522\u53ef\u80fd\u6703\u7522\u751f\u610f\u5916\u8cbb\u7528\u3002\n## \u8a2d\u7f6e\n\u5728\u958b\u59cb\u4f7f\u7528 Vertex AI \u4e4b\u524d\uff0c\u60a8\u9700\u8981\u8a2d\u7f6e\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- [\u5b89\u88dd Python \u7248 Vertex AI SDK](#install-sdk) \n- [\u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf](#variables) \n- [\u8eab\u4efd\u9a57\u8b49\uff08\u50c5\u9650 Colab\uff09](#authentication) \n- [\u8a2d\u7f6e IAM \u6b0a\u9650](#permissions) \n- [\u5553\u7528 API](#enable-apis) \n### \u5b89\u88dd Python \u7248 Vertex AI SDK\n\u60a8\u53ef\u4ee5\u901a\u904e\u591a\u7a2e\u65b9\u5f0f\u8a2a\u554f Vertex AI \u548c Cloud Storage API\uff0c\u5305\u62ec REST API \u548c Python \u7248 Vertex AI SDK\u3002\u672c\u6559\u7a0b\u4f7f\u7528 Python \u7248 Vertex AI SDK\u3002\n```\n!pip install --upgrade --user google-cloud-aiplatform>=1.29.0 google-cloud-storage\n```\n\u5982\u9700\u5728\u6b64 Jupyter \u904b\u884c\u6642\u4e2d\u4f7f\u7528\u65b0\u5b89\u88dd\u7684\u8edf\u4ef6\u5305\uff0c\u60a8\u9700\u8981\u91cd\u5553\u904b\u884c\u6642\uff0c\u5982\u4ee5\u4e0b\u4ee3\u78bc\u6bb5\u6240\u793a\u3002\n```\n# Restart kernel after installs so that your environment can access the new packagesimport IPythonapp = IPython.Application.instance()app.kernel.do_shutdown(True)\n```\n### \u74b0\u5883\u8b8a\u91cf\n\u8a2d\u7f6e\u74b0\u5883\u8b8a\u91cf\u3002\u5982\u679c\u7cfb\u7d71\u63d0\u793a\uff0c\u8acb\u5c07 `your-project-id` \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID \u4e26\u904b\u884c\u8a72\u55ae\u5143\u3002\n```\n# get project IDPROJECT_ID = ! gcloud config get-value projectPROJECT_ID = PROJECT_ID[0]LOCATION = \"us-central1\"if PROJECT_ID == \"(unset)\":\u00a0 \u00a0 print(f\"Please set the project ID manually below\")\n```\n```\n# define project informationif PROJECT_ID == \"(unset)\":\u00a0 PROJECT_ID = \"[your-project-id]\"# generate a unique id for this sessionfrom datetime import datetimeUID = datetime.now().strftime(\"%m%d%H%M\")\n```\n\u5982\u679c\u60a8\u5728 Colab \u4e0a\u904b\u884c\u6b64\u7b46\u8a18\u672c\uff0c\u5247\u9700\u8981\u904b\u884c\u4ee5\u4e0b\u55ae\u5143\u8eab\u4efd\u9a57\u8b49\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Vertex AI Workbench\uff0c\u5247\u7121\u9700\u57f7\u884c\u6b64\u6b65\u9a5f\uff0c\u56e0\u7232\u5b83\u5df2\u9810\u5148\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002\n```\nimport sys# if it's Colab runtime, authenticate the user with Google Cloudif 'google.colab' in sys.modules:\u00a0 \u00a0 from google.colab import auth\u00a0 \u00a0 auth.authenticate_user()\n```\n### \u8a2d\u7f6e IAM \u6b0a\u9650\n\u60a8\u9700\u8981\u5411\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u6dfb\u52a0\u8a2a\u554f\u6b0a\u9650\uff0c\u624d\u80fd\u4f7f\u7528\u9019\u4e9b\u670d\u52d9\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 IAM \u9801\u9762\u3002\n- \u67e5\u627e\u9ed8\u8a8d\u8a08\u7b97\u670d\u52d9\u8cec\u865f\u7684\u4e3b\u8cec\u865f\u3002\u4ee3\u78bc\u61c9\u5982\u4e0b\u6240\u793a\uff1a``\n- \u9ede\u64ca\u4fee\u6539\u6309\u9215\uff0c\u4f75\u7232\u9ed8\u8a8d\u8a08\u7b97\u670d\u52d9\u8cec\u865f\u6388\u4e88\u4ee5\u4e0b\u89d2\u8272\uff1aVertex AI User\u3001Storage Admin \u548c Service Usage Admin\u3002\n### \u5553\u7528 API\n\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u7232\u6b64 Google Cloud \u9805\u76ee\u5553\u7528\u9069\u7528\u65bc Compute Engine\u3001Vertex AI \u548c Cloud Storage \u7684 API\u3002\n```\n! gcloud services enable compute.googleapis.com aiplatform.googleapis.com storage.googleapis.com --project {PROJECT_ID}\n```\n## \u6e96\u5099\u793a\u4f8b\u6578\u64da\n\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u5011\u4f7f\u7528 [TheLook \u6578\u64da\u96c6](https://console.cloud.google.com/marketplace/product/bigquery-public-data/thelook-ecommerce?hl=zh-cn) \uff0c\u8a72\u6578\u64da\u96c6\u5177\u6709\u4e00\u500b\u7522\u54c1\u8868\uff0c\u5176\u4e2d\u5305\u542b\u865b\u69cb\u96fb\u5b50\u5546\u52d9\u670d\u88dd\u7db2\u7ad9\u7684\u5927\u7d04 30,000 \u884c\u5408\u6210\u7522\u54c1\u6578\u64da\u3002\n\u6211\u5011\u5728\u6b64\u8868\u4e2d\u6e96\u5099\u4e86 `product-embs.json` \u6587\u4ef6\u3002\n\u6b64\u6587\u4ef6\u63a1\u7528 JSONL \u683c\u5f0f\uff0c\u6bcf\u884c\u90fd\u6709 ID\uff08\u7522\u54c1 ID\uff09\u3001\u540d\u7a31\uff08\u7522\u54c1\u540d\u7a31\uff09\u4ee5\u53ca\u5d4c\u5165\uff08\u4e4b\u524d\u4f7f\u7528 Vertex AI \u6587\u672c\u5d4c\u5165\u751f\u6210\u7684 768 \u500b\u7dad\u5ea6\u4e2d\u7684\u7522\u54c1\u540d\u7a31\u5d4c\u5165\uff09\u3002\n\u6587\u672c\u5d4c\u5165\u4ee3\u8868\u670d\u98fe\u5546\u54c1\u540d\u7a31\u7684\u542b\u7fa9\u3002\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u5011\u4f7f\u7528 Vector Search \u4f86\u5b8c\u6210\u9805\u7684\u8a9e\u7fa9\u641c\u7d22\u3002\u6b64\u793a\u4f8b\u4ee3\u78bc\u53ef\u7528\u4f5c\u5176\u4ed6\u5feb\u901f\u63a8\u85a6\u7cfb\u7d71\u7684\u57fa\u790e\uff0c\u60a8\u53ef\u4ee5\u5728\u5176\u4e2d\u5feb\u901f\u627e\u5230\u201c\u8207\u6b64\u7522\u54c1\u985e\u4f3c\u7684\u5176\u4ed6\u7522\u54c1\u201d\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u6839\u64da BigQuery \u8868\u4e2d\u7684\u6578\u64da\u5275\u5efa\u5d4c\u5165\uff0c\u4e26\u5c07\u5176\u5b58\u5132\u5728 JSON \u6587\u4ef6\u4e2d\uff0c\u8acb\u53c3\u95b1 [\u6587\u672c\u5d4c\u5165 + Vertex AI Vector Search \u4f7f\u7528\u5165\u9580](https://github.com/GoogleCloudPlatform/generative-ai/blob/main/embeddings/intro-textemb-vectorsearch.ipynb) \u3002\n### \u5728 Cloud Storage \u4e0a\u6e96\u5099\u6578\u64da\n\u5982\u9700\u4f7f\u7528 Vertex AI \u69cb\u5efa\u7d22\u5f15\uff0c\u8acb\u5c07\u5d4c\u5165\u6587\u4ef6\u653e\u5728 Cloud Storage \u5b58\u5132\u6876\u4e2d\u3002\u4ee5\u4e0b\u4ee3\u78bc\u5b8c\u6210\u5169\u500b\u4efb\u52d9\uff1a\n- \u5275\u5efa Cloud Storage \u5b58\u5132\u6876\u3002\n- \u5c07\u793a\u4f8b\u6587\u4ef6\u8907\u88fd\u5230 Cloud Storage \u5b58\u5132\u6876\u3002\n```\nBUCKET_URI = f\"gs://{PROJECT_ID}-vs-quickstart-{UID}\"\n```\n```\n! gsutil mb -l $LOCATION -p $PROJECT_ID $BUCKET_URI! gsutil cp \"gs://github-repo/data/vs-quickstart/product-embs.json\" $BUCKET_URI\n```\n\u5982\u9700\u4f7f\u7528 Vector Search \u904b\u884c\u67e5\u8a62\uff0c\u60a8\u9084\u9700\u8981\u5c07\u5d4c\u5165\u6587\u4ef6\u8907\u88fd\u5230\u672c\u5730\u76ee\u9304\uff1a\n```\n! gsutil cp \"gs://github-repo/data/vs-quickstart/product-embs.json\" . # for query tests\n```\n## \u69cb\u5efa\u548c\u90e8\u7f72 Vector Search \u7d22\u5f15\n\u77ad\u89e3\u5982\u4f55\u5275\u5efa\u7d22\u5f15\uff0c\u5275\u5efa\u7d22\u5f15\u7aef\u9ede\uff0c\u7136\u5f8c\u5c07\u7d22\u5f15\u90e8\u7f72\u5230\u8a72\u7aef\u9ede\u3002\n### \u5275\u5efa\u7d22\u5f15\n\u73fe\u5728\u53ef\u4ee5\u5c07\u5d4c\u5165\u52a0\u8f09\u5230 Vector Search \u4e2d\u3002API \u53ef\u5728 SDK \u7684 `aiplatform` \u8edf\u4ef6\u5305\u4e0b\u7372\u5f97\u3002\n```\n# init the aiplatform packagefrom google.cloud import aiplatformaiplatform.init(project=PROJECT_ID, location=LOCATION)\n```\n\u4f7f\u7528 `create_tree_ah_index` \u51fd\u6578\u5275\u5efa [MatchingEngineIndex](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.MatchingEngineIndex?hl=zh-cn) \uff08Matching Engine \u662f Vector Search \u7684\u820a\u540d\u7a31\uff09\u3002\n```\n# create Indexmy_index = aiplatform.MatchingEngineIndex.create_tree_ah_index(\u00a0 \u00a0 display_name = f\"vs-quickstart-index-{UID}\",\u00a0 \u00a0 contents_delta_uri = BUCKET_URI,\u00a0 \u00a0 dimensions = 768,\u00a0 \u00a0 approximate_neighbors_count = 10,)\n```\n`MatchingEngineIndex.create_tree_ah_index()` \u65b9\u6cd5\u6703\u69cb\u5efa\u7d22\u5f15\u3002\u5982\u679c\u6578\u64da\u96c6\u5f88\u5c0f\uff0c\u5247\u6b64\u904e\u7a0b\u9700\u8981\u4e0d\u5230 10 \u5206\u9418\uff1b\u5426\u5247\u9700\u8981\u7d04 60 \u5206\u9418\u6216\u66f4\u9577\u6642\u9593\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u6578\u64da\u96c6\u7684\u5927\u5c0f\u3002\u60a8\u53ef\u4ee5\u5728 Vector Search Google Cloud \u63a7\u5236\u6aaf\u4e2d\u6aa2\u67e5\u7d22\u5f15\u5275\u5efa\u72c0\u614b\n[\u8acb\u53c3\u95b1\u201c\u7d22\u5f15\u201d](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn)\n\u7528\u65bc\u5275\u5efa\u7d22\u5f15\u7684\u53c3\u6578\uff1a\n- `contents_delta_uri`\uff1a\u5b58\u5132\u5d4c\u5165 JSON \u6587\u4ef6\u7684 Cloud Storage \u76ee\u9304\u7684 URI\n- `dimensions`\uff1a\u6bcf\u500b\u5d4c\u5165\u7684\u7dad\u5ea6\u5927\u5c0f\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u8a72\u503c\u7232 768\uff0c\u56e0\u7232\u60a8\u4f7f\u7528\u7684\u662f\u6587\u672c\u5d4c\u5165 API \u4e2d\u7684\u5d4c\u5165\u3002\n- `approximate_neighbors_count`\uff1a\u60a8\u8981\u5728\u5178\u578b\u60c5\u6cc1\u4e0b\u6aa2\u7d22\u7684\u985e\u4f3c\u9805\u6578\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5275\u5efa\u7d22\u5f15\u548c\u53ef\u7528\u53c3\u6578\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u548c\u7ba1\u7406\u7d22\u5f15](https://cloud.google.com/vertex-ai/docs/vector-search/create-manage-index?hl=zh-cn)\n### \u5275\u5efa\u7d22\u5f15\u7aef\u9ede\u4e26\u90e8\u7f72\u7d22\u5f15\n\u5982\u8981\u4f7f\u7528\u7d22\u5f15\uff0c\u60a8\u9700\u8981\u5275\u5efa\u4e00\u500b\u7d22\u5f15\u7aef\u9ede\u3002\u5b83\u5145\u7576\u63a5\u53d7\u7d22\u5f15\u7684\u67e5\u8a62\u8acb\u6c42\u7684\u670d\u52d9\u5668\u5be6\u4f8b\u3002\n```\n## create `IndexEndpoint`my_index_endpoint = aiplatform.MatchingEngineIndexEndpoint.create(\u00a0 \u00a0 display_name = f\"vs-quickstart-index-endpoint-{UID}\",\u00a0 \u00a0 public_endpoint_enabled = True)\n```\n\u4f7f\u7528\u7d22\u5f15\u7aef\u9ede\uff0c\u901a\u904e\u6307\u5b9a\u552f\u4e00\u7684\u5df2\u90e8\u7f72\u7d22\u5f15 ID \u4f86\u90e8\u7f72\u7d22\u5f15\u3002\n```\nDEPLOYED_INDEX_ID = f\"vs_quickstart_deployed_{UID}\"\n```\n```\n# deploy the Index to the Index Endpointmy_index_endpoint.deploy_index(\u00a0 \u00a0 index = my_index, deployed_index_id = DEPLOYED_INDEX_ID)\n```\n\u5982\u679c\u9019\u662f\u60a8\u7b2c\u4e00\u6b21\u5c07\u6b64\u7d22\u5f15\u90e8\u7f72\u5230\u7d22\u5f15\u7aef\u9ede\uff0c\u5247\u5927\u7d04\u9700\u8981 30 \u5206\u9418\u624d\u80fd\u81ea\u52d5\u69cb\u5efa\u4e26\u5553\u52d5\u5f8c\u7aef\u3002\u5982\u9700\u67e5\u770b\u7d22\u5f15\u90e8\u7f72\u7684\u72c0\u614b\uff0c\u8acb\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\u8f49\u5230 **\u90e8\u7f72\u548c\u4f7f\u7528** \u90e8\u5206\u3002\u9078\u64c7 **\u7d22\u5f15**\n[\u8acb\u53c3\u95b1\u201c\u7d22\u5f15\u201d](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn)\n## \u4f7f\u7528 Vector Search \u904b\u884c\u67e5\u8a62\n\u5728\u4ee5\u4e0b\u4ee3\u78bc\u4e2d\uff0c\u5b83\u6703\u67e5\u627e\u6307\u5b9a\u7522\u54c1\u540d\u7a31\u7684\u5d4c\u5165\uff0c\u4e26\u4f7f\u7528 Vector Search \u67e5\u627e\u985e\u4f3c\u7684\u7522\u54c1\u540d\u7a31\u3002\n### \u7372\u53d6\u5d4c\u5165\u4ee5\u904b\u884c\u67e5\u8a62\n\u9996\u5148\uff0c\u52a0\u8f09\u5d4c\u5165 JSON \u6587\u4ef6\uff0c\u4ee5\u69cb\u5efa\u7522\u54c1\u540d\u7a31\u548c\u5d4c\u5165\u7684 `dict` \u3002\n```\nimport json# build dicts for product names and embsproduct_names = {}product_embs = {}with open('product-embs.json') as f:\u00a0 \u00a0 for l in f.readlines():\u00a0 \u00a0 \u00a0 \u00a0 p = json.loads(l)\u00a0 \u00a0 \u00a0 \u00a0 id = p['id']\u00a0 \u00a0 \u00a0 \u00a0 product_names[id] = p['name']\u00a0 \u00a0 \u00a0 \u00a0 product_embs[id] = p['embedding']\n```\n\u4f7f\u7528 `product_embs` \u5b57\u5178\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u7522\u54c1 ID \u4ee5\u7372\u53d6\u5176\u5d4c\u5165\u3002\n```\n\u00a0# Get the embedding for ID 6523 \"cloudveil women's excursion short\"\u00a0you can also try with other IDs such as 12711, 18090, 19536 and 11863query_emb = product_embs['6523']\n```\n### \u904b\u884c\u67e5\u8a62\n\u5c07\u5d4c\u5165\u50b3\u905e\u7d66 `Endpoint.find_neighbors()` \u65b9\u6cd5\u4ee5\u67e5\u627e\u985e\u4f3c\u7684\u7522\u54c1\u540d\u7a31\u3002\n```\n# run queryresponse = my_index_endpoint.find_neighbors(\u00a0 \u00a0 deployed_index_id = DEPLOYED_INDEX_ID,\u00a0 \u00a0 queries = [query_emb],\u00a0 \u00a0 num_neighbors = 10)# show the resultsfor idx, neighbor in enumerate(response[0]):\u00a0 \u00a0 print(f\"{neighbor.distance:.2f} {product_names[neighbor.id]}\")\n```\n\u85c9\u52a9 [ScaNN \u7b97\u6cd5](https://blog.research.google/2020/07/announcing-scann-efficient-vector.html?hl=zh-cn) \uff0c\u5373\u4f7f\u60a8\u5728\u7d22\u5f15\u4e0a\u6709\u6578\u5341\u5104\u9805\uff0c `find_neighbors()` \u65b9\u6cd5\u4e5f\u53ea\u9700\u5e7e\u6beb\u79d2\u5373\u53ef\u63d0\u53d6\u985e\u4f3c\u9805\u3002Vector Search \u9084\u652f\u6301\u81ea\u52d5\u64f4\u7e2e\uff0c\u8a72\u529f\u80fd\u53ef\u4ee5\u6839\u64da\u5de5\u4f5c\u8ca0\u8f09\u7684\u9700\u6c42\u81ea\u52d5\u8abf\u6574\u7bc0\u9ede\u6578\u91cf\u3002\n## \u6e05\u7406\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u81ea\u5df1\u7684 Cloud \u9805\u76ee\uff0c\u800c\u4e0d\u662f Qwiklabs \u4e0a\u7684\u81e8\u6642\u9805\u76ee\uff0c\u8acb\u52d9\u5fc5\u5728\u5b8c\u6210\u672c\u6559\u7a0b\u5f8c\u522a\u9664\u6240\u6709\u7d22\u5f15\u3001\u7d22\u5f15\u7aef\u9ede\u548c Cloud Storage \u5b58\u5132\u6876\u3002\u5426\u5247\uff0c\u5269\u9918\u8cc7\u6e90\u53ef\u80fd\u6703\u7522\u751f\u610f\u5916\u8cbb\u7528\u3002\n\u5982\u679c\u60a8\u4f7f\u7528\u4e86 Workbench\uff0c\u5247\u53ef\u80fd\u9084\u9700\u8981\u5f9e\u63a7\u5236\u6aaf\u4e2d\u522a\u9664\u7b46\u8a18\u672c\u3002\n```\n# wait for a confirmationinput(\"Press Enter to delete Index Endpoint, Index and Cloud Storage bucket:\")# delete Index Endpointmy_index_endpoint.undeploy_all()my_index_endpoint.delete(force = True)# delete Indexmy_index.delete()# delete Cloud Storage bucket! gsutil rm -r {BUCKET_URI}\n```\n## \u5be6\u7528\u7a0b\u5e8f\n\u5275\u5efa\u6216\u90e8\u7f72\u7d22\u5f15\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u6642\u9593\uff0c\u5c46\u6642\u60a8\u53ef\u80fd\u6703\u4e2d\u65b7\u8207 Colab \u904b\u884c\u6642\u7684\u9023\u63a5\u3002\u5982\u679c\u9023\u63a5\u4e2d\u65b7\uff0c\u60a8\u53ef\u4ee5\u6aa2\u67e5 Vector Search Google Cloud \u63a7\u5236\u6aaf\uff0c\u4e26\u4f7f\u7528\u73fe\u6709\u7d22\u5f15\u7e7c\u7e8c\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u518d\u6b21\u5275\u5efa\u6216\u90e8\u7f72\u65b0\u7d22\u5f15\u3002\n### \u7372\u53d6\u73fe\u6709\u7d22\u5f15\n\u5982\u9700\u7372\u53d6\u5df2\u5b58\u5728\u7684\u7d22\u5f15\u5c0d\u8c61\uff0c\u8acb\u5c07\u4ee5\u4e0b `your-index-id` \u66ff\u63db\u7232\u7d22\u5f15 ID \u4e26\u904b\u884c\u8a72\u55ae\u5143\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u6aa2\u67e5 Vector Search Google Cloud \u63a7\u5236\u6aaf\u4f86\u7372\u53d6\u7d22\u5f15 ID\u3002\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80 **\u90e8\u7f72\u548c\u4f7f\u7528** \u90e8\u5206\u3002\u9078\u64c7 **\u7d22\u5f15**\n[\u8acb\u53c3\u95b1\u201c\u7d22\u5f15\u201d](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn)\n```\nmy_index_id = \"[your-index-id]\"my_index = aiplatform.MatchingEngineIndex(my_index_id)\n```\n### \u7372\u53d6\u73fe\u6709\u7d22\u5f15\u7aef\u9ede\n\u5982\u9700\u7372\u53d6\u5df2\u5b58\u5728\u7684\u7d22\u5f15\u7aef\u9ede\u5c0d\u8c61\uff0c\u8acb\u5c07\u4ee5\u4e0b `your-index-endpoint-id` \u66ff\u63db\u7232\u7d22\u5f15\u7aef\u9ede ID \u4e26\u904b\u884c\u8a72\u55ae\u5143\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u6aa2\u67e5 Vector Search Google Cloud \u63a7\u5236\u6aaf\u4f86\u7372\u53d6\u7d22\u5f15\u7aef\u9ede\u3002\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80 **\u90e8\u7f72\u548c\u4f7f\u7528** \u90e8\u5206\u3002\u9078\u64c7 **\u5c07\u7aef\u9ede\u7de8\u5165\u7d22\u5f15**\n[\u8acb\u53c3\u95b1\u201c\u7d22\u5f15\u7aef\u9ede\u201d](https://console.cloud.google.com/vertex-ai/matching-engine/index-endpoints?hl=zh-cn)\n```\nmy_index_endpoint_id = \"[your-index-endpoint-id]\"my_index_endpoint = aiplatform.MatchingEngineIndexEndpoint(my_index_endpoint_id)\n```", "guide": "Vertex AI"}