{"title": "Vertex AI - \u7372\u53d6\u9810\u6e2c\u6a21\u578b\u7684\u6279\u91cf\u9810\u6e2c\u7d50\u679c", "url": "https://cloud.google.com/vertex-ai/docs/tabular-data/tabular-workflows/forecasting-batch-predictions?hl=zh-cn", "abstract": "# Vertex AI - \u7372\u53d6\u9810\u6e2c\u6a21\u578b\u7684\u6279\u91cf\u9810\u6e2c\u7d50\u679c\nVertex AI \u63d0\u4f9b\u5728\u7dda\u9810\u6e2c\u548c\u6279\u91cf\u9810\u6e2c\u9019\u5169\u500b\u9078\u9805\uff0c\u7528\u4f86\u901a\u904e\u7d93\u904e\u8a13\u7df4\u7684\u9810\u6e2c\u6a21\u578b\u4f86\u9810\u6e2c\u672a\u4f86\u7684\u503c\u3002\n\u5728\u7dda\u9810\u6e2c\u662f\u540c\u6b65\u8acb\u6c42\u3002\u5982\u679c\u60a8\u8981\u767c\u51fa\u8acb\u6c42\u4ee5\u97ff\u61c9\u61c9\u7528\u8f38\u5165\uff0c\u6216\u8005\u5728\u5176\u4ed6\u9700\u8981\u53ca\u6642\u63a8\u7406\u7684\u60c5\u6cc1\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5728\u7dda\u9810\u6e2c\u3002\n\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\u662f\u7570\u6b65\u8acb\u6c42\u3002\u5982\u679c\u60a8\u4e0d\u9700\u8981\u7acb\u5373\u97ff\u61c9\u4e26\u4e14\u5e0c\u671b\u4f7f\u7528\u55ae\u500b\u8acb\u6c42\u8655\u7406\u7d2f\u7a4d\u7684\u6578\u64da\uff0c\u5c31\u53ef\u4f7f\u7528\u6279\u91cf\u9810\u6e2c\u3002\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528\u6279\u91cf\u9810\u6e2c\u4f86\u9810\u6e2c\u672a\u4f86\u7684\u503c\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u4f7f\u7528\u5728\u7dda\u9810\u6e2c\u4f86\u9810\u6e2c\u503c\uff0c\u8acb\u53c3\u95b1 [\u7372\u53d6\u9810\u6e2c\u6a21\u578b\u7684\u5728\u7dda\u9810\u6e2c\u7d50\u679c](https://cloud.google.com/vertex-ai/docs/tabular-data/tabular-workflows/forecasting-online-predictions?hl=zh-cn) \u3002\n\u60a8\u53ef\u4ee5\u76f4\u63a5\u5f9e\u6a21\u578b\u8cc7\u6e90\u8acb\u6c42\u6279\u91cf\u9810\u6e2c\u3002\n\u60a8\u53ef\u4ee5\u8acb\u6c42\u5e36\u6709\u8aaa\u660e\uff08\u4e5f\u7a31\u7232\u7279\u5fb5\u6b78\u56e0\uff09\u7684\u9810\u6e2c\uff0c\u4ee5\u77ad\u89e3\u6a21\u578b\u5982\u4f55\u5f97\u51fa\u9810\u6e2c\u7d50\u679c\u3002\u5c40\u90e8\u7279\u5fb5\u91cd\u8981\u6027\u503c\u53ef\u4ee5\u8868\u793a\u6bcf\u500b\u7279\u5fb5\u5c0d\u9810\u6e2c\u7d50\u679c\u7684\u5f71\u97ff\u7a0b\u5ea6\u3002\u5982\u9700\u67e5\u770b\u6982\u5ff5\u6027\u6982\u89bd\uff0c\u8acb\u53c3\u95b1 [\u7528\u65bc\u9810\u6e2c\u7684\u7279\u5fb5\u6b78\u56e0](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-explanations?hl=zh-cn) \u3002\n\u5982\u9700\u77ad\u89e3\u6279\u91cf\u9810\u6e2c\u7684\u50f9\u683c\uff0c\u8acb\u53c3\u95b1 [\u8868\u683c\u5de5\u4f5c\u6d41\u7684\u50f9\u683c](https://cloud.google.com/vertex-ai/docs/tabular-data/tabular-workflows/pricing?hl=zh-cn) \u3002\n", "content": "## \u6e96\u5099\u5de5\u4f5c\n\u60a8\u5fc5\u9808\u5148 [\u8a13\u7df4](https://cloud.google.com/vertex-ai/docs/tabular-data/tabular-workflows/forecasting-train?hl=zh-cn) \u6a21\u578b\uff0c\u7136\u5f8c\u624d\u80fd\u767c\u51fa\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\u3002\n## \u8f38\u5165\u6578\u64da\n\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\u7684\u8f38\u5165\u6578\u64da\u662f\u6a21\u578b\u7528\u4f86\u5275\u5efa\u9810\u6e2c\u7684\u6578\u64da\u3002\u60a8\u53ef\u4ee5\u63a1\u7528\u4ee5\u4e0b\u5169\u7a2e\u683c\u5f0f\u4e4b\u4e00\u63d0\u4f9b\u8f38\u5165\u6578\u64da\uff1a\n- Cloud Storage \u4e2d\u7684 CSV \u5c0d\u8c61\n- BigQuery \u8868\n\u6211\u5011\u5efa\u8b70\u60a8\u7232\u8f38\u5165\u6578\u64da\u4f7f\u7528\u8207\u8a13\u7df4\u6a21\u578b\u6642\u76f8\u540c\u7684\u683c\u5f0f\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528 BigQuery \u4e2d\u7684\u6578\u64da\u8a13\u7df4\u6a21\u578b\uff0c\u90a3\u9ebc\u6700\u597d\u4f7f\u7528 BigQuery \u8868\u4f5c\u7232\u6279\u91cf\u9810\u6e2c\u7684\u8f38\u5165\u3002\u7531\u65bc Vertex AI \u6703\u5c07\u6240\u6709 CSV \u8f38\u5165\u5b57\u6bb5\u8996\u7232\u5b57\u7b26\u4e32\uff0c\u56e0\u6b64\u6df7\u7528\u4e0d\u540c\u7684\u8a13\u7df4\u548c\u8f38\u5165\u6578\u64da\u683c\u5f0f\u53ef\u80fd\u6703\u5c0e\u81f4\u932f\u8aa4\u3002\n\u60a8\u7684\u6578\u64da\u6e90\u4e2d\u7684\u8868\u683c\u6578\u64da\u5fc5\u9808\u5305\u542b\u7528\u65bc\u8a13\u7df4\u6a21\u578b\u7684\u6240\u6709\u5217\uff08\u6309\u4efb\u610f\u9806\u5e8f\uff09\u3002\u60a8\u53ef\u4ee5\u6dfb\u52a0\u4e0d\u5c6c\u65bc\u8a13\u7df4\u6578\u64da\u7684\u5217\uff0c\u6216\u8005\u5c6c\u65bc\u8a13\u7df4\u6578\u64da\u4f46\u4e0d\u7528\u65bc\u8a13\u7df4\u7684\u5217\u3002\u9019\u4e9b\u984d\u5916\u7684\u5217\u5305\u542b\u5728\u8f38\u51fa\u4e2d\uff0c\u4f46\u4e0d\u6703\u5f71\u97ff\u9810\u6e2c\u7d50\u679c\u3002### \u8f38\u5165\u6578\u64da\u8981\u6c42\n\u9810\u6e2c\u6a21\u578b\u7684\u8f38\u5165\u5fc5\u9808\u7b26\u5408\u4ee5\u4e0b\u8981\u6c42\uff1a\n- \u6642\u9593\u5217\u4e2d\u7684\u6240\u6709\u503c\u90fd\u5fc5\u9808\u5b58\u5728\u4e14\u6709\u6548\u3002\n- \u8f38\u5165\u6578\u64da\u548c\u8a13\u7df4\u6578\u64da\u7684\u6578\u64da\u983b\u7387\u5fc5\u9808\u4e00\u81f4\u3002\u5982\u679c\u6642\u5e8f\u4e2d\u7f3a\u5c11\u884c\uff0c\u5247\u5fc5\u9808\u6839\u64da\u9069\u7576\u7684\u9818\u57df\u77e5\u8b58\u624b\u52d5\u63d2\u5165\u9019\u4e9b\u884c\u3002\n- \u7cfb\u7d71\u6703\u5c07\u5b58\u5728\u91cd\u8907\u6642\u9593\u6233\u7684\u6642\u9593\u5e8f\u5217\u5f9e\u9810\u6e2c\u4e2d\u79fb\u9664\u3002\u5982\u9700\u5305\u542b\u9019\u4e9b\u6642\u9593\u6233\uff0c\u8acb\u79fb\u9664\u4efb\u4f55\u91cd\u8907\u7684\u6642\u9593\u6233\u3002\n- \u7232\u8981\u9810\u6e2c\u7684\u6bcf\u500b\u6642\u5e8f\u63d0\u4f9b\u6b77\u53f2\u6578\u64da\u3002\u7232\u4e86\u7372\u5f97\u6700\u6e96\u78ba\u7684\u9810\u6e2c\uff0c\u6578\u64da\u91cf\u61c9\u8a72\u7b49\u65bc\u6a21\u578b\u8a13\u7df4\u671f\u9593\u8a2d\u7f6e\u7684\u4e0a\u4e0b\u6587\u7a97\u53e3\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e0a\u4e0b\u6587\u7a97\u53e3\u7232 14 \u5929\uff0c\u8acb\u63d0\u4f9b\u81f3\u5c11 14 \u5929\u7684\u6b77\u53f2\u6578\u64da\u3002\u5982\u679c\u60a8\u63d0\u4f9b\u8f03\u5c11\u7684\u6578\u64da\uff0cVertex AI \u6703\u586b\u5145\u5305\u542b\u7a7a\u503c\u7684\u6578\u64da\u3002\n- \u9810\u6e2c\u5f9e\u6642\u9593\u5e8f\u5217\uff08\u7b2c\u4e00\u884c\u6309\u6642\u9593\u6392\u5e8f\uff09\u7684\u7b2c\u4e00\u884c\u958b\u59cb\uff0c\u76ee\u6a19\u5217\u4e2d\u5177\u6709 null \u503c\u3002null \u503c\u5728\u6642\u9593\u5e8f\u5217\u4e2d\u5fc5\u9808\u662f\u9023\u7e8c\u7684\u3002\u4f8b\u5982\uff0c\u5982\u679c\u76ee\u6a19\u5217\u6309\u6642\u9593\u6392\u5e8f\uff0c\u5247\u60a8\u4e0d\u80fd\u5c07`1`\u3001`2`\u3001`null`\u3001`3`\u3001`4`\u3001`null`\u3001`null`\u4e4b\u985e\u7684\u7528\u65bc\u55ae\u500b\u6642\u5e8f\u3002\u5c0d\u65bc CSV \u6587\u4ef6\uff0cVertex AI \u5c07\u7a7a\u5b57\u7b26\u4e32\u8996\u7232 null\uff1b\u5c0d\u65bc BigQuery\uff0c\u539f\u751f\u652f\u6301 null \u503c\u3002\u5982\u679c\u60a8\u9078\u64c7 BigQuery \u8868\u4f5c\u7232\u8f38\u5165\uff0c\u5247\u5fc5\u9808\u78ba\u4fdd\uff1a- BigQuery \u6578\u64da\u6e90\u8868\u4e0d\u5f97\u5927\u65bc 100 GB\u3002\n- \u5982\u679c\u8a72\u8868\u5c6c\u65bc\u5176\u4ed6\u9805\u76ee\uff0c\u60a8\u5fc5\u9808\u5411\u8a72\u9805\u76ee\u4e2d\u7684 Vertex AI \u670d\u52d9\u8cec\u865f\u6388\u4e88`BigQuery Data Editor`\u89d2\u8272\u3002\n\u5982\u679c\u60a8\u9078\u64c7 Cloud Storage \u4e2d\u7684 CSV \u5c0d\u8c61\u4f5c\u7232\u8f38\u5165\uff0c\u5247\u5fc5\u9808\u78ba\u4fdd\uff1a- \u6578\u64da\u6e90\u5fc5\u9808\u4ee5\u5305\u542b\u5217\u540d\u7a31\u7684\u6a19\u984c\u884c\u958b\u982d\u3002\n- \u6bcf\u500b\u6578\u64da\u6e90\u5c0d\u8c61\u4e0d\u5f97\u5927\u65bc 10 GB\u3002\u53ef\u4ee5\u5305\u542b\u591a\u500b\u6587\u4ef6\uff0c\u4f46\u7e3d\u5927\u5c0f\u4e0d\u5f97\u8d85\u904e 100 GB\u3002\n- \u5982\u679c Cloud Storage \u5b58\u5132\u6876\u4f4d\u65bc\u5176\u4ed6\u9805\u76ee\u4e2d\uff0c\u5247\u60a8\u5fc5\u9808\u5c07`Storage Object Creator`\u89d2\u8272\u6388\u4e88\u8a72\u9805\u76ee\u4e2d\u7684 Vertex AI \u670d\u52d9\u8cec\u865f\u3002\n- \u6240\u6709\u5b57\u7b26\u4e32\u5fc5\u9808\u7528\u82f1\u6587\u96d9\u5f15\u865f (\") \u62ec\u8d77\u4f86\u3002## \u8f38\u51fa\u683c\u5f0f\n\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\u7684\u8f38\u51fa\u683c\u5f0f\u4e0d\u5fc5\u8207\u7528\u65bc\u8f38\u5165\u7684\u683c\u5f0f\u76f8\u540c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5c07 BigQuery \u8868\u7528\u4f5c\u8f38\u5165\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5c07\u9810\u6e2c\u7d50\u679c\u8f38\u51fa\u5230 Cloud Storage \u4e2d\u7684 CSV \u5c0d\u8c61\u3002\n## \u5411\u6a21\u578b\u767c\u51fa\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\n\u5982\u9700\u767c\u51fa\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u6216 Vertex AI API\u3002\u8f38\u5165\u6578\u64da\u6e90\u53ef\u4ee5\u662f\u5b58\u5132\u5728 Cloud Storage \u5b58\u5132\u6876\u6216 BigQuery \u8868\u4e2d\u7684 CSV \u5c0d\u8c61\u3002\u6279\u91cf\u9810\u6e2c\u4efb\u52d9\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u6642\u9593\u624d\u80fd\u5b8c\u6210\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u60a8\u63d0\u4ea4\u4f5c\u7232\u8f38\u5165\u7684\u6578\u64da\u91cf\u3002\n\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u8acb\u6c42\u6279\u91cf\u9810\u6e2c\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80 **\u6279\u91cf\u9810\u6e2c** \u9801\u9762\u3002 [\u524d\u5f80\u201c\u6279\u91cf\u9810\u6e2c\u201d\u9801\u9762](https://console.cloud.google.com/vertex-ai/batch-predictions?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa** \u4ee5\u6253\u958b **\u65b0\u5efa\u6279\u91cf\u9810\u6e2c** \u7a97\u53e3\u3002\n- \u5728 **\u5b9a\u7fa9\u6279\u91cf\u9810\u6e2c** \u90e8\u5206\uff0c\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9a5f\uff1a\n- \u8f38\u5165\u6279\u91cf\u9810\u6e2c\u7684\u540d\u7a31\u3002\n- \u5c0d\u65bc **\u6a21\u578b\u540d\u7a31** \uff0c\u9078\u64c7\u8981\u7528\u65bc\u6b64\u6279\u91cf\u9810\u6e2c\u7684\u6a21\u578b\u7684\u540d\u7a31\u3002\n- \u5c0d\u65bc **\u7248\u672c** \uff0c\u9078\u64c7\u6a21\u578b\u7684\u7248\u672c\u3002\n- \u5c0d\u65bc **\u9078\u64c7\u4f86\u6e90** \uff0c\u9078\u64c7\u6e90\u8f38\u5165\u6578\u64da\u662f Cloud Storage \u4e0a\u7684 CSV \u6587\u4ef6\u9084\u662f BigQuery \u4e2d\u7684\u8868\u3002\n- \u5c0d\u65bc CSV \u6587\u4ef6\uff0c\u8acb\u6307\u5b9a CSV \u8f38\u5165\u6587\u4ef6\u6240\u5728\u7684 Cloud Storage \u4f4d\u7f6e\u3002\n- \u5c0d\u65bc BigQuery \u8868\uff0c\u8acb\u6307\u5b9a\u8868\u6240\u5728\u7684\u9805\u76ee ID\u3001BigQuery \u6578\u64da\u96c6 ID \u4ee5\u53ca BigQuery \u8868\u6216\u8996\u5716 ID\u3002\n- \u5c0d\u65bc **\u6279\u91cf\u9810\u6e2c\u8f38\u51fa** \uff0c\u9078\u64c7 **CSV** \u6216 **BigQuery** \u3002- \u5c0d\u65bc CSV\uff0c\u8acb\u6307\u5b9a Vertex AI \u5b58\u5132\u8f38\u51fa\u7684 Cloud Storage \u5b58\u5132\u6876\u3002\n- \u5c0d\u65bc BigQuery\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u9805\u76ee ID \u6216\u73fe\u6709\u6578\u64da\u96c6\uff1a\n- \u5982\u9700\u6307\u5b9a\u9805\u76ee ID\uff0c\u8acb\u5728 **Google Cloud \u9805\u76ee ID** \u5b57\u6bb5\u4e2d\u8f38\u5165\u9805\u76ee ID\u3002Vertex AI \u6703\u7232\u60a8\u5275\u5efa\u65b0\u7684\u8f38\u51fa\u6578\u64da\u96c6\u3002\n- \u5982\u9700\u6307\u5b9a\u73fe\u6709\u6578\u64da\u96c6\uff0c\u8acb\u5728 **Google Cloud \u9805\u76ee ID** \u5b57\u6bb5\u4e2d\u8f38\u5165\u5176 BigQuery \u8def\u5f91\uff0c\u4f8b\u5982`bq://projectid.datasetid`\u3002\n- **** \u53ef\u9078\u3002\u5982\u679c\u8f38\u51fa\u76ee\u7684\u5730\u662f Cloud Storage \u4e0a\u7684 BigQuery \u6216 JSONL\uff0c\u5247\u9664\u4e86\u9810\u6e2c\u4e4b\u5916\uff0c\u60a8\u9084\u53ef\u4ee5\u5553\u7528\u7279\u5fb5\u6b78\u56e0\u3002\u7232\u6b64\uff0c\u8acb\u9078\u64c7 **\u7232\u6b64\u6a21\u578b\u5553\u7528\u7279\u5fb5\u6b78\u56e0** \u3002Cloud Storage \u4e0a\u7684 CSV \u4e0d\u652f\u6301\u7279\u5fb5\u6b78\u56e0\u3002 [\u77ad\u89e3\u8a73\u60c5](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-explanations?hl=zh-cn) \u3002\n- \u53ef\u9078\uff1a\u9069\u7528\u65bc\u6279\u91cf\u9810\u6e2c\u7684 [\u6a21\u578b\u76e3\u63a7](https://cloud.google.com/vertex-ai/docs/model-monitoring/overview?hl=zh-cn) \u5206\u6790\u529f\u80fd\u5df2\u63a8\u51fa [\u9810\u89bd\u7248](https://cloud.google.com/products?hl=zh-cn#product-launch-stages) \u3002\u8acb\u53c3\u95b1\u5c07\u504f\u5dee\u6aa2\u6e2c\u914d\u7f6e\u6dfb\u52a0\u5230\u6279\u91cf\u9810\u6e2c\u4f5c\u696d\u7684 [\u524d\u63d0\u689d\u4ef6](https://cloud.google.com/vertex-ai/docs/model-monitoring/model-monitoring-batch-predictions?hl=zh-cn#prerequisites) \u3002- \u9ede\u64ca\u4ee5 **\u7232\u6b64\u6279\u91cf\u9810\u6e2c\u5553\u7528\u6a21\u578b\u76e3\u63a7** \u3002\n- \u9078\u64c7 **\u8a13\u7df4\u6578\u64da\u6e90** \u3002\u8f38\u5165\u60a8\u9078\u64c7\u7684\u8a13\u7df4\u6578\u64da\u6e90\u7684\u6578\u64da\u8def\u5f91\u6216\u4f4d\u7f6e\u3002\n- \u53ef\u9078\uff1a\u5728 **\u63d0\u9192\u95be\u503c** \u4e0b\uff0c\u6307\u5b9a\u89f8\u767c\u63d0\u9192\u7684\u95be\u503c\u3002\n- \u5728 **\u901a\u77e5\u96fb\u5b50\u90f5\u4ef6\u5730\u5740** \u90e8\u5206\uff0c\u8f38\u5165\u4e00\u500b\u6216\u591a\u500b\u4ee5\u82f1\u6587\u9017\u865f\u5206\u9694\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\uff0c\u4ee5\u4fbf\u5728\u6a21\u578b\u8d85\u51fa\u63d0\u9192\u95be\u503c\u6642\u63a5\u6536\u63d0\u9192\u3002\n- \u53ef\u9078\uff1a\u5728 **\u901a\u77e5\u6e20\u9053** \u90e8\u5206\uff0c\u6dfb\u52a0 [Cloud Monitoring](https://cloud.google.com/monitoring/support/notification-options?hl=zh-cn) \u6e20\u9053\uff0c\u4ee5\u4fbf\u5728\u6a21\u578b\u8d85\u51fa\u63d0\u9192\u95be\u503c\u6642\u63a5\u6536\u63d0\u9192\u3002\u60a8\u53ef\u4ee5\u9078\u64c7\u73fe\u6709\u7684 Cloud Monitoring \u6e20\u9053\uff0c\u4e5f\u53ef\u4ee5\u901a\u904e\u9ede\u64ca **\u7ba1\u7406\u901a\u77e5\u6e20\u9053** \u4f86\u5275\u5efa\u4e00\u500b\u65b0\u7684 Cloud Monitoring \u6e20\u9053\u3002\u63a7\u5236\u6aaf\u652f\u6301 PagerDuty\u3001Slack \u548c Pub/Sub \u901a\u77e5\u6e20\u9053\u3002- \u9ede\u64ca **\u5275\u5efa** \u3002\n\u53ef\u4ee5\u4f7f\u7528 [batchPredictionJobs.create](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.batchPredictionJobs/create?hl=zh-cn) \u65b9\u6cd5\u8acb\u6c42\u6279\u91cf\u9810\u6e2c\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5b58\u5132\u6a21\u578b\u548c\u57f7\u884c\u6279\u91cf\u9810\u6e2c\u4f5c\u696d\u7684\u5340\u57df\u3002\u4f8b\u5982`us-central1`\u3002\n- \uff1a\u60a8\u7684 [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \n- \uff1a\u6279\u8655\u7406\u4f5c\u696d\u7684\u986f\u793a\u540d\n- \uff1a\u7528\u65bc\u57f7\u884c\u9810\u6e2c\u7684\u6a21\u578b\u7684 ID\n- \uff1a\u5c0d BigQuery \u6578\u64da\u6e90\u7684\u5f15\u7528\u3002\u5728\u6b64\u8868\u55ae\u4e2d\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a```\nbq://bqprojectId.bqDatasetId.bqTableId\n```\n- \uff1a\u5c0d BigQuery \u76ee\u6a19\u4f4d\u7f6e\uff08\u5c07\u5beb\u5165\u9810\u6e2c\u7d50\u679c\u7684\u4f4d\u7f6e\uff09\u7684\u5f15\u7528\u3002\u6307\u5b9a\u9805\u76ee ID\uff0c\u4e26 **\u9078\u64c7\u6027\u5730** \u6307\u5b9a\u6578\u64da\u96c6 ID\u3002\u8acb\u4f7f\u7528\u4ee5\u4e0b\u683c\u5f0f\uff1a```\nbq://bqprojectId.bqDatasetId\n```\u5982\u679c\u60a8\u50c5\u6307\u5b9a\u4e86\u9805\u76ee ID\uff0cVertex AI \u6703\u7232\u60a8\u5275\u5efa\u4e00\u500b\u65b0\u7684\u8f38\u51fa\u6578\u64da\u96c6\u3002\u8acb\u4f7f\u7528\u4ee5\u4e0b\u683c\u5f0f\uff1a```\nbq://bqprojectId\n```\n- \uff1a\u9ed8\u8a8d\u503c\u7232 false\u3002\u8a2d\u7f6e\u7232 true\u53ef\u5553\u7528\u7279\u5fb5\u6b78\u56e0\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7528\u65bc\u9810\u6e2c\u7684\u7279\u5fb5\u6b78\u56e0](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-explanations?hl=zh-cn) \u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"displayName\": \"BATCH_JOB_NAME\",\n \"model\": \"projects/PROJECT_ID/locations/LOCATION_ID/models/MODEL_ID\",\n \"inputConfig\": {\n \"instancesFormat\": \"bigquery\",\n \"bigquerySource\": {\n  \"inputUri\": \"INPUT_URI\"\n }\n },\n \"outputConfig\": {\n \"predictionsFormat\": \"bigquery\",\n \"bigqueryDestination\": {\n  \"outputUri\": \"OUTPUT_URI\"\n }\n },\n \"generate_explanation\": GENERATE_EXPLANATION\n}\n```\n\u5982\u9700\u767c\u9001\u8acb\u6c42\uff0c\u8acb\u9078\u64c7\u4ee5\u4e0b\u65b9\u5f0f\u4e4b\u4e00\uff1a\n **\u6ce8\u610f** \uff1a\u4ee5\u4e0b\u547d\u4ee4\u5047\u5b9a\u60a8\u5df2\u4f7f\u7528\u60a8\u7684\u7528\u6236\u8cec\u865f\u901a\u904e\u904b\u884c [gcloud init](https://cloud.google.com/sdk/gcloud/reference/init?hl=zh-cn) \u6216 [gcloud auth login](https://cloud.google.com/sdk/gcloud/reference/auth/login?hl=zh-cn) \u767b\u9304`gcloud`CLI\uff0c\u6216\u8005\u4f7f\u7528\u4e86 [Cloud Shell](https://cloud.google.com/shell/docs?hl=zh-cn) \uff0c\u9019\u6703\u4f7f\u60a8\u81ea\u52d5\u767b\u9304`gcloud`CLI\u3002\u60a8\u53ef\u4ee5\u904b\u884c [gcloud auth list](https://cloud.google.com/sdk/gcloud/reference/auth/list?hl=zh-cn) \u4f86\u6aa2\u67e5\u7576\u524d\u6d3b\u8e8d\u7684\u8cec\u865f\u3002\n\u5c07\u8acb\u6c42\u6b63\u6587\u4fdd\u5b58\u5728\u540d\u7232 `request.json` \u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u5f8c\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ncurl -X POST \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\"\n``` **\u6ce8\u610f** \uff1a\u4ee5\u4e0b\u547d\u4ee4\u5047\u5b9a\u60a8\u5df2\u4f7f\u7528\u60a8\u7684\u7528\u6236\u8cec\u865f\u901a\u904e\u904b\u884c [gcloud init](https://cloud.google.com/sdk/gcloud/reference/init?hl=zh-cn) \u6216 [gcloud auth login](https://cloud.google.com/sdk/gcloud/reference/auth/login?hl=zh-cn) \u767b\u9304`gcloud`CLI\uff0c\u6216\u8005\u4f7f\u7528\u4e86 [Cloud Shell](https://cloud.google.com/shell/docs?hl=zh-cn) \uff0c\u9019\u6703\u4f7f\u60a8\u81ea\u52d5\u767b\u9304`gcloud`CLI\u3002\u60a8\u53ef\u4ee5\u904b\u884c [gcloud auth list](https://cloud.google.com/sdk/gcloud/reference/auth/list?hl=zh-cn) \u4f86\u6aa2\u67e5\u7576\u524d\u6d3b\u8e8d\u7684\u8cec\u865f\u3002\n\u5c07\u8acb\u6c42\u6b63\u6587\u4fdd\u5b58\u5728\u540d\u7232 `request.json` \u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u5f8c\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method POST ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\" | Select-Object -Expand Content\n```\n\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs/67890\",\n \"displayName\": \"batch_job_1 202005291958\",\n \"model\": \"projects/12345/locations/us-central1/models/5678\",\n \"state\": \"JOB_STATE_PENDING\",\n \"inputConfig\": {\n \"instancesFormat\": \"bigquery\",\n \"bigquerySource\": {\n  \"inputUri\": \"INPUT_URI\"\n }\n },\n \"outputConfig\": {\n \"predictionsFormat\": \"bigquery\",\n \"bigqueryDestination\": {\n  \"outputUri\": bq://12345\n }\n },\n \"dedicatedResources\": {\n \"machineSpec\": {\n  \"machineType\": \"n1-standard-32\",\n  \"acceleratorCount\": \"0\"\n },\n \"startingReplicaCount\": 2,\n \"maxReplicaCount\": 6\n },\n \"manualBatchTuningParameters\": {\n \"batchSize\": 4\n },\n \"outputInfo\": {\n \"bigqueryOutputDataset\": \"bq://12345.reg_model_2020_10_02_06_04\n }\n \"state\": \"JOB_STATE_PENDING\",\n \"createTime\": \"2020-09-30T02:58:44.341643Z\",\n \"updateTime\": \"2020-09-30T02:58:44.341643Z\",\n}\n```\n\u5728\u5617\u8a66\u6b64\u793a\u4f8b\u4e4b\u524d\uff0c\u8acb\u6309\u7167 [\u300aVertex AI \u5feb\u901f\u5165\u9580\uff1a\u4f7f\u7528\u5ba2\u6236\u7aef\u5eab\u300b](https://cloud.google.com/vertex-ai/docs/start/client-libraries?hl=zh-cn) \u4e2d\u7684 Java \u8a2d\u7f6e\u8aaa\u660e\u57f7\u884c\u64cd\u4f5c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Vertex AI Java API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/java/docs/reference/google-cloud-aiplatform/latest/com.google.cloud.aiplatform.v1?hl=zh-cn) \u3002\n\u5982\u9700\u5411 Vertex AI \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u5c07\n\u548c\n\u66ff\u63db\u7232\u201cbigquery\u201d\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u66ff\u63db\u5176\u4ed6\u4f54\u4f4d\u7b26\uff0c\u8acb\u53c3\u95b1\u672c\u90e8\u5206\u7684\u201cREST \u548c CMD LINE\u201d\u6a19\u7c64\u9801\u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/aiplatform/src/main/java/aiplatform/CreateBatchPredictionJobBigquerySample.java) \n```\nimport com.google.cloud.aiplatform.v1.BatchPredictionJob;import com.google.cloud.aiplatform.v1.BigQueryDestination;import com.google.cloud.aiplatform.v1.BigQuerySource;import com.google.cloud.aiplatform.v1.JobServiceClient;import com.google.cloud.aiplatform.v1.JobServiceSettings;import com.google.cloud.aiplatform.v1.LocationName;import com.google.cloud.aiplatform.v1.ModelName;import com.google.gson.JsonObject;import com.google.protobuf.Value;import com.google.protobuf.util.JsonFormat;import java.io.IOException;public class CreateBatchPredictionJobBigquerySample {\u00a0 public static void main(String[] args) throws IOException {\u00a0 \u00a0 // TODO(developer): Replace these variables before running the sample.\u00a0 \u00a0 String project = \"PROJECT\";\u00a0 \u00a0 String displayName = \"DISPLAY_NAME\";\u00a0 \u00a0 String modelName = \"MODEL_NAME\";\u00a0 \u00a0 String instancesFormat = \"INSTANCES_FORMAT\";\u00a0 \u00a0 String bigquerySourceInputUri = \"BIGQUERY_SOURCE_INPUT_URI\";\u00a0 \u00a0 String predictionsFormat = \"PREDICTIONS_FORMAT\";\u00a0 \u00a0 String bigqueryDestinationOutputUri = \"BIGQUERY_DESTINATION_OUTPUT_URI\";\u00a0 \u00a0 createBatchPredictionJobBigquerySample(\u00a0 \u00a0 \u00a0 \u00a0 project,\u00a0 \u00a0 \u00a0 \u00a0 displayName,\u00a0 \u00a0 \u00a0 \u00a0 modelName,\u00a0 \u00a0 \u00a0 \u00a0 instancesFormat,\u00a0 \u00a0 \u00a0 \u00a0 bigquerySourceInputUri,\u00a0 \u00a0 \u00a0 \u00a0 predictionsFormat,\u00a0 \u00a0 \u00a0 \u00a0 bigqueryDestinationOutputUri);\u00a0 }\u00a0 static void createBatchPredictionJobBigquerySample(\u00a0 \u00a0 \u00a0 String project,\u00a0 \u00a0 \u00a0 String displayName,\u00a0 \u00a0 \u00a0 String model,\u00a0 \u00a0 \u00a0 String instancesFormat,\u00a0 \u00a0 \u00a0 String bigquerySourceInputUri,\u00a0 \u00a0 \u00a0 String predictionsFormat,\u00a0 \u00a0 \u00a0 String bigqueryDestinationOutputUri)\u00a0 \u00a0 \u00a0 throws IOException {\u00a0 \u00a0 JobServiceSettings settings =\u00a0 \u00a0 \u00a0 \u00a0 JobServiceSettings.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setEndpoint(\"us-central1-aiplatform.googleapis.com:443\")\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 String location = \"us-central1\";\u00a0 \u00a0 // Initialize client that will be used to send requests. This client only needs to be created\u00a0 \u00a0 // once, and can be reused for multiple requests. After completing all of your requests, call\u00a0 \u00a0 // the \"close\" method on the client to safely clean up any remaining background resources.\u00a0 \u00a0 try (JobServiceClient client = JobServiceClient.create(settings)) {\u00a0 \u00a0 \u00a0 JsonObject jsonModelParameters = new JsonObject();\u00a0 \u00a0 \u00a0 Value.Builder modelParametersBuilder = Value.newBuilder();\u00a0 \u00a0 \u00a0 JsonFormat.parser().merge(jsonModelParameters.toString(), modelParametersBuilder);\u00a0 \u00a0 \u00a0 Value modelParameters = modelParametersBuilder.build();\u00a0 \u00a0 \u00a0 BigQuerySource bigquerySource =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 BigQuerySource.newBuilder().setInputUri(bigquerySourceInputUri).build();\u00a0 \u00a0 \u00a0 BatchPredictionJob.InputConfig inputConfig =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 BatchPredictionJob.InputConfig.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setInstancesFormat(instancesFormat)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setBigquerySource(bigquerySource)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 BigQueryDestination bigqueryDestination =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 BigQueryDestination.newBuilder().setOutputUri(bigqueryDestinationOutputUri).build();\u00a0 \u00a0 \u00a0 BatchPredictionJob.OutputConfig outputConfig =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 BatchPredictionJob.OutputConfig.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setPredictionsFormat(predictionsFormat)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setBigqueryDestination(bigqueryDestination)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 String modelName = ModelName.of(project, location, model).toString();\u00a0 \u00a0 \u00a0 BatchPredictionJob batchPredictionJob =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 BatchPredictionJob.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setDisplayName(displayName)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setModel(modelName)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setModelParameters(modelParameters)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setInputConfig(inputConfig)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setOutputConfig(outputConfig)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 LocationName parent = LocationName.of(project, location);\u00a0 \u00a0 \u00a0 BatchPredictionJob response = client.createBatchPredictionJob(parent, batchPredictionJob);\u00a0 \u00a0 \u00a0 System.out.format(\"response: %s\\n\", response);\u00a0 \u00a0 \u00a0 System.out.format(\"\\tName: %s\\n\", response.getName());\u00a0 \u00a0 }\u00a0 }}\n```\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u6216\u66f4\u65b0 Python\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Python \u7248 Vertex AI SDK](https://cloud.google.com/vertex-ai/docs/start/use-vertex-ai-python-sdk?hl=zh-cn) \u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [   Python API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/python/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/googleapis/python-aiplatform/blob/HEAD/samples/model-builder/create_batch_prediction_job_bigquery_sample.py) \n```\ndef create_batch_prediction_job_bigquery_sample(\u00a0 \u00a0 project: str,\u00a0 \u00a0 location: str,\u00a0 \u00a0 model_resource_name: str,\u00a0 \u00a0 job_display_name: str,\u00a0 \u00a0 bigquery_source: str,\u00a0 \u00a0 bigquery_destination_prefix: str,\u00a0 \u00a0 sync: bool = True,):\u00a0 \u00a0 aiplatform.init(project=project, location=location)\u00a0 \u00a0 my_model = aiplatform.Model(model_resource_name)\u00a0 \u00a0 batch_prediction_job = my_model.batch_predict(\u00a0 \u00a0 \u00a0 \u00a0 job_display_name=job_display_name,\u00a0 \u00a0 \u00a0 \u00a0 bigquery_source=bigquery_source,\u00a0 \u00a0 \u00a0 \u00a0 bigquery_destination_prefix=bigquery_destination_prefix,\u00a0 \u00a0 \u00a0 \u00a0 sync=sync,\u00a0 \u00a0 )\u00a0 \u00a0 batch_prediction_job.wait()\u00a0 \u00a0 print(batch_prediction_job.display_name)\u00a0 \u00a0 print(batch_prediction_job.resource_name)\u00a0 \u00a0 print(batch_prediction_job.state)\u00a0 \u00a0 return batch_prediction_job\n```\n\u53ef\u4ee5\u4f7f\u7528 [batchPredictionJobs.create](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.batchPredictionJobs/create?hl=zh-cn) \u65b9\u6cd5\u8acb\u6c42\u6279\u91cf\u9810\u6e2c\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5b58\u5132\u6a21\u578b\u548c\u57f7\u884c\u6279\u91cf\u9810\u6e2c\u4f5c\u696d\u7684\u5340\u57df\u3002\u4f8b\u5982`us-central1`\u3002\n- \uff1a\u60a8\u7684 [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \n- \uff1a\u6279\u8655\u7406\u4f5c\u696d\u7684\u986f\u793a\u540d\n- \uff1a\u7528\u65bc\u57f7\u884c\u9810\u6e2c\u7684\u6a21\u578b\u7684 ID\n- \uff1a\u5305\u542b\u8a13\u7df4\u6578\u64da\u7684 Cloud Storage \u5b58\u5132\u6876\u7684\u8def\u5f91 (URI)\u3002\u53ef\u4ee5\u6709\u591a\u500b\u8def\u5f91\u3002\u6bcf\u500b URI \u7684\u683c\u5f0f\u5982\u4e0b\uff1a```\ngs://bucketName/pathToFileName\n```\n- \uff1a\u5c07\u5beb\u5165\u9810\u6e2c\u7684 Cloud Storage \u76ee\u6a19\u8def\u5f91\u3002Vertex AI \u6703\u5c07\u6279\u91cf\u9810\u6e2c\u5beb\u5165\u6b64\u8def\u5f91\u4e0a\u5e36\u6642\u9593\u6233\u7684\u5b50\u76ee\u9304\u4e2d\u3002\u5c07\u6b64\u503c\u8a2d\u7f6e\u7232\u63a1\u7528\u4ee5\u4e0b\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff1a```\ngs://bucketName/pathToOutputDirectory\n```\n- \uff1a\u9ed8\u8a8d\u503c\u7232 false\u3002\u8a2d\u7f6e\u7232 true\u53ef\u5553\u7528\u7279\u5fb5\u6b78\u56e0\u3002\u6b64\u9078\u9805\u50c5\u5728\u8f38\u51fa\u76ee\u7684\u5730\u7232 JSONL \u6642\u53ef\u7528\u3002Cloud Storage \u4e0a\u7684 CSV \u4e0d\u652f\u6301\u7279\u5fb5\u6b78\u56e0\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7528\u65bc\u9810\u6e2c\u7684\u7279\u5fb5\u6b78\u56e0](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-explanations?hl=zh-cn) \u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"displayName\": \"BATCH_JOB_NAME\",\n \"model\": \"projects/PROJECT_ID/locations/LOCATION_ID/models/MODEL_ID\",\n \"inputConfig\": {\n \"instancesFormat\": \"csv\",\n \"gcsSource\": {\n  \"uris\": [  URI1,...\n  ]\n },\n },\n \"outputConfig\": {\n \"predictionsFormat\": \"csv\",\n \"gcsDestination\": {\n  \"outputUriPrefix\": \"OUTPUT_URI_PREFIX\"\n }\n },\n \"generate_explanation\": GENERATE_EXPLANATION\n}\n```\n\u5982\u9700\u767c\u9001\u8acb\u6c42\uff0c\u8acb\u9078\u64c7\u4ee5\u4e0b\u65b9\u5f0f\u4e4b\u4e00\uff1a\n **\u6ce8\u610f** \uff1a\u4ee5\u4e0b\u547d\u4ee4\u5047\u5b9a\u60a8\u5df2\u4f7f\u7528\u60a8\u7684\u7528\u6236\u8cec\u865f\u901a\u904e\u904b\u884c [gcloud init](https://cloud.google.com/sdk/gcloud/reference/init?hl=zh-cn) \u6216 [gcloud auth login](https://cloud.google.com/sdk/gcloud/reference/auth/login?hl=zh-cn) \u767b\u9304`gcloud`CLI\uff0c\u6216\u8005\u4f7f\u7528\u4e86 [Cloud Shell](https://cloud.google.com/shell/docs?hl=zh-cn) \uff0c\u9019\u6703\u4f7f\u60a8\u81ea\u52d5\u767b\u9304`gcloud`CLI\u3002\u60a8\u53ef\u4ee5\u904b\u884c [gcloud auth list](https://cloud.google.com/sdk/gcloud/reference/auth/list?hl=zh-cn) \u4f86\u6aa2\u67e5\u7576\u524d\u6d3b\u8e8d\u7684\u8cec\u865f\u3002\n\u5c07\u8acb\u6c42\u6b63\u6587\u4fdd\u5b58\u5728\u540d\u7232 `request.json` \u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u5f8c\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ncurl -X POST \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\"\n``` **\u6ce8\u610f** \uff1a\u4ee5\u4e0b\u547d\u4ee4\u5047\u5b9a\u60a8\u5df2\u4f7f\u7528\u60a8\u7684\u7528\u6236\u8cec\u865f\u901a\u904e\u904b\u884c [gcloud init](https://cloud.google.com/sdk/gcloud/reference/init?hl=zh-cn) \u6216 [gcloud auth login](https://cloud.google.com/sdk/gcloud/reference/auth/login?hl=zh-cn) \u767b\u9304`gcloud`CLI\uff0c\u6216\u8005\u4f7f\u7528\u4e86 [Cloud Shell](https://cloud.google.com/shell/docs?hl=zh-cn) \uff0c\u9019\u6703\u4f7f\u60a8\u81ea\u52d5\u767b\u9304`gcloud`CLI\u3002\u60a8\u53ef\u4ee5\u904b\u884c [gcloud auth list](https://cloud.google.com/sdk/gcloud/reference/auth/list?hl=zh-cn) \u4f86\u6aa2\u67e5\u7576\u524d\u6d3b\u8e8d\u7684\u8cec\u865f\u3002\n\u5c07\u8acb\u6c42\u6b63\u6587\u4fdd\u5b58\u5728\u540d\u7232 `request.json` \u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u5f8c\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method POST ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://LOCATION_ID-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs\" | Select-Object -Expand Content\n```\n\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_ID/locations/LOCATION_ID/batchPredictionJobs/67890\",\n \"displayName\": \"batch_job_1 202005291958\",\n \"model\": \"projects/12345/locations/us-central1/models/5678\",\n \"state\": \"JOB_STATE_PENDING\",\n \"inputConfig\": {\n \"instancesFormat\": \"csv\",\n \"gcsSource\": {\n  \"uris\": [  \"gs://bp_bucket/reg_mode_test\"\n  ]\n }\n },\n \"outputConfig\": {\n \"predictionsFormat\": \"csv\",\n \"gcsDestination\": {\n  \"outputUriPrefix\": \"OUTPUT_URI_PREFIX\"\n }\n },\n \"dedicatedResources\": {\n \"machineSpec\": {\n  \"machineType\": \"n1-standard-32\",\n  \"acceleratorCount\": \"0\"\n },\n \"startingReplicaCount\": 2,\n \"maxReplicaCount\": 6\n }\n \"outputInfo\": {\n \"gcsOutputDataset\": \"OUTPUT_URI_PREFIX/prediction-batch_job_1 202005291958-2020-09-30T02:58:44.341643Z\"\n }\n \"state\": \"JOB_STATE_PENDING\",\n \"createTime\": \"2020-09-30T02:58:44.341643Z\",\n \"updateTime\": \"2020-09-30T02:58:44.341643Z\",\n}\n```\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u6216\u66f4\u65b0 Python\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Python \u7248 Vertex AI SDK](https://cloud.google.com/vertex-ai/docs/start/use-vertex-ai-python-sdk?hl=zh-cn) \u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [   Python API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/python/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/googleapis/python-aiplatform/blob/HEAD/samples/model-builder/create_batch_prediction_job_sample.py) \n```\ndef create_batch_prediction_job_sample(\u00a0 \u00a0 project: str,\u00a0 \u00a0 location: str,\u00a0 \u00a0 model_resource_name: str,\u00a0 \u00a0 job_display_name: str,\u00a0 \u00a0 gcs_source: Union[str, Sequence[str]],\u00a0 \u00a0 gcs_destination: str,\u00a0 \u00a0 sync: bool = True,):\u00a0 \u00a0 aiplatform.init(project=project, location=location)\u00a0 \u00a0 my_model = aiplatform.Model(model_resource_name)\u00a0 \u00a0 batch_prediction_job = my_model.batch_predict(\u00a0 \u00a0 \u00a0 \u00a0 job_display_name=job_display_name,\u00a0 \u00a0 \u00a0 \u00a0 gcs_source=gcs_source,\u00a0 \u00a0 \u00a0 \u00a0 gcs_destination_prefix=gcs_destination,\u00a0 \u00a0 \u00a0 \u00a0 sync=sync,\u00a0 \u00a0 )\u00a0 \u00a0 batch_prediction_job.wait()\u00a0 \u00a0 print(batch_prediction_job.display_name)\u00a0 \u00a0 print(batch_prediction_job.resource_name)\u00a0 \u00a0 print(batch_prediction_job.state)\u00a0 \u00a0 return batch_prediction_job\n```\n## \u6aa2\u7d22\u6279\u91cf\u9810\u6e2c\u7d50\u679c\nVertex AI \u6703\u5c07\u6279\u91cf\u9810\u6e2c\u7684\u8f38\u51fa\u767c\u9001\u5230\u60a8\u6307\u5b9a\u7684\u76ee\u6a19\u4f4d\u7f6e\uff08\u53ef\u4ee5\u662f BigQuery \u6216 Cloud Storage\uff09\u3002\n\u76ee\u524d\u4e0d\u652f\u6301\u7279\u5fb5\u6b78\u56e0\u7684 Cloud Storage \u8f38\u51fa\u3002\n### \u8f38\u51fa\u6578\u64da\u96c6\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f BigQuery\uff0c\u5247\u6279\u91cf\u9810\u6e2c\u7684\u8f38\u51fa\u6703\u5b58\u5132\u5728\u8f38\u51fa\u6578\u64da\u96c6\u4e2d\u3002\u5982\u679c\u60a8\u7232 Vertex AI \u63d0\u4f9b\u4e86\u6578\u64da\u96c6\uff0c\u5247\u6578\u64da\u96c6 ( ) \u7684\u540d\u7a31\u5c31\u662f\u60a8\u4e4b\u524d\u63d0\u4f9b\u7684\u540d\u7a31\u3002\u5982\u679c\u60a8\u672a\u63d0\u4f9b\u8f38\u51fa\u6578\u64da\u96c6\uff0c\u5247 Vertex AI \u6703\u7232\u60a8\u5275\u5efa\u4e00\u500b\u8f38\u51fa\u6578\u64da\u96c6\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u6b65\u9a5f\u627e\u5230\u5176\u540d\u7a31 ( )\uff1a- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u9032\u5165 Vertex AI **\u6279\u91cf\u9810\u6e2c** \u9801\u9762\u3002 [\u524d\u5f80\u201c\u6279\u91cf\u9810\u6e2c\u201d\u9801\u9762](https://console.cloud.google.com/vertex-ai/batch-predictions?hl=zh-cn) \n- \u9078\u64c7\u60a8\u5275\u5efa\u7684\u9810\u6e2c\u3002\n- \u8f38\u51fa\u6578\u64da\u96c6\u5728 **\u5c0e\u51fa\u4f4d\u7f6e** \u4e2d\u63d0\u4f9b\u3002\u6578\u64da\u96c6\u540d\u7a31\u7684\u683c\u5f0f\u5982\u4e0b\uff1a`prediction_` `` `_` ``### \u8f38\u51fa\u8868\n\u8f38\u51fa\u6578\u64da\u96c6\u5305\u542b\u4ee5\u4e0b\u4e09\u500b\u8f38\u51fa\u8868\u4e2d\u7684\u4e00\u500b\u6216\u591a\u500b\uff1a- \u9810\u6e2c\u8868\u6b64\u8868\u5305\u542b\u8f38\u5165\u6578\u64da\u4e2d\u8acb\u6c42\u9810\u6e2c\uff08\u5373\u5176\u4e2d = null\uff09\u5c0d\u61c9\u7684\u6bcf\u4e00\u884c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8f38\u5165\u5305\u542b\u76ee\u6a19\u5217\u7684 14 \u500b\u7a7a\u689d\u76ee\uff08\u4f8b\u5982\u672a\u4f86 14 \u5929\u7684\u92b7\u552e\u984d\uff09\uff0c\u5247\u9810\u6e2c\u8acb\u6c42\u5c07\u8fd4\u56de 14 \u884c\uff0c\u5373\u6bcf\u5929\u7684\u92b7\u552e\u984d\u3002\u5982\u679c\u9810\u6e2c\u8acb\u6c42\u8d85\u51fa\u6a21\u578b\u7684\u9810\u6e2c\u7bc4\u570d\uff0c\u5247 Vertex AI \u50c5\u6703\u8fd4\u56de\u8a72\u9810\u6e2c\u7bc4\u570d\u5167\u7684\u9810\u6e2c\u7d50\u679c\u3002\n- \u932f\u8aa4\u9a57\u8b49\u8868\u6b64\u8868\u5305\u542b\u5728\u6279\u91cf\u9810\u6e2c\u4e4b\u524d\u767c\u751f\u7684\u805a\u5408\u968e\u6bb5\u4e2d\u51fa\u73fe\u7684\u6bcf\u500b\u975e\u56b4\u91cd\u932f\u8aa4\u5c0d\u61c9\u7684\u884c\u3002\u6bcf\u500b\u975e\u56b4\u91cd\u932f\u8aa4\u8207\u8f38\u5165\u6578\u64da\u4e2d Vertex AI \u7121\u6cd5\u5c0d\u5176\u8fd4\u56de\u9810\u6e2c\u7d50\u679c\u7684\u884c\u76f8\u5c0d\u61c9\u3002\n- \u932f\u8aa4\u8868\u4e0b\u8868\u5305\u542b\u6279\u91cf\u9810\u6e2c\u671f\u9593\u51fa\u73fe\u7684\u6bcf\u500b\u975e\u56b4\u91cd\u932f\u8aa4\u5c0d\u61c9\u7684\u884c\u3002\u6bcf\u500b\u975e\u56b4\u91cd\u932f\u8aa4\u8207\u8f38\u5165\u6578\u64da\u4e2d Vertex AI \u7121\u6cd5\u5c0d\u5176\u8fd4\u56de\u9810\u6e2c\u7d50\u679c\u7684\u884c\u76f8\u5c0d\u61c9\u3002\n\u8868\u7684\u540d\u7a31 ( ) \u9644\u52a0\u4e86 `predictions_` \u4e26\u9644\u52a0\u4e86\u6279\u91cf\u9810\u6e2c\u4f5c\u696d\u958b\u59cb\u7684\u6642\u9593\u6233\uff0c\u683c\u5f0f\u7232 `predictions_` ``\n\u5982\u9700\u6aa2\u7d22\u9810\u6e2c\u8868\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5728\u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 BigQuery \u9801\u9762\u3002 [\u9032\u5165 BigQuery](https://console.cloud.google.com/bigquery?hl=zh-cn) \n- \u8acb\u904b\u884c\u4ee5\u4e0b\u67e5\u8a62\uff1a```\nSELECT * FROM BQ_DATASET_NAME.BQ_PREDICTIONS_TABLE_NAME\n  \n```\nVertex AI \u5c07\u9810\u6e2c\u7d50\u679c\u5b58\u5132\u5728 `predicted_` `` `.value` \u5217\u4e2d\u3002\n\u5982\u679c\u60a8 [\u4f7f\u7528 Temporal Fusion Transformer (TFT) \u8a13\u7df4\u6a21\u578b](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-parameters?hl=zh-cn#training-methods) \uff0c\u5247\u53ef\u4ee5\u5728 `predicted_` `` `.tft_feature_importance` \u5217\u4e2d\u627e\u5230 TFT \u53ef\u89e3\u91cb\u6027\u8f38\u51fa\u3002\n\u6b64\u5217\u9032\u4e00\u6b65\u7d30\u5206\u7232\u4ee5\u4e0b\u5404\u9805\uff1a- `context_columns`\uff1a\u9810\u6e2c\u7279\u5fb5\uff0c\u5176 [\u4e0a\u4e0b\u6587\u7a97\u53e3](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-parameters?hl=zh-cn#forecast-window) \u503c\u7528\u4f5c TFT \u9577/\u77ed\u671f\u8a18\u61b6 (LSTM) \u7de8\u78bc\u5668\u7684\u8f38\u5165\u3002\n- `context_weights`\uff1a\u8207\u9810\u6e2c\u5be6\u4f8b\u7684\u6bcf\u500b`context_columns`\u95dc\u806f\u7684\u7279\u5fb5\u91cd\u8981\u6027\u6b0a\u91cd\u3002\n- `horizon_columns`\uff1a\u9810\u6e2c\u7279\u5fb5\uff0c\u5176 [\u9810\u6e2c\u7bc4\u570d](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-parameters?hl=zh-cn#forecast-window) \u503c\u7528\u4f5c TFT \u9577/\u77ed\u671f\u8a18\u61b6 (LSTM) \u89e3\u78bc\u5668\u7684\u8f38\u5165\u3002\n- `horizon_weights`\uff1a\u8207\u9810\u6e2c\u5be6\u4f8b\u7684\u6bcf\u500b`horizon_columns`\u95dc\u806f\u7684\u7279\u5fb5\u91cd\u8981\u6027\u6b0a\u91cd\u3002\n- `attribute_columns`\uff1a\u9810\u6e2c\u7279\u5fb5\uff08 [\u6642\u9593\u4e0d\u8b8a](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-parameters?hl=zh-cn#feature-type) \uff09\u3002\n- `attribute_weights`\uff1a\u8207\u6bcf\u500b`attribute_columns`\u95dc\u806f\u7684\u6b0a\u91cd\u3002\n\u5982\u679c\u6a21\u578b [\u91dd\u5c0d\u5206\u4f4d\u6578\u640d\u5931\u9032\u884c\u4e86\u512a\u5316](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-parameters?hl=zh-cn#optimization-objectives) \uff0c\u4e26\u4e14\u5206\u4f4d\u6578\u96c6\u5305\u542b\u4e2d\u4f4d\u6578\uff0c\u5247 `predicted_` `` `.value` \u662f\u4e2d\u4f4d\u6578\u7684\u9810\u6e2c\u503c\u3002\u5426\u5247\uff0c `predicted_` `` `.value` \u662f\u96c6\u5408\u4e2d\u6700\u5c0f\u5206\u4f4d\u6578\u7684\u9810\u6e2c\u503c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5206\u4f4d\u6578\u96c6\u7232 `[0.1, 0.5, 0.9]` \uff0c\u5247 `value` \u662f\u5206\u4f4d\u6578 `0.5` \u7684\u9810\u6e2c\u503c\u3002\u5982\u679c\u5206\u4f4d\u6578\u96c6\u7232 `[0.1, 0.9]` \uff0c\u5247 `value` \u662f\u5206\u4f4d\u6578 `0.1` \u7684\u9810\u6e2c\u503c\u3002\n\u6b64\u5916\uff0cVertex AI \u6703\u5c07\u5206\u4f4d\u6578\u503c\u548c\u9810\u6e2c\u5b58\u5132\u5728\u4ee5\u4e0b\u5217\u4e2d\uff1a- `predicted_` `` `.quantile_values`\uff1a\u5206\u4f4d\u6578\u7684\u503c\uff0c\u5728\u6a21\u578b\u8a13\u7df4\u671f\u9593\u8a2d\u7f6e\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u662f`0.1`\u3001`0.5`\u548c`0.9`\u3002\n- `predicted_` `` `.quantile_predictions`\uff1a\u8207\u5206\u4f4d\u6578\u503c\u95dc\u806f\u7684\u9810\u6e2c\u503c\u3002\n\u5982\u679c\u6a21\u578b\u4f7f\u7528\u6982\u7387\u63a8\u7406\uff0c\u5247 `predicted_` `` `.value` \u5305\u542b\u512a\u5316\u76ee\u6a19\u7684\u6700\u5c0f\u5316\u5668\u3002\u4f8b\u5982\uff0c\u5982\u679c\u512a\u5316\u76ee\u6a19\u7232 `minimize-rmse` \uff0c\u5247 `predicted_` `` `.value` \u5305\u542b\u5e73\u5747\u503c\u3002\u5982\u679c\u512a\u5316\u76ee\u6a19\u7232 `minimize-mae` \uff0c\u5247 `predicted_` `` `.value` \u5305\u542b\u4e2d\u4f4d\u6578\u503c\u3002\n\u5982\u679c\u6a21\u578b\u5c07\u6982\u7387\u63a8\u7406\u8207\u5206\u4f4d\u6578\u7d50\u5408\u4f7f\u7528\uff0c\u5247 Vertex AI \u6703\u5c07\u5206\u4f4d\u6578\u503c\u548c\u9810\u6e2c\u5b58\u5132\u5728\u4ee5\u4e0b\u5217\u4e2d\uff1a- `predicted_` `` `.quantile_values`\uff1a\u5206\u4f4d\u6578\u7684\u503c\uff0c\u5728\u6a21\u578b\u8a13\u7df4\u671f\u9593\u8a2d\u7f6e\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u662f`0.1`\u3001`0.5`\u548c`0.9`\u3002\n- `predicted_` `` `.quantile_predictions`\uff1a\u8207\u5206\u4f4d\u6578\u503c\u95dc\u806f\u7684\u9810\u6e2c\u503c\u3002\n\u5982\u679c\u60a8\u5553\u7528\u4e86\u7279\u5fb5\u6b78\u56e0\uff0c\u5247\u53ef\u4ee5\u5728\u9810\u6e2c\u8868\u4e2d\u627e\u5230\u5b83\u5011\u3002\u5982\u9700\u8a2a\u554f\u7279\u5fb5 \u7684\u6b78\u56e0\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u67e5\u8a62\uff1a\n```\nSELECT explanation.attributions[OFFSET(0)].featureAttributions.BQ_FEATURE_NAME FROM BQ_DATASET_NAME.BQ_PREDICTIONS_TABLE_NAME\n \n```\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7528\u65bc\u9810\u6e2c\u7684\u7279\u5fb5\u6b78\u56e0](https://cloud.google.com/vertex-ai/docs/tabular-data/forecasting-explanations?hl=zh-cn) \u3002\n\u8a72\u8868\u540d\u7a31 ( ) \u7531\u201cerrors_validation\u201d\u5f8c\u9762\u9644\u52a0\u6279\u91cf\u9810\u6e2c\u4f5c\u696d\u958b\u59cb\u6642\u7684\u6642\u9593\u6233\u7d44\u6210\uff1a `errors_validation_` ``\n\u5982\u9700\u6aa2\u7d22\u932f\u8aa4\u9a57\u8b49\u8868\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5728\u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 BigQuery \u9801\u9762\u3002 [\u9032\u5165 BigQuery](https://console.cloud.google.com/bigquery?hl=zh-cn) \n- \u8acb\u904b\u884c\u4ee5\u4e0b\u67e5\u8a62\uff1a```\nSELECT * FROM BQ_DATASET_NAME.BQ_ERRORS_VALIDATION_TABLE_NAME\n  \n```\n\u932f\u8aa4\u6d88\u606f\u5b58\u5132\u5728\u4ee5\u4e0b\u5217\u4e2d\uff1a\n- errors_\n\u8a72\u8868\u540d\u7a31 ( ) \u7531\u201cerrors_\u201d\u5f8c\u9762\u9644\u52a0\u6279\u91cf\u9810\u6e2c\u4f5c\u696d\u958b\u59cb\u6642\u7684\u6642\u9593\u6233\u7d44\u6210\uff1a `errors_` ``\n\u5982\u9700\u6aa2\u7d22\u932f\u8aa4\u9a57\u8b49\u8868\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5728\u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 BigQuery \u9801\u9762\u3002 [\u9032\u5165 BigQuery](https://console.cloud.google.com/bigquery?hl=zh-cn) \n- \u8acb\u904b\u884c\u4ee5\u4e0b\u67e5\u8a62\uff1a```\nSELECT * FROM BQ_DATASET_NAME.BQ_ERRORS_TABLE_NAME\n  \n```\n\u932f\u8aa4\u5b58\u5132\u5728\u4ee5\u4e0b\u5217\u4e2d\uff1a\n- errors_.code\n- errors_.message\u5982\u679c\u60a8\u5c07 Cloud Storage \u6307\u5b9a\u7232\u8f38\u51fa\u7684\u76ee\u6a19\u4f4d\u7f6e\uff0c\u5247\u6279\u91cf\u9810\u6e2c\u8acb\u6c42\u7684\u7d50\u679c\u6703\u4f5c\u7232 CSV \u5c0d\u8c61\u8fd4\u56de\u5230\u60a8\u6307\u5b9a\u7684\u5b58\u5132\u6876\u7684\u65b0\u6587\u4ef6\u593e\u4e2d\u3002\u6587\u4ef6\u593e\u7684\u540d\u7a31\u662f\u6a21\u578b\u7684\u540d\u7a31\uff0c\u8a72\u540d\u7a31\u524d\u9762\u9644\u52a0\u4e86\u201cprediction-\u201d\uff0c\u5f8c\u9762\u9644\u52a0\u4e86\u6279\u91cf\u9810\u6e2c\u4f5c\u696d\u958b\u59cb\u6642\u7684\u6642\u9593\u6233\u3002\u60a8\u53ef\u4ee5\u5728\u6a21\u578b\u7684 **\u6279\u91cf\u9810\u6e2c** \u6a19\u7c64\u9801\u4e2d\u627e\u5230 Cloud Storage \u6587\u4ef6\u593e\u540d\u7a31\u3002\nCloud Storage \u6587\u4ef6\u593e\u5305\u542b\u5169\u7a2e\u5c0d\u8c61\uff1a\n- **\u9810\u6e2c\u5c0d\u8c61** \u9810\u6e2c\u5c0d\u8c61\u7684\u540d\u7a31\u7232\u201cpredictions_1.csv\u201d\u201cpredictions_2.csv\u201d\uff0c\u4ee5\u6b64\u985e\u63a8\u3002\u5b83\u5011\u5305\u542b\u4e00\u500b\u5177\u6709\u5217\u540d\u7a31\u7684\u6a19\u984c\u884c\u548c\u4e00\u500b\u5305\u542b\u8fd4\u56de\u7684\u5404\u500b\u9810\u6e2c\u7d50\u679c\u7684\u884c\u3002\u9810\u6e2c\u503c\u7684\u6578\u91cf\u53d6\u6c7a\u65bc\u9810\u6e2c\u8f38\u5165\u548c\u9810\u6e2c\u7bc4\u570d\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8f38\u5165\u5305\u542b\u76ee\u6a19\u5217\u7684 14 \u500b\u7a7a\u689d\u76ee\uff08\u4f8b\u5982\u672a\u4f86 14 \u5929\u7684\u92b7\u552e\u984d\uff09\uff0c\u5247\u9810\u6e2c\u8acb\u6c42\u5c07\u8fd4\u56de 14 \u884c\uff0c\u5373\u6bcf\u5929\u7684\u92b7\u552e\u984d\u3002\u5982\u679c\u9810\u6e2c\u8acb\u6c42\u8d85\u51fa\u6a21\u578b\u7684\u9810\u6e2c\u7bc4\u570d\uff0c\u5247 Vertex AI \u50c5\u6703\u8fd4\u56de\u8a72\u9810\u6e2c\u7bc4\u570d\u5167\u7684\u9810\u6e2c\u7d50\u679c\u3002\u9810\u6e2c\u503c\u6703\u5728\u540d\u7232\u201cpredicted_ \u201d\u7684\u5217\u4e2d\u8fd4\u56de\u3002\u5c0d\u65bc\u5206\u4f4d\u6578\u9810\u6e2c\uff0c\u8f38\u51fa\u5217\u5305\u542b\u63a1\u7528 JSON \u683c\u5f0f\u7684\u5206\u4f4d\u6578\u9810\u6e2c\u7d50\u679c\u548c\u5206\u4f4d\u6578\u503c\u3002\n- **\u932f\u8aa4\u5c0d\u8c61** \u932f\u8aa4\u5c0d\u8c61\u7684\u540d\u7a31\u7232\u201cerrors_1.csv\u201d\u201cerrors_2.csv\u201d\uff0c\u4ee5\u6b64\u985e\u63a8\u3002\u5b83\u5011\u5305\u542b\u4e00\u500b\u6a19\u984c\u884c\uff0c\u9084\u5305\u542b\u8f38\u5165\u6578\u64da\u4e2d Vertex AI \u7121\u6cd5\u91dd\u5c0d\u5176\u8fd4\u56de\u9810\u6e2c\u7d50\u679c\uff08\u4f8b\u5982\uff0c\u5982\u679c\u4e0d\u53ef\u7232 Null \u7684\u7279\u5fb5\u7232 Null\uff09\u7684\u6bcf\u4e00\u884c\u3002\n\u6ce8\u610f\uff1a\u5982\u679c\u7d50\u679c\u8f03\u5927\uff0c\u5247\u6703\u62c6\u5206\u7232\u591a\u500b\u5c0d\u8c61\u3002\n## BigQuery \u4e2d\u7684\u7279\u5fb5\u6b78\u56e0\u67e5\u8a62\u793a\u4f8b\n### \u793a\u4f8b 1\uff1a\u78ba\u5b9a\u55ae\u500b\u9810\u6e2c\u7684\u6b78\u56e0\n\u8acb\u8003\u616e\u4ee5\u4e0b\u554f\u984c\uff1a\n\u5c0d\u61c9\u7684\u67e5\u8a62\u5982\u4e0b\u6240\u793a\uff1a\n```\nSELECT\n * EXCEPT(explanation, predicted_sales),\n ROUND(predicted_sales.value, 2) AS predicted_sales,\n ROUND(\n explanation.attributions[OFFSET(0)].featureAttributions.advertisement,\n 2\n ) AS attribution_advertisement\nFROM\n `project.dataset.predictions`\nWHERE\n product = 'product_0'\n AND store = 'store_0'\n AND date = '2019-11-24'\n```### \u793a\u4f8b 2\uff1a\u78ba\u5b9a\u5168\u5c40\u7279\u5fb5\u91cd\u8981\u6027\n\u8acb\u8003\u616e\u4ee5\u4e0b\u554f\u984c\uff1a\n\u53ef\u4ee5\u901a\u904e\u805a\u5408\u5c40\u90e8\u7279\u5fb5\u91cd\u8981\u6027\u6b78\u56e0\u4f86\u624b\u52d5\u8a08\u7b97\u5168\u5c40\u7279\u5fb5\u91cd\u8981\u6027\u3002\u5c0d\u61c9\u7684\u67e5\u8a62\u5982\u4e0b\u6240\u793a\uff1a\n```\nWITH\n/*\n* Aggregate from (id, date) level attributions to global feature importance.\n*/\nattributions_aggregated AS (\n SELECT\n SUM(ABS(attributions.featureAttributions.date)) AS date,\n SUM(ABS(attributions.featureAttributions.advertisement)) AS advertisement,\n SUM(ABS(attributions.featureAttributions.holiday)) AS holiday,\n SUM(ABS(attributions.featureAttributions.sales)) AS sales,\n SUM(ABS(attributions.featureAttributions.store)) AS store,\n SUM(ABS(attributions.featureAttributions.product)) AS product,\n FROM\n project.dataset.predictions,\n UNNEST(explanation.attributions) AS attributions\n),\n/*\n* Calculate the normalization constant for global feature importance.\n*/\nattributions_aggregated_with_total AS (\n SELECT\n *,\n date + advertisement + holiday + sales + store + product AS total\n FROM\n attributions_aggregated\n)\n/*\n* Calculate the normalized global feature importance.\n*/\nSELECT\n ROUND(date / total, 2) AS date,\n ROUND(advertisement / total, 2) AS advertisement,\n ROUND(holiday / total, 2) AS holiday,\n ROUND(sales / total, 2) AS sales,\n ROUND(store / total, 2) AS store,\n ROUND(product / total, 2) AS product,\nFROM\n attributions_aggregated_with_total\n```\n## BigQuery \u4e2d\u7684\u6279\u91cf\u9810\u6e2c\u8f38\u51fa\u793a\u4f8b\n\u5728\u9152\u985e\u92b7\u552e\u6578\u64da\u96c6\u793a\u4f8b\u4e2d\uff0c\u201cIda Grove\u201d\u5e02\u6709\u56db\u5bb6\u5546\u5e97\uff1a\u201cIda Grove Food Pride\u201d\u201cDiscount Liquors of Ida Grove\u201d\u201cCasey's General Store #3757\u201d\u548c\u201cBrew Ida Grove\u201d\u3002 `store_name` \u7232 `series identifier` \uff0c\u56db\u5bb6\u5546\u5e97\u4e2d\u7684\u4e09\u5bb6\u8acb\u6c42\u91dd\u5c0d\u76ee\u6a19\u5217 `sale_dollars` \u9032\u884c\u9810\u6e2c\u3002\u7531\u65bc\u201cDiscount Liquors of Ida Grove\u201d\u6c92\u6709\u8acb\u6c42\u9810\u6e2c\uff0c\u56e0\u6b64\u4fc2\u7d71\u6703\u751f\u6210\u9a57\u8b49\u932f\u8aa4\u3002\n\u4ee5\u4e0b\u662f\u5f9e\u7528\u65bc\u9810\u6e2c\u7684\u8f38\u5165\u6578\u64da\u96c6\u4e2d\u63d0\u53d6\u7684\u5167\u5bb9\uff1a\n\u4ee5\u4e0b\u662f\u5f9e\u9810\u6e2c\u7d50\u679c\u4e2d\u63d0\u53d6\u7684\u5167\u5bb9\uff1a\n\u4ee5\u4e0b\u662f\u5f9e\u9a57\u8b49\u932f\u8aa4\u4e2d\u63d0\u53d6\u7684\u5167\u5bb9\uff1a\n### \u91dd\u5c0d\u5206\u4f4d\u6578\u640d\u5931\u9032\u884c\u512a\u5316\u7684\u6a21\u578b\u7684\u6279\u91cf\u9810\u6e2c\u8f38\u51fa\u793a\u4f8b\n\u4ee5\u4e0b\u793a\u4f8b\u662f\u91dd\u5c0d\u5206\u4f4d\u6578\u640d\u5931\u9032\u884c\u512a\u5316\u7684\u6a21\u578b\u7684\u6279\u91cf\u9810\u6e2c\u8f38\u51fa\u3002\u5728\u6b64\u5834\u666f\u4e2d\uff0c\u9810\u6e2c\u6a21\u578b\u9810\u6e2c\u4e86\u6bcf\u5bb6\u5546\u5e97\u672a\u4f86 14 \u5929\u7684\u92b7\u552e\u984d\u3002\n\u5206\u4f4d\u6578\u503c\u5728 `predicted_Sales.quantile_values` \u5217\u4e2d\u63d0\u4f9b\u3002 \u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u6a21\u578b\u9810\u6e2c\u4e86 `0.1` \u3001 `0.5` \u548c `0.9` \u5206\u4f4d\u6578\u7684\u503c\u3002\n\u9810\u6e2c\u503c\u5728 `predicted_Sales.quantile_predictions` \u5217\u4e2d\u63d0\u4f9b\u3002\u9019\u662f\u4e00\u7d44\u92b7\u552e\u503c\uff0c\u6620\u5c04\u5230 `predicted_Sales.quantile_values` \u5217\u4e2d\u7684\u5206\u4f4d\u6578\u503c\u3002\u5728\u7b2c\u4e00\u884c\u4e2d\uff0c\u6211\u5011\u770b\u5230\u92b7\u552e\u50f9\u503c\u4f4e\u65bc `4484.04` \u7684\u6982\u7387\u7232 10%\u3002\u92b7\u552e\u50f9\u503c\u4f4e\u65bc `5615.64` \u7684\u6982\u7387\u7232 50%\u3002\u92b7\u552e\u50f9\u503c\u4f4e\u65bc `6853.29` \u7684\u6982\u7387\u7232 90%\u3002\u7b2c\u4e00\u884c\u7684\u9810\u6e2c\uff08\u8868\u793a\u7232\u55ae\u500b\u503c\uff09\u7232 `5615.64` \u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3 [\u6279\u91cf\u9810\u6e2c\u7684\u50f9\u683c](https://cloud.google.com/vertex-ai/docs/tabular-data/tabular-workflows/pricing?hl=zh-cn) \u3002", "guide": "Vertex AI"}