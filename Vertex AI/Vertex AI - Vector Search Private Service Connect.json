{"title": "Vertex AI - Vector Search Private Service Connect", "url": "https://cloud.google.com/vertex-ai/docs/start/introduction-unified-platform", "abstract": "# Vertex AI - Vector Search Private Service Connect\n**    Preview     ** This product or feature is subject to the \"Pre-GA Offerings Terms\" in the General Service Terms section   of the [Service Specific Terms](/terms/service-terms#1) .     Pre-GA products and features are available \"as is\" and might have limited support.    For more information, see the [launch stage descriptions](/products#product-launch-stages) .\nPrivate Service Connect allows private consumption of services across VPC networks that belong to different groups, teams, projects, or organizations. You can publish and consume services using IP addresses that you define and that are internal to your VPC network, and for Vector Search endpoints to perform vector similarity searches.\nEnabling Private Service Connect on a Vector Search endpoint is suited for use cases that:\n- Require low latency and a secure connection to Vector Search serving backends.\n- Have limited IP space for exclusive VPC peering reservation.\n- Need to access the serving backends from multiple user VPC networks.\nTo learn more about setting up Private Service Connect, see the [Private Service Connect Overview](/vpc/docs/private-service-connect) from the Virtual Private Cloud (VPC) documentation.\n", "content": "## Create the index endpoint\nTo create an endpoint with Private Service Connect enabled you must define it when you create the endpoint. This is similar to creating other endpoints in Vertex AI.\n: The service project where you are creating Vertex AI resources.\n: The project where your client VPC lives. For simple VPC setup, this will be the same as $PROJECT. For shared VPC setup, this will be the VPC host project.\n```\nPROJECT=<your-service-project>VPC_PROJECT=<your-vpc-project>REGION=us-central1VERTEX_ENDPOINT=$REGION-aiplatform.googleapis.comcurl -H \"Content-Type: application/json\" \\\u00a0 -H \"Authorization: Bearer `gcloud auth print-access-token`\" \\\u00a0 https://$VERTEX_ENDPOINT/v1/projects/$PROJECT/locations/$REGION/indexEndpoints \\\u00a0 -d '{displayName: \"<your-index-endpoint-name>\", privateServiceConnectConfig:\u00a0 { enablePrivateServiceConnect: true, projectAllowlist: [\"'$VPC_PROJECT'\", \"'$PROJECT'\"] }}'\n```\n## Deploy the index\nNow that the index is ready, in this step, you deploy the index to the endpoint you created with Private Service Connect enabled.\n{\nThis example uses the\n [gcloud ai index-endpoints deploy-indexcommand](/sdk/gcloud/reference/ai/index-endpoints/deploy-index) \n.\nBefore using any of the command data below, make the following replacements:- : The ID of the index endpoint.\n- : A user specified string to uniquely identify the deployed index. It must start with a letter and contain only letters, numbers or underscores. See [DeployedIndex.id](https://cloud.google.com/vertex-ai/docs/reference/rpc/google.cloud.aiplatform.v1#google.cloud.aiplatform.v1.DeployedIndex) for format guidelines.\n- : Display name of the deployed index endpoint.\n- : The ID of the index.\n- : The region where you are using Vertex AI.\n- : Your Google Cloud [project ID](/resource-manager/docs/creating-managing-projects#identifiers) .\nExecute the  following  command:Before using any of the request data, make the following replacements:- : The ID of the index endpoint.\n- : A user specified string to uniquely identify the deployed index. It must start with a letter and contain only letters, numbers or underscores. See [DeployedIndex.id](https://cloud.google.com/vertex-ai/docs/reference/rpc/google.cloud.aiplatform.v1#google.cloud.aiplatform.v1.DeployedIndex) for format guidelines.\n- : Display name of the deployed index endpoint.\n- : The ID of the index.\n- : The region where you are using Vertex AI.\n- : Your Google Cloud [project ID](/resource-manager/docs/creating-managing-projects#identifiers) .\n- : Your project's automatically generated [project number](/resource-manager/docs/creating-managing-projects#identifiers) .\nHTTP method and URL:\n```\nPOST https://LOCATION-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/indexEndpoints/INDEX_ENDPOINT_ID:deployIndex\n```\nRequest JSON body:\n```\n{\n \"deployedIndex\": {\n \"id\": \"DEPLOYED_INDEX_ID\",\n \"index\": \"projects/PROJECT_ID/locations/LOCATION/indexes/INDEX_ID\",\n \"displayName\": \"DEPLOYED_INDEX_ENDPOINT_NAME\"\n }\n}\n```\nTo send your request, expand one of these options:You should receive a JSON response similar to the following:\n```\n{\n \"name\": \"projects/PROJECT_NUMBER/locations/LOCATION/indexEndpoints/INDEX_ENDPOINT_ID/operations/OPERATION_ID\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.aiplatform.v1.DeployIndexOperationMetadata\",\n \"genericMetadata\": {\n  \"createTime\": \"2022-10-19T17:53:16.502088Z\",\n  \"updateTime\": \"2022-10-19T17:53:16.502088Z\"\n },\n \"deployedIndexId\": \"DEPLOYED_INDEX_ID\"\n }\n}\n```\nUse these instructions to deploy your index.- In the Vertex AI section of the Google Cloud console, go to  the **Deploy and Use** section. Select **Vector Search** [Go to  Vector Search](https://console.cloud.google.com/vertex-ai/matching-engine/indexes) \n- A list of your active indexes is displayed.\n- Select the name of the index you want to deploy. The index details page opens.\n- From the index details page, click **add_box\n  Deploy to endpoint** . The index deployment panel opens.\n- Enter a display name - this name acts as an ID and can't be updated.\n- From the **Endpoint** drop-down, select the endpoint you want to deploy this index to.  Note: The endpoint is unavailable if the index is already deployed to it.\n- Optional: In the **Machine type** field, select either standard or high-memory.\n- Optional. Select **Enable autoscaling** to automatically resize the  number of nodes based on the demands of your workloads. The default number  of replicas is 2 if autoscaling is disabled.\n- Click **Deploy** to deploy your index to the endpoint. Note: It takes around 30 minutes to be deployed.\n## Create a forwarding rule in the VPC project\nAfter index deployment is done, the index endpoint returns a service attachment URI of an IP address. You need to create a forwarding rule in the VPC project targeting the service attachment. To create a forwarding rule, use the following example:\n```\ngcloud compute addresses create ${ADDRESS_NAME:?} \\\u00a0 \u00a0 --region=${REGION:?} \\\u00a0 \u00a0 --subnet=${SUBNET_NAME:?} \\\u00a0 \u00a0 --project=${VPC_PROJECT:?}SERVICE_ATTACHMENT_URI=`gcloud ai index-endpoints describe {INDEX_ENDPOINT_ID}--format=\"value(deployedIndexes.privateEndpoints.serviceAttachment)\"`gcloud compute forwarding-rules create ${ENDPOINT_NAME:?} \\\u00a0 \u00a0 --network=${NETWORK_NAME:?} \\\u00a0 \u00a0 --address=${ADDRESS_NAME:?} \\\u00a0 \u00a0 --target-service-attachment=${SERVICE_ATTACHMENT_URI:?} \\\u00a0 \u00a0 --project=${VPC_PROJECT:?} \\\u00a0 \u00a0 --region=${REGION:?}\n```\n### (Optional) Create DNS record for the IP address\nIf you want to connect and load without memorizing the actual IP address, you can create a DNS record. This step is optional.\n```\nDNS_NAME_SUFFIX=matchingengine.vertexai.goog. # Don't forget the \".\" in the end.DNS_NAME=${INDEX_ENDPOINT_ID:?}.${REGION:?}.${DNS_NAME_SUFFIX:?}gcloud dns managed-zones create ${DNS_ZONE_NAME:?} \\\u00a0 \u00a0 --dns-name=${DNS_NAME_SUFFIX:?} \\\u00a0 \u00a0 --visibility=private \\\u00a0 \u00a0 --project=${VPC_PROJECT:?} \\\u00a0 \u00a0 --region=${REGION:?}gcloud dns record-sets create ${DNS_NAME:?} \\\u00a0 \u00a0 --rrdatas=${IP_ADDRESS:?} \\\u00a0 \u00a0 --type=A --ttl=60 \\\u00a0 \u00a0 --zone=${DNS_ZONE_NAME:?} \\\u00a0 \u00a0 --project=${VPC_PROJECT:?} \\\u00a0 \u00a0 --region=${REGION:?}\n```\n## Send queries to the index endpoint\nNow that you've created an endpoint with Private Service Connect and created the index, you can begin running queries.\nTo query your index, see [Query indexes to get nearest neighbors](/vertex-ai/docs/vector-search/query-index-vpc) .\n## What's next\n- Learn how to [Update and rebuild your index](/vertex-ai/docs/vector-search/update-rebuild-index) \n- Learn how to [Monitor the index endpoint](/vertex-ai/docs/vector-search/monitor)", "guide": "Vertex AI"}