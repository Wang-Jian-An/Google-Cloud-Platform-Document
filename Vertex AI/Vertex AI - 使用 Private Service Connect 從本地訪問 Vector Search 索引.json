{"title": "Vertex AI - \u4f7f\u7528 Private Service Connect \u5f9e\u672c\u5730\u8a2a\u554f Vector Search \u7d22\u5f15", "url": "https://cloud.google.com/vertex-ai/docs/general/vertex-psc-vector-search?hl=zh-cn", "abstract": "# Vertex AI - \u4f7f\u7528 Private Service Connect \u5f9e\u672c\u5730\u8a2a\u554f Vector Search \u7d22\u5f15\n\u672c\u5730\u4e3b\u6a5f\u53ef\u4ee5\u901a\u904e\u5169\u7a2e\u65b9\u5f0f\u8a2a\u554f Vector Search \u7d22\u5f15\u7aef\u9ede\uff1a\u516c\u5171\u4e92\u806f\u7db2\uff0c\u6216\u901a\u904e Cloud VPN \u6216 Cloud Interconnect \u4f7f\u7528 Private Service Connect (PSC) \u7684\u6df7\u5408\u7db2\u7d61\u67b6\u69cb\uff08\u4ee5\u79c1\u5bc6\u65b9\u5f0f\u8a2a\u554f\uff09\u3002\u9019\u5169\u500b\u9078\u9805\u90fd\u63d0\u4f9b SSL/TLS \u52a0\u5bc6\u3002\u4f46\u662f\uff0c\u5c08\u7528\u9078\u9805\u53ef\u63d0\u4f9b\u66f4\u597d\u7684\u6027\u80fd\uff0c\u56e0\u6b64\u5efa\u8b70\u7528\u65bc\u95dc\u9375\u61c9\u7528\u3002\n\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528\u9ad8\u53ef\u7528\u6027 VPN (HA VPN) \u5728\u53ef\u7528\u4f5c\u591a\u96f2\u548c\u672c\u5730\u5c08\u7528\u9023\u63a5\u57fa\u790e\u7684\u5169\u500b\u865b\u64ec\u79c1\u6709\u4e91 (VPC) \u7db2\u7d61\u4e4b\u9593\u4ee5\u79c1\u5bc6\u65b9\u5f0f\u8a2a\u554f Vector Search \u7d22\u5f15\u7aef\u9ede\u3002\n\u672c\u6559\u7a0b\u9069\u7528\u65bc\u719f\u6089 Vertex AI\u3001\u865b\u64ec\u79c1\u6709\u4e91\u3001Google Cloud \u63a7\u5236\u6aaf\u548c [Cloud Shell](https://cloud.google.com/shell/docs/how-cloud-shell-works?hl=zh-cn) \u7684\u4f01\u696d\u7db2\u7d61\u7ba1\u7406\u54e1\u3001\u6578\u64da\u79d1\u5b78\u5bb6\u548c\u7814\u7a76\u4eba\u54e1\u3002\u719f\u6089 [Vector Search](https://cloud.google.com/vertex-ai/docs/vector-search/overview?hl=zh-cn) \u6703\u5f88\u6709\u5e6b\u52a9\uff0c\u4f46\u4e0d\u5f37\u5236\u8981\u6c42\u3002\n **\u6ce8\u610f** \uff1a\u60a8\u5275\u5efa\u7684 Vector Search \u7d22\u5f15\u7aef\u9ede\u662f\u516c\u5171\u7aef\u9ede\u3002\u5728\u751f\u7522\u74b0\u5883\u4e2d\uff0c\u60a8\u5c07 [\u4f7f\u7528 VPC Service Controls \u5275\u5efa\u5b89\u5168\u908a\u754c](https://cloud.google.com/vertex-ai/docs/general/vpc-service-controls?hl=zh-cn) \uff0c\u4ee5\u5141\u8a31\u6216\u62d2\u7d55\u901a\u904e\u516c\u5171\u4e92\u806f\u7db2\u8a2a\u554f Vector Search \u7d22\u5f15\u7aef\u9ede\u4e0a\u7684 Vertex AI \u548c\u5176\u4ed6 Google API\u3002\u672c\u6559\u7a0b\u672a\u4ecb\u7d39\u5982\u4f55\u5c07 VPC Service Controls \u8207 Vertex AI \u642d\u914d\u4f7f\u7528\u3002", "content": "## \u76ee\u6a19\n- \u5275\u5efa\u5169\u500b VPC \u7db2\u7d61\uff0c\u5982\u4e0a\u5716\u6240\u793a\uff1a- \u4e00\u500b (`onprem-vpc`) \u8868\u793a\u4e00\u500b\u672c\u5730\u7db2\u7d61\u3002\n- \u53e6\u4e00\u500b (`vertex-networking-vpc`) \u7528\u65bc Vector Search \u7d22\u5f15\u7aef\u9ede\u3002\n- \u90e8\u7f72\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\u3001Cloud VPN \u96a7\u9053\u548c Cloud Router \u8def\u7531\u5668\uff0c\u4ee5\u9023\u63a5`vertex-networking-vpc`\u548c`onprem-vpc`\u3002\n- \u69cb\u5efa\u548c\u90e8\u7f72 Vector Search \u7d22\u5f15\u3002\n- \u5275\u5efa Private Service Connect (PSC) \u7aef\u9ede\uff0c\u4ee5\u5c07\u67e5\u8a62\u8f49\u767c\u5230 Vector Search \u7d22\u5f15\u7aef\u9ede\u3002\n- \u5728`vertex-networking-vpc`\u4e2d\u914d\u7f6e Cloud Router \u8def\u7531\u5668\u81ea\u5b9a\u7fa9\u8def\u7531\u901a\u544a\uff0c\u4ee5\u5411`onprem-vpc`\u901a\u544a Private Service Connect \u7aef\u9ede\u7684\u8def\u7531\u3002\n- \u5728`onprem-vpc`\u4e2d\u5275\u5efa Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u4ee5\u8868\u793a\u901a\u904e\u9ad8\u53ef\u7528\u6027 VPN \u5411 Vector Search \u7d22\u5f15\u7aef\u9ede\u767c\u9001\u8acb\u6c42\u7684\u5ba2\u6236\u7aef\u61c9\u7528\u3002\n## \u8cbb\u7528\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Google Cloud \u7684\u4ee5\u4e0b\u6536\u8cbb\u7d44\u4ef6\uff1a- [Cloud NAT](https://cloud.google.com/nat/pricing?hl=zh-cn) \n- [Cloud Storage](https://cloud.google.com/storage/pricing?hl=zh-cn) \n- [Cloud VPN](https://cloud.google.com/network-connectivity/pricing?hl=zh-cn#vpn-pricing) \n- [Compute Engine](https://cloud.google.com/compute/all-pricing?hl=zh-cn) \n- [Vertex AI](https://cloud.google.com/vertex-ai/pricing?hl=zh-cn) \n- [Virtual Private Cloud](https://cloud.google.com/vpc/pricing?hl=zh-cn) \n\u60a8\u53ef\u4f7f\u7528 [\u50f9\u683c\u8a08\u7b97\u5668](https://cloud.google.com/products/calculator?hl=zh-cn) \u6839\u64da\u60a8\u7684\u9810\u8a08\u4f7f\u7528\u60c5\u6cc1\u4f86\u4f30\u7b97\u8cbb\u7528\u3002 \nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5b8c\u6210\u672c\u6587\u6a94\u4e2d\u63cf\u8ff0\u7684\u4efb\u52d9\u5f8c\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u522a\u9664\u6240\u5275\u5efa\u7684\u8cc7\u6e90\u4f86\u907f\u514d\u7e7c\u7e8c\u8a08\u8cbb\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e05\u7406](#clean-up) \u3002## \u9808\u77e5\u4e8b\u9805\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud Console \u4e2d\uff0c\u8f49\u5230\u9805\u76ee\u9078\u64c7\u5668\u9801\u9762\u3002 [\u8f49\u5230\u201c\u9805\u76ee\u9078\u64c7\u5668\u201d](https://console.cloud.google.com/projectselector2/home/dashboard?hl=zh-cn) \n- \u9078\u64c7\u6216\u5275\u5efa Google Cloud \u9805\u76ee\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- [\u78ba\u4fdd\u60a8\u7684 Google Cloud \u9805\u76ee\u5df2\u5553\u7528\u7d50\u7b97\u529f\u80fd](https://cloud.google.com/billing/docs/how-to/verify-billing-enabled?hl=zh-cn#console) \u3002\n- \u6253\u958b [Cloud Shell](https://cloud.google.com/shell/docs/launching-cloud-shell-editor?hl=zh-cn) \u4ee5\u57f7\u884c\u672c\u6559\u7a0b\u4e2d\u5217\u51fa\u7684\u547d\u4ee4\u3002Cloud Shell \u662f Google Cloud \u7684\u4ea4\u4e92\u5f0f Shell \u74b0\u5883\uff0c\u53ef\u8b93\u60a8\u901a\u904e\u7db2\u7d61\u700f\u89bd\u5668\u7ba1\u7406\u9805\u76ee\u548c\u8cc7\u6e90\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u5c07\u7576\u524d\u9805\u76ee\u8a2d\u7f6e\u7232\u60a8\u7684 Google Cloud \u9805\u76ee ID\uff0c\u4e26\u5c07\u540c\u4e00\u9805\u76ee ID \u5b58\u5132\u5728`projectid`shell \u8b8a\u91cf\u4e2d\uff1a```\n projectid=\"PROJECT_ID\"\n gcloud config set project ${projectid}\n```\u5c07\u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\u5982\u6709\u5fc5\u8981\uff0c\u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u67e5\u627e\u9805\u76ee ID\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u67e5\u627e\u9805\u76ee ID](https://cloud.google.com/vertex-ai/docs/tutorials/tabular-bq-prediction/prerequisites?hl=zh-cn#find-project-id) \n- \u5982\u679c\u60a8\u4e0d\u662f\u9805\u76ee\u6240\u6709\u8005\uff0c\u8acb\u8b93\u9805\u76ee\u6240\u6709\u8005\u7232\u60a8\u6388\u4e88 [Project IAM Admin (roles/resourcemanager.projectIamAdmin)](https://cloud.google.com/resource-manager/docs/access-control-proj?hl=zh-cn#resourcemanager.projectIamAdmin) \u89d2\u8272\u3002\u60a8\u5fc5\u9808\u5177\u6709\u6b64\u89d2\u8272\u624d\u80fd\u5728\u4e0b\u4e00\u6b65\u4e2d\u6388\u4e88 IAM \u89d2\u8272\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5411\u60a8\u7684 Google \u8cec\u865f\u6388\u4e88\u89d2\u8272\u3002\u5c0d\u4ee5\u4e0b\u6bcf\u500b IAM \u89d2\u8272\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e00\u6b21\uff1a `roles/aiplatform.user\u3001roles/compute.instanceAdmin.v1\u3001roles/compute.networkAdmin\u3001roles/compute.securityAdmin\u3001roles/dns.admin\u3001roles/iam.serviceAccountAdmin\u3001roles/iam.serviceAccountUser\u3001roles/iap.admin\u3001roles/iap.tunnelResourceAccessor\u3001roles/notebooks.admin\u3001roles/servicemanagement.quotaAdmin\u3001roles/servicedirectory.editor\u3001roles/storage.admin````\ngcloud projects add-iam-policy-binding PROJECT_ID --member=\"user:EMAIL_ADDRESS\" --role=ROLE\n```- \u5c07``\u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\n- \u5c07``\u66ff\u63db\u7232\u60a8\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\u3002\n- \u5c07``\u66ff\u63db\u7232\u6bcf\u500b\u89d2\u8272\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- Enable the DNS\u3001IAM\u3001Compute Engine\u3001Notebooks \u548c Vertex AI APIs:```\ngcloud services enable dns.googleapis.com iam.googleapis.com compute.googleapis.com notebooks.googleapis.com aiplatform.googleapis.com\n```\n## \u5275\u5efa VPC \u7db2\u7d61\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u5169\u500b VPC \u7db2\u7d61\uff1a\u4e00\u500b\u7528\u65bc\u5275\u5efa Vector Search \u7d22\u5f15\u4e26\u5c07\u5176\u90e8\u7f72\u5230\u7aef\u9ede\uff0c\u53e6\u4e00\u500b\u7528\u65bc\u5c0d\u8a72\u7aef\u9ede\u9032\u884c\u5c08\u7528\u8a2a\u554f\u3002\n### \u7232 Vector Search \u7d22\u5f15\u7aef\u9ede\u5275\u5efa VPC \u7db2\u7d61 (vertex-networking-vpc)\n- \u7232\u7d22\u5f15\u7aef\u9ede\u5275\u5efa VPC \u7db2\u7d61\uff1a```\ngcloud compute networks create vertex-networking-vpc --project=$projectid --subnet-mode custom\n```\n- \u5275\u5efa\u4e00\u500b\u540d\u7232 `workbench-subnet` \u7684\u5b50\u7db2\uff0c\u5176\u4e3b\u8981 IPv4 \u7bc4\u570d\u7232 `172.16.20.0/28` \uff1a```\ngcloud compute networks subnets create workbench-subnet \\\u00a0 --project=$projectid --range=172.16.20.0/28 \\\u00a0 --network=vertex-networking-vpc \\\u00a0 --region=us-central1 \\\u00a0 --enable-private-ip-google-access\n```\n- \u5275\u5efa\u4e00\u500b\u540d\u7232 `consumer-endpoint-subnet` \u7684\u5b50\u7db2\uff0c\u5176\u4e3b\u8981 IPv4 \u7bc4\u570d\u7232 `172.16.30.0/28` \uff1a```\ngcloud compute networks subnets create consumer-endpoint-subnet \\\u00a0 --project=$projectid \\\u00a0 --range=172.16.30.0/28 \\\u00a0 --network=vertex-networking-vpc \\\u00a0 --region=us-central1 \\\u00a0 --enable-private-ip-google-access\n```\n### \u5275\u5efa\u7528\u65bc\u5c0d\u7aef\u9ede\u9032\u884c\u5c08\u7528\u8a2a\u554f\u7684 VPC \u7db2\u7d61 (onprem-vpc)\n- \u5275\u5efa\u7528\u65bc\u6a21\u64ec\u672c\u5730\u7db2\u7d61\u7684 VPC \u7db2\u7d61 ( `onprem-vpc` )\uff1a```\ngcloud compute networks create onprem-vpc \\\u00a0 --subnet-mode custom\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `onprem-vpc-subnet1` \u7684\u5b50\u7db2\uff0c\u5176\u4e3b\u8981 IPv4 \u7bc4\u570d\u7232 `172.16.10.0/29` \uff1a```\ngcloud compute networks subnets create onprem-vpc-subnet1 \\\u00a0 --network onprem-vpc \\\u00a0 --range 172.16.10.0/29 \\\u00a0 --region us-central1\n```\n### \u9a57\u8b49 VPC \u7db2\u7d61\u662f\u5426\u5df2\u6b63\u78ba\u914d\u7f6e\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **VPC \u7db2\u7d61** \u9801\u9762\u4e2d\u7684 **\u7576\u524d\u9805\u76ee\u4e2d\u7684\u7db2\u7d61** \u6a19\u7c64\u9801\u3002 [\u9032\u5165 VPC \u7db2\u7d61\u9801\u9762](https://console.cloud.google.com/networking/networks/list?pageTab=CURRENT_PROJECT_NETWORKS&hl=zh-cn) \n- \u5728 VPC \u7db2\u7d61\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa `vertex-networking-vpc` \u548c `onprem-vpc` \u9019\u5169\u500b\u7db2\u7d61\u3002\n- \u9ede\u64ca **\u7576\u524d\u9805\u76ee\u4e2d\u7684\u5b50\u7db2** \u6a19\u7c64\u9801\u3002\n- \u5728 VPC \u5b50\u7db2\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa `workbench-subnet` \u3001 `consumer-endpoint-subnet` \u548c `onprem-vpc-subnet1` \u5b50\u7db2\u3002\n### \u5275\u5efa on-prem-client \u865b\u64ec\u6a5f\u5be6\u4f8b\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u4e00\u500b\u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u4ee5\u8868\u793a\u901a\u904e\u9ad8\u53ef\u7528\u6027 VPN \u5411 Vector Search \u7d22\u5f15\u7aef\u9ede\u767c\u9001\u8acb\u6c42\u7684\u5ba2\u6236\u7aef\u61c9\u7528\u3002- \u5728 Cloud Shell \u4e2d\uff0c\u5275\u5efa `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a```\ngcloud compute instances create on-prem-client \\\u00a0 --zone=us-central1-a \\\u00a0 --image-family=debian-11 \\\u00a0 --image-project=debian-cloud \\\u00a0 --subnet=onprem-vpc-subnet1 \\\u00a0 --scopes=https://www.googleapis.com/auth/cloud-platform \\\u00a0 --no-address \\\u00a0 --shielded-secure-boot \\\u00a0 --metadata startup-script=\"#! /bin/bash\u00a0 \u00a0 sudo apt-get update\u00a0 \u00a0 sudo apt-get install tcpdump dnsutils -y\"\n```\n## \u914d\u7f6e\u6df7\u5408\u9023\u63a5\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u5169\u500b\u76f8\u4e92\u9023\u63a5\u7684\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\u3002\u4e00\u500b\u4f4d\u65bc `vertex-networking-vpc` VPC \u7db2\u7d61\u4e2d\u3002\u53e6\u4e00\u500b\u4f4d\u65bc `onprem-vpc` VPC \u7db2\u7d61\u4e2d\u3002\u6bcf\u500b\u7db2\u95dc\u5305\u542b\u4e00\u500b Cloud Router \u8def\u7531\u5668\u548c\u4e00\u5c0d VPN \u96a7\u9053\u3002\n### \u5275\u5efa\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\n- \u5728 Cloud Shell \u4e2d\uff0c\u7232 `vertex-networking-vpc` VPC \u7db2\u7d61\u5275\u5efa\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\uff1a```\ngcloud compute vpn-gateways create vertex-networking-vpn-gw1 \\\u00a0 \u00a0--network vertex-networking-vpc \\\u00a0 \u00a0--region us-central1\n```\n- \u7232 `onprem-vpc` VPC \u7db2\u7d61\u5275\u5efa\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\uff1a```\ngcloud compute vpn-gateways create onprem-vpn-gw1 \\\u00a0 \u00a0--network onprem-vpc \\\u00a0 \u00a0--region us-central1\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 **VPN** \u9801\u9762\u4e2d\u7684 **Cloud VPN \u7db2\u95dc** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230 VPN](https://console.cloud.google.com/hybrid/vpn?tab=gateways&hl=zh-cn) \n- \u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa\u5169\u500b\u7db2\u95dc\uff08 `vertex-networking-vpn-gw1` \u548c `onprem-vpn-gw1` \uff09\uff0c\u4e26\u4e14\u6bcf\u500b\u7db2\u95dc\u5177\u6709\u5169\u500b\u63a5\u53e3 IP \u5730\u5740\u3002\n### \u5275\u5efa Cloud Router \u8def\u7531\u5668\u548c Cloud NAT \u7db2\u95dc\u5728\u5169\u500b VPC \u7db2\u7d61\u4e2d\uff0c\u60a8\u90fd\u5c07\u5275\u5efa\u5169\u500b Cloud Router \u8def\u7531\u5668\uff1a\u4e00\u500b\u901a\u7528\u8def\u7531\u5668\u548c\u4e00\u500b\u5340\u57df\u7d1a\u8def\u7531\u5668\u3002\u5728\u6bcf\u500b\u5340\u57df\u7d1a Cloud Router \u8def\u7531\u5668\u4e2d\uff0c\u60a8\u90fd\u5c07\u5275\u5efa\u4e00\u500b Cloud NAT \u7db2\u95dc\u3002Cloud NAT \u7db2\u95dc\u7232\u6c92\u6709\u5916\u90e8 IP \u5730\u5740\u7684 Compute Engine \u865b\u64ec\u6a5f (VM) \u5be6\u4f8b\u63d0\u4f9b\u50b3\u51fa\u9023\u63a5\u3002- \u5728 Cloud Shell \u4e2d\uff0c\u7232 `vertex-networking-vpc` VPC \u7db2\u7d61\u5275\u5efa\u4e00\u500b Cloud Router \u8def\u7531\u5668\uff1a```\ngcloud compute routers create vertex-networking-vpc-router1 \\\u00a0 \u00a0--region us-central1\\\u00a0 \u00a0--network vertex-networking-vpc \\\u00a0 \u00a0--asn 65001\n```\n- \u7232 `onprem-vpc` VPC \u7db2\u7d61\u5275\u5efa\u4e00\u500b Cloud Router \u8def\u7531\u5668\uff1a```\ngcloud compute routers create onprem-vpc-router1 \\\u00a0 \u00a0--region us-central1\\\u00a0 \u00a0--network onprem-vpc\\\u00a0 \u00a0--asn 65002\n```\n- \u7232 `vertex-networking-vpc` VPC \u7db2\u7d61\u5275\u5efa\u4e00\u500b\u5340\u57df\u7d1a Cloud Router \u8def\u7531\u5668\uff1a```\ngcloud compute routers create cloud-router-us-central1-vertex-nat \\\u00a0 --network vertex-networking-vpc \\\u00a0 --region us-central1\n```\n- \u5728\u5340\u57df\u7d1a Cloud Router \u8def\u7531\u5668\u4e0a\u914d\u7f6e Cloud NAT \u7db2\u95dc\uff1a```\ngcloud compute routers nats create cloud-nat-us-central1 \\\u00a0 --router=cloud-router-us-central1-vertex-nat \\\u00a0 --auto-allocate-nat-external-ips \\\u00a0 --nat-all-subnet-ip-ranges \\\u00a0 --region us-central1\n```\n- \u7232 `onprem-vpc` VPC \u7db2\u7d61\u5275\u5efa\u4e00\u500b\u5340\u57df\u7d1a Cloud Router \u8def\u7531\u5668\uff1a```\ngcloud compute routers create cloud-router-us-central1-onprem-nat \\\u00a0 --network onprem-vpc \\\u00a0 --region us-central1\n```\n- \u5728\u5340\u57df\u7d1a Cloud Router \u8def\u7531\u5668\u4e0a\u914d\u7f6e Cloud NAT \u7db2\u95dc\uff1a```\ngcloud compute routers nats create cloud-nat-us-central1-on-prem \\\u00a0 --router=cloud-router-us-central1-onprem-nat \\\u00a0 --auto-allocate-nat-external-ips \\\u00a0 --nat-all-subnet-ip-ranges \\\u00a0 --region us-central1\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u524d\u5f80 **Cloud Router \u8def\u7531\u5668** \u9801\u9762\u3002 [\u524d\u5f80\u201cCloud Router \u8def\u7531\u5668\u201d](https://console.cloud.google.com/hybrid/routers/list?hl=zh-cn) \n- \u5728 **Cloud Router \u8def\u7531\u5668** \u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa\u4ee5\u4e0b\u8def\u7531\u5668\uff1a- `cloud-router-us-central1-onprem-nat`\n- `cloud-router-us-central1-vertex-nat`\n- `onprem-vpc-router1`\n- `vertex-networking-vpc-router1`\n\u60a8\u53ef\u80fd\u9700\u8981\u5237\u65b0 Google Cloud \u63a7\u5236\u6aaf\u700f\u89bd\u5668\u6a19\u7c64\u9801\u624d\u80fd\u67e5\u770b\u65b0\u503c\u3002\n- \u5728 Cloud Router \u8def\u7531\u5668\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `cloud-router-us-central1-vertex-nat` \u3002\n- \u5728 **\u8def\u7531\u5668\u8a73\u60c5** \u9801\u9762\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa `cloud-nat-us-central1` Cloud NAT \u7db2\u95dc\u3002\n- \u9ede\u64ca arrow_back \u8fd4\u56de\u7bad\u982d\u4ee5\u8fd4\u56de **Cloud Router \u8def\u7531\u5668** \u9801\u9762\u3002\n- \u5728\u8def\u7531\u5668\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `cloud-router-us-central1-onprem-nat` \u3002\n- \u5728 **\u8def\u7531\u5668\u8a73\u60c5** \u9801\u9762\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa `cloud-nat-us-central1-on-prem` Cloud NAT \u7db2\u95dc\u3002\n### \u5275\u5efa VPN \u96a7\u9053\n- \u5728 Cloud Shell \u4e2d\uff0c\u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\u5275\u5efa\u4e00\u500b\u540d\u7232 `vertex-networking-vpc-tunnel0` \u7684 VPN \u96a7\u9053\uff1a```\ngcloud compute vpn-tunnels create vertex-networking-vpc-tunnel0 \\\u00a0 --peer-gcp-gateway onprem-vpn-gw1 \\\u00a0 --region us-central1 \\\u00a0 --ike-version 2 \\\u00a0 --shared-secret [ZzTLxKL8fmRykwNDfCvEFIjmlYLhMucH] \\\u00a0 --router vertex-networking-vpc-router1 \\\u00a0 --vpn-gateway vertex-networking-vpn-gw1 \\\u00a0 --interface 0\n```\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `vertex-networking-vpc-tunnel1` \u7684 VPN \u96a7\u9053\uff1a```\ngcloud compute vpn-tunnels create vertex-networking-vpc-tunnel1 \\\u00a0 --peer-gcp-gateway onprem-vpn-gw1 \\\u00a0 --region us-central1 \\\u00a0 --ike-version 2 \\\u00a0 --shared-secret [bcyPaboPl8fSkXRmvONGJzWTrc6tRqY5] \\\u00a0 --router vertex-networking-vpc-router1 \\\u00a0 --vpn-gateway vertex-networking-vpn-gw1 \\\u00a0 --interface 1\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `onprem-vpc-tunnel0` \u7684 VPN \u96a7\u9053\uff1a```\ngcloud compute vpn-tunnels create onprem-vpc-tunnel0 \\\u00a0 --peer-gcp-gateway vertex-networking-vpn-gw1 \\\u00a0 --region us-central1\\\u00a0 --ike-version 2 \\\u00a0 --shared-secret [ZzTLxKL8fmRykwNDfCvEFIjmlYLhMucH] \\\u00a0 --router onprem-vpc-router1 \\\u00a0 --vpn-gateway onprem-vpn-gw1 \\\u00a0 --interface 0\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `onprem-vpc-tunnel1` \u7684 VPN \u96a7\u9053\uff1a```\ngcloud compute vpn-tunnels create onprem-vpc-tunnel1 \\\u00a0 --peer-gcp-gateway vertex-networking-vpn-gw1 \\\u00a0 --region us-central1\\\u00a0 --ike-version 2 \\\u00a0 --shared-secret [bcyPaboPl8fSkXRmvONGJzWTrc6tRqY5] \\\u00a0 --router onprem-vpc-router1 \\\u00a0 --vpn-gateway onprem-vpn-gw1 \\\u00a0 --interface 1\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **VPN** \u9801\u9762\u3002 [\u8f49\u5230 VPN](https://console.cloud.google.com/hybrid/vpn?hl=zh-cn) \n- \u5728 VPN \u96a7\u9053\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa\u9019\u56db\u500b VPN \u96a7\u9053\u3002\n## \u5efa\u7acb BGP \u6703\u8a71Cloud Router \u8def\u7531\u5668\u4f7f\u7528\u908a\u754c\u7db2\u95dc\u5354\u8b70 (BGP) \u5728 VPC \u7db2\u7d61\uff08\u5728\u672c\u4f8b\u4e2d\u7232 `vertex-networking-vpc` \uff09\u548c\u672c\u5730\u7db2\u7d61\uff08\u7531 `onprem-vpc` \u8868\u793a\uff09\u4e4b\u9593\u4ea4\u63db\u8def\u7531\u3002\u5728 Cloud Router \u8def\u7531\u5668\u4e0a\uff0c\u7232\u672c\u5730\u8def\u7531\u5668\u914d\u7f6e\u63a5\u53e3\u548c BGP \u5c0d\u7b49\u7aef\u3002\u6b64\u63a5\u53e3\u548c BGP \u5c0d\u7b49\u914d\u7f6e\u5171\u540c\u69cb\u6210\u4e86 BGP \u6703\u8a71\u3002\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5206\u5225\u7232 `vertex-networking-vpc` \u548c `onprem-vpc` \u5275\u5efa\u5169\u500b BGP \u6703\u8a71\u3002\n\u5728\u8def\u7531\u5668\u4e4b\u9593\u914d\u7f6e\u63a5\u53e3\u548c BGP \u5c0d\u7b49\u65b9\u5f8c\uff0c\u5b83\u5011\u5c07\u81ea\u52d5\u958b\u59cb\u4ea4\u63db\u8def\u7531\u3002\n### \u7232 vertex-networking-vpc \u5efa\u7acb BGP \u6703\u8a71\n- \u5728 Cloud Shell \u4e2d\uff0c\u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\u7232 `vertex-networking-vpc-tunnel0` \u5275\u5efa\u4e00\u500b BGP \u63a5\u53e3\uff1a```\ngcloud compute routers add-interface vertex-networking-vpc-router1 \\\u00a0 --interface-name if-tunnel0-to-onprem \\\u00a0 --ip-address 169.254.0.1 \\\u00a0 --mask-length 30 \\\u00a0 --vpn-tunnel vertex-networking-vpc-tunnel0 \\\u00a0 --region us-central1\n```\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `bgp-onprem-tunnel0` \u5275\u5efa\u4e00\u500b BGP \u5c0d\u7b49\u65b9\uff1a```\ngcloud compute routers add-bgp-peer vertex-networking-vpc-router1 \\\u00a0 --peer-name bgp-onprem-tunnel0 \\\u00a0 --interface if-tunnel0-to-onprem \\\u00a0 --peer-ip-address 169.254.0.2 \\\u00a0 --peer-asn 65002 \\\u00a0 --region us-central1\n```\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `vertex-networking-vpc-tunnel1` \u5275\u5efa\u4e00\u500b BGP \u63a5\u53e3\uff1a```\ngcloud compute routers add-interface vertex-networking-vpc-router1 \\\u00a0 --interface-name if-tunnel1-to-onprem \\\u00a0 --ip-address 169.254.1.1 \\\u00a0 --mask-length 30 \\\u00a0 --vpn-tunnel vertex-networking-vpc-tunnel1 \\\u00a0 --region us-central1\n```\n- \u5728 `vertex-networking-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `bgp-onprem-tunnel1` \u5275\u5efa\u4e00\u500b BGP \u5c0d\u7b49\u65b9\uff1a```\ngcloud compute routers add-bgp-peer vertex-networking-vpc-router1 \\\u00a0 --peer-name bgp-onprem-tunnel1 \\\u00a0 --interface if-tunnel1-to-onprem \\\u00a0 --peer-ip-address 169.254.1.2 \\\u00a0 --peer-asn 65002 \\\u00a0 --region us-central1\n```\n### \u7232 onprem-vpc \u5efa\u7acb BGP \u6703\u8a71\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `onprem-vpc-tunnel0` \u5275\u5efa\u4e00\u500b BGP \u63a5\u53e3\uff1a```\ngcloud compute routers add-interface onprem-vpc-router1 \\\u00a0 --interface-name if-tunnel0-to-vertex-networking-vpc \\\u00a0 --ip-address 169.254.0.2 \\\u00a0 --mask-length 30 \\\u00a0 --vpn-tunnel onprem-vpc-tunnel0 \\\u00a0 --region us-central1\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `bgp-vertex-networking-vpc-tunnel0` \u5275\u5efa\u4e00\u500b BGP \u5c0d\u7b49\u65b9\uff1a```\ngcloud compute routers add-bgp-peer onprem-vpc-router1 \\\u00a0 --peer-name bgp-vertex-networking-vpc-tunnel0 \\\u00a0 --interface if-tunnel0-to-vertex-networking-vpc \\\u00a0 --peer-ip-address 169.254.0.1 \\\u00a0 --peer-asn 65001 \\\u00a0 --region us-central1\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `onprem-vpc-tunnel1` \u5275\u5efa\u4e00\u500b BGP \u63a5\u53e3\uff1a```\ngcloud compute routers add-interface \u00a0 onprem-vpc-router1 \u00a0\\\u00a0 --interface-name if-tunnel1-to-vertex-networking-vpc \\\u00a0 --ip-address 169.254.1.2 \\\u00a0 --mask-length 30 \\\u00a0 --vpn-tunnel onprem-vpc-tunnel1 \\\u00a0 --region us-central1\n```\n- \u5728 `onprem-vpc` \u7db2\u7d61\u4e2d\uff0c\u7232 `bgp-vertex-networking-vpc-tunnel1` \u5275\u5efa\u4e00\u500b BGP \u5c0d\u7b49\u65b9\uff1a```\ngcloud compute routers add-bgp-peer onprem-vpc-router1 \\\u00a0 --peer-name bgp-vertex-networking-vpc-tunnel1 \\\u00a0 --interface if-tunnel1-to-vertex-networking-vpc \\\u00a0 --peer-ip-address 169.254.1.1 \\\u00a0 --peer-asn 65001 \\\u00a0 --region us-central1\n```\n### \u9a57\u8b49 BGP \u6703\u8a71\u5275\u5efa\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **VPN** \u9801\u9762\u3002 [\u8f49\u5230 VPN](https://console.cloud.google.com/hybrid/vpn/list?hl=zh-cn) \n- \u5728 VPN \u96a7\u9053\u5217\u8868\u4e2d\uff0c\u9a57\u8b49\u6bcf\u500b\u96a7\u9053\u7684 **BGP \u6703\u8a71\u72c0\u614b** \u5217\u4e2d\u7684\u503c\u662f\u5426\u5df2\u5f9e **\u914d\u7f6e BGP \u6703\u8a71** \u66f4\u6539\u7232 **BGP \u5df2\u5efa\u7acb** \u3002\u60a8\u53ef\u80fd\u9700\u8981\u5237\u65b0 Google Cloud \u63a7\u5236\u6aaf\u700f\u89bd\u5668\u6a19\u7c64\u9801\u624d\u80fd\u67e5\u770b\u65b0\u503c\u3002\n### \u9a57\u8b49 vertex-networking-vpc \u662f\u5426\u77ad\u89e3\u8def\u7531\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **VPC \u7db2\u7d61** \u9801\u9762\u3002 [\u9032\u5165 VPC \u7db2\u7d61\u9801\u9762](https://console.cloud.google.com/networking/networks/list?hl=zh-cn) \n- \u5728 VPC \u7db2\u7d61\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `vertex-networking-vpc` \u3002\n- \u9ede\u64ca **\u8def\u7531** \u6a19\u7c64\u9801\u3002\n- \u5728 **\u5340\u57df** \u5217\u8868\u4e2d\u9078\u64c7 **us-central1\uff08\u611b\u8377\u83ef\uff09** \uff0c\u7136\u5f8c\u9ede\u64ca **\u67e5\u770b** \u3002\n- \u5728 **\u76ee\u6a19 IP \u7bc4\u570d** \u5217\u4e2d\uff0c\u9a57\u8b49 `onprem-vpc-subnet1` \u5b50\u7db2\u7684 IP \u7bc4\u570d ( `172.16.10.0/29` ) \u662f\u5426\u51fa\u73fe\u5169\u6b21\u3002\n### \u9a57\u8b49 on-prem-vpc \u662f\u5426\u77ad\u89e3\u8def\u7531\n- \u9ede\u64ca arrow_back \u8fd4\u56de\u7bad\u982d\u4ee5\u8fd4\u56de **VPC \u7db2\u7d61** \u9801\u9762\u3002\n- \u5728 VPC \u7db2\u7d61\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `on-prem-vpc` \u3002\n- \u9ede\u64ca **\u8def\u7531** \u6a19\u7c64\u9801\u3002\n- \u5728 **\u5340\u57df** \u5217\u8868\u4e2d\u9078\u64c7 **us-central1\uff08\u611b\u8377\u83ef\uff09** \uff0c\u7136\u5f8c\u9ede\u64ca **\u67e5\u770b** \u3002\n- \u5728 **\u76ee\u6a19 IP \u7bc4\u570d** \u5217\u4e2d\uff0c\u9a57\u8b49 `workbench-subnet` \u5b50\u7db2\u7684 IP \u7bc4\u570d ( `172.16.20.0/28` ) \u548c `consumer-endpoint-subnet` \u5b50\u7db2\u7684 IP \u7bc4\u570d ( `172.16.30.0/28` ) \u662f\u5426\u5404\u81ea\u51fa\u73fe\u5169\u6b21\u3002\n## \u5275\u5efa Vertex AI Workbench \u5be6\u4f8b\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u4e00\u500b\u7528\u6236\u7ba1\u7406\u7684\u670d\u52d9\u8cec\u865f\uff0c\u7136\u5f8c\u5275\u5efa\u4e00\u500b\u4f7f\u7528\u60a8\u7684\u670d\u52d9\u8cec\u865f\u8a2a\u554f Google Cloud \u670d\u52d9\u548c API \u7684 Vertex AI Workbench \u5be6\u4f8b\u3002\n### \u5275\u5efa\u670d\u52d9\u8cec\u865f\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u6309\u7167 Compute Engine \u548c IAM [\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/iam/docs/service-account-types?hl=zh-cn#default) \u5275\u5efa\u7528\u6236\u7ba1\u7406\u7684\u670d\u52d9\u8cec\u865f\u3002- \u5728 Cloud Shell \u4e2d\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `workbench-sa` \u7684\u670d\u52d9\u8cec\u865f\uff1a```\ngcloud iam service-accounts create workbench-sa \\\u00a0 \u00a0--display-name=\"workbench-sa\"\n```\n- \u5c07 [Vertex AI User (roles/aiplatform.user)](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#aiplatform.user) IAM \u89d2\u8272\u5206\u914d\u7d66\u8a72\u670d\u52d9\u8cec\u865f\uff1a```\ngcloud projects add-iam-policy-binding $projectid \\\u00a0 --member=\"serviceAccount:workbench-sa@$projectid.iam.gserviceaccount.com\" \\\u00a0 --role=\"roles/aiplatform.user\"\n```\n- \u5c07 [Storage Admin (roles/storage.admin)](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#storage.admin) IAM \u89d2\u8272\u5206\u914d\u7d66\u8a72\u670d\u52d9\u8cec\u865f\uff1a```\ngcloud projects add-iam-policy-binding $projectid \\\u00a0 --member=\"serviceAccount:workbench-sa@$projectid.iam.gserviceaccount.com\" \\\u00a0 --role=\"roles/storage.admin\"\n```\n- \u5c07 [Service Usage Admin (roles/serviceusage.serviceUsageAdmin)](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#serviceusage.serviceUsageAdmin) IAM \u89d2\u8272\u5206\u914d\u7d66\u8a72\u670d\u52d9\u8cec\u865f\uff1a```\ngcloud projects add-iam-policy-binding $projectid \\\u00a0 --member=\"serviceAccount:workbench-sa@$projectid.iam.gserviceaccount.com\" \\\u00a0 --role=\"roles/serviceusage.serviceUsageAdmin\"\n```\n### \u5275\u5efa Vertex AI Workbench \u5be6\u4f8b\u5728\u6307\u5b9a `workbench-sa` \u670d\u52d9\u8cec\u865f\u7684\u60c5\u6cc1\u4e0b\u5275\u5efa\u4e00\u500b Vertex AI Workbench \u5be6\u4f8b\uff1a\n```\ngcloud workbench instances create workbench-tutorial \\\u00a0 --vm-image-project=deeplearning-platform-release \\\u00a0 --vm-image-family=common-cpu-notebooks \\\u00a0 --machine-type=n1-standard-4 \\\u00a0 --location=us-central1-a \\\u00a0 --subnet-region=us-central1 \\\u00a0 --shielded-secure-boot=SHIELDED_SECURE_BOOT \\\u00a0 --subnet=workbench-subnet \\\u00a0 --disable-public-ip \\\u00a0 --service-account-email=workbench-sa@$projectid.iam.gserviceaccount.com\n```## \u5275\u5efa\u548c\u90e8\u7f72 Vector Search \u7d22\u5f15\n### \u6e96\u5099\u74b0\u5883\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Vertex AI Workbench** \u9801\u9762\u4e2d\u7684 **\u5be6\u4f8b** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230 Vertex AI Workbench](https://console.cloud.google.com/vertex-ai/workbench/instances?hl=zh-cn) \n- \u5728 Vertex AI Workbench \u5be6\u4f8b\u540d\u7a31 ( `workbench-tutorial` ) \u65c1\u908a\uff0c\u9ede\u64ca **\u6253\u958b JupyterLab** \u3002\u60a8\u7684 Vertex AI Workbench \u5be6\u4f8b\u6703\u6253\u958b JupyterLab\u3002\n- \u9078\u64c7 **\u6587\u4ef6\u00a0> \u65b0\u5efa\u00a0> \u7b46\u8a18\u672c** \u3002\n- \u5728 **\u9078\u64c7\u5167\u6838** \u83dc\u55ae\u4e2d\uff0c\u9078\u64c7 **Python 3\uff08\u672c\u5730\uff09** \uff0c\u7136\u5f8c\u9ede\u64ca **\u9078\u64c7** \u3002\n- \u7576\u60a8\u7684\u65b0\u7b46\u8a18\u672c\u6253\u958b\u6642\uff0c\u6709\u4e00\u500b\u9ed8\u8a8d\u4ee3\u78bc\u55ae\u5143\uff0c\u60a8\u53ef\u4ee5\u5728\u5176\u4e2d\u8f38\u5165\u4ee3\u78bc\u3002\u5b83\u985e\u4f3c\u65bc `[ ]:` \uff0c\u5f8c\u8ddf\u4e00\u500b\u6587\u672c\u5b57\u6bb5\u3002\u60a8\u7684\u4ee3\u78bc\u5c07\u7c98\u8cbc\u5230\u8a72\u6587\u672c\u5b57\u6bb5\u4e2d\u3002\u5982\u9700\u5b89\u88dd Python \u7248 Vertex AI SDK\uff0c\u8acb\u5c07\u4ee5\u4e0b\u4ee3\u78bc\u7c98\u8cbc\u5230\u8a72\u55ae\u5143\u4e2d\uff0c\u7136\u5f8c\u9ede\u64ca play_arrow **\u904b\u884c\u6240\u9078\u55ae\u5143\u4e26\u524d\u9032** \uff1a```\n!pip install --upgrade --user google-cloud-aiplatform google-cloud-storage\n```\n- \u5728\u6b64\u6b65\u9a5f\u4ee5\u53ca\u4e0b\u9762\u7684\u6bcf\u500b\u6b65\u9a5f\u4e2d\uff0c\u9ede\u64ca add **\u5728\u4e0b\u65b9\u63d2\u5165\u55ae\u5143** \u4ee5\u6dfb\u52a0\u65b0\u7684\u4ee3\u78bc\u55ae\u5143\uff08\u5982\u6709\u5fc5\u8981\uff09\uff0c\u5c07\u4ee3\u78bc\u7c98\u8cbc\u5230\u8a72\u55ae\u5143\u4e2d\uff0c\u7136\u5f8c\u9ede\u64ca play_arrow **\u904b\u884c\u6240\u9078\u55ae\u5143\u4e26\u524d\u9032** \u3002\u5982\u9700\u5728\u6b64 Jupyter \u904b\u884c\u6642\u4e2d\u4f7f\u7528\u65b0\u5b89\u88dd\u7684\u8edf\u4ef6\u5305\uff0c\u60a8\u9700\u8981\u91cd\u5553\u904b\u884c\u6642\uff1a```\n# Restart kernel after installs so that your environment can access the new packagesimport IPythonapp = IPython.Application.instance()app.kernel.do_shutdown(True)\n```\n- \u8a2d\u7f6e\u4ee5\u4e0b\u74b0\u5883\u8b8a\u91cf\uff0c\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002```\n# set project ID and locationPROJECT_ID = \"PROJECT_ID\"LOCATION = \"us-central1\"# generate a unique id for this sessionfrom datetime import datetimeUID = datetime.now().strftime(\"%m%d%H%M\")\n```\n### \u5553\u7528 API\u5728\u60a8\u7684 Jupyterlab \u7b46\u8a18\u672c\u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u5728\u7b46\u8a18\u672c\u4e2d\u5553\u7528\u9069\u7528\u65bc Compute Engine\u3001Vertex AI \u548c Cloud Storage \u7684 API\uff1a\n```\n! gcloud services enable compute.googleapis.com aiplatform.googleapis.com storage.googleapis.com \\\u00a0 --project {PROJECT_ID}\n```\n### \u5728 Cloud Storage \u5b58\u5132\u6876\u4e2d\u6e96\u5099\u597d\u793a\u4f8b\u6578\u64da\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u5011\u4f7f\u7528 [Vector Search \u5feb\u901f\u5165\u9580](https://cloud.google.com/vertex-ai/docs/vector-search/quickstart?hl=zh-cn) \u4e2d\u4f7f\u7528\u7684 [TheLook \u6578\u64da\u96c6](https://console.cloud.google.com/marketplace/product/bigquery-public-data/thelook-ecommerce?hl=zh-cn) \u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6b64\u6578\u64da\u96c6\uff0c\u8acb\u53c3\u95b1\u5feb\u901f\u5165\u9580\u6587\u6a94\u9801\u9762\u3002\n\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u4e00\u500b Cloud Storage \u5b58\u5132\u6876\uff0c\u4e26\u5c07\u6578\u64da\u96c6\u7684\u5d4c\u5165\u6587\u4ef6\u4fdd\u5b58\u5728\u8a72\u5b58\u5132\u6876\u4e2d\u3002\u5728\u7a0d\u5f8c\u7684\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528\u6b64\u6587\u4ef6\u69cb\u5efa\u7d22\u5f15\u3002- \u5728\u60a8\u7684 Jupyterlab \u7b46\u8a18\u672c\u4e2d\uff0c\u5275\u5efa\u4e00\u500b Cloud Storage \u5b58\u5132\u6876\uff1a```\nBUCKET_URI = f\"gs://{PROJECT_ID}-vs-quickstart-{UID}\"! gsutil mb -l $LOCATION -p $PROJECT_ID $BUCKET_URI\n```\n- \u5c07\u793a\u4f8b\u6587\u4ef6\u8907\u88fd\u5230 Cloud Storage \u5b58\u5132\u6876\u3002```\n! gsutil cp \"gs://github-repo/data/vs-quickstart/product-embs.json\" $BUCKET_URI\n```\n- \u5982\u9700\u4f7f\u7528 Vector Search \u904b\u884c\u67e5\u8a62\uff0c\u60a8\u9084\u9700\u8981\u5c07\u5d4c\u5165\u6587\u4ef6\u8907\u88fd\u5230\u672c\u5730\u76ee\u9304\uff1a```\n! gsutil cp \"gs://github-repo/data/vs-quickstart/product-embs.json\" . # for query tests\n```\n### \u5275\u5efa Vector Search \u7d22\u5f15\n- \u5728\u60a8\u7684 Jupyterlab \u7b46\u8a18\u672c\u4e2d\uff0c\u5c07\u5d4c\u5165\u52a0\u8f09\u5230 Vector Search \u4e2d\uff1a```\n# init the aiplatform packagefrom google.cloud import aiplatformaiplatform.init(project=PROJECT_ID, location=LOCATION)\n```\n- \u4f7f\u7528 `create_tree_ah_index` \u51fd\u6578\u5275\u5efa [MatchingEngineIndex](https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform.MatchingEngineIndex?hl=zh-cn) \uff08Matching Engine \u662f Vector Search \u7684\u820a\u540d\u7a31\uff09\uff1a```\n# create Indexmy_index = aiplatform.MatchingEngineIndex.create_tree_ah_index(\u00a0 display_name = f\"vs-quickstart-index-{UID}\",\u00a0 contents_delta_uri = BUCKET_URI,\u00a0 dimensions = 768,\u00a0 approximate_neighbors_count = 10,)\n````MatchingEngineIndex.create_tree_ah_index()` \u65b9\u6cd5\u6703\u69cb\u5efa\u7d22\u5f15\u3002\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6b64\u4efb\u52d9\u5927\u7d04\u9700\u8981 5 \u5230 10 \u5206\u9418\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Vector Search** \u9801\u9762\u4e2d\u7684 **\u7d22\u5f15** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230\u201c\u7d22\u5f15\u201d](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn) \n- \u9a57\u8b49\u662f\u5426\u5b58\u5728\u540d\u7a31\u4ee5 `\"vs-quickstart-index-\"` \u958b\u982d\u4e14\u5305\u542b\u6b63\u78ba\u6642\u9593\u6233\u7684\u7d22\u5f15\u3002\n- \u8a18\u4e0b\u7d22\u5f15 ID\u3002\u5728\u7a0d\u5f8c\u7684\u6b65\u9a5f\u4e2d\u90e8\u7f72\u7d22\u5f15\u6642\uff0c\u60a8\u5c07\u9700\u8981\u6b64 ID\u3002\n### \u5275\u5efa\u7d22\u5f15\u7aef\u9ede\n- \u5728 Cloud Shell \u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\uff1a```\nprojectid=PROJECT_IDgcloud config set project ${projectid}SERVICE_PROJECT=${projectid}REGION=us-central1VERTEX_ENDPOINT=$REGION-aiplatform.googleapis.comDISPLAY_NAME=vector-search\n```\n- \u5275\u5efa\u7d22\u5f15\u7aef\u9ede\uff1a```\ncurl -H \"Content-Type: application/json\" \\\u00a0 -H \"Authorization: Bearer `gcloud auth print-access-token`\" \\\u00a0 https://$VERTEX_ENDPOINT/v1/projects/$SERVICE_PROJECT/locations/$REGION/indexEndpoints \\\u00a0 -d '{displayName: \"'$DISPLAY_NAME'\", privateServiceConnectConfig: { enablePrivateServiceConnect: true, projectAllowlist: [\"'$SERVICE_PROJECT'\"] }}'\n```\n- \u9a57\u8b49\u662f\u5426\u5df2\u5275\u5efa\u7d22\u5f15\u7aef\u9ede\uff1a```\ngcloud ai index-endpoints list --region=us-central1\n```\u60a8\u61c9\u8a72\u6703\u770b\u5230\u985e\u4f3c\u4ee5\u4e0b\u793a\u4f8b\u7684\u8f38\u51fa\uff0c\u5176\u4e2d\u7d22\u5f15\u7aef\u9ede ID \u7232 `8151506529447575552` \uff1a```\nUsing endpoint [https://us-central1-aiplatform.googleapis.com/]---createTime: '2023-10-10T23:55:20.526145Z'displayName: vector-searchencryptionSpec: {}etag: AMEw9yN2qytNiwT73uwYpz_7N_b2-O8D1AuNoDb5QjFmkU4ye5Gzk2oQlMZBR1XeoQ11name: projects/725264228516/locations/us-central1/indexEndpoints/8151506529447575552privateServiceConnectConfig:\u00a0 enablePrivateServiceConnect: true\u00a0 projectAllowlist:\u00a0 - vertex-genai-400103\u00a0 - vertex-genai-400103updateTime: '2023-10-10T23:55:21.951394Z'\n```\n- \u8a18\u4e0b\u7d22\u5f15\u7aef\u9ede ID\u3002\u5728\u7a0d\u5f8c\u7684\u6b65\u9a5f\u4e2d\u90e8\u7f72\u7d22\u5f15\u6642\uff0c\u60a8\u5c07\u9700\u8981\u6b64 ID\u3002\n## \u5c07\u7d22\u5f15\u90e8\u7f72\u5230\u7aef\u9ede\u5728 Cloud Shell \u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u5c07\u7d22\u5f15\u90e8\u7f72\u5230\u7aef\u9ede\uff1a\n```\ngcloud ai index-endpoints deploy-index INDEX_ENDPOINT_ID \\\u00a0 --deployed-index-id=vector_one \\\u00a0 --display-name=vector-search \\\u00a0 --index=INDEX \\\u00a0 --project=$projectid \\\u00a0 --region=us-central1\n```\n\u66ff\u63db\u4ee5\u4e0b\u503c\uff1a- \uff1a\u60a8\u5275\u5efa\u7684 Private Service Connect \u7d22\u5f15\u7aef\u9ede\u7684\u7d22\u5f15\u7aef\u9ede ID\n- \uff1a\u6240\u90e8\u7f72\u7684\u7d22\u5f15\u7684 ID\n\u60a8\u61c9\u8a72\u6703\u770b\u5230\u985e\u4f3c\u4ee5\u4e0b\u793a\u4f8b\u7684\u8f38\u51fa\uff0c\u5176\u4e2d\u7d22\u5f15\u7aef\u9ede ID \u7232 `8151506529447575552` \uff1a\n```\nUsing endpoint [https://us-central1-aiplatform.googleapis.com/]The deploy index operation [projects/725264228516/locations/us-central1/indexEndpoints/8151506529447575552/operations/6271807495283408896] was submitted successfully.\n```\n\u90e8\u7f72\u7d22\u5f15\u6642\uff0c\u7cfb\u7d71\u6703\u751f\u6210\u4e00\u500b Private Service Connect \u7aef\u9ede\u3002\u90e8\u7f72\u64cd\u4f5c\u5927\u7d04\u9700\u8981 10 \u5230 15 \u5206\u9418\u3002\n### \u9a57\u8b49\u7d22\u5f15\u662f\u5426\u5df2\u90e8\u7f72\u5230\u7d22\u5f15\u7aef\u9ede\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Vector Search** \u9801\u9762\u4e2d\u7684 **\u7d22\u5f15\u7aef\u9ede** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230\u201c\u7d22\u5f15\u7aef\u9ede\u201d](https://console.cloud.google.com/vertex-ai/matching-engine/index-endpoints?hl=zh-cn) \n- \u9a57\u8b49 `vector-search` \u7d22\u5f15\u7aef\u9ede\u662f\u5426\u5177\u6709\u5df2\u90e8\u7f72\u7684\u7d22\u5f15\uff08\u4e5f\u7a31\u7232 `vector-search` \uff09\u3002\u5982\u679c\u7d22\u5f15\u7aef\u9ede\u540d\u7a31\u65c1\u986f\u793a\u65cb\u8f49\u7684\u85cd\u8272\u5713\u5708\uff0c\u5247\u8868\u793a\u7d22\u5f15\u4ecd\u5728\u90e8\u7f72\u904e\u7a0b\u4e2d\u3002\n### \u7372\u53d6\u7d22\u5f15\u7aef\u9ede\u7684\u670d\u52d9\u9023\u63a5 URI\u5b8c\u5168\u90e8\u7f72\u7d22\u5f15\u5f8c\uff0c\u60a8\u53ef\u4ee5\u7372\u53d6\u670d\u52d9\u9023\u63a5 URI\u3002\n\u5728 Cloud Shell \u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u7372\u53d6 Private Service Connect \u7aef\u9ede\u7684\u670d\u52d9\u9023\u63a5 URI\uff1a\n```\ngcloud ai index-endpoints list --region=us-central1 | grep -i \u00a0serviceAttachment:\n```\n\u5728\u4ee5\u4e0b\u793a\u4f8b\u8f38\u51fa\u4e2d\uff0c\u670d\u52d9\u9023\u63a5 URI \u7232 `projects/je84d1de50cd8bddb-tp/regions/us-central1/serviceAttachments/sa-gkedpm-527af280e65971fd786aaf6163e798` \u3002\n```\nUsing endpoint [https://us-central1-aiplatform.googleapis.com/]\u00a0serviceAttachment: projects/je84d1de50cd8bddb-tp/regions/us-central1/serviceAttachments/sa-gkedpm-527af280e65971fd786aaf6163e798\n```\n\u8a18\u4e0b\u4ee5 `projects` \u958b\u982d\u7684 `serviceAttachment` URI\uff0c\u4f8b\u5982 `projects/je84d1de50cd8bddb-tp/regions/us-central1/serviceAttachments/sa-gkedpm-527af280e65971fd786aaf6163e798` \u3002\u5728\u4e0b\u4e00\u6b65\u4e2d\u5275\u5efa\u4f7f\u7528\u65b9\u7aef\u9ede\u6642\uff0c\u60a8\u9700\u8981\u4f7f\u7528\u5b83\u3002## \u5275\u5efa Private Service Connect \u4f7f\u7528\u65b9\u7aef\u9ede\n- \u5728 Cloud Shell \u4e2d\uff0c\u9810\u7559\u5c07\u7528\u65bc\u67e5\u8a62 Vector Search \u7d22\u5f15\u7684\u4f7f\u7528\u65b9\u7aef\u9ede IP \u5730\u5740\uff1a```\ngcloud compute addresses create vector-search-endpoint1 \\\u00a0 --region=us-central1 \\\u00a0 --subnet=consumer-endpoint-subnet\n```\n- \u67e5\u627e\u9810\u7559\u7684 IP \u5730\u5740\uff1a```\ngcloud compute addresses list --filter=\"name=vector-search-endpoint1\"\n```\n- \u5275\u5efa\u8f49\u767c\u898f\u5247\u4ee5\u5c07\u7aef\u9ede\u9023\u63a5\u5230\u670d\u52d9\u9023\u63a5\uff08\u5c07 \u66ff\u63db\u7232\u60a8\u7684 `serviceAttachment` URI\uff09\u3002```\ngcloud compute forwarding-rules create vector-search-endpoint1 \\\u00a0 --region=us-central1 \\\u00a0 --network=vertex-networking-vpc \\\u00a0 --address=vector-search-endpoint1 \\\u00a0 --target-service-attachment=SERVICE_ATTACHMENT_URI\n```\u4ee5\u4e0b\u662f\u6b64\u547d\u4ee4\u7684\u7528\u6cd5\u793a\u4f8b\uff1a```\ngcloud compute forwarding-rules create vector-search-endpoint1 \\\u00a0 --region=us-central1 \\\u00a0 --network=vertex-networking-vpc \\\u00a0 --address=vector-search-endpoint1 \\\u00a0 --target-service-attachment=projects/je84d1de50cd8bddb-tp/regions/us-central1/serviceAttachments/sa-gkedpm-527af280e65971fd786aaf6163e798\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Private Service Connect** \u9801\u9762\u4e2d\u7684 **\u5df2\u9023\u63a5\u7684\u7aef\u9ede** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230\u201c\u5df2\u9023\u63a5\u7684\u7aef\u9ede\u201d](https://console.cloud.google.com/net-services/psc/list/consumers?pageTab=CURRENT_PROJECT_NETWORKS&hl=zh-cn) \n- \u9a57\u8b49\u4f7f\u7528\u65b9\u7aef\u9ede\u72c0\u614b\u662f\u5426\u7232 `Accepted` \u3002\n- \u8a18\u4e0b Private Service Connect \u4f7f\u7528\u65b9\u7aef\u9ede\u7684 IP \u5730\u5740\u3002\u5728\u7a0d\u5f8c\u7684\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528\u6b64\u7aef\u9ede\u8207\u5df2\u90e8\u7f72\u7684 Vector Search \u7d22\u5f15\u5efa\u7acb\u901a\u4fe1\u3002\n## \u67e5\u8a62\u5df2\u90e8\u7f72\u7684\u7d22\u5f15\u73fe\u5728\u60a8\u5df2\u5efa\u7acb\u9023\u63a5\u5230 Vector Search \u7d22\u5f15\u7aef\u9ede\u7684 Private Service Connect \u4f7f\u7528\u65b9\u7aef\u9ede\uff0c\u63a5\u4e0b\u4f86\u53ef\u4ee5\u901a\u904e\u5c07\u67e5\u8a62\u5f9e `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\u767c\u9001\u5230\u4f7f\u7528\u65b9\u7aef\u9ede\u4f86\u67e5\u8a62\u5df2\u90e8\u7f72\u7684\u7d22\u5f15\u3002\n\u5982\u9700\u5141\u8a31 Identity-Aware Proxy (IAP) \u9023\u63a5\u5230\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u8acb\u5275\u5efa\u4e00\u689d\u9632\u706b\u7246\u898f\u5247\uff0c\u8a72\u898f\u5247\u61c9\uff1a- \u9069\u7528\u65bc\u60a8\u8981\u901a\u904e IAP \u8a2a\u554f\u7684\u6240\u6709\u865b\u64ec\u6a5f\u5be6\u4f8b\u3002\n- \u5141\u8a31\u4f86\u81ea IP \u5730\u5740\u7bc4\u570d`35.235.240.0/20`\u7684\u3001\u901a\u904e\u7aef\u53e3 22 \u7684 TCP \u6d41\u91cf\u6b64\u7bc4\u570d\u5305\u542b IAP \u7528\u65bc [TCP \u8f49\u767c](https://cloud.google.com/iap/docs/using-tcp-forwarding?hl=zh-cn#gcloud) \u7684\u6240\u6709 IP \u5730\u5740\u3002\n\u5275\u5efa\u9632\u706b\u7246\u5f8c\uff0c\u60a8\u9700\u8981\u5b89\u88dd gRPC \u5ba2\u6236\u7aef\u3002\u5728\u7a0d\u5f8c\u7684\u6b65\u9a5f\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 gRPC \u5ba2\u6236\u7aef\u5f9e `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\u767c\u9001\u67e5\u8a62\u3002\n### \u5275\u5efa\u9632\u706b\u7246\u898f\u5247\u4e26\u5b89\u88dd gRPC\n- \u5728 Cloud Shell \u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\uff1a```\nprojectid=PROJECT_IDgcloud config set project ${projectid}\n```\n- \u5275\u5efa\u4e00\u500b\u540d\u7232 `ssh-iap-vpc` \u7684 IAP \u9632\u706b\u7246\u898f\u5247\uff1a```\ngcloud compute firewall-rules create ssh-iap-vpc \\\u00a0 --network onprem-vpc \\\u00a0 --allow tcp:22 \\\u00a0 --source-ranges=35.235.240.0/20\n```\n- \u767b\u9304\u5230 `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a```\ngcloud compute ssh on-prem-client \\\u00a0 --project=$projectid \\\u00a0 --zone=us-central1-a \\\u00a0 --tunnel-through-iap\n```\n- \u5728 `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\u4e2d\uff0c\u5b89\u88dd [gRPC](https://cloud.google.com/endpoints/docs/grpc/about-grpc?hl=zh-cn) \u5ba2\u6236\u7aef\uff1a```\nsudo apt-get install git -ygit clone https://github.com/grpc/grpc.gitsudo apt-get install build-essential autoconf libtool pkg-config -ysudo apt-get install cmake -ycd grpc/git submodule update --initmkdir -p cmake/buildcd cmake/buildcmake -DgRPC_BUILD_TESTS=ON ../..make grpc_cli\n```\u5b89\u88dd\u904e\u7a0b\u5927\u7d04\u9700\u8981 30 \u5206\u9418\u3002\n### \u7372\u53d6\u73fe\u6709\u7d22\u5f15\u9805\u7684 ID\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Vertex AI Workbench** \u9801\u9762\u4e2d\u7684 **\u5be6\u4f8b** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230 Vertex AI Workbench](https://console.cloud.google.com/vertex-ai/workbench/instances?hl=zh-cn) \n- \u5728 Vertex AI Workbench \u5be6\u4f8b\u540d\u7a31\u65c1\u908a\uff0c\u9ede\u64ca **\u6253\u958b JupyterLab** \u3002\u60a8\u7684 Vertex AI Workbench \u5be6\u4f8b\u6703\u6253\u958b JupyterLab\u3002\n- \u9078\u64c7 **\u6587\u4ef6\u00a0> \u65b0\u5efa\u00a0> \u7d42\u7aef** \u3002\n- \u5728 JupyterLab \u7d42\u7aef\uff08\u800c\u4e0d\u662f Cloud Shell\uff09\u4e2d\uff0c\u67e5\u770b\u7d22\u5f15\u4e2d\u7684\u6700\u5f8c\u4e00\u500b\u689d\u76ee\uff1a```\ntail -1 product-embs.json\n```\n- \u5728\u8a72\u9805\u4e2d\u67e5\u627e\u5305\u542b\u8a72\u9805\u7684 ID \u7de8\u865f\u7684\u7b2c\u4e00\u500b\u9375\u503c\u5c0d\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a```\n\"id\":\"27452\"\n```\u8a18\u4e0b\u6b64 ID \u7de8\u865f\u3002\u60a8\u5c07\u5728\u4e0b\u4e00\u90e8\u5206\u4e2d\u4f7f\u7528\u5b83\u3002\n### \u57f7\u884c Vector Search \u67e5\u8a62\u5728 `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\u4e2d\uff0c\u67e5\u8a62\u5df2\u90e8\u7f72\u7684\u7d22\u5f15\uff1a\n```\n./grpc_cli call \u00a0CONSUMER_ENDPOINT_IP:10000 \u00a0google.cloud.aiplatform.container.v1.MatchService.Match \"deployed_index_id:'\"vector_one\"',embedding_id: '\"ITEM_ID\"'\"\n```\n\u66ff\u63db\u4ee5\u4e0b\u503c\uff1a- \uff1a\u60a8\u5728\u4e0a\u4e00\u90e8\u5206\u4e2d\u5275\u5efa\u7684 Private Service Connect \u4f7f\u7528\u65b9\u7aef\u9ede\u7684 IP \u5730\u5740\n- \uff1a\u60a8\u5728\u4e0a\u4e00\u90e8\u5206\u4e2d\u4fdd\u5b58\u7684\u9805 ID \u7de8\u865f\n\u8f38\u51fa\u5167\u5bb9\u61c9\u5982\u4e0b\u4f8b\u6240\u793a\uff1a\n```\n\u00a0 \u00a0user@on-prem-client:~/grpc/cmake/build$ ./grpc_cli call \u00a0172.16.30.2:10000 \u00a0google.cloud.aiplatform.container.v1.MatchService.Match \"deployed_index_id:'\"vector_one\"',embedding_id: '\"20020916\"'\"\u00a0 \u00a0connecting to 172.16.30.2:10000\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"16136217\"\u00a0 \u00a0 \u00a0distance: 0.99999558925628662\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"2196405\"\u00a0 \u00a0 \u00a0distance: 0.82817935943603516\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"3796353\"\u00a0 \u00a0 \u00a0distance: 0.82687419652938843\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"815154\"\u00a0 \u00a0 \u00a0distance: 0.8179466724395752\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"16262338\"\u00a0 \u00a0 \u00a0distance: 0.816785454750061\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"31290454\"\u00a0 \u00a0 \u00a0distance: 0.81560027599334717\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"4012943\"\u00a0 \u00a0 \u00a0distance: 0.80958610773086548\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"39738359\"\u00a0 \u00a0 \u00a0distance: 0.8020891547203064\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"7691697\"\u00a0 \u00a0 \u00a0distance: 0.80035769939422607\u00a0 \u00a0}\u00a0 \u00a0neighbor {\u00a0 \u00a0 \u00a0id: \"6398888\"\u00a0 \u00a0 \u00a0distance: 0.79880392551422119\u00a0 \u00a0}\u00a0 \u00a0Rpc succeeded with OK status\n```## \u6e05\u7406\u7232\u907f\u514d\u56e0\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u8cc7\u6e90\u5c0e\u81f4\u60a8\u7684 Google Cloud \u8cec\u865f\u7522\u751f\u8cbb\u7528\uff0c\u8acb\u522a\u9664\u5305\u542b\u9019\u4e9b\u8cc7\u6e90\u7684\u9805\u76ee\uff0c\u6216\u8005\u4fdd\u7559\u9805\u76ee\u4f46\u522a\u9664\u5404\u500b\u8cc7\u6e90\u3002\n\u7232\u907f\u514d\u56e0\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u8cc7\u6e90\u5c0e\u81f4\u60a8\u7684 Google Cloud \u8cec\u865f\u7522\u751f\u8cbb\u7528\uff0c\u8acb [\u522a\u9664\u5305\u542b\u9019\u4e9b\u8cc7\u6e90\u7684\u9805\u76ee](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#shutting_down_projects) \uff0c\u6216\u8005\u4fdd\u7559\u9805\u76ee\u4f46\u522a\u9664\u5404\u500b\u8cc7\u6e90\u3002\n\u60a8\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u522a\u9664\u5404\u500b\u8cc7\u6e90\uff1a- \u6309\u5982\u4e0b\u65b9\u5f0f\u53d6\u6d88\u90e8\u7f72\u4e26\u522a\u9664 Vector Search \u7d22\u5f15\uff1a- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Vector Search** \u9801\u9762\u4e2d\u7684 **\u7d22\u5f15** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230\u201c\u7d22\u5f15\u201d](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn) \n- \u627e\u5230\u540d\u7a31\u4ee5 `\"vs-quickstart-index-\"` \u958b\u982d\u4e14\u5305\u542b\u6b63\u78ba\u6642\u9593\u6233\u7684\u7d22\u5f15\u3002\n- \u9ede\u64ca\u7d22\u5f15\u540d\u7a31\u3002\n- \u5728 **\u7d22\u5f15\u4fe1\u606f** \u9801\u9762\u4e0a\uff0c **\u5df2\u90e8\u7f72\u7684\u7d22\u5f15** \u5217\u8868\u4e2d\u7684\u7d22\u5f15\u540d\u7a31\u65c1\uff0c\u9ede\u64ca more_vert **\u64cd\u4f5c** \uff0c\u7136\u5f8c\u9ede\u64ca **\u53d6\u6d88\u90e8\u7f72** \u3002\u5c0d\u7d22\u5f15\u53d6\u6d88\u90e8\u7f72\u9700\u8981\u5e7e\u5206\u9418\u6642\u9593\u3002\u5982\u679c\u7d22\u5f15\u540d\u7a31\u65c1\u908a\u986f\u793a\u65cb\u8f49\u7684\u85cd\u8272\u5713\u5708\uff0c\u6216\u8005\u7d22\u5f15\u72c0\u614b\u5217\u7232 `Undeploying` \uff0c\u5247\u8868\u793a\u7d22\u5f15\u4ecd\u5728\u53d6\u6d88\u90e8\u7f72\u904e\u7a0b\u4e2d\u3002\u60a8\u53ef\u80fd\u9700\u8981\u5237\u65b0 Google Cloud \u63a7\u5236\u6aaf\u700f\u89bd\u5668\u6a19\u7c64\u9801\u624d\u80fd\u770b\u5230\u5df2\u4e0d\u518d\u90e8\u7f72\u7d22\u5f15\u3002\n- \u9ede\u64ca arrow_back \u8fd4\u56de\u7bad\u982d\u4ee5\u8fd4\u56de **\u7d22\u5f15** \u6a19\u7c64\u9801\u3002\n- \u5728\u7d22\u5f15\u5217\u8868\u4e2d\u7684\u7d22\u5f15\u540d\u7a31\u65c1\uff0c\u9ede\u64ca more_vert **\u64cd\u4f5c** \uff0c\u7136\u5f8c\u9ede\u64ca **\u522a\u9664** \u4ee5\u522a\u9664\u7d22\u5f15\u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664\u7d22\u5f15\u7aef\u9ede\uff1a- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Vector Search** \u9801\u9762\u4e2d\u7684 **\u7d22\u5f15\u7aef\u9ede** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230\u201c\u7d22\u5f15\u7aef\u9ede\u201d](https://console.cloud.google.com/vertex-ai/matching-engine/index-endpoints?hl=zh-cn) \n- \u5728\u7d22\u5f15\u7aef\u9ede\u5217\u8868\u4e2d\u7684\u7aef\u9ede\u540d\u7a31\u65c1\uff0c\u9ede\u64ca more_vert **\u64cd\u4f5c** \uff0c\u7136\u5f8c\u9ede\u64ca **\u522a\u9664** \u4ee5\u522a\u9664\u7d22\u5f15\u7aef\u9ede\u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664 Vertex AI Workbench \u5be6\u4f8b\uff1a- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 **Vertex AI** \u90e8\u5206\u4e2d\uff0c\u8f49\u5230 **Workbench** \u9801\u9762\u4e2d\u7684 **\u5be6\u4f8b** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230 Vertex AI Workbench](https://console.cloud.google.com/vertex-ai/workbench/instances?hl=zh-cn) \n- \u9078\u64c7 `workbench-tutorial` Vertex AI Workbench \u5be6\u4f8b\uff0c\u7136\u5f8c\u9ede\u64ca delete **\u522a\u9664** \u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664 Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Compute Engine** \u9801\u9762\u3002 [\u8f49\u5230 Compute Engine](https://console.cloud.google.com/compute/instances?hl=zh-cn) \n- \u9078\u64c7 `on-prem-client` \u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u7136\u5f8c\u9ede\u64ca delete **\u522a\u9664** \u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664 VPN \u96a7\u9053\uff1a- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **VPN** \u9801\u9762\u3002 [\u8f49\u5230 VPN](https://console.cloud.google.com/hybrid/vpn/list?hl=zh-cn) \n- \u5728 **VPN** \u9801\u9762\u4e0a\uff0c\u9ede\u64ca **Cloud VPN \u96a7\u9053** \u6a19\u7c64\u9801\u3002\n- \u5728 VPN \u96a7\u9053\u5217\u8868\u4e2d\uff0c\u9078\u64c7\u60a8\u5728\u672c\u6559\u7a0b\u4e2d\u5275\u5efa\u7684\u56db\u500b VPN \u96a7\u9053\uff0c\u7136\u5f8c\u9ede\u64ca delete **\u522a\u9664** \u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664\u9ad8\u53ef\u7528\u6027 VPN \u7db2\u95dc\uff1a- \u5728 **VPN** \u9801\u9762\u4e0a\uff0c\u9ede\u64ca **Cloud VPN \u7db2\u95dc** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230\u201cCloud VPN \u7db2\u95dc\u201d](https://console.cloud.google.com/hybrid/vpn?tab=gateways&hl=zh-cn) \n- \u5728 VPN \u7db2\u95dc\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `onprem-vpn-gw1` \u3002\n- \u5728 **Cloud VPN \u7db2\u95dc\u8a73\u60c5** \u9801\u9762\u4e2d\uff0c\u9ede\u64ca delete **\u522a\u9664 VPN \u7db2\u95dc** \u3002\n- \u5982\u6709\u5fc5\u8981\uff0c\u8acb\u9ede\u64ca arrow_back \u8fd4\u56de\u7bad\u982d\u4ee5\u8fd4\u56de VPN \u7db2\u95dc\u5217\u8868\uff0c\u7136\u5f8c\u9ede\u64ca `vertex-networking-vpn-gw1` \u3002\n- \u5728 **Cloud VPN \u7db2\u95dc\u8a73\u60c5** \u9801\u9762\u4e2d\uff0c\u9ede\u64ca delete **\u522a\u9664 VPN \u7db2\u95dc** \u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664 Cloud Router \u8def\u7531\u5668\uff1a- \u8f49\u5230 **Cloud Router \u8def\u7531\u5668** \u9801\u9762\u3002 [\u524d\u5f80\u201cCloud Router \u8def\u7531\u5668\u201d](https://console.cloud.google.com/hybrid/routers/list?hl=zh-cn) \n- \u5728 Cloud Router \u8def\u7531\u5668\u5217\u8868\u4e2d\uff0c\u9078\u64c7\u60a8\u5728\u672c\u6559\u7a0b\u4e2d\u5275\u5efa\u7684\u56db\u500b\u8def\u7531\u5668\u3002\n- \u5982\u9700\u522a\u9664\u8def\u7531\u5668\uff0c\u8acb\u9ede\u64ca delete **\u522a\u9664** \u3002\u9019\u9084\u5c07\u522a\u9664\u9023\u63a5\u5230 Cloud Router \u8def\u7531\u5668\u7684\u5169\u500b Cloud NAT \u7db2\u95dc\u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664 `vertex-networking-vpc` VPC \u7db2\u7d61\u7684 `vector-search-endpoint1` \u8f49\u767c\u898f\u5247\uff1a- \u8f49\u5230 **\u8ca0\u8f09\u5747\u8861** \u9801\u9762\u7684 **\u524d\u7aef** \u6a19\u7c64\u9801\u3002 [\u8f49\u5230\u201c\u524d\u7aef\u201d](https://console.cloud.google.com/net-services/loadbalancing/list/frontends?hl=zh-cn) \n- \u5728\u8f49\u767c\u898f\u5247\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `vector-search-endpoint1` \u3002\n- \u5728 **\u8f49\u767c\u898f\u5247\u8a73\u60c5** \u9801\u9762\u4e2d\uff0c\u9ede\u64ca delete **\u522a\u9664** \u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664 VPC \u7db2\u7d61\uff1a- \u8f49\u5230 **VPC \u7db2\u7d61** \u9801\u9762\u3002 [\u9032\u5165 VPC \u7db2\u7d61\u9801\u9762](https://console.cloud.google.com/networking/networks/list?hl=zh-cn) \n- \u5728 VPC \u7db2\u7d61\u5217\u8868\u4e2d\uff0c\u9ede\u64ca `onprem-vpc` \u3002\n- \u5728 **VPC \u7db2\u7d61\u8a73\u60c5** \u9801\u9762\u4e2d\uff0c\u9ede\u64ca delete **\u522a\u9664 VPC \u7db2\u7d61** \u3002\u522a\u9664\u6bcf\u500b\u7db2\u7d61\u6703\u540c\u6642\u522a\u9664\u5176\u5b50\u7db2\u3001\u8def\u7531\u548c\u9632\u706b\u7246\u898f\u5247\u3002\n- \u8fd4\u56de VPC \u7db2\u7d61\u5217\u8868\uff0c\u7136\u5f8c\u9ede\u64ca `vertex-networking-vpc` \u3002\n- \u5728 **VPC \u7db2\u7d61\u8a73\u60c5** \u9801\u9762\u4e2d\uff0c\u9ede\u64ca delete **\u522a\u9664 VPC \u7db2\u7d61** \u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664\u5b58\u5132\u6876\uff1a- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Cloud Storage** \u9801\u9762\u3002 [\u8f49\u5230 Cloud Storage](https://console.cloud.google.com/storage?hl=zh-cn) \n- \u9078\u64c7\u60a8\u7684\u5b58\u5132\u6876\uff0c\u7136\u5f8c\u9ede\u64ca delete **\u522a\u9664** \u3002\n- \u6309\u5982\u4e0b\u65b9\u5f0f\u522a\u9664 `workbench-sa` \u670d\u52d9\u8cec\u865f\uff1a- \u8f49\u5230 **\u670d\u52d9\u8cec\u865f** \u9801\u9762\u3002 [\u8f49\u5230\u201c\u670d\u52d9\u8cec\u865f\u201d](https://console.cloud.google.com/iam-admin/serviceaccounts?hl=zh-cn) \n- \u9078\u64c7 `workbench-sa` \u670d\u52d9\u8cec\u865f\uff0c\u7136\u5f8c\u9ede\u64ca delete **\u522a\u9664** \u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3 [\u7528\u65bc\u8a2a\u554f Vertex AI \u7aef\u9ede\u548c\u670d\u52d9\u7684\u4f01\u696d\u7db2\u7d61\u9078\u9805](https://cloud.google.com/vertex-ai/docs/general/netsec-overview?hl=zh-cn) \n- \u77ad\u89e3 [Private Service Connect \u7684\u5de5\u4f5c\u539f\u7406](https://cloud.google.com/vpc/docs/private-service-connect-architecture?hl=zh-cn) \u53ca\u5176\u63d0\u4f9b\u986f\u8457\u6027\u80fd\u512a\u52e2\u7684\u539f\u56e0\u3002\n- \u77ad\u89e3\u5982\u4f55 [\u4f7f\u7528 VPC Service Controls \u5275\u5efa\u5b89\u5168\u908a\u754c](https://cloud.google.com/vertex-ai/docs/general/vpc-service-controls?hl=zh-cn) \uff0c\u4ee5\u5141\u8a31\u6216\u62d2\u7d55\u901a\u904e\u516c\u5171\u4e92\u806f\u7db2\u8a2a\u554f Vector Search \u7d22\u5f15\u7aef\u9ede\u4e0a\u7684 Vertex AI \u548c\u5176\u4ed6 Google API\u3002\n- \u63a2\u7d22\u6709\u95dc Google Cloud \u7684\u53c3\u8003\u67b6\u69cb\u3001\u5716\u8868\u548c\u6700\u4f73\u505a\u6cd5\u3002\u67e5\u770b\u6211\u5011\u7684 [Cloud Architecture Center](https://cloud.google.com/architecture?hl=zh-cn) \u3002", "guide": "Vertex AI"}