{"title": "Vertex AI - Query public index to get nearest neighbors", "url": "https://cloud.google.com/vertex-ai/docs/start/introduction-unified-platform", "abstract": "# Vertex AI - Query public index to get nearest neighbors\nOnce you've created and deployed the index, you can run queries to get the nearest neighbors.\nHere are some examples for a match query to find the top nearest neighbors using the k-nearest neighbors algorithm (k-NN).\n", "content": "## Example queries for public endpoint\n### Python [View on GitHub](https://github.com/googleapis/python-aiplatform/blob/HEAD/samples/model-builder/vector_search/vector_search_find_neighbors_sample.py) \n```\ndef vector_search_find_neighbors(\u00a0 \u00a0 project: str,\u00a0 \u00a0 location: str,\u00a0 \u00a0 index_endpoint_name: str,\u00a0 \u00a0 deployed_index_id: str,\u00a0 \u00a0 queries: List[List[float]],\u00a0 \u00a0 num_neighbors: int,) -> None:\u00a0 \u00a0 \"\"\"Query the vector search index.\u00a0 \u00a0 Args:\u00a0 \u00a0 \u00a0 \u00a0 project (str): Required. Project ID\u00a0 \u00a0 \u00a0 \u00a0 location (str): Required. The region name\u00a0 \u00a0 \u00a0 \u00a0 index_endpoint_name (str): Required. Index endpoint to run the query\u00a0 \u00a0 \u00a0 \u00a0 against.\u00a0 \u00a0 \u00a0 \u00a0 deployed_index_id (str): Required. The ID of the DeployedIndex to run\u00a0 \u00a0 \u00a0 \u00a0 the queries against.\u00a0 \u00a0 \u00a0 \u00a0 queries (List[List[float]]): Required. A list of queries. Each query is\u00a0 \u00a0 \u00a0 \u00a0 a list of floats, representing a single embedding.\u00a0 \u00a0 \u00a0 \u00a0 num_neighbors (int): Required. The number of neighbors to return.\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 # Initialize the Vertex AI client\u00a0 \u00a0 aiplatform.init(project=project, location=location)\u00a0 \u00a0 # Create the index endpoint instance from an existing endpoint.\u00a0 \u00a0 my_index_endpoint = aiplatform.MatchingEngineIndexEndpoint(\u00a0 \u00a0 \u00a0 \u00a0 index_endpoint_name=index_endpoint_name\u00a0 \u00a0 )\u00a0 \u00a0 # Query the index endpoint for the nearest neighbors.\u00a0 \u00a0 resp = my_index_endpoint.find_neighbors(\u00a0 \u00a0 \u00a0 \u00a0 deployed_index_id=deployed_index_id,\u00a0 \u00a0 \u00a0 \u00a0 queries=queries,\u00a0 \u00a0 \u00a0 \u00a0 num_neighbors=num_neighbors,\u00a0 \u00a0 )\u00a0 \u00a0 print(resp)\n```The `publicEndpointDomainName` listed below can be found at [Deploy](/vertex-ai/docs/vector-search/deploy-index-public) .\n```\n $ curl -X POST -H \"Content-Type: application/json\" -H \"Authorization: Bearer `gcloud auth print-access-token`\" https://1957880287.us-central1-181224308459.vdb.vertexai.goog/v1/projects/181224308459/locations/us-central1/indexEndpoints/3370566089086861312:findNeighbors -d '{deployed_index_id: \"test_index_public1\", queries: [{datapoint: {datapoint_id: \"0\", feature_vector: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}, neighbor_count: 5}]}'\n \n```\nThis curl example demonstrates how to call from `http(s)` clients, although public endpoint supports dual protocol for restful and `grpc_cli` .\n```\n $ curl -X POST -H \"Content-Type: application/json\" -H \"Authorization: Bearer `gcloud auth print-access-token`\" https://1957880287.us-central1-181224308459.vdb.vertexai.goog/v1/projects/${PROJECT_ID}/locations/us-central1/indexEndpoints/${INDEX_ENDPOINT_ID}:readIndexDatapoints -d '{deployed_index_id:\"test_index_public1\", ids: [\"606431\", \"896688\"]}'\n \n```\nUse these instructions to query an index deployed to a public endpoint from the console.- In the Vertex AI section of the Google Cloud console, go to the **Deploy and Use** section. Select **Vector Search** [Go to Vector Search](https://console.cloud.google.com/vertex-ai/matching-engine/indexes) \n- Select the index you want to query. The **Index info** page opens.\n- Scroll down to the **Deployed indexes** section and select the deployed index you want to query. The **Deployed index info** page opens.\n- From the **Query index** section, select your query parameters. You can choose to query by a vector, or a specific data point.\n- Execute the query using the provided curl command, or by running with Cloud Shell.\n- If using Cloud Shell, select **Run in Cloud Shell** .\n- Run in Cloud Shell.\n- The results return nearest neighbors.\nTo see an end-to-end example of how to create an index, how to deploy it to a public endpoint, and how to query, see the official notebook: [Using Vector Search and Vertex AI Embeddings for Text for StackOverflow Questions](https://github.com/GoogleCloudPlatform/vertex-ai-samples/blob/main/notebooks/official/matching_engine/sdk_matching_engine_create_stack_overflow_embeddings_vertex.ipynb) .\n## What's next\n- Learn how to [Update and rebuild your index](/vertex-ai/docs/vector-search/update-rebuild-index) \n- Learn how to [Filter vector matches](/vertex-ai/docs/vector-search/filtering) \n- Learn how to [Monitor an index](/vertex-ai/docs/vector-search/monitor)", "guide": "Vertex AI"}