{"title": "Vertex AI - Vertex AI Pipelines \u4e2d\u7684\u8cc7\u6e90\u52a0\u6a19\u7c64\u529f\u80fd", "url": "https://cloud.google.com/vertex-ai/docs/pipelines/gcpc-label-propagation?hl=zh-cn", "abstract": "# Vertex AI - Vertex AI Pipelines \u4e2d\u7684\u8cc7\u6e90\u52a0\u6a19\u7c64\u529f\u80fd\nVertex AI Pipelines \u53ef\u80fd\u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6\u751f\u6210\u7684\u8cc7\u6e90\uff0c\u4e5f\u53ef\u80fd\u6703\u8981\u6c42\u60a8\u7232\u751f\u6210\u7684\u8cc7\u6e90\u52a0\u6a19\u7c64\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u7d44\u4ef6\u985e\u578b\u3001\u8cc7\u6e90\u548c Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK \u7248\u672c\u3002\u5c0d\u65bc\u7528\u6236\u5b9a\u7fa9\u7684\u7d44\u4ef6\uff0c\u60a8\u9700\u8981\u7de8\u5beb\u7d44\u4ef6\u4ee3\u78bc\u4ee5\u901a\u904e\u74b0\u5883\u8b8a\u91cf\u4f86\u95dc\u806f\u6a19\u7c64\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u901a\u904e\u7528\u6236\u5b9a\u7fa9\u7684\u7d44\u4ef6\u751f\u6210\u7684\u8cc7\u6e90](#user_defined_components) \u3002\n", "content": "## \u5177\u6709\u81ea\u52d5\u52a0\u6a19\u7c64\u529f\u80fd\u7684\u8cc7\u6e90\n\u7121\u8ad6\u4f7f\u7528\u7684\u662f\u54ea\u4e00\u500b Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK \u7248\u672c\uff0cVertex AI Pipelines \u90fd\u6703\u81ea\u52d5\u7232\u4ee5\u4e0b\u8cc7\u6e90\u52a0\u6a19\u7c64\uff1a\n### CustomJob \u500b\u8cc7\u6e90\nVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230 [CustomJob](https://cloud.google.com/vertex-ai/docs/pipelines/customjob-component?hl=zh-cn) \u8cc7\u6e90\u3002\u6240\u6709\u7248\u672c\u7684 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK \u4e2d\u7684\u4ee5\u4e0b\u7d44\u4ef6\u90fd\u652f\u6301\u6b64\u529f\u80fd\uff1a\n- [CustomTrainingJobOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/custom_job.html#v1.custom_job.CustomTrainingJobOp) \n- [create_custom_training_job_from_component](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/custom_job.html#v1.custom_job.create_custom_training_job_from_component) \n- [ForecastingValidationOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/forecasting.html#v1.forecasting.ForecastingValidationOp) \n- [ForecastingPrepareDataForTrainOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/forecasting.html#v1.forecasting.ForecastingPrepareDataForTrainOp) ## Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\u4e2d\u5177\u6709\u81ea\u52d5\u52a0\u6a19\u7c64\u529f\u80fd\u7684\u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u7232\u4ee5\u4e0b\u8cc7\u6e90\u52a0\u6a19\u7c64\uff1a\n### BatchPredictionJob \u500b\u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e [ModelBatchPredictOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/batch_predict_job.html#v1.batch_predict_job.ModelBatchPredictOp) \u7d44\u4ef6\u751f\u6210\u7684 `BatchPredictionJob` \u8cc7\u6e90\u3002\n### Vertex AI endpoint \u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e [EndpointCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/endpoint.html#v1.endpoint.EndpointCreateOp) \u7d44\u4ef6\u751f\u6210\u7684 Vertex AI `endpoint` \u8cc7\u6e90\u3002\n### HyperparameterTuningJob \u500b\u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e [HyperparameterTuningJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/hyperparameter_tuning_job.html#v1.hyperparameter_tuning_job.HyperparameterTuningJobRunOp) \u7d44\u4ef6\u751f\u6210\u7684 `HyperparameterTuningJob` \u8cc7\u6e90\u3002\n### Vertex AI \u6578\u64da\u96c6\u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e\u4ee5\u4e0b [Vertex AI \u7d44\u4ef6](https://cloud.google.com/vertex-ai/docs/pipelines/vertex-automl-component?hl=zh-cn#dataset_operators) \u751f\u6210\u7684 Vertex AI \u6578\u64da\u96c6\u8cc7\u6e90\uff1a\n- [ImageDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/dataset.html#v1.dataset.ImageDatasetCreateOp) \n- [TabularDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/dataset.html#v1.dataset.TabularDatasetCreateOp) \n- [TextDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/dataset.html#v1.dataset.TextDatasetCreateOp) \n- [TimeSeriesDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/dataset.html#v1.dataset.TimeSeriesDatasetCreateOp) \n- [VideoDatasetCreateOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/dataset.html#v1.dataset.VideoDatasetCreateOp) \n### Google Cloud BigQuery \u4f5c\u696d\u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e\u4efb\u4f55 [BigQuery ML \u7d44\u4ef6](https://cloud.google.com/vertex-ai/docs/pipelines/gcpc-list?hl=zh-cn#bqml_components) \u751f\u6210\u7684 Google Cloud BigQuery \u4f5c\u696d\u8cc7\u6e90\u3002\n### Google Cloud Dataproc \u4f5c\u696d\u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e\u4efb\u4f55 [Dataproc Serverless \u7d44\u4ef6](https://cloud.google.com/vertex-ai/docs/pipelines/gcpc-list?hl=zh-cn#dataproc_sl_components) \u751f\u6210\u7684 Google Cloud Dataproc \u4f5c\u696d\u8cc7\u6e90\u3002\n### TrainingPipeline \u548c Model \u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e\u4ee5\u4e0b [AutoML \u7d44\u4ef6](https://cloud.google.com/vertex-ai/docs/pipelines/gcpc-list?hl=zh-cn#experimental_automl_components) \u751f\u6210\u7684 `TrainingPipeline` \u548c `Model` \u8cc7\u6e90\uff1a\n- [AutoMLImageTrainingJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/automl/training_job.html#v1.automl.training_job.AutoMLImageTrainingJobRunOp) \n- [AutoMLTextTrainingJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/automl/training_job.html#v1.automl.training_job.AutoMLTextTrainingJobRunOp) \n- [AutoMLVideoTrainingJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/automl/training_job.html#v1.automl.training_job.AutoMLVideoTrainingJobRunOp) \n- [AutoMLForecastingTrainingJobRunOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/automl/training_job.html#v1.automl.training_job.AutoMLForecastingTrainingJobRunOp) \n### Google Cloud BigQuery \u8868\u8cc7\u6e90\n\u5982\u679c\u60a8\u4f7f\u7528 Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK v1.0.31 \u6216\u66f4\u9ad8\u7248\u672c\uff0cVertex AI Pipelines \u6703\u81ea\u52d5\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e [ForecastingPreprocessingOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/forecasting.html#v1.forecasting.ForecastingPreprocessingOp) \u7d44\u4ef6\u751f\u6210\u7684 Google Cloud BigQuery \u8868\u8cc7\u6e90\u3002\n## \u4e0d\u5177\u6709\u81ea\u52d5\u52a0\u6a19\u7c64\u529f\u80fd\u7684\u8cc7\u6e90\n\u7121\u8ad6\u4f7f\u7528\u7684\u662f\u54ea\u4e00\u500b Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6 SDK \u7248\u672c\uff0cVertex AI Pipelines \u90fd\u4e0d\u6703\u81ea\u52d5\u7232\u4ee5\u4e0b\u8cc7\u6e90\u52a0\u6a19\u7c64\uff1a\n### Google Cloud Dataflow \u8cc7\u6e90\nVertex AI Pipelines \u4e0d\u6703\u81ea\u52d5\u7232 [DataflowPythonJobOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/dataflow.html#v1.dataflow.DataflowPythonJobOp) \u7d44\u4ef6\u751f\u6210\u7684 Dataflow \u8cc7\u6e90\u52a0\u6a19\u7c64\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u5728\u4ee3\u78bc\u4e2d\u6dfb\u52a0\u76f8\u95dc\u6307\u4ee4\u4f86\u7232\u6b64\u985e\u8cc7\u6e90\u52a0\u6a19\u7c64\u3002\n\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u78bc\u793a\u4f8b\u5c07\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u4e2d\u7684\u7d50\u7b97\u6a19\u7c64\u50b3\u64ad\u5230\u4f7f\u7528 [DataflowPythonJobOp](https://google-cloud-pipeline-components.readthedocs.io/en/google-cloud-pipeline-components-2.8.0/api/v1/dataflow.html#v1.dataflow.DataflowPythonJobOp) \u7d44\u4ef6\u751f\u6210\u7684\u4efb\u4f55 Google Cloud Dataflow \u8cc7\u6e90\uff1a\n```\n\u00a0 import argparse\u00a0 import apache_beam as beam\u00a0 ...\u00a0 def run(argv=None):\u00a0 \u00a0 parser = argparse.ArgumentParser()\u00a0 \u00a0 # Don't add `--labels` to the argument list, so that they will be passed to the pipeline_options\u00a0 \u00a0 parser.add_argument('--input', \u2026)\u00a0 \u00a0 parser.add_argument('--output', \u2026)\u00a0 ...\u00a0 \u00a0 known_args, pipeline_args = parser.parse_known_args(argv)\u00a0 \u00a0 pipeline_options = PipelineOptions(pipeline_args)\u00a0 \u00a0 with beam.Pipeline(options=pipeline_options) as p:\n```\n### \u901a\u904e\u7528\u6236\u5b9a\u7fa9\u7684\u7d44\u4ef6\u751f\u6210\u7684\u8cc7\u6e90\nVertex AI Pipelines \u4e0d\u6703\u81ea\u52d5\u7232\u901a\u904e\u7528\u6236\u5b9a\u7fa9\u7684\u7d44\u4ef6\u751f\u6210\u7684 Google Cloud \u8cc7\u6e90\u52a0\u6a19\u7c64\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u5728\u4ee3\u78bc\u4e2d\u6dfb\u52a0\u76f8\u95dc\u6307\u4ee4\u4f86\u6aa2\u7d22\u74b0\u5883\u8b8a\u91cf `VERTEX_AI_PIPELINES_RUN_LABELS` \u4e2d\u7684\u6a19\u7c64\uff0c\u4e26\u5c07\u9019\u4e9b\u6a19\u7c64\u95dc\u806f\u5230\u5728\u904b\u884c\u6642\u4f7f\u7528\u7d44\u4ef6\u751f\u6210\u7684 Google Cloud \u8cc7\u6e90\u3002\n\u74b0\u5883\u8b8a\u91cf `VERTEX_AI_PIPELINE_RUN_LABELS` \u5305\u542b JSON \u683c\u5f0f\u7684\u6a19\u7c64\uff0c\u5b83\u5011\u662f\u4e00\u4e9b\u9375\u503c\u5c0d\u3002\n\u4f8b\u5982\uff1a `{ \"label1_key\": \"label1_value\", \"label2_key\": \"label2_value\", ...}`\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Python \u7248 Vertex AI SDK\uff0c\u8acb\u5728\u7d44\u4ef6\u4ee3\u78bc\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u78bc\u793a\u4f8b\uff0c\u5c07\u74b0\u5883\u8b8a\u91cf\u4e2d\u7684\u6a19\u7c64\u50b3\u64ad\u5230\u901a\u904e\u7d44\u4ef6\u751f\u6210\u7684\u65b0\u8cc7\u6e90\uff1a\n```\nimport osimport jsonfrom google.cloud import aiplatformaiplatform.init(\u00a0 project='PROJECT_ID',\u00a0 location='LOCATION')aiplatform.RESOURCE.create(\u00a0 ...\u00a0 json.loads(os.getenv(\"VERTEX_AI_PIPELINES_RUN_LABELS\")))\n```\n\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- \uff1a\u5728\u5176\u4e2d\u904b\u884c\u6b64\u6d41\u6c34\u7dda\u7684 Google Cloud \u9805\u76ee\u3002\n- \uff1a\u6b64\u6d41\u6c34\u7dda\u7684\u904b\u884c\u4f4d\u7f6e\u6216\u5340\u57df\u3002\n- \uff1a\u901a\u904e\u7d44\u4ef6\u751f\u6210\u7684 Google Cloud \u8cc7\u6e90\uff0c\u4f8b\u5982 `CustomJob` \u6216 `Model` \u3002\n\u5982\u679c\u8981\u4f7f\u7528 Python \u4f86\u89e3\u6790\u74b0\u5883\u8b8a\u91cf\uff0c\u5247\u4e5f\u53ef\u4f7f\u7528 `gcp_labels_util.attach_system_labels` \u5be6\u7528\u7a0b\u5e8f\u3002\u53ea\u6709\u5728\u60a8\u6709\u6b0a\u8a2a\u554f Google Cloud \u6d41\u6c34\u7dda\u7d44\u4ef6\u5eab\u4e26\u4e14\u4f7f\u7528\u7684\u662f Python \u6642\uff0c\u624d\u80fd\u4f7f\u7528\u6b64\u5be6\u7528\u7a0b\u5e8f\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [GitHub \u4e2d\u7684\u5be6\u7528\u51fd\u6578\u6e90\u4ee3\u78bc](https://github.com/kubeflow/pipelines/blob/master/components/google-cloud/google_cloud_pipeline_components/container/v1/gcp_launcher/utils/gcp_labels_util.py) \u3002\n## \u4e0d\u652f\u6301\u52a0\u6a19\u7c64\u529f\u80fd\u7684\u8cc7\u6e90\nVertex AI Pipelines \u4e0d\u652f\u6301\u5c07\u7d50\u7b97\u6a19\u7c64\u50b3\u64ad\u5230\u4ee5\u4e0b\u8cc7\u6e90\uff1a\n### ML Metadata \u8cc7\u6e90\nML Metadata \u8cc7\u6e90\u662f\u5728\u5b58\u5132\u5340\u7d1a\u5c64\u8a08\u8cbb\u7684\u3002\u60a8\u7121\u6cd5\u4f7f\u7528\u7d50\u7b97\u6a19\u7c64\u4f86\u4e86\u89e3\u8cc7\u6e90\u7d1a\u8cbb\u7528\u3002\n### Cloud Storage \u8cc7\u6e90\nVertex AI Pipelines \u4e0d\u6703\u5c07\u7d50\u7b97\u6a19\u7c64\u50b3\u64ad\u5230 Cloud Storage \u8cc7\u6e90\uff0c\u4f8b\u5982 Cloud Storage \u5b58\u5132\u6876\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- [\u77ad\u89e3\u6d41\u6c34\u7dda\u904b\u884c\u4f5c\u696d\u7684\u8cbb\u7528](https://cloud.google.com/vertex-ai/docs/pipelines/understand-pipeline-cost-labels?hl=zh-cn)", "guide": "Vertex AI"}