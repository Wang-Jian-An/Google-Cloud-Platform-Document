{"title": "Vertex AI - \u7ba1\u7406\u7d22\u5f15", "url": "https://cloud.google.com/vertex-ai/docs/vector-search/create-manage-index?hl=zh-cn", "abstract": "# Vertex AI - \u7ba1\u7406\u7d22\u5f15\n\u4ee5\u4e0b\u90e8\u5206\u4ecb\u7d39\u77ad\u5982\u4f55\u914d\u7f6e\u3001\u5275\u5efa\u3001\u5217\u51fa\u548c\u522a\u9664\u7d22\u5f15\u3002\n", "content": "## \u7d22\u5f15\u6982\u89bd\n\u7d22\u5f15\u662f\u7531\u5d4c\u5165\u5411\u91cf\u7d44\u6210\u7684\u4e00\u500b\u6216\u591a\u500b\u6587\u4ef6\u3002\u9019\u4e9b\u5411\u91cf\u7531\u60a8\u8981\u4f7f\u7528 Vector Search \u90e8\u7f72\u548c\u67e5\u8a62\u7684\u5927\u91cf\u6578\u64da\u7d44\u6210\u3002\u85c9\u52a9 Vector Search\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa\u5169\u7a2e\u985e\u578b\u7684\u7d22\u5f15\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u60a8\u8a08\u5283\u4f7f\u7528\u6578\u64da\u66f4\u65b0\u7d22\u5f15\u7684\u65b9\u5f0f\u3002\u60a8\u53ef\u4ee5\u5275\u5efa\u7232 [\u6279\u91cf\u66f4\u65b0](#create-index-batch) \u8a2d\u8a08\u7684\u7d22\u5f15\uff0c\u6216\u7232 [\u6d41\u5f0f\u66f4\u65b0](#create-stream-index) \u8a2d\u8a08\u7684\u7d22\u5f15\u3002\n\u5982\u679c\u60a8\u8981\u4f7f\u7528\u5728\u8a2d\u5b9a\u7684\u6642\u9593\u5167\u5b58\u5132\u7684\u6578\u64da\uff08\u4f8b\u5982\u6bcf\u9031\u6216\u6bcf\u6708\u8655\u7406\u7684\u7cfb\u7d71\uff09\u6279\u91cf\u66f4\u65b0\u7d22\u5f15\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528\u6279\u91cf\u7d22\u5f15\u3002\u5982\u679c\u60a8\u5e0c\u671b\u5728\u6709\u65b0\u6578\u64da\u6dfb\u52a0\u5230\u6578\u64da\u5b58\u5132\u5340\u6642\u66f4\u65b0\u7d22\u5f15\u6578\u64da\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528\u6d41\u5f0f\u7d22\u5f15\uff0c\u4f8b\u5982\uff0c\u60a8\u6709\u4e00\u5bb6\u66f8\u5e97\uff0c\u5e0c\u671b\u5118\u5feb\u5728\u7dda\u986f\u793a\u65b0\u7684\u5eab\u5b58\u3002\u60a8\u9078\u64c7\u7684\u985e\u578b\u5f88\u91cd\u8981\uff0c\u56e0\u7232\u8a2d\u7f6e\u548c\u8981\u6c42\u4e0d\u540c\u3002\n## \u914d\u7f6e\u7d22\u5f15\u53c3\u6578\n\u5728 [\u5275\u5efa\u7d22\u5f15](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.indexes/create?hl=zh-cn) \u4e4b\u524d\uff0c\u8acb\u914d\u7f6e\u7d22\u5f15\u7684\u53c3\u6578\u3002\n\u4f8b\u5982\uff0c\u5275\u5efa\u4e00\u500b\u540d\u7232 `index_metadata.json` \u7684\u6587\u4ef6\uff1a\n```\n{\n \"contentsDeltaUri\": \"gs://BUCKET_NAME/path\",\n \"config\": {\n \"dimensions\": 100,\n \"approximateNeighborsCount\": 150,\n \"distanceMeasureType\": \"DOT_PRODUCT_DISTANCE\",\n \"shardSize\": \"SHARD_SIZE_MEDIUM\",\n \"algorithm_config\": {\n  \"treeAhConfig\": {\n  \"leafNodeEmbeddingCount\": 5000,\n  \"leafNodesToSearchPercent\": 3\n  }\n }\n }\n}\n```\n\u60a8\u53ef\u4ee5\u5728 [\u914d\u7f6e\u7d22\u5f15](https://cloud.google.com/vertex-ai/docs/vector-search/configuring-indexes?hl=zh-cn) \u4e2d\u627e\u5230\u5176\u4e2d\u6bcf\u500b\u5b57\u6bb5\u7684\u5b9a\u7fa9\u3002\n## \u5275\u5efa\u7d22\u5f15\n### \u7d22\u5f15\u5927\u5c0f\n\u7d22\u5f15\u6578\u64da\u88ab\u62c6\u5206\u6210\u76f8\u7b49\u7684\u90e8\u5206\uff08\u7a31\u7232\u5206\u7247\uff09\u4ee5\u9032\u884c\u8655\u7406\u3002\u5275\u5efa\u7d22\u5f15\u6642\uff0c\u60a8\u5fc5\u9808\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u5206\u7247\u7684\u5927\u5c0f\u3002\u652f\u6301\u7684\u5c3a\u5bf8\u5982\u4e0b\u6240\u793a\uff1a\n- `SHARD_SIZE_SMALL`\uff1a\u6bcf\u500b\u5206\u7247 2 GiB\u3002\n- `SHARD_SIZE_MEDIUM`\uff1a\u6bcf\u500b\u5206\u7247 20 GiB\u3002\n- `SHARD_SIZE_LARGE`\uff1a\u6bcf\u500b\u5206\u7247 50 GiB\u3002\n\u53ef\u7528\u65bc\u90e8\u7f72\u7d22\u5f15\u7684\u6a5f\u5668\u985e\u578b\uff08 [\u4f7f\u7528\u516c\u5171\u7aef\u9ede](https://cloud.google.com/vertex-ai/docs/vector-search/deploy-index-public?hl=zh-cn) \u6216 [\u4f7f\u7528 VPC \u7aef\u9ede](https://cloud.google.com/vertex-ai/docs/vector-search/deploy-index-vpc?hl=zh-cn) \uff09\u53d6\u6c7a\u65bc\u7d22\u5f15\u7684\u5206\u7247\u5927\u5c0f\u3002\u4e0b\u8868\u986f\u793a\u4e86\u6bcf\u7a2e\u6a5f\u5668\u985e\u578b\u652f\u6301\u7684\u5206\u7247\u5927\u5c0f\uff1a\n| \u6a5f\u5668\u985e\u578b  | SHARD_SIZE_SMALL | SHARD_SIZE_MEDIUM | SHARD_SIZE_LARGE |\n|:----------------|:-------------------|:--------------------|:-------------------|\n| n1-standard-16 | nan    | nan     | nan    |\n| n1-standard-32 | nan    | nan     | nan    |\n| e2-standard-2 | \uff08\u9ed8\u8a8d\uff09   | nan     | nan    |\n| e2-standard-16 | nan    | \uff08\u9ed8\u8a8d\uff09   | nan    |\n| e2-highmem-16 | nan    | nan     | \uff08\u9ed8\u8a8d\uff09   |\n| n2d-standard-32 | nan    | nan     | nan    |\n\u5982\u9700\u77ad\u89e3\u5206\u7247\u5927\u5c0f\u548c\u6a5f\u5668\u985e\u578b\u5c0d\u50f9\u683c\u7684\u5f71\u97ff\uff0c\u8acb\u53c3\u95b1 [Vertex AI \u50f9\u683c\u9801\u9762](https://cloud.google.com/vertex-ai/pricing?hl=zh-cn#vectorsearch) \u3002\n### \u5275\u5efa\u7d22\u5f15\u4ee5\u9032\u884c\u6279\u91cf\u66f4\u65b0\n\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u5275\u5efa\u548c\u90e8\u7f72\u7d22\u5f15\u3002\u5982\u679c\u60a8\u5c1a\u672a\u6e96\u5099\u597d\u5d4c\u5165\uff0c\u5247\u53ef\u4ee5\u8df3\u5230 [\u5275\u5efa\u7a7a\u6279\u91cf\u7d22\u5f15](#create-empty-index-batch) \u3002\u5982\u679c\u4f7f\u7528\u6b64\u9078\u9805\uff0c\u5728\u5275\u5efa\u7d22\u5f15\u6642\u4e0d\u9700\u8981\u5d4c\u5165\u6578\u64da\u3002\n\u5982\u9700 [\u5275\u5efa\u7d22\u5f15](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.indexes/create?hl=zh-cn) \uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n\u5728\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u5143\u6578\u64da\u6587\u4ef6\u7684\u672c\u5730\u8def\u5f91\u3002\n- \uff1a\u7d22\u5f15\u7684\u986f\u793a\u540d\u7a31\u3002\n- \uff1a\u60a8\u5728\u5176\u4e2d\u4f7f\u7528 Vertex AI \u7684\u5340\u57df\u3002\n- \uff1a\u60a8\u7684 Google Cloud [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n\u60a8\u61c9\u8a72\u6703\u6536\u5230\u985e\u4f3c\u5982\u4e0b\u6240\u793a\u7684\u97ff\u61c9\uff1a\n```\nYou can poll for the status of the operation for the response\nto include \"done\": true. Use the following example to poll the status.\n $ gcloud ai operations describe 1234567890123456789 --project=my-test-project --region=us-central1\n```\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 `describe` \u547d\u4ee4\uff0c\u8acb\u53c3\u95b1 [gcloud ai operations](https://cloud.google.com/sdk/gcloud/reference/ai/operations/describe?hl=zh-cn) \u3002\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u7d22\u5f15\u5167\u5bb9\u7684 Cloud Storage \u76ee\u9304\u8def\u5f91\u3002\n- \uff1a\u7d22\u5f15\u7684\u986f\u793a\u540d\u7a31\u3002\n- \uff1a\u60a8\u5728\u5176\u4e2d\u4f7f\u7528 Vertex AI \u7684\u5340\u57df\u3002\n- \uff1a\u60a8\u7684 Google Cloud [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n- \uff1a\u81ea\u52d5\u751f\u6210\u7684 [\u9805\u76ee\u7de8\u865f](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://LOCATION-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/indexes\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"display_name\": \"INDEX_NAME\",\n \"metadata\": {\n \"contentsDeltaUri\": \"INPUT_DIR\",\n \"config\": {\n  \"dimensions\": 100,\n  \"approximateNeighborsCount\": 150,\n  \"distanceMeasureType\": \"DOT_PRODUCT_DISTANCE\",\n  \"algorithm_config\": {\n  \"treeAhConfig\": {\n   \"leafNodeEmbeddingCount\": 500,\n   \"leafNodesToSearchPercent\": 7\n  }\n  }\n }\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_NUMBER/locations/LOCATION/indexes/INDEX_ID/operations/OPERATION_ID\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.aiplatform.v1.CreateIndexOperationMetadata\",\n \"genericMetadata\": {\n  \"createTime\": \"2022-01-08T01:21:10.147035Z\",\n  \"updateTime\": \"2022-01-08T01:21:10.147035Z\"\n }\n }\n}\n```\n\u4ee5\u4e0b\u793a\u4f8b\u4f7f\u7528 [google_vertex_ai_index](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/vertex_ai_index) Terraform \u8cc7\u6e90\u7232\u6279\u91cf\u66f4\u65b0\u5275\u5efa\u7d22\u5f15\u3002\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u61c9\u7528\u6216\u79fb\u9664 Terraform \u914d\u7f6e\uff0c\u8acb\u53c3\u95b1 [\u57fa\u672c Terraform \u547d\u4ee4](https://cloud.google.com/docs/terraform/basic-commands?hl=zh-cn) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/terraform-google-modules/terraform-docs-samples/blob/HEAD/vertex_ai/index/main.tf) \n```\n# Cloud Storage bucket name must be uniqueresource \"random_id\" \"bucket_name_suffix\" {\u00a0 byte_length = 8}# Create a Cloud Storage bucketresource \"google_storage_bucket\" \"bucket\" {\u00a0 name \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0= \"vertex-ai-index-bucket-${random_id.bucket_name_suffix.hex}\"\u00a0 location \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0= \"us-central1\"\u00a0 uniform_bucket_level_access = true}# Create index contentresource \"google_storage_bucket_object\" \"data\" {\u00a0 name \u00a0 \u00a0= \"contents/data.json\"\u00a0 bucket \u00a0= google_storage_bucket.bucket.name\u00a0 content = <<EOF{\"id\": \"42\", \"embedding\": [0.5, 1.0], \"restricts\": [{\"namespace\": \"class\", \"allow\": [\"cat\", \"pet\"]},{\"namespace\": \"category\", \"allow\": [\"feline\"]}]}{\"id\": \"43\", \"embedding\": [0.6, 1.0], \"restricts\": [{\"namespace\": \"class\", \"allow\": [\"dog\", \"pet\"]},{\"namespace\": \"category\", \"allow\": [\"canine\"]}]}EOF}resource \"google_vertex_ai_index\" \"default\" {\u00a0 region \u00a0 \u00a0 \u00a0 = \"us-central1\"\u00a0 display_name = \"sample-index-batch-update\"\u00a0 description \u00a0= \"A sample index for batch update\"\u00a0 labels = {\u00a0 \u00a0 foo = \"bar\"\u00a0 }\u00a0 metadata {\u00a0 \u00a0 contents_delta_uri = \"gs://${google_storage_bucket.bucket.name}/contents\"\u00a0 \u00a0 config {\u00a0 \u00a0 \u00a0 dimensions \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0= 2\u00a0 \u00a0 \u00a0 approximate_neighbors_count = 150\u00a0 \u00a0 \u00a0 distance_measure_type \u00a0 \u00a0 \u00a0 = \"DOT_PRODUCT_DISTANCE\"\u00a0 \u00a0 \u00a0 algorithm_config {\u00a0 \u00a0 \u00a0 \u00a0 tree_ah_config {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 leaf_node_embedding_count \u00a0 \u00a0= 500\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 leaf_nodes_to_search_percent = 7\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 }\u00a0 index_update_method = \"BATCH_UPDATE\"\u00a0 timeouts {\u00a0 \u00a0 create = \"2h\"\u00a0 \u00a0 update = \"1h\"\u00a0 }}\n```\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u6216\u66f4\u65b0 Python\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Python \u7248 Vertex AI SDK](https://cloud.google.com/vertex-ai/docs/start/use-vertex-ai-python-sdk?hl=zh-cn) \u3002   \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [   Python API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/python/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/googleapis/python-aiplatform/blob/HEAD/samples/model-builder/vector_search/vector_search_create_index_sample.py) \n```\ndef vector_search_create_index(\u00a0 \u00a0 project: str, location: str, display_name: str, gcs_uri: Optional[str] = None) -> None:\u00a0 \u00a0 \"\"\"Create a vector search index.\u00a0 \u00a0 Args:\u00a0 \u00a0 \u00a0 \u00a0 project (str): Required. Project ID\u00a0 \u00a0 \u00a0 \u00a0 location (str): Required. The region name\u00a0 \u00a0 \u00a0 \u00a0 display_name (str): Required. The index display name\u00a0 \u00a0 \u00a0 \u00a0 gcs_uri (str): Optional. The Google Cloud Storage uri for index content\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 # Initialize the Vertex AI client\u00a0 \u00a0 aiplatform.init(project=project, location=location, staging_bucket=gcs_uri)\u00a0 \u00a0 # Create Index\u00a0 \u00a0 index = aiplatform.MatchingEngineIndex.create_tree_ah_index(\u00a0 \u00a0 \u00a0 \u00a0 display_name=display_name,\u00a0 \u00a0 \u00a0 \u00a0 description=\"Matching Engine Index\",\u00a0 \u00a0 \u00a0 \u00a0 dimensions=100,\u00a0 \u00a0 \u00a0 \u00a0 approximate_neighbors_count=150,\u00a0 \u00a0 \u00a0 \u00a0 leaf_node_embedding_count=500,\u00a0 \u00a0 \u00a0 \u00a0 leaf_nodes_to_search_percent=7,\u00a0 \u00a0 \u00a0 \u00a0 index_update_method=\"batch_update\", \u00a0# Options: stream_update, batch_update\u00a0 \u00a0 \u00a0 \u00a0 distance_measure_type=aiplatform.matching_engine.matching_engine_index_config.DistanceMeasureType.DOT_PRODUCT_DISTANCE,\u00a0 \u00a0 )\u00a0 \u00a0 print(index.name)\n```\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u7232\u6279\u91cf\u66f4\u65b0\u5275\u5efa\u7d22\u5f15\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80 **\u90e8\u7f72\u548c\u4f7f\u7528** \u90e8\u5206\u3002\u9078\u64c7 **Vector Search** [\u524d\u5f80 Vector Search](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn) \n- \u9ede\u64ca **add_box \u5275\u5efa\u65b0\u7d22\u5f15** \uff0c\u6253\u958b **\u7d22\u5f15** \u7a97\u683c\u3002\u7cfb\u7d71\u6703\u986f\u793a **\u5275\u5efa\u65b0\u7d22\u5f15** \u7a97\u683c\u3002\n- \u5728 **\u986f\u793a\u540d\u7a31** \u5b57\u6bb5\u4e2d\uff0c\u63d0\u4f9b\u4e00\u500b\u53ef\u552f\u4e00\u6a19\u8b58\u7d22\u5f15\u7684\u540d\u7a31\u3002\n- \u5728 **\u8aaa\u660e** \u5b57\u6bb5\u4e2d\uff0c\u63d0\u4f9b\u7d22\u5f15\u7684\u7528\u9014\u7684\u8aaa\u660e\u3002\n- \u5728 **\u5340\u57df** \u5b57\u6bb5\u4e2d\uff0c\u5f9e\u4e0b\u62c9\u5217\u8868\u9078\u64c7\u4e00\u500b\u5340\u57df\u3002\n- \u5728 Cloud Storage \u5b57\u6bb5\u4e2d\uff0c\u641c\u7d22\u4e26\u9078\u64c7\u5b58\u5132\u5411\u91cf\u6578\u64da\u7684 Cloud Storage \u6587\u4ef6\u593e\u3002\n- \u5728 **\u7b97\u6cd5\u985e\u578b** \u4e0b\u62c9\u5217\u8868\u4e2d\uff0c\u9078\u64c7 Vector Search \u7528\u65bc\u9ad8\u6548\u641c\u7d22\u7684\u7b97\u6cd5\u985e\u578b\u3002\u5982\u679c\u60a8\u9078\u64c7 treeAh \u7b97\u6cd5\uff0c\u8acb\u8f38\u5165\u8fd1\u4f3c\u76f8\u9130\u9805\u6578\u91cf\u3002\n- \u5728 **\u7dad\u5ea6** \u5b57\u6bb5\u4e2d\uff0c\u586b\u5beb\u8f38\u5165\u5411\u91cf\u7684\u7dad\u5ea6\u6578\u91cf\u3002\n- \u5728 **\u66f4\u65b0\u65b9\u6cd5** \u5b57\u6bb5\u4e2d\uff0c\u9078\u64c7 **\u6279\u91cf** \u3002\n- \u5728 **\u5206\u7247\u5927\u5c0f** \u5b57\u6bb5\u4e2d\uff0c\u5f9e\u4e0b\u62c9\u5217\u8868\u9078\u64c7\u6240\u9700\u7684\u5206\u7247\u5927\u5c0f\u3002\n- \u9ede\u64ca **\u5275\u5efa** \u3002\u65b0\u7d22\u5f15\u6e96\u5099\u5c31\u7dd2\u5f8c\uff0c\u4fbf\u6703\u986f\u793a\u5728\u7d22\u5f15\u5217\u8868\u4e2d\u3002\u6ce8\u610f\uff1a\u69cb\u5efa\u6642\u9593\u6700\u591a\u53ef\u80fd\u9700\u8981\u4e00\u500b\u5c0f\u6642\u624d\u80fd\u5b8c\u6210\u3002\u5982\u9700\u7acb\u5373\u5275\u5efa\u548c\u90e8\u7f72\u7d22\u5f15\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa\u7a7a\u6279\u91cf\u7d22\u5f15\u3002\u5982\u679c\u4f7f\u7528\u6b64\u9078\u9805\uff0c\u5728\u5275\u5efa\u7d22\u5f15\u6642\u4e0d\u9700\u8981\u5d4c\u5165\u6578\u64da\u3002\n\u5982\u9700\u5275\u5efa\u7a7a\u7d22\u5f15\uff0c\u8a72\u8acb\u6c42\u8207\u7232\u6279\u91cf\u66f4\u65b0\u5275\u5efa\u7d22\u5f15\u5e7e\u4e4e\u5b8c\u5168\u76f8\u540c\u3002\u4e0d\u540c\u4e4b\u8655\u5728\u65bc\uff0c\u9700\u8981\u79fb\u9664 `contentsDeltaUri` \u5b57\u6bb5\uff0c\u56e0\u7232\u60a8\u6c92\u6709\u95dc\u806f\u6578\u64da\u4f4d\u7f6e\u3002\u4e0b\u9762\u662f\u4e00\u500b\u7a7a\u6279\u91cf\u7d22\u5f15\u793a\u4f8b\uff1a\n```\n{\n \"display_name\": INDEX_NAME,\n \"indexUpdateMethod\": \"BATCH_UPDATE\",\n \"metadata\": {\n \"config\": {\n  \"dimensions\": 100,\n  \"approximateNeighborsCount\": 150,\n  \"distanceMeasureType\": \"DOT_PRODUCT_DISTANCE\",\n  \"algorithm_config\": {\n  \"treeAhConfig\": {\n   \"leafNodeEmbeddingCount\": 500,\n   \"leafNodesToSearchPercent\": 7\n  }\n  }\n }\n }\n}\n \n```\n### \u7232\u6d41\u5f0f\u66f4\u65b0\u5275\u5efa\u7d22\u5f15\n\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u5275\u5efa\u548c\u90e8\u7f72\u6d41\u5f0f\u7d22\u5f15\u3002\u5982\u679c\u60a8\u5c1a\u672a\u6e96\u5099\u597d\u5d4c\u5165\uff0c\u8acb\u8df3\u5230 [\u7232\u6d41\u5f0f\u66f4\u65b0\u5275\u5efa\u7a7a\u7d22\u5f15](#create-stream-index-empty) \u3002\u5982\u679c\u4f7f\u7528\u6b64\u9078\u9805\uff0c\u5728\u5275\u5efa\u7d22\u5f15\u6642\u4e0d\u9700\u8981\u5d4c\u5165\u6578\u64da\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u7d22\u5f15\u7684\u986f\u793a\u540d\u7a31\u3002\n- \uff1a\u7d22\u5f15\u7684\u8aaa\u660e\u3002\n- \uff1a\u7d22\u5f15\u5167\u5bb9\u7684 Cloud Storage \u76ee\u9304\u8def\u5f91\u3002\n- \uff1a\u5d4c\u5165\u5411\u91cf\u7684\u7dad\u5ea6\u6578\u3002\n- \uff1a\u60a8\u7684 Google Cloud [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n- \uff1a\u81ea\u52d5\u751f\u6210\u7684 [\u9805\u76ee\u7de8\u865f](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n- \uff1a\u60a8\u5728\u5176\u4e2d\u4f7f\u7528 Vertex AI \u7684\u5340\u57df\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://ENDPOINT-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/indexes\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n displayName: \"INDEX_NAME\",\n description: \"DESCRIPTION\",\n metadata: {\n  contentsDeltaUri: \"INPUT_DIR\",\n  config: {\n  dimensions: \"DIMENSIONS\",\n  approximateNeighborsCount: 150,\n  distanceMeasureType: \"DOT_PRODUCT_DISTANCE\",\n  algorithmConfig: {treeAhConfig: {leafNodeEmbeddingCount: 10000, leafNodesToSearchPercent: 2}}\n  },\n },\n indexUpdateMethod: \"STREAM_UPDATE\"\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_NUMBER/locations/LOCATION/operations/OPERATION_ID\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.aiplatform.ui.CreateIndexOperationMetadata\",\n \"genericMetadata\": {\n  \"createTime\": \"2023-12-05T23:17:45.416117Z\",\n  \"updateTime\": \"2023-12-05T23:17:45.416117Z\",\n  \"state\": \"RUNNING\",\n  \"worksOn\": [  \"projects/PROJECT_NUMBER/locations/LOCATION/indexes/INDEX_ID\"\n  ]\n }\n }\n}\n```\n\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u7232\u6d41\u5f0f\u66f4\u65b0\u5275\u5efa\u7d22\u5f15\u3002\n\u8981 [\u5275\u5efa\u7d22\u5f15](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.indexes/create?hl=zh-cn)  [\u4ee5\u4f9b\u6d41\u5f0f\u66f4\u65b0\u4f7f\u7528\uff0c\u9700\u8981\u57f7\u884c\u8207\u8a2d\u7f6e\u6279\u91cf\u66f4\u65b0\u7d22\u5f15\u985e\u4f3c\u7684\u6b65\u9a5f\uff0c\u4f46\u9700\u8981\u5c07 indexUpdateMethod \u8a2d\u7f6e\u7232 STREAM_UPDATE\u3002](None) \n [](None) \n- [](None) \n- [\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80\u90e8\u7f72\u548c\u4f7f\u7528\u90e8\u5206\u3002\u9078\u64c7 Vector Search\u3002](None) [](None)  [\u524d\u5f80 Vector Search](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn) \n- \u9ede\u64ca **add_box \u5275\u5efa\u65b0\u7d22\u5f15** \uff0c\u6253\u958b **\u7d22\u5f15** \u7a97\u683c\u3002\u7cfb\u7d71\u6703\u986f\u793a **\u5275\u5efa\u65b0\u7d22\u5f15** \u7a97\u683c\u3002\n- \u5728 **\u986f\u793a\u540d\u7a31** \u5b57\u6bb5\u4e2d\uff0c\u63d0\u4f9b\u4e00\u500b\u53ef\u552f\u4e00\u6a19\u8b58\u7d22\u5f15\u7684\u540d\u7a31\u3002\n- \u5728 **\u8aaa\u660e** \u5b57\u6bb5\u4e2d\uff0c\u63d0\u4f9b\u7d22\u5f15\u7684\u7528\u9014\u7684\u8aaa\u660e\u3002\n- \u5728 **\u5340\u57df** \u5b57\u6bb5\u4e2d\uff0c\u5f9e\u4e0b\u62c9\u5217\u8868\u9078\u64c7\u4e00\u500b\u5340\u57df\u3002\n- \u5728 Cloud Storage \u5b57\u6bb5\u4e2d\uff0c\u641c\u7d22\u4e26\u9078\u64c7\u5b58\u5132\u5411\u91cf\u6578\u64da\u7684 Cloud Storage \u6587\u4ef6\u593e\u3002\n- \u5728 **\u7b97\u6cd5\u985e\u578b** \u4e0b\u62c9\u5217\u8868\u4e2d\uff0c\u9078\u64c7 Vector Search \u5c07\u7528\u65bc\u57f7\u884c\u641c\u7d22\u7684\u7b97\u6cd5\u985e\u578b\u3002\u5982\u679c\u60a8\u9078\u64c7 treeAh \u7b97\u6cd5\uff0c\u8acb\u8f38\u5165\u8fd1\u4f3c\u76f8\u9130\u9805\u6578\u91cf\u3002\n- \u5728\u201c\u7dad\u5ea6\u201d\u5b57\u6bb5\u4e2d\uff0c\u8f38\u5165\u8f38\u5165\u77e2\u91cf\u7684\u7dad\u5ea6\u6578\u3002 **** \n- \u5728 **\u66f4\u65b0\u65b9\u6cd5** \u5b57\u6bb5\u4e2d\uff0c\u9078\u64c7 **\u6d41\u5f0f** \u3002\n- \u5728 **\u5206\u7247\u5927\u5c0f** \u5b57\u6bb5\u4e2d\uff0c\u5f9e\u4e0b\u62c9\u5217\u8868\u9078\u64c7\u6240\u9700\u7684\u5206\u7247\u5927\u5c0f\u3002\n- \u9ede\u64ca **\u5275\u5efa** \u3002\u65b0\u7d22\u5f15\u6e96\u5099\u5c31\u7dd2\u5f8c\uff0c\u4fbf\u6703\u986f\u793a\u5728\u7d22\u5f15\u5217\u8868\u4e2d\u3002\u6ce8\u610f\uff1a\u69cb\u5efa\u6642\u9593\u6700\u591a\u53ef\u80fd\u9700\u8981\u4e00\u500b\u5c0f\u6642\u624d\u80fd\u5b8c\u6210\u3002\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u6216\u66f4\u65b0 Python\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Python \u7248 Vertex AI SDK](https://cloud.google.com/vertex-ai/docs/start/use-vertex-ai-python-sdk?hl=zh-cn) \u3002   \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [   Python API \u53c3\u8003\u6587\u6a94](https://cloud.google.com/python/docs/reference/aiplatform/latest?hl=zh-cn) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/googleapis/python-aiplatform/blob/HEAD/samples/model-builder/vector_search/vector_search_create_index_sample.py) \n```\ndef vector_search_create_index(\u00a0 \u00a0 project: str, location: str, display_name: str, gcs_uri: Optional[str] = None) -> None:\u00a0 \u00a0 \"\"\"Create a vector search index.\u00a0 \u00a0 Args:\u00a0 \u00a0 \u00a0 \u00a0 project (str): Required. Project ID\u00a0 \u00a0 \u00a0 \u00a0 location (str): Required. The region name\u00a0 \u00a0 \u00a0 \u00a0 display_name (str): Required. The index display name\u00a0 \u00a0 \u00a0 \u00a0 gcs_uri (str): Optional. The Google Cloud Storage uri for index content\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 # Initialize the Vertex AI client\u00a0 \u00a0 aiplatform.init(project=project, location=location, staging_bucket=gcs_uri)\u00a0 \u00a0 # Create Index\u00a0 \u00a0 index = aiplatform.MatchingEngineIndex.create_tree_ah_index(\u00a0 \u00a0 \u00a0 \u00a0 display_name=display_name,\u00a0 \u00a0 \u00a0 \u00a0 description=\"Matching Engine Index\",\u00a0 \u00a0 \u00a0 \u00a0 dimensions=100,\u00a0 \u00a0 \u00a0 \u00a0 approximate_neighbors_count=150,\u00a0 \u00a0 \u00a0 \u00a0 leaf_node_embedding_count=500,\u00a0 \u00a0 \u00a0 \u00a0 leaf_nodes_to_search_percent=7,\u00a0 \u00a0 \u00a0 \u00a0 index_update_method=\"batch_update\", \u00a0# Options: stream_update, batch_update\u00a0 \u00a0 \u00a0 \u00a0 distance_measure_type=aiplatform.matching_engine.matching_engine_index_config.DistanceMeasureType.DOT_PRODUCT_DISTANCE,\u00a0 \u00a0 )\u00a0 \u00a0 print(index.name)\n```\n\u5982\u9700\u7acb\u5373\u5275\u5efa\u548c\u90e8\u7f72\u7d22\u5f15\uff0c\u60a8\u53ef\u4ee5\u7232\u6d41\u5f0f\u50b3\u8f38\u5275\u5efa\u7a7a\u7d22\u5f15\u3002\u5982\u679c\u4f7f\u7528\u6b64\u9078\u9805\uff0c\u5728\u5275\u5efa\u7d22\u5f15\u6642\u4e0d\u9700\u8981\u5d4c\u5165\u6578\u64da\u3002\n\u5982\u9700\u5275\u5efa\u7a7a\u7d22\u5f15\uff0c\u8a72\u8acb\u6c42\u8207\u7232\u6d41\u5f0f\u50b3\u8f38\u5275\u5efa\u7d22\u5f15\u5e7e\u4e4e\u5b8c\u5168\u76f8\u540c\u3002\u4e0d\u540c\u4e4b\u8655\u5728\u65bc\uff0c\u9700\u8981\u79fb\u9664 `contentsDeltaUri` \u5b57\u6bb5\uff0c\u56e0\u7232\u60a8\u6c92\u6709\u95dc\u806f\u6578\u64da\u4f4d\u7f6e\u3002\u4e0b\u9762\u662f\u4e00\u500b\u7a7a\u7684\u6d41\u5f0f\u7d22\u5f15\u793a\u4f8b\uff1a\n```\n{\n \"display_name\": INDEX_NAME,\n \"indexUpdateMethod\": \"STREAM_UPDATE\",\n \"metadata\": {\n \"config\": {\n  \"dimensions\": 100,\n  \"approximateNeighborsCount\": 150,\n  \"distanceMeasureType\": \"DOT_PRODUCT_DISTANCE\",\n  \"algorithm_config\": {\n  \"treeAhConfig\": {\n   \"leafNodeEmbeddingCount\": 500,\n   \"leafNodesToSearchPercent\": 7\n  }\n  }\n }\n }\n}\n \n```\n## \u5217\u51fa\u7d22\u5f15\n\u5728\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u7d22\u5f15\u7684\u986f\u793a\u540d\u7a31\u3002\n- \uff1a\u60a8\u5728\u5176\u4e2d\u4f7f\u7528 Vertex AI \u7684\u5340\u57df\u3002\n- \uff1a\u60a8\u7684 Google Cloud [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n\u60a8\u61c9\u8a72\u6703\u6536\u5230\u985e\u4f3c\u5982\u4e0b\u6240\u793a\u7684\u97ff\u61c9\uff1a\n```\nYou can poll for the status of the operation for the response\nto include \"done\": true. Use the following example to poll the status.\n $ gcloud ai operations describe 1234567890123456789 --project=my-test-project --region=us-central1\n```\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 `describe` \u547d\u4ee4\uff0c\u8acb\u53c3\u95b1 [gcloud ai operations](https://cloud.google.com/sdk/gcloud/reference/ai/operations/describe?hl=zh-cn) \u3002\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u7d22\u5f15\u7684\u986f\u793a\u540d\u7a31\u3002\n- \uff1a\u60a8\u5728\u5176\u4e2d\u4f7f\u7528 Vertex AI \u7684\u5340\u57df\u3002\n- \uff1a\u60a8\u7684 Google Cloud [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n- \uff1a\u81ea\u52d5\u751f\u6210\u7684 [\u9805\u76ee\u7de8\u865f](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://LOCATION-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/indexes\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"indexes\": [ {\n  \"name\": \"projects/PROJECT_NUMBER/locations/LOCATION/indexes/INDEX_ID\",\n  \"displayName\": \"INDEX_NAME\",\n  \"metadataSchemaUri\": \"gs://google-cloud-aiplatform/schema/matchingengine/metadata/nearest_neighbor_search_1.0.0.yaml\",\n  \"metadata\": {\n  \"config\": {\n   \"dimensions\": 100,\n   \"approximateNeighborsCount\": 150,\n   \"distanceMeasureType\": \"DOT_PRODUCT_DISTANCE\",\n   \"featureNormType\": \"NONE\",\n   \"algorithmConfig\": {\n   \"treeAhConfig\": {\n    \"maxLeavesToSearch\": 50,\n    \"leafNodeCount\": 10000\n   }\n   }\n  }\n  },\n  \"etag\": \"AMEw9yNU8YX5IvwuINeBkVv3yNa7VGKk11GBQ8GkfRoVvO7LgRUeOo0qobYWuU9DiEc=\",\n  \"createTime\": \"2020-11-08T21:56:30.558449Z\",\n  \"updateTime\": \"2020-11-08T22:39:25.048623Z\"\n }\n ]\n}\n```\n\u4f7f\u7528\u4ee5\u4e0b\u8aaa\u660e\u67e5\u770b\u7d22\u5f15\u5217\u8868\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80 **\u90e8\u7f72\u548c\u4f7f\u7528** \u90e8\u5206\u3002\u9078\u64c7 **Vector Search** [\u524d\u5f80 Vector Search](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn) \n- \u7cfb\u7d71\u6703\u986f\u793a\u6d3b\u8e8d\u7d22\u5f15\u5217\u8868\u3002## \u8abf\u6574\u7d22\u5f15\n\u8abf\u6574\u7d22\u5f15\u9700\u8981\u8a2d\u7f6e\u5f71\u97ff\u5df2\u90e8\u7f72\u7d22\u5f15\u7684\u6027\u80fd\u7684\u914d\u7f6e\u53c3\u6578\uff0c\u5c24\u5176\u662f\u53ec\u56de\u7387\u548c\u5ef6\u9072\u6642\u9593\u3002\u9019\u4e9b\u53c3\u6578\u662f\u5728\u9996\u6b21\u5275\u5efa\u7d22\u5f15\u6642\u8a2d\u7f6e\u7684\u3002\u60a8\u53ef\u4ee5 [\u4f7f\u7528\u66b4\u529b\u7d22\u5f15](#brute-force-index) \u4f86\u8861\u91cf\u53ec\u56de\u7387\u3002\n### \u5f71\u97ff\u53ec\u56de\u7387\u548c\u5ef6\u9072\u6642\u9593\u7684\u914d\u7f6e\u53c3\u6578\n- `distanceMeasureType`\u652f\u6301\u4ee5\u4e0b\u503c\uff1a- `SQUARED_L2_DISTANCE`\uff1a\u6b50\u5e7e\u91cc\u5f97 L2 \u8ddd\u96e2\n- `L1_DISTANCE`\uff1a\u66fc\u54c8\u9813 L1 \u8ddd\u96e2\n- `COSINE_DISTANCE`\uff1a\u9918\u5f26\u8ddd\u96e2\uff0c\u5b9a\u7fa9\u7232\u201c1 - \u9918\u5f26\u76f8\u4f3c\u5ea6\u201d\n- `DOT_PRODUCT_DISTANCE`\uff1avDot \u4e58\u7a4d\u8ddd\u96e2\uff0c\u5b9a\u7fa9\u7232\u9ede\u7a4d\u7684\u8ca0\u6578\u3002\u9019\u662f\u9ed8\u8a8d\u503c\u3002\n\u5728\u5927\u591a\u6578\u60c5\u6cc1\u4e0b\uff0c\u7528\u65bc\u76f8\u4f3c\u5ea6\u5339\u914d\u7684\u5d4c\u5165\u5411\u91cf\u4f7f\u7528\u6307\u6a19\u5b78\u7fd2\u6a21\u578b\uff08\u4e5f\u7a31\u7232 Siamese \u7db2\u7d61 \u6216\u96d9\u5854\u6a21\u578b \uff09\u8a08\u7b97\u5f97\u51fa\u3002\u9019\u4e9b\u6a21\u578b\u4f7f\u7528\u8ddd\u96e2\u6307\u6a19\u4f86\u8a08\u7b97\u5c0d\u6bd4\u640d\u5931\u51fd\u6578\u3002\u7406\u60f3\u60c5\u6cc1\u4e0b\uff0c\u5339\u914d\u7d22\u5f15\u7684 `distanceMeasureType` \u53c3\u6578\u7684\u503c\u6703\u5339\u914d\u751f\u6210\u5d4c\u5165\u5411\u91cf\u7684\u6a21\u578b\u4f7f\u7528\u7684\u8ddd\u96e2\u5ea6\u91cf\u3002\n- `approximateNeighborsCount`\u5728\u57f7\u884c\u7cbe\u78ba\u91cd\u65b0\u6392\u5e8f\u4e4b\u524d\u4f7f\u7528\u8fd1\u4f3c\u641c\u7d22\u67e5\u627e\u7684\u9ed8\u8a8d\u9130\u6578\u91cf\u3002\u7cbe\u78ba\u91cd\u65b0\u6392\u5e8f\u662f\u4e00\u500b\u904e\u7a0b\uff0c\u5728\u8a72\u904e\u7a0b\u4e2d\u901a\u904e\u8cbb\u7528\u66f4\u9ad8\u7684\u8ddd\u96e2\u8a08\u7b97\u8a18\u9304\u901a\u904e\u8fd1\u4f3c\u641c\u7d22\u7b97\u6cd5\u8fd4\u56de\u7684\u7d50\u679c\u3002\u589e\u52a0\u8a72\u503c\u6703\u63d0\u9ad8\u53ec\u56de\u7387\uff0c\u9019\u6703\u4f7f\u5ef6\u9072\u6642\u9593\u6309\u6bd4\u4f8b\u589e\u52a0\u3002\n- `treeAhConfig.leafNodesToSearchPercent`\u8981\u7232\u6bcf\u500b\u67e5\u8a62\u641c\u7d22\u7684\u8449\u6240\u4f54\u7684\u767e\u5206\u6bd4\u3002 \u589e\u52a0\u8a72\u503c\u6703\u63d0\u9ad8\u53ec\u56de\u7387\uff0c\u9019\u4e5f\u6703\u4f7f\u5ef6\u9072\u6642\u9593\u6309\u6bd4\u4f8b\u589e\u52a0\u3002\u9ed8\u8a8d\u503c\u7232 `10` \u6216 10% \u7684\u8449\u3002\n- `treeAhConfig.leafNodeEmbeddingCount`\u6bcf\u500b\u8449\u7bc0\u9ede\u7684\u5d4c\u5165\u6578\u91cf\u3002\u6b64\u6578\u9ed8\u8a8d\u8a2d\u7f6e\u7232 `1000` \u3002\u6b64\u53c3\u6578\u8207\u53ec\u56de\u7387\u4e0d\u5177\u6709\u7dda\u6027\u76f8\u95dc\u6027\u3002\u589e\u52a0\u6216\u6e1b\u5c11 `treeAhConfig.leafNodeEmbeddingCount` \u53c3\u6578\u7684\u503c\u4e26\u4e0d\u7e3d\u662f\u6703\u589e\u52a0\u6216\u6e1b\u5c11\u53ec\u56de\u7387\u3002\u901a\u904e\u5be6\u9a57\u627e\u51fa\u6700\u4f73\u503c\u3002\u66f4\u6539 `treeAhConfig.leafNodeEmbeddingCount` \u53c3\u6578\u7684\u503c\u901a\u5e38\u6bd4\u66f4\u6539\u5176\u4ed6\u53c3\u6578\u7684\u503c\u5f71\u97ff\u5c0f\u3002\n### \u4f7f\u7528\u66b4\u529b\u7d22\u5f15\u4f86\u8861\u91cf\u53ec\u56de\u7387\n\u5982\u9700\u7372\u5f97\u78ba\u5207\u7684\u6700\u8fd1\u9130\uff0c\u8acb\u5c07\u7d22\u5f15\u8207\u66b4\u529b\u7b97\u6cd5\u914d\u5408\u4f7f\u7528\u3002\u66b4\u529b\u7b97\u6cd5\u53ef\u63d0\u4f9b 100% \u53ec\u56de\u7387\uff0c\u4f46\u5ef6\u9072\u6642\u9593\u8f03\u9577\u3002\u4f7f\u7528\u66b4\u529b\u7d22\u5f15\u4f86\u8861\u91cf\u53ec\u56de\u7387\u901a\u5e38\u4e0d\u662f\u751f\u7522\u670d\u52d9\u7684\u7406\u60f3\u9078\u64c7\uff0c\u4f46\u60a8\u53ef\u80fd\u6703\u767c\u73fe\uff0c\u5728\u96e2\u7dda\u8a55\u4f30\u5404\u7a2e\u7d22\u5f15\u9078\u9805\u7684\u53ec\u56de\u7387\u6642\uff0c\u9019\u7a2e\u505a\u6cd5\u6703\u5f88\u6709\u7528\u3002\n\u5982\u9700\u5275\u5efa\u4f7f\u7528\u66b4\u529b\u7b97\u6cd5\u7684\u7d22\u5f15\uff0c\u8acb\u5728\u7d22\u5f15\u5143\u6578\u64da\u4e2d\u6307\u5b9a `brute_force_config` \uff1a\n```\ncurl -X POST -H \"Content-Type: application/json\" \\\n-H \"Authorization: Bearer `gcloud auth print-access-token`\" \\\nhttps://us-central1-aiplatform.googleapis.com/v1/projects/${PROJECT_ID}/locations/us-central1/indexes \\\n-d '{\n displayName: \"'${DISPLAY_NAME}'\",\n description: \"'${DESCRIPTION}'\",\n metadata: {\n  contentsDeltaUri: \"'${INPUT_DIR}'\",\n  config: {\n   dimensions: 100,\n   approximateNeighborsCount: 150,\n   distanceMeasureType: \"DOT_PRODUCT_DISTANCE\",\n   featureNormType: \"UNIT_L2_NORM\",\n   algorithmConfig: {\n    bruteForceConfig: {}\n   }\n  },\n },\n}'\n```\n## \u522a\u9664\u7d22\u5f15\n**\u6ce8\u610f** \uff1a\u5728\u53d6\u6d88\u90e8\u7f72 `index` \u7684\u6240\u6709 `index.deployed_indexes` \u4e4b\u524d\uff0c\u60a8\u7121\u6cd5\u5c07\u5176\u522a\u9664\u3002\n\u5728\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u7d22\u5f15\u7684 ID\u3002\n- \uff1a\u60a8\u5728\u5176\u4e2d\u4f7f\u7528 Vertex AI \u7684\u5340\u57df\u3002\n- \uff1a\u60a8\u7684 Google Cloud [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u7d22\u5f15\u7684 ID\u3002\n- \uff1a\u60a8\u5728\u5176\u4e2d\u4f7f\u7528 Vertex AI \u7684\u5340\u57df\u3002\n- \uff1a\u60a8\u7684 Google Cloud [\u9805\u76ee ID](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\n- \uff1a\u81ea\u52d5\u751f\u6210\u7684 [\u9805\u76ee\u7de8\u865f](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn#identifiers) \u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nDELETE https://LOCATION-aiplatform.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION/indexes/INDEX_ID\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_NUMBER/locations/LOCATION/indexes/INDEX_ID/operations/OPERATION_ID\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.aiplatform.v1.DeleteOperationMetadata\",\n \"genericMetadata\": {\n  \"createTime\": \"2022-01-08T02:35:56.364956Z\",\n  \"updateTime\": \"2022-01-08T02:35:56.364956Z\"\n }\n },\n \"done\": true,\n \"response\": {\n \"@type\": \"type.googleapis.com/google.protobuf.Empty\"\n }\n}\n```\n\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u522a\u9664\u4e00\u500b\u6216\u591a\u500b\u7d22\u5f15\u3002- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684 Vertex AI \u90e8\u5206\u4e2d\uff0c\u524d\u5f80 **\u90e8\u7f72\u548c\u4f7f\u7528** \u90e8\u5206\u3002\u9078\u64c7 **Vector Search** [\u524d\u5f80 Vector Search](https://console.cloud.google.com/vertex-ai/matching-engine/indexes?hl=zh-cn) \n- \u7cfb\u7d71\u6703\u986f\u793a\u6d3b\u8e8d\u7d22\u5f15\u5217\u8868\u3002\n- \u5982\u9700\u522a\u9664\u7d22\u5f15\uff0c\u8acb\u524d\u5f80\u8207\u8a72\u7d22\u5f15\u4f4d\u65bc\u540c\u4e00\u884c\u7684more_vert\u9078\u9805\u83dc\u55ae\uff0c\u7136\u5f8c\u9078\u64c7 **\u522a\u9664** \u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3\u5982\u4f55 [\u914d\u7f6e\u7d22\u5f15](https://cloud.google.com/vertex-ai/docs/vector-search/configuring-indexes?hl=zh-cn) \n- \u77ad\u89e3\u5982\u4f55 [\u90e8\u7f72\u548c\u7ba1\u7406\u516c\u5171\u7d22\u5f15\u7aef\u9ede](https://cloud.google.com/vertex-ai/docs/vector-search/deploy-index-public?hl=zh-cn) \n- \u77ad\u89e3\u5982\u4f55 [\u5728 VPC \u7db2\u7d61\u4e2d\u90e8\u7f72\u548c\u7ba1\u7406\u7d22\u5f15\u7aef\u9ede](https://cloud.google.com/vertex-ai/docs/vector-search/deploy-index-vpc?hl=zh-cn) \n- \u77ad\u89e3\u5982\u4f55 [\u66f4\u65b0\u548c\u91cd\u5efa\u7d22\u5f15](https://cloud.google.com/vertex-ai/docs/vector-search/update-rebuild-index?hl=zh-cn) \n- \u77ad\u89e3\u5982\u4f55 [\u76e3\u63a7\u7d22\u5f15](https://cloud.google.com/vertex-ai/docs/vector-search/monitor?hl=zh-cn)", "guide": "Vertex AI"}