{"title": "Google Kubernetes Engine (GKE) - Cluster notifications", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview", "abstract": "# Google Kubernetes Engine (GKE) - Cluster notifications\nThis page describes how Google Kubernetes Engine (GKE) publishes cluster notifications to [Pub/Sub](/pubsub/docs/overview) with information about events relevant to your cluster configuration, such as available upgrades and security bulletins.\nTo learn how to set up cluster notifications, refer to [Receive cluster notifications](/kubernetes-engine/docs/how-to/cluster-notifications) .\n", "content": "## Overview\nWhen certain events occur that are relevant to your GKE clusters, such as important scheduled upgrades or available security bulletins, GKE publishes notifications about those events as messages to Pub/Sub topics that you configure. You can receive these notifications on a Pub/Sub subscription , [integrate with third-partyservices](/kubernetes-engine/docs/tutorials/cluster-notifications-slack) , and filter for the notification types you want to receive.\n## Benefits\nUsing Pub/Sub to receive cluster notifications provides the following benefits:\n- You receive proactive information about updates scheduled for your cluster, allowing you to better plan for testing and qualifications, and to help ensure a smooth and predictable upgrade process.\n- You are notified when [security bulletins](/anthos/clusters/docs/security-bulletins) that are specific to your clusters are issued, which provides you with accurate risk and impact information.\n- You are notified when there is a new GKE version that you can upgrade to. Previously, you had to check the [GKE release notes](/kubernetes-engine/docs/release-notes) or the [GKE API](/kubernetes-engine/docs/reference/rest/v1/ServerConfig) to discover when a new GKE version was released.\n- You are notified when either GKE or a user initiates [cluster upgrades](/kubernetes-engine/docs/concepts/cluster-upgrades) , providing you with more visibility into the background operations of your cluster.\n- [Pub/Sub](/pubsub/docs/overview) is highly extensible, giving you flexibility in how you process incoming notifications. For example, you could integrate with [Slack](https://slack.com) to forward notifications to a Slack channel, or initiate [Cloud Functions](/functions) to run custom processes.\n- When custom processes are required (for example, orchestrating a staging to production workflow to test and certify an upgrade), you can use the notification to auto-trigger these workflows.## Types of upgrade notifications\nGKE sends the following cluster notification types:\n- [SecurityBulletinEvent](#securitybulletin) \n- [UpgradeAvailableEvent](#upgradeavailable) \n- [UpgradeEvent](#upgradeevent) \nYou can [filter the notifications you receive](#filtering) so that you're only notified for relevant events. You can filter cluster notifications by specifying a value for `filter` in the `--notification-config` flag when you [enable cluster notifications](/kubernetes-engine/docs/how-to/cluster-notifications) , or by [configuring your Pub/Sub subscription](/pubsub/docs/filtering) .\n### SecurityBulletinEvent\nWhen GKE issues a security bulletin that directly correlates to your cluster configuration or version, GKE sends a [SecurityBulletinEvent](/kubernetes-engine/docs/reference/rest/Shared.Types/SecurityBulletinEvent) notification, providing you with information about the vulnerability, the impact, and, if applicable, actions you can take.\n**Key Point:** GKE does not send a notification if your cluster is not affected by the vulnerability. Also, GKE waits to send a bulletin notification until a patch has rolled out in your cluster region or zone so that you can act when you receive the notification. You might receive two notifications for the same bulletin if the vulnerability affects both the control plane and nodes.\n### UpgradeAvailableEvent\nWhen a new version becomes available on a [release channel](/kubernetes-engine/docs/concepts/release-channels) , GKE sends an [UpgradeAvailableEvent](/kubernetes-engine/docs/reference/rest/Shared.Types/UpgradeAvailableEvent) notification to clusters on that release channel to inform the clusters that a new version is now available. This notification provides one week of advance notice for patch versions and at least 2-4 weeks for minor versions (depending on the channel). For more information, refer to [What versions are available ina channel](/kubernetes-engine/docs/concepts/release-channels#what_versions_are_available_in_a_channel) .\n**Note:** GKE does not send a notification when the default version changes in a release channel.\n`UpgradeAvailableEvent`\n**Note:** Clusters and node pools that aren't on a release channel and have [auto-upgrades](/kubernetes-engine/docs/how-to/node-auto-upgrades) enabled might upgrade shortly after receiving an `UpgradeAvailableEvent` notification, because there is no guarantee of advance notice for clusters outside release channels.\n`UpgradeAvailableEvent`\n**Note:** Windows Server version information being included in `UpgradeAvailableEvent` notifications is available in [Preview](/products#product-launch-stages) .\n### UpgradeEvent\nWhen you or GKE initiates an upgrade, GKE sends an [UpgradeEvent](/kubernetes-engine/docs/reference/rest/Shared.Types/UpgradeEvent) notification, telling you that an upgrade has begun. Ideally, you should use the `UpgradeAvailableEvent` notification type to be aware of the upcoming upgrade so that you can either upgrade in advance or take necessary measures to prepare, such as setting up [maintenance windows](/kubernetes-engine/docs/how-to/maintenance-windows-and-exclusions) .\nThe `UpgradeEvent` notification is sent at the start of the upgrade operation. The operation ID is passed in the message.\n## Filtering notifications\nYou can filter cluster notifications to ensure that you receive only the notifications that you want. You can apply filtering in one of the following ways:\n- [Filtering notifications in GKE](#filtering-gke) .\n- [Filtering notifications in Pub/Sub](#filtering-pubsub) .\n**Note:** Filtering notifications in GKE is strongly recommended over filtering in Pub/Sub because of the ease-of-use and because you are billed only for the notifications you receive.\n### Filtering notifications in GKE\nYou can set up filtering for one or more available notification types when enabling cluster notifications by specifying values for `filter` in the `--notification-config` flag. `filter` takes a pipe ( | ) delimited list of the notification types you want to receive.\nFor example, specifying `filter=\"UpgradeEvent|SecurityBulletinEvent\"` tells GKE to only send notifications for `UpgradeEvent` and `SecurityBulletinEvent` notification types.\nFiltering notifications using `filter` has benefits such as the following:\n- Easier to use, because you filter on the notification type without using a specific syntax.\n- Notifications you filter out are never sent to Pub/Sub, so you aren't charged fees for undelivered messages.\n- You can edit the filter configuration at any time.\nFor instructions on filtering notifications in GKE, see [Receive cluster notifications](/kubernetes-engine/docs/how-to/cluster-notifications#filter-notifications) .\n### Filtering notifications in Pub/Sub\nPub/Sub supports filtering messages in your subscription using a filtering syntax. When you use this method, GKE delivers all notification types to your Pub/Sub topic. Pub/Sub filters messages based on your subscription configuration and delivers the messages you want to receive.\nFor example, you could filter for `UpgradeEvent` and `UpgradeAvailableEvent` notifications using the following syntax in your subscription:\n```\nattributes.type_url = \"type.googleapis.com/google.container.v1beta1.UpgradeEvent\" OR \"type.googleapis.com/google.container.v1beta1.UpgradeAvailableEvent\"\n```\nYou are still [charged for undelivered messages](/pubsub/pricing#filtered_messages) filtered by your subscription. You also **cannot** modify the filters after you've configured the subscription. However, the filtering syntax is more extensible than filtering in GKE.\nTo learn more about filtering your Pub/Sub subscription, see [Filtering messages](/pubsub/docs/filtering) .\n## Consuming Pub/Sub messages\nPub/Sub messages contain two fields: `data` (string) and `attributes` (string-to-string map).\nFor GKE notifications, the `data` field contains human-readable information. The `attributes` field has generic notification information like the notification type, your project ID, cluster name, and cluster location. The `attributes.payload` field is a JSON-parsable string that contains specific notification information, such as the details of a security bulletin.\nNotifications always contain the following attributes:\n| Attribute  | Description              | Example                                                 |\n|:-----------------|:-------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| project_id  | The project number that owns the cluster.       | 123456789                                                |\n| cluster_location | The location of the cluster.          | us-central1-c                                               |\n| cluster_name  | The name of the cluster.           | example-cluster                                               |\n| type_url   | The type of notification.           | type.googleapis.com/google.container.v1beta1.UpgradeEvent                                    |\n| payload   | A JSON-parsable string carrying notification-specific information. | { \"resourceType\":\"MASTER\", \"operation\":\"operation-1595889094437-87b7254a\", \"operationStartTime\":\"2020-07-27T22:31:34.437652293Z\", \"currentVersion\":\"1.15.12-gke.2\", \"targetVersion\":\"1.15.12-gke.9\"} |\nGKE will always send `beta` notification types. However, you can parse the payload to display the corresponding GA notification type if it is available.\n### Sample cluster notification messages\nIn addition to the text in the `data` field, each message that GKE sends to Pub/Sub has specific values in the `attributes.type_url` and `attributes.payload` fields. The following table shows you examples of the information you might receive for each notification type:\nHere's some sample output from a [SecurityBulletinEvent](/kubernetes-engine/docs/reference/rest/Shared.Types/SecurityBulletinEvent) message:\n| Attributes | Attributes.1                                                                                                                                                                 |\n|:-------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| type_url  | type.googleapis.com/google.container.v1beta1.SecurityBulletinEvent                                                                                                                                                   |\n| payload  | { \"resourceTypeAffected\":\"RESOURCE_TYPE_CONTROLPLANE\", \"bulletinId\":\"GCP-2021-001\", \"cveIds\":[ \"CVE-2021-3156\" ], \"severity\":\"Medium\", \"briefDescription\":\"A vulnerability was recently discovered in the Linux utility sudo, described in CVE-2021-3156, that may allow an attacker with unprivileged local shell access on a system with sudo installed to escalate their privileges to root on the system.\", \"affectedSupportedMinors\":[\"1.18\", \"1.19\"], \"patchedVersions\":[\"1.18.9-gke.1900\", \"1.19.9-gke.1900\"], \"suggestedUpgradeTarget\":\"1.19.9-gke.1900\", \"bulletinUri\":\"https://cloud.google.com/anthos/clusters/docs/security-bulletins#gcp-2021-001\" } |\nHere's some sample output from an [UpgradeAvailableEvent](/kubernetes-engine/docs/reference/rest/Shared.Types/UpgradeAvailableEvent) message:\n| Attributes | Attributes.1                                                                                              |\n|:-------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| type_url  | type.googleapis.com/google.container.v1beta1.UpgradeAvailableEvent                                                                                |\n| payload  | { \"version\":\"1.17.15-gke.800\", \"resourceType\":\"MASTER\", \"releaseChannel\":{\"channel\":\"RAPID\"}, \"windowsVersions\": [ { \"imageType\": \"WINDOWS_SAC\", \"osVersion\": \"10.0.18363.1198\", \"supportEndDate\": { \"day\": 10, \"month\": 5, \"year\": 2022 } }, { \"imageType\": \"WINDOWS_LTSC\", \"osVersion\": \"10.0.17763.1577\", \"supportEndDate\": { \"day\": 9, \"month\": 1, \"year\": 2024 } } ] } |\nHere's some sample output from an [UpgradeEvent](/kubernetes-engine/docs/reference/rest/Shared.Types/UpgradeEvent) message:\n| Attributes | Attributes.1                                                |\n|:-------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| type_url  | type.googleapis.com/google.container.v1beta1.UpgradeEvent                                    |\n| payload  | { \"resourceType\":\"MASTER\", \"operation\":\"operation-1595889094437-87b7254a\", \"operationStartTime\":\"2020-07-27T22:31:34.437652293Z\", \"currentVersion\":\"1.15.12-gke.2\", \"targetVersion\":\"1.15.12-gke.9\"} |\n## What's next\n- Learn how to [receive cluster notifications](/kubernetes-engine/docs/how-to/cluster-notifications) .\n- Learn how to [configure cluster notifications for third-party services](/kubernetes-engine/docs/tutorials/cluster-notifications-slack) .", "guide": "Google Kubernetes Engine (GKE)"}