{"title": "Compute Engine - Consume reservations", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Consume reservations\nThis document explains how to use Compute Engine to do the following:\n- Consume reserved virtual machine (VM) instances.\n- Verify reservations consumption.\n- View reservation usage reports.\nFor more information about consuming reservations in other Google Cloud products that use VMs, see the reservations documentation for the following products:\n- [Batch](/batch/docs/create-run-job-reservation) \n- [ Dataflow](/dataflow/docs/guides/compute-engine-reservations) \n- [ Dataproc](/dataproc/docs/concepts/configuring-clusters/auto-zone#auto_zone_and_resource_reservations) \n- [ Google Kubernetes Engine](/kubernetes-engine/docs/how-to/consuming-reservations) ", "content": "## Before you begin\n- Review the [requirements](/compute/docs/instances/reservations-overview#requirements) and [restrictions](/compute/docs/instances/reservations-overview#restrictions) for reservations.\n- If you haven't already, set up authentication. [Authentication](/compute/docs/authentication) is the process by which your identity is verified for access to Google Cloud services and APIs. To run code or samples from a local development environment, you can authenticate to Compute Engine as follows.Select the tab for how you plan to use the samples on this page:\nWhen you use the Google Cloud console to access Google Cloud services and   APIs, you don't need to set up authentication.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:```\ngcloud init\n``` **Note:** If you installed the gcloud CLI  previously, make sure you have the latest version by running`gcloud components  update`.\n- [ Set a default region and zone](/compute/docs/gcloud-compute#set_default_zone_and_region_in_your_local_client) .\nTo use the REST API samples on this page in a local development environment, you use the credentials you provide to the gcloud CLI.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:\n- ```\ngcloud init\n```\n### Required roles\nTo get the permissions that you need to consume reservations,   ask your administrator to grant you the [Compute Instance Admin (v1) ](https://cloud.google.com/iam/docs/understanding-roles#compute.instanceAdmin.v1) ( `roles/compute.instanceAdmin.v1` ) IAM role on the project.    For more information about granting roles, see [Manage access](/iam/docs/granting-changing-revoking-access) .\nThis predefined role contains     the permissions required to consume reservations. To see the exact permissions that are   required, expand the **Required permissions** section:\nYou might also be able to get   these permissions  with [custom roles](/iam/docs/creating-custom-roles) or  other [predefined roles](/iam/docs/understanding-roles) .\n## Consume reserved VMs\nWhen you create a virtual machine (VM) instance, the VM starts consuming a reservation only if the properties for both the VM and the reservation are [matching](/compute/docs/instances/reservations-overview#requirements) . Additionally, you must set the reservation affinity property of the VM to one of the following options:\n- [Consume any matching reservation](#consuming_instances_from_any_matching_reservation) \u2014the VM can automatically consume any reservation with matching properties (default).This option is useful if you create and delete lots of VMs, and you want to use your reservations whenever possible. In this scenario, a VM can be created whether its properties match a reservation or not. If they match, the VM starts consuming the reservation depending on the reservation's [consumption order](/compute/docs/instances/reservations-overview#consumption-type) .\n- [Consume a specific reservation](#consuming_instances_from_a_specific_reservation) \u2014the VM can consume only a specific reservation. The reservation can't be automatically consumed.This option is useful when, for example, you want to hold a certain amount of capacity as backup for special events. In this scenario, a VM can be created only if its properties and the specific reservation's properties are matching. **Note:** You can create a specific reservation and a VM with this affinity to test that the VM is [correctly configured to automatically consume a matching reservation](#test-properties-match) .\n- [Can't consume any reservation at all](#creating_instances_without_consuming_reservations) \u2014the VM can't consume any reservation.This option is useful when, for example, you create a temporary VM that you don't want to consume reserved resources.\n### Consume VMs from any matching reservation\nIn this consumption model, existing and new VMs automatically consume a reservation if their properties match the VM properties specified in the reservation.\nWhen using this consumption model, the VMs in the current project consume all single-project reservations first before consuming any shared reservations. For more information about how reservations are automatically consumed, see [consumption order](/compute/docs/instances/reservations-overview#consumption-order) .\nWhen you create a reservation, this is the default consumption model, as long as you don't use the flag or option that indicates specific reservations are required.\n- To create a reservation with resources that can be used by VMs with a reservation affinity property configured to consume any reservations (default), follow these steps:- Select the type of reservation that you want to create:- To create standalone reservation, do the following:- In the Google Cloud console, go to the **Reservations** page. [Go to Reservations](https://console.cloud.google.com/compute/reservations) The **Reservations** page appears.\n- Click add_box **Create reservation** .The **Create a reservation** page appears.\n- To create a reservation that is attached to a commitment, do the following:- In the Google Cloud console, go to the **Committed use discounts** page. [Go to Committed use discounts](https://console.cloud.google.com/compute/commitments) The **Commitment list** page appears.\n- Click add_box **Purchase commitment** .The **Purchase a committed use discount** page appears.\n- Specify the commitment properties. Then, in the **Reservations** section, click **Add an item** .The **Add a new reservation** section appears.For more information about how to purchase a commitment with an attached reservation, see [Purchase commitments with attached reservations](/compute/docs/instances/reservations-with-commitments#purchasing_a_commitment_with_a_reservation) .\n- In the **Name** field, enter a name for your reservation. For this example, enter `reservation-01` .\n- Choose the **Region** and **Zone** where you want to reserve resources. For this example, select `us-central1` as the region and `us-central1-a` as the zone.\n- Choose your preferred **Share type** :- To create a reservation for a single project, select **Local** .\n- To create a shared reservation among multiple projects, select **Shared** . To share this reservation with other projects, clickadd **Add projects** and select the desired projects from the current project's organization.\n- In the **Use with VM instance** section, select **Use reservationautomatically** , so that any matching VMs can automatically use this reservation.\n- In the **Number of VM instances** field, enter the number of VMs that you want to reserve. For this example, enter `2` .\n- Specify the resources that you want to reserve for each VM:- If you want to reserve VMs that match an existing [instance template](/compute/docs/instance-templates/create-instance-templates) , select **Use instance template** and select an instance template from the list.\n- Otherwise, select **Specify machine type** and specify the following:- In the **Machine family** , **Series** , and **Machine type** fields, select a machine family, series, and machine type.\n- Optional: Specify a minimum CPU platform and/or GPUs:- To expand the **CPU Platform and GPU** section, click theexpand_moreexpander arrow.\n- Optional: To specify a minimum CPU platform, in the **CPU Platform** list, select an option.\n- Optional: To add GPUs, clickadd **Add GPU** . Then, in the **GPU type** and **Number of GPUs** fields, select the type and number of GPUs for each VM.\n- Optional: Add local SSDs:- In the **Number of disks** field, select the number of local SSDs for each VM.\n- In the **Interface type** field, select the interface for the local SSDs.\nFor this example, select **Specify machine type** . Then select the `n2-standard-32` machine type for the `General-purpose` machine family and `N2` series and select the minimum CPU platform `Intel Cascade Lake` .\n- Finish creating the reservation:- If you are creating standalone reservation, click **Create** .\n- If you are creating a reservation that is attached to a commitment:- To finish specifying the properties for this reservation, click **Done** .\n- To finish creating the commitment and attached reservations, click **Purchase** .\n- In the same project or a project that the reservation is shared with, create a VM that targets any open reservation.Ensure that the VM's properties match the VM properties in `reservation-01` , including the zone, machine type (machine family, vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD interface and size.For more information about how to create a VM, see [Create and start a VM](/compute/docs/instances/create-start-instance) - In the Google Cloud console, go to the **Create an instance** page. [Go to Create an instance](https://console.cloud.google.com/compute/instancesAdd) The **Create an instance page** appears.\n- Specify a name for your VM.\n- In the following sections, select a configuration that exactly matches all the properties of your reservation, including any optional properties. For this example, you must match the following VM properties with `reservation-01` :- **Region** :`us-central1`\n- **Zone** :`us-central1-a`\n- **Machine type** :`n2-standard-32`\n- Minimum **CPU platform** :`Intel Cascade Lake`\n- **GPUs** : none\n- **Local SSDs** : none\n- Expand the **Advanced options** section and then expand the **Management** section. In the **Reservations** list, select **Automatically use created reservation** .\n- To create the VM, click **Create** .- Create an open reservation called `reservation-01` .```\ngcloud compute reservations create reservation-01 \\\n --vm-count=2 \\\n --machine-type=n2-standard-32 \\\n --min-cpu-platform=\"Intel Cascade Lake\" \\\n --zone=us-central1-a\n```\n- Create a VM that targets any open reservation and that matches the VM properties in `reservation-01` , including the zone, machine type (machine family. vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD amount and interface.```\ngcloud compute instances create instance-1 \\\n --machine-type=n2-standard-32 \\\n --min-cpu-platform=\"Intel Cascade Lake\" \\\n --zone=us-central1-a \\\n --reservation-affinity=any\n```\n- Create an open reservation named `reservation-01` .```\nPOST https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central1-a/reservations{\u00a0 \"name\":\"reservation-01\",\u00a0 \"specificReservation\":{\u00a0 \u00a0 \"count\":\"2\",\u00a0 \u00a0 \"instanceProperties\":{\u00a0 \u00a0 \u00a0 \"machineType\":\"n2-standard-32\",\u00a0 \u00a0 \u00a0 \"minCpuPlatform\": \"Intel Cascade Lake\",\u00a0 \u00a0 }\u00a0 },\u00a0 \"specificReservationRequired\": false}\n```\n- Create a VM that targets any open reservation and that matches the VM properties in `reservation-01` , including the zone, machine type (machine family. vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD amount and interface.```\nPOST https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central1-a/instances{\u00a0 \"name\": \"instance-1\",\u00a0 \"machineType\": \"zones/us-central1-a/machineTypes/n2-standard-32\",\u00a0 \"minCpuPlatform\": \"Intel Cascade Lake\",\u00a0 \"reservationAffinity\":\u00a0 {\u00a0 \u00a0 \"consumeReservationType\": \"ANY_RESERVATION\"\u00a0 },\u00a0 ...}\n```\n### Consume VMs from a specific reservation\nIn this consumption model, only new VMs that target a specific reservation by name can consume that reservation, and the reservation is not consumed automatically.\nWhen creating the reservation, specify that VMs are required to target the specific reservation by using one of the following methods:\n- In the Google Cloud console, select the **Select specific reservation** checkbox.\n- In the gcloud CLI, include the`--require-specific-reservation`flag.\n- In the Compute Engine API, set the`specificReservationRequired`field to`true`.\n- In Terraform, set the`specific_reservation_required`field to`true`.\nThen [create VMs](/compute/docs/instances/create-start-instance) that specifically target that reservation. You can only create a VM that targets a specific reservation if the VM properties and the reservation's properties are matching. Otherwise, creating the VM [fails](/compute/docs/troubleshooting/troubleshooting-vm-creation#mismatched_reservation_properties) .\nIf you are using an instance template to create VMs in a regional managed instance group, create identical reservations with the same name in each applicable zone. Then, target the reservations by name in the group's instance template.\nFor example, create a specific reservation named `reservation-02` , and then create a matching VM that targets that reservation and that matches the reservation's VM properties.\nDepending on the type of VM you want to consume, follow the steps for [Consume a specific single-project reservation](#consuming_a_specific_single-project_reservation) or [Consume a specific shared reservation](#consuming_a_specific_shared_reservation) .\nTo consume a specific single-project reservation, use the Google Cloud console, gcloud CLI, or REST.\n- To create a reservation with resources that can only be used by VMs that specifically target the reservation by name, follow these steps:- Select one of the following options:- To create standalone reservation, do the following:- In the Google Cloud console, go to the **Reservations** page. [Go to Reservations](https://console.cloud.google.com/compute/reservations) The **Reservations** page appears.\n- Click add_box **Create reservation** .The **Create a reservation** page appears.\n- To create a reservation that is attached to a commitment, do the following:- In the Google Cloud console, go to the **Committed use discounts** page. [Go to Committed use discounts](https://console.cloud.google.com/compute/commitments) The **Commitment list** page appears.\n- Click add_box **Purchase commitment** .The **Purchase a committed use discount** page appears.\n- Specify the commitment properties. Then, in the **Reservations** section, click **Add an item** .The **Add a new reservation** section appears.For more information about how to purchase a commitment with an attached reservation, see [Purchase commitments with attached reservations](/compute/docs/instances/reservations-with-commitments#purchasing_a_commitment_with_a_reservation) .\n- In the **Name** field, enter a name for your reservation. For this example, enter `reservation-02` .\n- Choose the **Region** and **Zone** where you want to reserve resources. For this example, select `us-central1` as the region and `us-central1-a` as the zone.\n- To specify that your reservation will be a single-project reservation, select **Local** as the **Share type** .\n- In the **Use with VM instance** section, select **Select specificreservation** , so that only matching VMs that specifically target this reservation by name can use this reservation.\n- In the **Number of VM instances** field, enter the number of VMs that you want to reserve. For this example, enter `10` .\n- Specify the resources that you want to reserve for each VM:- If you want to reserve VMs that match an existing [instance template](/compute/docs/instance-templates/create-instance-templates) , select **Use instance template** and select an instance template from the list.\n- Otherwise, select **Specify machine type** and specify the following:- In the **Machine family** , **Series** , and **Machine type** fields, select a machine family, series, and machine type.\n- Optional: Specify a minimum CPU platform and/or GPUs:- To expand the **CPU Platform and GPU** section, click theexpand_moreexpander arrow.\n- Optional: To specify a minimum CPU platform, in the **CPU Platform** list, select an option.\n- Optional: To add GPUs, clickadd **Add GPU** . Then, in the **GPU type** and **Number of GPUs** fields, select the type and number of GPUs for each VM.\n- Optional: Add local SSDs:- In the **Number of disks** field, select the number of local SSDs for each VM.\n- In the **Interface type** field, select the interface for the local SSDs.\nFor this example, select **Specify machine type** . Then select the `n2-standard-32` machine type for the `General-purpose` machine family and `N2` series and select the minimum CPU platform `Intel Cascade Lake` .\n- Finish creating the reservation:- If you are creating standalone reservation, click **Create** .\n- If you are creating a reservation that is attached to a commitment:- To finish specifying the properties for this reservation, click **Done** .\n- To finish creating the commitment and attached reservations, click **Purchase** .\n- In the same project, create a VM that targets that specific reservation by name.Ensure that the VM's properties match the VM properties of that specific reservation, including the zone, machine type (machine family, vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD interface and size.For more information about how to create a VM, see [Create and start a VM](/compute/docs/instances/create-start-instance) .- In the Google Cloud console, go to the **Create an instance** page. [Go to Create an instance](https://console.cloud.google.com/compute/instancesAdd) The **Create an instance page** appears.\n- Specify a name for your VM.\n- In the following sections, select a configuration that exactly matches all the properties of your reservation, including any optional properties. For this example, you must match the following VM properties with `reservation-02` :- **Region** :`us-central1`\n- **Zone** :`us-central1-a`\n- **Machine type** :`n2-standard-32`\n- Minimum **CPU platform** :`Intel Cascade Lake`\n- **GPUs** : none\n- **Local SSDs** : none\n- Expand the **Advanced options** section and then expand the **Management** section. In the **Reservations** list, select **Select specific reservation** , and then select the **Reservation name** with matching properties that you want your VM to consume. For this example, select `reservation-02` .\n- To create the VM, click **Create** .- Create a reservation named `reservation-02` with the `--require-specific-reservation` flag. These reserved resources can be used only by VMs that specifically target this reservation by name.```\ngcloud compute reservations create reservation-02 \\\n --machine-type=n2-standard-32 \\\n --min-cpu-platform=\"Intel Cascade Lake\" \\\n --vm-count=10 \\\n --zone=us-central1-a \\\n --require-specific-reservation\n```\n- Create a VM that targets `reservation-02` by name by using the `--reservation-affinity` and `--reservation` flags.Ensure that the VM's properties match the reservation's VM properties, including the zone, machine type (machine family, vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD interface and size.```\ngcloud compute instances create instance-2 \\\n --machine-type=n2-standard-32 \\\n --min-cpu-platform=\"Intel Cascade Lake\" \\\n --zone=us-central1-a \\\n --reservation-affinity=specific \\\n --reservation=reservation-02\n```\n- Create a reservation named `reservation-02` with the `specificReservationRequired` field set to `true` .```\nPOST https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central1-a/reservations{\u00a0 \"name\":\"reservation-02\",\u00a0 \"specificReservation\":{\u00a0 \u00a0 \"count\":\"10\",\u00a0 \u00a0 \"instanceProperties\":{\u00a0 \u00a0 \u00a0 \"machineType\":\"n2-standard-32\",\u00a0 \u00a0 \u00a0 \"minCpuPlatform\": \"Intel Cascade Lake\",\u00a0 \u00a0 }\u00a0 },\u00a0 \"specificReservationRequired\": true}\n```\n- Create a VM that targets `reservation-02` by name by using the `reservationAffinity` field.Ensure that the VM's properties match the reservation's VM properties, including the zone, machine type (machine family, vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD interface and size.```\nPOST https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central1-a/instances{\u00a0 \"name\": \"instance-2\",\u00a0 \"machineType\": \"zones/us-central1-a/machineTypes/n2-standard-32\",\u00a0 \"minCpuPlatform\": \"Intel Cascade Lake\",\u00a0 \"reservationAffinity\":\u00a0 {\u00a0 \u00a0 \"consumeReservationType\": \"SPECIFIC_RESERVATION\",\u00a0 \u00a0 \"key\": \"compute.googleapis.com/reservation-name\",\u00a0 \u00a0 \"values\":\u00a0 \u00a0 [\u00a0 \u00a0 \u00a0 \"reservation-02\"\u00a0 \u00a0 ]\u00a0 },\u00a0 ...}\n```To consume a specific shared reservation, use the Google Cloud console, gcloud CLI, or REST.\n- To create a shared reservation with resources that can only be used by VMs that specifically target this reservation by name, follow these steps:- Select one of the following options:- To create standalone reservation, do the following:- In the Google Cloud console, go to the **Reservations** page. [Go to Reservations](https://console.cloud.google.com/compute/reservations) The **Reservations** page appears.\n- Click add_box **Create reservation** .The **Create a reservation** page appears.\n- To create a reservation that is attached to a commitment, do the following:- In the Google Cloud console, go to the **Committed use discounts** page. [Go to Committed use discounts](https://console.cloud.google.com/compute/commitments) The **Commitment list** page appears.\n- Click add_box **Purchase commitment** .The **Purchase a committed use discount** page appears.\n- Specify the commitment properties. Then, in the **Reservations** section, click **Add an item** .The **Add a new reservation** section appears.For more information about how to purchase a commitment with an attached reservation, see [Purchase commitments with attached reservations](/compute/docs/instances/reservations-with-commitments#purchasing_a_commitment_with_a_reservation) .\n- In the **Name** field, enter a name for your reservation. For this example, enter `reservation-02` .\n- Choose the **Region** and **Zone** where you want to reserve resources. For this example, select `us-central1` as the region and `us-central1-a` as the zone.\n- To specify that your reservation is a shared reservation, select **Shared** as the **Share type** .\n- Click add **Add projects** and select the projects from the current project's organization that you want to share the reservation with.\n- In the **Use with VM instance** section, select **Select specificreservation** , so that only matching VMs that specifically target this reservation by name can use this reservation.\n- In the **Number of VM instances** field, enter the number of VMs that you want to reserve. For this example, enter `10` .\n- Specify the resources that you want to reserve for each VM:- If you want to reserve VMs that match an existing [instance template](/compute/docs/instance-templates/create-instance-templates) , select **Use instance template** and select an instance template from the list.\n- Otherwise, select **Specify machine type** and specify the following:- In the **Machine family** , **Series** , and **Machine type** fields, select a machine family, series, and machine type.\n- Optional: Specify a minimum CPU platform and/or GPUs:- To expand the **CPU Platform and GPU** section, click theexpand_moreexpander arrow.\n- Optional: To specify a minimum CPU platform, in the **CPU Platform** list, select an option.\n- Optional: To add GPUs, clickadd **Add GPU** . Then, in the **GPU type** and **Number of GPUs** fields, select the type and number of GPUs for each VM.\n- Optional: Add local SSDs:- In the **Number of disks** field, select the number of local SSDs for each VM.\n- In the **Interface type** field, select the interface for the local SSDs.\nFor this example, select **Specify machine type** . Then select the `n2-standard-32` machine type for the `General-purpose` machine family and `N2` series and select the minimum CPU platform `Intel Cascade Lake` . 1. Finish creating the reservation:- If you are creating standalone reservation, click **Create** .\n- If you are creating a reservation that is attached to a commitment:- To finish specifying the properties for this reservation, click **Done** .\n- To finish creating the commitment and attached reservations, click **Purchase** .\n- In the same project or a project that the reservation is shared with, create a VM that targets that specific reservation by name.Ensure that the VM's properties match the VM properties of that specific reservation, including the zone, machine type (machine family, vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD interface and size.- In the Google Cloud console, go to the **Create an instance** page. [Go to Create an instance](https://console.cloud.google.com/compute/instancesAdd) The **Create an instance page** appears.\n- Specify a **Name** for your VM.\n- In the following sections, select a configuration that exactly matches all the properties of your reservation, including any optional properties. For this example, you must match the following VM properties with `reservation-02` :- **Region** :`us-central1`\n- **Zone** :`us-central1-a`\n- **Machine type** :`n2-standard-32`\n- Minimum **CPU platform** :`Intel Cascade Lake`\n- **GPUs** : none\n- **Local SSDs** : none\n- Expand the **Advanced options** section and then expand the **Management** section. In the **Reservations** list, select **Select specific reservation** , and then do the following:- Select a **Reservation project** that has reservations shared with your current project. For this example, select the project that you used to create`reservation-02`.\n- Select the **Reservation name** of the shared reservation that you want this VM to consume. For this example, select`reservation-02`.\n- To create the VM, click **Create** .- Create a reservation named `reservation-02` with the `--require-specific-reservation` flag. These reserved resources can be used only by VMs that specifically target this reservation by name.```\ngcloud compute reservations create reservation-02 \\\n --machine-type=n2-standard-32 \\\n --min-cpu-platform=\"Intel Cascade Lake\" \\\n --vm-count=10 \\\n --zone=us-central1-a \\\n --project=my-owner-project \\\n --share-setting=projects \\\n --share-with=project-1,project-2 \\\n --require-specific-reservation\n```\n- Create a VM that targets `reservation-02` by name by using the `--reservation-affinity` and `--reservation` flags. To consume this reservation from any consumer projects that this reservation is shared with, you must also specify the project that created the reservation, `my-owner-project` .Ensure that the VM's properties match the reservation's VM properties, including the zone, machine type (machine family, vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD interface and size.```\ngcloud compute instances create instance-2 \\\n --machine-type=n2-standard-32 \\\n --min-cpu-platform=\"Intel Cascade Lake\" \\\n --zone=us-central1-a \\\n --reservation-affinity=specific \\\n --reservation=projects/my-owner-project/reservations/reservation-02\n```\n- Create a reservation named `reservation-02` with the `specificReservationRequired` field set to `true` .```\nPOST https://compute.googleapis.com/compute/v1/projects/my-owner-project/zones/us-central1-a/reservations{\u00a0 \"name\":\"reservation-02\",\u00a0 \"specificReservation\":{\u00a0 \u00a0 \"count\":\"10\",\u00a0 \u00a0 \"instanceProperties\":{\u00a0 \u00a0 \u00a0 \"machineType\":\"n2-standard-32\",\u00a0 \u00a0 \u00a0 \"minCpuPlatform\": \"Intel Cascade Lake\"\u00a0 \u00a0 }\u00a0 },\u00a0 \"shareSettings\": {\u00a0 \u00a0 \"shareType\": \"SPECIFIC_PROJECTS\",\u00a0 \u00a0 \"projectMap\": {\u00a0 \u00a0 \u00a0 \"project-1\": {\u00a0 \u00a0 \u00a0 \u00a0 \"projectId\": \"project-1\"\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \"project-2\": {\u00a0 \u00a0 \u00a0 \u00a0 \"projectId\": \"project-2\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 }\u00a0 \"specificReservationRequired\": true}\n```\n- Create a VM that targets `reservation-02` by name by using the `reservationAffinity` field. To consume this reservation from any consumer projects that this reservation is shared with, you must also specify the owner project of the reservation, `my-owner-project` .Ensure that the VM's properties match the reservation's VM properties, including the zone, machine type (machine family, vCPUs, and memory), minimum CPU platform, GPU amount and type, and local SSD interface and size.```\nPOST https://compute.googleapis.com/compute/v1/projects/project-2/zones/us-central1-a/instances{\u00a0 \"name\": \"instance-2\",\u00a0 \"machineType\": \"zones/us-central1-a/machineTypes/n2-standard-32\",\u00a0 \"minCpuPlatform\": \"Intel Cascade Lake\",\u00a0 \"reservationAffinity\":\u00a0 {\u00a0 \u00a0 \"consumeReservationType\": \"SPECIFIC_RESERVATION\",\u00a0 \u00a0 \"key\": \"compute.googleapis.com/reservation-name\",\u00a0 \u00a0 \"values\":\u00a0 \u00a0 [\u00a0 \u00a0 \u00a0 \"projects/my-owner-project/reservations/reservation-02\"\u00a0 \u00a0 ]\u00a0 },\u00a0 ...}\n```\n### Create VMs without consuming reservations\nTo explicitly avoid consuming resources from any reservation, set the reservation affinity property to not use any reservations when creating the VM. Or, to implicitly avoid using up any of your reservations, create a VM that doesn't match the VM properties of any of your reservations.\n- Create a VM that explicitly doesn't consume from a reservation.- In the Google Cloud console, go to the **Create an instance** page. [Go to Create an instance](https://console.cloud.google.com/compute/instancesAdd) \n- Create a VM. For more information, see [Create and start a VM](/compute/docs/instances/create-start-instance) .\n- Expand the **Advanced options** section, and then do the following:- Expand the **Management** section.\n- To ensure that this VM doesn't consume from existing reservations, in the **Reservations** list, select **Don't use** .\n- Click **Create** .\n [Create a VM](/sdk/gcloud/reference/compute/instances/create) that explicitly does not consume from a reservation.\n```\ngcloud compute instances create instance-3 --reservation-affinity=none\n```\nOr create a VM that does not match the VM properties in any of your reservations. To review your reservation properties, see [View reservations](/compute/docs/instances/reservations-view#listing_and_describing_reservations) .\n [Create a VM](/compute/docs/reference/rest/v1/instances/insert) that explicitly does not consume from a reservation.\n```\nPOST https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central1-a/instances{\u00a0 \"machineType\": \"zones/us-central1-a/machineTypes/n2-standard-32\",\u00a0 \"name\": \"instance-3\",\u00a0 \"reservationAffinity\":\u00a0 {\u00a0 \u00a0 \"consumeReservationType\": \"NO_RESERVATION\"\u00a0 },\u00a0 ...}\n```\nOr create a VM that does not match the VM properties in any of your reservations. To review your reservation properties, see [View reservations](/compute/docs/instances/reservations-view#listing_and_describing_reservations) .\n## Test that VM properties match a reservation\nTo test whether VMs can automatically consume a reservation, you can create a copy of the reservation as a specific reservation, and then see if a VM you plan to create can consume that reservation. If you can successfully create the VM, you've verified that the VM can correctly consume the matching reservation. Otherwise, creating the VM fails because [the properties don't match](/compute/docs/troubleshooting/troubleshooting-vm-creation#mismatched_reservation_properties) or there are [no available reserved resources](/compute/docs/troubleshooting/troubleshooting-reservation-creation#resource-availability) . After testing, you can do one or more of the following:\n- [Delete](/compute/docs/instances/reservations-delete) or [update the specific reservation](/compute/docs/instances/reservations-modify#modifying-consumer-projects-shared-reservation) you used for testing.\n- [Delete the VM](/compute/docs/instances/deleting-instance) or [update it](/compute/docs/instances/update-instance-properties) to have a different reservation affinity ( `reservationAffinity` ).## Verify reservations consumption\nTo verify that a VM is correctly consuming a reservation, use one of the following methods:\n- [View the details of the reservation](/compute/docs/instances/reservations-view#describe-reservations) before and after you create or update a VM.If the number of used VMs by a reservation increases by 1 after your change, then your change probably caused that VM to start consuming the reservation. This is the simplest method to verify a reservation consumption, but it might not work well to verify which exact VM is consuming a reservation.\n- [Create the VM to target a specific reservation](/compute/docs/instances/reservations-consume#consuming_instances_from_a_specific_reservation) .If you can successfully create a VM that targets a specific reservation, then the VM is consuming the reservation. This is the most reliable method to verify that a specific VM is consuming a reservation and that the [VM properties match a reservation](#test-properties-match) .\n- [Monitor your reservations consumption](/compute/docs/instances/reservations-monitor) .By using Cloud Monitoring, you can access and view the information associated with the consumption of the reservations that were created in the current project. If you see a change in the measurements of a reservation, then it means that a VM consumed the reservation. This method is useful to verify the consumption trend of one or more reservations, as well as receive notifications for underused or unused reservations.\nIf you see that a VM isn't consuming a reservation after you've verified that the VM's reservation affinity can consume the reservation, the reservation isn't fully consumed, and the VM and the reservation's properties are matching, see the troubleshooting documentation for [Resource availability](/compute/docs/troubleshooting/troubleshooting-reservation-creation#resource-availability) .\n## View reservation usage reports\nExport detailed reports of your Compute Engine usage to a Cloud Storage bucket using the usage export feature. For instructions, see [Viewing usage reports](/compute/docs/usage-export) .\nThe usage report shows the following:\n- The reserved resources that are in use. These entries appear as normal vCPU, memory, GPU, and local SSD resources.\n- The reserved resources that are not in use. These entries have normal SKU names and reservation resource URIs.\n- Total reserved resources. These entries have reservation SKU names and reservation resource URIs. There are no costs associated with these entries. Use these entries to calculate how much of your reservations you are using.\n| Measurement       | MeasurementId format           | Resource URI format                                                     |\n|:---------------------------------------|:-------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Reserved resources that are in use  | com.google.cloud/services/compute-engine/SKU_NAME   | https://compute.googleapis.com/compute/v1/projects/PROJECT_ID/zones/ZONE/RESOURCE_TYPE/RESOURCE_NAME. For example, https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central1-a/instances/my-instance   |\n| Reserved resources that are not in use | com.google.cloud/services/compute-engine/SKU_NAME   | https://compute.googleapis.com/compute/v1/projects/PROJECT_ID/zones/ZONE/reservations/RESERVATION_NAME. For example, https://compute.googleapis.com/compute/v1/projects/my-project/zones/europe-west1-b/reservations/my-reservation |\n| Total reserved resources    | com.google.cloud/services/compute-engine/ReservationSKU_NAME | https://compute.googleapis.com/compute/v1/projects/PROJECT_ID/zones/ZONE/reservations/RESERVATION_NAME. For example, https://compute.googleapis.com/compute/v1/projects/my-project/zones/europe-west1-b/reservations/my-reservation |\nFor example, in the following snippet from a usage report for a reservation named `my-reservation` :\n- Row 1 shows reserved RAM that is currently in use. The row's`ResourceId`shows that this RAM is used by a VM named`my-instance`.\n- Row 2 shows reserved RAM that is not in use. The row's`ResourceId`shows that this reserved RAM is held by`my-reservation`; it is not yet used by any VM.\n- Row 3 shows the reservation's total reserved RAM.\n```\nReport Date,MeasurementId,Quantity,Unit,Resource URI,ResourceId,Location\n2019-06-06,com.google.cloud/services/compute-engine/VmimageN2StandardRam,166970074857472,byte-seconds,https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central2-a/instances/my-instance,1775485842510981624,us-central2-a\n2019-06-06,com.google.cloud/services/compute-engine/VmimageN2StandardRam,166970074857472,byte-seconds,https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central2-a/reservations/my-reservation,7.58809E+17,us-central2-a\n2019-06-06,com.google.cloud/services/compute-engine/ReservationN2StandardRam,333940149714944,byte-seconds,https://compute.googleapis.com/compute/v1/projects/my-project/zones/us-central2-a/reservations/my-reservation,7.58809E+17,us-central2-a\n...\n```\n## Troubleshoot\nLearn how to [troubleshoot issues with reservation consumption](/compute/docs/troubleshooting/troubleshooting-reservation-consumption) .\n## What's next\n- Learn how to [monitor reservations consumption](/compute/docs/instances/reservations-monitor) .\n- Learn how to [modify reservations](/compute/docs/instances/reservations-modify) .\n- Learn how to [delete reservations](/compute/docs/instances/reservations-delete) .", "guide": "Compute Engine"}