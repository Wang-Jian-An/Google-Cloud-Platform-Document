{"title": "Apigee - Step 3: Create an environment group", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - Step 3: Create an environment group\nYou are currently viewing version 1.8 of the Apigee hybrid documentation. **This version is end of life.** You should upgrade to a newer version. For more information, see [Supported versions](/apigee/docs/hybrid/supported-platforms#supported-versions) .\nIn this step, you will create an environment and an environment group.\nIn Apigee, API proxies are deployed to , which provide isolated contexts for your proxies. Environments are organized into , which provide hostnames for all the proxies deployed to environments within the group. You must have at least one environment and at least one environment group. To learn more, see [About environments and environment groups](/apigee/docs/api-platform/fundamentals/environments-overview) .\n", "content": "## \n Create an environment\nCreate the environment first before creating the environment group. You can create an environment using the Apigee UI or using the API. You may want to use the UI for these steps to familiarize yourself with it.\nTo access the UI and add an environment, perform the following steps:- Open the [Apigee UI](https://apigee.google.com) . If this is the first time you are logging in, hybrid displays a  consent dialog. If you are prompted to select from more than one account, choose the account  that owns the project you created in [Step 2: Create a Google Cloud project](/apigee/docs/hybrid/v1.8/precog-gcpproject) . Then click **Allow** .\n- Your browser navigates to the UI main landing page:\n- Ensure that your organization is selected from the organization drop-down list.  If it is not selected, select it from the drop-down list, as the following example shows: **Note:** When you select an organization from the drop-down list, the hybrid  UI displays the Apigee organization name and the Google Cloud project name in the header.  The Apigee organization name and Google Cloud project name are the same.\n- Click **Admin > Environments > Overview** .The **Environments** view is displayed, with no environments (yet):\n- Click **+Environment** .The **New environment** dialog is displayed:\n- Enter the following information in the **New Environment** dialog:- **Display name** **(Required)** : A friendly name for the environment that is used in the UI.   For example, \"My First Environment\" or \"test\". Unlike the **Environment\n  name** , the **Display name** can include uppercase and other special   characters.\n- **Environment name** **(Required)** : The programmatic name for the environment; also known   as the.For example, \"my-environment\" or \"test\". **Caution:** An environment name can contain only lowercase   letters, numbers, and hyphens. You cannot use uppercase letters or any other special   characters. In addition, the **Environment name** can be up to a maximum of   32 characters long. For example:`my-test-env`or`my-test-env-42`.The **Display name** and the **Environment name** can be   different.\n- **Description** (): Additional information about the environment that   you want to add as a reminder of the purpose of the environment. For example, \"Created   during initial installation\".\n- Click **Create** .Apigee creates the new environment and indicates that it is **Pending Provisioning** :In a few moments, it changes to :However, you're not quite done. You also need to add your new environment to the  runtime's `overrides.yaml` file\u2014but first you've got to install the runtime,  so let's not get ahead of ourselves.\nTo create an environment with the [Create  environments API](/apigee/docs/reference/apis/apigee/rest/v1/organizations.environments) , perform the following steps:- Open a terminal on the device you are using to manage Apigee.\n- On the command line, get your `gcloud` authentication  credentials using the following command:\n```\nexport TOKEN=$(gcloud auth print-access-token)\n```\nTo check that your token was populated, use `echo` , as the   following example shows:\n```\necho $TOKEN\n```\nThis should display your token as an encoded string.```\nfor /f \"tokens=*\" %a in ('gcloud auth print-access-token') do set TOKEN=%a\n```\nTo check that your token was populated, use `echo` , as the   following example shows:\n```\necho %TOKEN%\n```\nThis should display your token as an encoded string.\n- Create the following environment variable:\n```\nexport ENV_NAME=\"YOUR_ENV_NAME\"\n``````\nset ENV_NAME=\"YOUR_ENV_NAME\"\n```\nWhere:- **ENV_NAME** **(Required)** The environment name can contain lowercase letters, dashes, and numbers and    must start with a lowercase letter. This name will be used as the identifier and cannot be    changed after creation of the environment.- Call the following Apigee API:```\ncurl -H \"Authorization: Bearer $TOKEN\" -X POST -H \"content-type:application/json\" -d '{\n \"name\": \"'\"$ENV_NAME\"'\"\n }' \"https://apigee.googleapis.com/v1/organizations/$ORG_NAME/environments\"\n```On a successful creation request, the Environments API should respond with a message similar  to the following:```\n{\u00a0 \"name\": \"organizations/hybrid-example/operations/c2aee040-7e79-4fd4-b0cf-79ca1b7098a8\",\u00a0 \"metadata\": {\u00a0 \u00a0 \"@type\": \"type.googleapis.com/google.cloud.apigee.v1.OperationMetadata\",\u00a0 \u00a0 \"operationType\": \"INSERT\",\u00a0 \u00a0 \"targetResourceName\": \"organizations/hybrid-example/environments/example-env\",\u00a0 \u00a0 \"state\": \"IN_PROGRESS\"\u00a0 }}\n```As the `state` property in the response indicates, Apigee has started to create  the new environment, so its state is `IN_PROGRESS` .\n- Check to verify the environment was created successfully:```\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n   \"https://apigee.googleapis.com/v1/organizations/$ORG_NAME/environments\"\n```On a successful creation request, the Environments API responds with a message similar  to the following:```\n[ \"your-environment-name\"\n]\n```\n## \n Create an environment group\nNow create an environment group and assign the environment you just created to it.\nTo create an environment group using the Apigee UI, perform the following steps:- Open the [Apigee UI](https://apigee.google.com) .\n- Your browser navigates to the Apigee UI main landing page.\n- Ensure that your organization is selected from the organization drop-down list.   If it is not selected, select it from the drop-down list.\n- Click **Admin > Environments > Groups** .The **Environment Groups Overview** view is displayed, with any created environment groups: \n- Click **+Environment Group** .The **Add an Environment Group** dialog is displayed. \n- Enter a name and then click **Add** .\n- Hold the pointer over the newly-created environment group and then click **Edit** edit .Add a hostname that all proxies deployed to environments within this group will use. This   should be a domain you have management access to. The hostname can be the domain itself,   like `example.com` or it can include a subdomain like `my-proxies.example.com` .If you need to register a domain, see a domain registrar like [Google Domains](https://domains.google) .\n- \n- Click **Add (+)** .\n- The **Add environment** dialog displays.\n- \n- Select an environment from the list and then click **Add** .\nTo create an environment group using the Apigee API:- On the command line, get your `gcloud` authentication  credentials using the following command:\n```\nTOKEN=$(gcloud auth print-access-token)\n``````\nfor /f \"tokens=*\" %a in ('gcloud auth print-access-token') do set TOKEN=%a\n```\n- Create the following environment variables:\n```\nexport DOMAIN=\"YOUR_DOMAIN\"\nexport ENV_GROUP=\"YOUR_ENVIRONMENT_GROUP\"\n``````\n data-terminal-prefix=\">\">set ENV_GROUP=\"YOUR_ENVIRONMENT_GROUP\"\n data-terminal-prefix=\">\">set DOMAIN=\"YOUR_DOMAIN\"\n```\nWhere:- **DOMAIN** **(Required)** This is the hostname that all proxies    deployed to environments within this group will use. This should be a domain you manage.    The address can be the domain itself, like`example.com`or it can include a    subdomain like`my-proxies.example.com`. If you don't have a managed domain,    you can enter a placeholder for now. You can change the domain address later.\n- **ENV_GROUP** **(Required)** The environment name can contain lowercase letters, dashes, and numbers and    must start with a lowercase letter. This name will be used as the identifier and cannot be    changed after creation.\n- Create the environment group:```\ncurl -H \"Authorization: Bearer $TOKEN\" -X POST -H \"content-type:application/json\" \\\n -d '{\n  \"name\": \"'\"$ENV_GROUP\"'\",\n  \"hostnames\":[\"'\"$DOMAIN\"'\"]\n }' \\\n \"https://apigee.googleapis.com/v1/organizations/$ORG_NAME/envgroups\"\n \n```\n- Assign the environment to the new group:```\ncurl -H \"Authorization: Bearer $TOKEN\" -X POST -H \"content-type:application/json\" \\\n -d '{\n  \"environment\": \"'\"$ENV_NAME\"'\",\n }' \\\n \"https://apigee.googleapis.com/v1/organizations/$ORG_NAME/envgroups/$ENV_GROUP/attachments\"\n \n```\n- Verify whether the environment group was created successfully with the following CURL command:```\ncurl -H \"Authorization: Bearer $TOKEN\" \\ \n  \"https://apigee.googleapis.com/v1/organizations/$ORG_NAME/envgroups\"\n```On a successful creation request, the Environments Group API responds with a message similar to the following:```\n  {\n  \"environmentGroups\": [   {\n   \"name\": \"your_envgroup_hybrid\",\n   \"hostnames\": [    \"apigee.hybrid.com\"\n   ],\n   \"createdAt\": \"1677826235324\",\n   \"lastModifiedAt\": \"1677826235324\",\n   \"state\": \"ACTIVE\"\n   }\n  ]\n  }\n \n```\n- Fetch the latest attachments for the newly created environment group by using following CURL command:```\ncurl -H \"Authorization: Bearer $TOKEN\" \\ \n  \"https://apigee.googleapis.com/v1/organizations/$ORG_NAME/envgroups/$ENV_GROUP/attachments\"\n```The environment group creation and attachment were successful if the result shows a unique hash value, as shown in the below sample response output:```\n  \n  {\n   \"environmentGroupAttachments\": [   {\n    \"name\": \"c27046d1-b83e-4cba-xxxx-caaa660b2bd6\",\n    \"environment\": \"your_envtest_hybrid\",\n    \"createdAt\": \"1677826263567\",\n    \"environmentGroupId\": \"your_envgroup_hybrid\"\n   }\n   ]\n  }\n  \n```## Next step\nTo continue with the installation, go to [Part 2: Hybrid runtime setup](/apigee/docs/hybrid/v1.8/install-before-begin) .", "guide": "Apigee"}