{"title": "Vertex AI Vision - Create and update app instances", "url": "https://cloud.google.com/vision-ai/docs/create-app-instances?hl=zh-cn", "abstract": "# Vertex AI Vision - Create and update app instances\nAfter you [build](/vision-ai/docs/build-app) and [deploy](/vision-ai/docs/deploy-app) apps, you can create and update these app instances using the Google Cloud console or command line.\n", "content": "## Create an app instance\nTo create an app instance, send a POST request by using the [projects.locations.applications.createApplicationInstances](/vision-ai/docs/reference/rest/v1/projects.locations.applications/createApplicationInstances) method.\nBefore using any of the request data, make the following replacements:- : Your Google Cloud [project number](/resource-manager/docs/creating-managing-projects#identifying_projects) .\n- : The [region](/about/locations) where you are using Vertex AI Vision. For example:`us-central1`,`europe-west4`. See [available regions](/vision-ai/docs/warehouse-supported-regions) .\n- : The ID of your target application.\nHTTP method and URL:\n```\nPOST https://visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/applications/APPLICATION_ID:createApplicationInstances\n```\nRequest JSON body:\n```\n{\n \"applicationInstances\": [ {\n  \"instance\": {\n  \"inputResources\": [   {\n   \"consumerNode\": \"input-stream\",\n   \"inputResource\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/clusters/application-cluster-0/streams/STREAM_ID\"\n   }\n  ]\n  },\n  \"instanceId\": \"INSTANCE_ID\"\n },\n {\n  \"instance\": {\n   [...]\n },\n [...]\n ]\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X POST \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/applications/APPLICATION_ID:createApplicationInstances\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method POST ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/applications/APPLICATION_ID:createApplicationInstances\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"name\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/operations/OPERATION_ID\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.visionai.v1.OperationMetadata\",\n \"createTime\": \"[...]\",\n \"Target\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/applications/APPLICATION_ID\"\n \"Verb\": \"update\"\n \"apiVersion\": \"v1\"\n },\n \"done\": false\n}\n```\n## Update an app instance\nAfter you create an app and [get an app instance ID](#view-app-output) , you can modify the following app instance resources:\n- **Input stream** : You can change the input stream asset.\n- **Output warehouse asset** : You can update the output asset if you connected to a warehouse and want to write the output to a different warehouse (`corpus`) asset.\n- **Output stream** : You can overwrite the output stream if you want to update the output stream from an auto generated stream to a specific stream you create. \nTo update an app instance, send a POST request by using the [projects.locations.applications.updateApplicationInstances](/vision-ai/docs/reference/rest/v1/projects.locations.applications/updateApplicationInstances) method.\nThe following code sample updates the input stream ( `inputResources` ), and all output resources associated with the app instance ( `outputResources` ).\nBefore using any of the request data, make the following replacements:- : Your Google Cloud [project ID or project number](/resource-manager/docs/creating-managing-projects#identifying_projects) .\n- : The [region](/about/locations) where you are using Vertex AI Vision. For example:`us-central1`,`europe-west4`. See [available regions](/vision-ai/docs/warehouse-supported-regions) .\n- : The ID of your target application.\n- : The full resource name of the app instance. For example:- `projects/` `` `/locations/` `` `/applications/` `` `/instances/` ``\n- `inputResources`: The input resource (or resources) for the current application instance. This is an array of objects that contain the following fields:- `consumerNode`: The name of graph node who receives the input resource.\n- `inputResource`: The full input resource name.\n- `outputResources`: All the output resources associated to one application instance. This is an array of objects that contain the following fields:- `outputResource`: The full output resource name.\n- `producerNode`: The name of graph node who produces the output resource  name.\nHTTP method and URL:\n```\nPOST https://visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/applications/APPLICATION_ID:updateApplicationInstances\n```\nRequest JSON body:\n```\n{\n \"applicationInstances\": [ {\n  \"instance\": {\n  \"name\": \"INSTANCE_NAME\",\n  \"inputResources\": [   {\n   \"consumerNode\": \"input-stream\",\n   \"inputResource\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/clusters/application-cluster-0/streams/STREAM_ID\"\n   }\n  ],\n  \"outputResources\":[   {\n   \"outputResource\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID\",\n   \"producerNode\": \"warehouse\"\n   },\n   {\n   \"outputResource\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/clusters/application-cluster-0/streams/STREAM_ID\",\n   \"producerNode\": \"occupancy-count\"\n   }\n  ]\n  },\n }\n ],\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X POST \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/applications/APPLICATION_ID:updateApplicationInstances\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method POST ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/applications/APPLICATION_ID:updateApplicationInstances\" | Select-Object -Expand Content\n```\n## Manage large scale apps\nThe deploy and undeploy methods are valid for applications with less than 20 instances. If your app has more than 20 instances you must create and remove instances incrementally with the API. The recommended workflow is as follows:\n- Create your app.\n- Add 1-20 experimental instances.\n- Deploy your application.\n- Verify your app works as expected.\n- Use the [createApplicationInstances](/vision-ai/docs/reference/rest/v1/projects.locations.applications/createApplicationInstances) method to incrementally add more inputs to the deployed application.\n- Allow app to run.\n- Use the [deleteApplicationInstances](/vision-ai/docs/reference/rest/v1/projects.locations.applications/deleteApplicationInstances) method to incrementally remove inputs from deployed applications.\n- Undeploy the application.\n**Caution:** For a single application there can only be update request running at a time. You are responsible for queueing these types of requests, and performing the necessary retries if there is a failure.", "guide": "Vertex AI Vision"}