{"title": "Vertex AI Vision - Search Image Warehouse data", "url": "https://cloud.google.com/vision-ai/docs/image-warehouse-search?hl=zh-cn", "abstract": "# Vertex AI Vision - Search Image Warehouse data\nAfter you have created an image corpus and performed [AnalyzeCorpus](/vision-ai/docs/reference/rest/v1/projects.locations.corpora/analyze) to generate embedding signals on corpus data, you can proceed to create an index and an index endpoint. After deploying the index to this index endpoint, you can then perform semantic search with criteria filter capabilities. The search result contains a list of images sorted by [relevance score](/vision-ai/docs/reference/rpc/google.cloud.visionai.v1#searchresultitem) .\n", "content": "## Search with input text\nTo search the [assets](/vision-ai/docs/reference/rest/v1/projects.locations.corpora.assets) in your [corpus](/vision-ai/docs/reference/rest/v1/projects.locations.corpora) , populate the [SearchIndexEndpointRequest](/vision-ai/docs/reference/rpc/google.cloud.visionai.v1#searchindexendpointrequest) with the intended search, in the following formats:\n- `text_query`: Text query to search with.\n- Optional [criteria](/vision-ai/docs/reference/rest/v1/Criteria) or [exclusion_criteria](/vision-ai/docs/reference/rest/v1/Criteria) : Filter criteria on user-provided annotations. It can be applied to texts, numbers, booleans, or datetime values.\nIn the following example, consider a corpus that contains natural scenery images. To retrieve all assets that are relevant to \"sunset at beach\" and tagged with the annotation `\"state\": \"California\"` , send the following request (replace FIELD_NAME with `state` and replace FIELD_VALUE with `California` ):\nBefore using any of the request data, make the following replacements:- : Endpoint might include a prefix matching the`LOCATION_ID`such as`europe-west4-`. See more about [ regionalized endpoints](/vision-ai/docs/warehouse-supported-regions) .\n- : Your Google Cloud [project number](/resource-manager/docs/creating-managing-projects#identifying_projects) .\n- : The [region](/about/locations) where you are using Vertex AI Vision. For example:`us-central1`,`europe-west4`. See [available regions](/vision-ai/docs/warehouse-supported-regions) .\n- : The ID of your target index endpoint.\nHTTP method and URL:\n```\nPATCH https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\n```\nRequest JSON body:\n```\n{\n \"text_query\": \"sunset at beach\",\n \"criteria\": [ {\n  \"field\": \"state\",\n  \"text_array\": {\n   \"txt_values\": [   \"California\"\n   ]\n  }\n }\n ]\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X PATCH \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method PATCH ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"searchResultItems\": [ {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_1\",\n  \"relevance\": \"0.99\"\n },\n {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_2\",\n  \"relevance\": \"0.98\"\n }\n ]\n}\n```\n## Search with input image\nIf you have an image of a sunset at a beach, you can also use it as a search query to retrieve similar images:\nBefore using any of the request data, make the following replacements:- : Endpoint might include a prefix matching the`LOCATION_ID`such as`europe-west4-`. See more about [ regionalized endpoints](/vision-ai/docs/warehouse-supported-regions) .\n- : Your Google Cloud [project number](/resource-manager/docs/creating-managing-projects#identifying_projects) .\n- : The [region](/about/locations) where you are using Vertex AI Vision. For example:`us-central1`,`europe-west4`. See [available regions](/vision-ai/docs/warehouse-supported-regions) .\n- : The ID of your target index endpoint.\nHTTP method and URL:\n```\nPATCH https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\n```\nRequest JSON body:\n```\n{\n \"image_query\": {\n \"input_image\": \"IMAGE_BYTES\"\n },\n \"criteria\": [ {\n  \"field\": \"FIELD_NAME\",\n  \"text_array\": {\n   \"txt_values\": [   \"FIELD_VALUE\"\n   ]\n  }\n }\n ]\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X PATCH \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method PATCH ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"searchResultItems\": [ {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_1\",\n  \"relevance\": 0.99\n },\n {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_2\",\n  \"relevance\": 0.98\n }\n ]\n}\n```\n## Search with existing image\nYou can also use an existing image asset in the corpus to retrieve similar images. The first search result will be the same image asset with a 1.0 relevance score:\nBefore using any of the request data, make the following replacements:- : Endpoint might include a prefix matching the`LOCATION_ID`such as`europe-west4-`. See more about [ regionalized endpoints](/vision-ai/docs/warehouse-supported-regions) .\n- : Your Google Cloud [project number](/resource-manager/docs/creating-managing-projects#identifying_projects) .\n- : The [region](/about/locations) where you are using Vertex AI Vision. For example:`us-central1`,`europe-west4`. See [available regions](/vision-ai/docs/warehouse-supported-regions) .\n- : The ID of your target index endpoint.\n- : The ID of your target corpus.\n- : The ID of your target asset.\nHTTP method and URL:\n```\nPATCH https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\n```\nRequest JSON body:\n```\n{\n \"image_query\": {\n \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID\"\n }\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X PATCH \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method PATCH ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"searchResultItems\": [ {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_1\",\n  \"relevance\": 1.0\n },\n {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_2\",\n  \"relevance\": 0.99\n }\n ]\n}\n```", "guide": "Vertex AI Vision"}