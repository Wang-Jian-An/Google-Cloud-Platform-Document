{"title": "Vertex AI Vision - Search Batch Video Warehouse data", "url": "https://cloud.google.com/vision-ai/docs/batch-video-warehouse-search?hl=zh-cn", "abstract": "# Vertex AI Vision - Search Batch Video Warehouse data\nPrerequisite: create a Batch Video Warehouse with a deployed index.\n", "content": "## Search Batch Video Warehouse data in the console\n- Open the **Warehouses** tab of the Vertex AI Vision dashboard. [Go to the Warehouses tab](https://console.cloud.google.com/ai/vision-ai/media-warehouse) \n- Find the index endpoint you want to search, and click **Search Assets** .\n- You will see a list of videos (each corresponding to an asset), as well as one search bars at the top. You can either click a video to view it, or begin to search for videos.\n- To begin searching, enter a text query or upload an image as the search query. You will see a list of video clips on the right side of the search result page, each of which corresponds to a continuous video clip in the assets. The video clips are ranked by relevance to the input query.\n- You can use the `Filters` section on the left side of the search result page to refine your search. Each filter criteria consists of a data schema key and the annotation value you want to search. After specifying the filter criteria, click **Search** to execute the search.## Search Batch Video Warehouse data using the command line\nTo search the videos ( [assets](/vision-ai/docs/reference/rest/v1/projects.locations.corpora.assets) ) in your corpus ( [corpus](/vision-ai/docs/reference/rest/v1/projects.locations.corpora) ), populate the `searchIndexEndpoint` [request body](/vision-ai/docs/reference/rest/v1/projects.locations.indexEndpoints/searchIndexEndpoint#request-body) with the content that you would like to find. This content comes in a few different formats:\n- `text_query`or`image_query`: Query to search with.\n- Optional [criteria](/vision-ai/docs/reference/rest/v1/Criteria) : Filter criteria on user provided annotations.\nIn the following example, consider a corpus that contains natural scenery videos. To retrieve all assets that are relevant to \"sunset at beach\" and tagged with the annotation `\"state\": \"California\"` , send the following request:\nBefore using any of the request data, make the following replacements:- : Endpoint might include a prefix matching the`LOCATION_ID`such as`europe-west4-`. See more about [ regionalized endpoints](/vision-ai/docs/warehouse-supported-regions) .\n- : Your Google Cloud [project number](/resource-manager/docs/creating-managing-projects#identifying_projects) .\n- : The [region](/about/locations) where you are using Vertex AI Vision. For example:`us-central1`,`europe-west4`. See [available regions](/vision-ai/docs/warehouse-supported-regions) .\n- : The ID of your target index endpoint.\nHTTP method and URL:\n```\nPATCH https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\n```\nRequest JSON body:\n```\n{\n \"text_query\": \"sunset at beach\",\n \"criteria\": [ {\n  \"field\": \"state\",\n  \"text_array\": {\n   \"txt_values\": [   \"California\"\n   ]\n  }\n }\n ]\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X PATCH \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method PATCH ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"searchResultItems\": [ {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_1\"\n },\n {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_2\"\n }\n ]\n}\n```\nIf you have an image of a sunset at a beach, you can also use it as a search query by sending the following request (input image is in base64 encoding format):\nBefore using any of the request data, make the following replacements:- : Endpoint might include a prefix matching the`LOCATION_ID`such as`europe-west4-`. See more about [ regionalized endpoints](/vision-ai/docs/warehouse-supported-regions) .\n- : Your Google Cloud [project number](/resource-manager/docs/creating-managing-projects#identifying_projects) .\n- : The [region](/about/locations) where you are using Vertex AI Vision. For example:`us-central1`,`europe-west4`. See [available regions](/vision-ai/docs/warehouse-supported-regions) .\n- : The ID of your target index endpoint.\nHTTP method and URL:\n```\nPATCH https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\n```\nRequest JSON body:\n```\n{\n \"image_query\": {\n \"input_image\": \"IMAGE_BYTES\"\n },\n \"criteria\": [ {\n  \"field\": \"state\",\n  \"text_array\": {\n   \"txt_values\": [   \"California\"\n   ]\n  }\n }\n ]\n}\n```\nTo send your request, choose one of these options:\n **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\ncurl -X PATCH \\ -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\ -H \"Content-Type: application/json; charset=utf-8\" \\ -d @request.json \\ \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\"\n``` **Note:** The following command assumes that you have logged in to  the`gcloud`CLI with your user account by running [gcloud init](/sdk/gcloud/reference/init) or [gcloud auth login](/sdk/gcloud/reference/auth/login) ,  or by using [Cloud Shell](/shell/docs) ,  which automatically logs you into the`gcloud`CLI.  You can check the currently active account by running [gcloud auth list](/sdk/gcloud/reference/auth/list) .\nSave the request body in a file named `request.json` ,  and execute the following command:\n```\n$cred = gcloud auth print-access-token$headers = @{ \"Authorization\" = \"Bearer $cred\" }Invoke-WebRequest ` -Method PATCH ` -Headers $headers ` -ContentType: \"application/json; charset=utf-8\" ` -InFile request.json ` -Uri \"https://warehouse-visionai.googleapis.com/v1/projects/PROJECT_NUMBER/locations/LOCATION_ID/indexEndpoints/INDEX_ENDPOINT_ID:searchIndexEndpoint\" | Select-Object -Expand Content\n```\nYou should receive a JSON response similar to the following:\n```\n{\n \"searchResultItems\": [ {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_1\"\n },\n {\n  \"asset\": \"projects/PROJECT_NUMBER/locations/LOCATION_ID/corpora/CORPUS_ID/assets/ASSET_ID_2\"\n }\n ]\n}\n```", "guide": "Vertex AI Vision"}