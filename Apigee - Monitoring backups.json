{"title": "Apigee - Monitoring backups", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - Monitoring backups\nYou are currently viewing version 1.6 of the Apigee hybrid documentation. **This version is end of life.** You should upgrade to a newer version. For more information, see [Supported versions](/apigee/docs/hybrid/supported-platforms#supported-versions) .\nThis page describes how to monitor Cassandra backups. The approach for monitoring backups is the same for backups in Cloud Storage and backups in a remote server.\nYou can monitor the backups by viewing the details of the `apigee-cassandra-backup` cronjob, which is responsible for creating the backups. Use the `kubectl` command on your Kubernetes cluster to view the status of the cronjob.\nThe following examples show the usage of the `kubectl` command.\n- Check the status of the cron job:```\nkubectl get cronjobs -n apigee\n``````\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0SCHEDULE \u00a0 \u00a0 SUSPEND \u00a0 ACTIVE \u00a0 LAST SCHEDULE \u00a0 AGEapigee-cassandra-backup \u00a0 11 * * * * \u00a0 False \u00a0 \u00a0 0 \u00a0 \u00a0 \u00a0 \u00a09m27s \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 32m\n```\n- Check the status of the backup job:```\nkubectl get jobs -n apigee |grep apigee-cassandra-backup\n``````\napigee-cassandra-backup-1637176260 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a01/1 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 79s \u00a0 \u00a0 \u00a0 \u00a09m3s\n``````\nkubectl get pods -n apigee | grep backup\n``````\napigee-cassandra-backup-1637176260-vj5cg \u00a0 \u00a0 \u00a0 \u00a0 \u00a00/1 \u00a0 \u00a0 Completed \u00a0 0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a07m49s\n```\n- Check the backup logs:```\nkubectl logs -n apigee $(kubectl get pods -n apigee |grep apigee-cassandra-backup |awk '{print $1}')\n```If the backup is successful, you will see an output similar to the following:```\nstarting apigee-cassandra-default-0 in apigeesnapshot pid 25 started for pod apigee-cassandra-default-0 in namespace apigeestarting apigee-cassandra-default-1 in apigeesnapshot pid 36 started for pod apigee-cassandra-default-1 in namespace apigeestarting apigee-cassandra-default-2 in apigeesnapshot pid 48 started for pod apigee-cassandra-default-2 in namespace apigee\u00a025 36 48waiting on process 25INFO: removing old cassandra snapshotsINFO: removing old cassandra snapshotsINFO: removing old cassandra snapshotsRequested clearing snapshot(s) for [all keyspaces]Requested clearing snapshot(s) for [all keyspaces]Requested clearing snapshot(s) for [all keyspaces]...Operation completed over 1 objects.INFO: backup created tarball and transferred the file to gs://<bucket name>INFO: removing cassandra snapshotRequested clearing snapshot(s) for [all keyspaces]INFO: completed upload for 20211117191141finished backup\n```", "content": "## Viewing backup logs\nThe backup job:\n- Creates a`schema.cql`file.\n- Uploads it to your storage bucket.\n- Echoes the node to backup the data and uploads it at the same time.\n- Waits until all the data is uploaded.\nTo view the backup logs of a Kubernetes pod, run the `kubectl logs -f <pod_name> -n <namespace>` command. For example:\n```\nkubectl logs -f apigee-cassandra-backup-1.6451.680-pff6s -n apigee\n```\nThe output is similar to the following:\n```\nmyusername-macbookpro:cassandra-backup-utility myusername$ kubectl logs -f apigee-cassandra-backup-1.64577680-f9sc4starting apigee-cassandra-default-0 in defaultstarting apigee-cassandra-default-1 in defaultstarting apigee-cassandra-default-2 in default35 46 57waiting on process \u00a035Activated service account credentials for: [apigee-cassandra-backup-svc@gce-myusername.iam.gserviceaccount.com]Activated service account credentials for: [apigee-cassandra-backup-svc@gce-myusername.iam.gserviceaccount.com]Activated service account credentials for: [apigee-cassandra-backup-svc@gce-myusername.iam.gserviceaccount.com]Requested creating snapshot(s) for [all keyspaces] with snapshot name [20190406190808] and options {skipFlush=false}Snapshot directory: 20190406190808INFO: backup created cassandra snapshot 20190406190808tar: Removing leading `/' from member names/apigee/data/cassandra/data/ks1/mytest3-37bc2df0587811e98e8d875b0ed64754/snapshots//apigee/data/cassandra/data/ks1/mytest3-37bc2df0587811e98e8d875b0ed64754/snapshots/20190406190808//apigee/data/cassandra/data/ks1/mytest3-37bc2df0587811e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-Data.dbRequested creating snapshot(s) for [all keyspaces] with snapshot name [20190406190808] and options {skipFlush=false}Requested creating snapshot(s) for [all keyspaces] with snapshot name [20190406190808] and options {skipFlush=false}Snapshot directory: 20190406190808INFO: backup created cassandra snapshot 20190406190808tar: Removing leading `/' from member names/apigee/data/cassandra/data/system/hints-2666e20573ef38b390fefecf96e8f0c7/snapshots//apigee/data/cassandra/data/system/hints-2666e20573ef38b390fefecf96e8f0c7/snapshots/20190406190808//apigee/data/cassandra/data/system/hints-2666e20573ef38b390fefecf96e8f0c7/snapshots/20190406190808/manifest.json/apigee/data/cassandra/data/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/snapshots//apigee/data/cassandra/data/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/snapshots/20190406190808//apigee/data/cassandra/data/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/snapshots/20190406190808/manifest.json/apigee/data/cassandra/data/system/range_xfers-55d764384e553f8b9f6e676d4af3976d/snapshots//apigee/data/cassandra/data/system/range_xfers-55d764384e553f8b9f6e676d4af3976d/snapshots/20190406190808//apigee/data/cassandra/data/system/range_xfers-55d764384e553f8b9f6e676d4af3976d/snapshots/20190406190808/manifest.json/apigee/data/cassandra/data/system/peer_events-59dfeaea8db2334191ef109974d81484/snapshots//apigee/data/cassandra/data/system/peer_events-59dfeaea8db2334191ef109974d81484/snapshots/20190406190808//apigee/data/cassandra/data/system/peer_events-59dfeaea8db2334191ef109974d81484/snapshots/20190406190808/manifest.json/apigee/data/cassandra/data/system/built_views-4b3c50a9ea873d7691016dbc9c38494a/snapshots//apigee/data/cassandra/data/system/built_views-4b3c50a9ea873d7691016dbc9c38494a/snapshots/20190406190808//apigee/data/cassandra/data/system/built_views-4b3c50a9ea873d7691016dbc9c38494a/snapshots/20190406190808/manifest.json\u2026\u2026/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots//apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808//apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-3-big-Filter.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-2-big-CompressionInfo.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-2-big-Index.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-3-big-Statistics.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-2-big-Data.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-Index.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-Statistics.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-2-big-TOC.txt/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-2-big-Statistics.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-Summary.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-Filter.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-2-big-Summary.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-3-big-Index.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/manifest.json/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-2-big-Filter.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-2-big-Digest.crc32/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-3-big-Summary.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-3-big-Data.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-TOC.txt/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/schema.cql/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-3-big-CompressionInfo.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-Digest.crc32/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-3-big-TOC.txt/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-Data.db/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-3-big-Digest.crc32/apigee/data/cassandra/data/ks2/user-d6d39d70586311e98e8d875b0ed64754/snapshots/20190406190808/mc-1-big-CompressionInfo.db\u2026\u2026/tmp/tokens.txt/ [1 files][ \u00a0 \u00a00.0 B/ \u00a0 \u00a00.0 B]Operation completed over 1 objects./ [1 files][ \u00a0 \u00a00.0 B/ \u00a0 \u00a00.0 B]Operation completed over 1 objects.INFO: backup created tarball and transferred the file to gs://gce-myusername-apigee-cassandra-backup/apigeecluster/dc-1INFO: removing cassandra snapshotINFO: backup created tarball and transferred the file to gs://gce-myusername-apigee-cassandra-backup/apigeecluster/dc-1INFO: removing cassandra snapshotRequested clearing snapshot(s) for [all keyspaces]INFO: Backup 20190406190808 completedwaiting on process \u00a046Requested clearing snapshot(s) for [all keyspaces]INFO: Backup 20190406190808 completedRequested clearing snapshot(s) for [all keyspaces]waiting on process \u00a057INFO: Backup 20190406190808 completedwaiting resultto get schema from 10.32.0.28INFO: /tmp/schema.cql has been generatedActivated service account credentials for: [apigee-cassandra-backup-svc@gce-myusername.iam.gserviceaccount.com]tar: removing leading '/' from member namestmp/schema.cqlCopying from <TDIN>.../ [1 files][ \u00a0 \u00a00.0 B/ \u00a0 \u00a00.0 B]Operation completed over 1 objects.INFO: backup created tarball and transferred the file to gs://gce-myusername-apigee-cassandra-backup/apigeecluster/dc-1finished uploading schema.cql\n```", "guide": "Apigee"}