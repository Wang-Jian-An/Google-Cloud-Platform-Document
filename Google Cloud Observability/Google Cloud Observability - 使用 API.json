{"title": "Google Cloud Observability - \u4f7f\u7528 API", "url": "https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/using-api?hl=zh-cn", "abstract": "# Google Cloud Observability - \u4f7f\u7528 API\n\u672c\u6587\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528 Cloud Monitoring API \u7ba1\u7406\u670d\u52d9\u548c\u670d\u52d9\u7b49\u7d1a\u76ee\u6a19 (SLO)\u3002\nService Monitoring \u53ef\u5c07\u4ee5\u4e0b\u8cc7\u6e90\u6dfb\u52a0\u5230 Monitoring API \u4e2d\uff1a\n- [services](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services?hl=zh-cn) \n- [services.serviceLevelObjectives](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives?hl=zh-cn) \n\u672c\u6587\u6a94\u5c07\u9019\u4e9b\u65b0\u589e\u9805\u7d71\u7a31\u7232 SLO API\uff0c\u4e26\u8aaa\u660e\u4e3b\u8981\u7528\u9014\u3002\u5982\u9700\u5927\u81f4\u77ad\u89e3 SLO API \u4e2d\u7684\u7d50\u69cb\uff0c\u8acb\u53c3\u95b1 [API \u4e2d\u7684\u69cb\u9020](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/api-structures?hl=zh-cn) \u3002\u5168\u9762\u7684\u53c3\u8003\u8cc7\u6599\u5c07\u986f\u793a\u5728 [Cloud Monitoring API v3](https://cloud.google.com/monitoring/api/ref_v3/rest?hl=zh-cn) \u4e0b\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 SLO API \u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5275\u5efa\u548c\u7ba1\u7406\u670d\u52d9\u3002\n- \u6839\u64da\u4efb\u4f55\u670d\u52d9\u7684\u81ea\u5b9a\u7fa9\u6216\u9810\u5b9a\u7fa9\u670d\u52d9\u7b49\u7d1a\u6307\u6a19 (SLI) \u5275\u5efa\u670d\u52d9\u7b49\u7d1a\u76ee\u6a19 (SLO)\u3002", "content": "## \u6709\u6548\u6a19\u8b58\u7b26\nSLO API \u4e2d\u7684\u4e00\u4e9b\u65b9\u6cd5\u91dd\u5c0d\u4e0d\u540c\u5143\u7d20\u4f7f\u7528\u4e0d\u540c\u7684\u6a19\u8b58\u7b26\uff0c\u5c24\u5176\u662f\u9805\u76ee\u548c\u670d\u52d9\u7684\u6a19\u8b58\u7b26\u3002\u9019\u4e9b ID \u9075\u5faa\u4ee5\u4e0b\u898f\u5247\uff1a\n- \u9577\u5ea6\uff1a1-63 \u500b\u5b57\u7b26\n- \u5b57\u7b26\uff1a\u53ea\u80fd\u4f7f\u7528\u5c0f\u5beb\u5b57\u6bcd\u3001\u6578\u5b57\u548c\u9023\u5b57\u7b26\n- \u9996\u5b57\u6bcd\uff1a\u5c0f\u5beb\u5b57\u6bcd\n- \u5c3e\u5b57\u6bcd\uff1a\u5c0f\u5beb\u5b57\u6bcd\u6216\u6578\u5b57\uff0c\u4f46\u4e0d\u80fd\u662f\u9023\u5b57\u7b26\n\u9019\u4e9b\u898f\u5247\u7684\u6b63\u5247\u8868\u9054\u5f0f\u5982\u4e0b\u6240\u793a\uff1a `[a-z](?:[-a-z0-9]{0,61}[a-z0-9])?`\n## \u4f7f\u7528 curl \u7684\u793a\u4f8b\n\u672c\u90e8\u5206\u4ecb\u7d39\u4e86\u4f7f\u7528 `curl` \u5de5\u5177\u8abf\u7528 SLO API \u6240\u4f7f\u7528\u7684\u6163\u4f8b\u548c\u8a2d\u7f6e\u3002\u5982\u679c\u60a8\u662f\u901a\u904e\u5ba2\u6236\u7aef\u5eab\u4f7f\u7528\u6b64 API\uff0c\u5247\u53ef\u4ee5\u8df3\u904e\u6b64\u90e8\u5206\u3002\n\u672c\u9801\u9762\u4e2d\u7684\u793a\u4f8b\u901a\u904e\u4f7f\u7528 `curl` \u5de5\u5177\u5411 REST \u7aef\u9ede\u767c\u9001 HTTP \u8acb\u6c42\u4f86\u8a2a\u554f SLO API\u3002\u4f7f\u7528\u4ee5\u4e0b\u95dc\u65bc\u8eab\u4efd\u9a57\u8b49\u548c\u8abf\u7528 `curl` \u7684\u4fe1\u606f\u8a2d\u7f6e\u8abf\u7528\u4e2d\u4f7f\u7528\u7684\u8b8a\u91cf\u3002\n### \u8eab\u4efd\u9a57\u8b49\n- \u5275\u5efa\u4e00\u500b\u74b0\u5883\u8b8a\u91cf\u4f86\u4fdd\u5b58\u6307\u6a19\u7bc4\u570d\u7684\u7bc4\u570d\u9805\u76ee\u7684 ID\uff1a\u4ee5\u4e0b\u793a\u4f8b\u4f7f\u7528 `PROJECT_ID` \uff1a```\nPROJECT_ID=my-test-service\n```\n- \u5411 Google Cloud CLI \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff1a```\ngcloud auth login\n```\n- \u7232\u907f\u514d\u5fc5\u9808\u4f7f\u7528\u6bcf\u500b\u547d\u4ee4\u6307\u5b9a\u9805\u76ee ID\uff0c\u8acb\u4f7f\u7528 gcloud CLI \u5c07\u5176\u8a2d\u7f6e\u7232\u9ed8\u8a8d\u503c\uff1a```\ngcloud config set project ${PROJECT_ID}\n```\n- \u5275\u5efa\u6388\u6b0a\u4ee4\u724c\u4e26\u5c07\u5176\u5b58\u5132\u5230\u74b0\u5883\u8b8a\u91cf\u4e2d\u3002 \u9019\u4e9b\u793a\u4f8b\u8abf\u7528\u8b8a\u91cf `ACCESS_TOKEN` \uff1a```\nACCESS_TOKEN=`gcloud auth print-access-token`\n```\u60a8\u5fc5\u9808\u5b9a\u671f\u5237\u65b0\u8a2a\u554f\u4ee4\u724c\u3002\u5982\u679c\u547d\u4ee4\u7a81\u7136\u5831\u544a\u60a8\u672a\u901a\u904e\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u91cd\u65b0\u767c\u5e03\u6b64\u547d\u4ee4\u3002\n- \u8981\u9a57\u8b49\u60a8\u662f\u5426\u5df2\u7372\u5f97\u8a2a\u554f\u4ee4\u724c\uff0c\u8acb\u56de\u986f `ACCESS_TOKEN` \u8b8a\u91cf\uff1a```\necho ${ACCESS_TOKEN}ya29.GluiBj8o....\n```\n### \u8abf\u7528 curl\n\u6bcf\u500b `curl` \u8abf\u7528\u90fd\u5305\u542b\u4e00\u7d44\u53c3\u6578\uff0c\u5176\u5f8c\u9762\u662f SLO API \u8cc7\u6e90\u7684\u7db2\u5740\u3002\u5e38\u898b\u53c3\u6578\u5305\u62ec\u7531 `PROJECT_ID` \u548c `ACCESS_TOKEN` \u74b0\u5883\u8b8a\u91cf\u6307\u5b9a\u7684\u503c\u3002\u60a8\u53ef\u80fd\u9084\u9700\u8981\u6307\u5b9a\u5176\u4ed6\u53c3\u6578\uff0c\u4f8b\u5982\uff0c\u6307\u5b9a HTTP \u8acb\u6c42\u7684\u985e\u578b\uff08\u4f8b\u5982 `-X DELETE` \uff09\u3002\u9ed8\u8a8d\u8acb\u6c42\u7232 `GET` \uff0c\u56e0\u6b64\u793a\u4f8b\u672a\u6307\u5b9a\u8a72\u8acb\u6c42\u3002\n\u6bcf\u500b `curl` \u8abf\u7528\u5177\u6709\u4ee5\u4e0b\u4e00\u822c\u7d50\u69cb\uff1a\n`curl --http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" <other_args> https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/<request>`\n\u4f8b\u5982\uff0c\u5982\u9700\u5217\u51fa\u9805\u76ee\u4e2d\u7684\u6240\u6709\u670d\u52d9\uff0c\u8acb\u767c\u51fa\u4ee5\u4e0b `GET` \u8acb\u6c42\uff1a\n```\ncurl \u00a0--http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services\n```\n\u6b64\u8acb\u6c42\u6703\u8fd4\u56de\u4e00\u7d44\u670d\u52d9\u8aaa\u660e\uff0c\u5176\u4e2d\u5305\u542b\u5982\u4e0b\u6240\u793a\u7684\u689d\u76ee\uff0c\u793a\u4f8b\u662f\u670d\u52d9 ID \u7232\u201cmy-test-service\u201d\u7684 GKE \u5de5\u4f5c\u8ca0\u8f09\u670d\u52d9\uff1a\n```\n{\n \"services\": [ {\n  \"name\": \"projects/PROJECT_NUMBER/services/my-test-service\",\n  \"displayName\": \"My Test GKE Workload Service\",\n  \"basicService\": {\n  \"serviceType\": \"GKE_WORKLOAD\",\n  \"serviceLabels\": {\n   \"cluster_name\": \"workload-test\",\n   \"location\": \"us-central1-c\",\n   \"namespace_name\": \"kube-system\",\n   \"project_id\": \"lesser-weevil\",\n   \"top_level_controller_name\": \"gke-metrics-controller\",\n   \"top_level_controller_type\": \"DaemonSet\"\n  }\n  },\n  \"gkeWorkload\": {\n  \"projectId\": \"lesser-weevil\",\n  \"location\": \"us-central1-c\",\n  \"clusterName\": \"workload-test\",\n  \"namespaceName\": \"kube-system\",\n  \"topLevelControllerType\": \"DaemonSet\",\n  \"topLevelControllerName\": \"gke-metrics-controller\"\n  },\n  \"source\": \"USER\",\n  \"telemetry\": {\n  \"resourceName\": \"//container.googleapis.com/projects/PROJECT_ID/zones/us-central1-c/clusters/workload-test/k8s/namespaces/kube-system/apps/daemonsets/gke-metrics-controller\"\n  }\n },\n ...\n ]\n}\n```\n\u5982\u9700\u67e5\u770b\u7528\u65bc\u5275\u5efa\u6b64\u670d\u52d9\u7684\u914d\u7f6e\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u670d\u52d9](#service-create) \u3002\u8acb\u6ce8\u610f\uff0c\u6b64\u5217\u8868\u4e2d\u7684 `gkeWorkload` \u7d50\u69cb\u6d3e\u751f\u81ea\u7528\u65bc\u5275\u5efa\u670d\u52d9\u7684 `basicService` \u7d50\u69cb\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u670d\u52d9\u7684\u7d50\u69cb\uff0c\u8acb\u53c3\u95b1 [Service](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services?hl=zh-cn#Service) \u3002\n## \u7ba1\u7406\u670d\u52d9\n[Service](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services?hl=zh-cn#Service) \u8cc7\u6e90\u5145\u7576\u7d44\u7e54\u670d\u52d9\u7684\u6839\u5143\u7d20\u3002\u67d0\u500b\u7279\u5b9a\u670d\u52d9\u7684\u5404\u65b9\u9762\uff08\u4f8b\u5982\u5176 SLO\uff09\u90fd\u6309\u7167\u670d\u52d9\u540d\u7a31\u6574\u7406\u3002 \u652f\u6301\u4ee5\u4e0b\u670d\u52d9\u985e\u578b\uff1a\n- App Engine \u670d\u52d9\uff1a`APP_ENGINE`\n- Cloud Endpoints \u670d\u52d9\uff1a`CLOUD_ENDPOINTS`\n- \u898f\u7bc4\u5316 Istio \u670d\u52d9\uff1a`ISTIO_CANONICAL_SERVICE`\n- \u96c6\u7fa3 Istio \u670d\u52d9\uff1a`CLUSTER_ISTIO`\n- Cloud Run \u670d\u52d9\uff1a`CLOUD_RUN`\n- \u4e00\u7d44\u57fa\u65bc Google Kubernetes Engine \u7684\u670d\u52d9\uff1a- GKE \u670d\u52d9\uff1a`GKE_SERVICE`\n- GKE \u547d\u540d\u7a7a\u9593\uff1a`GKE_NAMESPACE`\n- GKE \u5de5\u4f5c\u8ca0\u8f09\uff1a`GKE_WORKLOAD`\n- \u81ea\u5b9a\u7fa9\u670d\u52d9\uff1a`CUSTOM`\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u57fa\u672c\u670d\u52d9\u985e\u578b](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/api-structures?hl=zh-cn#basic-svc-w-basic-sli) \u6216 [\u57fa\u672c GKE \u670d\u52d9\u985e\u578b](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/api-structures?hl=zh-cn#basic-svc-wo-basic-sli) \u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 API \u5c07 SLO \u6dfb\u52a0\u5230\u9805\u76ee\u4e2d\u7684\u4efb\u4f55\u670d\u52d9\u3002 [\u7ba1\u7406 SLO](#managing-slos) \u6db5\u84cb\u64cd\u7e31 SLO \u7684\u547d\u4ee4\u3002\n### \u670d\u52d9 ID\n\u6bcf\u500b\u670d\u52d9\u90fd\u6709\u4e00\u500b\u88ab\u7a31\u7232 \u7684\u5b8c\u5168\u9650\u5b9a\u6a19\u8b58\u7b26\u3002\u6b64\u6a19\u8b58\u7b26\u5b58\u5132\u5728\u670d\u52d9\u8aaa\u660e\u7684 `name` \u5b57\u6bb5\u4e2d\uff0c\u4f8b\u5982\uff1a\n```\n\"name\": \"projects/PROJECT_NUMBER/services/PROJECT_ID-zone-us-central1-a-cloudrun-istio-system-cluster-local-gateway\",\n```\n\u8cc7\u6e90\u540d\u7a31\u4e2d\u5d4c\u5165\u4e86\u670d\u52d9\u7684\u8f03\u77ed ID\uff0c\u5373\u8cc7\u6e90\u540d\u7a31\u4e2d\u5b50\u5b57\u7b26\u4e32 `projects/` `` `/services/` \u4e4b\u5f8c\u7684\u90e8\u5206\n\u5982\u679c\u60a8\u4f7f\u7528\u8cc7\u6e90\u540d\u7a31 `projects/` `` `/services/my-test-service` \u5275\u5efa\u4e86\u81ea\u5df1\u7684\u670d\u52d9\uff0c\u5247\u670d\u52d9 ID \u7232 `my-test-service` \u3002\n\u7232\u4e86\u7c21\u6f54\u548c\u6e96\u78ba\uff0c\u8a31\u591a `curl` \u793a\u4f8b\u5047\u8a2d\u670d\u52d9 ID \u4fdd\u5b58\u5728\u74b0\u5883\u8b8a\u91cf `SERVICE_ID` \u4e2d\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u53cd\u8986\u53c3\u8003\u3002\n### \u5217\u51fa\u670d\u52d9\n\u8981\u6aa2\u7d22\u9805\u76ee\u4e2d\u6240\u6709\u670d\u52d9\u7684\u76f8\u95dc\u4fe1\u606f\uff0c\u8acb\u8abf\u7528 [services.list](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services/list?hl=zh-cn) \u65b9\u6cd5\u3002\u8981\u6309\u670d\u52d9 ID \u6aa2\u7d22\u7279\u5b9a\u670d\u52d9\u7684\u76f8\u95dc\u4fe1\u606f\uff0c\u8acb\u4f7f\u7528 [services.get](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services/get?hl=zh-cn) \u65b9\u6cd5\uff1a\n\u8981\u4f7f\u7528\n`curl`\n\u5217\u51fa\u6709\u95dc\u670d\u52d9\u7684\u4fe1\u606f\uff0c\u8acb\u901a\u904e\u5c07\n`GET`\n\u8acb\u6c42\u767c\u9001\u7d66\u4ee5\u4e0b\u5c0d\u8c61\uff0c\u4f86\u8abf\u7528\n [services.list](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services/list?hl=zh-cn) \n\u6216\n [services.get](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services/get?hl=zh-cn) \n\u65b9\u6cd5\uff1a\n- \u8981\u5217\u51fa\u6240\u6709\u670d\u52d9\uff0c\u8acb\u767c\u9001\u81f3`https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services`\n- \u8981\u7372\u53d6\u7279\u5b9a\u670d\u52d9\uff0c\u8acb\u767c\u9001\u81f3`https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services/` ``\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8acb\u6c42\u6703\u6aa2\u7d22\u8207\u74b0\u5883\u8b8a\u91cf `SERVICE_ID` \u4e2d\u5b58\u5132\u7684\u503c\u6240\u6a19\u8b58\u670d\u52d9\u76f8\u95dc\u7684\u4fe1\u606f\uff1a\n```\ncurl \u00a0--http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services/${SERVICE_ID}\n```### \u5275\u5efa\u670d\u52d9\n\u8981\u5275\u5efa\u670d\u52d9\uff0c\u8acb\u6307\u5b9a\u670d\u52d9\u985e\u578b\u7684\u8868\u793a\u5f62\u5f0f\u4e26\u5c07\u5176\u767c\u9001\u5230 [services.create](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services/create?hl=zh-cn) \u65b9\u6cd5\u3002\u60a8\u53ef\u4ee5\u5275\u5efa [\u57fa\u672c\u670d\u52d9\u985e\u578b](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/api-structures?hl=zh-cn#basic-svc-w-basic-sli) \u548c [\u57fa\u672c GKE \u670d\u52d9\u985e\u578b](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/api-structures?hl=zh-cn#basic-svc-wo-basic-sli) \u4e2d\u6240\u8ff0\u7684\u670d\u52d9\u985e\u578b\u7d50\u69cb\u3002\n\u9019\u4e9b\u7d50\u69cb\u5404\u4e0d\u76f8\u540c\uff0c\u4f46\u8abf\u7528 API \u7684\u904e\u7a0b\u662f\u76f8\u540c\u7684\u3002\u60a8\u5fc5\u9808\u6307\u5b9a\u670d\u52d9\u7684\u986f\u793a\u540d\u7a31\u4ee5\u53ca\u4fdd\u5b58\u670d\u52d9\u8868\u793a\u6cd5\u7684 `basicService` \u5b57\u6bb5\u3002\n\u60a8\u53ef\u4ee5\u9078\u64c7\u6307\u5b9a\u60a8\u5e0c\u671b\u670d\u52d9\u5177\u6709\u7684\u670d\u52d9 ID\u3002 \u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u77ad\u5982\u4f55\u5275\u5efa {[gke_name_short}} \u5de5\u4f5c\u8ca0\u8f09\u670d\u52d9\uff1a\n\u8981\u4f7f\u7528 `curl` \u5275\u5efa\u670d\u52d9\uff0c\u8acb\u5411 `https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services` \u7aef\u9ede\u767c\u9001\u4e00\u689d `POST` \u6d88\u606f\uff1a- \u5982\u679c\u8981\u63d0\u4f9b\u670d\u52d9 ID\uff0c\u8acb\u7232\u670d\u52d9 ID \u5275\u5efa\u8b8a\u91cf\uff1a```\nSERVICE_ID=my-test-service\n```\u7db2\u5740\u67e5\u8a62\u53c3\u6578 `service_id` \u4e2d\u6703\u63d0\u4f9b\u6b64\u503c\u3002\n- \u5275\u5efa\u8b8a\u91cf\u4ee5\u4fdd\u5b58\u63cf\u8ff0\u670d\u52d9\u7684\u8acb\u6c42\u6b63\u6587\uff1a```\nCREATE_SERVICE_POST_BODY=$(cat <<EOF{\u00a0 \"displayName\": \"My Test GKE Workload Service\",\u00a0 \"basicService\": {\u00a0 \u00a0 \"serviceType\": \"GKE_WORKLOAD\",\u00a0 \u00a0 \"serviceLabels\": {\u00a0 \u00a0 \u00a0 \"cluster_name\": \"workload-test\",\u00a0 \u00a0 \u00a0 \"location\": \"us-central1-c\",\u00a0 \u00a0 \u00a0 \"namespace_name\": \"kube-system\",\u00a0 \u00a0 \u00a0 \"project_id\": \"PROJECT_ID\",\u00a0 \u00a0 \u00a0 \"top_level_controller_name\": \"gke-metrics-controller\",\u00a0 \u00a0 \u00a0 \"top_level_controller_type\": \"DaemonSet\"\u00a0 \u00a0 }\u00a0 }}EOF)\n```\n- \u5c07\u8acb\u6c42\u6b63\u6587\u767c\u4f48\u5230\u7aef\u9ede\uff0c\u4e26\u6307\u5b9a\u670d\u52d9 ID \u4f5c\u7232 `service_id` \u67e5\u8a62\u53c3\u6578\u7684\u503c\uff1a```\ncurl \u00a0--http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" --header \"Content-Type: application/json\" -X POST -d \"${CREATE_SERVICE_POST_BODY}\" https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services?service_id=${SERVICE_ID}\n```\n\u5982\u9700\u67e5\u770b\u8207\u5176\u4ed6\u670d\u52d9\u95dc\u806f\u7684\u7d50\u69cb\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1 [\u57fa\u672c\u670d\u52d9\u985e\u578b](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/api-structures?hl=zh-cn#basic-svc-w-basic-sli) \u6216 [\u57fa\u672c GKE \u670d\u52d9\u985e\u578b](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/api-structures?hl=zh-cn#basic-svc-wo-basic-sli) \u3002\n### \u522a\u9664\u670d\u52d9\n\u5982\u9700\u522a\u9664\u60a8\u5275\u5efa\u7684\u670d\u52d9\uff0c\u8acb\u8abf\u7528 [services.delete](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services/delete?hl=zh-cn) \u65b9\u6cd5\u4e26\u6307\u5b9a\u670d\u52d9 ID\u3002\n\u8981\u4f7f\u7528\n`curl`\n\u522a\u9664\u670d\u52d9\uff0c\u8acb\u5411\n`https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services/` ``\n\u7aef\u9ede\u767c\u9001\n`DELETE`\n\u8acb\u6c42\uff1a\n```\ncurl \u00a0--http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" -X DELETE https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services/${SERVICE_ID}\n```\n## \u7ba1\u7406 SLO\n\u60a8\u53ef\u4ee5\u4f7f\u7528 SLO API \u5275\u5efa\u3001\u522a\u9664\u548c\u6aa2\u7d22 SLO\u3002\u6bcf\u500b\u670d\u52d9\u6700\u591a\u53ef\u4ee5\u6709 500 \u500b SLO\u3002\n\u8981\u7ba1\u7406\u670d\u52d9\u7684 SLO\uff0c\u60a8\u5fc5\u9808\u64c1\u6709\u670d\u52d9 ID\u3002SLO \u6839\u64da\u5176\u6240\u5c6c\u7684\u670d\u52d9\u9032\u884c\u547d\u540d\u3002 \u5982\u9700\u77ad\u89e3\u5982\u4f55\u8b58\u5225\u670d\u52d9 ID\uff0c\u8acb\u53c3\u95b1 [\u670d\u52d9 ID](#service-ids) \u3002\n### \u5217\u51fa SLO\n\u8981\u6aa2\u7d22\u8207\u670d\u52d9\u95dc\u806f\u7684\u6240\u6709 SLO \u7684\u76f8\u95dc\u4fe1\u606f\uff0c\u8acb\u8abf\u7528 [services.serviceLevelObjectives.list](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives/list?hl=zh-cn) \u65b9\u6cd5\u3002\u8981\u6309\u540d\u7a31\u6aa2\u7d22\u7279\u5b9a SLO \u7684\u76f8\u95dc\u4fe1\u606f\uff0c\u8acb\u4f7f\u7528 [services.serviceLevelObjectives.get](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives/get?hl=zh-cn) \u65b9\u6cd5\uff1a\n\u8981\u4f7f\u7528\n`curl`\n\u5217\u51fa\u6709\u95dc\u670d\u52d9\u7684\u4fe1\u606f\uff0c\u8acb\u901a\u904e\u5c07\n`GET`\n\u8acb\u6c42\u767c\u9001\u7d66\u4ee5\u4e0b\u5c0d\u8c61\uff0c\u4f86\u8abf\u7528\n [services.serviceLevelObjectives.list](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives/list?hl=zh-cn) \n\u6216\n [services.serviceLevelObjectives.get](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives/get?hl=zh-cn) \n\u65b9\u6cd5\uff1a\n- \u8981\u5217\u51fa\u6240\u6709 SLO\uff0c\u8acb\u767c\u9001\u81f3`https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services/[SERVICE_ID]/serviceLevelObjectives`\n- \u8981\u7372\u53d6\u7279\u5b9a SLO\uff0c\u8acb\u767c\u9001\u81f3`https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services/[SERVICE_ID]/serviceLevelObjectives/` ``\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8acb\u6c42\u5217\u51fa\u4e86\u8207\u5b58\u5132\u5728\u74b0\u5883\u8b8a\u91cf `SERVICE_ID` \u4e2d\u7684\u670d\u52d9 ID \u76f8\u95dc\u806f\u7684\u6240\u6709 SLO\uff1a\n```\ncurl \u00a0--http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services/${SERVICE_ID}/serviceLevelObjectives\n```\n\u4ee5\u4e0b\u662f\u5f9e\u201ccurrencyservice\u201d\u670d\u52d9\u6aa2\u7d22\u5230\u7684 SLO \u53ef\u7528\u6027\uff1a\n```\n{\n \"name\": \"projects/PROJECT_NUMBER/services/PROJECT_ID-zone-us-central1-c-csm-main-default-currencyservice/serviceLevelObjectives/3kavNVTtTMuzL7KcXAxqCQ\",\n \"displayName\": \"98% Availability in Calendar Week\"\n \"serviceLevelIndicator\": {\n \"basicSli\": {\n  \"availability\": {},\n  \"location\": [  \"us-central1-c\"\n  ]\n }\n },\n \"goal\": 0.98,\n \"calendarPeriod\": \"WEEK\",\n},\n```\n\u6b64 SLO \u662f\u57fa\u65bc SLI \u53ef\u7528\u6027\u69cb\u5efa\u7684\uff0c\u5b83\u8a2d\u7f6e\u7684\u76ee\u6a19\u6027\u80fd\u76ee\u6a19\u7232\u201c98\uff05\u201d\uff0c\u4e26\u4e14\u6703\u5728\u65e5\u66c6\u5468\u5167\u8861\u91cf\u5408\u898f\u6027\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 SLI \u53ef\u7528\u6027\uff0c\u8acb\u53c3\u95b1 [\u670d\u52d9\u7b49\u7d1a\u6307\u6a19](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring?hl=zh-cn#defn-sli) \u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3 SLO \u7684\u7d50\u69cb\uff0c\u8acb\u53c3\u95b1 [ServiceLevelObjective](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives?hl=zh-cn#ServiceLevelObjective) \u3002\n\u6bcf\u500b SLO \u5728\u670d\u52d9\u4e2d\u90fd\u6709\u4e00\u500b\u552f\u4e00\u6a19\u8b58\u7b26\uff0c\u7531 SLO `name` \u5b57\u6bb5\u4e2d\u4f4d\u65bc `serviceLevelObjectives` \u5f8c\u9762\u7684\u5b57\u7b26\u4e32\u7d44\u6210\u3002\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff1a\n```\n\"name\": \"projects/PROJECT_NUMBER/services/PROJECT_ID-zone-us-central1-c-csm-main-default-currencyservice/serviceLevelObjectives/3kavNVTtTMuzL7KcXAxqCQ\",\n```\nSLO ID \u7232\u5b57\u7b26\u4e32 `3kavNVTtTMuzL7KcXAxqCQ` \u3002\n\u8981\u6aa2\u7d22\u6709\u95dc\u6b64\u7279\u5b9a SLO \u7684\u4fe1\u606f\uff0c\u8acb\u6309 ID \u767c\u51fa SLO \u8acb\u6c42\u3002\n\u8981\u4f7f\u7528\n`curl`\n\u7372\u53d6\u7279\u5b9a SLO\uff0c\u8acb\u901a\u904e\u5411\n`https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services/` `` `/serviceLevelObjectives/` ``\n\u767c\u9001\n`GET`\n\u8acb\u6c42\u4f86\u8abf\u7528\n [services.serviceLevelObjectives.get](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives/get?hl=zh-cn) \n\u65b9\u6cd5\uff1a\n```\nSLO_ID=dhefHDM4TwSRZEKIV4ZYEg\ncurl --http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services/${SERVICE_ID}/serviceLevelObjectives/${SLO_ID}\n```### \u5275\u5efa SLO\n\u8981\u4f7f\u7528 SLO API \u5275\u5efa SLO\uff0c\u60a8\u5fc5\u9808\u5275\u5efa\u4e00\u500b [ServiceLevelObjective](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives?hl=zh-cn#ServiceLevelObjective) \u5c0d\u8c61\u4e26\u5c07\u5176\u50b3\u905e\u7d66 [serviceLevelObjectives.create](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives/create?hl=zh-cn) \u65b9\u6cd5\u3002\nSLO \u7684\u7d50\u69cb\u5177\u6709\u8a31\u591a\u5d4c\u5165\u5f0f\u7d50\u69cb\uff0c\u5176\u4e2d\u4fbf\u6709\u4e00\u500b\u95dc\u65bc `serviceLevelIndicator` \u5b57\u6bb5\u7684\u503c\u7684\u7d50\u69cb\u3002\n- \u5c0d\u65bc Anthos Service Mesh\u3001Istio on Google Kubernetes Engine \u548c App Engine \u670d\u52d9\uff0cSLI \u5df2\u9810\u5b9a\u7fa9\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Anthos \u670d\u52d9\u7db2\u683c\u63a7\u5236\u6aaf\u5275\u5efa SLO\uff1b\u60a8\u53ea\u9700\u6307\u5b9a\u578b\u80fd\u76ee\u6a19\u548c\u5408\u898f\u671f\u5373\u53ef\u3002\n- \u5c0d\u65bc\u5176\u4ed6\u670d\u52d9\uff0c\u60a8\u5fc5\u9808\u4f7f\u7528 SLO API \u5b9a\u7fa9 SLO\u3002\u8981\u6307\u5b9a SLO\uff0c\u60a8\u9084\u5fc5\u9808\u7232 `serviceLevelIndicator` \u5b57\u6bb5\u5275\u5efa\u4e00\u500b\u503c\u3002\u5982\u9700\u77ad\u89e3\u4e00\u4e9b\u6280\u8853\u554f\u984c\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u670d\u52d9\u7b49\u7d1a\u6307\u6a19](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/identifying-custom-sli?hl=zh-cn) \uff1b\u5982\u9700\u67e5\u770b\u57fa\u65bc\u5404\u7a2e\u4f86\u6e90\u7684\u4e00\u7d44\u793a\u4f8b\uff0c\u8acb\u53c3\u95b1 [\u6839\u64da\u6307\u6a19\u5275\u5efa SLI](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/sli-metrics/overview?hl=zh-cn) \u3002\n\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 Google Cloud Console \u5275\u5efa SLI\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa SLO](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/ui/create-slo?hl=zh-cn) \u3002\n\u69cb\u5efa SLO \u7684\u57fa\u672c\u6846\u67b6\u5982\u4e0b\uff1a\n```\n{\n \"displayName\": string,\n \"serviceLevelIndicator\": {\n object (ServiceLevelIndicator)\n },\n \"goal\": number,\n // Union field period can be only one of the following:\n \"rollingPeriod\": string,\n \"calendarPeriod\": enum (CalendarPeriod)\n // End of list of possible types for union field period.\n}\n```\n\u60a8\u5fc5\u9808\u6307\u5b9a\u4ee5\u4e0b\u5404\u9805\uff1a\n- \u986f\u793a\u540d\uff1aSLO \u7684\u8aaa\u660e\n- \u670d\u52d9\u7b49\u7d1a\u6307\u6a19\uff0c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4e09\u7a2e\u985e\u578b\u4e4b\u4e00\uff1a\n- [BasicSli](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives?hl=zh-cn#BasicSli) \n- [RequestBasedSli](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives?hl=zh-cn#RequestBasedSli) \n- [WindowsBasedSli](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives?hl=zh-cn#WindowsBasedSli) \n- \u6027\u80fd\u76ee\u6a19\uff08\u767e\u5206\u6bd4\uff09\n- \u5408\u898f\u6027\u671f\u9650\uff0c\u6709\u4ee5\u4e0b\u5169\u7a2e\u985e\u578b\uff1a\n- \u4e00\u5b9a\u9577\u5ea6\u7684\u6efe\u52d5\u9031\u671f\uff08\u4ee5\u79d2\u7232\u55ae\u4f4d\uff09\n- \u65e5\u66c6\u9031\u671f\u5982\u9700\u8a73\u7d30\u77ad\u89e3 SLI\u3001\u6548\u679c\u76ee\u6a19\u548c\u5408\u898f\u6027\u9031\u671f\u7684\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u670d\u52d9\u76e3\u63a7\u4e2d\u7684\u6982\u5ff5](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring?hl=zh-cn) \u3002\n\u5c0d\u65bc Anthos Service Mesh\u3001Istio on Google Kubernetes Engine \u548c App Engine \u670d\u52d9\uff0cSLI \u985e\u578b\u662f\u57fa\u672c\u7684 SLI\u3002\n\u5c0d\u65bc\u5176\u4ed6\u670d\u52d9\uff0c\u60a8\u5fc5\u9808\u5275\u5efa\u57fa\u65bc\u8acb\u6c42\u7684 SLI \u6216\u57fa\u65bc Windows \u7684 SLI\u3002\u5982\u9700\u77ad\u89e3\u4e00\u4e9b\u6280\u8853\u554f\u984c\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u670d\u52d9\u7b49\u7d1a\u6307\u6a19](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/identifying-custom-sli?hl=zh-cn) \u3002\n\u7372\u5f97 SLI \u5f8c\uff0c\u60a8\u4fbf\u53ef\u4ee5\u69cb\u5efa SLO\u3002\u4ee5\u4e0b\u793a\u4f8b\u7232\u4f7f\u7528\u57fa\u672c SLI \u7684\u670d\u52d9\u5b9a\u7fa9\u4e86 SLO\u3002\u55ae\u500b SLI \u4e0a\u53ef\u80fd\u6709\u591a\u500b SLO\uff0c\u4f8b\u5982\uff0c\u4e00\u500b SLO \u7684\u53ef\u7528\u6027\u7232 95\uff05\uff0c\u53e6\u4e00\u500b SLO \u7684\u53ef\u7528\u6027\u7232 99\uff05\u3002\u4ee5\u4e0b\u793a\u4f8b\u662f\u5728\u65e5\u66c6\u5468\u5167\u53ef\u7528\u6027\u7232 95\uff05 \u7684 SLO\uff1a\n```\n{\n \"serviceLevelIndicator\": {\n \"basicSli\": {\n  \"availability\": {},\n  \"location\": [  \"us-central1-c\"\n  ]\n }\n },\n \"goal\": 0.95,\n \"calendarPeriod\": \"WEEK\",\n \"displayName\": \"95% Availability in Calendar Week\"\n}\n```\n\u6b64\u793a\u4f8b\u6307\u5b9a\u4e86\u5728 3 \u5929\u6efe\u52d5\u9031\u671f\u5167\u53ef\u7528\u6027\u7232 75\uff05\u7684 SLO\uff1a\n```\n{\n \"serviceLevelIndicator\": {\n \"basicSli\": {\n  \"availability\": {},\n  \"location\": [  \"us-central1-c\"\n  ]\n }\n },\n \"goal\": 0.75,\n \"rollingPeriod\": \"259200s\",\n \"displayName\": \"75% Availability in Rolling 3 Days\"\n}\n```\n\u8981\u4f7f\u7528\n`curl`\n\u5275\u5efa SLO\uff0c\u8acb\u5c07\n`POST`\n\u689d\u6d88\u606f\u767c\u9001\u5230\n`https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services/` `` `/serviceLevelObjectives`\n\u7aef\u9ede\uff1a\n- \u7232\u670d\u52d9 ID \u5275\u5efa\u8b8a\u91cf\uff1a```\nSERVICE_ID=custom:my-test-service\n```\n- \u5275\u5efa\u4e00\u500b\u8b8a\u91cf\u4f86\u4fdd\u5b58\u8acb\u6c42\u6b63\u6587\uff0c\u5373 `ServiceLevelObjective` \u5c0d\u8c61\u7684\u5be6\u4f8b\u3002\u6b64\u793a\u4f8b\u4f7f\u7528\u524d\u9762\u63cf\u8ff0\u7684\u67d0\u500b SLO\uff1a```\nCREATE_SLO_POST_BODY=$(cat <<EOF{\u00a0 \"serviceLevelIndicator\": {\u00a0 \u00a0 \"basicSli\": {\u00a0 \u00a0 \u00a0 \"availability\": {},\u00a0 \u00a0 \u00a0 \"location\": [\u00a0 \u00a0 \u00a0 \u00a0 \"us-central1-c\"\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 }\u00a0 },\u00a0 \"goal\": 0.75,\u00a0 \"rollingPeriod\": \"259200s\",\u00a0 \"displayName\": \"75% Availability in Rolling 3 Days\"}EOF)\n```\n- \u5c07\u8acb\u6c42\u6b63\u6587\u767c\u4f48\u5230\u7aef\u9ede\uff1a```\ncurl \u00a0--http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" --header \"Content-Type: application/json\" -X POST -d \"${CREATE_SLO_POST_BODY}\" https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services/${SERVICE_ID}/serviceLevelObjectives\n```\u60a8\u4e5f\u53ef\u4ee5\u7232 SLO \u6307\u5b9a\u6240\u9700 ID\uff0c\u5c07\u5176\u4f5c\u7232 `service_level_objective_id` \u67e5\u8a62\u53c3\u6578\u7684\u503c\uff1a```\nSLO_ID=test-slo-idcurl \u00a0--http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" --header \"Content-Type: application/json\" -X POST -d \"${CREATE_SLO_POST_BODY}\" https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services/${SERVICE_ID}/serviceLevelObjectives?service_level_objective_id=${SLO_ID}\n```### \u522a\u9664 SLO\n\u8981\u522a\u9664 SLO\uff0c\u8acb\u8abf\u7528 [services.serviceLevelObjectives.delete](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/services.serviceLevelObjectives/delete?hl=zh-cn) \u65b9\u6cd5\uff0c\u4e26\u5728\u9805\u76ee\u4e2d\u6307\u5b9a SLO \u7684 ID\uff1a\n\u8981\u4f7f\u7528\n`curl`\n\u522a\u9664 SLO\uff0c\u8acb\u5c07\n`DELETE`\n\u8acb\u6c42\u767c\u9001\u5230\n`https://monitoring.googleapis.com/v3/projects/[PROJECT_ID]/services/` `` `/serviceLevelObjectives/` ``\n\u7aef\u9ede\uff1a\n```\ncurl \u00a0--http1.1 --header \"Authorization: Bearer ${ACCESS_TOKEN}\" -X DELETE https://monitoring.googleapis.com/v3/projects/${PROJECT_ID}/services/${SERVICE_ID}/serviceLevelObjectives/${SLO_ID}\n```\n## \u8a2a\u554f SLO \u6642\u9593\u5e8f\u5217\nSLO \u6578\u64da\u6309\u6642\u9593\u5e8f\u5217\u5b58\u5132\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u4f7f\u7528 [timeSeries.list](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/projects.timeSeries/list?hl=zh-cn) \u65b9\u6cd5\u6aa2\u7d22\u9019\u4e9b\u6578\u64da\u3002\u4f46\u662f\uff0c\u6b64\u985e\u6578\u64da\u4e26\u975e\u4ee5\u6a19\u6e96\u6307\u6a19\u985e\u578b\u5b58\u5132\uff0c\u56e0\u6b64\u60a8\u7121\u6cd5\u4f7f\u7528\u7232 `timeSeries.list` \u65b9\u6cd5\u6307\u5b9a\u6307\u6a19\u985e\u578b\u904e\u6ffe\u689d\u4ef6\u7684\u6a19\u6e96\u6a5f\u5236\u3002\n\u76f8\u53cd\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u5728 `filter` \u53c3\u6578\u4e2d\u5411 `timeSeries.list` \u65b9\u6cd5\u6307\u5b9a\u5176\u4ed6\u985e\u578b\u7684\u904e\u6ffe\u689d\u4ef6\uff08 **\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668** \uff09\u4f86\u6aa2\u7d22 SLO \u6642\u9593\u5e8f\u5217\u3002\u5982\u9700\u77ad\u89e3\u4f7f\u7528\u9019\u4e9b\u9078\u64c7\u5668\u7684\u4fe1\u606f\uff0c\u8acb\u53c3\u95b1 [\u6aa2\u7d22 SLO \u6578\u64da](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/timeseries-selectors?hl=zh-cn) \u3002\n\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668\u4ee5\u7de8\u7a0b\u65b9\u5f0f\u8a2d\u7f6e\u63d0\u9192\u653f\u7b56\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6d88\u8017\u7387\u63d0\u9192](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/alerting-on-budget-burn-rate?hl=zh-cn) \u3002", "guide": "Google Cloud Observability"}