{"title": "Google Cloud Observability - \u6aa2\u7d22 SLO \u6578\u64da", "url": "https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/timeseries-selectors?hl=zh-cn", "abstract": "# Google Cloud Observability - \u6aa2\u7d22 SLO \u6578\u64da\nSLO \u6578\u64da\u5b58\u5132\u5728\u6642\u9593\u5e8f\u5217\u4e2d\u3002\u5982\u9700\u6aa2\u7d22 SLO \u6642\u5e8f\uff0c\u60a8\u53ef\u4ee5\u5728 [timeSeries.list](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/projects.timeSeries/list?hl=zh-cn) \u65b9\u6cd5\u7684 `filter` \u53c3\u6578\u4e2d\u6307\u5b9a\u6642\u5e8f\u9078\u64c7\u5668 \uff0c\u6216\u8005\u5728 Metrics Explorer \u4e2d\u4f7f\u7528 [\u76f4\u63a5\u904e\u6ffe\u6a21\u5f0f](https://cloud.google.com/monitoring/charts/metrics-selector?hl=zh-cn#metric-filter) \u3002\n**\u6ce8\u610f** \uff1a\u6b64\u8655\u4f7f\u7528 `timeSeries.list` \u65b9\u6cd5 [\u6aa2\u7d22\u6642\u5e8f\u6578\u64da](https://cloud.google.com/monitoring/custom-metrics/reading-metrics?hl=zh-cn) \uff0c\u4e26\u5728 [Monitoring \u904e\u6ffe\u5668](https://cloud.google.com/monitoring/api/v3/filters?hl=zh-cn) \u4e2d\u4ecb\u7d39\u4e86\u6cdb\u5316\u904e\u6ffe\u3002\n", "content": "## \u57fa\u65bc SLO \u7684\u63d0\u9192\u653f\u7b56\n\u5982\u679c\u60a8\u8981\u4f7f\u7528 Cloud Monitoring API \u5275\u5efa\u63d0\u9192\u653f\u7b56\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668\u5728\u653f\u7b56\u95be\u503c\u689d\u4ef6\u4e2d\u6307\u5b9a\u5b57\u6bb5\u4f5c\u7232\u904e\u6ffe\u689d\u4ef6\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u4f7f\u7528 Monitoring API \u5275\u5efa\u57fa\u65bc SLO \u7684\u63d0\u9192\u653f\u7b56\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u63d0\u9192\u653f\u7b56](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/create-policy-api?hl=zh-cn#api-create-slo-policy) \u3002\n\u5728\u63d0\u9192\u653f\u7b56\u4e2d\uff0c\u53ea\u80fd\u6709\u4e00\u90e8\u5206\u53ef\u7528\u65bc SLO \u7684\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668\u3002\u6b64\u5916\uff0c\u4f7f\u7528 Google Cloud Console \u5275\u5efa\u7684\u57fa\u65bc SLO \u7684\u63d0\u9192\u653f\u7b56\u59cb\u7d42\u4f7f\u7528 [select_slo_burn_rate](#tss-burn-rate) \u9078\u64c7\u5668\u3002\n## \u5728\u904e\u6ffe\u5668\u4e2d\u4f7f\u7528\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668\n\u5982\u9700\u6aa2\u7d22 SLO \u7684\u6642\u5e8f\u6578\u64da\uff0c\u60a8\u7684\u904e\u6ffe\u5668\u5fc5\u9808\u6307\u5b9a\u6642\u5e8f\u9078\u64c7\u5668\u3002SLO \u6578\u64da\u4e0d\u8207\u6307\u6a19\u985e\u578b\u4e00\u8d77\u5b58\u5132\uff0c\u4e26\u4e14\u7121\u6cd5\u4f7f\u7528\u6307\u5b9a\u4e00\u5c0d\u6307\u6a19\u548c\u53d7\u76e3\u63a7\u7684\u8cc7\u6e90\u985e\u578b\u7684\u904e\u6ffe\u5668\u9032\u884c\u6aa2\u7d22\u3002\n### \u540d\u7a31\u548c\u53c3\u6578\n\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668\u5177\u6709\u4ee5\u4e0b\u67d0\u7a2e\u5f62\u5f0f\uff1a\n```\nSELECTOR_NAME(SLO_NAME)\nSELECTOR_NAME(SLO_NAME, LOOKBACK_PERIOD)\n```\n\u9078\u64c7\u5668\u7684\u540d\u7a31\u4ee5 `select_slo_` \u958b\u982d\uff0c\u4e26\u63a1\u7528\u4e00\u500b\u6216\u5169\u500b\u53c3\u6578\uff1a\n- \u9078\u64c7\u5668\u7684\u7b2c\u4e00\u500b\u53c3\u6578\u662f SLO \u7684\u8cc7\u6e90\u540d\u7a31\uff0c\u5982\u4e0b\u6240\u793a\uff1a```\nprojects/PROJECT_ID/services/SERVICE_ID/serviceLevelObjectives/SLO_ID\n```\u4e0a\u8ff0\u8868\u9054\u5f0f\u5305\u542b\u4e09\u500b\u8b8a\u91cf\uff1a- \uff1aGoogle Cloud \u9805\u76ee\u7684\u540d\u7a31\u6216\u7de8\u865f\u3002\n- \uff1a\u670d\u52d9\u7684\u540d\u7a31\u3002\n- \uff1a\u7232\u670d\u52d9\u5b9a\u7fa9\u7684 SLO \u7684\u6a19\u8b58\u7b26\u3002\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u67e5\u627e Google Cloud \u9805\u76ee\u7684 \u548c \u5b57\u6bb5\u7684\u503c\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 API](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/api/using-api?hl=zh-cn) \u3002\n- \u7b2c\u4e8c\u500b\u53c3\u6578\uff08\u5982\u679c\u652f\u6301\uff09\u662f\u56de\u6eaf\u671f\u3002 \u5982\u9700\u77ad\u89e3\u56de\u6eaf\u671f\u7684\u4fe1\u606f\uff0c\u8acb\u53c3\u95b1 [\u932f\u8aa4\u9810\u7b97\u63d0\u9192\u985e\u578b](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/alerting-on-budget-burn-rate?hl=zh-cn#burn-rates) \u3002\u6709\u6548\u6642\u9593\u55ae\u4f4d\u7232\u201cns\u201d\u3001\u201cus\u201d\u3001\u201cms\u201d\u3001\u201cs\u201d\u3001\u201cm\u201d\u3001\u201ch\u201d\u3002\n\u4f8b\u5982\uff0c `select_slo_budget` \u9078\u64c7\u5668\u63a5\u53d7 \u53c3\u6578\uff0c\u56e0\u6b64\u4f7f\u7528\u6b64\u9078\u64c7\u5668\u7684\u904e\u6ffe\u5668\u5982\u4e0b\u6240\u793a\uff1a\n```\nselect_slo_budget(\"projects/PROJECT_ID/services/SERVICE_ID/serviceLevelObjectives/SLO_ID\")\n```\n\u76f8\u6bd4\u4e4b\u4e0b\uff0c `select_slo_burn_rate` \u9078\u64c7\u5668\u5247\u9700\u8981 \u548c \u53c3\u6578\uff0c\u4f7f\u7528\u6b64\u9078\u64c7\u5668\u7684\u904e\u6ffe\u5668\u5c07\u5982\u4e0b\u6240\u793a\uff1a\n```\nselect_slo_burn_rate(\"projects/PROJECT_ID/services/SERVICE_ID/serviceLevelObjectives/SLO_ID\", \"3600s\")\n```\n\u5982\u9700\u67e5\u770b\u6240\u6709\u9078\u64c7\u5668\u7684\u5217\u8868\u548c\u8aaa\u660e\uff0c\u8acb\u53c3\u95b1 [\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668](#ts-selector-list) \u3002\n### \u4f7f\u7528\u9078\u64c7\u5668\u6aa2\u7d22\u6578\u64da\n\u67e5\u8a62\u6642\u5e8f\u6578\u64da\u7684\u4e00\u7a2e\u65b9\u6cd5\u662f\u4f7f\u7528 [timeSeries.list \u65b9\u6cd5\u7684\u53c3\u8003\u9801\u9762](https://cloud.google.com/monitoring/api/ref_v3/rest/v3/projects.timeSeries/list?hl=zh-cn) \u4e0a\u7684 APIs Explorer \u5de5\u5177\u3002\u5982\u9700\u77ad\u89e3\u6b64\u5de5\u5177\uff0c\u8acb\u53c3\u95b1 [APIs Explorer](https://cloud.google.com/monitoring/api/apis-explorer?hl=zh-cn) \u3002\n\u4f8b\u5982\uff0c\u5982\u9700\u6aa2\u7d22 SLO \u9810\u7b97\u7684\u76f8\u95dc\u4fe1\u606f\uff0c\u8acb\u5728 APIs Explorer \u5de5\u5177\u4e2d\u586b\u5beb\u4ee5\u4e0b\u5b57\u6bb5\uff1a\n- **\u540d\u7a31** \uff1a`projects/` ``\n- **\u904e\u6ffe\u689d\u4ef6** \uff1a`select_slo_budget(\"projects/` `` `/services/` `` `/serviceLevelObjectives/` `` `\")`\n- **interval.startTime** \uff1a`2021-10-07T13:00:20-04:00`\n- **interval.endTime** \uff1a`2021-10-08T13:00:20-04:00`\n\u5c0d\u65bc\u4e00\u500b\u7cfb\u7d71\uff0c\u5c07 \u7b49\u8b8a\u91cf\u66ff\u63db\u7232\u503c\u4e26\u57f7\u884c\u65b9\u6cd5\u5f8c\uff0c\u7cfb\u7d71\u6703\u8fd4\u56de\u4ee5\u4e0b\u6642\u5e8f\u6578\u64da\uff1a\n## \u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668\n\u672c\u90e8\u5206\u5217\u51fa\u4e86 SLO \u53ef\u7528\u7684\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668\uff0c\u4e26\u4ecb\u7d39\u4e86\u5b83\u5011\u6240\u4ee3\u8868\u7684\u542b\u7fa9\u3002\u6240\u6709\u9078\u64c7\u5668\u90fd\u53ef\u4ee5\u5728\u904e\u6ffe\u5668\u4e2d\u8207 `timeSeries.list` \u65b9\u6cd5\u4e00\u8d77\u7528\u4f86\u6aa2\u7d22\u6642\u5e8f\u6578\u64da\u3002\u63d0\u9192\u653f\u7b56\u50c5\u652f\u6301\u90e8\u5206\u6307\u6a19\u3002\n### select_slo_burn_rate\n**\u8a9e\u6cd5** \uff1a `select_slo_burn_rate(` `` `,` `` `)`\n\u201c\u6d88\u8017\u7387\u201d\u6642\u9593\u5e8f\u5217\u9078\u64c7\u5668\u6703\u8fd4\u56de\u7576\u524d\u6545\u969c\u7387\uff08\u56de\u6eaf\u9593\u9694\u4e2d\u7684\u932f\u8aa4\u8acb\u6c42\u7387\uff09\u8207 SLO \u7684\u6301\u7e8c\u6545\u969c\u7387\u4e4b\u6bd4\u3002\u6301\u7e8c\u6545\u969c\u7387\u662f\u5b8c\u5168\u6eff\u8db3 SLO \u7684\u6bd4\u7387\u3002\n\u6b64\u6642\u5e8f\u4e2d\u7684\u503c\u7684\u7bc4\u570d\u662f 0 \u5230\u7121\u7aae\u5927\uff1a\n- \u503c 1 \u8868\u793a\u670d\u52d9\u5177\u6709\u7406\u60f3\u7684\u6545\u969c\u7387\uff1a\u4e0d\u5b58\u5728\u98a8\u96aa\uff0c\u4e5f\u4e0d\u6703\u904e\u65bc\u4fdd\u5b88\u3002\n- \u5927\u65bc 1 \u7684\u503c\u8868\u793a\u6545\u969c\u7387\u8d85\u904e\u4e86\u6301\u7e8c\u6545\u969c\u7387\u3002 \u503c\u8d8a\u9ad8\uff0cSLO \u8d8a\u4e0d\u5408\u898f\u3002\n- \u5c0f\u65bc 1 \u7684\u503c\u8868\u793a\u7576\u524d\u6545\u969c\u7387\u5c0f\u65bc\u6301\u7e8c\u6545\u969c\u7387\u3002\n\u6211\u5011\u5efa\u8b70\u60a8\u4f7f\u7528\u5169\u7a2e\u63d0\u9192\u653f\u7b56\u4f86\u76e3\u63a7\u6d88\u8017\u7387\uff1a\u4e00\u7a2e\u662f\u5feb\u901f\u6d88\u8017\u653f\u7b56\u63d0\u9192\u60a8\u6d88\u8017\u7387\u51fa\u73fe\u5cef\u503c\uff0c\u53e6\u4e00\u7a2e\u662f\u6162\u901f\u6d88\u8017\u653f\u7b56\u63d0\u9192\u60a8\u6d88\u8017\u7387\u9010\u6f38\u589e\u52a0\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 API \u6216 Google Cloud \u63a7\u5236\u6aaf\u6839\u64da\u6b64\u6642\u5e8f\u9078\u64c7\u5668\u5275\u5efa\u548c\u4fee\u6539\u63d0\u9192\u653f\u7b56\u3002\n\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u5275\u5efa\u7684\u6240\u6709\u57fa\u65bc SLO \u7684\u63d0\u9192\u653f\u7b56\u90fd\u4f7f\u7528\u6b64\u9078\u64c7\u5668\u4f86\u6aa2\u7d22 SLO \u6578\u64da\u3002\n### select_slo_health\n**\u8a9e\u6cd5** \uff1a `select_slo_health(` `` `)`\n\u201cSLO \u5065\u5eb7\u72c0\u6cc1\u201d\u6642\u5e8f\u56de\u7b54\u4e86\u9019\u6a23\u4e00\u500b\u554f\u984c\uff1a\u201c\u5728\u7d66\u5b9a\u7684\u6821\u6e96\u671f\u5167\uff0c\u6b63\u5e38\u8acb\u6c42\u8207\u7e3d\u8acb\u6c42\u4e4b\u6bd4\u662f\u591a\u5c11\uff1f\u201d\uff1b\u670d\u52d9\u7684 SLI \u6703\u5b9a\u7fa9\u54ea\u4e9b\u8acb\u6c42\u88ab\u8996\u7232\u6b63\u5e38\u8acb\u6c42\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 SLI\uff0c\u8acb\u53c3\u95b1 [\u6982\u89bd](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/sli-metrics/overview?hl=zh-cn) \u3002\n\u6b64\u6642\u9593\u5e8f\u5217\u8861\u91cf\u7684\u662f\u670d\u52d9\u6027\u80fd\uff1a\u5982\u679c\u670d\u52d9\u7684\u6bcf\u500b\u8acb\u6c42\u5747\u6b63\u5e38\uff0c\u5247\u6b64\u6642\u9593\u5e8f\u5217\u4e2d\u7684\u6578\u64da\u9ede\u7684\u503c\u7232 1\u3002\u96a8\u7740\u932f\u8aa4\u8acb\u6c42\u7684\u6578\u91cf\u589e\u52a0\uff0c\u6578\u64da\u9ede\u7684\u503c\u6703\u4e0b\u964d\u3002\n### select_slo_compliance\n**\u8a9e\u6cd5** \uff1a `select_slo_compliance(` `` `)`\n\u201cSLO \u5408\u898f\u6027\u201d\u6642\u5e8f\u56de\u7b54\u4e86\u9019\u6a23\u4e00\u500b\u554f\u984c\uff1a\u201c\u81ea\u5408\u898f\u671f\u958b\u59cb\u4ee5\u4f86\u6b63\u5e38\u55ae\u4f4d\u8207\u7e3d\u55ae\u4f4d\u4e4b\u6bd4\u662f\u591a\u5c11\uff1f\u201dSLO \u5c07\u5408\u898f\u671f\u5b9a\u7fa9\u7232\u6efe\u52d5\u7a97\u53e3\u6216\u65e5\u66c6\u6642\u9593\u7bc4\u570d\u3002\u55ae\u4f4d\u53ef\u4ee5\u662f\u8acb\u6c42\u6216\u6642\u9593\u7a97\u53e3\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u57fa\u65bc\u8acb\u6c42\u548c\u57fa\u65bc\u7a97\u53e3\u7684 SLO \u4e2d\u7684\u5408\u898f\u6027](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring?hl=zh-cn#slo-types) \u3002\n\u901a\u904e\u6b64\u6642\u9593\u5e8f\u5217\uff0c\u60a8\u53ef\u4ee5\u5927\u81f4\u77ad\u89e3\u8a72\u670d\u52d9\u8207 SLO \u7684\u95dc\u4fc2\u3002\u5b83\u4e0d\u6703\u7522\u751f\u64cd\u4f5c\u4e0a\u7684\u7dca\u6025\u4fe1\u865f\u3002\n\u8acb\u52ff\u5728\u63d0\u9192\u653f\u7b56\u4e2d\u4f7f\u7528\u6b64\u6642\u5e8f\u9078\u64c7\u5668\u3002\n### select_slo_budget\n**\u8a9e\u6cd5** \uff1a `select_slo_budget(` `` `)`\n\u201cSLO \u9810\u7b97\u201d\u6642\u9593\u5e8f\u5217\u56de\u7b54\u4e86\u9019\u6a23\u4e00\u500b\u554f\u984c\uff1a\u201c\u8861\u91cf\u6642\u932f\u8aa4\u9810\u7b97\u7684\u5269\u9918\u6bd4\u7387\u662f\u591a\u5c11\uff1f\u201d\u932f\u8aa4\u9810\u7b97\u53ef\u4ee5\u4ee5\u8acb\u6c42\u6216\u5206\u9418\u7232\u55ae\u4f4d\u9032\u884c\u8861\u91cf\uff0c\u5269\u9918\u6578\u91cf\u6839\u64da\u5408\u898f\u671f\u662f\u6309\u7167\u65e5\u66c6\u6642\u9593\u9084\u662f\u6efe\u52d5\u671f\u4f86\u8861\u91cf\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u932f\u8aa4\u9810\u7b97](https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring?hl=zh-cn#defn-error-budget) \u3002\n\u6b64\u6642\u9593\u5e8f\u5217\u7528\u65bc\u8861\u91cf\u670d\u52d9\u53ef\u9760\u6027\u7684\u98a8\u96aa\u3002\u5982\u679c\u932f\u8aa4\u9810\u7b97\u8b8a\u7232\u5c0f\u65bc\u96f6\uff0c\u5247\u53ef\u80fd\u7121\u6cd5\u6eff\u8db3\u7576\u524d\u6642\u6bb5\u7684 SLO\u3002\u672a\u80fd\u9054\u5230 SLO \u53ef\u80fd\u6703\u7d66\u7d44\u7e54\u7684\u751f\u7522\u74b0\u5883\u5e36\u4f86\u5be6\u8cea\u5f8c\u679c\uff0c\u5177\u9ad4\u53d6\u6c7a\u65bc\u7d44\u7e54\u5982\u4f55\u7ba1\u7406\u53ef\u9760\u6027\u3002\n\u8acb\u52ff\u5728\u63d0\u9192\u653f\u7b56\u4e2d\u4f7f\u7528\u6b64\u6642\u5e8f\u9078\u64c7\u5668\u3002\n### select_slo_budget_fraction\n**\u8a9e\u6cd5** \uff1a `select_slo_budget_fraction(` `` `)`\n\u201cSLO \u9810\u7b97\u5206\u6578\u201d\u6642\u5e8f\u56de\u7b54\u4e86\u9019\u6a23\u4e00\u500b\u554f\u984c\uff1a\u201c\u6b64\u6642\u5269\u9918\u591a\u5c11\u932f\u8aa4\u9810\u7b97\uff08\u5f9e\u8ca0\u7121\u7aae\u5927\u5230 1 \u7684\u5206\u6578\uff09\uff1f\u201d\n\u8acb\u52ff\u5728\u63d0\u9192\u653f\u7b56\u4e2d\u4f7f\u7528\u6b64\u6642\u5e8f\u9078\u64c7\u5668\u3002\n### select_slo_budget_total\n**\u8a9e\u6cd5** \uff1a `select_slo_budget_total(` `` `)`\n\u201cSLO \u7e3d\u9810\u7b97\u201d\u6642\u5e8f\u56de\u7b54\u4e86\u9019\u6a23\u4e00\u500b\u554f\u984c\uff1a\u201c\u6839\u64da\u81ea\u5408\u898f\u671f\u958b\u59cb\u4ee5\u4f86\u670d\u52d9\u7684\u884c\u7232\uff0c\u9810\u8a08\u6b64\u6642\u53ef\u7528\u7684\u7e3d\u932f\u8aa4\u9810\u7b97\uff08\u4ee5\u8acb\u6c42\u6216\u5206\u9418\u7232\u55ae\u4f4d\uff09\u662f\u591a\u5c11\uff1f\u201dSLO \u5c07\u5408\u898f\u671f\u5b9a\u7fa9\u7232\u6efe\u52d5\u7a97\u53e3\u6216\u65e5\u66c6\u6642\u9593\u7bc4\u570d\u3002\n\u8acb\u52ff\u5728\u63d0\u9192\u653f\u7b56\u4e2d\u4f7f\u7528\u6b64\u6642\u5e8f\u9078\u64c7\u5668\u3002\n### select_slo_counts\n**\u8a9e\u6cd5** \uff1a `select_slo_counts(` `` `)`\n\u201cSLO \u8a08\u6578\u201d\u6642\u5e8f\u56de\u7b54\u4e86\u9019\u6a23\u4e00\u500b\u554f\u984c\uff1a\u201c\u5728\u7d66\u5b9a\u7684\u6821\u6e96\u671f\u5167\uff0c\u597d\u7684\u548c\u58de\u7684\u8acb\u6c42\u7684\u6578\u91cf\u662f\u591a\u5c11\uff1f\u201d\u6b64\u9078\u64c7\u5668\u63d0\u4f9b\u8a18\u9304\u4e00\u822c\u5065\u5eb7\u72c0\u6cc1\u7684\u6642\u5e8f\uff0c\u9069\u5408\u63d0\u53d6\u5230\u9577\u671f\u5b58\u5132\u7cfb\u7d71\u4e2d\u3002\n\u8acb\u52ff\u5728\u63d0\u9192\u653f\u7b56\u4e2d\u4f7f\u7528\u6b64\u6642\u5e8f\u9078\u64c7\u5668\u3002", "guide": "Google Cloud Observability"}