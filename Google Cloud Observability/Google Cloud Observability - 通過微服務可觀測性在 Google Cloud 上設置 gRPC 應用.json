{"title": "Google Cloud Observability - \u901a\u904e\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u5728 Google Cloud \u4e0a\u8a2d\u7f6e gRPC \u61c9\u7528", "url": "https://cloud.google.com/stackdriver/docs/solutions/grpc/setup-grpc-application-tutorial?hl=zh-cn", "abstract": "# Google Cloud Observability - \u901a\u904e\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u5728 Google Cloud \u4e0a\u8a2d\u7f6e gRPC \u61c9\u7528\n\u85c9\u52a9\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u5de5\u5177\uff0c\u60a8\u53ef\u4ee5\u5c0d\u61c9\u7528\u9032\u884c\u63d2\u6a01\u8655\u7406\uff0c\u4ee5\u5728 Cloud Monitoring\u3001Cloud Logging \u548c Cloud Trace \u4e2d\u5f9e\u90e8\u7f72\u5728 Google Cloud \u548c\u5176\u4ed6\u4f4d\u7f6e\u7684 gRPC \u5de5\u4f5c\u8ca0\u8f09\u6536\u96c6\u548c\u5448\u73fe\u9059\u6e2c\u6578\u64da\u3002\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u9069\u7528\u65bc\u901a\u904e\u5553\u7528 Microservices API \u7372\u5f97 Monitoring\u3001Logging \u548c Trace \u7684\u8a2a\u554f\u6b0a\u9650\u7684\u4efb\u4f55\u90e8\u7f72\u3002\n\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c07\u77ad\u89e3\u5982\u4f55\u4f7f\u7528 Compute Engine \u5728 Google Cloud \u4e0a\u69cb\u5efa\u7c21\u55ae\u7684 gRPC \u61c9\u7528\u4ee5\u5229\u7528\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u529f\u80fd\u3001\u901a\u904e\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u5c0d\u61c9\u7528\u9032\u884c\u63d2\u6a01\u8655\u7406\u4ee5\u53ca\u5728 Monitoring \u548c Logging \u4e0a\u9032\u884c\u5be6\u6642\u67e5\u770b\u3002", "content": "## \u76ee\u6a19\u6982\u62ec\u4f86\u8b1b\uff0c\u60a8\u9700\u8981\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\u3002- \u4f5c\u7232\u670d\u52d9\u958b\u767c\u8005\uff0c\u60a8\u53ef\u4ee5\uff1a- \u4f7f\u7528\u60a8\u9078\u64c7\u7684\u8a9e\u8a00\uff08C++\u3001Go \u6216 Java\uff09\u5275\u5efa gRPC \u61c9\u7528\u3002\n- \u5728\u60a8\u7684\u61c9\u7528\u4e2d\u9078\u64c7\u5553\u7528\u4e26\u63a7\u5236\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u63d2\u4ef6\u3002\n- \u5728 Compute Engine \u865b\u64ec\u6a5f\u4e0a\u90e8\u7f72\u61c9\u7528\u3002\n- \u4f5c\u7232\u670d\u52d9\u904b\u71df\u5546\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u591a\u7a2e\u65b9\u5f0f\u4f7f\u7528\u6536\u96c6\u7684\u6578\u64da\uff1a- \u901a\u904e Trace \u67e5\u770b\u8ddf\u8e64\u8a18\u9304\u3002\n- \u5728\u540d\u7232\u5fae\u670d\u52d9 (gRPC) Monitoring \u7684\u76e3\u63a7\u4fe1\u606f\u4e2d\u5fc3\u4e0a\u67e5\u770b\u6307\u6a19\u3002\n- \u5728 Metrics Explorer \u4e0a\u67e5\u770b\u6307\u6a19\u3002\n- \u5728 Logs Explorer \u4e0a\u6aa2\u67e5\u65e5\u8a8c\u689d\u76ee\u3002## \u8cbb\u7528\nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Google Cloud \u7684\u4ee5\u4e0b\u6536\u8cbb\u7d44\u4ef6\uff1a- [Compute Engine](https://cloud.google.com/compute/all-pricing?hl=zh-cn) \u60a8\u53ef\u4f7f\u7528 [\u50f9\u683c\u8a08\u7b97\u5668](https://cloud.google.com/products/calculator?hl=zh-cn) \u6839\u64da\u60a8\u7684\u9810\u8a08\u4f7f\u7528\u60c5\u6cc1\u4f86\u4f30\u7b97\u8cbb\u7528\u3002 \nTitles in dynamic includes are not used anywhere, and we should avoid paying to translate them\u5b8c\u6210\u672c\u6587\u6a94\u4e2d\u63cf\u8ff0\u7684\u4efb\u52d9\u5f8c\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u522a\u9664\u6240\u5275\u5efa\u7684\u8cc7\u6e90\u4f86\u907f\u514d\u7e7c\u7e8c\u8a08\u8cbb\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e05\u7406](#clean-up) \u3002## \u6e96\u5099\u5de5\u4f5c\n    \n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u95b1\u8b80 [\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u6982\u89bd](https://cloud.google.com/stackdriver/docs/solutions/grpc?hl=zh-cn) \u3002\n- \u77ad\u89e3 [\u5169\u500b\u652f\u6301\u7684\u74b0\u5883\u8b8a\u91cf](https://cloud.google.com/stackdriver/docs/solutions/grpc/set-up-observability?hl=zh-cn#config-options) \uff0c\u6c7a\u5b9a\u8981\u4f7f\u7528\u7684\u74b0\u5883\u8b8a\u91cf\uff0c\u4e26\u78ba\u5b9a\u74b0\u5883\u8b8a\u91cf\u6240\u9700\u7684\u503c\u3002    \n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u95b1\u8b80 [\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u6982\u89bd](https://cloud.google.com/stackdriver/docs/solutions/grpc?hl=zh-cn) \u3002\n- \u77ad\u89e3 [\u5169\u500b\u652f\u6301\u7684\u74b0\u5883\u8b8a\u91cf](https://cloud.google.com/stackdriver/docs/solutions/grpc/set-up-observability?hl=zh-cn#config-options) \uff0c\u6c7a\u5b9a\u8981\u4f7f\u7528\u7684\u74b0\u5883\u8b8a\u91cf\uff0c\u4e26\u78ba\u5b9a\u74b0\u5883\u8b8a\u91cf\u6240\u9700\u7684\u503c\u3002## \u5275\u5efa\u4e26\u9023\u63a5\u5230 Compute Engine \u865b\u64ec\u6a5f\u4f7f\u7528\u4ee5\u4e0b\u8aaa\u660e\u5275\u5efa\u4e26\u9023\u63a5\u5230 Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\u3002\u5728\u865b\u64ec\u6a5f\u4e0a\u90e8\u7f72\u61c9\u7528\uff0c\u7136\u5f8c\u901a\u904e\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u5c0d\u61c9\u7528\u9032\u884c\u63d2\u6a01\u8655\u7406\u3002- \u5275\u5efa\u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a```\ngcloud compute instances create grpc-observability-vm \\\n --image-family=debian-11 \\\n --image-project=debian-cloud \\\n --service-account=SERVICE_ACCOUNT_NAME@$PROJECT_ID.iam.gserviceaccount.com\n```\n- \u9023\u63a5\u5230\u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a```\ngcloud compute ssh --project=$PROJECT_ID grpc-observability-vm\n```\n## \u5c07\u61c9\u7528\u90e8\u7f72\u5230 Compute Engine \u865b\u64ec\u6a5f\u60a8\u53ef\u4ee5\u5c07\u6240\u9078\u61c9\u7528\u90e8\u7f72\u5230\u60a8\u5728\u4e0a\u4e00\u6b65\u4e2d\u5275\u5efa\u7684 Compute Engine \u865b\u64ec\u6a5f\uff0c\u7136\u5f8c\u8df3\u904e\u6b64\u6b65\u9a5f\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u793a\u4f8b\u7e7c\u7e8c\u6309\u7167\u60a8\u7684\u9996\u9078\u8a9e\u8a00\u7684\u8aaa\u660e\u64cd\u4f5c\u3002\n- \u9023\u63a5\u5230\u865b\u64ec\u6a5f\u5be6\u4f8b\u5f8c\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002```\nsudo apt-get update -y\nsudo apt-get install -y git build-essential clang\ngit clone -b v1.54.0 https://github.com/grpc/grpc.git --depth=1\n```\n- \u78ba\u4fdd\u60a8\u5df2\u5b89\u88dd Go\u3002```\nsudo apt-get install -y git\nsudo apt install wget\nwget https://go.dev/dl/go1.20.2.linux-amd64.tar.gz\nsudo rm -rf /usr/local/go && sudo tar -C /usr/local -xzf \\\ngo1.20.2.linux-amd64.tar.gz\nexport PATH=$PATH:/usr/local/go/bin\n```\n- \u514b\u9686 `gRPC-Go` \u793a\u4f8b\u3002```\ngit clone https://github.com/grpc/grpc-go.git\ncd grpc-go/\ngit checkout -b run-observability-example\n875c97a94dca8093bf01ff2fef490fbdd576373d\n```\n- \u9023\u63a5\u5230\u865b\u64ec\u6a5f\u5be6\u4f8b\u5f8c\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u5b89\u88dd Java 8 \u6216\u66f4\u9ad8\u7248\u672c\u3002```\nsudo apt update\nsudo apt upgrade\nsudo apt install git\nsudo apt-get install -y openjdk-11-jdk-headless\n```\n- \u514b\u9686 `grpc-java` \u4ee3\u78bc\u5eab\u3002```\nexport EXAMPLES_VERSION=v1.54.1\ngit clone -b $EXAMPLES_VERSION --single-branch --depth=1 \\\nhttps://github.com/grpc/grpc-java.git\n```\n## \u5275\u5efa gRPC Google Cloud Observability \u914d\u7f6e\u6587\u4ef6\u60a8\u9700\u8981\u55ae\u7368\u7684 gRPC Google Cloud Observability \u914d\u7f6e\u6587\u4ef6\uff0c\u4ee5\u4fbf\u7232\u670d\u52d9\u5668\u548c\u5ba2\u6236\u7aef\u5553\u7528\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u3002\u5728\u5f8c\u7e8c\u6b65\u9a5f\u4e2d\uff0c\u6b64\u6587\u4ef6\u7684\u4f4d\u7f6e\u5c07\u4ee5 `GRPC_GCP_OBSERVABILITY_CONFIG_FILE` \u7684\u5f62\u5f0f\u5c0e\u51fa\u3002\u8acb\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8a2d\u7f6e\u4e0d\u540c\u7684\u53c3\u6578\u3002\n### \u793a\u4f8b GRPC_GCP_OBSERVABILITY_CONFIG_FILE```\n{\u00a0 \"project_id\": \"your-project-here\",\u00a0 \"cloud_logging\": {\u00a0 \u00a0 \"client_rpc_events\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"methods\": [\"google.pubsub.v1.Subscriber/Acknowledge\", \"google.pubsub.v1.Publisher/CreateTopic\"],\u00a0 \u00a0 \u00a0 \"exclude\": true,\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"methods\": [\"google.pubsub.v1.Subscriber/*\", \"google.pubsub.v1.Publisher/*\"],\u00a0 \u00a0 \u00a0 \"max_metadata_bytes\": 4096,\u00a0 \u00a0 \u00a0 \"max_message_bytes\": 4096,\u00a0 \u00a0 }],\u00a0 \u00a0 \"server_rpc_events\": [{\u00a0 \u00a0 \u00a0 \"methods\": [\"*\"],\u00a0 \u00a0 \u00a0 \"max_metadata_bytes\": 4096,\u00a0 \u00a0 \u00a0 \"max_message_bytes\": 4096\u00a0 \u00a0 }],\u00a0 },\u00a0 \"cloud_monitoring\": {},\u00a0 \"cloud_trace\": {\u00a0 \u00a0 \"sampling_rate\": 0.5,\u00a0 }\u00a0 \"labels\": {\u00a0 \u00a0 \"SOURCE_VERSION\": \"J2e1Cf\",\u00a0 \u00a0 \"SERVICE_NAME\": \"payment-service-1Cf\",\u00a0 \u00a0 \"DATA_CENTER\": \"us-west1-a\"\u00a0 }}\n```\n\u4ee5\u4e0b\u5e7e\u500b\u90e8\u5206\u4ecb\u7d39\u77ad\u5982\u4f55\u5728\u914d\u7f6e\u4e2d\u7232\u5404\u500b\u7d44\u4ef6\u5553\u7528\u6578\u64da\u6536\u96c6\u3002\u5982\u679c\u60a8\u4f7f\u7528\u4e86\u672c\u6559\u7a0b\u4e2d\u7684 gRPC \u793a\u4f8b\uff0c\u5247\u53ef\u4ee5\u6309\u539f\u6a23\u4f7f\u7528\u6b64\u914d\u7f6e\uff08\u5728\u66f4\u65b0 `your-project-here` \u5f8c\uff09\uff0c\u4e5f\u53ef\u4ee5\u5c07\u5176\u7528\u4f5c\u61c9\u7528\u7684\u6a21\u677f\u4ee5\u53ca\u986f\u793a\u74b0\u5883\u8b8a\u91cf\u4e2d\u7684\u914d\u7f6e\u4fe1\u606f\u7684\u793a\u4f8b\u3002\n### \u5553\u7528\u6307\u6a19\u5982\u9700\u5553\u7528\u6307\u6a19\uff0c\u8acb\u5c07 `cloud_monitoring` \u5c0d\u8c61\u6dfb\u52a0\u5230\u914d\u7f6e\u4e2d\uff0c\u4e26\u5c07\u5176\u503c\u8a2d\u7f6e\u7232 `{}` \u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u6307\u6a19\uff0c\u8acb\u53c3\u95b1 [\u6307\u6a19\u5b9a\u7fa9](https://cloud.google.com/stackdriver/docs/solutions/grpc/observability-reference?hl=zh-cn#metrics-def) \u3002\n### \u5553\u7528\u8ddf\u8e64\u529f\u80fd\u5982\u9700\u5553\u7528\u8ddf\u8e64\u529f\u80fd\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5c07`cloud_trace`\u5c0d\u8c61\u6dfb\u52a0\u5230\u914d\u7f6e\u4e2d\u3002\n- \u5c07`cloud_trace.sampling_rate`\u8a2d\u7f6e\u7232`0.5`\uff0c\u4ee5\u96a8\u6a5f\u8ddf\u8e64 50% \u7684 RPC\u3002\n\u5982\u679c\u60a8\u8a08\u5283\u8de8\u670d\u52d9\u5553\u7528\u8ddf\u8e64\uff0c\u8acb\u78ba\u4fdd\u670d\u52d9\u652f\u6301\u5c07\u5f9e\u4e0a\u6e38\uff08\u6216\u81ea\u884c\u5553\u52d5\uff09\u63a5\u6536\u7684\u8ddf\u8e64\u4e0a\u4e0b\u6587\u50b3\u64ad\u5230\u4e0b\u6e38\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u8ddf\u8e64\uff0c\u8acb\u53c3\u95b1 [\u8ddf\u8e64\u8a18\u9304\u5b9a\u7fa9](https://cloud.google.com/stackdriver/docs/solutions/grpc/observability-reference?hl=zh-cn#trace-def) \u3002\n### \u5553\u7528\u65e5\u8a8c\u8a18\u9304\u5982\u9700\u5553\u7528\u65e5\u8a8c\u8a18\u9304\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5c07`cloud_logging`\u5c0d\u8c61\u6dfb\u52a0\u5230\u914d\u7f6e\u4e2d\u3002\n- \u5c07\u6a21\u5f0f\u6dfb\u52a0\u5230`client_rpc_events`\u548c/\u6216`server_rpc_events`\uff0c\u4ee5\u6307\u5b9a\u8981\u7232\u5176\u751f\u6210\u50b3\u8f38\u7d1a\u4e8b\u4ef6\u65e5\u8a8c\u8a18\u9304\u7684\u4e00\u7d44\u670d\u52d9\u6216\u65b9\u6cd5\u4ee5\u53ca\u8981\u8a18\u9304\u6a19\u982d\u7684\u5b57\u7bc0\u6578\u548c\u6d88\u606f\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u65e5\u8a8c\u8a18\u9304\uff0c\u8acb\u53c3\u95b1 [\u65e5\u8a8c\u8a18\u9304\u5b9a\u7fa9](https://cloud.google.com/stackdriver/docs/solutions/grpc/observability-reference?hl=zh-cn#log-record-defs) \u3002## \u91dd\u5c0d\u53ef\u89c0\u6e2c\u6027\u63d2\u4ef6\u5c0d\u61c9\u7528\u9032\u884c\u63d2\u6a01\u8655\u7406\u5982\u9700\u5c0d\u61c9\u7528\u9032\u884c\u63d2\u6a01\u8655\u7406\uff0c\u4ee5\u4fbf\u5176\u53ef\u4ee5\u4f7f\u7528\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u63d2\u4ef6\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u9069\u7528\u65bc\u60a8\u9996\u9078\u8a9e\u8a00\u7684\u8aaa\u660e\u64cd\u4f5c\u3002\n\u5f9e gRPC C++ v1.54 \u958b\u59cb\uff0c\u60a8\u53ef\u4ee5\u5c07 C++ \u8207\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u7d50\u5408\u4f7f\u7528\u3002 [\u793a\u4f8b\u4ee3\u78bc\u5eab](https://github.com/grpc/grpc/tree/v1.54.0/examples/cpp/gcp_observability/helloworld) \u4f4d\u65bc GitHub \u4e2d\u3002- \u53ef\u89c0\u6e2c\u6027\u652f\u6301\u53ea\u80fd\u901a\u904e Bazel \u69cb\u5efa\u7cfb\u7d71\u7372\u5f97\u3002\u5c07\u76ee\u6a19 `grpcpp_gcp_observability` \u6dfb\u52a0\u7232\u4f9d\u8cf4\u9805\u3002\n- \u9078\u64c7\u5553\u7528\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u9700\u8981\u984d\u5916\u7684\u4f9d\u8cf4\u9805\uff08\u53ef\u89c0\u6e2c\u6027\u6a21\u584a\uff09\uff0c\u4e26\u4e14\u9700\u8981\u5c0d\u73fe\u6709 gRPC \u5ba2\u6236\u7aef\u548c/\u6216\u670d\u52d9\u5668\u9032\u884c\u4ee5\u4e0b\u4ee3\u78bc\u66f4\u6539\uff1a```\n#include <grpcpp/ext/gcp_observability.h>int main(int argc, char** argv) {\u00a0 auto observability = grpc::GcpObservability::Init();\u00a0 assert(observability.ok());\u00a0 \u2026\u00a0 // Observability data flushed when object goes out of scope}\n```\u5728\u57f7\u884c\u4efb\u4f55 gRPC \u64cd\u4f5c\uff08\u5305\u62ec\u5275\u5efa\u901a\u9053\u3001\u670d\u52d9\u5668\u6216\u6191\u64da\uff09\u4e4b\u524d\uff0c\u8acb\u5148\u8abf\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a```\ngrpc::GcpObservability::Init();\n```\u6b64\u64cd\u4f5c\u6703\u8fd4\u56de\u61c9\u4fdd\u5b58\u7684 `absl::StatusOr<GcpObservability>` \u3002\u72c0\u614b\u6709\u52a9\u65bc\u78ba\u5b9a\u662f\u5426\u5df2\u6210\u529f\u521d\u59cb\u5316\u53ef\u89c0\u6e2c\u6027\u3002 \u9644\u5e36\u7684 `GcpObservability` \u5c0d\u8c61\u7528\u65bc\u63a7\u5236\u53ef\u89c0\u6e2c\u6027\u7684\u751f\u547d\u9031\u671f\uff0c\u4e26\u5728\u8d85\u51fa\u7bc4\u570d\u6642\u81ea\u52d5\u95dc\u9589\u548c\u5237\u65b0\u53ef\u89c0\u5bdf\u6027\u6578\u64da\u3002\n- gRPC Go \u7248\u672c`v1.54.0`\u53ca\u66f4\u9ad8\u7248\u672c\u652f\u6301\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u63d2\u4ef6\u3002 [\u793a\u4f8b\u4ee3\u78bc\u5eab](https://github.com/grpc/grpc-go/tree/master/examples/features/observability) \u4f4d\u65bc GitHub \u4e2d\u3002\n\u4f7f\u7528 Go \u6a21\u584a\u6642\uff0c\u9078\u64c7\u5553\u7528\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u9700\u8981\u53ef\u89c0\u6e2c\u6027\u6a21\u584a\u548c\u4ee5\u4e0b\u4ee3\u78bc\uff1a\n```\nimport \"google.golang.org/grpc/gcp/observability\"func main() {\u00a0 ctx, cancel := context.WithTimeout(context.Background(), time.Second)\u00a0 defer cancel()\u00a0 if err := observability.Start(ctx); err != nil {\u00a0 \u00a0 log.Warning(\"Unable to start gRPC observability:\", err)\u00a0 }\u00a0 defer observability.End()\u00a0 \u2026}\n```\n`observability.Start` \u8abf\u7528\u6703\u89e3\u6790\u74b0\u5883\u8b8a\u91cf\u4e2d\u7684\u914d\u7f6e\uff0c\u76f8\u61c9\u5730\u5275\u5efa\u5c0e\u51fa\u5668\uff0c\u4e26\u5c07\u6536\u96c6\u908f\u8f2f\u6ce8\u5165\u5728\u8abf\u7528\u5f8c\u5275\u5efa\u7684\u5ba2\u6236\u7aef\u9023\u63a5\u548c\u670d\u52d9\u5668\u4e2d\u3002\u5ef6\u9072 `observability.End` \u8abf\u7528\u6703\u6e05\u7406\u8cc7\u6e90\uff0c\u4e26\u78ba\u4fdd\u5728\u61c9\u7528\u95dc\u9589\u4e4b\u524d\u5df2\u6e05\u7a7a\u7de9\u885d\u7684\u6578\u64da\u3002\n\u66f4\u65b0\u61c9\u7528\u4ee3\u78bc\u5f8c\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u66f4\u65b0 `go.mod` \u6587\u4ef6\u3002\n```\ngo mod tidy\n```\n\u5982\u9700\u5c07\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u7528\u65bc Java \u61c9\u7528\uff0c\u8acb\u4fee\u6539\u69cb\u5efa\u4ee5\u5305\u542b `grpc-gcp-observability` \u5de5\u4ef6\u3002\u4f7f\u7528 gRPC 1.54.1 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n\u5728 Gradle \u548c Maven \u69cb\u5efa\u5de5\u5177\u90e8\u5206\u7684\u69cb\u5efa\u4ee3\u78bc\u6bb5\u4e2d\uff0c `grpcVersion` \u8a2d\u7232\u503c 1.54.1\n [\u793a\u4f8b\u4ee3\u78bc\u5eab](https://github.com/grpc/grpc-java/tree/v1.54.1/examples/example-gcp-observability) \u4f4d\u65bc GitHub \u4e2d\u3002- \u5982\u9700\u5c0d Java \u61c9\u7528\u6210\u529f\u9032\u884c\u63d2\u6a01\u8655\u7406\u4ee5\u5be6\u73fe\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\uff0c\u8acb\u5c07\u4ee5\u4e0b\u4ee3\u78bc\u6dfb\u52a0\u5230`main()`\u3002\n```\n...import io.grpc.gcp.observability.GcpObservability;...// Main application class...public static void main(String[] args) {...\u00a0 // call GcpObservability.grpcInit() to initialize & get observability\u00a0 GcpObservability observability = GcpObservability.grpcInit();...\u00a0 // call close() on the observability instance to shutdown observability\u00a0 observability.close();...}\n```\n\u8acb\u6ce8\u610f\uff0c\u5728\u5275\u5efa\u4efb\u4f55 gRPC \u6e20\u9053\u6216\u670d\u52d9\u5668\u4e4b\u524d\uff0c\u60a8\u5fc5\u9808\u8abf\u7528 `GcpObservability.grpcInit()` \u3002 `GcpObservability.grpcInit()` \u51fd\u6578\u6703\u8b80\u53d6\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u914d\u7f6e\uff0c\u4e26\u4f7f\u7528\u8a72\u914d\u7f6e\u4f86\u8a2d\u7f6e\u6bcf\u500b\u5275\u5efa\u7684\u6e20\u9053\u548c\u670d\u52d9\u5668\u4e2d\u7684\u65e5\u8a8c\u8a18\u9304\u3001\u6307\u6a19\u548c\u8ddf\u8e64\u8a18\u9304\u529f\u80fd\u6240\u9700\u7684\u5168\u5c40\u6514\u622a\u5668\u548c\u8ddf\u8e64\u5668\u3002 `GcpObservability.grpcInit()` \u5177\u6709\u7dda\u7a0b\u5b89\u5168\u6027\uff0c\u4e26\u4e14\u5fc5\u9808\u53ea\u8abf\u7528\u4e00\u6b21\u3002\u5b83\u6703\u8fd4\u56de\u4e00\u500b `GcpObservability` \u5be6\u4f8b\uff0c\u60a8\u5fc5\u9808\u4fdd\u5b58\u8a72\u5be6\u4f8b\u624d\u80fd\u7a0d\u5f8c\u8abf\u7528 `close()` \u3002\n`GcpObservability.close()` \u7528\u65bc\u91cb\u653e\u8cc7\u6e90\u3002\u4e4b\u5f8c\u5275\u5efa\u7684\u4efb\u4f55\u6e20\u9053\u6216\u670d\u52d9\u5668\u90fd\u4e0d\u6703\u57f7\u884c\u4efb\u4f55\u65e5\u8a8c\u8a18\u9304\u3002\n`GcpObservability` \u5be6\u73fe\u4e86 `java.lang.AutoCloseable` \uff0c\u5982\u679c\u60a8\u4f7f\u7528 `try-with-resource` \uff0c\u5f8c\u8005\u6703\u81ea\u52d5\u95dc\u9589\uff0c\u5982\u4e0b\u6240\u793a\uff1a\n```\n...import io.grpc.gcp.observability.GcpObservability;...// Main application class...public static void main(String[] args) {...\u00a0 // call GcpObservability.grpcInit() to initialize & get observability\u00a0 try (GcpObservability observability = GcpObservability.grpcInit()) {...\u00a0 } // observability.close() called implicitly...}\n```\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Gradle \u69cb\u5efa\u5de5\u5177\uff0c\u8acb\u6dfb\u52a0\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\ndef grpcVersion = '1.54.1'\n...\ndependencies {\n...\nimplementation \"io.grpc:grpc-gcp-observability:${grpcVersion}\"\n...\n}\n```\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Maven \u69cb\u5efa\u5de5\u5177\uff0c\u8acb\u6dfb\u52a0\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\n<properties>\n...\n<grpc.version>1.54.1</grpc.version>\n...\n</properties>\n...\n<dependencies>\n...\n<dependency>\n<groupId>io.grpc</groupId>\n<artifactId>grpc-gcp-observability</artifactId>\n<version>${grpc.version}</version>\n</dependency>\n...\n</dependencies>\n```## \u904b\u884c\u60a8\u7684\u61c9\u7528\u50c5\u7576\u4f7f\u7528\u4e86\u672c\u6559\u7a0b\u7684 gRPC \u793a\u4f8b\u6642\uff0c\u624d\u9700\u6309\u7167\u672c\u90e8\u5206\u4e2d\u7684\u8aaa\u660e\u64cd\u4f5c\u3002\u60a8\u53ef\u4ee5\u4fee\u6539 `run` \u547d\u4ee4\u4ee5\u91dd\u5c0d\u61c9\u7528\u7684\u4e8c\u9032\u5236\u6587\u4ef6\u3002\n### \u904b\u884c\u670d\u52d9\u5668\n- \u5275\u5efa\u8207\u865b\u64ec\u6a5f\u7684 SSH \u6703\u8a71\u3002\n- \u5c0e\u51fa\u74b0\u5883\u8b8a\u91cf\u3002\u6309\u7167 [\u4e0a\u6587](#create-o11y-config-file) \u6240\u5b9a\u7fa9\u7684\u6b65\u9a5f\u5275\u5efa `server_config.json` \u3002```\n\u00a0 export GOOGLE_CLOUD_PROJECT=$PROJECT_ID\u00a0 export GRPC_GCP_OBSERVABILITY_CONFIG_FILE=\"$(pwd)/examples/cpp/gcp_observability/helloworld/server_config.json\"\n```\n- \u904b\u884c\u670d\u52d9\u5668\u61c9\u7528 `shell cd grpc tools/bazel run examples/cpp/gcp_observability/helloworld:greeter_server`\n- \u5275\u5efa\u8207\u865b\u64ec\u6a5f\u7684 SSH \u6703\u8a71\u3002\n- \u5c0e\u51fa\u74b0\u5883\u8b8a\u91cf\u3002\u6309\u7167 [\u4e0a\u6587](#create-o11y-config-file) \u6240\u5b9a\u7fa9\u7684\u6b65\u9a5f\u5275\u5efa `server_config.json` \u3002```\nexport GRPC_GCP_OBSERVABILITY_CONFIG_FILE=./server/serverConfig.json\n```\n- \u904b\u884c\u670d\u52d9\u5668\u61c9\u7528 `shell go run ./server/main.go`\n- \u5728\u793a\u4f8b\u76ee\u9304\u4e2d\uff0c\u6253\u958b\u81ea\u8ff0\u6587\u4ef6\u4e26\u6309\u7167\u8a72\u6587\u4ef6\u4e2d\u7684\u8aaa\u660e\u64cd\u4f5c\u3002\n- \u7576\u8aaa\u660e\u63d0\u793a\u60a8\u6253\u958b\u53e6\u4e00\u500b\u7d42\u7aef\u7a97\u53e3\u6642\uff0c\u8acb\u767c\u51fa\u4ee5\u4e0b\u547d\u4ee4\uff1a`shell gcloud compute ssh --project=$PROJECT_ID grpc-observability-vm`### \u904b\u884c\u5ba2\u6236\u7aef\n- \u5275\u5efa\u8207\u865b\u64ec\u6a5f\u7684\u53e6\u4e00\u500b SSH \u6703\u8a71\u3002\n- \u5c0e\u51fa\u74b0\u5883\u8b8a\u91cf\u3002\u6309\u7167 [\u4e0a\u6587](#create-o11y-config-file) \u6240\u5b9a\u7fa9\u7684\u6b65\u9a5f\u5275\u5efa `client_config.json` \u6587\u4ef6\u3002```\n\u00a0 export GOOGLE_CLOUD_PROJECT=$PROJECT_ID\u00a0 export GRPC_GCP_OBSERVABILITY_CONFIG_FILE=\"$(pwd)/examples/cpp/gcp_observability/helloworld/client_config.json\"\n```\n- \u904b\u884c\u5ba2\u6236\u7aef\u61c9\u7528```\ncd grpctools/bazel run examples/cpp/gcp_observability/helloworld:greeter_client\n```\n- \u5275\u5efa\u8207\u865b\u64ec\u6a5f\u7684\u53e6\u4e00\u500b SSH \u6703\u8a71\u3002\n- \u5c0e\u51fa\u74b0\u5883\u8b8a\u91cf\u3002\u6309\u7167 [\u4e0a\u6587](#create-o11y-config-file) \u6240\u5b9a\u7fa9\u7684\u6b65\u9a5f\u5275\u5efa`client_config.json`\u6587\u4ef6\u3002`shell export GRPC_GCP_OBSERVABILITY_CONFIG_FILE=./client/clientConfig.json`\n- \u904b\u884c\u5ba2\u6236\u7aef\u61c9\u7528```\ncd grpc-go/examples/features/observabilitygo run ./client/main.go\n```\n- \u5728\u793a\u4f8b\u76ee\u9304\u4e2d\uff0c\u6253\u958b\u81ea\u8ff0\u6587\u4ef6\u4e26\u6309\u7167\u8a72\u6587\u4ef6\u4e2d\u7684\u8aaa\u660e\u64cd\u4f5c\u3002\n- \u7576\u8aaa\u660e\u63d0\u793a\u60a8\u6253\u958b\u53e6\u4e00\u500b\u7d42\u7aef\u7a97\u53e3\u6642\uff0c\u8acb\u767c\u51fa\u4ee5\u4e0b\u547d\u4ee4\uff1a`shell gcloud compute ssh --project=$PROJECT_ID grpc-observability-vm`\n## \u6e05\u7406\u7232\u907f\u514d\u56e0\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u8cc7\u6e90\u5c0e\u81f4\u60a8\u7684 Google Cloud \u8cec\u865f\u7522\u751f\u8cbb\u7528\uff0c\u8acb\u522a\u9664\u5305\u542b\u9019\u4e9b\u8cc7\u6e90\u7684\u9805\u76ee\uff0c\u6216\u8005\u4fdd\u7559\u9805\u76ee\u4f46\u522a\u9664\u5404\u500b\u8cc7\u6e90\u3002\n### \u522a\u9664\u9805\u76ee\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- **\u8b66\u544a** \uff1a\u522a\u9664\u9805\u76ee\u6703\u7522\u751f\u4ee5\u4e0b\u5f71\u97ff- **\u9805\u76ee\u4e2d\u7684\u6240\u6709\u5167\u5bb9\u90fd\u6703\u88ab\u522a\u9664\u3002** \u5982\u679c\u60a8\u5c07\u73fe\u6709\u9805\u76ee\u7528\u65bc\u672c\u6587\u6a94\u4e2d\u7684\u4efb\u52d9\uff0c\u5247\u522a\u9664\u8a72\u9805\u76ee\u5f8c\uff0c\u9084\u5c07\u522a\u9664\u60a8\u5df2\u5728\u8a72\u9805\u76ee\u4e2d\u5b8c\u6210\u7684\u4efb\u4f55\u5176\u4ed6\u5de5\u4f5c\u3002\n- **\u81ea\u5b9a\u7fa9\u9805\u76ee ID \u4e1f\u5931\u3002** \u5275\u5efa\u6b64\u9805\u76ee\u6642\uff0c\u60a8\u53ef\u80fd\u5275\u5efa\u4e86\u8981\u5728\u5c07\u4f86\u4f7f\u7528\u7684\u81ea\u5b9a\u7fa9\u9805\u76ee ID\u3002\u8981\u4fdd\u7559\u4f7f\u7528\u8a72\u9805\u76ee ID \u7684\u7db2\u5740\uff08\u4f8b\u5982`appspot.com`\u7db2\u5740\uff09\uff0c\u8acb\u522a\u9664\u9805\u76ee\u5167\u7684\u6240\u9078\u8cc7\u6e90\uff0c\u800c\u4e0d\u662f\u522a\u9664\u6574\u500b\u9805\u76ee\u3002\n\u5982\u679c\u60a8\u6253\u7b97\u63a2\u7d22\u591a\u500b\u67b6\u69cb\u3001\u6559\u7a0b\u6216\u5feb\u901f\u5165\u9580\uff0c\u5247\u91cd\u8907\u4f7f\u7528\u9805\u76ee\u53ef\u4ee5\u5e6b\u52a9\u60a8\u907f\u514d\u8d85\u51fa\u9805\u76ee\u914d\u984d\u9650\u5236\u3002\n- \u522a\u9664 Google Cloud \u9805\u76ee\uff1a\n- ```\ngcloud projects delete PROJECT_ID\n```\n### \u9010\u500b\u522a\u9664\u8cc7\u6e90\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u522a\u9664\u5be6\u4f8b\uff1a```\ngcloud compute instances delete INSTANCE_NAME\n```\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u5982\u9700\u8a73\u7d30\u77ad\u89e3\u914d\u7f6e\u6578\u64da\u3001\u8ddf\u8e64\u8a18\u9304\u5b9a\u7fa9\u3001\u6307\u6a19\u5b9a\u7fa9\u548c\u65e5\u8a8c\u5b9a\u7fa9\uff0c\u8acb\u53c3\u95b1 [\u5fae\u670d\u52d9\u53ef\u89c0\u6e2c\u6027\u53c3\u8003\u6587\u6a94](https://cloud.google.com/stackdriver/docs/solutions/grpc/observability-reference?hl=zh-cn) \u3002\n- \u5982\u9700\u77ad\u89e3\u5982\u4f55\u67e5\u770b\u65e5\u8a8c\u3001\u8ddf\u8e64\u8a18\u9304\u548c\u6307\u6a19\uff0c\u8acb\u53c3\u95b1 [\u67e5\u770b\u8ddf\u8e64\u8a18\u9304\u3001\u6307\u6a19\u548c\u65e5\u8a8c\u689d\u76ee](https://cloud.google.com/stackdriver/docs/solutions/grpc/set-up-observability?hl=zh-cn#view-all)", "guide": "Google Cloud Observability"}