{"title": "Google Cloud Observability - \u6392\u67e5 Logging \u4ee3\u7406\u554f\u984c", "url": "https://cloud.google.com/stackdriver/docs/solutions/agents/logging/troubleshooting?hl=zh-cn", "abstract": "# Google Cloud Observability - \u6392\u67e5 Logging \u4ee3\u7406\u554f\u984c\n\u672c\u9801\u9762\u63d0\u4f9b\u4e86\u76f8\u95dc\u8aaa\u660e\uff0c\u5e6b\u52a9\u60a8\u6392\u67e5\u5728\u5b89\u88dd Logging \u4ee3\u7406\u6216\u8207\u4e4b\u4ea4\u4e92\u6642\u51fa\u73fe\u7684\u5e38\u898b\u554f\u984c\u3002\n", "content": "## \u8988\u5c0d\u6e05\u55ae\n\u5982\u679c\u60a8\u5728\u5b89\u88dd\u6216\u4f7f\u7528 Logging \u4ee3\u7406\u6642\u9047\u5230\u554f\u984c\uff0c\u8acb\u6aa2\u67e5\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- \u5982\u679c Linux \u5b89\u88dd\u547d\u4ee4\u5c0e\u81f4\u932f\u8aa4\uff0c\u8acb\u78ba\u4fdd\u4f7f\u7528 `sudo` \u4f5c\u7232\u5b89\u88dd\u547d\u4ee4\u7684\u524d\u7db4\u3002\n- \u9a57\u8b49\u4ee3\u7406\u670d\u52d9\u662f\u5426\u6b63\u5728\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\u904b\u884c\uff1a- \u5c0d\u65bc Windows \u865b\u64ec\u6a5f\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b PowerShell \u547d\u4ee4\uff1a```\nGet-Service -Name StackdriverLogging\n```\u641c\u7d22\u540d\u7232 **Stackdriver Logging** \u7684\u670d\u52d9\u3002\u5982\u679c\u4ee3\u7406\u672a\u904b\u884c\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5c07\u5176\u91cd\u5553\u3002\n- \u5c0d\u65bc Linux \u865b\u64ec\u6a5f\uff0c\u8acb\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a```\nsudo service google-fluentd status\n```\u5982\u679c\u4ee3\u7406\u672a\u904b\u884c\uff0c\u5247\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5c07\u5176\u91cd\u5553\uff1a```\nsudo service google-fluentd restart\n```\u5982\u679c\u91cd\u5553\u5931\u6557\uff0c\u4e26\u4e14\u65e5\u8a8c\u8f38\u51fa\u986f\u793a\u201c\u5df2\u901a\u904e\u5143\u6578\u64da\u505c\u7528\u201d(Disabled via metadata)\uff0c\u5247\u60a8\u53ef\u80fd\u6b63\u5728\u904b\u884c\u4f86\u81ea\u65bc [Google Cloud Marketplace](https://cloud.google.com/marketplace?hl=zh-cn) \u7684\u6620\u50cf\uff0c\u800c\u9ed8\u8a8d\u60c5\u6cc1\u4e0b Logging \u4ee3\u7406\u5c0d\u65bc\u6b64\u985e\u6620\u50cf\u8655\u65bc\u505c\u7528\u72c0\u614b\u3002 `google-logging-enable` \u5be6\u4f8b\u5143\u6578\u64da\u9375\u63a7\u5236 Logging \u4ee3\u7406\u7684\u5553\u7528\u72c0\u614b\uff0c\u503c\u7232 `0` \u6642\u505c\u7528\u4ee3\u7406\u3002\u8981\u91cd\u65b0\u5553\u7528\u4ee3\u7406\uff0c\u8acb\u79fb\u9664 `google-logging-enable` \u9375\u6216\u5c07\u5176\u503c\u8a2d\u7f6e\u7232 `1` \u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u505c\u7528 Logging \u4ee3\u7406\u7684\u5be6\u4f8b](https://cloud.google.com/container-optimized-os/docs/how-to/logging?hl=zh-cn#creating_a_new_instance_with_the_logging_agent_enabled) \u3002\u5982\u679c\u672a\u901a\u904e\u5143\u6578\u64da\u505c\u7528\u4ee3\u7406\uff0c\u8acb\u91cd\u65b0\u5b89\u88dd\u4ee3\u7406\u3002\u8acb\u53c3\u95b1\u4e0b\u6587\u4e2d\u7684 [\u91cd\u65b0\u5b89\u88dd\u4ee3\u7406](#try-installing) \u90e8\u5206\u3002\n- \u67e5\u770b\u4ee3\u7406\u662f\u5426\u5411\u65e5\u5fd7\u4e2d\u5beb\u5165\u4e86\u932f\u8aa4\u6d88\u606f\u3002- \u5728 Windows \u4e0a\uff0c\u5f9e\u7248\u672c v1-9 \u958b\u59cb\uff0cLogging \u4ee3\u7406\u6703\u5c07\u5176\u65e5\u8a8c\u4fdd\u5b58\u5728 `C:\\Program Files (x86)\\Stackdriver\\LoggingAgent\\fluentd.log` \u4e2d\u3002\u7121\u6cd5\u7372\u53d6\u5148\u524d\u7248\u672c\u4ee3\u7406\u7684\u65e5\u8a8c\u3002\n- \u5728 Linux \u4e0a\uff0cLogging \u4ee3\u7406\u662f\u4e00\u500b `fluentd` \u8edf\u4ef6\u5305\uff0c\u5176\u6d88\u606f\u6703\u8a18\u9304\u5230 `/var/log/google-fluentd/google-fluentd.log` \u4e2d\uff1a- \u5982\u679c\u60a8\u770b\u5230 HTTP 429 \u932f\u8aa4\uff0c\u5247\u60a8\u7684 [Logging API \u914d\u984d](https://cloud.google.com/logging/quotas?hl=zh-cn) \u53ef\u80fd\u5df2\u7d93\u7528\u5b8c\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u9078\u64c7 **API \u548c\u670d\u52d9** > **\u4fe1\u606f\u4e2d\u5fc3** \u4f86\u67e5\u770b\u53ef\u7528\u914d\u984d\u3002\u9078\u64c7 Logging API\u3002\n- \u5982\u679c\u60a8\u9047\u5230 API \u8a2a\u554f\u6216\u6388\u6b0a\u554f\u984c\uff0c\u8acb\u8f49\u5230 [\u9a57\u8b49 Compute Engine \u6191\u64da](#verify-creds) \u3002\n- \u5982\u679c\u4ee3\u7406\u4f3c\u4e4e\u904b\u884c\u6b63\u5e38\uff0c\u4f46\u60a8\u6c92\u6709\u6536\u5230\u6578\u64da\uff0c\u5247\u61c9\u6aa2\u67e5\u4ee3\u7406\u662f\u5426\u6b63\u5728\u5411\u6b63\u78ba\u7684\u9805\u76ee\u767c\u9001\u6578\u64da\u3002\u8acb\u53c3\u95b1\u4e0b\u9762\u7684 [\u9a57\u8b49 Compute Engine \u6191\u64da](#verify-creds) \u90e8\u5206\u3002\n- \u5982\u679c\u4ee3\u7406\u6388\u6b0a\u5931\u6557\uff0c\u8acb\u6aa2\u67e5\u79c1\u9470\u7684\u6191\u64da\u662f\u5426 [\u7f3a\u5931\u6216\u7121\u6548](#verify-key) \u3002## \u9a57\u8b49\u4ee3\u7406\u5b89\u88dd\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u7684\u865b\u64ec\u6a5f\u4f5c\u7232 **App Engine \u67d4\u6027\u74b0\u5883** \u6216 **Kubernetes Engine** \u90e8\u7f72\u7684\u4e00\u90e8\u5206\u5553\u52d5\uff0c\u5247\u7121\u9700\u5b89\u88dd Logging \u4ee3\u7406\u3002\u8acb\u8df3\u904e\u6b64\u9801\u9762\u3002\n\u8981\u6aa2\u67e5\u5b89\u88dd\u662f\u5426\u6210\u529f\uff0c\u8acb\u5728\u65e5\u8a8c\u700f\u89bd\u5668\u4e2d\u67e5\u627e\u8a72\u4ee3\u7406\u7684\u6e2c\u8a66\u65e5\u8a8c\u689d\u76ee\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5c0e\u822a\u9762\u677f\u4e2d\uff0c\u9078\u64c7 **\u65e5\u8a8c\u8a18\u9304\u529f\u80fd** \uff0c\u7136\u5f8c\u9078\u64c7 **\u65e5\u8a8c\u700f\u89bd\u5668** : [\u524d\u5f80 Logs Explorer](https://console.cloud.google.com/logs/query?hl=zh-cn) \n- \u5728\u9801\u9762\u9802\u90e8\uff0c\u9078\u64c7\u5305\u542b\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u9805\u76ee\uff1a- \u5728 **Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b** \u90e8\u5206\uff0c\u9078\u64c7\u5305\u542b\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684 Google Cloud \u9805\u76ee\u3002\n- \u5c0d\u65bc **Amazon EC2 \u865b\u64ec\u6a5f\u5be6\u4f8b** \uff0c\u8acb\u9078\u64c7\u5c07\u60a8\u7684 AWS \u8cec\u865f\u95dc\u806f\u5230 Google Cloud \u670d\u52d9\u7684 [AWS \u9023\u63a5\u5668\u9805\u76ee](https://cloud.google.com/monitoring/settings/aws-accounts?hl=zh-cn) \u3002\n- \u5728 **Windows \u6a19\u7c64** (windows tabs) \u4e2d\uff0c\u7232\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u9078\u64c7\u76f8\u61c9\u8cc7\u6e90\uff1a- \u5c0d\u65bc **Compute Engine** \uff0c\u8acb\u9078\u64c7 **GCE \u865b\u64ec\u6a5f\u5be6\u4f8b** \u3002\n- \u5c0d\u65bc **Amazon EC2** \uff0c\u8acb\u9078\u64c7 **AWS EC2 \u5be6\u4f8b** (AWS EC2 Instance)\u3002\n- \u9078\u64c7 **syslog** (Linux)\u3001 **fluent.info** (Windows) \u6216 **\u6240\u6709\u65e5\u8a8c** \u3002\u5982\u679c\u60a8\u770b\u5230\u201cgRPC \u6210\u529f\u767c\u9001\u5230\u4e86 Logging API\u201d(Successfully sent gRPC to Logging API) \u65e5\u8a8c\u689d\u76ee\uff0c\u5247\u8868\u660e\u4ee3\u7406\u5b89\u88dd\u5df2\u5b8c\u6210\u3002\u4ee3\u7406\u6bcf\u6b21\u5b89\u88dd\u53ca\u6bcf\u6b21\u91cd\u5553\u5f8c\uff0c\u6b64\u6d88\u606f\u90fd\u6703\u751f\u6210\u4e00\u6b21\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u65e5\u8a8c\u700f\u89bd\u5668\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528\u65e5\u8a8c\u700f\u89bd\u5668](https://cloud.google.com/logging/docs/view/logs-explorer-interface?hl=zh-cn) \u3002\n## \u6e2c\u8a66\u4ee3\u7406\n\u5982\u679c\u60a8\u61f7\u7591\u4ee3\u7406\u672a\u6b63\u5e38\u5de5\u4f5c\uff0c\u8acb\u6aa2\u67e5\u4ee3\u7406\u662f\u5426\u6b63\u5728\u904b\u884c\u4e26\u5617\u8a66\u5411 Logging \u767c\u9001\u6e2c\u8a66\u6d88\u606f\uff1a\n\u4ee5\u4e0b\u6b65\u9a5f\u9069\u7528\u65bc\u904b\u884c Linux \u7684 Compute Engine \u548c Amazon EC2 \u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a- \u5728\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4ee5\u9a57\u8b49 Logging \u4ee3\u7406\u662f\u5426\u6b63\u5728\u904b\u884c\uff1a```\nps ax | grep fluentd\n```\u60a8\u5c07\u770b\u5230\u985e\u4f3c\u5982\u4e0b\u6240\u793a\u7684\u8f38\u51fa\uff1a```\n\u00a02284 ? \u00a0 \u00a0 \u00a0 \u00a0Sl \u00a0 \u00a0 0:00 /opt/google-fluentd/embedded/bin/ruby /usr/sbin/google-fluentd [...]\u00a02287 ? \u00a0 \u00a0 \u00a0 \u00a0Sl \u00a0 \u00a042:44 /opt/google-fluentd/embedded/bin/ruby /usr/sbin/google-fluentd [...]\n```\n- \u5728\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4ee5\u767c\u9001\u6e2c\u8a66\u65e5\u8a8c\u6d88\u606f\uff1a```\nlogger \"Some test message\"\n```\nLogging \u4ee3\u7406\u5177\u6709\u5169\u500b Windows \u670d\u52d9\u540d\u7a31\uff1a- `StackdriverLogging`\uff0c\u7528\u65bc v1-5 \u53ca\u66f4\u9ad8\u7248\u672c\n- `fluentdwinsvc`\uff0c\u7528\u65bc\u65e9\u671f\u7248\u672c\n\u60a8\u61c9\u8a72\u6b63\u5728\u904b\u884c\u4e00\u9805\u4ee3\u7406\u670d\u52d9\u3002\u4f7f\u7528 PowerShell \u5728\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a- \u8a62\u554f\u5169\u9805\u670d\u52d9\u7684\u72c0\u614b\u3002\u5982\u679c\u60a8\u77e5\u9053\u61c9\u904b\u884c\u54ea\u9805\u670d\u52d9\uff0c\u5247\u4f7f\u7528\u76f8\u61c9\u670d\u52d9\u540d\u7a31\u5373\u53ef\uff1a```\nGet-Service StackdriverLogging,fluentdwinsvc\n```\n- \u5982\u679c\u670d\u52d9\u672a\u904b\u884c\uff0c\u60a8\u5c07\u770b\u5230\u4e00\u689d\u932f\u8aa4\u6d88\u606f\u3002\u5982\u679c\u670d\u52d9\u6b63\u5728\u904b\u884c\uff0c\u60a8\u5c07\u770b\u5230\u985e\u4f3c\u5982\u4e0b\u6240\u793a\u7684\u8f38\u51fa\uff1a```\nStatus \u00a0 \u00a0Name \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0DisplayName------ \u00a0 \u00a0---- \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0-----------Running \u00a0StackdriverLogging \u00a0 Cloud Logging\n```\n- \u5982\u679c\u60a8\u540c\u6642\u67e5\u8a62\u9019\u5169\u9805\u670d\u52d9\uff0c\u61c9\u8a72\u6703\u770b\u5230\u4e00\u689d\u932f\u8aa4\u6d88\u606f\u548c `Running` \u72c0\u614b\uff1a- \u5982\u679c\u672a\u986f\u793a\u4efb\u4f55`Running`\u72c0\u614b\uff0c\u5247 Logging \u4ee3\u7406\u672a\u904b\u884c\u3002\n- \u5982\u679c\u770b\u5230`StackdriverLogging`\u6b63\u5728\u904b\u884c\uff0c\u90a3\u9ebc\u60a8\u6b63\u5728\u904b\u884c\u7684\u662f\u8fd1\u671f\u7684\u4ee3\u7406\u7248\u672c\u3002\u8981\u78ba\u5b9a\u5177\u9ad4\u7684\u7248\u672c\uff0c\u8acb\u53c3\u95b1 [\u7372\u53d6\u7248\u672c](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/installation?hl=zh-cn#agent-version) \u3002\n- \u5982\u679c\u770b\u5230`fluentdwinsvc`\u6b63\u5728\u904b\u884c\uff0c\u61c9 [\u5c07\u4ee3\u7406\u5347\u7d1a](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/installation?hl=zh-cn#upgrade) \u5230\u6700\u65b0\u7248\u672c\u3002\n- **\u9700\u8981\u7ba1\u7406\u54e1\u6b0a\u9650** \uff1a\u5982\u679c\u6709\u4efb\u610f\u7248\u672c\u7684\u4ee3\u7406\u6b63\u5728\u904b\u884c\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b PowerShell \u547d\u4ee4\uff0c\u4ee5\u767c\u9001\u6e2c\u8a66\u65e5\u8a8c\u6d88\u606f\uff1a```\nNew-EventLog \u00a0 -LogName Application -Source \"Test Source\"Write-EventLog -LogName Application -Source \"Test Source\" -EntryType Information -EventID 1 -Message \"Testing 123 Testing.\"\n```\n### \u67e5\u627e\u6e2c\u8a66\u6d88\u606f\n\u767c\u9001\u6e2c\u8a66\u6d88\u606f\u5f8c\uff0c\u8acb\u5728 [\u65e5\u8a8c\u700f\u89bd\u5668](https://cloud.google.com/logging/docs/view/logs-explorer-interface?hl=zh-cn) \u4e2d\u67e5\u627e\u8a72\u6d88\u606f\uff1a\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5c0e\u822a\u9762\u677f\u4e2d\uff0c\u9078\u64c7 **\u65e5\u8a8c\u8a18\u9304\u529f\u80fd** \uff0c\u7136\u5f8c\u9078\u64c7 **\u65e5\u8a8c\u700f\u89bd\u5668** : [\u524d\u5f80 Logs Explorer](https://console.cloud.google.com/logs/query?hl=zh-cn) \n- \u5728\u9801\u9762\u9802\u90e8\uff0c\u9078\u64c7\u5305\u542b\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u9805\u76ee\uff1a- \u5728 **Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b** \u90e8\u5206\uff0c\u9078\u64c7\u5305\u542b\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684 Google Cloud \u9805\u76ee\u3002\n- \u5c0d\u65bc **Amazon EC2 \u865b\u64ec\u6a5f\u5be6\u4f8b** \uff0c\u8acb\u9078\u64c7\u5c07\u60a8\u7684 AWS \u8cec\u865f\u95dc\u806f\u5230 Google Cloud \u670d\u52d9\u7684 [AWS \u9023\u63a5\u5668\u9805\u76ee](https://cloud.google.com/monitoring/settings/aws-accounts?hl=zh-cn) \u3002\n- \u5728 **Windows \u6a19\u7c64** (windows tabs) \u4e2d\uff0c\u7232\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u9078\u64c7\u76f8\u61c9\u8cc7\u6e90\uff1a- \u5c0d\u65bc **Compute Engine** \uff0c\u8acb\u9078\u64c7 **GCE \u865b\u64ec\u6a5f\u5be6\u4f8b** \u3002\n- \u5c0d\u65bc **Amazon EC2** \uff0c\u8acb\u9078\u64c7 **AWS EC2 \u5be6\u4f8b** (AWS EC2 Instance)\u3002\n- \u9078\u64c7 **syslog** (Linux)\u3001 **fluent.info** (Windows) \u6216 **\u6240\u6709\u65e5\u8a8c** \u3002\n- \u60a8\u61c9\u8a72\u6703\u770b\u5230\u5305\u542b\u6e2c\u8a66\u6d88\u606f\u7684\u65e5\u8a8c\u689d\u76ee\u3002\u5982\u679c\u662f\u9019\u6a23\uff0c\u5247\u8868\u793a Logging \u4ee3\u7406\u904b\u884c\u6b63\u5e38\u3002## \u9a57\u8b49 Compute Engine \u6191\u64da\n\u8981\u4f7f Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\u5728\u6c92\u6709\u79c1\u9470\u6191\u64da\u7684\u60c5\u6cc1\u4e0b\u904b\u884c\u4ee3\u7406\uff0c\u8a72\u5be6\u4f8b\u5fc5\u9808\u5177\u6709\u5408\u9069\u7684 [\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d](https://cloud.google.com/compute/docs/access/service-accounts?hl=zh-cn#accesscopesiam) \uff0c\u4e26\u4e14\u8a72\u5be6\u4f8b\u4f7f\u7528\u7684 [\u670d\u52d9\u8cec\u865f\u8eab\u4efd](https://cloud.google.com/compute/docs/access/service-accounts?hl=zh-cn#service_account_permissions) \u5fc5\u9808\u5177\u6709\u5408\u9069\u7684 IAM \u6b0a\u9650\u3002\n\u5275\u5efa\u865b\u64ec\u6a5f\u5be6\u4f8b\u6642\uff0c\u9ed8\u8a8d\u7bc4\u570d\u548c\u670d\u52d9\u8cec\u865f\u8a2d\u7f6e\u8db3\u4ee5\u904b\u884c\u4ee3\u7406\u3002\u975e\u5e38\u820a\u7684\u5be6\u4f8b\u6216\u9ed8\u8a8d\u8a2d\u7f6e\u5df2\u66f4\u6539\u7684\u5be6\u4f8b\u53ef\u80fd\u6c92\u6709\u5408\u9069\u7684\u6191\u64da\u3002\n### \u52a0\u8f09\u9ed8\u8a8d\u6191\u64da\u5931\u6557\n\u5982\u679c Logging \u65e5\u8a8c\u6587\u4ef6\u4e2d\u6709 `Could not load the default credentials` \u6545\u969c\uff0c\u5247\u8868\u793a\u4ee3\u7406\u53ef\u80fd\u7121\u6cd5\u9023\u63a5\u5230 Compute Engine \u5143\u6578\u64da\u670d\u52d9\u5668\u3002\n\u932f\u8aa4\u65e5\u8a8c\u5982\u4e0b\u6240\u793a\uff1a\n```\nStarting google-fluentd 1.8.4: /opt/google-fluentd/embedded/lib/ruby/gems/2.6.0/gems/googleauth-0.9.0/lib/googleauth/application_default.rb:74:in `get_application_default': Could not load the default credentials. Browse to (RuntimeError) https://developers.google.com/accounts/docs/application-default-credentials for more information.\n```\n\u51fa\u73fe\u9019\u7a2e\u60c5\u6cc1\u7684\u53ef\u80fd\u539f\u56e0\u4e4b\u4e00\u662f\u865b\u64ec\u6a5f\u5177\u6709\u81ea\u5b9a\u7fa9\u4ee3\u7406\u8a2d\u7f6e\u3002\u5982\u9700\u89e3\u6c7a\u6b64\u554f\u984c\uff0c\u8acb\u53c3\u95b1 [\u4ee3\u7406\u8a2d\u7f6e\u8aaa\u660e](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/installation?hl=zh-cn#configure-proxy) \u5c0d Compute Engine \u5143\u6578\u64da\u670d\u52d9\u5668\uff08 `metadata.google.internal` \u6216 `169.254.169.254` \uff09\u9032\u884c\u6392\u9664\u8a2d\u7f6e\uff0c\u4f7f\u5176\u4e0d\u901a\u904e\u4ee3\u7406\u3002\u5982\u679c\u932f\u8aa4\u4ecd\u7136\u5b58\u5728\uff0c\u8acb\u5f9e\u865b\u64ec\u6a5f\u4e2d\u79fb\u9664\u9ed8\u8a8d\u7684 Compute Engine \u670d\u52d9\u8cec\u865f\uff0c\u7136\u5f8c\u91cd\u65b0\u6dfb\u52a0\u3002\n### \u9a57\u8b49\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\n\u8981\u9a57\u8b49\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5c0e\u822a\u9762\u677f\u4e2d\uff0c\u9078\u64c7 **Compute Engine** \uff0c\u7136\u5f8c\u9078\u64c7 **\u865b\u64ec\u6a5f\u5be6\u4f8b** \uff1a [\u524d\u5f80\u865b\u64ec\u6a5f\u5be6\u4f8b](https://console.cloud.google.com/compute?hl=zh-cn) \n- \u9ede\u64ca\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u540d\u7a31\u3002\u7cfb\u7d71\u6703\u986f\u793a\u5be6\u4f8b\u7684\u8a73\u60c5\u9801\u9762\u3002\n- \u5728 **Cloud API \u8a2a\u554f\u6b0a\u9650\u7bc4\u570d** \u90e8\u5206\u4e2d\uff0c\u9ede\u64ca **\u8a73\u7d30\u4fe1\u606f** \u4ee5\u67e5\u770b API \u5217\u8868\u3002\u6ce8\u610f\u67e5\u627e\u4ee5\u4e0b\u689d\u76ee\uff1a- \u5982\u679c\u770b\u5230\u201c\u6b64\u5be6\u4f8b\u64c1\u6709\u6240\u6709 Google Cloud \u670d\u52d9\u7684\u5b8c\u6574 API \u8a2a\u554f\u6b0a\u9650\u201d\uff0c\u5247\u8868\u660e\u60a8\u64c1\u6709\u8db3\u5920\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\u3002\n- \u5982\u679c\u5728 **Stackdriver Logging API** \uff08Cloud Logging API \u7684\u820a\u540d\u7a31\uff09\u65c1\u908a\u770b\u5230\u60a8\u64c1\u6709 **\u53ea\u5beb** \u6216 **\u5168\u90e8** \u6b0a\u9650\uff0c\u5247\u5be6\u4f8b\u7684\u8a2a\u554f\u7bc4\u570d\u8db3\u4ee5\u904b\u884c Cloud Logging \u4ee3\u7406\u3002\n- \u5982\u679c\u60a8\u5728 **Stackdriver Monitoring API** \uff08Cloud Monitoring API \u7684\u820a\u540d\u7a31\uff09\u65c1\u908a\u770b\u5230\u60a8\u64c1\u6709 **\u53ea\u5beb** \u6216 **\u5168\u90e8** \u6b0a\u9650\uff0c\u5247\u5be6\u4f8b\u7684\u8a2a\u554f\u7bc4\u570d\u8db3\u4ee5\u904b\u884c Cloud Monitoring \u4ee3\u7406\u3002\n\u5982\u679c\u60a8\u7684 Compute Engine \u5be6\u4f8b\u4e2d\u6c92\u6709\u5408\u9069\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\uff0c\u8acb [\u7232\u5be6\u4f8b\u6dfb\u52a0\u6240\u9700\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d](https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances?hl=zh-cn#changeserviceaccountandscopes) \u3002\n\u4e0b\u8868\u5c55\u793a\u4e86\u8207 Logging \u548c Monitoring \u4ee3\u7406\u76f8\u95dc\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\uff1a\n| \u8a2a\u554f\u6b0a\u9650\u7bc4\u570d          | \u4ee3\u7406\u6b0a\u9650     |\n|:-------------------------------------------------|:-------------------------|\n| https://www.googleapis.com/auth/logging.write | \u8db3\u4ee5\u904b\u884c Logging \u4ee3\u7406 |\n| https://www.googleapis.com/auth/monitoring.write | \u8db3\u4ee5\u904b\u884c Monitoring \u4ee3\u7406 |\n### \u9a57\u8b49\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u6b0a\u9650\n\u5373\u4f7f Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\u5177\u6709\u8db3\u5920\u7684\u8a2a\u554f\u6b0a\u9650\u7bc4\u570d\uff0c\u5be6\u4f8b\u7684\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u4ecd\u53ef\u80fd\u7121\u6cd5\u7232\u4ee3\u7406\u63d0\u4f9b\u9069\u7576\u7684 IAM \u6b0a\u9650\u3002\n\u8981\u9a57\u8b49\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u6b0a\u9650\uff0c\u8acb\u5148\u627e\u5230\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\uff1a\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5c0e\u822a\u9762\u677f\u4e2d\uff0c\u9078\u64c7 **Compute Engine** \uff0c\u7136\u5f8c\u9078\u64c7 **\u865b\u64ec\u6a5f\u5be6\u4f8b** \uff1a [\u524d\u5f80\u865b\u64ec\u6a5f\u5be6\u4f8b](https://console.cloud.google.com/compute?hl=zh-cn) \n- \u9ede\u64ca\u865b\u64ec\u6a5f\u5be6\u4f8b\u7684\u540d\u7a31\u3002\u7cfb\u7d71\u6703\u986f\u793a\u5be6\u4f8b\u7684\u8a73\u60c5\u9801\u9762\u3002\n- \u5728\u9801\u9762\u4e0a\u67e5\u627e **\u670d\u52d9\u8cec\u865f** \u6a19\u984c\u3002\u8a72\u6a19\u984c\u4e0b\u6703\u5217\u51fa\u5be6\u4f8b\u7684\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u3002\u670d\u52d9\u8cec\u865f\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a```\n[ID]-compute@developer.gserviceaccount.com\n```\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5c0e\u822a\u9762\u677f\u4e2d\uff0c\u9078\u64c7 **IAM** \uff1a [\u524d\u5f80 IAM](https://console.cloud.google.com/iam-admin/iam?hl=zh-cn) \n- \u9078\u64c7 **\u201c\u67e5\u770b\u65b9\u5f0f\uff1a\u4e3b\u8cec\u865f\u201d** \u3002\u60a8\u61c9\u8a72\u6703\u770b\u5230\u4eba\u54e1\u3001\u7fa3\u7d44\u548c\u670d\u52d9\u8cec\u865f\u7684\u5217\u8868\u3002 **\u89d2\u8272** \u5217\u5305\u542b\u60a8\u9805\u76ee\u4e2d\u6bcf\u500b\u4e3b\u8cec\u865f\u6240\u5177\u6709\u7684\u89d2\u8272\u3002\n- \u5728\u5be6\u4f8b\u7684\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u5c0d\u61c9\u7684\u884c\u4e2d\uff0c\u60a8\u61c9\u8a72\u6703\u770b\u5230\u4e00\u500b\u6216\u591a\u500b\u89d2\u8272\uff1a- \u5982\u679c\u770b\u5230 **Editor** \uff0c\u5247\u8aaa\u660e\u8a72\u89d2\u8272\u8db3\u4ee5\u904b\u884c\u6240\u6709\u4ee3\u7406\u3002 **Editor** \u662f\u5206\u914d\u7d66 Compute Engine \u670d\u52d9\u8cec\u865f\u7684\u9ed8\u8a8d\u89d2\u8272\u3002\n- \u5982\u679c\u770b\u5230 **\u65e5\u8a8c\u5beb\u5165\u8005** \uff0c\u5247\u8868\u660e\u8a72\u89d2\u8272\u8db3\u4ee5\u904b\u884c Logging \u4ee3\u7406\u3002\u8981\u4e86\u89e3\u5305\u542b\u5beb\u5165\u6b0a\u9650\u7684\u5176\u4ed6 Logging \u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [Cloud Logging \u7684\u8a2a\u554f\u6b0a\u9650\u63a7\u5236](https://cloud.google.com/logging/docs/access-control?hl=zh-cn) \u3002\n- \u5982\u679c\u770b\u5230 **\u76e3\u63a7\u6307\u6a19\u5beb\u5165\u8005** \uff0c\u5247\u8868\u660e\u8a72\u89d2\u8272\u8db3\u4ee5\u904b\u884c Monitoring \u4ee3\u7406\u3002\u8981\u4e86\u89e3\u5305\u542b\u5beb\u5165\u6b0a\u9650\u7684\u5176\u4ed6 Monitoring \u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [Cloud Monitoring \u7684\u8a2a\u554f\u6b0a\u9650\u63a7\u5236](https://cloud.google.com/monitoring/access-control?hl=zh-cn) \u3002\n\u5982\u679c\u60a8\u7684\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u6c92\u6709\u9069\u7576\u7684\u89d2\u8272\uff0c\u8acb\u5617\u8a66\u5728 **IAM \u548c\u7ba1\u7406 > IAM** \u9801\u9762\u4fee\u6539\u670d\u52d9\u8cec\u865f\u7684\u89d2\u8272\u3002\u6dfb\u52a0\u5408\u9069\u7684 Logging \u6216 Monitoring \u89d2\u8272\uff0c\u5f9e\u800c\u7232\u4ee3\u7406\u6388\u6b0a\uff1a **Logging > Logs Writer** \u6216 **Monitoring > Monitoring Metric Writer** \u3002\n## \u9a57\u8b49\u79c1\u9470\u6191\u64da\n\u5728 Compute Engine \u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\uff0c\u60a8\u53ef\u4ee5\u5c07\u4ee3\u7406\u914d\u7f6e\u7232\u4f7f\u7528\u7372\u5f97\u9069\u7576\u6388\u6b0a\u7684\u975e\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\u3002\u5728 AWS EC2 \u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\uff0c\u60a8\u5fc5\u9808\u5c07\u4ee3\u7406\u914d\u7f6e\u7232\u4f7f\u7528\u6b64\u985e\u670d\u52d9\u8cec\u865f\u3002\n\u8981\u4ee5\u9019\u7a2e\u65b9\u5f0f\u914d\u7f6e\u4ee3\u7406\uff0c\u60a8\u5fc5\u9808\u7232\u6307\u5b9a\u7684\u670d\u52d9\u8cec\u865f\u5275\u5efa\u79c1\u9470\u6191\u64da\uff0c\u4e26\u5411\u4ee3\u7406\u63d0\u4f9b\u9019\u4e9b\u6191\u64da\u3002\n- \u4ee3\u7406\u6703\u67e5\u627e\u74b0\u5883\u8b8a\u91cf`GOOGLE_APPLICATION_CREDENTIALS`\uff0c\u8a72\u8b8a\u91cf\u5b58\u6709\u5305\u542b\u79c1\u9470\u6191\u64da\u7684\u6587\u4ef6\u7684\u540d\u7a31\u3002\n- \u5982\u679c\u8a72\u74b0\u5883\u8b8a\u91cf\u4e0d\u5b58\u5728\uff0c\u5247\u4ee3\u7406\u5c07\u5728\u9ed8\u8a8d\u4f4d\u7f6e\u67e5\u627e\u6191\u64da\uff1a\n```\n/etc/google/auth/application_default_credentials.json\n```\n```\nC:\\ProgramData\\Google\\Auth\\application_default_credentials.json\n```\n- \u5982\u679c\u9ed8\u8a8d\u4f4d\u7f6e\u4e0d\u5305\u542b\u6191\u64da\uff0c\u5247\u4ee3\u7406\u6703\u4f7f\u7528\u5143\u6578\u64da\u670d\u52d9\u5668\u4e2d\u7684\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002\n**\u6ce8\u610f\uff1a** \u8acb\u4f7f\u7528\u6587\u4ef6\u7cfb\u7d71\u6216\u5176\u4ed6\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\u6a5f\u5236\uff0c\u4ee5\u78ba\u4fdd\u50c5\u5be6\u4f8b\u4e0a\u6709\u9700\u8981\u7684\u61c9\u7528\u624d\u80fd\u8a2a\u554f\u79c1\u9470\u3002\n\u4ee5\u4e0b\u4fe1\u606f\u6709\u52a9\u65bc\u60a8\u8a3a\u65b7\u79c1\u9470\u6191\u64da\u76f8\u95dc\u554f\u984c\uff1a\n- \u79c1\u9470\u662f\u5426\u5b89\u88dd\u5230\u4f4d\uff1f\n- \u79c1\u9470\u662f\u5426\u4ecd\u5c0d\u670d\u52d9\u8cec\u865f\u6709\u6548\uff1f\n- \u670d\u52d9\u8cec\u865f\u662f\u5426\u5177\u6709\u4ee3\u7406\u6240\u9700\u7684\u89d2\u8272\uff1f\n\u8981\u9a57\u8b49\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\u662f\u5426\u5b89\u88dd\u4e86\u6709\u6548\u7684\u79c1\u9470\u6191\u64da\uff0c\u8acb\u9996\u5148\u9a57\u8b49\u6191\u64da\u6587\u4ef6\u662f\u5426\u5b58\u5728\u65bc\u5176\u9810\u671f\u4f4d\u7f6e\uff0c\u7136\u5f8c\u9a57\u8b49\u6191\u64da\u6587\u4ef6\u4e2d\u7684\u4fe1\u606f\u662f\u5426\u6709\u6548\u3002\n### \u6191\u64da\u662f\u5426\u5b58\u5728\uff1f\n\u8981\u67e5\u770b\u60a8\u7684\u5be6\u4f8b\u4e0a\u662f\u5426\u5b58\u5728\u79c1\u9470\u670d\u52d9\u8cec\u865f\u6191\u64da\uff0c\u8acb\u5728\u60a8\u7684\u5be6\u4f8b\u4e0a\u904b\u884c\u4ee5\u4e0b Linux \u547d\u4ee4\uff1a\n```\nsudo cat $GOOGLE_APPLICATION_CREDENTIALSsudo cat /etc/google/auth/application_default_credentials.json\n```\n\u5982\u679c\u4efb\u4e00\u547d\u4ee4\u986f\u793a\u5982\u4e0b\u6240\u793a\u7684\u6587\u4ef6\uff0c\u90a3\u9ebc\u60a8\u7684\u5be6\u4f8b\u53ef\u80fd\u5177\u6709\u6709\u6548\u7684\u79c1\u9470\u6191\u64da\u3002\u5982\u679c\u5169\u500b\u547d\u4ee4\u90fd\u986f\u793a\u6587\u4ef6\uff0c\u5247\u6703\u4f7f\u7528\u7531 `GOOGLE_APPLICATION_CREDENTIALS` \u8868\u793a\u7684\u6587\u4ef6\u3002\n```\n{\u00a0 \"type\": \"service_account\",\u00a0 \"project_id\": \"[YOUR-PROJECT-ID]\",\u00a0 \"private_key_id\": \"[YOUR-PRIVATE-KEY-ID]\",\u00a0 \"private_key\": \"[YOUR-PRIVATE-KEY]\",\u00a0 \"client_email\": \"[YOUR-PROJECT-NUMBER]-[YOUR-KEY@DEVELOPER].gserviceaccount.com\",\u00a0 \"client_id\": \"[YOUR-CLIENT-ID]\",\u00a0 \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",\u00a0 \"token_uri\": \"https://accounts.google.com/o/oauth2/token\",\u00a0 \"auth_provider_x509_cert_url\": \"{x509-cert-url}\",\u00a0 \"client_x509_cert_url\": \"{client-x509-cert-url}\"}\n```\n\u6191\u64da\u914d\u7f6e\u4e4b\u9593\u7684\u5dee\u7570\u53ef\u80fd\u5c0e\u81f4\u4ee3\u7406\u4f7f\u7528\u8207\u670d\u52d9\u6240\u9700\u6191\u64da\u4e0d\u540c\u7684\u6191\u64da\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5728\u767b\u9304 shell \u7684 `GOOGLE_APPLICATION_CREDENTIALS` \u4e2d\u8a2d\u7f6e\u4e86\u81ea\u5b9a\u7fa9\u6191\u64da\u4f4d\u7f6e\uff0c\u4f46\u672a\u5728\u4ee3\u7406\u7684\u670d\u52d9\u914d\u7f6e\u4e2d\u8a2d\u7f6e\u8a72\u8b8a\u91cf\uff0c\u5247\u670d\u52d9\u5c07\u67e5\u770b\u9ed8\u8a8d\u4f4d\u7f6e\u800c\u4e0d\u662f\u60a8\u7684\u81ea\u5b9a\u7fa9\u4f4d\u7f6e\u3002\n\u5982\u9700\u67e5\u770b\u6216\u66f4\u6539\u6191\u64da\u74b0\u5883\u8b8a\u91cf\uff0c\u8acb\u5728 `/etc/default/google-fluentd` \u4e2d\u8a2a\u554f\u6216\u8a2d\u7f6e `GOOGLE_APPLICATION_CREDENTIALS` \u3002\n\u5982\u679c\u4e0d\u5b58\u5728\u6191\u64da\u6587\u4ef6\uff0c\u8acb\u53c3\u95b1 [\u6dfb\u52a0\u6191\u64da](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/authorization?hl=zh-cn#private_key_authorization) \u3002\n**\u6ce8\u610f** \uff1a\u9664\u4e86 Logging \u4ee5\u5916\uff0c\u5176\u4ed6\u670d\u52d9\u4e5f\u53ef\u80fd\u4f7f\u7528\u60a8\u5be6\u4f8b\u4e0a\u7684\u79c1\u9470\u6191\u64da\u3002\u66ff\u63db\u73fe\u6709\u7684\u6191\u64da\u53ef\u80fd\u6703\u5c0e\u81f4\u5176\u4ed6\u670d\u52d9\u7121\u6cd5\u904b\u884c\u3002\n### \u6191\u64da\u662f\u5426\u6709\u6548\uff1f\n\u5728\u6191\u64da\u6587\u4ef6\u4e2d\uff0c **project_id** \u662f\u60a8\u7684 Google Cloud \u9805\u76ee\uff0c **client_email** \u6a19\u8b58\u9805\u76ee\u4e2d\u7684\u670d\u52d9\u8cec\u865f\uff0c **private_key_id** \u5247\u6a19\u8b58\u670d\u52d9\u8cec\u865f\u4e2d\u7684\u79c1\u9470\u3002\u5c07\u6b64\u4fe1\u606f\u8207 Google Cloud \u63a7\u5236\u6aaf\u7684 **IAM \u548c\u7ba1\u7406 > \u670d\u52d9\u8cec\u865f** \u90e8\u5206\u4e2d\u986f\u793a\u7684\u5167\u5bb9\u6bd4\u5c0d\u3002\n\u5982\u679c\u5b58\u5728\u4ee5\u4e0b\u4efb\u4e00\u60c5\u6cc1\uff0c\u5247\u6191\u64da\u6587\u4ef6\u7121\u6548\uff1a\n- \u60a8\u6aa2\u67e5\u7684\u662f Compute Engine \u5be6\u4f8b\uff0c\u4f46\u6191\u64da\u6587\u4ef6\u4e2d\u7684 Google Cloud \u9805\u76ee\u4e0d\u662f\u5305\u542b\u60a8\u7684\u5be6\u4f8b\u7684\u9805\u76ee\u3002\n- \u60a8\u6aa2\u67e5\u7684\u662f Amazon EC2 \u5be6\u4f8b\uff0c\u4f46\u6191\u64da\u6587\u4ef6\u4e2d\u7684 Google Cloud \u9805\u76ee\u4e0d\u662f\u60a8\u7684 AWS \u8cec\u865f\u7684 [\u9023\u63a5\u5668\u9805\u76ee](https://cloud.google.com/monitoring/accounts?hl=zh-cn#account-project) \uff08\u540d\u7232`AWS Link...`\uff09\u3002\n- \u5217\u51fa\u7684\u670d\u52d9\u8cec\u865f\u4e0d\u5b58\u5728\uff0c\u53ef\u80fd\u5df2\u88ab\u522a\u9664\u3002\n- \u5217\u51fa\u7684\u670d\u52d9\u8cec\u865f\u6c92\u6709\u5553\u7528\u6b63\u78ba\u7684\u89d2\u8272\uff1a **Logs Writer** \uff08\u7528\u65bc\u904b\u884c Cloud Logging \u4ee3\u7406\uff09\u548c **Monitoring Metric Writer** \uff08\u7528\u65bc\u904b\u884c Cloud Monitoring \u4ee3\u7406\uff09\u3002\n- \u79c1\u9470\u4e0d\u5b58\u5728\uff0c\u53ef\u80fd\u5df2\u88ab\u64a4\u6d88\u3002\n\u53ef\u4ee5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u7684 **IAM \u548c\u7ba1\u7406 > \u670d\u52d9\u8cec\u865f** \u90e8\u5206\u64a4\u6d88\u6191\u64da\u3002\u5982\u679c\u4e0d\u5b58\u5728\u6709\u6548\u6191\u64da\uff0c\u8acb\u53c3\u95b1 [\u6dfb\u52a0\u6191\u64da](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/authorization?hl=zh-cn#private_key_authorization) \uff0c\u4ee5\u66ff\u63db\u73fe\u6709\u6191\u64da\u6216\u6dfb\u52a0\u65b0\u6191\u64da\u3002\n\u5982\u679c\u670d\u52d9\u8cec\u865f\u6b63\u78ba\u7121\u8aa4\uff0c\u4f46\u79c1\u9470\u5df2\u88ab\u64a4\u6d88\uff0c\u90a3\u9ebc\u60a8\u53ef\u4ee5\u5275\u5efa\u4e00\u500b\u65b0\u7684\u79c1\u9470\uff0c\u4e26\u5c07\u5176\u8907\u88fd\u5230\u60a8\u7684\u5be6\u4f8b\u4e0a\u3002\u8acb\u53c3\u95b1 [\u5275\u5efa\u670d\u52d9\u8cec\u865f\u5bc6\u9470](https://cloud.google.com/iam/docs/creating-managing-service-account-keys?hl=zh-cn) \u3002\n\u5426\u5247\uff0c\u60a8\u5fc5\u9808\u6309\u7167 [\u6dfb\u52a0\u6191\u64da](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/authorization?hl=zh-cn#private_key_authorization) \u90e8\u5206\u4e2d\u6240\u8ff0\u5275\u5efa\u65b0\u7684\u670d\u52d9\u8cec\u865f\u3002\n## \u9a57\u8b49\u65e5\u8a8c\u6392\u9664\u67e5\u8a62\n\u67e5\u770b [\u7576\u524d\u7684\u6392\u9664\u9805\u67e5\u8a62](https://cloud.google.com/logging/docs/exclusions?hl=zh-cn#viewing-exclusion-filters) \uff0c\u78ba\u4fdd\u60a8\u6240\u67e5\u627e\u7684\u65e5\u8a8c\u4e0d\u6703\u88ab\u610f\u5916\u6392\u9664\u3002\n## \u9a57\u8b49\u9632\u706b\u7246\n\u8981\u67e5\u770b\u60a8\u7684\u5be6\u4f8b\u662f\u5426\u6709\u6b0a\u8a2a\u554f `logging.googleapis.com` \uff0c\u8acb\u5728\u60a8\u7684\u5be6\u4f8b\u4e0a\u904b\u884c\u4ee5\u4e0b Linux \u547d\u4ee4\uff1a\n```\ncurl -sSL 'https://logging.googleapis.com/$discovery/rest?version=v2' | head\n```\n\u7576\u9632\u706b\u7246\u963b\u6b62\u51fa\u7ad9\u6d41\u91cf\u6642\uff0c\u8a72\u547d\u4ee4\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u6642\u9593\u624d\u80fd\u5b8c\u6210\u3002\u6307\u793a\u9632\u706b\u7246\u554f\u984c\u7684\u793a\u4f8b\u8f38\u51fa\uff1a\n```\ncurl: (7) Failed to connect to 2607:f8b0:4001:c03::5f: Network is unreachable\n```\n\u8acb\u8a2a\u554f [\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/vpc/docs/firewalls?hl=zh-cn) \uff0c\u77ad\u89e3\u5982\u4f55\u7232\u51fa\u7ad9\u6d41\u91cf\u8a2d\u7f6e\u898f\u5247\u3002\n## \u91cd\u65b0\u5b89\u88dd\u4ee3\u7406\n\u5b89\u88dd\u6700\u65b0\u7248\u672c\u7684\u4ee3\u7406\u53ef\u4ee5\u89e3\u6c7a\u8a31\u591a\u554f\u984c\uff1a\n- \u5982\u679c\u60a8\u78ba\u5b9a\u554f\u984c\u8207\u6191\u64da\u7121\u95dc\uff0c\u5247\u53ef\u4ee5\u76f4\u63a5\u8df3\u5230 [\u5728 Linux \u548c Windows \u4e0a\u5b89\u88dd](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/installation?hl=zh-cn#joint-install) \u3002\n- \u5982\u9700\u77ad\u89e3\u4ee3\u7406\u7684\u5b8c\u6574\u5b89\u88dd\u904e\u7a0b\u548c\u4efb\u4f55\u6240\u9700\u7684\u6191\u64da\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Logging \u4ee3\u7406](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/installation?hl=zh-cn) \u3002## \u5176\u4ed6\u5e38\u898b\u554f\u984c\n\u4e0b\u8868\u5217\u51fa\u4e86\u60a8\u5728\u4f7f\u7528 Cloud Logging \u4ee3\u7406\u6642\u53ef\u80fd\u6703\u9047\u5230\u7684\u4e00\u4e9b\u5e38\u898b\u554f\u984c\uff0c\u4e26\u4ecb\u7d39\u4e86\u76f8\u61c9\u7684\u89e3\u6c7a\u65b9\u6cd5\u3002\n\u5728 Linux \u4e0a\uff0cLogging \u4ee3\u7406\u6703\u5c07\u932f\u8aa4\u8a18\u9304\u5728 `/var/log/google-fluentd/google-fluentd.log` \u4e2d\u3002\u5728 Windows \u4e0a\uff0cLogging \u4ee3\u7406\u6703\u5c07\u932f\u8aa4\u8a18\u9304\u5728 `C:\\Program Files (x86)\\Stackdriver\\LoggingAgent\\fluentd.log` \u4e2d\uff08\u5f9e\u7248\u672c v1-9 \u958b\u59cb\uff09\u3002\u932f\u8aa4\u985e `Google::APIClient::ClientError` \u8868\u793a\u6b0a\u9650\u6216 API \u8a2a\u554f\u6b0a\u9650\u51fa\u73fe\u554f\u984c\u3002\n\u4ee3\u7406\u6210\u529f\u904b\u884c\u5f8c\uff0c\u60a8\u53ef\u80fd\u6703\u958b\u59cb\u770b\u5230\u932f\u8aa4\u3002\u4f8b\u5982\uff0c\u67d0\u4eba\u53ef\u80fd\u5df2\u5f9e\u60a8\u7684\u9805\u76ee\u6216\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e2d\u64a4\u6d88\u5fc5\u9700\u7684\u6b0a\u9650\u3002\n| \u932f\u8aa4                      | \u539f\u56e0                                                                      | \u89e3\u6c7a\u65b9\u6848                                                                                         |\n|:------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Windows \u4e0a\u4ee3\u7406\u7684\u5b89\u88dd\u7a0b\u5e8f\u7121\u6cd5\u904b\u884c               | \u60a8\u53ef\u80fd\u5c07\u6b64\u5b89\u88dd\u7a0b\u5e8f\u4e0b\u8f09\u5230\u4e86\u67d0\u500b\u7cfb\u7d71\u76ee\u9304\u3002                                                             | \u5c07\u5b89\u88dd\u7a0b\u5e8f\u79fb\u81f3\u975e\u7cfb\u7d71\u76ee\u9304\uff0c\u4f8b\u5982\uff0cC:\\Users\\[USERID]\\\u3002                                                                              |\n| \u9805\u76ee\u5c1a\u672a\u5553\u7528 API                   | \u60a8\u5c1a\u672a\u5728\u9805\u76ee\u4e2d\u5553\u7528 Cloud Logging API\u3002                                                              | \u8f49\u5230 API \u63a7\u5236\u6aaf\uff0c\u7136\u5f8c\u5c07 Cloud Logging API \u7684\u72c0\u614b\u66f4\u6539\u7232\u958b\u5553\u3002                                                                            |\n| \u8acb\u6c42\u5305\u542b\u7121\u6548\u6191\u64da \u6216 \u7121\u6cd5\u7372\u53d6\u8a2a\u554f\u4ee4\u724c\uff08\u672a\u914d\u7f6e\u4efb\u4f55\u7bc4\u570d\uff1f\uff09         | \u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u6c92\u6709\u5408\u9069\u7684\u6191\u64da\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Amazon EC2\uff0c\u5247\u5fc5\u9808\u5148\u5728\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\u5b89\u88dd\u6191\u64da\uff0c\u7136\u5f8c\u624d\u80fd\u5b89\u88dd\u4ee3\u7406\u3002                                            | \u8acb\u53c3\u95b1\u5411 Logging \u4ee3\u7406\u6388\u6b0a\uff0c\u4ee5\u5b89\u88dd\u6191\u64da\u3002                                                                                  |\n| \u6388\u6b0a\u5931\u6557                     | \u672a\u6b63\u78ba\u914d\u7f6e Logging \u4ee3\u7406\u7684\u79c1\u9470\u6388\u6b0a\u6191\u64da\u3002                                                             | \u8acb\u53c3\u95b1\u9a57\u8b49\u79c1\u9470\u6191\u64da\u3002                                                                                      |\n| \u8abf\u7528\u65b9\u7121\u6b0a\u9650                    | \u9805\u76ee\u4e2d\u7528\u65bc\u6388\u6b0a\u7684\u670d\u52d9\u8cec\u865f\u7684\u6b0a\u9650\u4e0d\u8db3\u3002\u8a72\u670d\u52d9\u8cec\u865f\u53ef\u80fd\u662f Compute Engine \u6216 App Engine \u4e2d\u6240\u7528\u7684\u9ed8\u8a8d\u670d\u52d9\u8cec\u865f\uff0c\u4e5f\u53ef\u80fd\u662f\u7531\u7528\u6236\u5b9a\u7fa9\u7684\u7528\u65bc\u79c1\u9470\u6388\u6b0a\u7684\u670d\u52d9\u8cec\u865f\u3002\u8a72\u8cec\u865f\u5fc5\u9808\u5177\u6709 Editor \u89d2\u8272\u3002                           | \u5728\u60a8\u7684\u9805\u76ee\u7684 IAM \u9801\u9762\u4e2d\u66f4\u6539\u670d\u52d9\u8cec\u865f\u7684\u6b0a\u9650\u3002\u5982\u6709\u5fc5\u8981\uff0c\u53ef\u4ee5\u4f7f\u7528\u66f4\u6539\u5be6\u4f8b\u7684\u670d\u52d9\u8cec\u865f\u548c\u8a2a\u554f\u7bc4\u570d\u904e\u7a0b\u4f86\u4fee\u6539\u73fe\u6709\u865b\u64ec\u6a5f\u7684\u8a2a\u554f\u7bc4\u570d\u3002                                                             |\n| \u7121\u6cd5\u7372\u53d6\u9805\u76ee ID                   | Cloud Logging \u4ee3\u7406\u7121\u6cd5\u5f9e\u670d\u52d9\u8cec\u865f\u7684\u79c1\u9470\u6191\u64da\u6587\u4ef6\u4e2d\u7372\u53d6\u9805\u76ee ID\u3002                                                        | \u8981\u6dfb\u52a0\u6216\u66ff\u63db\u4ee3\u7406\u7684\u9805\u76ee ID\uff0c\u8acb\u5728\u60a8\u7684\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e0a\u4fee\u6539\u4ee3\u7406\u7684\u914d\u7f6e\u6587\u4ef6 /etc/google-fluentd/google-fluentd.conf\u3002\u5728 <match **> \u90e8\u5206\u4e2d\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u884c\uff1a project_id [YOUR_PROJECT_ID] \u5426\u5247\uff0c\u8acb\u53c3\u95b1\u5411 Logging \u4ee3\u7406\u6388\u6b0a\uff0c\u4ee5\u4fee\u5fa9\u6216\u66ff\u63db\u6191\u64da\u3002                                    |\n| Window Logging \u4ee3\u7406\u505c\u6b62\u5f9e\u67d0\u4e9b\u6e20\u9053\u63d0\u53d6\u4e8b\u4ef6\u65e5\u8a8c            | Logging \u4ee3\u7406\u5728\u5f9e\u67d0\u4e9b\u6e20\u9053\u4e2d\u63d0\u53d6\u4e8b\u4ef6\u65e5\u8a8c\u6642\u53ef\u80fd\u6703\u6beb\u7121\u5fb5\u5146\u5730\u5931\u6557\uff0c\u5373\u4f7f Logging \u4ee3\u7406\u4ecd\u5728\u904b\u884c\u4e26\u5f9e\u5176\u4ed6\u4e00\u4e9b\u6e20\u9053\u63d0\u53d6\u4ee3\u7406\u65e5\u8a8c\u548c\u4e8b\u4ef6\u65e5\u8a8c\u4e5f\u662f\u5982\u6b64\u3002\u539f\u56e0\u5728\u65bc windows_eventlog \u63d2\u4ef6\u5b58\u5728\u6b64\u6f14\u793a\u6587\u7a3f\u4e2d\u63d0\u5230\u7684\u4e00\u4e9b\u554f\u984c\u3002\u4f7f\u7528 windows_eventlog2 \u53ef\u89e3\u6c7a\u6b64\u554f\u984c\u3002             | \u6ce8\u610f\uff1awindows_eventlog2 \u63d2\u4ef6\u7684\u6578\u64da\u683c\u5f0f\u4e26\u4e0d\u5411\u5f8c\u517c\u5bb9 windows_eventlog \u63d2\u4ef6\u3002\u5982\u679c\u91dd\u5c0d\u9019\u4e9b\u65e5\u8a8c\u8a2d\u7f6e\u4e86\u4efb\u4f55 BigQuery \u6216 Google Cloud Storage \u5c0e\u51fa\u6d41\u6c34\u7dda\uff0c\u5247\u9700\u8981\u9032\u884c\u76f8\u61c9\u7684\u8abf\u6574\u3002\u8acb\u53c3\u95b1 windows_eventlog \u548c windows_eventlog2 \u63d0\u4f9b\u7684\u9019\u4e00\u65e5\u8a8c\u689d\u76ee\u6bd4\u8f03\u3002\u8981\u4f7f\u7528 windows_eventlog2\uff0c\u60a8\u5fc5\u9808\u5148\u505c\u6b62 Logging \u4ee3\u7406\uff0c\u7136\u5f8c\u5c07\u914d\u7f6e\u6587\u4ef6\u66ff\u63db\u7232\u985e\u4f3c\u65bc\u6b64\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u7684\u6587\u4ef6\u3002\u6700\u5f8c\uff0c\u5553\u52d5 Logging \u4ee3\u7406\u3002 |\n| \u5982\u679c\u5b58\u5728\u65e5\u8a8c\u8f2a\u66ff\uff0cLogging \u4ee3\u7406\u6703\u505c\u6b62\u63d0\u53d6\u65e5\u8a8c            | \u7576\u4f7f\u7528 copytruncate \u8a2d\u7f6e\u4f86\u8a2d\u7f6e\u65e5\u8a8c\u8f2a\u66ff\u6642\uff0cLogging \u4ee3\u7406\u53ef\u80fd\u6703\u7121\u6cd5\u8ddf\u8e64\u5176\u5728\u8f38\u5165\u6587\u4ef6\u4e2d\u7684\u4f4d\u7f6e\u3002                                                 | \u6700\u597d\u4f7f\u7528 nocopytruncate \u8a2d\u7f6e\u4f86\u78ba\u4fdd\u65e5\u8a8c\u8f2a\u66ff\u79fb\u52d5\u6587\u4ef6\u800c\u4e0d\u662f\u622a\u65b7\u6587\u4ef6\u3002\u5982\u679c\u8981\u4fdd\u7559 copytruncate \u8a2d\u7f6e\uff0c\u5247\u89e3\u6c7a\u65b9\u6cd5\u662f\u5b9a\u671f\u91cd\u5553\u4ee3\u7406\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 postrotate \u8a2d\u7f6e\u91cd\u5553\u4ee3\u7406\u3002                                                  |\n| error_class=Errno::EADDRINUSE error=\"Address already in use - bind(2) for 0.0.0.0:24231\" | \u865b\u64ec\u6a5f\u4e0a\u6b63\u5728\u904b\u884c\u591a\u500b Logging \u4ee3\u7406\u5be6\u4f8b\u3002                                                             | \u4f7f\u7528 ps -aux | grep \"/usr/sbin/google-fluentd\" \u986f\u793a\u6b63\u5728\u904b\u884c\u7684\u4ee3\u7406\u9032\u7a0b\uff08\u61c9\u8a72\u53ea\u6709\u5169\u500b\u9032\u7a0b\uff0c\u4e00\u500b\u662f\u76e3\u7ba1\u7a0b\u5e8f\u9032\u7a0b\uff0c\u53e6\u4e00\u500b\u662f\u5de5\u4f5c\u5668\u9032\u7a0b\uff09\uff0c\u4f7f\u7528 sudo netstat -nltp | grep :24231 \u986f\u793a\u4f54\u7528\u8a72\u7aef\u53e3\u4e14\u6b63\u5728\u904b\u884c\u7684\u9032\u7a0b\u3002\u6839\u64da\u9700\u8981\u7d42\u6b62\u820a\u5be6\u4f8b\u3002                                    |\n| \u7531\u65bc lib/fluent/config/types.rb \u51fa\u73fe\u932f\u8aa4\uff0cLogging \u4ee3\u7406\u7121\u6cd5\u5553\u52d5       | Logging \u4ee3\u7406\u914d\u7f6e\u4f7f\u7528\u6b63\u5247\u8868\u9054\u5f0f\u89e3\u6790\u5668\u90e8\u5206\uff0c\u800c\u8a72\u90e8\u5206\u7684\u6b63\u5247\u8868\u9054\u5f0f\u683c\u5f0f\u4e0d\u6b63\u78ba\uff0c\u5c0e\u81f4 subexp \u8abf\u7528\u7121\u6548\uff0c\u4e26\u4e14\u51fa\u73fe\u985e\u4f3c\u65bc Starting google-fluentd 1.8.6: /opt/google-fluentd/embedded/lib/ruby/gems/2.6.0/gems/fluentd-1.11.2/lib/fluent/config/types.rb:92: warning: invalid subexp call \u7684\u932f\u8aa4\u3002 | \u5728\u4ee3\u7406\u914d\u7f6e\u6587\u4ef6\u4e2d\u627e\u5230\u4e26\u4fee\u5fa9\u683c\u5f0f\u932f\u8aa4\u7684\u6b63\u5247\u8868\u9054\u5f0f\u3002\u63d0\u793a\uff1a\u641c\u7d22 regex \u6216 parse\u3002                                                                         |\n**\u6ce8\u610f** \uff1a\u5982\u679c\u4e4b\u524d\u7684\u932f\u8aa4\u4e0d\u9069\u7528\uff0c\u4e26\u4e14\u60a8\u6c92\u6709\u770b\u5230\u65e5\u8a8c\u689d\u76ee\uff0c\u8acb\u53c3\u95b1 [\u67e5\u770b\u65e5\u8a8c\uff1a\u554f\u984c\u6392\u67e5](https://cloud.google.com/logging/docs/view/logs-explorer-interface?hl=zh-cn#troubleshooting) \u3002\n### \u65e5\u8a8c\u541e\u5410\u91cf\u9650\u5236\nLogging \u4ee3\u7406\u53ef\u4ee5\u8655\u7406\u7684\u6700\u5927\u65e5\u8a8c\u541e\u5410\u91cf\u53d7\u9650\u65bc CPU\u3002\u7576\u65e5\u5fd7\u541e\u5410\u91cf\u589e\u52a0\u6642\uff0cCPU \u4f7f\u7528\u7387\u5f80\u5f80\u4e5f\u6703\u63d0\u9ad8\u3002\u4f46\u662f\uff0c\u63a1\u7528\u9ed8\u8a8d\u914d\u7f6e\u7684\u4ee3\u7406\u6700\u591a\u96bb\u80fd\u4f7f\u7528\u4e00\u500b CPU \u6838\u5fc3\u3002\u56e0\u6b64\uff0c\u7576\u65e5\u5fd7\u541e\u5410\u91cf\u51fa\u73fe\u5cef\u503c\u6642\uff0c\u4ee3\u7406\u53ef\u80fd\u6703\u9054\u5230 CPU \u4f7f\u7528\u7387\u9650\u5236\u3002\u5982\u679c\u9019\u4e9b\u5cef\u503c\u662f\u66ab\u6642\u7684\uff0cLogging \u4ee3\u7406\u6703\u7de9\u885d\u65e5\u8a8c\u4e26\u8d95\u4e0a\u9032\u5ea6\u4ee5\u6700\u7d42\u8655\u7406\u65e5\u8a8c\u3002\u5982\u679c\u9ad8\u65e5\u8a8c\u541e\u5410\u91cf\u4e00\u76f4\u6301\u7e8c\uff0c\u65e5\u8a8c\u53ef\u80fd\u6703\u6ea2\u51fa\u7de9\u885d\u5340\uff0c\u4e26\u6700\u7d42\u4e1f\u5931\u3002\n\u901a\u5e38\uff0c\u7576\u6bcf\u500b\u65e5\u8a8c\u689d\u76ee\u7232 1000 \u5b57\u7bc0\u539f\u59cb\u6587\u672c\u4e14\u4e0d\u5305\u542b\u984d\u5916\u7684\u683c\u5f0f\u8655\u7406\u6642\uff0cLogging \u4ee3\u7406\u6703\u5728\u6bcf\u79d2\u7d04 5500 \u689d\u65e5\u8a8c\u689d\u76ee\u6642\u9054\u5230\u55ae\u500b\u6838\u5fc3 CPU \u9650\u5236\u3002\u5982\u679c\u65e5\u8a8c\u689d\u76ee\u9700\u8981\u9ad8\u7d1a\u8655\u7406\uff08\u4f8b\u5982 JSON \u6216\u6b63\u5247\u8868\u9054\u5f0f\u89e3\u6790\uff09\uff0c\u6bcf\u79d2\u6700\u5927\u65e5\u8a8c\u689d\u76ee\u6578\u53ef\u80fd\u6703\u4f4e\u65bc\u6b64\u503c\u3002\n\u5982\u679c\u60a8\u9700\u8981\u66f4\u9ad8\u7684\u65e5\u8a8c\u541e\u5410\u91cf\uff0c\u8acb\u8003\u616e\u4f7f\u7528 [Ops Agent](https://cloud.google.com/stackdriver/docs/solutions/ops-agent?hl=zh-cn) \u3002\u5728 Linux \u4e0a\uff0c\u5c0d\u65bc 1000 \u5b57\u7bc0\u7684\u539f\u59cb\u6587\u672c\u4e14\u4e0d\u6d89\u53ca\u984d\u5916\u8655\u7406\u7684\u65e5\u8a8c\u689d\u76ee\uff0cOps Agent \u6bcf\u79d2\u53ef\u4ee5\u8655\u7406\u7d04 16 \u842c\u689d\u65e5\u8a8c\u689d\u76ee\u3002\n### \u8d85\u51fa\u65e5\u8a8c\u5927\u5c0f\u9650\u5236\n\u5982\u679c\u4e00\u500b\u6216\u591a\u500b\u65e5\u8a8c\u689d\u76ee\u8d85\u51fa\u5927\u5c0f\u9650\u5236\uff0c\u5247\u60a8\u53ef\u80fd\u6703\u5728 **fluentd** \u65e5\u8a8c\u4e2d\u627e\u5230\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\u7684\u689d\u76ee\uff1a\n```\nDropping 1 log message(s) error_class=\"Google::Apis::ClientError\" error=\"Invalid request\"\n```\n\u6216\n```\nDropping 1 log message(s) error=\"3:Log entry with size 1000515 bytes exceeds maximum size of 112640 bytes\" error_code=\"3\"\n```\n\u8981\u89e3\u6c7a\u6b64\u932f\u8aa4\uff0c\u8acb\u9069\u7576\u522a\u6e1b\u60a8\u7684\u65e5\u8a8c\u689d\u76ee\uff0c\u4f7f\u5176\u4e0d\u8d85\u51fa\u5927\u5c0f\u9650\u5236\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u793a\u4f8b\u4ee3\u78bc\u522a\u6e1b\u5e36\u6709 `mytag` \u6a19\u8a18\u7684\u65e5\u8a8c\u4e2d `message` \u5b57\u6bb5\u4e2d\u7684\u6578\u64da\uff1a\n```\n# Cloud Logging only supports log entries that are up to 256 KiB in size.# Trim the entries to just under that size to avoid dropping them.<filter [MY_TAG]>\u00a0 @type record_transformer\u00a0 enable_ruby true\u00a0 <record>\u00a0 \u00a0 message ${record['message'].length > 256000 ? \"[Trimmed]#{record['message'][0..256000]}...\" : record['message']}\u00a0 </record></filter>\n```\n### \u65e5\u8a8c\u91cd\u8907\n\u5c07 [LogEntry.insertID](https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry?hl=zh-cn) \u6dfb\u52a0\u5230\u4ee3\u7406\u7684\u8655\u7406\u6d41\u6c34\u7dda\u4e2d\u3002\u5982\u679c `insertID` \u5728\u591a\u500b\u91cd\u8907\u65e5\u8a8c\u4e2d\u4e0d\u540c\uff0c\u5247\u8868\u793a\u65e5\u8a8c\u5728\u65e5\u8a8c\u6587\u4ef6\u4e2d\u88ab\u591a\u6b21\u8ddf\u8e64\u3002\u5728\u5b58\u5728\u65e5\u8a8c\u8f2a\u63db\uff0c\u6216 pos \u6587\u4ef6\u7f3a\u5931\u6216\u640d\u58de\u6642\uff0c\u53ef\u80fd\u6703\u767c\u751f\u9019\u7a2e\u60c5\u6cc1\u3002\u7232\u4e86\u6e1b\u5c11\u767c\u751f\u6b64\u554f\u984c\u7684\u53ef\u80fd\u6027\uff0c\u8acb\u78ba\u4fdd\u672a\u5c07\u4efb\u4f55 `in_tail` \u8f38\u5165\u7684\u4f4d\u7f6e\u6587\u4ef6\u914d\u7f6e\u7232\u4f4d\u65bc `/var/log` \u6587\u4ef6\u593e\u6216\u4efb\u4f55\u5176\u4ed6\u53ef\u80fd\u5553\u7528\u4e86\u65e5\u8a8c\u8f2a\u63db\u7684\u6587\u4ef6\u593e\u4e2d\u3002\n\u65e5\u8a8c\u8a18\u9304\u6d41\u6c34\u7dda\u9084\u6839\u64da [LogEntry.timestamp](https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry?hl=zh-cn) \u5b57\u6bb5\u4f86\u522a\u9664\u91cd\u8907\u65e5\u8a8c\u3002\u78ba\u4fdd\u6b63\u78ba [\u89e3\u6790](https://docs.fluentd.org/parser) \u65e5\u8a8c\u689d\u76ee\u7684\u5be6\u969b\u6642\u9593\u6233\u3002\u5982\u672a\u5c07 Fluentd \u8a2d\u7f6e\u7232\u5f9e\u65e5\u8a8c\u689d\u76ee\u89e3\u6790\u539f\u59cb\u6642\u9593\u6233\uff0c\u5247 Fluentd \u5c07\u4f7f\u7528\u5176\u8655\u7406\u65e5\u8a8c\u689d\u76ee\u7684\u6642\u9593\u3002\u56e0\u6b64\uff0c\u5982\u679c\u591a\u6b21\u8b80\u53d6\u8f38\u5165\uff0c\u5373\u4f7f\u65e5\u8a8c\u884c\u4e2d\u7684\u6642\u9593\u6233\u76f8\u540c\uff0cFluentd \u4e5f\u53ef\u80fd\u5c07\u5176\u8996\u7232\u5177\u6709\u4e0d\u540c\u6642\u9593\u6233\u7684\u4e0d\u540c\u65e5\u8a8c\u689d\u76ee\u3002\n### \u5be9\u8988\u65e5\u8a8c\u91cd\u8907\u932f\u8aa4\uff1aData points cannot be written more than 24h in the past\n\u5b58\u5728\u4e00\u500b\u5f71\u97ff 1.8.5 \u5230 1.9.3\uff08\u542b\uff09\u7248\u672c\u7684\u5df2\u77e5\u554f\u984c\uff0c\u9019\u6703\u5c0e\u81f4\u5982\u4e0b\u65e5\u8a8c\u5728 [\u6578\u64da\u8a2a\u554f\u5be9\u8988\u65e5\u8a8c](https://cloud.google.com/logging/docs/audit?hl=zh-cn#data-access) \u4e2d\u91cd\u8907\u51fa\u73fe\uff08\u7576\u4ee3\u7406\u904b\u884c\u8d85\u904e 24 \u5c0f\u6642\u6642\uff09\uff1a\n```\nField timeSeries[0].points[0].interval.end_time had an invalid value of \"2021-10-20T20:16:34.010866-07:00\": Data points cannot be written more than 24h in the past.\n```\n\u89e3\u6c7a\u65b9\u6cd5\u662f\u5c07 [\u4ee3\u7406\u5347\u7d1a](https://cloud.google.com/stackdriver/docs/solutions/agents/logging/installation?hl=zh-cn#upgrade) \u5230 1.9.4 \u6216\u66f4\u9ad8\u7248\u672c\u3002\n### \u65e5\u8a8c\u4e2d\u7684 Unicode \u5b57\u7b26\u88ab\u66ff\u63db\u7232\u7a7a\u683c\u6216\u201c\ufffd\u201d\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c `in_tail` \u8f38\u5165\u8981\u6c42\u8f38\u5165\u6587\u4ef6\u63a1\u7528 ASCII \u7de8\u78bc\uff0c\u56e0\u6b64\u5b83\u6703\u5c07\u4efb\u4f55\u975e ASCII \u5b57\u7b26\u66ff\u63db\u7232\u7a7a\u683c\u3002\u5982\u9700\u5be6\u969b\u6ce8\u5165 UTF-8 \u7de8\u78bc\u6587\u4ef6\uff0c\u60a8\u9700\u8981\u5728 `in_tail` \u914d\u7f6e\u4e2d\u63d0\u4f9b\u5169\u500b\u9078\u9805\uff1a\n```\n<source>\u00a0 @type tail\u00a0 \u2026\u00a0 encoding UTF-8\u00a0 from_encoding UTF-8</source>\n```\n\u9019\u5169\u500b\u9078\u9805\u90fd\u662f\u5fc5\u9700\u7684\u3002\u5982\u679c\u50c5\u63d0\u4f9b `encoding` \u9078\u9805\uff0c\u5247\u63d0\u53d6\u65e5\u8a8c\u4e2d\u7684\u975e ASCII \u5b57\u7b26\u5c07\u88ab\u66ff\u63db\u7232\u201c\ufffd\u201d\u3002\n## \u79fb\u9664\u4e86\u7531 Google Cloud Console \u5831\u544a\u7232\u5df2\u5b89\u88dd\u7684\u4ee3\u7406\n\u5378\u8f09\u4ee3\u7406\u5f8c\uff0cGoogle Cloud \u63a7\u5236\u6aaf\u6700\u591a\u53ef\u80fd\u9700\u8981\u4e00\u5c0f\u6642\u624d\u80fd\u5831\u544a\u6b64\u66f4\u6539\u3002\n## Logging \u4ee3\u7406\u672a\u986f\u793a\u5728 Windows \u5378\u8f09\u7a0b\u5e8f\u5217\u8868\u4e2d\n\u5982\u9700\u5728 Windows \u63a7\u5236\u9762\u677f\u7684 **\u5378\u8f09\u7a0b\u5e8f** \u5217\u8868\u4e2d\u672a\u5217\u51fa Logging \u4ee3\u7406\u6642\u5c07\u5176\u5378\u8f09\uff0c\u8acb\u5f9e\u5b89\u88dd\u5b83\u7684\u76ee\u9304\u904b\u884c `uninstall.exe` \u3002", "guide": "Google Cloud Observability"}