{"title": "Apigee - Step 3: Configure the GKE on-prem user cluster", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - Step 3: Configure the GKE on-prem user cluster\nYou are currently viewing version 1.1 of the Apigee hybrid documentation. **This version is end of life.** You should upgrade to a newer version. For more information, see [Supported versions](/apigee/docs/hybrid/supported-platforms#supported-versions) .\n", "content": "## \n Specify configuration overrides\nThe Apigee hybrid installer uses defaults for many settings; however, there are a few settings that do not have defaults. You must provide values for these settings, as explained next.\n- Be sure you are in the`` `/hybrid-files`directory.\n- Copy the`overrides-small.yaml`file from the``$APIGEECTL_HOME`` `/examples`directory to your`overrides`directory:```\ncp $APIGEECTL_HOME/examples/overrides-small.yaml ./overrides/overrides.yaml\n```This example file provides a basic configuration for a small-footprint hybrid  runtime installation, a configuration that is suitable for a your first installation.\n- `cd`into the`overrides`directory:\n- ```\ncd overrides\n```\n- Open`overrides.yaml`and add the required property values, shown below. A detailed  description of each property is also provided below: **NOTE: ** Be sure to disable logging by setting`logger:enabled:false`in the overrides file.  Logging is provided by default as part of GKE on-prem.\nThe `overrides.yaml` file has the following structure and syntax.   Values in are   property values that you must provide:\n```\ngcpProjectID: project-idk8sClusterName: cluster-nameorg: org-nameenvs:\u00a0 - name: environment-name \u00a0# The same name of the env you created in the UI\u00a0 \u00a0 hostAlias: test-host-alias\u00a0 \u00a0 sslCertPath: ./certs/test-cert-name.pem\u00a0 \u00a0 sslKeyPath: ./certs/test-key-name.key\u00a0 \u00a0 serviceAccountPaths:\u00a0 \u00a0 \u00a0 synchronizer: ./service-accounts/synchronizer-service-account-name.json\u00a0 \u00a0 \u00a0 udca: ./service-accounts/udca-service-account-name.jsoncassandra:\u00a0 hostNetwork: true\u00a0 dnsPolicy: ClusterFirstWithHostNetingress:\u00a0 runtime:\u00a0 \u00a0 loadBalancerIP: virtual_IP_runtime\u00a0 mart:\u00a0 \u00a0 loadBalancerIP: virtual_IP_martmart:\u00a0 hostAlias: mart-host-alias\u00a0 serviceAccountPath: ./service-accounts/mart-service-account-name.json\u00a0 sslCertPath: ./certs/mart-cert-name.pem\u00a0 sslKeyPath: ./certs/mart-key-name.keymetrics:\u00a0 serviceAccountPath: ./service-accounts/metrics-service-account-name.jsonlogger:\u00a0 enabled: false\n```The following example shows a completed overrides file with example property values   added:\n```\ngcpProjectID: hybrid-projectk8sClusterName: apigee-hybridorg: hybrid-orgenvs:\u00a0 - name: test\u00a0 \u00a0 hostAlias: \"*\"\u00a0 \u00a0 sslCertPath: ./certs/keystore.pem\u00a0 \u00a0 sslKeyPath: ./certs/keystore.key\u00a0 \u00a0 serviceAccountPaths:\u00a0 \u00a0 \u00a0 synchronizer: ./service-accounts/hybrid-project-apigee-synchronizer.json\u00a0 \u00a0 \u00a0 udca: ./service-accounts/hybrid-project-apigee-udca.jsoncassandra:\u00a0 hostNetwork: true\u00a0 dnsPolicy: ClusterFirstWithHostNetingress:\u00a0 runtime:\u00a0 \u00a0 loadBalancerIP: 21.0.124.13\u00a0 mart:\u00a0 \u00a0 loadBalancerIP: 21.0.124.14mart:\u00a0 hostAlias: \"mart.apigee-hybrid-docs.net\"\u00a0 serviceAccountPath: ./service-accounts/hybrid-project-apigee-mart.json\u00a0 sslCertPath: ./certs/fullchain.pem\u00a0 sslKeyPath: ./certs/privkey.keymetrics:\u00a0 \u00a0 \u00a0 serviceAccountPath: ./service-accounts/hybrid-project-apigee-metrics.jsonlogger:\u00a0 enabled: false\n```\n- When your finished, save the file.\nThe following table describes each of the property values that you must provide in the overrides file.\n| Variable       | Description                                                                                                                    |\n|:------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| project-id       | Your GCP project ID.                                                                                                                  |\n| cluster-name      | Your Kubernetes cluster name.                                                                                                                |\n| org-name       | The name of your Apigee hybrid organization.                                                                                                            |\n| environment-name     | Use the same name that you used when you created an environment in the UI, as explained in Step 5: Add a new environment in the hybrid UI.                                                                                    |\n| test-host-alias      | (Required) For the quickstart, use the wildcard character \"*\". The use of * is only recommended for a trial installation when using self-signed TLS credentials. Later, as you develop more complex Apigee hybrid configurations, such as creating multiple environments, you will need to use a qualified domain name for this value.                                     |\n| test-cert-name test-key-name  | Enter the name of the self-signed TLS key and certificate files that you generated previously in the step Create TLS credentials for the runtime gateway. These files must be located in the base_directory/hybrid-files/certs directory. For example: sslCertPath: ./certs/keystore.pem sslKeyPath: ./certs/keystore.key                                        |\n| synchronizer-service-account-name | The name of the synchronizer service account key file that you generated with the create-service-account tool. For example: synchronizer: ./service-accounts/hybrid-project-apigee-synchronizer.json                                                                      |\n| udca-service-account-name   | The name of the udca service account key file that you generated with the create-service-account tool. For example: udca: ./service-accounts/hybrid-project-apigee-udca.json                                                                            |\n| virtual_IP_runtime, virtual_IP_mart | To use GKE on-prem integrated load balancing, you need to provide virtual IPs for LoadBalancers on the hybrid MART and runtime services. GKE on-prem automatically configures the virtual IP on the F5 BIG-IP load balancer. For more information, see Setting up your load balancer for GKE on-prem                                             |\n| mart-host-alias      | A qualified DNS name for the MART server endpoint. This name must match the common name (CN) used in the authorized TLS certificate required for this configuration. For example, mart.mydomain.com NOTE: The Common Name (CN) in the certificate must agree with the value specified in the mart.hostAlias property. If the CN is *.hybrid-domain.net and you've registered the host mart.hybrid-domain.net, then you would set mart.hostAlias to the value mart.hybrid-domain.net. |\n| mart-service-account-name   | The name of the mart service account key file that you generated with the create-service-account tool.                                                                                             |\n| mart-cert-name mart-key-name  | Enter the name of the authorized TLS key and certificate files that you generated previously in the step Create TLS credentials for the MART gateway. These files must be located in the base_directory/hybrid-files/certs directory. For example: sslCertPath: ./certs/fullchain.pem sslKeyPath: ./certs/privkey.key                                         |\n| metrics-service-account-name  | The name of the metrics service account key file that you generated with the create-service-account tool. For example: serviceAccountPath: ./service-accounts/hybrid-project-apigee-metrics.json                                                                       |\n## \n Summary\nThe configuration file tells Kubernetes how to deploy the hybrid components to a cluster. Next, you will apply this configuration to your cluster.\n## Next step\nstepper_buttons is defined in localvars Iterate over all the buttons in the data dictionary If the button's step matches the current step in the process, make the button disabled [1](/apigee/docs/hybrid/v1.1/install-create-cluster-anthos) If the button's step matches the current step in the process, make the button disabled [2](/apigee/docs/hybrid/v1.1/install-download-install-anthos) If the button's step matches the current step in the process, make the button disabled If the button's step matches the next step [3](/apigee/docs/hybrid/v1.1/install-copy-overrides-anthos) If the button's step matches the current step in the process, make the button disabled In all other cases (previous buttons or future buttons (after the next one), make them links [(NEXT) Step 4: Install hybrid runtime](/apigee/docs/hybrid/v1.1/install-apply-hybrid-anthos)", "guide": "Apigee"}