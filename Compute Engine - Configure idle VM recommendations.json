{"title": "Compute Engine - Configure idle VM recommendations", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Configure idle VM recommendations\n**    Preview     ** This product or feature is subject to the \"Pre-GA Offerings Terms\" in the General Service Terms section   of the [Service Specific Terms](/terms/service-terms#1) .     Pre-GA products and features are available \"as is\" and might have limited support.    For more information, see the [launch stage descriptions](/products#product-launch-stages) .\nThis page describes how to view and modify the configuration of your idle VM recommendations. You might want to modify the configuration to increase the number of recommendations that you receive or to avoid misclassifying VMs with intentionally small workloads as idle VMs.\n- For more information on the parameters you can use to customize the recommendations, see [Choose the right configuration parameters](/compute/docs/instances/idle-vm-recommendations-overview#choose_configuration) .\n- For more information on how to identify idle VMs and take action, see [View and apply idle VM recommendations](/compute/docs/instances/viewing-and-applying-idle-vm-recommendations) .", "content": "## Before you begin\n- If you haven't already, set up authentication. [Authentication](/compute/docs/authentication) is the process by which your identity is verified for access to Google Cloud services and APIs. To run code or samples from a local development environment, you can authenticate to Compute Engine as follows.Select the tab for how you plan to use the samples on this page:- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:```\ngcloud init\n``` **Note:** If you installed the gcloud CLI  previously, make sure you have the latest version by running`gcloud components  update`.\n- [ Set a default region and zone](/compute/docs/gcloud-compute#set_default_zone_and_region_in_your_local_client) .\nTo use the REST API samples on this page in a local development environment, you use the credentials you provide to the gcloud CLI.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:\n- ```\ngcloud init\n```## Pricing\nConfigurable recommendations are available free of charge. Using recommendations to reduce your resource usage can result in cost savings.\n## Configure your recommendations\nTo configure your idle VM recommendations, perform the following steps:\n- [Get the current configuration](#get_current_configuration) to obtain the JSON file of the configuration.\n- Edit the configuration file in JSON format.\n- [Upload the new configuration file](#update_configuration) to apply the changes.\n### Get the current configuration\nYou can obtain the current configuration for idle VM recommendations for your project by using the Google Cloud CLI or REST.\nTo get the current configuration parameters, use the [gcloud recommender recommender-config describe](/sdk/gcloud/reference/recommender/recommender-config/describe) command and use `google.compute.instance.IdleResourceRecommender` as the Recommender ID:\n```\ngcloud recommender recommender-config describe google.compute.instance.IdleResourceRecommender \\\n --project=PROJECT_ID \\\n --location=ZONE\n```\nReplace the following:- ``: the ID of your project\n- ``: the zone for which you want to obtain the current configuration\nFor example:\n```\ngcloud recommender recommender-config describe google.compute.instance.IdleResourceRecommender \\\n --project=my-project \\\n --location=us-central1-c\n```\nThe command returns the recommender configuration, including the modifiable subfield `params.observation_period` .\n```\n{\n \"name\": \"projects/PROJECT_ID/locations/ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\",\n \"recommenderGenerationConfig\": {\n \"params\": {\n  \"observation_period\": \"1209600s\"\n }\n },\n \"etag\": \"\\\"2f3c9b65cda6a4ba\\\"\",\n \"updateTime\": \"2021-02-03T04:41:15.330351Z\"\n}\n```\nTo retrieve the current configuration, use the [recommenders.getConfig](/recommender/docs/reference/rest/v1/projects.locations.recommenders/getConfig) method and specify `google.compute.instance.IdleResourceRecommender` as the Recommender ID:\n```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\n```\nReplace the following:- ``: the ID of the project for which you want to retrieve the recommender config.\n- ``: the zone that contains your project.\nFrom the command line, execute the following command to get the recommender configuration for a project:\n```\nPROJECT_ID=PROJECT_ID\nZONE=ZONE\ncurl -X GET -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n-H \"x-goog-user-project: ${PROJECT_ID}\" \\\nhttps://recommender.googleapis.com/v1/projects/$PROJECT_ID/locations/$ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\n```\nThe command returns the recommender configuration, including the subfield that you can modify: `params.observation_period` .\n```\n{\n \"name\": \"projects/PROJECT_ID/locations/ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\",\n \"recommenderGenerationConfig\": {\n \"params\": {\n  \"observation_period\": \"1209600s\"\n }\n },\n \"etag\": \"\\\"2f3c9b65cda6a4ba\\\"\",\n \"updateTime\": \"2021-02-03T04:41:15.330351Z\"\n}\n```\n **Note:** When you submit the new configuration, remove the `updateTime` parameter.\n### Update the configuration for a project\nTo update the configuration of your idle VM recommendations, modify the value for `observation_period` and upload the new configuration for your project.\nYou can set the observation period to a value between 1 day and 14 days, using a string with the total number of seconds, followed by the letter `s` .\n- For an observation period of 1 day, use`\"86400s\"`.\n- For an observation period of 14 days, use`\"1209600s\"`.\nAfter you upload the new configuration, it takes approximately 48 hours for it to take effect. Until that time, any generated recommendations use the previous configuration.\nTo update the configuration parameters, use the [gcloud recommender recommender-config update](/sdk/gcloud/reference/recommender/recommender-config/update) command and use `google.compute.instance.IdleResourceRecommender` as the Recommender ID:\n```\ngcloud recommender recommender-config update google.compute.instance.IdleResourceRecommender\\\n --project=PROJECT_ID \\\n --location=ZONE \\\n --config-file=CONFIG_FILE_PATH \\\n --etag=ETAG\n```\nReplace the following:- ``: the ID of your project\n- ``: the zone for which you want to obtain the current configuration\n- ``: the path to the JSON file with the current configuration\n- ``: the etag value of the current configuration\nIn your configuration file, specify only the `recommenderGenerationConfig` object with the updated configuration parameters. For example, to specify an observation period of five days, use the following configuration file:\n```\n{\n \"params\": {\n \"observation_period\": \"432000s\"\n }\n}\n```\nIf the command is successful, it returns a response body similar to the following, showing the new configuration with the parameters you just modified.\n```\n{\n \"name\": \"projects/PROJECT_ID/locations/ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\",\n \"recommenderGenerationConfig\": {\n \"params\": {\n  \"observation_period\": \"432000s\"\n }\n },\n \"etag\": \"\\\"1245f9435cd01ea8\\\"\",\n \"updateTime\": \"2021-02-03T05:00:05Z\"\n}\n```\n **Note:** the `etag` value changes from the previous configuration. You must use the new value if you update the configuration again.\nTo update the configuration, use the [recommenders.updateConfig](/recommender/docs/reference/rest/v1/projects.locations.recommenders/updateConfig) method and specify `google.compute.instance.IdleResourceRecommender` as the Recommender ID:\n```\nPATCH https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\n{\n \"name\": \"projects/PROJECT_ID/locations/ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\",\n \"recommenderGenerationConfig\": {\n \"params\": {\n  \"observation_period\": \"1209600s\"\n }\n },\n \"etag\": \"\\\"2f3c9b65cda6a4ba\\\"\"\n}\n```\nReplace the following:- ``: the ID of the project for which you want to modify the recommender configuration.\n- ``: the zone that contains your project.\nSave the request body in a file, for example `config.json` . You can then reference the file when you update the recommender configuration for your project, using a command similar to the following:\n```\ncurl -X PATCH \\\n-H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n-H \"Content-Type: application/json; charset=utf-8\" \\\n-H \"x-goog-user-project: ${PROJECT_ID}\" \\\n-d @config.json \\\nhttps://recommender.googleapis.com/v1/projects/$PROJECT_ID/locations/$ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\n```\nThe `POST` command returns a response body similar to the following, showing the new configuration with the parameters you just modified.\n```\n{\n \"name\": \"projects/PROJECT_ID/locations/ZONE/recommenders/google.compute.instance.IdleResourceRecommender/config\",\n \"recommenderGenerationConfig\": {\n \"params\": {\n  \"observation_period\": \"432000s\"\n }\n },\n \"etag\": \"\\\"1245f9435cd01ea8\\\"\",\n \"updateTime\": \"2021-02-03T05:00:05Z\"\n}\n```\n **Note:** the `etag` value changes from the previous configuration. You must use the new value if you update the configuration again.\n## What's next\n- Learn how to [view and apply idle VM recommendations](/compute/docs/instances/viewing-and-applying-idle-vm-recommendations) .", "guide": "Compute Engine"}