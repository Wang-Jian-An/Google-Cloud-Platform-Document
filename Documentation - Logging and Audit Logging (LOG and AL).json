{"title": "Documentation - Logging and Audit Logging (LOG and AL)", "url": "https://cloud.google.com/distributed-cloud/hosted/docs/latest/gdch/overview", "abstract": "# Documentation - Logging and Audit Logging (LOG and AL)\n| 0     | 1                                               |\n|:-------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Audit log source | Observability audit logger Kubernetes audit logs                                    |\n| Audited operations | Run LogQL queries or export logs using the user interface of the monitoring instance Perform actions on the LoggingTarget custom resource Perform actions on the LoggingRule custom resource |\n", "content": "## Run LogQL queries or export logs using the user interface of the monitoring instance\n**Note:** You can export all queries in the monitoring instance. That action doesn't separately capture the export from the user interface, but it logs the executed query.\n| 0    | 1   |\n|:-----------------|:-------------|\n| Audit log source | Proxy server |\n| Log type   | Data plane |\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')                   |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------|\n| User or service identity              | user                    | For example, \"user\": { \"issuer\": \"https://ais-core.org-1.zone1.google.gdch.test\", \"identity\": \"fop-infrastructure-operator@example.com\" } |\n| Target (Fields and values that call the API)         | resource                   | For example, \"resource\": \"/infra-obs/grafana/api/ds/query\"                     |\n| Action (Fields containing the performed operation)        | action                   | Possible values: \"action\": \"QUERY\" \"action\": \"CREATE\" \"action\": \"READ\" \"action\": \"UPDATE\" \"action\": \"DELETE\" \"action\": \"CREATE/UPDATE\"  |\n| Event timestamp                | time                    | For example, \"time\": \"2022-12-02T21:37:03.657277582Z\"                      |\n| Source of action                | sourceIPs _gdch_service_name              | For example, \"sourceIPs\": [ [ \"10.253.165.26\", \"127.0.0.6\" ], \"_gdch_service_name\": \"grafana\"            |\n| Outcome                  | response                   | For example, \"response\": \"Successful: 200 OK\"                        |\n| Other fields                 | description                  | The description value contains the complete query. For more information. see the Example log.            |\n**Example log**\n```\n{\u00a0 \"sourceIPs\": [\u00a0 \u00a0 \"10.253.165.26\",\u00a0 \u00a0 \"127.0.0.6\"\u00a0 ],\u00a0 \"description\": \"{\u00a0 \u00a0 \\\"queries\\\":\u00a0 \u00a0 \u00a0 [{\u00a0 \u00a0 \u00a0 \u00a0 \\\"refId\\\":\\\"A\\\",\u00a0 \u00a0 \u00a0 \u00a0 \\\"datasource\\\":\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \\\"uid\\\":\\\"P762A5DD6F13C8B7A\\\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \\\"type\\\":\\\"loki\\\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 \\\"editorMode\\\":\\\"builder\\\",\u00a0 \u00a0 \u00a0 \u00a0 \\\"expr\\\":\\\"{service_name=\\\\\\\"grafana\\\\\\\"} |= ``\\\",\u00a0 \u00a0 \u00a0 \u00a0 \\\"queryType\\\":\\\"range\\\",\u00a0 \u00a0 \u00a0 \u00a0 \\\"key\\\":\\\"Q-fd978c0c-86fd-4c70-bb38-07737a3be3ad-0\\\",\u00a0 \u00a0 \u00a0 \u00a0 \\\"maxLines\\\":1000,\u00a0 \u00a0 \u00a0 \u00a0 \\\"legendFormat\\\":\\\"\\\",\u00a0 \u00a0 \u00a0 \u00a0 \\\"datasourceId\\\":3,\u00a0 \u00a0 \u00a0 \u00a0 \\\"intervalMs\\\":500,\u00a0 \u00a0 \u00a0 \u00a0 \\\"maxDataPoints\\\":1688\u00a0 \u00a0 \u00a0 }],\u00a0 \u00a0 \\\"range\\\":\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \\\"from\\\":\\\"2022-12-02T21:22:03.496Z\\\",\u00a0 \u00a0 \u00a0 \u00a0 \\\"to\\\":\\\"2022-12-02T21:37:03.496Z\\\",\u00a0 \u00a0 \u00a0 \u00a0 \\\"raw\\\":{\\\"from\\\":\\\"now-15m\\\",\\\"to\\\":\\\"now\\\"}\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \\\"from\\\":\\\"1670016123496\\\",\u00a0 \u00a0 \\\"to\\\":\\\"1670017023496\\\"\u00a0 }\",\u00a0 \"response\": \"Successful: 200 OK\",\u00a0 \"_gdch_namespace\": \"infra-obs-obs-system\",\u00a0 \"numBytesSent\": 190079,\u00a0 \"time\": \"2022-12-02T21:37:03.657277582Z\",\u00a0 \"user\": {\u00a0 \u00a0 \"issuer\": \"https://ais-core.org-1.zone1.google.gdch.test\",\u00a0 \u00a0 \"identity\": \"fop-infrastructure-operator@example.com\"\u00a0 },\u00a0 \"_gdch_service_name\": \"grafana\",\u00a0 \"_gdch_service_tenant\": \"infra-obs\",\u00a0 \"numBytesReceived\": 3172,\u00a0 \"resource\": \"/infra-obs/grafana/api/ds/query\",\u00a0 \"auditID\": \"b519ec65-d906-4a79-bcfe-a4e1984045fe\",\u00a0 \"action\": \"QUERY\",\u00a0 \"_gdch_cluster\": \"org-1-admin\",\u00a0 \"_gdch_fluentbit_pod\": \"anthos-audit-logs-forwarder-9x9pd\"}\n```\n## Perform actions on the LoggingTarget custom resource\n| 0    | 1      |\n|:-----------------|:----------------------|\n| Audit log source | Kubernetes audit logs |\n| Log type   | Control plane   |\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')                                                                                              |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| User or service identity              | user                    | For example, \"user\": { \"extra\": { \"authentication.kubernetes.io/pod-name\": [ \"fleet-admin-controller-875778d98-99l6n\" ], \"authentication.kubernetes.io/pod-uid\": [ \"4800e06c-c96d-4e17-ae1a-b5a74eedf6ee\" ] }, \"uid\": \"b18e586e-db0e-417e-9dff-1a722ab36bf4\", \"username\": \"system:serviceaccount:gpc-system:fleet-admin-controller\", \"groups\": [ \"system:serviceaccounts\", \"system:serviceaccounts:gpc-system\", \"system:authenticated\" ] } |\n| Target (Fields and values that call the API)         | requestURI objectRef                | For example, \"requestURI\": \"/apis/logging.gdc.goog/v1/namespaces/obs-system/loggingtargets/lt-cfg1\", \"objectRef\": { \"uid\": \"2e540720-ed23-4665-8c40-c399cb6be624\", \"namespace\": \"obs-system\", \"name\": \"lt-cfg1\", \"resource\": \"loggingtargets\", \"apiVersion\": \"v1\", \"apiGroup\": \"logging.gdc.goog\", \"resourceVersion\": \"5326570\" }                             |\n| Action (Fields containing the performed operation)        | verb                    | Possible values: \"verb\": \"create\" \"verb\": \"delete\" \"verb\": \"get\" \"verb\": \"list\" \"verb\": \"patch\" \"verb\": \"update\" \"verb\": \"watch\"                                                                               |\n| Event timestamp                | requestReceivedTimestamp               | For example, \"requestReceivedTimestamp\": \"2022-12-06T14:37:41.035715Z\"                                                                                             |\n| Source of action                | sourceIPs _gdch_service_name              | For example, \"sourceIPs\": [ \"10.253.164.209\" ], \"_gdch_service_name\": \"apiserver\"                                                                                          |\n| Outcome                  | responseStatus                 | For example, \"responseStatus\": { \"metadata\": {}, \"code\": 200 }                                                                                               |\n| Other fields                 | Not applicable                 | Not applicable                                                                                                           |\n**Example log**\n```\n{\u00a0 \"level\": \"Metadata\",\u00a0 \"auditID\": \"94c2106f-1fd1-428b-adbc-80ac48ef479e\",\u00a0 \"_gdch_cluster\": \"org-1-admin\",\u00a0 \"requestURI\": \"/apis/logging.gdc.goog/v1/namespaces/obs-system/loggingtargets/lt-cfg1\",\u00a0 \"_gdch_fluentbit_pod\": \"anthos-audit-logs-forwarder-4gwpn\",\u00a0 \"verb\": \"update\",\u00a0 \"userAgent\": \"fleet-admin-cm/v0.0.0 (linux/amd64) kubernetes/$Format\",\u00a0 \"responseStatus\": {\u00a0 \u00a0 \"metadata\": {},\u00a0 \u00a0 \"code\": 200\u00a0 },\u00a0 \"user\": {\u00a0 \u00a0 \"extra\": {\u00a0 \u00a0 \u00a0 \"authentication.kubernetes.io/pod-name\": [\u00a0 \u00a0 \u00a0 \u00a0 \"fleet-admin-controller-875778d98-99l6n\"\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \"authentication.kubernetes.io/pod-uid\": [\u00a0 \u00a0 \u00a0 \u00a0 \"4800e06c-c96d-4e17-ae1a-b5a74eedf6ee\"\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 },\u00a0 \u00a0 \"uid\": \"b18e586e-db0e-417e-9dff-1a722ab36bf4\",\u00a0 \u00a0 \"username\": \"system:serviceaccount:gpc-system:fleet-admin-controller\",\u00a0 \u00a0 \"groups\": [\u00a0 \u00a0 \u00a0 \"system:serviceaccounts\",\u00a0 \u00a0 \u00a0 \"system:serviceaccounts:gpc-system\",\u00a0 \u00a0 \u00a0 \"system:authenticated\"\u00a0 \u00a0 ]\u00a0 },\u00a0 \"annotations\": {\u00a0 \u00a0 \"authorization.k8s.io/decision\": \"allow\",\u00a0 \u00a0 \"authorization.k8s.io/reason\": \"RBAC: allowed by ClusterRoleBinding \\\"fleet-admin-common-controller\\\" of ClusterRole \\\"fleet-admin-common-controllers-role\\\" to ServiceAccount \\\"fleet-admin-controller/gpc-system\\\"\"\u00a0 },\u00a0 \"sourceIPs\": [\u00a0 \u00a0 \"10.253.164.209\"\u00a0 ],\u00a0 \"stage\": \"ResponseComplete\",\u00a0 \"kind\": \"Event\",\u00a0 \"apiVersion\": \"audit.k8s.io/v1\",\u00a0 \"stageTimestamp\": \"2022-12-06T14:37:41.035715Z\",\u00a0 \"objectRef\": {\u00a0 \u00a0 \"uid\": \"2e540720-ed23-4665-8c40-c399cb6be624\",\u00a0 \u00a0 \"namespace\": \"obs-system\",\u00a0 \u00a0 \"name\": \"lt-cfg1\",\u00a0 \u00a0 \"resource\": \"loggingtargets\",\u00a0 \u00a0 \"apiVersion\": \"v1\",\u00a0 \u00a0 \"apiGroup\": \"logging.gdc.goog\",\u00a0 \u00a0 \"resourceVersion\": \"5326570\"\u00a0 },\u00a0 \"requestReceivedTimestamp\": \"2022-12-06T14:37:40.942762Z\",\u00a0 \"_gdch_service_name\": \"apiserver\"}\n```\n## Perform actions on the LoggingRule custom resource\n| 0    | 1      |\n|:-----------------|:----------------------|\n| Audit log source | Kubernetes audit logs |\n| Log type   | Control plane   |\n| ('Fields in the log entry that contain audit information', 'Audit metadata') | ('Fields in the log entry that contain audit information', 'Audit field name') | ('Fields in the log entry that contain audit information', 'Value')                                                                                              |\n|:-------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| User or service identity              | user                    | For example, \"user\": { \"extra\": { \"authentication.kubernetes.io/pod-name\": [ \"fleet-admin-controller-875778d98-99l6n\" ], \"authentication.kubernetes.io/pod-uid\": [ \"4800e06c-c96d-4e17-ae1a-b5a74eedf6ee\" ] }, \"uid\": \"b18e586e-db0e-417e-9dff-1a722ab36bf4\", \"username\": \"system:serviceaccount:gpc-system:fleet-admin-controller\", \"groups\": [ \"system:serviceaccounts\", \"system:serviceaccounts:gpc-system\", \"system:authenticated\" ] } |\n| Target (Fields and values that call the API)         | requestURI objectRef                | For example, \"requestURI\": \"/apis/logging.gdc.goog/v1/namespaces/obs-system/loggingrules/lr-cfg1\", \"objectRef\": { \"uid\": \"2e540720-ed23-4665-8c40-c399cb6be624\", \"namespace\": \"obs-system\", \"name\": \"lr-cfg1\", \"resource\": \"loggingrules\", \"apiVersion\": \"v1\", \"apiGroup\": \"logging.gdc.goog\", \"resourceVersion\": \"5326570\" }                              |\n| Action (Fields containing the performed operation)        | verb                    | Possible values: \"verb\": \"create\" \"verb\": \"delete\" \"verb\": \"get\" \"verb\": \"list\" \"verb\": \"patch\" \"verb\": \"update\" \"verb\": \"watch\"                                                                               |\n| Event timestamp                | requestReceivedTimestamp               | For example, \"requestReceivedTimestamp\": \"2022-12-06T14:37:41.035715Z\"                                                                                             |\n| Source of action                | sourceIPs _gdch_service_name              | For example, \"sourceIPs\": [ \"10.253.164.209\" ], \"_gdch_service_name\": \"apiserver\"                                                                                          |\n| Outcome                  | responseStatus                 | For example, \"responseStatus\": { \"metadata\": {}, \"code\": 200 }                                                                                               |\n| Other fields                 | Not applicable                 | Not applicable                                                                                                           |\n**Example log**\n```\n{\u00a0 \"level\": \"Metadata\",\u00a0 \"auditID\": \"94c2106f-1fd1-428b-adbc-80ac48ef479e\",\u00a0 \"_gdch_cluster\": \"org-1-admin\",\u00a0 \"requestURI\": \"/apis/logging.gdc.goog/v1/namespaces/obs-system/loggingrules/lr-cfg1\",\u00a0 \"_gdch_fluentbit_pod\": \"anthos-audit-logs-forwarder-4gwpn\",\u00a0 \"verb\": \"update\",\u00a0 \"userAgent\": \"fleet-admin-cm/v0.0.0 (linux/amd64) kubernetes/$Format\",\u00a0 \"responseStatus\": {\u00a0 \u00a0 \"metadata\": {},\u00a0 \u00a0 \"code\": 200\u00a0 },\u00a0 \"user\": {\u00a0 \u00a0 \"extra\": {\u00a0 \u00a0 \u00a0 \"authentication.kubernetes.io/pod-name\": [\u00a0 \u00a0 \u00a0 \u00a0 \"fleet-admin-controller-875778d98-99l6n\"\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \"authentication.kubernetes.io/pod-uid\": [\u00a0 \u00a0 \u00a0 \u00a0 \"4800e06c-c96d-4e17-ae1a-b5a74eedf6ee\"\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 },\u00a0 \u00a0 \"uid\": \"b18e586e-db0e-417e-9dff-1a722ab36bf4\",\u00a0 \u00a0 \"username\": \"system:serviceaccount:gpc-system:fleet-admin-controller\",\u00a0 \u00a0 \"groups\": [\u00a0 \u00a0 \u00a0 \"system:serviceaccounts\",\u00a0 \u00a0 \u00a0 \"system:serviceaccounts:gpc-system\",\u00a0 \u00a0 \u00a0 \"system:authenticated\"\u00a0 \u00a0 ]\u00a0 },\u00a0 \"annotations\": {\u00a0 \u00a0 \"authorization.k8s.io/decision\": \"allow\",\u00a0 \u00a0 \"authorization.k8s.io/reason\": \"RBAC: allowed by ClusterRoleBinding \\\"fleet-admin-common-controller\\\" of ClusterRole \\\"fleet-admin-common-controllers-role\\\" to ServiceAccount \\\"fleet-admin-controller/gpc-system\\\"\"\u00a0 },\u00a0 \"sourceIPs\": [\u00a0 \u00a0 \"10.253.164.209\"\u00a0 ],\u00a0 \"stage\": \"ResponseComplete\",\u00a0 \"kind\": \"Event\",\u00a0 \"apiVersion\": \"audit.k8s.io/v1\",\u00a0 \"stageTimestamp\": \"2022-12-06T14:37:41.035715Z\",\u00a0 \"objectRef\": {\u00a0 \u00a0 \"uid\": \"2e540720-ed23-4665-8c40-c399cb6be624\",\u00a0 \u00a0 \"namespace\": \"obs-system\",\u00a0 \u00a0 \"name\": \"lr-cfg1\",\u00a0 \u00a0 \"resource\": \"loggingrules\",\u00a0 \u00a0 \"apiVersion\": \"v1\",\u00a0 \u00a0 \"apiGroup\": \"logging.gdc.goog\",\u00a0 \u00a0 \"resourceVersion\": \"5326570\"\u00a0 },\u00a0 \"requestReceivedTimestamp\": \"2022-12-06T14:37:40.942762Z\",\u00a0 \"_gdch_service_name\": \"apiserver\"}\n```", "guide": "Documentation"}