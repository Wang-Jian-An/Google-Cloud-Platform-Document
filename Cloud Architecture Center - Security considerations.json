{"title": "Cloud Architecture Center - Security considerations", "url": "https://cloud.google.com/architecture/reference-patterns/overview", "abstract": "# Cloud Architecture Center - Security considerations\nLast reviewed 2023-08-22 UTC\nThis page provides an overview of security considerations for NFS or SMB access of Cloud Volumes Service.\nFor more information, see [Security overview - NetApp Cloud Volumes Service in Google Cloud](https://docs.netapp.com/us-en/netapp-solutions/ehc/ncvs/ncvs-gc-overview.html) . This technical report from NetApp covers the security architecture of Cloud Volumes Service and the security basics of network file system (NFS) and server message block (SMB) operations.\n", "content": "## Firewall rules\nGoogle Cloud has strict inbound firewall rules that are categorized as default and implied. Every VPC network has two implied firewall rules. Understanding the implied rules help you manage access to the cloud volumes.\n- The **implied allow egress rule** : The rule's action is to`allow`, the destination IP range is`0.0.0.0/0`, and the priority is the lowest possible (`65535`). It lets any instance send traffic to any destination. You can restrict outbound access with a firewall rule that has a higher priority. Internet access is permitted if no other firewall rules deny the outbound traffic and if the instance has an external IP address or uses a NAT instance. See [Internet access requirements](/vpc/docs/vpc#internet_access_reqs) for more details.\n- The **implied deny ingress rule** : The rule's action is to`deny`, the source is`0.0.0.0/0`, and the priority is the lowest possible (`65535`). It protects all instances by blocking incoming traffic to them. You can permit incoming access with a firewall rule that has a higher priority. Note that the default network includes some [additional rules](/vpc/docs/firewalls#more_rules_default_vpc) that override this rule to permit certain types of incoming traffic.\n### NFS access\nNFS uses various ports to communicate between the initiator and a target. To ensure proper communication and successful volume mount, you must enable these ports on the VPC firewalls. If you have a local firewall enabled, you must also enable these ports on the compute instance. The required ports are as follows:\n- `111 TCP/UDP portmapper`\n- `2049 TCP/UDP nfsd`\n- `635 TCP/UDP mountd`\n- `4045 TCP/UDP nlockmgr`\n- `4046 TCP/UDP status`\nVolumes of the CVS service type don't support NFS traffic over UDP.\n### SMB access\nSMB uses various ports to communicate between the initiator and a target. To ensure proper communication and successful volume mapping, you must enable these ports on the VPC firewalls. If you have a local firewall enabled, you must also enable these ports on the compute instance. The required ports are as follows:\n- `135 TCP msrpc`\n- `445 TCP SMB2/3`\n- `40001 TCP SMB witness`\nPort 135/TCP and 40001/TCP are only used for Witness protocol communication for SMB 3.x continuously available (CA) shares. These ports are not required for non-CA shares.\nPort 139/TCP is exposed by the service, but not used.\n### Communication between Cloud Volumes Service and Active Directory\nGoogle Cloud has strict inbound firewall rules that are categorized as default and implied. Every VPC network has two implied firewall rules. Understanding the implied rules help you manage access to the cloud volumes.\n- The **implied allow egress rule** : The rule's action is to`allow`, the destination IP range is`0.0.0.0/0`, and the priority is the lowest possible (`65535`). It lets any instance send traffic to any destination. You can restrict outbound access with a firewall rule that has a higher priority. Internet access is permitted if no other firewall rules deny the outbound traffic and if the instance has an external IP address or uses a NAT instance. See [Internet access requirements](/vpc/docs/vpc#internet_access_reqs) for more details.\n- The **implied deny ingress rule** : The rule's action is to`deny`, the source is`0.0.0.0/0`, and the priority is the lowest possible (`65535`). It protects all instances by blocking incoming traffic to them. You can permit incoming access with a firewall rule that has a higher priority. Note that the default network includes some [additional rules](/vpc/docs/firewalls#more_rules_default_vpc) that override this rule to permit certain types of incoming traffic.\nYou must create a set of inbound rules to enable Cloud Volumes Service to initiate communication with the AD domain controllers. You must add these rules to the security groups that are attached to each AD instance to enable inbound communication from the storage subnet CIDR or the specific IP address. You must open these required ports with firewall rules to enable the CIDR range to access Cloud Volumes Service.\nThe required ports are as follows:\n- `ICMPV4`\n- `DNS 53 TCP`\n- `DNS 53 UDP`\n- `LDAP 389 TCP`\n- `LDAP 389 UDP`\n- `LDAP (GC) 3268 TCP`\n- `SAM/LSA 445 TCP`\n- `SAM/LSA 445 UDP`\n- `Secure LDAP 636 TCP`\n- `Secure LDAP 3269 TCP`\n- `W32Time 123 UDP`\n- `AD Web Svc 9389 TCP`\n- `Kerberos 464 TCP`\n- `Kerberos 464 UDP`\n- `Kerberos 88 TCP`\n- `Kerberos 88 UDP`\nNetApp Cloud Volumes Service for Google Cloud supports Netlogon RPC Sealing, see [Microsoft Security Vulnerability CVE-2022-38023](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-38023) .\n## Permissions for Cloud Volumes Service\nCloud Volumes Service uses Identity and Access Management (IAM) to control access to resources.\nPermissions are granted by the role selected for the user. By granting a role, you grant the user the permissions contained in the role. The two predefined roles are `netappcloudvolumes.admin` and `netappcloudvolumes.viewer` . You can assign these roles to specific users or service accounts.\nCloud Volumes Service supports a granular set of permissions.\n- `netappcloudvolumes.admin` : This role contains all permissions.\n- `netappcloudvolumes.viewer` : This role contains read-only permissions.\nPermissions can be added to Google Cloud [Identity and Access Management custom roles](/iam/docs/understanding-custom-roles) .\nCloud Volumes Service supports a granular set of permissions. These granular permissions are combined into two predefined roles, and these permissions can be added to Google Cloud [IAM custom roles](/iam/docs/understanding-custom-roles) .\nTo learn more, refer to permissions and roles in the [IAM overview](/iam/docs/overview#permissions) .\nAll granular permissions are listed below:\n- `cloudvolumesgcp-api.netapp.com/activeDirectories.create`\n- `cloudvolumesgcp-api.netapp.com/activeDirectories.delete`\n- `cloudvolumesgcp-api.netapp.com/activeDirectories.get`\n- `cloudvolumesgcp-api.netapp.com/activeDirectories.list`\n- `cloudvolumesgcp-api.netapp.com/activeDirectories.update`\n- `cloudvolumesgcp-api.netapp.com/ipRanges.list`\n- `cloudvolumesgcp-api.netapp.com/jobs.get`\n- `cloudvolumesgcp-api.netapp.com/jobs.list`\n- `cloudvolumesgcp-api.netapp.com/regions.list`\n- `cloudvolumesgcp-api.netapp.com/serviceLevels.list`\n- `cloudvolumesgcp-api.netapp.com/snapshots.create`\n- `cloudvolumesgcp-api.netapp.com/snapshots.delete`\n- `cloudvolumesgcp-api.netapp.com/snapshots.get`\n- `cloudvolumesgcp-api.netapp.com/snapshots.list`\n- `cloudvolumesgcp-api.netapp.com/snapshots.update`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.authorize`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.break`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.create`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.delete`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.get`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.list`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.release`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.resync`\n- `cloudvolumesgcp-api.netapp.com/volumereplication.update`\n- `cloudvolumesgcp-api.netapp.com/volumes.create`\n- `cloudvolumesgcp-api.netapp.com/volumes.delete`\n- `cloudvolumesgcp-api.netapp.com/volumes.get`\n- `cloudvolumesgcp-api.netapp.com/volumes.list`\n- `cloudvolumesgcp-api.netapp.com/volumes.update`\n- `resourcemanager.projects.get`\n- `resourcemanager.projects.list`\n### Add Cloud Volumes Service roles to a user\nTo grant a user the `netappcloudvolumes.admin` role, use the following command, substituting the appropriate user name and project ID for `myuser@myorg.com` and `my-project` .\n```\ngcloud projects add-iam-policy-binding my-project \\\u00a0 \u00a0 --member='user:myuser@myorg.com' \\\u00a0 \u00a0 --role='roles/netappcloudvolumes.admin'\n```\nTo grant a user the `netappcloudvolumes.viewer` role, use the following command, substituting the appropriate user name and project ID for `myuser@myorg.com` and `my-project` .\n```\ngcloud projects add-iam-policy-binding my-project \\\u00a0 \u00a0 --member='user:myuser@myorg.com' \\\u00a0 \u00a0 --role='roles/netappcloudvolumes.viewer'\n```\n### Add Cloud Volumes Service permissions to a Google Cloud IAM custom role\nTo grant specific permissions to a user, you need to configure a Google Cloud IAM custom role, assign specific CVS permissions to the role, and then add the custom role to one or more users.\n- If a custom IAM role is already configured, you can skip this step.Configure a Google Cloud IAM custom role using the [Cloud console](/iam/docs/creating-custom-roles#creating) or the [Cloud Shell commands](/iam/docs/reference/rest) .\n- Assign specific CVS permissions to the custom role:- While viewing the role details, select **Edit role** from the top menu.\n- On the **Edit role** page, click **Add permissions** .\n- In the filter, enter`netapp`to see the list of permissions specific to Cloud Volumes Service.\n- Select the checkbox for permissions that you want to add to the role.\n- Click **Add** .\n- Add the IAM custom role to a user:- Select **IAM** from the left navigation menu and select the user you want to update.\n- Click the **Edit member** button.\n- On the **Edit permissions** page, add the custom role created in the previous step.\n- Click **Save** .", "guide": "Cloud Architecture Center"}