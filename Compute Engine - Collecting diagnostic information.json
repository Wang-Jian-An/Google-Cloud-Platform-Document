{"title": "Compute Engine - Collecting diagnostic information", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Collecting diagnostic information\nThis document describes how to collect information about a virtual machine (VM) instance by using a diagnostic tool. Use the information that the tools collects to help with basic troubleshooting before contacting [Support](/compute/docs/support) .\nThe tool does the following:\n- Collects information only from the VM that you specify.\n- Stores the information only in your project.\n- Stores the information for 10 days in a [Cloud Storagebucket](/storage/docs/creating-buckets) , which, by default, only you can access.\nBefore sharing the collected information with Google Support, do the following:\n- Review the information for confidential or personally identifiable information (PII).\n- Delete or mask the information as necessary.", "content": "## Diagnostic information collected from the VM\nThis diagnostic tool collects information about the following:\n- **Disks** :- [Windows Management Instrumentation(WMI)](https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page) object information about [disks](https://learn.microsoft.com/en-us/windows-hardware/drivers/storage/msft-disk) , [partitions](https://learn.microsoft.com/en-us/windows-hardware/drivers/storage/msft-partition) , and [volumes](https://learn.microsoft.com/en-us/windows-hardware/drivers/storage/msft-volume) \n- **Events** :- [Windows Events](https://docs.microsoft.com/en-us/windows/win32/events/windows-events?redirectedfrom=MSDN) , including application events and system events\n- **Networks** :- WMI object information about [firewall rules](https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/jj676843(v%3Dvs.85)) , and output from [ipconfig](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/ipconfig) , [netstat](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/netstat) , [nslookup](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/nslookup) , [ping](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/ping) , [route](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/route_ws2008) , and [tracert](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/tracert) \n- **Programs** :- WMI object information about [processes](https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-process) , [scheduled tasks](https://docs.microsoft.com/en-us/powershell/module/scheduledtasks/get-scheduledtask?view=win10-ps) , [services](https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-service) , and [Google Kubernetes Engine (GKE)](https://cloud.google.com/kubernetes-engine/docs/concepts/windows-server-gke) \n- **System** :- WMI object information about [users](https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-useraccount) , Remote Desktop Protocol (RDP) settings by using [this script](https://github.com/GoogleCloudPlatform/compute-image-tools/blob/master/cli_tools/diagnostics/rdp_status.ps1) , and output from [bcdedit](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/bcdedit) , [driverquery](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/driverquery) , [msinfo32](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msinfo32) , [pnputil](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/pnputil) , and [systeminfo](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/systeminfo) , and [memory dump](https://docs.microsoft.com/en-us/troubleshoot/windows-server/performance/memory-dump-file-options) logsFor detailed information about how Compute Engine collects this information, see the [public repository](https://github.com/GoogleCloudPlatform/compute-image-tools/tree/master/cli_tools/diagnostics) .\n## Limitations\n- You can only collect diagnostic information from VMs created based on Windows Server.## Before you begin\n- Compute Engine installs the diagnostic tool by default on public versions of Windows Server images later than`v20190714`. Otherwise, if your Windows Server image version is earlier than`v20190714`, or you are using a custom image, install the tool by using the`googet install google-compute-engine-diagnostics`command.\n- If you haven't already, set up authentication. [Authentication](/compute/docs/authentication) is the process by which your identity is verified for access to Google Cloud services and APIs. To run code or samples from a local development environment, you can authenticate to Compute Engine as follows.Select the tab for how you plan to use the samples on this page:\nWhen you use the Google Cloud console to access Google Cloud services and   APIs, you don't need to set up authentication.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:```\ngcloud init\n``` **Note:** If you installed the gcloud CLI  previously, make sure you have the latest version by running`gcloud components  update`.\n- [ Set a default region and zone](/compute/docs/gcloud-compute#set_default_zone_and_region_in_your_local_client) .\nTo use the REST API samples on this page in a local development environment, you use the credentials you provide to the gcloud CLI.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:\n- ```\ngcloud init\n```## Collecting diagnostic information from a VM\nRun the diagnostic tool either directly from the VM, or remotely, by using the Google Cloud CLI. On Windows-based VMs, find the diagnostic tool in the `C:\\Program Files\\Google\\Compute Engine\\diagnostics` directory.\nTo perform this task, you must have the following [permissions](/iam/docs/overview#permissions) :\n- `roles/iam.serviceAccountTokenCreator`on the project\n- Grant the `iam.serviceAccountTokenCreator` role on the project:```\ngcloud projects add-iam-policy-binding PROJECT_ID \\\n --member user:EMAIL \\\n --role roles/iam.serviceAccountTokenCreator\n```Replace the following:- ``: the project ID\n- ``: the email address to grant the`iam.serviceAccountTokenCreator`role\n- Export the diagnostic information as an object to a Cloud Storage bucket.```\ngcloud compute diagnose export-logs VM_NAME \\\n [--collect-process-traces]\n```The optional `--collect-process-traces` flag specifies whether the diagnostic tool collects a 10 minute trace of the running system, which includes CPU, disk, file, and network activity. On Windows-based VMs, this uses the [Windows PerformanceRecorder](https://docs.microsoft.com/en-us/windows-hardware/test/wpt/windows-performance-recorder) .Replace the following:- ``: name of the VM to collect diagnostic information from\n- The log exporting process might take a few minutes to complete. View the status by using the [gcloud compute instances get-serial-port-outputcommand](/sdk/gcloud/reference/compute/instances/get-serial-port-output) .\n- Compute Engine formats the name of the bucket containing the diagnostic information as `diagnostic_logs_project_` `` . View or download the bucket by using the [gsutiltool](/storage/docs/gsutil) , or, in the Google Cloud console, from the **Cloud Storage** page: [Go to Storage](https://console.cloud.google.com/storage) ## What's next\n- Learn how to [capture screenshots from VMs](/compute/docs/instances/capturing-vm-screenshots) .\n- Learn how to [Troubleshoot Windowsinstances](/compute/docs/troubleshooting/troubleshooting-windows) .\n- Learn how to [Troubleshoot RDP](/compute/docs/troubleshooting/troubleshooting-rdp) .", "guide": "Compute Engine"}