{"title": "Google Kubernetes Engine (GKE) - Auto-upgrading nodes", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview", "abstract": "# Google Kubernetes Engine (GKE) - Auto-upgrading nodes\nThis page shows you how to configure node auto-upgrades in Google Kubernetes Engine (GKE).\n**Note:** For GKE Autopilot clusters, node auto-upgrades are enabled by default and cannot be overridden.\n", "content": "## Overview\nhelp you keep the [nodes](/kubernetes-engine/docs/concepts/cluster-architecture#nodes) in your [cluster](/kubernetes-engine/docs/concepts/cluster-architecture) up-to-date with the cluster control plane version when your control plane is [updated on your behalf](/kubernetes-engine/upgrades#automatic_cp_upgrades) . When you create a new cluster or node pool with the Google Cloud console or the `gcloud` command, node auto-upgrade is enabled by default.\nYou can learn more about [cluster and node upgrades](/kubernetes-engine/docs/concepts/cluster-upgrades) .\nNode auto-upgrades provide several benefits:\n- **Lower management overhead:** You don't have to manually track and update your nodes when the control plane is upgraded on your behalf.\n- **Better security:** Sometimes new binaries are released to fix a security issue. With auto-upgrades, GKE automatically ensures that security updates are applied and kept up to date.\n- **Ease of use:** Provides a simple way to keep your nodes up to date with the latest Kubernetes features.\nNode pools with auto-upgrades enabled are scheduled for upgrades when they meet the selection criteria (announced in the [release notes](/kubernetes-engine/docs/release-notes) ). Rollouts are phased across multiple weeks to ensure cluster and fleet stability. When the upgrade is performed, nodes are drained and re-created to match the current control plane version. Modifications on the boot disk of a node VM do not persist across node re-creations. To preserve modifications across node re-creation, use a [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) .\nNode auto-upgrade is not available for [Alpha clusters](/kubernetes-engine/docs/concepts/alpha-clusters) . If you are using a cluster with Windows Server node pools, review [Upgrading Windows Server node pools](/kubernetes-engine/docs/how-to/creating-a-cluster-windows#upgrading_windows_server_node_pools) before enabling node auto-upgrade.\n**Note:** Enabling auto-upgrades does not cause your nodes to upgrade immediately. For more information, see [Cluster and node upgrades](/kubernetes-engine/docs/concepts/cluster-upgrades#node_pool_upgrades) .\n## Check the state of auto-upgrade for an existing node pool\nYou can check whether auto-upgrade is enabled or disabled for a node pool using the Google Cloud console or the `gcloud` command.\nTo check the state of auto-upgrade for a node pool, run the following command:\n```\ngcloud container node-pools describe NODE_POOL_NAME \\\u00a0 --cluster CLUSTER_NAME \\\u00a0 --zone COMPUTE_ZONE\n```\nReplace the following:- ``: the name of the node pool.\n- ``: the name of the cluster that contains the node pool.\n- ``: the [compute zone](/compute/docs/regions-zones#available) for the cluster.\nTo check the state of auto-upgrade for a node pool, perform the following:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to view.\n- Click the **Nodes** tab.\n- Under **Node Pools** , click the name of the node pool you want to view.\n- On the **Node pool details** page, under **Management** , view the value of the **Auto-upgrade** field.## Enable node auto-upgrades for an existing node pool\nWhen you create a new cluster with the Google Cloud console or the `gcloud` command, node auto-upgrade is enabled by default.\nYou can enable node auto-upgrade if it is currently disabled.\nTo enable auto-upgrades for an existing node pool, run the following command:\n```\ngcloud container node-pools update NODE_POOL_NAME \\\u00a0 \u00a0 --cluster CLUSTER_NAME \\\u00a0 \u00a0 --zone COMPUTE_ZONE \\\u00a0 \u00a0 --enable-autoupgrade\n```\nReplace the following:- ``: the name of the node pool.\n- ``: the name of the cluster that contains the node pool.\n- ``: the [compute zone](/compute/docs/regions-zones#available) for the cluster.\nTo enable auto-upgrades for an existing node pool, perform the following steps:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- Click the **Nodes** tab.\n- Under **Node Pools** , click the name of the node pool you want to modify.\n- On the **Node pool details** page, click **Edit** .\n- Under **Management** , select the **Enable auto-upgrade** checkbox.\n- Click **Save** .\nFor more control over when nodes can be auto-upgraded, consider configuring [maintenance windows and exclusions](/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions) .\n## Check the status of node upgrades\nYou can check the status of an upgrade using [gcloud container operations](/sdk/gcloud/reference/container/operations) .\nView a list of every running and completed operation in the cluster:\n```\ngcloud container operations list\n```\nEach operation is assigned an and an operation type as well as start and end times, target cluster, and status. The list appears similar to the following example:\n```\nNAME        TYPE    ZONE   TARGET    STATUS_MESSAGE STATUS START_TIME      END_TIME\noperation-1505407677851-8039e369 CREATE_CLUSTER  us-west1-a  my-cluster       DONE 20xx-xx-xxT16:47:57.851933021Z 20xx-xx-xxT16:50:52.898305883Z\noperation-1505500805136-e7c64af4 UPGRADE_CLUSTER  us-west1-a  my-cluster       DONE 20xx-xx-xxT18:40:05.136739989Z 20xx-xx-xxT18:41:09.321483832Z\noperation-1505500913918-5802c989 DELETE_CLUSTER  us-west1-a  my-cluster       DONE 20xx-xx-xxT18:41:53.918825764Z 20xx-xx-xxT18:43:48.639506814Z\n```\nTo get more information about a specific operation, specify the operation ID as shown in the following command:\n```\ngcloud container operations describe OPERATION_ID\n```\nFor example:\n```\ngcloud container operations describe operation-1507325726639-981f0ed6\nendTime: '20xx-xx-xxT21:40:05.324124385Z'\nname: operation-1507325726639-981f0ed6\noperationType: UPGRADE_CLUSTER\nselfLink: https://container.googleapis.com/v1/projects/.../kubernetes-engine/docs/zones/us-central1-a/operations/operation-1507325726639-981f0ed6\nstartTime: '20xx-xx-xxT21:35:26.639453776Z'\nstatus: DONE\ntargetLink: https://container.googleapis.com/v1/projects/.../kubernetes-engine/docs/zones/us-central1-a/clusters/...\nzone: us-central1-a\n```\n## Check node pool upgrade settings\nYou can see details on the node upgrade strategy being used for your node pools using the [gcloud container node-poolsdescribe](/sdk/gcloud/reference/container/node-pools/describe) command. For blue-green upgrades, the command also returns the [currentphase](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#phases-of-blue-green-upgrades) of the upgrade.\nRun the following command:\n```\ngcloud container node-pools describe NODE_POOL_NAME \\--cluster=CLUSTER_NAME\n```\nReplace the following:\n- ``: the name of the node pool to describe.\n- ``: the name of the cluster of the node pool to describe.\nThis command will output the current upgrade settings. The following example shows the output if you are using the blue-green upgrade strategy.\n```\nupgradeSettings:\n blueGreenSettings:\n nodePoolSoakDuration: 1800s\n standardRolloutPolicy:\n  batchNodeCount: 1\n  batchSoakDuration: 10s\n strategy: BLUE_GREEN\n```\nIf you are using the blue-green upgrade strategy, the output also includes details about the blue-green upgrade settings and its current intermediate phase. The following example shows what this might look like:\n```\nupdateInfo:\n blueGreenInfo:\n blueInstanceGroupUrls:\n - https://www.googleapis.com/compute/v1/projects/{PROJECT_ID}/zones/{LOCATION}/instanceGroupManagers/{BLUE_INSTANCE_GROUP_NAME}\n bluePoolDeletionStartTime: {BLUE_POOL_DELETION_TIME}\n greenInstanceGroupUrls:\n - https://www.googleapis.com/compute/v1/projects/{PROJECT_ID}/zones/{LOCATION}/instanceGroupManagers/{GREEN_INSTANCE_GROUP_NAME} \n greenPoolVersion: {GREEN_POOL_VERSION}\n phase: DRAINING_BLUE_POOL\n```\n## Disable node auto-upgrades for an existing node pool\nAlthough not recommended, you can disable node auto-upgrade for an existing node pool if the underlying cluster is not currently enrolled in a [releasechannel](/kubernetes-engine/docs/concepts/release-channels) .\n### Considerations before disabling node auto-upgrades\nIf you disable node auto-upgrades for a node pool, GKE does not update the version of the nodes. Opting out of node auto-upgrades does not block GKE from upgrading your cluster's control plane.\nDisabling node auto-upgrades only prevents GKE from updating the version of the nodes, but does not prevent GKE from initiating other maintenance tasks. For example, even with node auto-upgrades disabled, triggering [IP address rotation](/kubernetes-engine/docs/how-to/ip-rotation) , [enabling network policy](/kubernetes-engine/docs/how-to/network-policy) , or [PSC migration](/kubernetes-engine/docs/release-notes#December_12_2022) on a cluster recreates all nodes at the same version as the control plane, regardless of the version selected for the node pool. To control the timing of maintenance, use [Maintenance windows andexclusions](/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions) .\nIf you disable node auto-upgrade, you are responsible for ensuring that the cluster's nodes run a version compatible with the cluster's version, and that the version adheres to the [Kubernetes version and version skew support policy](https://kubernetes.io/docs/setup/release/version-skew-policy/) . Starting with GKE version 1.19, GKE upgrades nodes that are running an unsupported version after the version has reached end of life to ensure cluster health and alignment with [the open source version skew policy](https://kubernetes.io/releases/version-skew-policy/) . Nodes running unsupported versions might not be upgraded immediately upon version end of life, and actual timing can vary at Google's discretion.\nDisabling node auto-upgrades does not stop or cancel any ongoing upgrades to nodes in node pools. To cancel or stop ongoing upgrades, follow [Cancelling a node upgrade](/kubernetes-engine/docs/how-to/upgrading-a-cluster#cancel) . Canceling a node upgrade can be helpful in situations where you find workloads are failing on upgraded nodes and you want to prevent further disruption.\nIf the upgrade is fully completed for the entire node pool, then the upgrade cannot be rolled back or cancelled. To downgrade the node pool, see [Downgradingnodepools](/kubernetes-engine/docs/how-to/upgrading-a-cluster#downgrading_nodes) .\n### Disable node auto-upgrades for an existing node pool\nTo disable auto-upgrades for an existing node pool, run the following command:\n```\ngcloud container node-pools update NODE_POOL_NAME \\\u00a0 \u00a0 --cluster CLUSTER_NAME \\\u00a0 \u00a0 --zone COMPUTE_ZONE \\\u00a0 \u00a0 --no-enable-autoupgrade\n```\nTo disable auto-upgrades for an existing node pool, perform the following steps:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- Click the **Nodes** tab.\n- Under **Node Pools** , click the name of the node pool you want to modify.\n- On the **Node pool details** page, click **Edit** .\n- Under **Management** , clear the **Enable auto-upgrade** checkbox.\n- Click **Save** to modify the cluster.## Create a cluster or node pool with node auto-upgrades enabled\nTo create a cluster with auto-upgrades enabled , specify the `--enable-autoupgrade` flag in the `gcloud container clusters create` command:\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --zone COMPUTE_ZONE \\\u00a0 \u00a0 --enable-autoupgrade\n```\n **Note:** By default, subsequent node pools do not have auto-upgrades enabled.\nTo create a node pool with auto-upgrade enabled specify the `--enable-autoupgrade` flag in the `gcloud container node-pools create` command:\n```\ngcloud container node-pools create NODE_POOL_NAME \\\u00a0 \u00a0 --cluster CLUSTER_NAME \\\u00a0 \u00a0 --zone COMPUTE_ZONE \\\u00a0 \u00a0 --enable-autoupgrade\n```\nClusters and node pools created with the Google Cloud console have auto-upgrades enabled by default. Visit [Creating a cluster](/kubernetes-engine/docs/how-to/creating-a-zonal-cluster) or [Addingand managing node pools](/kubernetes-engine/docs/how-to/node-pools) for instructions to create clusters and node pools.\nYou can disable auto-upgrades for new node pools. From the cluster creation page, click the name of the node pool you want to modify, then clear **Enable auto-upgrade** .\n## Receive upgrade notifications\nGKE publishes upgrade notifications to [Pub/Sub](/pubsub/docs/overview) , providing you with a channel to receive information from GKE about your clusters.\nFor more information, see [Receiving cluster upgrade notifications](/kubernetes-engine/docs/how-to/cluster-upgrade-notifications) .\n### Change surge upgrade parameters\nTo learn more about changing surge upgrade parameters, see [Configure surge upgrades](/kubernetes-engine/docs/how-to/node-pool-upgrade-strategies#surge) .\n## Exercise control during a node pool upgrade\nDuring automatic upgrades and manually-initiated node pool upgrades, you can take the following actions.\n### Cancel a node pool upgrade\nYou can cancel an upgrade at any time. To learn more about what happens when you cancel a surge upgrade, see [Cancel a surge upgrade](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#cancel-a-surge-upgrade) . To learn more about what happens when you cancel a blue-green upgrade, see [Cancel a blue-green upgrade](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#cancel-a-blue-green-upgrade) .\n- Get the upgrade's operation ID:```\ngcloud container operations list\n```\n- Cancel the upgrade:```\ngcloud container operations cancel OPERATION_ID\n```\nRefer to the [gcloud container operations cancel](/sdk/gcloud/reference/container/operations/cancel) documentation.\n### Resume a node pool upgrade\nYou can resume an upgrade by [manually initiating the upgrade](#upgrading-nodes) again, specifying the target version from the original upgrade.\nFor example, if you paused an ongoing upgrade to version 1.23.1-gke.100, you could resume the canceled upgrade by starting the same upgrade again on the node pool, targeting version 1.23.1-gke.100.\nTo learn more about what happens when you resume an upgrade, see [Resume a surge upgrade](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#resume-a-surge-upgrade) and [blue-green upgrade](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#resume-a-blue-green-upgrade) .\nTo resume an upgrade, use the following command:\n```\n\u00a0 \u00a0 gcloud container clusters upgrade CLUSTER_NAME \\\u00a0 \u00a0 \u00a0 --node-pool=NODE_POOL_NAME \\\u00a0 \u00a0 \u00a0 --cluster-version VERSION\n```\nReplace the following:\n- ``: the name of the node pool for which you want to resume the node pool upgrade.\n- ``: the name of the cluster of the node pool for which you want to resume the upgrade.\n- ``: the target version of the canceled node pool upgrade.\nFor more information, refer to the [gcloud container clusters upgrade](/sdk/gcloud/reference/container/clusters/upgrade) documentation.\n### Roll back a node pool upgrade\nYou can roll back a node pool to downgrade the upgraded nodes to their original state from before the node pool upgrade started.\nUse the `rollback` command if an in-progress upgrade was [cancelled](/kubernetes-engine/docs/how-to/node-auto-upgrades#cancel) , the upgrade failed, or the upgrade is incomplete due to a [maintenance window](/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions#maintenance_windows) timing out. Alternatively, if you want to specify the version, follow the instructions to [downgrade](/kubernetes-engine/docs/how-to/upgrading-a-cluster#downgrading_nodes) the node pool.\n**Note:** You cannot roll back node pools once they have been successfully upgraded. You must [downgrade](/kubernetes-engine/docs/how-to/upgrading-a-cluster#downgrading_nodes) the node pool if you need the nodes to be on the previous version.\nTo learn more about what happens when you roll back a node pool upgrade, see [Roll back a surge upgrade](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#rollback-a-surge-upgrade) or [Roll back a blue-green upgrade](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#rollback-a-blue-green-upgrade) .\nTo roll back an upgrade, run the following command:\n```\ngcloud container node-pools rollback NODE_POOL_NAME \\\u00a0 --cluster CLUSTER_NAME\n```\nReplace the following:\n- ``: the name of the node pool for which to to roll back the node pool upgrade.\n- ``: the name of the cluster of the node pool for which to roll back the upgrade.\nRefer to the [gcloud container node-pools rollback](/sdk/gcloud/reference/container/node-pools/rollback) documentation.\n### Complete a node pool upgrade\n**Warning:** Using the `complete-upgrade` command is only possible with [blue-green upgrades](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#blue-green-upgrade-strategy) .\nIf you are using the blue-green upgrade strategy, you can complete a node pool upgrade during the [Soak phase](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#bg-phase-soak-node-pool) , skipping the rest of the soak time.\nTo learn how completing a node pool upgrade works, see [Complete a node pool upgrade](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#complete-a-blue-green-upgrade) .\nTo complete an upgrade when using the blue-green upgrade strategy, run the following command:\n```\ngcloud container node-pools complete-upgrade NODE_POOL_NAME \\\u00a0 --cluster CLUSTER_NAME\n```\nReplace the following:\n- ``: the name of the node pool for which you want to complete the upgrade.\n- ``: the name of the cluster of the node pool for which you want to complete the upgrade.\nRefer to the [gcloud container node-pools complete-upgrade](/sdk/gcloud/reference/container/node-pools/complete-upgrade) documentation.\n## What's next\n- Learn more about [node pools](/kubernetes-engine/docs/concepts/node-pools) .\n- Learn more about [cluster and node pool upgrades](/kubernetes-engine/docs/concepts/cluster-upgrades) .\n- [Manually upgrade a cluster or node pool](/kubernetes-engine/docs/how-to/upgrading-a-cluster) .", "guide": "Google Kubernetes Engine (GKE)"}