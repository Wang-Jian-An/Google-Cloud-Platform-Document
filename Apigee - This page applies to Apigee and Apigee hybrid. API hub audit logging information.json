{"title": "Apigee - This page applies to Apigee and Apigee hybrid. API hub audit logging information", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - This page applies to Apigee and Apigee hybrid. API hub audit logging information\n**    Preview     ** This product or feature is subject to the \"Pre-GA Offerings Terms\" in the General Service Terms section   of the [Service Specific Terms](/terms/service-terms#1) .     Pre-GA products and features are available \"as is\" and might have limited support.    For more information, see the [launch stage descriptions](/products#product-launch-stages) .\n**Note:** For preview releases, follow the instructions in [Configure Data Access audit logs with the API](/logging/docs/audit/configure-data-access#config-api) to use `SetIamPolicy` to enable Cloud Audit Logging in your projects. Support for enabling this through the UI will be available in a post-public preview release.\nThis document describes the audit logs created by Apigee API hub as part of [Cloud Audit Logs](/logging/docs/audit) .\n", "content": "## Overview\nGoogle Cloud services write audit logs to help you answer the questions, \"Who did what, where, and when?\" within your Google Cloud resources.\nYour Google Cloud projects contain only the audit logs for resources that are directly within the Google Cloud project. Other Google Cloud resources, such as folders, organizations, and billing accounts, contain the audit logs for the entity itself.\nFor a general overview of Cloud Audit Logs, see [Cloud Audit Logs overview](/logging/docs/audit) . For a deeper understanding of the audit log format, see [Understand audit logs](/logging/docs/audit/understanding-audit-logs) .\n## Available audit logs\nThe following types of audit logs are available for API hub:\n- Admin Activity audit logsIncludes \"admin write\" operations that write metadata or configuration   information.You can't disable Admin Activity audit logs.\n- Data Access audit logsIncludes \"admin read\" operations that read metadata or configuration   information.     Also includes \"data read\" and \"data write\" operations that   read or write user-provided data.To receive Data Access audit logs, you must [   explicitly enable](/logging/docs/audit/configure-data-access#config-console-enable) them.\nFor fuller descriptions of the audit log types, see [Types of audit logs](/logging/docs/audit#types) .\n## Audited operations\nThe following table summarizes which API operations correspond to each audit log type in API hub:\n| Audit logs category  | API hub operations                                                                                                                                                                                                                                                                                                                      |\n|:--------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Admin Activity audit logs | google.cloud.apigeeregistry.v1.Provisioning.CreateInstance google.cloud.apigeeregistry.v1.Provisioning.DeleteInstance                                                                                                                                                                                                                                                                                             |\n| Data Access audit logs | google.cloud.apigeeregistry.v1.Provisioning.GetInstance google.cloud.apigeeregistry.v1.Registry.CreateApi google.cloud.apigeeregistry.v1.Registry.UpdateApi google.cloud.apigeeregistry.v1.Registry.DeleteApi google.cloud.apigeeregistry.v1.Registry.CreateApiVersion google.cloud.apigeeregistry.v1.Registry.UpdateApiVersion google.cloud.apigeeregistry.v1.Registry.DeleteApiVersion google.cloud.apigeeregistry.v1.Registry.CreateApiSpec google.cloud.apigeeregistry.v1.Registry.UpdateApiSpec google.cloud.apigeeregistry.v1.Registry.DeleteApiSpec google.cloud.apigeeregistry.v1.Registry.TagApiSpecRevision google.cloud.apigeeregistry.v1.Registry.RollbackApiSpec google.cloud.apigeeregistry.v1.Registry.DeleteApiSpecRevision google.cloud.apigeeregistry.v1.Registry.CreateApiDeployment google.cloud.apigeeregistry.v1.Registry.UpdateApiDeployment google.cloud.apigeeregistry.v1.Registry.DeleteApiDeployment google.cloud.apigeeregistry.v1.Registry.TagApiDeploymentRevision google.cloud.apigeeregistry.v1.Registry.RollbackApiDeployment google.cloud.apigeeregistry.v1.Registry.DeleteApiDeploymentRevision google.cloud.apigeeregistry.v1.Registry.CreateArtifact google.cloud.apigeeregistry.v1.Registry.ReplaceArtifact google.cloud.apigeeregistry.v1.Registry.DeleteArtifact |\n## Audit log format\nAudit log entries include the following objects:\n- The log entry itself, which is an object of type [LogEntry](/logging/docs/reference/v2/rest/v2/LogEntry) . Useful fields include the following:- The`logName`contains the resource ID and audit log type.\n- The`resource`contains the target of the audited operation.\n- The`timeStamp`contains the time of the audited operation.\n- The`protoPayload`contains the audited information.\n- The audit logging data, which is an [AuditLog](/logging/docs/reference/audit/auditlog/rest/Shared.Types/AuditLog) object held in the `protoPayload` field of the log entry.\n- Optional service-specific audit information, which is a service-specific object. For earlier integrations, this object is held in the `serviceData` field of the `AuditLog` object; later integrations use the `metadata` field.\nFor other fields in these objects, and how to interpret them, review [Understand audit logs](/logging/docs/audit/understanding-audit-logs) .\n### Log name\nCloud Audit Logs log names include resource identifiers indicating the Google Cloud project or other Google Cloud entity that owns the audit logs, and whether the log contains Admin Activity, Data Access, Policy Denied, or System Event audit logging data.\nThe following are the audit log names, including variables for the resource identifiers:\n```\n projects/PROJECT_ID/logs/cloudaudit.googleapis.com%2Factivity\n projects/PROJECT_ID/logs/cloudaudit.googleapis.com%2Fdata_access\n projects/PROJECT_ID/logs/cloudaudit.googleapis.com%2Fsystem_event\n projects/PROJECT_ID/logs/cloudaudit.googleapis.com%2Fpolicy\n folders/FOLDER_ID/logs/cloudaudit.googleapis.com%2Factivity\n folders/FOLDER_ID/logs/cloudaudit.googleapis.com%2Fdata_access\n folders/FOLDER_ID/logs/cloudaudit.googleapis.com%2Fsystem_event\n folders/FOLDER_ID/logs/cloudaudit.googleapis.com%2Fpolicy\n billingAccounts/BILLING_ACCOUNT_ID/logs/cloudaudit.googleapis.com%2Factivity\n billingAccounts/BILLING_ACCOUNT_ID/logs/cloudaudit.googleapis.com%2Fdata_access\n billingAccounts/BILLING_ACCOUNT_ID/logs/cloudaudit.googleapis.com%2Fsystem_event\n billingAccounts/BILLING_ACCOUNT_ID/logs/cloudaudit.googleapis.com%2Fpolicy\n organizations/ORGANIZATION_ID/logs/cloudaudit.googleapis.com%2Factivity\n organizations/ORGANIZATION_ID/logs/cloudaudit.googleapis.com%2Fdata_access\n organizations/ORGANIZATION_ID/logs/cloudaudit.googleapis.com%2Fsystem_event\n organizations/ORGANIZATION_ID/logs/cloudaudit.googleapis.com%2Fpolicy\n```\n**Note:** The part of the log name following `/logs/` must be URL-encoded. The forward-slash character, `/` , must be written as `%2F` .\n### Service name\nAPI hub audit logs use the service name `apigeeregistry.googleapis.com` .\nFor a list of all the Cloud Logging API service names and their corresponding monitored resource type, see [Map services to resources](/logging/docs/api/v2/resource-list#service-names) .\n### Resource types\nAPI hub audit logs use the resource type `audited_resource` for all audit logs.\nFor a list of all the Cloud Logging monitored resource types and descriptive information, see [Monitored resource types](/logging/docs/api/v2/resource-list#resource-types) .\n### Caller identities\nThe IP address of the caller is held in the `RequestMetadata.caller_ip` field of the [AuditLog](/logging/docs/reference/audit/auditlog/rest/Shared.Types/AuditLog) object. Logging might redact certain caller identities and IP addresses.\nFor information about what information is redacted in audit logs, see [Caller identities in audit logs](/logging/docs/audit#user-id) .\n## Enable audit logging\nAdmin Activity audit logs are always enabled; you can't disable them.\nData Access audit logs are disabled by default and aren't written unless explicitly enabled (the exception is Data Access audit logs for BigQuery, which can't be disabled).\nFor information about enabling some or all of your Data Access audit logs, see [Enable Data Access audit logs](/logging/docs/audit/configure-data-access) .\n## Permissions and roles\n[IAM](/iam/docs) permissions and roles determine your ability to access audit logs data in Google Cloud resources.\nWhen deciding which [Logging-specific permissions and roles](/logging/docs/access-control#permissions_and_roles) apply to your use case, consider the following:\n- The Logs Viewer role ( `roles/logging.viewer` ) gives you read-only access to Admin Activity, Policy Denied, and System Event audit logs. If you have just this role, you cannot view Data Access audit logs that are in the `_Default` bucket.\n- The Private Logs Viewer role `(roles/logging.privateLogViewer` ) includes the permissions contained in `roles/logging.viewer` , plus the ability to read Data Access audit logs in the `_Default` bucket.Note that if these private logs are stored in user-defined buckets, then any user who has permissions to read logs in those buckets can read the private logs. For more information about log buckets, see [Routing and storage overview](/logging/docs/routing/overview) .\nFor more information about the IAM permissions and roles that apply to audit logs data, see [Access control with IAM](/logging/docs/access-control) .\n## View logs\nYou can query for all audit logs or you can query for logs by their [audit log name](#log_name) . The audit log name includes the [resource identifier](/resource-manager/docs/creating-managing-projects#identifying_projects) of the Google Cloud project, folder, billing account, or organization for which you want to view audit logging information. Your queries can specify indexed [LogEntry](/logging/docs/reference/v2/rest/v2/LogEntry) fields, and if you use the **Log Analytics** page, which supports SQL queries, then you can [view your query results as a chart](/logging/docs/analyze/charts) .\nFor more information about querying your logs, see the following pages:\n- [Build queries in the Logs Explorer](/logging/docs/view/building-queries) .\n- [Query and view logs in Log Analytics](/logging/docs/analyze/query-and-view) .\n- [Sample queries for security insights](/logging/docs/analyze/analyze-audit-logs) .\nIn the Google Cloud console, you can use the Logs Explorer to retrieve your audit log entries for your Google Cloud project, folder, or organization:\n **Note:** You can't view audit logs for Cloud Billing accounts in the Google Cloud console. You must use the API or the gcloud CLI.- In the navigation panel of the Google Cloud console, select **Logging** , and then select **Logs Explorer** : [Go to Logs Explorer](https://console.cloud.google.com/logs/query) \n- Select an existing Google Cloud project, folder, or organization.\n- To display all audit logs, enter either of the following queries into the query-editor field, and then click **Run query** :```\nlogName:\"cloudaudit.googleapis.com\"\n``````\nprotoPayload.\"@type\"=\"type.googleapis.com/google.cloud.audit.AuditLog\"\n```\n- To display the audit logs for a specific resource and audit log type, in the **Query builder** pane, do the following:- In **Resource type** , select the Google Cloud resource whose audit logs you want to see.\n- In **Log name** , select the audit log type that you want to see:- For Admin Activity audit logs, select **activity** .\n- For Data Access audit logs, select **data_access** .\n- For System Event audit logs, select **system_event** .\n- For Policy Denied audit logs, select **policy** .\n- Click **Run query** .\nIf you don't see these options, then there aren't any audit logs of that type available in the Google Cloud project, folder, or organization.If you're experiencing issues when trying to view logs in the Logs Explorer, see the [troubleshooting](/logging/docs/view/logs-explorer-interface#troubleshooting) information.For more information about querying by using the Logs Explorer, see [Build queries in the Logs Explorer](/logging/docs/view/building-queries) . For information about summarizing log entries in the Logs Explorer by using Duet AI, see [Summarize log entries with Duet AI assistance](/logging/docs/view/summarize-log-entries-duet-ai) .\nThe Google Cloud CLI provides a command-line interface to the Logging API. Supply a valid resource identifier in each of the log names. For example, if your query includes a , then the project identifier you supply must refer to the currently selected Google Cloud project.\nTo read your Google Cloud project-level audit log entries, run the following command:\n```\ngcloud logging read \"logName : projects/PROJECT_ID/logs/cloudaudit.googleapis.com\" \\\n --project=PROJECT_ID\n```\nTo read your folder-level audit log entries, run the following command:\n```\ngcloud logging read \"logName : folders/FOLDER_ID/logs/cloudaudit.googleapis.com\" \\\n --folder=FOLDER_ID\n```\nTo read your organization-level audit log entries, run the following command:\n```\ngcloud logging read \"logName : organizations/ORGANIZATION_ID/logs/cloudaudit.googleapis.com\" \\\n --organization=ORGANIZATION_ID\n```\nTo read your Cloud Billing account-level audit log entries, run the following command:\n```\ngcloud logging read \"logName : billingAccounts/BILLING_ACCOUNT_ID/logs/cloudaudit.googleapis.com\" \\\n --billing-account=BILLING_ACCOUNT_ID\n```\nAdd the [--freshness flag](/sdk/gcloud/reference/logging/read#--freshness) to your command to read logs that are more than 1 day old.\nFor more information about using the gcloud CLI, see [gcloud logging read](/sdk/gcloud/reference/logging/read) .\nWhen building your queries, supply a valid resource identifier in each of the log names. For example, if your query includes a , then the project identifier you supply must refer to the currently selected Google Cloud project.\nFor example, to use the Logging API to view your project-level audit log entries, do the following:- Go to the **Try this API** section in the documentation for the [entries.list](/logging/docs/reference/v2/rest/v2/entries/list) method.\n- Put the following into the **Request body** part of the **Try thisAPI** form. Clicking this [prepopulated form](/logging/docs/reference/v2/rest/v2/entries/list?apix_params=%7B%22resource%22%3A%7B%22resourceNames%22%3A%5B%22projects%2F%5BPROJECT_ID%5D%22%5D%2C%22pageSize%22%3A5%2C%22filter%22%3A%22logName%3D(projects%2F%5BPROJECT_ID%5D%2Flogs%2Fcloudaudit.googleapis.com%252Factivity%20OR%20projects%2F%5BPROJECT_ID%5D%2Flogs%2Fcloudaudit.googleapis.com%252Fsystem_events%20OR%20projects%2F%5BPROJECT_ID%5D%2Flogs%2Fcloudaudit.googleapis.com%252Fdata_access)%22%7D%7D) automatically fills the request body, but you need to supply a valid in each of the log names.```\n{\n \"resourceNames\": [ \"projects/PROJECT_ID\"\n ],\n \"pageSize\": 5,\n \"filter\": \"logName : projects/PROJECT_ID/logs/cloudaudit.googleapis.com\"\n}\n```\n- Click **Execute** .\n```\nlogName=\"projects/PROJECT_ID/logs/cloudaudit.googleapis.com%2Factivity\"OR \"projects/PROJECT_ID/logs/cloudaudit.googleapis.com%2Fdata_access\"protoPayload.serviceName=\"apigeeregistry.googleapis.com\" \n```\n## Route audit logs\nYou can [route audit logs](/logging/docs/routing/overview) to supported destinations in the same way that you can route other kinds of logs. Here are some reasons you might want to route your audit logs:\n- To keep audit logs for a longer period of time or to use more powerful search capabilities, you can route copies of your audit logs to Cloud Storage, BigQuery, or Pub/Sub. Using Pub/Sub, you can route to other applications, other repositories, and to third parties.\n- To manage your audit logs across an entire organization, you can create [aggregated sinks](/logging/docs/export/aggregated_sinks) that can route logs from any or all Google Cloud projects in the organization.\n- If your enabled Data Access audit logs are pushing your Google Cloud projects over your log allotments, you can create sinks that exclude the Data Access audit logs from Logging.\nFor instructions about routing logs, see [Route logs to supported destinations](/logging/docs/export/configure_export_v2) .\n## Pricing\nFor more information about pricing, see [Cloud Logging pricing summary](/stackdriver/pricing#logs-costs) .", "guide": "Apigee"}