{"title": "Compute Engine - Manually live migrate VMs", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Manually live migrate VMs\nTo move sole-tenant VMs to a different node or node group, you can manually initiate a live migration. You can also manually initiate a live migration to move a multi-tenant VM into sole-tenancy. For information about how to move a VM out of sole-tenancy, see [Move a VM out of sole-tenancy](/compute/docs/nodes/updating-vm-tenancy#moving_a_vm_out_of_sole-tenancy) .\n", "content": "## Before you begin\n- If you haven't already, set up authentication. [Authentication](/compute/docs/authentication) is the process by which your identity is verified for access to Google Cloud services and APIs. To run code or samples from a local development environment, you can authenticate to Compute Engine as follows.Select the tab for how you plan to use the samples on this page:- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:```\ngcloud init\n``` **Note:** If you installed the gcloud CLI  previously, make sure you have the latest version by running`gcloud components  update`.\n- [ Set a default region and zone](/compute/docs/gcloud-compute#set_default_zone_and_region_in_your_local_client) .\nTo use the REST API samples on this page in a local development environment, you use the credentials you provide to the gcloud CLI.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:\n- ```\ngcloud init\n```## API rate limits\nManual live migration requests are categorized in the **Queries**  [API ratelimit](/compute/docs/api-rate-limits) .\n## Manually live migrate VMs into or within sole-tenancy\nTo manually live migrate VMs into or within sole-tenancy, use the gcloud CLI or REST.\nIf the destination of the VM is a node group, Compute Engine selects the node within the group that has both enough space for the VM and the least amount of spare capacity.\nYou cannot perform live migration between projects while using shared sole-tenant node groups.\nTo perform this task, you must have the following [permissions](/iam/docs/overview#permissions) :\n- `compute.instances.update`permissions on the VM.\nTo manually live migrate VMs into or within sole-tenancy, use the following [gcloud compute instances update command](/sdk/gcloud/reference/compute/instances/update) :\n```\ngcloud compute instances update VM_NAME \\\n ( --node=NODE \\\n  --node-group=NODE_GROUP \\\n  --node-affinity-file=NODE_AFFINITY_FILE )\n```\nReplace the following:- ``: the name of the VM to update the node affinity labels for.\nReplace exactly one of the following:- `` : the name of the node to live migrate the VM to.\n- `` : the name of the node group to live migrate the VM to.\n- `` : the name of a JSON file containing a configuration of nodes on which this VM could be scheduled. For more information, see [Configure node affinitylabels](/compute/docs/nodes/provisioning-sole-tenant-vms#configure_node_affinity_labels) .\nTo manually live migrate VMs into or within sole-tenancy, use the following [instances.update method](/compute/docs/reference/rest/v1/instances/update) :\n```\nPUT https://compute.googleapis.com/compute/v1/projects/PROJECT_ID/zones/ZONE/instances/VM_NAME\n{\n ...\n \"scheduling\": {\n \"nodeAffinities\": [  {\n  \"key\": \"NODE_AFFINITY_LABEL_KEY\",\n  \"operator\": \"IN\",\n  \"values\": [   \"[NODE_AFFINITY_LABEL_VALUE]\"\n  ]\n  }\n ]\n }\n ...\n}\n```\nReplace the following:- `` : the ID of the project that has the VM to update the node affinity labels for.\n- `` : the zone of the VM to update the node affinity labels for.\n- `` : the name of the VM to update the node affinity labels for.\n- `` : one of the following strings that specifies whether to live migrate the VM to a node group or node:| VM destination | Key to specify       |\n|:-----------------|:---------------------------------------|\n| Node group  | compute.googleapis.com/node-group-name |\n| Node    | compute.googleapis.com/node-name  |\n- `` : the name of the node group or node to live migrate the VM to.## What's next\n- [Learn how to move a VM out of sole-tenancy](/compute/docs/nodes/updating-vm-tenancy#moving_a_vm_out_of_sole-tenancy)", "guide": "Compute Engine"}