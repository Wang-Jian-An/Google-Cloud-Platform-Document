{"title": "Compute Engine - Monitor consumption of reservations", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Monitor consumption of reservations\nThis document explains how to monitor the consumption of [reservations of Compute Engine zonal resources](/compute/docs/instances/reservations-overview) by using Cloud Monitoring.\n[Monitoring](/monitoring/docs/monitoring-overview) collects and stores performance information of Google Cloud services such as Compute Engine. The performance information is called [metrics and time series](/monitoring/docs/monitoring-overview#time-series) . You can access the metrics and time series of your Compute Engine reservations to do the following:\n- Display how your reservations are being consumed by using [Monitoring dashboards](/monitoring/charts/dashboards) .\n- Receive timely notifications when the consumption of your reservations is in a specific state by using [Monitoring alerting policies](/monitoring/alerts) .\nThese methods can, for example, help you verify that your reservations are being consumed as you planned or timely act to avoid unnecessary costs from wasted resources or unused reservations.\n", "content": "## Before you begin\n- Review the [requirements](/compute/docs/instances/reservations-overview#requirements) and [restrictions](/compute/docs/instances/reservations-overview#restrictions) for reservations.\n- Enable the Monitoring API. [Enable the API](https://console.cloud.google.com/flows/enableapi?apiid=monitoring.googleapis.com) \n- If you haven't already, set up authentication. [Authentication](/compute/docs/authentication) is the process by which your identity is verified for access to Google Cloud services and APIs. To run code or samples from a local development environment, you can authenticate to Compute Engine as follows.Select the tab for how you plan to use the samples on this page:\nWhen you use the Google Cloud console to access Google Cloud services and   APIs, you don't need to set up authentication.To use the REST API samples on this page in a local development environment, you use the credentials you provide to the gcloud CLI.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:\n- ```\ngcloud init\n```\n### Required roles\nTo get the permissions that you need to create Monitoring dashboards or alerting policies to monitor the consumption of reservations,   ask your administrator to grant you the [Monitoring Admin ](https://cloud.google.com/iam/docs/understanding-roles#monitoring.admin) ( `roles/monitoring.admin` ) IAM role on the project.    For more information about granting roles, see [Manage access](/iam/docs/granting-changing-revoking-access) .\nThis predefined role contains     the permissions required to create Monitoring dashboards or alerting policies to monitor the consumption of reservations. To see the exact permissions that are   required, expand the **Required permissions** section:\nYou might also be able to get   these permissions  with [custom roles](/iam/docs/creating-custom-roles) or  other [predefined roles](/iam/docs/understanding-roles) .\n### Restrictions\nWhen using Monitoring to access and view the [time series](/monitoring/api/v3/metrics) of a reservation, the following restrictions apply:\n- After you create a reservation, its time series becomes available within 30 minutes.\n- After a time series becomes available, Monitoring starts updating it at least once every 30 minutes.\n- If you delete a reservation, its time series is also deleted and can't be recovered.\n- You can only access and view the time series of a reservation that was created in the current project.\nFor more information about Monitoring restrictions, see [Cloud Monitoring quotas and limits](/monitoring/quotas) .\n## Reservations metrics\nWhen creating Monitoring dashboards or alerting policies, you must first select the [Google Cloud metric](/monitoring/api/metrics_gcp#gcp-compute) to measure how the Google Cloud service is performing. For reservations, you can select the following Compute Engine metrics:\n- **Reserved** : The number of reserved virtual machine (VM) instances in each reservation in the current project.\n- **Used** : The number of consumed VMs in each reservation in the current project.\nAfter you select a metric, you can further filter or group the measurements of reservations' metric. For more information about the available filters for reservations, see [Reservations filters](#reservations-filters) in this document.\n### Reservations filters\nYou can use [Monitoring filters](/monitoring/api/v3/filters) to group or filter the time series data associated with one or more reservations. Specifically, when creating Monitoring dashboards or alerting policies, you can limit the time series data that they use by specifying one or more of the following labels:\n| Selector  | Label name    | Description                                 |\n|:----------------|:-----------------------|:----------------------------------------------------------------------------------------------------------------------------------------------|\n| metadata.system | machine_type   | The machine type specified in the reserved VMs for a reservation.                    |\n| metadata.system | name     | The name of a reservation.                             |\n| metadata.system | state     | The state of a reservation. You can only monitor reservations in the ACTIVE state, which is when a reservation exists.      |\n| metric   | reserved_resource_type | The type of reserved zonal resources by a reservation. You can only monitor the instance type, which is a VM instance.      |\n| resource  | location    | The zone where a reservation is located.                          |\n| resource  | reservation_id   | The identifier (ID) of a reservation.                           |\n| resource  | resource_container  | The project number of the project where a reservation exists. You can only monitor the reservations that were created in the current project. |\nWhen creating a filter, you must specify the selector and the label name, followed by a [comparison operator](/monitoring/alerts/using-alerting-ui#filter-option) , and then the value to filter. For example, if you want your query to filter your reservations by zone `us-central1-a` , use the following filter:\n```\nresource.location = \"us-central1-a\"\n```\nTo ensure that the value you specify in a filter matches the value of a reservation's field, [view the details of the reservation](/compute/docs/instances/reservations-view#describe-reservations) .\n**Note:** To view a reservation ID, view the details of the reservation using the Google Cloud CLI or REST.\n## Monitor consumption of reservations\nTo monitor the consumption of your reservations, select one of the following methods specified in this document:\n- [Create a dashboard](#create-dashboard) \u2014create Monitoring dashboards and add widgets to the graph areas to display the time series data tied to the consumption of your reservations.This method is useful when, for example, you want to verify that a VM is correctly consuming a reservation or compare the consumption trend of multiple reservations.\n- [Create alerting policies](#create-alerting-policies) \u2014create alerting policies to send alerts when the time series data tied to the consumption of your reservations reaches a defined threshold.This method is useful when, for example, you want to be notified when the number of VMs used in the current project is below a specific ratio, or when a reservation remains unused for a specific amount time.\n### Create a dashboard\nYou can create [Monitoring dashboards](/monitoring/dashboards) and view the time series tied to the consumption of your reservations by using the Google Cloud console (recommended) and Monitoring API.\nWhen defining how to display the time series data of a Monitoring filter, you must use one of the following methods:\n- **Basic Query** : this method is useful to quickly configure the time series data for a dashboard widget.For example, you can use Basic Query to quickly display which one of your reservations in a specific zone isn't fully consumed yet.\n- **MQL** : this method is useful to retrieve, filter, and manipulate time series data to create more complex configurations for a dashboard widget.For example, you can use [Monitoring Query Language (MQL)](/monitoring/mql) to display the ratio of consumed VMs to reserved VMs in your reservations. **Tip:** For other methods to configure the time series of your reservations in a Monitoring dashboard, see [PromQL in Cloud Monitoring](/monitoring/promql) .\nThe following example describes how to create a Monitoring dashboard with a line chart widget to display your consumed reservations in the `us-central1-a` zone.\nTo create a Monitoring dashboard using Basic Query, follow these steps:- In the Google Cloud console, go to **Dashboards** . [Go to Dashboards](https://console.cloud.google.com/monitoring/dashboards) \n- Click add **Create dashboard** .The **New dashboard** page opens.\n- Click add_box **Add widget** .The **Add widget** pane appears.\n- Click one of the available widgets. For example, click the **Line** widget.The **Configure widget** pane appears.\n- Click **Select a metric** .\n- In the **Select a metric** window, do the following:- Enter `Reservation` , and then select **Reservation** . **Important:** If you can't see the **Reservation** metric, see [Metric not listed in menu](/monitoring/alerts/using-alerting-ui#not-listed) .\n- In the **Active metrics categories** list, select **Reservation** again.\n- In the **Active metrics** list, select one of the available metrics. For example, select **Used** .\n- Click **Apply** .\n- To filter your reservations by a specific zone, do the following:- In the **Add filter** list, select one of the available [filters for reservations](#reservations-filters) . For this example, select **location** .\n- In the **Comparator** list, select one of the available operators. For this example, select **= (equals)** (default).\n- In the **Value** list, select the zone you want to use to filter your reservations. For this example, select **us-central1-a** .\n- Click **Apply** .\nFor more options to customize Monitoring dashboards using the Google Cloud console, see [Create and manage custom dashboards](/monitoring/charts/dashboards) .\n **Note:** After creating a dashboard using the Monitoring API, you can only [manage it using the Google Cloud console](/monitoring/charts/dashboards) .\nTo create a Monitoring dashboard using Basic Query, make a `POST` request to the [dashboards.create method](/monitoring/api/ref_v3/rest/v1/projects.dashboards/create) .\n```\nPOST https://monitoring.googleapis.com/v1/projects/PROJECT_ID/dashboards{\u00a0 \"displayName\": \"Consumed reservations in zone us-central1-a\",\u00a0 \"mosaicLayout\": {\u00a0 \u00a0 \"columns\": 12,\u00a0 \u00a0 \"tiles\": [\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \"height\": 4,\u00a0 \u00a0 \u00a0 \u00a0 \"widget\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"title\": \"Reservation - Used for us-central1-a [MEAN]\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"xyChart\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"chartOptions\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"mode\": \"COLOR\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"dataSets\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"minAlignmentPeriod\": \"60s\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"plotType\": \"LINE\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"targetAxis\": \"Y1\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"timeSeriesQuery\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"timeSeriesFilter\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"aggregation\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"alignmentPeriod\": \"60s\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"perSeriesAligner\": \"ALIGN_MEAN\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"filter\": \"FILTER\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"secondaryAggregation\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"alignmentPeriod\": \"60s\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"perSeriesAligner\": \"ALIGN_NONE\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"timeshiftDuration\": \"0s\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"yAxis\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"scale\": \"LINEAR\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 \"width\": 6\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 ]\u00a0 }}\n```\nReplace the following:- `` : the project ID of the current project.\n- `` : the Monitoring filter to use for your dashboard. For example, to monitor the consumed reservations in zone `us-central1-a` , specify the following:```\nresource.type = 'compute.googleapis.com/Reservation' AND metric.type = 'compute.googleapis.com/reservation/used' AND resource.location = 'us-central1-a'\n```\nFor more options to customize Monitoring dashboards using the Monitoring API, see [Create and manage dashboards by using the API](/monitoring/dashboards/api-dashboard) .The following example describes how to create a Monitoring dashboard with a line chart widget to display the ratio of used VMs to reserved VMs in your reservations.\nTo create a Monitoring dashboard using MQL, follow these steps:- In the Google Cloud console, go to **Dashboards** . [Go to Dashboards](https://console.cloud.google.com/monitoring/dashboards) \n- Click add **Create dashboard** .The **New dashboard** page opens.\n- Click add_box **Add widget** .The **Add widget** pane appears.\n- Click one of the available widgets. For example, click the **Line** widget.The **Configure widget** pane appears.\n- Click code **MQL** .\n- In the Query editor, enter an MQL query. For example, to view the ratio of used VMs to reserved VMs in your reservations, specify the following:```\nfetch compute.googleapis.com/Reservation| { metric compute.googleapis.com/reservation/used\u00a0 \u00a0 | group_by [metadata.system.name], sliding(1m), max(value.used)\u00a0 ; metric compute.googleapis.com/reservation/reserved\u00a0 \u00a0 | group_by [metadata.system.name], sliding(1m), max(value.reserved) }| ratio\n```\n- Click **Run query** .\n- Click **Apply** .\nFor more options to customize Monitoring dashboards using the Google Cloud console, see [Create and manage custom dashboards](/monitoring/charts/dashboards) .\n **Note:** After creating a dashboard using the Monitoring API, you can only [manage it using the Google Cloud console](/monitoring/charts/dashboards) .\nTo create a Monitoring dashboard using MQL, make a `POST` request to the [dashboards.create method](/monitoring/api/ref_v3/rest/v1/projects.dashboards/create) .\n```\nPOST https://monitoring.googleapis.com/v1/projects/PROJECT_ID/dashboards{\u00a0 \"displayName\": \"Consumed reservations in zone us-central1-a\",\u00a0 \"mosaicLayout\": {\u00a0 \u00a0 \"columns\": 12,\u00a0 \u00a0 \"tiles\": [\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \"height\": 4,\u00a0 \u00a0 \u00a0 \u00a0 \"widget\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"title\": \"Reservation - Used for us-central1-a [MEAN]\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"xyChart\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"chartOptions\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"mode\": \"COLOR\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"dataSets\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"plotType\": \"LINE\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"targetAxis\": \"Y1\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"timeSeriesQuery\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"timeSeriesQueryLanguage\": \"MQL_QUERY\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"timeshiftDuration\": \"0s\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"yAxis\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"scale\": \"LINEAR\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 \"width\": 6,\u00a0 \u00a0 \u00a0 \u00a0 \"xPos\": 6\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 ]\u00a0 }}\n```\nReplace the following:- `` : the project ID of the current project.\n- `` : the MQL query to use for the line chart widget. For example, to view the ratio of used VMs to reserved VMs in your reservations, specify the following:```\nfetch compute.googleapis.com/Reservation| { metric compute.googleapis.com/reservation/used\u00a0| group_by [metadata.system.name], sliding(1m), max(value.used); metric compute.googleapis.com/reservation/reserved\u00a0| group_by [metadata.system.name], sliding(1m), max(value.reserved) }| ratio\n``` **Important:** To specify an MQL query spanning multiple lines in the `timeSeriesQueryLanguage` field, make sure to include the `\\n` character at the end of each line.\nFor more options to customize Monitoring dashboards using the Monitoring API, see [Create and manage dashboards by using the API](/monitoring/dashboards/api-dashboard) .\n### Create alerting policies\nYou can create [Monitoring alerting policies](/monitoring/alerts) to receive notifications about the reservations consumption in the current project by using the Google Cloud console and Monitoring API.\nWhen defining an alert condition for an alerting policy, you must use one of the following methods:\n- **Basic Query** : this method is useful to create simple alert conditions.For example, you can use Basic Query to create an alert condition that gets triggered whenever a reservation is consumed for the first time.\n- **MQL** : this method is useful to retrieve, filter, and manipulate time series data to create more complex alert conditions.For example, you can use [Monitoring Query Language (MQL)](/monitoring/mql) to create an alert condition that gets triggered when the ratio of reserved VMs to consumed VMs reaches a specific threshold.\nThe following example creates an alerting policy that sends an alert notification when a reservation is consumed for the first time. Specifically, the alert triggers whenever the number of consumed VMs in a reservation is greater than `0` .\nTo create a Monitoring alerting policy using Basic Query, follow these steps:- In the Google Cloud console, go to **Alerting** . [Go to Alerting](https://console.cloud.google.com/monitoring/alerting) \n- Click add **Create policy** .The **Create alerting policy** page opens.\n- Click bar_chart **Select a metric** .The **Select a metric** window appears.\n- In the **Select a metric** window, do the following:- In the **Filter by resource or metric name** field, enter `Reservation` .\n- If the **Reservation** metric appears in the **Active resources** list, select it. Otherwise, do the following:- Clear **Show only active resources & metrics** .The **Inactive resources** list appears.\n- In the **Inactive resources** list, select **Reservation** . **Important:** If you still can't see the **Reservation** metric, see [Metric not listed in menu](/monitoring/alerts/using-alerting-ui#not-listed) .\n- In the **Active metrics categories** list, select **Reservation** again.The **Active metrics** list appears.\n- In the **Active metrics** list, select one of the available metrics.For example, select **Used** .\n- Click **Apply** .\n- Click add_box **Add filter** .The **Add filter** section appears.\n- In the **Add filter** section, do the following:- In the **Label** list, select one of the available [filters for reservations](#reservations-filters) specified in this document.For example, to filter your reservations by name, select **name** .\n- In the **Comparison** list, select one of the available operators.For example, select **= (equals)** (default).\n- In the **Value** list, select the name of the reservation that you want to monitor.\n- Click **Done** .\n- Click **Next** .The **Configure alert trigger** pane appears.\n- In the **Condition types** section, select one of the following options:- To trigger the condition if a time series falls above or below a specific value, select **Threshold** .\n- To trigger the condition if a time series doesn't have data for a specific time, select **Metric absence** .\n- To trigger the condition if a time series is projected to cross the threshold in the near future, select **Forecast** .\nFor example, select **Threshold** (default).\n- In the **Alert trigger** list, select the condition that triggers the alert.For example, select **Any time series violation** (default).\n- In the **Threshold position** list, select when the condition triggers.For example, select **Above threshold** .\n- In the **Threshold value** field, enter a value for the condition.For example, enter `0` .\n- In the **Condition name** field, enter a name for your condition.For example, enter `Reservation` `` `consumed.`Where is the name of the reservation that you specified in the previous steps.\n- Click **Next** .The **Configure notifications and finalize alert** pane appears.\n- Click **Use notification channels** .\n- In the **Notification channels** field, select the channels on which you want to be notified about the incident.If you have no notification channels available, click **Manage notification channels** , and then follow the steps to create notification channels. For more information, see [Create and manage notification channels](/monitoring/support/notification-options) .\n- In the **Incident autoclose duration** field, select a duration after which an incident is automatically closed.For example, select **3 days** .\n- In the **Alert policy name** field, enter a name for the alerting policy.For example, enter `Alert: you started consuming reservation` `` `!`Where is the name of the reservation that you specified in the previous steps.\n- Click **Next** .The review page of your alerting condition opens.\n- Click **Create policy** .Creating the alerting policy might take a few seconds to complete. This action redirects you to the **Create alerting policy** page.\nFor more information about the options you have when creating alerting policies using the Google Cloud console and Basic Query, see [Create metric-based alert policies](/monitoring/alerts/using-alerting-ui) .\nTo create a Monitoring alerting policy using Basic Query, make a `POST` request to the [projects.alertPolicies.create method](/monitoring/api/ref_v3/rest/v3/projects.alertPolicies/create) .\n```\nPOST https://monitoring.googleapis.com/v3/projects/PROJECT_ID/alertPolicies{\u00a0 \"displayName\": \"Alert: you started consuming reservation RESERVATION_NAME!\",\u00a0 \"conditions\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"displayName\": \"Reservation RESERVATION_NAME consumed.\",\u00a0 \u00a0 \u00a0 \"conditionThreshold\": {\u00a0 \u00a0 \u00a0 \u00a0 \"filter\": \"FILTER\",\u00a0 \u00a0 \u00a0 \u00a0 \"aggregations\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"alignmentPeriod\": \"300s\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"crossSeriesReducer\": \"REDUCE_NONE\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"perSeriesAligner\": \"ALIGN_MEAN\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \u00a0 \"comparison\": \"COMPARISON_GT\",\u00a0 \u00a0 \u00a0 \u00a0 \"duration\": \"0s\",\u00a0 \u00a0 \u00a0 \u00a0 \"trigger\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"count\": 1\u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 \"thresholdValue\": 0\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 ],\u00a0 \"alertStrategy\": {\u00a0 \u00a0 \"autoClose\": \"AUTO_CLOSE_TIME\"\u00a0 },\u00a0 \"combiner\": \"OR\",\u00a0 \"enabled\": true,\u00a0 \"notificationChannels\": [\u00a0 \u00a0 \"projects/PROJECT_ID/notificationChannels/NOTIFICATION_CHANNEL\"\u00a0 ]}\n```\nReplace the following:- `` : the project ID of the current project.\n- `` : the name of an existing reservation which is located in the current project.\n- `` : the Monitoring filter to use for your alerting policy. For example, to monitor the `used` metric for the reservation, specify the following:```\nresource.type = 'compute.googleapis.com/Reservation' AND metric.type = 'compute.googleapis.com/reservation/used' AND metadata.system.name = 'RESERVATION_NAME'\n```\n- `` : the time in seconds before an incident is automatically closed. The value must be between `0s` and `604800s` (7 days). For example, enter `259200s` (3 days).\n- `` : the name of an existing notification channel. To set up a notification channel, see [Create and manage notification channels](/monitoring/support/notification-options) .\nFor more information about the options you have when creating alerting policies using the Monitoring API and Basic Query, see [Create alerting policies by using the API](/monitoring/alerts/policies-in-api) .The following example creates an alerting policy that sends an alert notification whenever the percentage of used VMs to reserved VMs in your reservations is above 90%.\nTo create a Monitoring alerting policy using MQL, follow these steps:- In the Google Cloud console, go to **Alerting** . [Go to Alerting](https://console.cloud.google.com/monitoring/alerting) \n- Click add **Create policy** .The **Create alerting policy** page opens.\n- On the toolbar, click **MQL** .The **Edit query** pane appears.\n- In the **Edit query** pane, enter an MQL query.For example, to create a query that groups your reservations by name and triggers an alert condition when over 90% of your reservations are consumed, enter the following query:```\nfetch compute.googleapis.com/Reservation| { metric compute.googleapis.com/reservation/used\u00a0 \u00a0 | group_by [metadata.system.name], sliding(1m), max(value.used)\u00a0 ; metric compute.googleapis.com/reservation/reserved\u00a0 \u00a0 | group_by [metadata.system.name], sliding(1m), max(value.reserved) }| ratio| every 1m| condition gt(val(), 0.9)\n``` **Important:** To create an MQL-based alert condition, you must use one of the following operators at the end of your query:- For threshold alerts, specify [condition](/monitoring/mql/reference#condition-tabop) .\n- For absence alerts, specify [absent_for](/monitoring/mql/reference#absent_for-tabop) .\nAttempting to run a query without one of these operators causes [errors](/compute/docs/troubleshooting/troubleshooting-reservation-monitoring#query-misses-operation) . For more information, see [MQL alerting operations](/monitoring/mql/alerts#ql-alert-ops) .\n- To run the query you've just entered, click **Run query** .\n- Click **Next** .The **Configure alert trigger** pane appears.\n- If the **Condition name** , enter a name for your condition.For example, enter `Over 90% of your reservations are consumed.`\n- Click **Next** again.The **Configure notifications and finalize alert** pane appears.\n- Click **Use notification channels** .\n- In the **Notification channels** field, select the channels on which you want to be notified about the incident.If you have no notification channels available, click **Manage notification channels** , and then follow the steps to create notification channels. For more information, see [Create and manage notification channels](/monitoring/support/notification-options) .\n- In the **Incident autoclose duration** field, select a duration after which an incident is automatically closed.For example, select **3 days** .\n- In the **Alert policy name** field, enter a name for the alerting policy.For example, enter `Alert: over 90% of your reservations are consumed.`\n- Click **Next** .The review page of your alerting condition opens.\n- Click **Create policy** .Creating the alerting policy might take a few seconds to complete. This action redirects you to the **Create alerting policy** page.\nFor more information about creating alerting policies using the Google Cloud console and MQL, see [Create MQL alerting policies (console)](/monitoring/mql/alerts#create-ql-policy-ui) .\nTo create a Monitoring alerting policy using MQL, make a `POST` request to the [projects.alertPolicies.create method](/monitoring/api/ref_v3/rest/v3/projects.alertPolicies/create) .\n```\nPOST https://monitoring.googleapis.com/v3/projects/PROJECT_ID/alertPolicies{\u00a0 \"displayName\": \"Alert: over 90% of your reservations are consumed.\",\u00a0 \"conditions\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"displayName\": \"Over 90% of your reservations are consumed.\",\u00a0 \u00a0 \u00a0 \"conditionMonitoringQueryLanguage\": {\u00a0 \u00a0 \u00a0 \u00a0 \"duration\": \"0s\",\u00a0 \u00a0 \u00a0 \u00a0 \"trigger\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"count\": 1\u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 \"query\": \"MQL_QUERY\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 ],\u00a0 \"alertStrategy\": {\u00a0 \u00a0 \"autoClose\": \"AUTO_CLOSE_TIME\"\u00a0 },\u00a0 \"combiner\": \"OR\",\u00a0 \"enabled\": true,\u00a0 \"notificationChannels\": [\u00a0 \u00a0 \"projects/PROJECT_ID/notificationChannels/NOTIFICATION_CHANNEL\"\u00a0 ]}\n```\nReplace the following:- `` : the project ID of the current project.\n- `` : an MQL query to use for the alerting policy. For example, to create a query that tracks when the percentage of used VMs to reserved VMs is above 90% in the current project's reservations, specify the following:```\nfetch compute.googleapis.com/Reservation| { metric compute.googleapis.com/reservation/used\u00a0| group_by [metadata.system.name], sliding(1m), max(value.used); metric compute.googleapis.com/reservation/reserved\u00a0| group_by [metadata.system.name], sliding(1m), max(value.reserved) }| ratio| every 1m| condition gt(val(), 0.9)\n``` **Important:** Make sure of the following:- To specify an MQL query spanning multiple lines in the`query`field, include the`\\n`character at the end of each line.\n- To create an alert condition using an MQL query, you must use one of the following operators at the end of your query:- For threshold alerts, specify [condition](/monitoring/mql/reference#condition-tabop) .\n- For absence alerts, specify [absent_for](/monitoring/mql/reference#absent_for-tabop) .\nAttempting to run a query without one of these operators causes [errors](/compute/docs/troubleshooting/troubleshooting-reservation-monitoring#query-misses-operation) . For more information, see [MQL alerting operations](/monitoring/mql/alerts#ql-alert-ops) .\n- `` : the time in seconds before an incident is automatically closed. The value must be between `0s` and `604800s` (7 days). For example, enter `259200s` (3 days).\n- `` : the name of an existing notification channel. To set up a notification channel, see [Create and manage notification channels](/monitoring/support/notification-options) .\nFor more information about creating alerting policies using the Monitoring API and MQL, see [Create MQL alerting policies (API)](/monitoring/mql/alerts#create-ql-policy-api) .\n## Troubleshoot\nLearn how to [troubleshoot issues with reservation monitoring](/compute/docs/troubleshooting/troubleshooting-reservation-monitoring) .\n## What's next\n- Learn how to [consume reservations](/compute/docs/instances/reservations-consume) .\n- Learn how to [attach reservations to commitments](/compute/docs/instances/reservations-with-commitments) .\n- Learn how to [modify reservations](/compute/docs/instances/reservations-modify) .\n- Learn how to [delete reservations](/compute/docs/instances/reservations-delete) .", "guide": "Compute Engine"}