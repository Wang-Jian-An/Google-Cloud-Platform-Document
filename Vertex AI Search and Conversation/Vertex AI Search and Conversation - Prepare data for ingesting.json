{"title": "Vertex AI Search and Conversation - Prepare data for ingesting", "url": "https://cloud.google.com/generative-ai-app-builder/docs/prepare-data?hl=zh-cn", "abstract": "# Vertex AI Search and Conversation - Prepare data for ingesting\nHow you prepare data depends on the kind of data you're importing and the way you choose to import it. Start with what kind of data you plan to import:\n- [Website data](#website) \n- [Unstructured data](#unstructured) \n- [Structured data](#structured) \n- [Structured media data](#structured-media) \n- [Healthcare FHIR data](#hc-fhir-data) \n**Note:** Blended search, where multiple data stores can be connected to a single generic search app, is available in Public preview. For more information, see [About connecting multiple data stores](/generative-ai-app-builder/docs/create-data-store-es#multi-data-stores) .\n", "content": "## Website data\nWhen you create a data store for website data, you provide the URLs of web pages that Google should crawl and index for searching or recommending.\nBefore indexing your website data:\n- Check that the web pages you plan to provide are not using robots.txt to block indexing\n- If you plan to use [Advanced website indexing](/generative-ai-app-builder/docs/about-advanced-features) , you must be able to [verify domain ownership](/generative-ai-app-builder/docs/domain-verification) .\n- You can add metadata in the form of`meta`tags to your data store schema to enrich your indexing as explained in [Add metadata for advanced website indexing](/generative-ai-app-builder/docs/add-website-metadata) .\nTo create your data store, see [Create a search data store](/generative-ai-app-builder/docs/create-data-store-es) or [Create a recommendations data store](/generative-ai-app-builder/docs/create-data-store-recommendations) .\n## Unstructured data\nVertex AI Search supports search over documents that are in HTML, PDF with embedded text, and TXT format. PPTX and DOCX formats are available in Preview.\nYou import your documents from a [Cloud Storage](/storage/docs) bucket. You can import using Google Cloud console, by the `ImportDocuments` method, or by streaming ingestion through CRUD methods. For API reference information, see [DocumentService](/generative-ai-app-builder/docs/reference/rpc/google.cloud.discoveryengine.v1#documentservice) and [documents](/generative-ai-app-builder/docs/reference/rest/v1/projects.locations.collections.dataStores.branches.documents) .\nHTML and TXT files must be 2.5\u00a0MB or smaller. PDF, PPTX, and DOCX files must be 100\u00a0MB or smaller. You can import up to 100,000 files at a time.\nIf you plan to include embeddings in your unstructured data, see [Use custom embeddings](/generative-ai-app-builder/docs/bring-embeddings) .\nIf you have non-searchable PDFs (scanned PDFs or PDFs with text inside images, such as infographics) we recommend turning on optical character recognition (OCR) processing during data store creation. This allows Vertex AI Search to extract elements such as text blocks and tables. If you have searchable PDFs that are mostly composed of machine-readable text and contain many tables, you can consider turning on OCR processing with the option for machine-readable text enabled in order to improve detection and parsing. For more information, see [Parse and chunkdocuments](/generative-ai-app-builder/docs/parse-chunk-documents) .\nIf you want to use Vertex AI Search for retrieval-augmented generation (RAG), turn on document chunking when you create your data store. For more information, see [Parse and chunk documents](/generative-ai-app-builder/docs/parse-chunk-documents) .\nYou can import unstructured data from the following sources:\n- [Cloud Storage](#storage-unstructured) \n- [BigQuery](#bigquery-unstructured) \n### Cloud Storage\nYou can import data from Cloud Storage with or without metadata.\nData import is not recursive. That is, if there are folders within the bucket or folder that you specify, files within those folders are not imported.\nIf you plan to import documents from Cloud Storage without metadata, put your documents directly into a Cloud Storage bucket. The document ID is an example of metadata.\nFor testing, you can use the following publicly available Cloud Storage folders, which contain PDFs:\n- `gs://cloud-samples-data/gen-app-builder/search/alphabet-investor-pdfs`\n- `gs://cloud-samples-data/gen-app-builder/search/CUAD_v1`\n- `gs://cloud-samples-data/gen-app-builder/search/kaiser-health-surveys`\n- `gs://cloud-samples-data/gen-app-builder/search/stanford-cs-224`\nIf you plan to import data from Cloud Storage with metadata, put a JSON file that contains the metadata into a Cloud Storage bucket whose location you provide during import.\nYour unstructured documents can be in the same Cloud Storage bucket as your metadata or a different one.\nThe metadata file must be a [JSON Lines](https://jsonlines.org/) or an NDJSON file. The document ID is an example of metadata. Each row of the metadata file must follow one of the following JSON formats:\n- Using`jsonData`:- `{ \"id\": \"<your-id>\", \"jsonData\": \"<JSON string>\", \"content\": { \"mimeType\": \"<application/pdf or text/html>\", \"uri\": \"gs://<your-gcs-bucket>/directory/filename.pdf\" } }`\n- Using`structData`:- `{ \"id\": \"<your-id>\", \"structData\": { <JSON object> }, \"content\": { \"mimeType\": \"<application/pdf or text/html>\", \"uri\": \"gs://<your-gcs-bucket>/directory/filename.pdf\" } }`Use the `uri` field in each row to point to the Cloud Storage location of the document.\nHere is an example of an NDJSON metadata file for an unstructured document. In this example, each line of the metadata file points to a PDF document and contains the metadata for that document. The first two lines use `jsonData` and the second two lines use `structData` . With `structData` you don't need to escape quotation marks that appear within quotation marks.\n```\n{\"id\":\"doc-0\",\"jsonData\":\"{\\\"title\\\":\\\"test_doc_0\\\",\\\"description\\\":\\\"This document uses a blue color theme\\\",\\\"color_theme\\\":\\\"blue\\\"}\",\"content\":{\"mimeType\":\"application/pdf\",\"uri\":\"gs://test-bucket-12345678/test_doc_0.pdf\"}}{\"id\":\"doc-1\",\"jsonData\":\"{\\\"title\\\":\\\"test_doc_1\\\",\\\"description\\\":\\\"This document uses a green color theme\\\",\\\"color_theme\\\":\\\"green\\\"}\",\"content\":{\"mimeType\":\"application/pdf\",\"uri\":\"gs://test-bucket-12345678/test_doc_1.pdf\"}}{\"id\":\"doc-2\",\"structData\":{\"title\":\"test_doc_2\",\"description\":\"This document uses a red color theme\",\"color_theme\":\"red\"},\"content\":{\"mimeType\":\"application/pdf\",\"uri\":\"gs://test-bucket-12345678/test_doc_3.pdf\"}}{\"id\":\"doc-3\",\"structData\":{\"title\":\"test_doc_3\",\"description\":\"This is document uses a yellow color theme\",\"color_theme\":\"yellow\"},\"content\":{\"mimeType\":\"application/pdf\",\"uri\":\"gs://test-bucket-12345678/test_doc_4.pdf\"}}\n```\nTo create your data store, see [Create a search data store](/generative-ai-app-builder/docs/create-data-store-es) or [Create a recommendations data store](/generative-ai-app-builder/docs/create-data-store-recommendations) .\n### BigQuery\nIf you plan to import metadata from BigQuery, create a BigQuery table that contains metadata. The document ID is an example of metadata.\nPut your unstructured documents into a Cloud Storage bucket.\nUse the following BigQuery schema. Use the `uri` field in each record to point to the Cloud Storage location of the document.\n```\n[\u00a0 {\u00a0 \u00a0 \"name\": \"id\",\u00a0 \u00a0 \"mode\": \"REQUIRED\",\u00a0 \u00a0 \"type\": \"STRING\",\u00a0 \u00a0 \"fields\": []\u00a0 },\u00a0 {\u00a0 \u00a0 \"name\": \"jsonData\",\u00a0 \u00a0 \"mode\": \"NULLABLE\",\u00a0 \u00a0 \"type\": \"STRING\",\u00a0 \u00a0 \"fields\": []\u00a0 },\u00a0 {\u00a0 \u00a0 \"name\": \"content\",\u00a0 \u00a0 \"type\": \"RECORD\",\u00a0 \u00a0 \"mode\": \"NULLABLE\",\u00a0 \u00a0 \"fields\": [\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \"name\": \"mimeType\",\u00a0 \u00a0 \u00a0 \u00a0 \"type\": \"STRING\",\u00a0 \u00a0 \u00a0 \u00a0 \"mode\": \"NULLABLE\"\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \"name\": \"uri\",\u00a0 \u00a0 \u00a0 \u00a0 \"type\": \"STRING\",\u00a0 \u00a0 \u00a0 \u00a0 \"mode\": \"NULLABLE\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 ]\u00a0 }]\n```\nFor more information, see [Create and use tables](/bigquery/docs/tables) in the BigQuery documentation.\nTo create your data store, see [Create a search data store](/generative-ai-app-builder/docs/create-data-store-es) or [Create a recommendations data store](/generative-ai-app-builder/docs/create-data-store-recommendations) .\n## Structured data\n**Note:** This feature is a Preview offering, subject to the \"Pre-GA Offerings Terms\" of the [GCP Service Specific Terms](https://cloud.google.com/terms/service-terms) . Pre-GA products and features may have limited support, and changes to pre-GA products and features may not be compatible with other pre-GA versions. For more information, see the [launch stage descriptions](https://cloud.google.com/products#product-launch-stages) . Further, by using this feature, you agree to the [Generative AI Preview terms and conditions](https://cloud.google.com/trustedtester/aitos) (\"Preview Terms\"). For this feature, you can process personal data as outlined in the [Cloud Data Processing Addendum](https://cloud.google.com/terms/data-processing-terms) , subject to applicable restrictions and obligations in the Agreement (as defined in the Preview Terms).\nPrepare your data according to the import method that you plan to use. If you plan to ingest media data, also see [Structured media data](#structured-media) .\nYou can import structured data from the following sources:\n- [BigQuery](#bigquery-structured) \n- [Cloud Storage](#storage-structured) \n- [Local JSON data](#json-data-api) \n- [Third-party data sources](#third-party) (Preview with allowlist)\n### BigQuery\nYou can import structured data from BigQuery datasets.\nYour schema is auto-detected. After importing, Google recommends that you edit the auto-detected schema to map key properties, such as titles. If you import using the API instead of the Google Cloud console, you have the option to provide your own schema as a JSON object. For more information, see [Schemas: auto-detecting versus providing your own](/generative-ai-app-builder/docs/provide-schema) .\nFor examples of publicly available structured data, see the [BigQuery public datasets](/bigquery/public-data) .\nIf you plan to include embeddings in your structured data, see [Use custom embeddings](/generative-ai-app-builder/docs/bring-embeddings) .\nTo create your data store, see [Create a search data store](/generative-ai-app-builder/docs/create-data-store-es) or [Create a recommendations data store](/generative-ai-app-builder/docs/create-data-store-recommendations) .\n### Cloud Storage\nStructured data in Cloud Storage must be in either [JSONLines](https://jsonlines.org/) or NDJSON format. Each file must be 2 GB or smaller. You can import up to 100 files at a time.\nFor examples of publicly available structured data, refer to the following folders in Cloud Storage, which contain NDJSON files:\n- `gs://cloud-samples-data/gen-app-builder/search/kaggle_movies`\n- `gs://cloud-samples-data/gen-app-builder/search/austin_311`\nIf you plan to include embeddings in your structured data, see [Use custom embeddings](/generative-ai-app-builder/docs/bring-embeddings) .\nTo create your data store, see [Create a search data store](/generative-ai-app-builder/docs/create-data-store-es) or [Create a recommendations data store](/generative-ai-app-builder/docs/create-data-store-recommendations) .\n### Local JSON data\nYou can directly upload a JSON document or object using the API.\nGoogle recommends providing your own schema as a JSON object for better results. If you don't provide your own schema, the schema is auto-detected. After importing, we recommend that you edit the auto-detected schema to map key properties, such as titles. For more information, see [Schemas: auto-detecting versus providing your own](/generative-ai-app-builder/docs/provide-schema) .\nIf you plan to include embeddings in your structured data, see [Use custom embeddings](/generative-ai-app-builder/docs/bring-embeddings) .\nTo create your data store, see [Create a search data store](/generative-ai-app-builder/docs/create-data-store-es) or [Create a recommendations data store](/generative-ai-app-builder/docs/create-data-store-recommendations) .\n## Structured media data\nIf you plan to ingest structured media data, such as videos, news, or music, review the following:\n- Information about your import method (BigQuery or Cloud Storage): [Structured data](#structured) \n- Required schemas and fields for media documents and data stores: [About media documents and data stores](/generative-ai-app-builder/docs/media-documents) \n- User event requirements and schemas: [About user events](/generative-ai-app-builder/docs/user-events) \n- Information about media recommendations types: [About media recommendations types](/generative-ai-app-builder/docs/about-media-recommendations-types) \n### Third-party data sources\n**Note:** This feature is a Preview offering, subject to the \"Pre-GA Offerings Terms\" of the [GCP Service Specific Terms](https://cloud.google.com/terms/service-terms) . Pre-GA products and features may have limited support, and changes to pre-GA products and features may not be compatible with other pre-GA versions. For more information, see the [launch stage descriptions](https://cloud.google.com/products#product-launch-stages) . Further, by using this feature, you agree to the [Generative AI Preview terms and conditions](https://cloud.google.com/trustedtester/aitos) (\"Preview Terms\"). For this feature, you can process personal data as outlined in the [Cloud Data Processing Addendum](https://cloud.google.com/terms/data-processing-terms) , subject to applicable restrictions and obligations in the Agreement (as defined in the Preview Terms).\nIngesting from third-party data sources is a preview with allowlist feature. When you connect a third-party data source, the data is initially ingested and then is synced to Vertex AI Search at a frequency that you specify.\nBefore setting up your data source connection, you must set up access control for your data source. For information about setting up access control, see [Use data source access control](/generative-ai-app-builder/docs/data-source-access-control) .\nFor required credentials to connect a data source, go to the documentation for connecting the third-party data source that you plan to ingest from:\n- [Connect Confluence](/generative-ai-app-builder/docs/connect-third-party-data-source#confluence) \n- [Connect Jira](/generative-ai-app-builder/docs/connect-third-party-data-source#jira) \n- [Connect Salesforce](/generative-ai-app-builder/docs/connect-third-party-data-source#salesforce) \n- [Connect ServiceNow](/generative-ai-app-builder/docs/connect-third-party-data-source#servicenow) ## Healthcare FHIR data\nIf you plan to ingest FHIR data from Cloud Healthcare API, ensure the following:\n- Location: The source FHIR store must be in a Cloud Healthcare API dataset that's in the`us-central1`,`us`, or`eu`location. For more information, see [Create and manage datasets in Cloud Healthcare API](/healthcare-api/docs/datasets) .\n- FHIR store type: The source FHIR store must be an R4 data store. You can check the versions of your FHIR stores by [listing the FHIR stores in your dataset](/healthcare-api/docs/how-tos/fhir#listing_the_fhir_stores_in_a_dataset) . To create a FHIR R4 store, see [Create FHIR stores](/healthcare-api/docs/how-tos/fhir#creating_a_fhir_store) .\n- Import quota: The source FHIR store must have fewer than 1 million FHIR resources. If there are more than 1 million FHIR resources, the import process stops after this limit is reached. For more information, see [Quotas and limits](/generative-ai-app-builder/quotas) .\n- The files referenced in a [DocumentReference resource](https://hl7.org/fhir/R4/documentreference.html) must be PDF, RTF, or image files that are stored in Cloud Storage. The link to the referenced files must be in the`content[].attachment.url`field of the resource in the standard Cloud Storage path format:`gs://` `` `/` ``.\n- Review the list of FHIR R4 resources that Vertex AI Search supports. For more information, see [Healthcare FHIR R4 data schema reference](/generative-ai-app-builder/docs/fhir-schema-reference) .", "guide": "Vertex AI Search and Conversation"}