{"title": "Vertex AI Search and Conversation - Configure serving controls", "url": "https://cloud.google.com/generative-ai-app-builder/docs/configure-serving-controls?hl=zh-cn", "abstract": "# Vertex AI Search and Conversation - Configure serving controls\nServing controls change the default behavior of a search request.\n**Note:** This is an allowlist-only feature.\nTo change the results of a request, first create a control, and then attach it to the serving config. A control only affects search requests served by serving configs that the control is attached to. If a control isn't attached to any serving config, it has no effect.\nThe following types of controls are available. Choose a control based on your use case:\n| Control   | Description       | Available for           |\n|:-----------------|:--------------------------------------|:--------------------------------------------------------|\n| Boost control | Changes the returned order of results | Search apps with structured data stores     |\n| Filter control | Removes entries from returned results | Search apps with structured data stores     |\n| Synonyms control | Associates queries with each other | Search apps with structured or unstructured data stores |\n| Redirect control | Redirects to a specified URI   | All search apps           |\nWhen creating a control, you can optionally define a condition that determines when the control is applied. Conditions are defined using condition fields. The following condition fields are available:\n- **queryTerms** . The control will be applied when specific queries are searched for.\n- **activeTimeRange** . The control will be applied when a request occurs within a specified time range.\nIf both types of conditions are specified for a control, the control is applied to the search request when both condition types are satisfied. If multiple values for the same condition are specified, only one of the values needs to match for that condition to be satisfied.\nFor example, consider the following condition with two query terms specified:\n```\n\"queryTerms\": [\u00a0 {\u00a0 \u00a0 \"value\": \"gShoe\"\u00a0 \u00a0 \"fullMatch\": true\u00a0 },\u00a0 {\u00a0 \u00a0 \"value\": \"gBoot\"\u00a0 \u00a0 \"fullMatch\": true\u00a0 }]\n```\nThe condition will be satisfied for a request with `SearchRequest.query=\"gShoe\"` or a request with `SearchRequest.query=\"gBoot\"` , but won't be satisfied with `SearchRequest.query=\"gSandal\"` or any other string.\nIf no conditions are specified, the control is always applied.\nFor more information, see [servingConfigs.search](/generative-ai-app-builder/docs/reference/rest/v1alpha/projects.locations.collections.dataStores.servingConfigs/search) in the API reference.\n", "content": "## About boost controls\nA boost control is defined as a control with a `boostAction` .\nThe syntax for a `boostAction` is as follows:\n```\n{\u00a0 \u00a0 \"boost\": \"BOOST\",\u00a0 \u00a0 \"filter\": \"FILTER\",}\n```\n- : A float between`-1`and`1`. When the value is negative, results are demoted to appear later in search results. When the value is positive results are promoted to appear earlier in search results.\n- : A string specifying requirements that must be met by the document. If the document matches all the requirements, the boost is applied. Otherwise there is no change. For the filtering syntax, see [Filter expression syntax](/generative-ai-app-builder/docs/filter-search-metadata#filter-expression-syntax) .## About filter controls\nA filter control is defined as a control with a `filterAction` .\nThe syntax for a `filterAction` is as follows:\n```\n{\u00a0 \u00a0 \"filter\": \"FILTER\",}\n```\n- : A string specifying requirements that must be met by the document. If the document matches all the requirements, the result is included in the result list. Otherwise, the result is removed from the result list. For the filtering syntax, see [Filter expression syntax](/generative-ai-app-builder/docs/filter-search-metadata#filter-expression-syntax) .## About synonyms controls\nA synonyms control is defined as a control with a `synonymsAction` .\nThe syntax for a `synonymsAction` is as follows:\n```\n{\u00a0 \u00a0 \"synonyms\": \"SYNONYMS\",}\n```\n- : Strings that will be associated with each other, making it more likely for each to show similar results. You must specify at least two strings, and you can specify up to 100 strings. Strings must be UTF-8 and lowercase. No duplicate strings are allowed.\nFor example:\n```\n{\u00a0 \u00a0 \"synonyms\": [\"pixel\", \"android phone\", \"google phone\"]}\n```\n## About redirect controls\nA redirect control allows redirecting users to a provided URI.\nRedirect controls are defined as a control with a `redirectAction` .\nSyntax for `redirectAction` :\n```\n{\u00a0 \u00a0 \"redirect_uri\": \"REDIRECT_URI\",}\n```\n- : A URI of at most 2000 characters.\nFor example, if the value of the query term is \"support\", you can set a redirect to your technical support page instead of returning (or failing to return) search results for \"support\".\n```\n{\u00a0 \u00a0 \"redirect_uri\": [\"https://www.example.com/support\"]}\n```\n## About the queryTerms condition\n`queryTerms` is optional. Use it if you want a control to be used when specific queries are searched for. When the `queryTerms` condition is used, the control is applied when the value of `queryTerms` matches a term in `SearchRequest.query` .\nQuery terms can only be used when the `Control.searchUseCase` is set as `SOLUTION_TYPE_SEARCH` .\nUp to 10 different `queryTerms` can be specified on a single `Control.condition` . If no query terms are specified, the field is ignored.\nThe syntax for a single `queryTerm` is as follows:\n```\n{\u00a0 \u00a0 \"value\": \"VALUE_1\",\u00a0 \u00a0 \"fullMatch\": \"FULL_MATCH_1\"}\n```\n- : A lowercase UTF-8 string with length`[1, 5000]`. Ifis`true`, it can have at most three space-separated terms.\n- : A boolean. When set to`true`, it requires`SearchRequest.query`to completely match the`queryTerm.value`. When set to`false`, it requires`SearchRequest.query`to contain`queryTerm.value`as a substring.## About the activeTimeRange condition\n`activeTimeRange` is optional. It checks that the time a request was received is between `activeTimeRange.startTime` and `activeTimeRange.endTime` .\nUp to 10 `activeTimeRange` ranges can be specified on a single `Control.condition` . If no `activeTimeRange` ranges are specified, the field is ignored.\nThe syntax for a single `activeTimeRange` is as follows:\n```\n[\u00a0 {\u00a0 \u00a0 \"startTime\": \"START_TIMESTAMP_1\",\u00a0 \u00a0 \"endTime\": \"END_TIMESTAMP_1\"\u00a0 }]\n```\n- : Defines the earliest time (inclusive) that the control will be applied. Timestamps are in RFC 3339 UTC \"Zulu\" format, with nanosecond resolution  and up to nine fractional digits\u2014for example,`\"2023-10-02T15:01:23Z\"`.\n- : Defines the latest time (inclusive) that the control will be applied. This time must be in the future.## API instructions: Change default search request behavior with serving controls\nTo change the default search request behavior, you create a serving control and attach it to the default serving config.\n**Note:** This is an allowlist-only feature.\n### Before you begin\nIf you want to create serving controls, contact your Google account team and ask to be added to the allowlist for serving controls.\n### Create a serving control\nUse the following instructions to create a serving control.\nFor field details, see the [Controls API reference](/generative-ai-app-builder/docs/reference/rest/v1alpha/projects.locations.collections.dataStores.controls) and the [Controls.create API reference](/generative-ai-app-builder/docs/reference/rest/v1alpha/projects.locations.collections.dataStores.controls/create) .\n- Find your data store ID. If you already have your data store ID, skip to the next step.- In the Google Cloud console, go to the **Search and Conversation** page and in the navigation menu, click **Data stores** . [Go to the Data stores page](https://console.cloud.google.com/gen-app-builder/data-stores) \n- Click the name of your data store.\n- On the **Data** page for your data store, get the data store ID.\n- Choose the condition type and field values for your serving control.Example of a condition:```\n{\u00a0 \"queryTerms\": [\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \"value\": \"VALUE_1\",\u00a0 \u00a0 \u00a0 \u00a0 \"fullMatch\": FULL_MATCH_1\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \"value\": \"VALUE_2\",\u00a0 \u00a0 \u00a0 \u00a0 \"fullMatch\": FULL_MATCH_2\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u2026\u00a0 \u00a0 ],\u00a0 \"activeTimeRange\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"startTime\": \"START_TIMESTAMP_1\",\u00a0 \u00a0 \u00a0 \"endTime\": \"END_TIMESTAMP_1\"\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"startTime\": \"START_TIMESTAMP_2\",\u00a0 \u00a0 \u00a0 \"endTime\": \"END_TIMESTAMP_2\"\u00a0 \u00a0 },\u00a0 \u00a0 \u2026\u00a0 ]}\n```\n- Run the following curl commands to create your controls.- : The project number or ID of your Google Cloud project.\n- : The unique ID of the data store.\n- : A unique identifier (within a data store) for the control. The ID can contain lowercase letters, digits, hyphens, and underscores.\n- : The human-readable name for the control. Google recommends that this name provide an indication of when or why to use the control. Must be a UTF-8 string with length`[1,128]`.\n- : Must be either`SEARCH_USE_CASE_SEARCH`or`SEARCH_USE_CASE_BROWSE`. If`SEARCH_USE_CASE_BROWSE`is specified, then`Condition.queryTerms`can't be used in the condition.\n- : (Optional) Defines when the control should be applied.\n- : Used to define a boost control. See the [boostAction](/generative-ai-app-builder/docs/reference/rest/v1alpha/projects.locations.collections.dataStores.controls#boostaction) API reference.\n- : Used to define a filter control. See the [filterAction](/generative-ai-app-builder/docs/reference/rest/v1alpha/projects.locations.collections.dataStores.controls#filteraction) API reference.\n- : Used to define a synonyms control. See the [synonymsAction](/generative-ai-app-builder/docs/reference/rest/v1alpha/projects.locations.collections.dataStores.controls#synonymsaction) API reference.\n- : Used to specify a redirection URI. See the [redirectAction](/generative-ai-app-builder/docs/reference/rest/v1alpha/projects.locations.collections.dataStores.controls#redirectaction) API reference.\n- Attach the control to the default serving config.", "guide": "Vertex AI Search and Conversation"}