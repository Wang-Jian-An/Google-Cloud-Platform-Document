{"title": "Vertex AI Search and Conversation - Filter healthcare search", "url": "https://cloud.google.com/generative-ai-app-builder/docs/filter-hc-search?hl=zh-cn", "abstract": "# Vertex AI Search and Conversation - Filter healthcare search\n**Caution:** - Restrictions for healthcare: As a customer, you will not, and will not allow End Users to, use the Generative AI Services for clinical purposes (for clarity, non-clinical research, scheduling, or other administrative tasks is not restricted), as a substitute for professional medical advice, or in any manner that is overseen by or requires clearance or approval from any applicable regulatory authority. For more information, see [Service Specific Terms](https://cloud.google.com/terms/service-terms) .\n- The generated output may not always be completely reliable. Due to the nature of LLMs and Generative AI, outputs may have incorrect or biased (for example, stereotypes or other harmful content) information and should be reviewed. All summaries or answers should be considered draft and not final.\n- This product's intended usage is not to provide information pertaining to the prevention, diagnosis or treatment of illness or disease. Questions regarding diagnosis or treatment recommendations are not intended to be addressed by the product. This product's intended use is to retrieve and summarize existing medical information provided by users.\n- Due to limited test data, this product may or may not be applicable to age group 0-18 and to age group 85 and above. Therefore, when reviewing the generated output, customers must consider the representativeness of subpopulations within their source data.When you're querying healthcare data, you can use filters to refine your search responses. In a search request, you can provide filters to enforce criteria that include or exclude certain search responses.\nFor example, when you're [searching over a single patient's data](/generative-ai-app-builder/docs/search-hc-data) , the search request body must contain the following filter expression that specifies the patient ID:\n```\n\"filter\": \"patient_id: ANY(\\\"PATIENT_ID\\\")\"\n```\nThis page shows you how to define filters for healthcare search.\n", "content": "## Before you begin\nBefore you begin, do the following:\n- Create a healthcare search app and a healthcare search data store, and import FHIR R4 data. For more information, see [Create a healthcare search app](/generative-ai-app-builder/docs/create-app-hc) and [Create a healthcare search data store](/generative-ai-app-builder/docs/create-data-store-hc) .\n- Review the list of FHIR R4 resources that Vertex AI Search supports as indexable, searchable, and retrievable fields. For more information, see [Healthcare FHIR R4 data schema reference](/generative-ai-app-builder/docs/fhir-schema-reference) .\n- Understand the [filter expression syntax](/generative-ai-app-builder/docs/filter-search-metadata#filter-expression-syntax) .## Define filters\nFilters are specified in the `filter` field in the request body of the [servingConfigs.search](/generative-ai-app-builder/docs/reference/rest/v1alpha/projects.locations.collections.dataStores.servingConfigs/search) method.\nThe filter definition follows the [filter expression syntax](/generative-ai-app-builder/docs/filter-search-metadata#filter-expression-syntax) . In the filter expression, the literal can be any indexable field from the response to the search query. For example, if the response contains an Observation resource, the `patient_id` that the Observation resource references can be used as a filter literal.\nThe following sections show a few examples on how to construct filters.\n### Define a resource_datetime filter\nThis example shows you how to specify a filter for a search that includes only those resources that have a `resource_datetime` value later than the specified date and time value.\n```\ncurl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n -H \"Content-Type: application/json\" \\\n \"https://us-discoveryengine.googleapis.com/v1alpha/projects/PROJECT_ID/locations/us/collections/default_collection/dataStores/DATA_STORE_ID/servingConfigs/default_search:search\" \\\n -d '{\n\"query\": \"QUERY\",\n\"filter\": \"patient_id: ANY(\\\"PATIENT_ID\\\") AND resource_datetime > \\\"DATE_TIME_VALUE,\n\"contentSearchSpec\":{\"snippetSpec\":{\"returnSnippet\":true}}\n}'\n```\nReplace the following:- ``: the ID of your Google Cloud project.\n- ``: the ID of the Vertex AI Search data store.\n- ``: the search query.\n- ``: the resource ID of the patient whose data you want to search.\n- ``: the value of the`resource_datetime`field that represents a date and time   in the FHIR [dateTime](https://build.fhir.org/datatypes.html#dateTime) format.   Some examples of this field are as follows:- To specify a date and time with a time zone separated by a`T`separator:`2022-08-05T01:00:00+00:00`\n- To specify a date:`2022-08-05`\n- To specify a month:`2022-08`\n- To specify a year:`2022`\n### Define a resource type filter\nThe following example shows how to construct a filter that uses an `AND` operator to first filter all Composition resources and then filter those whose date is later than a specified date and time.\n```\n\"filter\": \"resource_type: ANY(\"Composition\") AND Composition.date > \"2022-08-05T01:00:00+00:00\"\"\n```\n### Define a FHIR resource filter\nYou can use a filter to check whether a FHIR resource is present in the Vertex AI Search data store. For example, you can search for a DocumentReference resource that has the ID `6112d1ac-c6bd-4755-d689-bfb71d59afc5` using the following filter.\n```\n\"filter\": \"DocumentReference.id: ANY(\\\"6112d1ac-c6bd-4755-d689-bfb71d59afc5\\\")\"\n```", "guide": "Vertex AI Search and Conversation"}