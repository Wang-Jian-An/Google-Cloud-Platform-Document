{"title": "Google Kubernetes Engine (GKE) - Configure maintenance windows and exclusions", "url": "https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview", "abstract": "# Google Kubernetes Engine (GKE) - Configure maintenance windows and exclusions\nUse [maintenance windows and maintenance exclusions](/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions) to control when automatic cluster maintenance, such as auto-upgrades, can and cannot occur on your Google Kubernetes Engine (GKE) clusters.\n", "content": "## Before you begin\nBefore you start, make sure you have performed the following tasks:\n- Enable    the Google Kubernetes Engine API.\n- [    Enable Google Kubernetes Engine API   ](https://console.cloud.google.com/flows/enableapi?apiid=container.googleapis.com) \n- If you want to use the Google Cloud CLI for this task, [install](/sdk/docs/install) and then [initialize](/sdk/docs/initializing) the  gcloud CLI. If you previously installed the gcloud CLI, get the latest  version by running`gcloud components update`. **Note:** For existing gcloud CLI  installations, make sure to set the`compute/region`and`compute/zone` [properties](/sdk/docs/properties#setting_properties) . By setting default locations,  you can avoid errors in gcloud CLI like the following:`One of [--zone, --region] must be supplied: Please specify location`.## Configure a maintenance window\nTo configure a maintenance window, specify when it starts, how long it lasts, and how often it repeats. For example, you can configure a maintenance window that recurs weekly on Monday through Friday for four hours each day.\nYou can configure a maintenance window by using the Google Cloud console or the Google Cloud CLI.\n### Considerations when configuring a maintenance window\nWhen configuring a maintenance window, follow this guidance:\n- You must allow at least 48 hours of maintenance availability in a 32-day rolling window. Only contiguous availability windows of at least four hours are considered.\n- When using the Google Cloud console, times are always displayed using the local time zone.\n- Day of the week recurrences are always based on UTC. As a result, we recommend setting maintenance windows involving such recurrences entirely in UTC, through the gcloud CLI. While local time can be used when setting flags, the time zone will not be stored. For example, if your time zone is UTC+6 and you want a maintenance window to start at 02:00 on Wednesdays in your time zone, then specify a UTC value of 20:00 on Tuesdays.\n- If your cluster cannot finish node upgrades within the scheduled maintenance window, this can slow down the rate of upgrades. You might need to experiment with your configuration to find the optimal balance between speed and disruption for your environment. Factors that can affect the upgrade rate include:- Low maintenance availability (for example, short maintenance windows).\n- Large Standard node pools.\n- [Node upgrade strategy](/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies) configuration prioritizing minimal disruption versus speed.\n- Some Pod configuration choices. See [Considerations for node upgrade duration](/kubernetes-engine/docs/concepts/cluster-upgrades#considerations-node-upgrade) for more information.\n### Create a Standard cluster with a simple maintenance window\nYou can create a simple maintenance window in the gcloud CLI by specifying the `--maintenance-window` flag. This flag allows you to specify a daily 4-hour maintenance window using a simplified format. To create an Autopilot cluster with a maintenance window, [use the Google Cloud console](#new_cluster) .\nCreate a new Standard cluster with a simple maintenance window:\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --maintenance-window START_TIME\n```\nReplace the following:\n- ``: The name of your new cluster.\n- ``: A 24-hour timestamp in UTC time, like`16:00`.\nThe maintenance window runs each day at the specified `` and runs for four hours.\n### Create a custom maintenance window\nYou can create a maintenance window that occurs certain times of the week or month using additional parameters explained in this section.\nFor example, the following command creates a cluster named `my-cluster` with a maintenance window enabled at 2:00 AM UTC on Wednesday, August 19, 2026. This maintenance window starts on Mondays and Fridays, and ends 30 hours later. The first occurrence of the maintenance window begins on Friday, August 21 at 2:00 AM and ends on Saturday, August 22, at 8:00 AM. You can learn more about [formatting dates and times](/sdk/gcloud/reference/topic/datetimes) .\n```\ngcloud container clusters create my-cluster \\\n --maintenance-window-start 2026-08-19T02:00:00Z \\\n --maintenance-window-end 2026-08-20T08:00:00Z \\\n --maintenance-window-recurrence 'FREQ=WEEKLY:BYDAY=MO,FR'\n```\nFor more scenarios, see the [example maintenance windows](#example_maintenance_windows) .\nYou can create a new Standard cluster with a maintenance window by using the gcloud CLI or the Google Cloud console. To create a new Autopilot cluster with a maintenance window, use the Google Cloud console.\nCreate a new Standard cluster with a maintenance window:\n```\ngcloud container clusters create CLUSTER_NAME \\\u00a0 \u00a0 --maintenance-window-start START_TIME \\\u00a0 \u00a0 --maintenance-window-end END_TIME \\\u00a0 \u00a0 --maintenance-window-recurrence RRULE\n```\nReplace the following:- ``: The name of the new cluster.\n- ``: The date and time that the recurring maintenance window is enabled, expressed as an [RFC-5545](https://tools.ietf.org/html/rfc5545) DTSTART value. After this time, the maintenance window repeats according to the``. The``also provides at what time of day the maintenance window starts.\n- ``: The end time for calculating the duration of the maintenance window, as expressed by the amount of time after the``, in the same format. The value for``must be in the future, relative to``.\n- ``: The recurrence of the maintenance window, as expressed by an [RFC-5545](https://tools.ietf.org/html/rfc5545) RRULE. This is a flexible format with multiple ways to specify recurrence rules, determining what day the maintenance window starts. For example, you can specify a recurrence of certain times a week or month. If the``date is greater than the``date, the maintenance window spans multiple days. For example, a maintenance window starting on Sunday would continue to Monday.\n- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Click **Create** .\n- Configure your cluster as desired.\n- From the navigation pane, under **Clusters** , click **Automation** .\n- Select the **Enable Maintenance Window** checkbox.\n- Select the start time and length, then select the days of the week on which the maintenance window occurs. To edit the recurrence rule specification ( **RRule** ) directly, select **Custom editor** .\n- Click **Create** .Create or update a maintenance window for an existing cluster:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --maintenance-window-start START_TIME \\\u00a0 \u00a0 --maintenance-window-end END_TIME \\\u00a0 \u00a0 --maintenance-window-recurrence RRULE\n```\nReplace the following:- ``: The name of the new cluster.\n- ``: The date and time that the recurring maintenance window is enabled, expressed as an [RFC-5545](https://tools.ietf.org/html/rfc5545) DTSTART value. After this time, the maintenance window repeats according to the``. The``also provides at what time of day the maintenance window starts.\n- ``: The end time for calculating the duration of the maintenance window, as expressed by the amount of time after the``, in the same format. The value for``must be in the future, relative to``.\n- ``: The recurrence of the maintenance window, as expressed by an [RFC-5545](https://tools.ietf.org/html/rfc5545) RRULE. This is a flexible format with multiple ways to specify recurrence rules, determining what day the maintenance window starts. For example, you can specify a recurrence of certain times a week or month. If the``date is greater than the``date, the maintenance window spans multiple days. For example, a maintenance window starting on Sunday would continue to Monday.\nTo create or modify a maintenance window for an existing cluster:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- Under **Automation** , click **Edit maintenance policy** next to the **Maintenance window** field.\n- Select the **Enable Maintenance Window** checkbox.\n- Select the start time and length, then select the days of the week on which the maintenance window occurs. To edit the **RRule** directly, select **Custom editor** .\n- Click **Save Changes** .\n### Manually finish incomplete maintenance\nIf an upgrade or other automatic maintenance takes longer than the maintenance window to complete, GKE attempts to stop ongoing maintenance tasks and resumes them during the next occurrence of the maintenance window. If an automatic upgrade is canceled, and you have node auto-upgrades enabled, your nodes might be in a mixed-version state but your cluster should operate normally.\nTo manually upgrade your cluster, or cancel or roll back a partial upgrade, visit [Manually upgrading a cluster](/kubernetes-engine/docs/how-to/upgrading-a-container-cluster) .\n### Remove a maintenance window\nRemove a maintenance window from a cluster:\n```\ngcloud container clusters update CLUSTER_NAME --clear-maintenance-window\n```\nReplace `` with the name of the existing cluster.\nTo remove a maintenance window:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- Under **Automation** , click **Edit maintenance policy** next to the **Maintenance window** field.\n- Clear the **Enable Maintenance Window** checkbox.\n- Click **Save Changes** .\n### Example maintenance windows\nThe following examples illustrate some of the different ways you can configure a maintenance window. Only the relevant flags are shown, because the flags use the same syntax for creating a new cluster or updating an existing one.\n## Configure a maintenance exclusion\nTo set up a [maintenance exclusion](/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions#exclusions) for your cluster, you need to specify the following:\n- **Name** : The name of the exclusion (optional).\n- **Start time** : The date and time for when the exclusion period should start.\n- **End time** : The date and time for when the exclusion period should end. Refer to the following table for restrictions on the length of an exclusion period for each of the available scopes.\n- **Scope** : The scope of automatic upgrades to restrict. Refer to the following table that lists the available exclusion scopes.\n| Scope      | Description                                      | Maximum exclusion length               |\n|:--------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------|\n| No upgrades (default)  | Excludes all patch and minor upgrades. Avoids VM disruptions to the cluster's control plane and nodes from upgrades.            | Cannot exceed 30 days.               |\n| No minor upgrades   | Excludes all minor upgrades. VM disruptions can occur to the cluster's control plane and nodes due to patch upgrades.           | Cannot exceed 180 days or extend past the end of life date of the minor version. |\n| No minor or node upgrades | Excludes all minor upgrades and node upgrades. Avoids VM disruptions to the cluster's nodes from upgrades. However, disruptions can occur to the control plane. | Cannot exceed 180 days or extend past the end of life date of the minor version. |\nFor definitions on minor and patch versions, see [Versioning scheme](/kubernetes-engine/versioning#versioning_scheme) .\nMaintenance exclusions have the following limitations:\n- You can restrict the scope of automatic upgrades in a maintenance exclusion only for clusters that are [enrolled in a release channel](/kubernetes-engine/docs/concepts/release-channels#enrolling_a_cluster_in_a_release_channel) .\n- You can add a maximum of 3 maintenance exclusions that exclude all upgrades (that is, a scope of \"no upgrades\").\n- You can have a maximum of 20 maintenance exclusions in total.\n- If you do not specify a scope in your exclusion, the scope defaults to \"no upgrades\".\n### Create a cluster with a maintenance exclusion\nYou can configure a maintenance exclusion when creating a new cluster by using the Google Cloud console. This task cannot be performed in the gcloud CLI.\nTo create a new cluster with a maintenance exclusion:\n- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- Click **Create** .\n- Configure your cluster as desired.\n- From the navigation pane, under **Cluster** , click **Automation** .\n- Under **Maintenance exclusions** , click **Add Maintenance Exclusion** .\n- Select the **Scope** , a **Start time** , and an **End time** .\n- Click **Create** .\nYou can see an example [maintenance exclusion for Black Friday](#example-maintenance-exclusions) .\n### Configure a maintenance exclusion for an existing cluster\nYou can configure a maintenance exclusion on an existing cluster by using the Google Cloud console or the gcloud CLI.\nConfigure a maintenance exclusion for an existing cluster:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --add-maintenance-exclusion-name EXCLUSION_NAME \\\u00a0 \u00a0 --add-maintenance-exclusion-start START_DATE_TIME \\\u00a0 \u00a0 --add-maintenance-exclusion-end END_DATE_TIME \\\u00a0 \u00a0 --add-maintenance-exclusion-scope SCOPE\n```\nReplace the following:- ``: the name of your cluster.\n- ``: the name of the maintenance exclusion.\n- ``: the start date and time for the exclusion.\n- ``: the end date and time for the exclusion.\n- ``: the scope of upgrade to exclude, which can be one of the following values:`no_upgrades`,`no_minor_upgrades`, or`no_minor_or_node_upgrades`.\nTo view supported date and time formats, run [gcloud topic datetimes](/sdk/gcloud/reference/topic/datetimes) .\nTo configure a maintenance exclusion for an existing cluster:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- Under **Automation** , next to the **Maintenance exclusions** field, click **Edit maintenance exclusions** .\n- Under **Maintenance exclusions** , click **Add Maintenance Exclusion** .\n- Select the **Scope** , a **Start time** , and an **End time** .\n- Click **Save Changes** .\n### Remove a maintenance exclusion\nYou can remove maintenance exclusions by using the Google Cloud console or the gcloud CLI.\nRemove an existing maintenance exclusion:\n```\ngcloud container clusters update CLUSTER_NAME \\\u00a0 \u00a0 --remove-maintenance-exclusion EXCLUSION_NAME\n```\nReplace the following:- ``: the name of the existing cluster.\n- ``: the name of the maintenance exclusion to remove.\nTo remove a maintenance exclusion from an existing cluster:- Go to the **Google Kubernetes Engine** page in the Google Cloud console. [Go to Google Kubernetes Engine](https://console.cloud.google.com/kubernetes/list) \n- In the cluster list, click the name of the cluster you want to modify.\n- Under **Automation** , next to the **Maintenance exclusions** field, click **Edit maintenance exclusions** .\n- Under **Maintenance exclusions** , click **Delete item** next to the **End time** field for the exclusion you want to remove.\n- Click **Save Changes** .\nTo see all maintenance exclusions on a cluster, you can [view the cluster's maintenance policy](#viewing-maintenance-policy) .\n### Example maintenance exclusion\nThe following example prevents maintenance over the four days encompassing [Black Friday](https://en.wikipedia.org/wiki/Black_Friday_(shopping)) through [Cyber Monday](https://en.wikipedia.org/wiki/Cyber_Monday) , the highest-volume sales period of the year for many retail businesses. This example shows how to prevent a maintenance window from occurring from Black Friday 2021 (November 26, 2021) to Cyber Monday 2021 (November 29, 2021), from midnight Eastern (UTC-5) to 23:59:59 Pacific (UTC-8).\n```\ngcloud container clusters update sample-cluster \\\n --add-maintenance-exclusion-name black-friday \\\n --add-maintenance-exclusion-start 2021-11-26T00:00:00-05:00 \\\n --add-maintenance-exclusion-end 2021-11-29T23:59:59-08:00 \\\n --add-maintenance-exclusion-scope no_upgrades\n```\n## View a cluster's maintenance policy\nTo view a cluster's maintenance policy, including whether it has a maintenance window and all of its maintenance exclusions, use the following command:\n```\ngcloud container clusters describe CLUSTER_NAME\n```\n## Troubleshooting\n### Restricting the scope of maintenance exclusions can only apply to release channels\nWhen you restrict the scope of automatic upgrades in a maintenance exclusion, the cluster must be enrolled in a [release channel](/kubernetes-engine/docs/concepts/release-channels) , otherwise you might encounter the following errors:\n```\nERROR: (gcloud.container.clusters.update) INVALID_ARGUMENT: Cannot update to\nSTATIC channel since following maintenancePolicy.maintenanceExclusions can only\napply to release channels. Please remove those maintenance exclusions.\n```\n```\nERROR: (gcloud.container.clusters.update) ResponseError: code=400,\nmessage=MaintenancePolicy.maintenanceExclusions[\"no\"] could not apply to cluster\nin STATIC channel, only no_upgrades exclusions are allowed in STATIC channel.\n```\n### Maintenance exclusions exceeds limit\nYou can only specify a maximum of 3 maintenance exclusions that exclude all upgrades (that is, a scope of \"no upgrades\"), otherwise you receive the following error:\n```\nERROR: (gcloud.container.clusters.update) ResponseError: code=400,\nmessage=Number of active maintenance exclusions exceeds limit (3).\n```\nYou can only specify a maximum of 20 maintenance exclusions in total, otherwise you receive the following error:\n```\nERROR: (gcloud.container.clusters.update) ResponseError: code=400,\nmessage=Number of total maintenance exclusions exceeds limit (20).\n```\n## What's next\n- Learn more about [cluster and node upgrades](/kubernetes-engine/docs/concepts/cluster-upgrades) .\n- Learn how to [Enable node auto-upgrade](/kubernetes-engine/docs/how-to/node-auto-upgrades) .\n- Learn how to [Receive cluster notifications](/kubernetes-engine/docs/how-to/cluster-notifications) .", "guide": "Google Kubernetes Engine (GKE)"}