{"title": "Compute Engine - Troubleshooting managed instance groups", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Troubleshooting managed instance groups\nThere are several issues that can prevent a [managed instance group (MIG)](/compute/docs/instance-groups#managed_instance_groups) from successfully creating or recreating a VM instance.\n", "content": "## If logs are generated for a deleted MIG\nThe problem might be related to the following situations.\n### Attached autoscaler still exists\nIf you [deleted](/compute/docs/instance-groups/delete-mig#delete_a_mig) a MIG using the Compute Engine API and you did not issue a separate request to delete the attached autoscaler, the Logs Explorer might show logs with the following message.\n```\nThe resource 'projects/PROJECT/zones/ZONE/instanceGroupManagers/DELETED_INSTANCE_GROUP_NAME' was not found.\n```\n**Resolution** :\nTo resolve this issue, delete the attached autoscaler using the Compute Engine API methods:\n- For an autoscaler of a zonal MIG, use the [autoscalers.delete method](/compute/docs/reference/rest/v1/autoscalers/delete) .\n- For an autoscaler of a regional MIG, use the [regionAutoscalers.delete method](/compute/docs/reference/rest/v1/regionAutoscalers/delete) .## If your MIG cannot create or recreate instances\nThe problem might be related to the following situations.\n### The boot disk already exists\nBy default, a new boot persistent disk is created when you create an instance. The name of the boot disk matches the name of the VM. If you name a VM `my-instance` , the disk is also named `my-instance` . If a persistent disk already exists with that name, the request fails. To resolve this issue, you can optionally [take a snapshot](/compute/docs/disks/create-snapshots) , and then delete the existing persistent disk.\n### The instance template is not valid\nIf you updated your instance template recently, there could be an invalid property that causes the MIG to fail VM creation. Examine the properties for these common errors:\n- You specified a resource that doesn't exist, such as a source image.\n- You misspelled a resource name.\n- You tried to attach an existing non-boot persistent disk in read/write mode but your group contains more than one VM. For groups with more than one VM, any additional disks you want to share between all of the VMs in the group can be attached only in read-only mode.\n### Limit exceeded for resource type\nThe following error occurs when you try to create more than 2,000 VMs in a regional MIG or more than 1,000 VMs in a zonal MIG. You have reached the size limit for your instance group.\n**Error message** :\n```\nERROR: (gcloud.compute.<INSTANCE_GROUP_TYPE>.<METHOD>) Could not\nfetch resource:\n - Exceeded limit 'MAX_INSTANCES_IN_INSTANCE_GROUP' on resource 'PROJECT_ID'.\n Limit: NUMBER\n```\n**Resolution** :\nTo resolve this issue, try one of the following:\n- If you are using a zonal MIG, use a [regional MIG](/compute/docs/instance-groups#types_of_managed_instance_groups) instead.\n- Create multiple MIGs and split your workload across them\u2014for example by adjusting your [load balancing](/compute/docs/instance-groups/adding-an-instance-group-to-a-load-balancer) configuration.\n- If you still need a bigger group, you can [increase the size limit of your MIG](/compute/docs/instance-groups/add-remove-vms-in-mig#increase_the_groups_size_limit) or [contact support](/support-hub) to make a request.## If you cannot delete your MIG or its instances\nThe problem might be related to the following situation.\n### Resource not found in zone or region\nThe following error occurs when you try to delete a regional MIG and you specify the `--zone` flag, specify no region, or specify the wrong region. A similar error can occur if you try to delete a zonal MIG and you specify the `--region` flag.\n**Error message** :\n- ```\nERROR: (gcloud.compute.instance-groups.managed.delete) Some requests did not succeed:\n\u2010 The resource 'projects/PROJECT/zones/ZONE/instanceGroupManagers/INSTANCE_GROUP_NAME' was not found\n```\n- ```\nERROR: (gcloud.compute.instance-groups.managed.delete) Some requests did not succeed:\n\u2010 The resource 'projects/PROJECT/regions/REGION/instanceGroupManagers/INSTANCE_GROUP_NAME' was not found\n```\n**Resolution** :\nTo resolve this issue, try one of the following:\n- Append the appropriate`--region`or`--zone`flag to your command\n- [Set a default region and zone](/compute/docs/gcloud-compute#default-region-zone) \n### Resource is used by a backend service\nYou cannot remove an instance group when it is used by a load balancer's backend service. You must remove the instance from the backend service before you can delete the instance group.\n**Error message** :\n- ```\nERROR: (gcloud.compute.instance-groups.managed.delete) Some requests did not succeed:\n\u2010 The instance_group_manager resource 'projects/PROJECT/zones/ZONE/instanceGroupManagers/INSTANCE_GROUP_NAME is already being used by 'projects/PROJECT/global/backendServices/BACKEND_SERVICE\n```\n- ```\nERROR: (gcloud.compute.instance-groups.managed.delete) Some requests did not succeed:\n\u2010 The instance_group_manager resource 'projects/PROJECT/regions/REGION/instanceGroupManagers/INSTANCE_GROUP_NAME is already being used by 'projects/PROJECT/global/backendServices/BACKEND_SERVICE\n```\n**Resolution** :\n- Optional: Drain the backend instance group.- For [proxy load balancers only](/load-balancing/docs/choosing-load-balancer#lb-summary) , you can set the [capacity scaler](/load-balancing/docs/backend-service#capacity_scaler) to `0.0` before removing the instance group from a backend service. You can set the capacity scaler to zero by using the [gcloud compute backend-services edit command](/sdk/gcloud/reference/compute/backend-services/edit) .\n- For both proxy and pass-through load balancers, if you [enable connection draining](/load-balancing/docs/enabling-connection-draining) on the backend service, Google Cloud attempts to allow existing connections to persist, complete, and drain whenever an instance group is removed from a backend service.\n- Remove the MIG from the regional or global backend service.- For a zonal MIG, run the following command:```\ngcloud compute backend-services remove-backend BACKEND_SERVICE \\\n --instance-group=INSTANCE_GROUP_NAME \\\n --instance-group-zone=ZONE \\\n [--region=REGION | --global]\n```\n- For a regional MIG, run the following command:```\ngcloud compute backend-services remove-backend BACKEND_SERVICE \\\n --instance-group=INSTANCE_GROUP_NAME \\\n --instance-group-region=REGION \\\n [--region=REGION | --global]\n```\n- Delete the MIG:```\ngcloud compute instance-groups managed delete INSTANCE_GROUP_NAME\n```## If your MIG continually tries to recreate instances\nThe problem might be related to the following situation.\n### Health check probes cannot reach the instance\nIf you configured an autohealing policy but you did not configure\u2014or misconfigured\u2014the firewall rule that lets the health check probes reach your application, then your VMs [appear unhealthy](/compute/docs/instance-groups/autohealing-instances-in-migs#checking_the_status) , and the MIG continuously tries to recreate them. For information about how to configure a health check firewall rule, see [Example health check set up](/compute/docs/instance-groups/autohealing-instances-in-migs#example_health_check_set_up) .", "guide": "Compute Engine"}