{"title": "Dialogflow - Messenger from Meta", "url": "https://cloud.google.com/dialogflow/cx/docs/concept/integration/meta-messenger", "abstract": "# Dialogflow - Messenger from Meta\n**    Preview     ** This product or feature is subject to the \"Pre-GA Offerings Terms\" in the General Service Terms section   of the [Service Specific Terms](/terms/service-terms#1) .     Pre-GA products and features are available \"as is\" and might have limited support.    For more information, see the [launch stage descriptions](/products#product-launch-stages) .\nUsing the Dialogflow Meta Messenger integration, you can create a Meta Messenger bot to interact with your end-users.\n**Note:** When using a third party integration, requests and end-user data are sent to both Google and the third party. The terms of service, SLA, pricing, and quotas [for your agent edition](/dialogflow/docs/editions) are applicable for Google's handling of these requests. The third party's terms of service, SLA, pricing, and quotas are applicable for the third party's handling of these requests.\n", "content": "## How it works\n**Note:** This integration does not support [Workplace from Meta](https://developers.facebook.com/docs/workplace) .\nThis is how the integration works:\n- You create a Meta app that uses the [Meta Messenger Platform](https://developers.facebook.com/docs/messenger-platform/overview) .\n- You configure the Dialogflow integration and Meta app, so that they communicate with each other.\n- The Dialogflow integration sends messages to the end-user by using the [Meta Messenger API](https://developers.facebook.com/docs/messenger-platform/reference/send-api/) .\n- The Dialogflow integration receives messages from the end-user by acting as the [Meta Webhooks for Messenger Platform](https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/) .## Setup\n**Note:** Make sure [billing is enabled](/dialogflow/cx/docs/quick/setup#billing) on your project before testing the integration.\nTo set up the integration:\n- Follow the steps to create a Meta app: [Meta App Development](https://developers.facebook.com/docs/apps) .\n- Set up the Meta app to use the Meta Messenger Platform. Follow the steps in the [Meta Webhooks for Messenger Platform](https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup) documentation to accomplish the following:- Add the Messenger Platform to your Meta app.\n- Subscribe your app to a Meta page. Make sure`messages`and`messaging_postbacks`are enabled in the page subscription.\n- You are provided with an access token at this step. Copy this value. This token will be used to configure the integration from the Dialogflow Console.\n- Do not configure the webhook or test your integration yet.\n- Configure the integration from the Dialogflow Console:- Go to the [Dialogflow CX Console](https://dialogflow.cloud.google.com/cx/projects) .\n- Click the **Manage** tab on the left panel.\n- Click **Integrations** in the left sidebar menu.\n- Click the **Connect** button on the **Meta Messenger** tile.\n- A configuration dialog opens:- **App secret** : Enter the app secret from [App Dashboard Basic Settings](https://developers.facebook.com/docs/development/create-an-app/app-dashboard/basic-settings) .\n- **Verify token** : You can enter any private token you desire. Copy this value. This will be used to configure the Meta Messenger Webhook.\n- **Page access token** : Enter the access token you copied during the Meta app setup above.\n- **Enable get started button** : Please see [Get started button](#get-started-button) section.\n- **Webhook URL** : Copy this value. This will be used to configure the Meta Messenger Webhook.\n- **Start** : Click to start this integration service for your agent.\n- Finish setup of the Meta app and test it. Follow steps in the [Meta Webhooks for Messenger Platform](https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup) documentation to accomplish the following:- Configure the Meta webhook for your app. Use the **Webhook URL** and **Verify token** values you copied above. Be sure to enable`messages`and`messaging_postbacks`in the page subscription.\n- Test your app.\n## Events\nThe following events are invoked by this integration. You can create [custom event handlers](/dialogflow/cx/docs/concept/handler?hl=en#event-custom) to define what to do when the events are triggered.\n| Event   | Description                      |\n|:-----------------|:---------------------------------------------------------------------------------------------------|\n| FACEBOOK_WELCOME | Triggered when an end-user clicks the Meta Messenger Get Started Button.       |\n| FACEBOOK_MEDIA | Triggered when the message from an end-user contains attachments (E.g., audio, image, video, etc). |\n## Get started button\nTo set up [Meta Messenger Get Started Button](https://developers.facebook.com/docs/messenger-platform/reference/messenger-profile-api/get-started-button/) :\n- Toggle **Enable get started button** when enabling this integration service.- This integration service will enable the button for you by calling [Messenger Profile API](https://developers.facebook.com/docs/messenger-platform/reference/messenger-profile-api) .```\ncurl -X POST \\\n-H \"Content-Type: application/json\" \\\n-d '{\"get_started\": {\"payload\": \"FACEBOOK_WELCOME\"}}' \\\n\"https://graph.facebook.com/v10.0/me/messenger_profile?access_token=${PAGE_ACCESS_TOKEN}\"\n```\n- Create a [custom event handler](/dialogflow/cx/docs/concept/handler?hl=en#event-custom) for `FACEBOOK_WELCOME` event.\nTo test it:\n- Delete the previous conversation with your Meta page (if applicable).- The **Get Started** button only shows up on new conversations.\n- Start a new conversation with your Meta page.\n- Click the **Get Started** button, and verify the response from the custom event handler.\nYou can always call [Messenger Profile API](https://developers.facebook.com/docs/messenger-platform/reference/messenger-profile-api) to manage the **Get Started** button. This might be helpful for testing.\nFor example, the following request checks the status of **Get Started** button:\n```\ncurl -X GET \\\n\"https://graph.facebook.com/v10.0/me/messenger_profile?fields=get_started&access_token=${PAGE_ACCESS_TOKEN}\"\n```\nThe following request disables the **Get Started** button:\n```\ncurl -X DELETE \\\n-H \"Content-Type: application/json\" \\\n-d '{\"fields\": [\"get_started\"]}' \\\n\"https://graph.facebook.com/v10.0/me/messenger_profile?access_token=${PAGE_ACCESS_TOKEN}\"\n```\n## Rich response messages\nThe rich response messages are supported via **Custom Payload** in [Fulfillment](/dialogflow/cx/docs/concept/fulfillment) . Please see [Send API Parameters Message Object](https://developers.facebook.com/docs/messenger-platform/reference/send-api#parameters) for the message format.\nFor example, the following custom payload provides a simple text message:\n```\n{\n \"text\": \"Hello, world\"\n}\n```\nThe following custom payload provides an image message:\n```\n{\n \"attachment\": {\n \"type\": \"image\",\n \"payload\": {\n  \"url\": \"https://example.com/test.jpg\"\n }\n }\n}\n```\n## Channel specific responses\nWhen configured, [channel specific responses](/dialogflow/cx/docs/concept/fulfillment#channel-specific) with channel `DF_CX_FB_MESSENGER` will be automatically used when the agent responds to Meta Messenger messages.", "guide": "Dialogflow"}