{"title": "Dialogflow - Dialogflow Messenger", "url": "https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger?hl=zh-cn", "abstract": "# Dialogflow - Dialogflow Messenger\n\u6b64\u96c6\u6210\u7232\u60a8\u7684 [\u4ee3\u7406](https://cloud.google.com/dialogflow/cx/docs/concept/agent?hl=zh-cn) \u63d0\u4f9b\u4e86\u53ef\u5d4c\u5165\u5230\u60a8\u7db2\u7ad9\u7684\u53ef\u81ea\u5b9a\u7fa9\u804a\u5929\u5c0d\u8a71\u6846\u3002\n", "content": "## \u8a2d\u7f6e\n\u6b64\u96c6\u6210\u53ef\u5141\u8a31\u901a\u904e\u8eab\u4efd\u9a57\u8b49\u6216\u672a\u7d93\u8eab\u4efd\u9a57\u8b49\u7684\u6700\u7d42\u7528\u6236\u4ee3\u7406\u67e5\u8a62\u8a2a\u554f\u3002\n### \u672a\u901a\u904e\u8eab\u4efd\u9a57\u8b49\u7684\u8a2d\u7f6e\n**\u6ce8\u610f** \uff1a\u5728\u6e2c\u8a66\u96c6\u6210\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u7684\u9805\u76ee [\u5df2\u5553\u7528\u7d50\u7b97\u529f\u80fd](https://cloud.google.com/dialogflow/cx/docs/quick/setup?hl=zh-cn#billing) \u3002\n\u5982\u9700\u8a2d\u7f6e\u5c0d Dialogflow Messenger \u4ee3\u7406\u7684\u672a\u7d93\u8eab\u4efd\u9a57\u8b49\u7684\u8a2a\u554f\u6b0a\u9650\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u8f49\u5230 [Dialogflow CX \u63a7\u5236\u6aaf](https://dialogflow.cloud.google.com/cx/projects?hl=zh-cn) \u3002\n- \u9078\u64c7\u60a8\u7684 Google Cloud \u9805\u76ee\u3002\n- \u9078\u64c7\u60a8\u7684\u4ee3\u7406\u3002\n- \u9078\u64c7 **\u7ba1\u7406** \u6a19\u7c64\u9801\u3002\n- \u9ede\u64ca\u5de6\u5074\u908a\u6b04\u83dc\u55ae\u4e2d\u7684 **\u96c6\u6210** \u3002\n- \u9ede\u64ca **Dialogflow Messenger** \u4e0a\u7684 **\u9023\u63a5** \u3002\n- \u6b64\u6642\u5c07\u6253\u958b\u4e00\u500b\u914d\u7f6e\u5c0d\u8a71\u6846\u3002\n- \u5982\u679c\u4e4b\u524d\u5df2\u7232\u6b64\u4ee3\u7406\u8a2d\u7f6e\u4e86\u96c6\u6210\uff0c\u60a8\u5c07\u770b\u5230\u53ef\u5d4c\u5165\u7684 HTML \u4ee3\u78bc\u3002\u7121\u8ad6\u60a8\u60f3\u8981\u4e86\u89e3\u54ea\u4e9b\u5df2\u901a\u904e\u8eab\u4efd\u9a57\u8b49\uff0c\u54ea\u4e9b\u9700\u8981\u672a\u901a\u904e\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u9ede\u64ca\u5c0d\u8a71\u6846\u5e95\u90e8\u7684 **\u505c\u7528...** \u6309\u9215\uff0c\u4ee5\u4fbf\u5728\u4e0b\u4e00\u6b65\u4e2d\u91cd\u65b0\u914d\u7f6e\u8a2d\u7f6e\u3002\n- \u9078\u64c7 **\u74b0\u5883** \u3002\n- \u9078\u64c7 **\u672a\u901a\u904e\u8eab\u4efd\u9a57\u8b49\u7684 API** \u3002\n- \u9078\u64c7\u4e00\u7a2e\u98a8\u683c\u3002\n- \uff08\u53ef\u9078\uff09\u9650\u5236\u7db2\u57df\u8a2a\u554f\u6b0a\u9650\u3002\n- \u9ede\u64ca **\u5553\u7528\u672a\u7d93\u8eab\u4efd\u9a57\u8b49\u7684 API** \u3002\n- \u8a72\u5c0d\u8a71\u6846\u6703\u986f\u793a\u53ef\u5d4c\u5165\u5230\u60a8\u7db2\u7ad9\u4e0a\u7684\u53ef\u5d4c\u5165 HTML \u4ee3\u78bc\u3002 \u8907\u88fd\u6b64\u9a57\u8b49\u78bc\u3002\n- \u9ede\u64ca **\u5b8c\u6210** \u3002### \u57fa\u65bc\u8eab\u4efd\u9a57\u8b49\u7684\u8a2d\u7f6e\n\u5982\u9700\u8a2d\u7f6e\u5c0d Dialogflow Messenger \u4ee3\u7406\u7684\u7d93\u904e\u8eab\u4efd\u9a57\u8b49\u7684\u8a2a\u554f\u6b0a\u9650\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u8f49\u5230 [Dialogflow CX \u63a7\u5236\u6aaf](https://dialogflow.cloud.google.com/cx/projects?hl=zh-cn) \u3002\n- \u9078\u64c7\u60a8\u7684 Google Cloud \u9805\u76ee\u3002\n- \u9078\u64c7\u60a8\u7684\u4ee3\u7406\u3002\n- \u9078\u64c7 **\u7ba1\u7406** \u6a19\u7c64\u9801\u3002\n- \u9ede\u64ca\u5de6\u5074\u908a\u6b04\u83dc\u55ae\u4e2d\u7684 **\u96c6\u6210** \u3002\n- \u9ede\u64ca **Dialogflow Messenger** \u4e0a\u7684 **\u9023\u63a5** \u3002\n- \u6b64\u6642\u5c07\u6253\u958b\u4e00\u500b\u914d\u7f6e\u5c0d\u8a71\u6846\u3002\n- \u5982\u679c\u4e4b\u524d\u5df2\u7232\u6b64\u4ee3\u7406\u8a2d\u7f6e\u4e86\u96c6\u6210\uff0c\u60a8\u5c07\u770b\u5230\u53ef\u5d4c\u5165\u7684 HTML \u4ee3\u78bc\u3002\u7121\u8ad6\u60a8\u60f3\u8981\u4e86\u89e3\u54ea\u4e9b\u5df2\u901a\u904e\u8eab\u4efd\u9a57\u8b49\uff0c\u54ea\u4e9b\u9700\u8981\u672a\u901a\u904e\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u9ede\u64ca\u5c0d\u8a71\u6846\u5e95\u90e8\u7684 **\u505c\u7528...** \u6309\u9215\uff0c\u4ee5\u4fbf\u5728\u4e0b\u4e00\u6b65\u4e2d\u91cd\u65b0\u914d\u7f6e\u8a2d\u7f6e\u3002\n- \u9078\u64c7 **\u74b0\u5883** \u3002\n- \u9078\u64c7 **\u5df2\u7372\u6388\u6b0a\u7684 API** \u3002\n- \u9078\u64c7\u4e00\u7a2e\u98a8\u683c\u3002\n- \uff08\u53ef\u9078\uff09\u9650\u5236\u7db2\u57df\u8a2a\u554f\u6b0a\u9650\u3002\n- \u9ede\u64ca **\u5553\u7528\u5df2\u7372\u6388\u6b0a\u7684 API** \u3002\n- \u8a72\u5c0d\u8a71\u6846\u6703\u986f\u793a\u53ef\u5d4c\u5165\u5230\u60a8\u7db2\u7ad9\u4e0a\u7684\u53ef\u5d4c\u5165 HTML \u4ee3\u78bc\u3002 \u8907\u88fd\u6b64\u9a57\u8b49\u78bc\u3002\n- \u9ede\u64ca **\u5b8c\u6210** \u3002\n- \u8a2d\u7f6e OAuth \u5ba2\u6236\u7aef\uff1a- \u7232\u60a8\u7684\u7d44\u7e54 [\u5275\u5efa OAuth \u6b0a\u9650\u8acb\u6c42\u9801\u9762](https://developers.google.com/workspace/guides/configure-oauth-consent?hl=zh-cn) \u3002 \u5c07`./auth/cloud-platform`\u6dfb\u52a0\u7232\u5fc5\u9700\u7684\u7bc4\u570d\u3002\n- [\u5275\u5efa OAuth 2.0 \u5ba2\u6236\u7aef ID](https://developers.google.com/workspace/guides/create-credentials?hl=zh-cn#oauth-client-id) \u3002 \u5728 **\u5df2\u7372\u6388\u6b0a\u7684 JavaScript \u4f86\u6e90** \u4e0b\uff0c\u6307\u5b9a\u5141\u8a31\u8a17\u7ba1\u548c\u67e5\u8a62\u4ee3\u7406\u7684 HTTP \u4f86\u6e90\u3002\u4f8b\u5982`https://your-company.com`\u3002\n- [\u5411\u6700\u7d42\u7528\u6236\u63d0\u4f9b\u67e5\u8a62\u4ee3\u7406\u7684\u6b0a\u9650](https://cloud.google.com/dialogflow/cx/docs/concept/access-control?hl=zh-cn) \u3002\u5c07\u6bcf\u500b\u6700\u7d42\u7528\u6236\u6216\u4e00\u500b [\u7fa3\u7d44](https://cloud.google.com/iam/docs/groups-in-cloud-console?hl=zh-cn) \u6dfb\u52a0\u7232\u4e3b\u5e33\u865f\uff0c\u4f75\u7232\u5176\u6388\u4e88 **Dialogflow API \u5ba2\u6236\u7aef** \u89d2\u8272\u3002**\u6ce8\u610f** \uff1a\u6700\u7d42\u7528\u6236\u9996\u6b21\u4f7f\u7528\u7d93\u904e\u8eab\u4efd\u9a57\u8b49\u7684\u96c6\u6210\u6642\uff0c\u7cfb\u7d71\u6703\u8981\u6c42\u4ed6\u5011\u9078\u64c7\u8981\u5141\u8a31\u7684\u7bc4\u570d\u3002\u5b83\u5011\u5fc5\u9808\u5141\u8a31\u4f7f\u7528 Cloud API\u3002\n## \u5d4c\u5165\u7248\n\u5c07\u60a8\u4e4b\u524d\u8907\u88fd\u7684\u5d4c\u5165\u4ee3\u78bc\u7c98\u8cbc\u5230\u60a8\u7db2\u7ad9\u4e0a\u7684\u7db2\u9801\u4e2d\u3002 `<script>` \u548c `<df-messenger>` HTML \u5143\u7d20\u61c9\u4f4d\u65bc\u7db2\u9801\u7684 `<body>` \u5143\u7d20\u4e2d\u3002\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u7d93\u904e\u8eab\u4efd\u9a57\u8b49\u7684\u96c6\u6210\uff0c\u8acb\u5c07 `<df-messenger>` \u7684 `oauth-client-id` \u5c6c\u6027\u8a2d\u7f6e\u7232\u60a8\u7684 OAuth \u5ba2\u6236\u7aef ID\u3002\n\u66f4\u65b0\u4efb\u4f55\u5176\u4ed6\u9700\u8981\u66f4\u65b0\u7684\u5c6c\u6027\u3002\n\u5982\u9700\u652f\u6301\u81ea\u9069\u61c9\u4f48\u5c40\uff0c\u8acb\u5c07\u4ee5\u4e0b\u4ee3\u78bc\u6dfb\u52a0\u5230 `<head>` \u5143\u7d20\u4e2d\uff1a\n```\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n```\n## \u81ea\u5b9a\u7fa9\n\u60a8\u53ef\u4ee5\u61c9\u7528\u591a\u7a2e [HTML \u81ea\u5b9a\u7fa9](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger/html?hl=zh-cn) \u548c [CSS \u81ea\u5b9a\u7fa9](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger/css?hl=zh-cn) \uff0c\u4f86\u5f71\u97ff\u804a\u5929\u5c0d\u8a71\u6846\u7684\u5916\u89c0\u548c\u884c\u7232\u3002\n## JavaScript\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u8a31\u591a [JavaScript \u4e8b\u4ef6](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger/javascript-events?hl=zh-cn) \u548c [JavaScript \u51fd\u6578](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger/javascript-functions?hl=zh-cn) \u8207\u804a\u5929\u5c0d\u8a71\u6846\u9032\u884c\u4ea4\u4e92\u3002\n## \u793a\u4f8b\n\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86 HTML \u81ea\u5b9a\u7fa9\u3001CSS \u81ea\u5b9a\u7fa9\u548c JavaScript \u4e8b\u4ef6\u8655\u7406\uff1a\n```\n<!DOCTYPE html><html><head>\u00a0 <meta charset=\"utf-8\">\u00a0 <meta http-equiv=\"Cache-Control\" content=\"no-cache, no-store, must-revalidate\" />\u00a0 <meta http-equiv=\"Pragma\" content=\"no-cache\" />\u00a0 <meta http-equiv=\"Expires\" content=\"0\" />\u00a0 <title>My chat</title>\u00a0 <style>\u00a0 \u00a0 df-messenger {\u00a0 \u00a0 \u00a0 /*\u00a0 \u00a0 \u00a0 \u00a0* Customize as required. df-messenger will fill the\u00a0 \u00a0 \u00a0 \u00a0* space that is provided.\u00a0 \u00a0 \u00a0 */\u00a0 \u00a0 \u00a0 position: absolute;\u00a0 \u00a0 \u00a0 right: 0;\u00a0 \u00a0 \u00a0 top: 0;\u00a0 \u00a0 \u00a0 bottom: 0;\u00a0 \u00a0 \u00a0 width: 320px;\u00a0 \u00a0 }\u00a0 </style>\u00a0 <script src=\"https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js\"></script></head><body><df-messenger\u00a0 \u00a0 location=\"global\" <!-- TODO: update agent location as needed -->\u00a0 \u00a0 project-id=\"my-project-id\" <!-- TODO: update project ID -->\u00a0 \u00a0 agent-id=\"my-agent-id\" <!-- TODO: update agent ID -->\u00a0 \u00a0 language-code=\"en\" <!-- TODO: update agent language as needed -->>\u00a0 <df-messenger-chat\u00a0 \u00a0 \u00a0 chat-title=\"Agent Name\" <!-- TODO: update dialog title as needed -->\u00a0 ></df-messenger-chat></df-messenger><script>\u00a0 // An example of handling events: Navigate to the first suggested URL.\u00a0 document.addEventListener('df-url-suggested', (event) => {\u00a0 \u00a0 if (Array.isArray(event.detail.suggestedUrls) &&\u00a0 \u00a0 \u00a0 event.detail.suggestedUrls.length) {\u00a0 \u00a0 \u00a0 window.location.href = event.detail.suggestedUrls[0];\u00a0 }});</script></body></html>\n```\n## Fulfillment\n\u60a8\u53ef\u4ee5\u5c07\u8a31\u591a [fulfillment \u97ff\u61c9\u985e\u578b](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger/fulfillment?hl=zh-cn) \u7528\u65bc\u4ee3\u7406\u97ff\u61c9\u3002\n## \u56de\u7b54\u53cd\u994b\n\u5982\u679c\u5553\u7528\u4e86 [\u56de\u7b54\u53cd\u994b](https://cloud.google.com/dialogflow/cx/docs/concept/answer-feedback?hl=zh-cn#enable_feedback) \uff0c\u804a\u5929\u5c0d\u8a71\u6846\u6703\u9ed8\u8a8d\u5411\u754c\u9762\u6dfb\u52a0\u201c\u6211\u559c\u6b61\u201d thumb_up \u548c\u201c\u4e0d\u559c\u6b61\u201d thumb_down \u6309\u9215\u3002\u5728\u5c0d\u8a71\u671f\u9593\uff0c\u6700\u7d42\u7528\u6236\u53ef\u4ee5\u9ede\u64ca\u9019\u4e9b\u6309\u9215\u4f86\u63d0\u4f9b\u6709\u95dc\u4ee3\u7406\u97ff\u61c9\u7684\u53cd\u994b\u3002\u5982\u679c\u7528\u6236\u9078\u64c7\u201c\u4e0d\u559c\u6b61\u201d\uff0c\u5247\u53ef\u4ee5\u9078\u64c7\u63d0\u4f9b\u8ca0\u9762\u53cd\u994b\u7684\u539f\u56e0\u3002\n### \u81ea\u5b9a\u7fa9\u53cd\u994b\u7d44\u4ef6\n\u82e5\u8981\u6307\u5b9a\u81ea\u5b9a\u7fa9\u53cd\u994b\u5143\u7d20\uff0c\u5fc5\u9808\u5728\u7db2\u7ad9\u4e0a\u5b9a\u7fa9\u65b0\u7684 [\u81ea\u5b9a\u7fa9\u5143\u7d20](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements) \u3002\u5982\u9700\u63d0\u4ea4\u53cd\u994b\uff0c\u5143\u7d20\u5fc5\u9808\u767c\u51fa `df-custom-submit-feedback-clicked` \u4e8b\u4ef6\u3002\u5305\u542b\u7684 `detail` \u5b57\u6bb5\u5fc5\u9808\u662f\u5b57\u7b26\u4e32\u3002\n```\nclass CustomFeedbackElement extends HTMLElement {\u00a0 constructor() {\u00a0 \u00a0 super();\u00a0 \u00a0 // It is not strictly required but recommended to contain the custom\u00a0 \u00a0 // element in a shadow root.\u00a0 \u00a0 this.renderRoot = this.attachShadow({mode: 'open'});\u00a0 }\u00a0 // Web component Lifecycle method.\u00a0 connectedCallback() {\u00a0 \u00a0 const wrapper = document.createElement('div');\u00a0 \u00a0 // Build the component as required.\u00a0 \u00a0 const button = document.createElement('button');\u00a0 \u00a0 button.innerText = 'Submit';\u00a0 \u00a0 button.addEventListener('click', () => {\u00a0 \u00a0 \u00a0 this._onSubmitClick();\u00a0 \u00a0 });\u00a0 \u00a0 wrapper.appendChild(button);\u00a0 \u00a0 this.renderRoot.appendChild(wrapper);\u00a0 }\u00a0 // Called when Submit button is clicked.\u00a0 _onSubmitClick() {\u00a0 \u00a0 const event = new CustomEvent(\"df-custom-submit-feedback-clicked\", {\u00a0 \u00a0 \u00a0 // `detail` may be any string,\u00a0 \u00a0 \u00a0 // this will be sent to the backend to be stored.\u00a0 \u00a0 \u00a0 detail: JSON.stringify({\u00a0 \u00a0 \u00a0 \u00a0 \"usefulness\": 2,\u00a0 \u00a0 \u00a0 \u00a0 \"accuracy\": 3,\u00a0 \u00a0 \u00a0 }),\u00a0 \u00a0 \u00a0 // Required to propagate up the DOM tree\u00a0 \u00a0 \u00a0 // https://developer.mozilla.org/en-US/docs/Web/API/Event/bubbles\u00a0 \u00a0 \u00a0 bubbles: true,\u00a0 \u00a0 \u00a0 // Required to propagate across ShadowDOM\u00a0 \u00a0 \u00a0 // https://developer.mozilla.org/en-US/docs/Web/API/Event/composed\u00a0 \u00a0 \u00a0 composed: true,\u00a0 \u00a0});\u00a0 \u00a0this.dispatchEvent(event);\u00a0 }}(function() {\u00a0 // Registers the element. This name must be \"df-external-custom-feedback\".\u00a0 customElements.define('df-external-custom-feedback', CustomFeedbackElement);})();\n```\n## \u8abf\u8a66\n\u8981\u5728\u672c\u5730\u4f7f\u7528 Dialogflow Messenger \u6e2c\u8a66\u60a8\u7684\u4ee3\u7406\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u6309\u4e0a\u8ff0\u8aaa\u660e\u5c07 Dialogflow Messenger \u5143\u7d20\u5d4c\u5165\u9801\u9762\u4e2d\u3002\n- \u4f7f\u7528\u7279\u5b9a\u7aef\u53e3\u5553\u52d5\u8a72\u9801\u9762\u7684\u672c\u5730 HTTP \u670d\u52d9\u5668\u3002\n- \u901a\u904e`http://localhost:port_number`\u8a2a\u554f\u8a72\u9801\u9762\u3002", "guide": "Dialogflow"}