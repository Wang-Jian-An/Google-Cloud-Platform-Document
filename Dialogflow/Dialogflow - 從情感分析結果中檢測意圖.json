{"title": "Dialogflow - \u5f9e\u60c5\u611f\u5206\u6790\u7d50\u679c\u4e2d\u6aa2\u6e2c\u610f\u5716", "url": "https://cloud.google.com/dialogflow/es/docs/how/sentiment?hl=zh-cn", "abstract": "# Dialogflow - \u5f9e\u60c5\u611f\u5206\u6790\u7d50\u679c\u4e2d\u6aa2\u6e2c\u610f\u5716\n\u60c5\u611f\u5206\u6790\u53ef\u6aa2\u67e5\u7528\u6236\u8f38\u5165\u7684\u5167\u5bb9\uff0c\u4e26\u78ba\u5b9a\u5176\u4e2d\u4e3b\u5c0e\u6027\u7684\u4e3b\u89c0\u610f\u898b\uff0c\u5c24\u5176\u662f\u78ba\u5b9a\u7528\u6236\u7684\u614b\u5ea6\u662f\u7a4d\u6975\u3001\u6d88\u6975\u9084\u662f\u4e2d\u7acb\u7684\u3002 \u5728\u767c\u51fa\u6aa2\u6e2c\u610f\u5716\u8acb\u6c42\u6642\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u8981\u57f7\u884c\u60c5\u611f\u5206\u6790\uff0c\u7136\u5f8c\u97ff\u61c9\u5c31\u6703\u5305\u542b\u60c5\u611f\u5206\u6790\u503c\u3002\nDialogflow \u4f7f\u7528 Natural Language API \u4f86\u57f7\u884c\u6b64\u5206\u6790\u4efb\u52d9\u3002 \u5982\u9700\u8a73\u7d30\u77ad\u89e3\u8a72 API \u4e26\u95b1\u8b80\u95dc\u65bc\u5982\u4f55\u89e3\u8b80 Dialogflow \u60c5\u611f\u5206\u6790\u7d50\u679c\u7684\u6587\u7ae0\uff0c\u8acb\u8a2a\u554f\uff1a\n- [\u60c5\u611f\u5206\u6790](https://cloud.google.com/natural-language/docs/basics?hl=zh-cn#sentiment_analysis) \n- [\u89e3\u8b80\u60c5\u611f\u5206\u6790\u503c](https://cloud.google.com/natural-language/docs/basics?hl=zh-cn#interpreting_sentiment_analysis_values) \n**\u6ce8\u610f** \uff1a\u5982\u679c\u60c5\u611f\u5206\u6790\u5f97\u5206\u7232 0\uff0c\u5247\u8fd4\u56de\u7684 `sentimentAnalysisResult` \u5b57\u6bb5\u5c07\u7232\u7a7a\u3002 \u5982\u679c\u60a8\u5e0c\u671b\u5728\u97ff\u61c9\u4e2d\u660e\u78ba\u986f\u793a 0 \u503c\uff0c\u8acb\u53c3\u95b1 `$outputDefaults` [\u7cfb\u7d71\u53c3\u6578](https://cloud.google.com/apis/docs/system-parameters?hl=zh-cn#definitions) \u3002\n", "content": "## \u652f\u6301\u7684\u8a9e\u8a00\n\u5982\u9700\u67e5\u770b\u53d7\u652f\u6301\u8a9e\u8a00\u7684\u5217\u8868\uff0c\u8acb\u53c3\u95b1 **\u8a9e\u8a00** \u9801\u9762\u4e0a\u7684 [\u60c5\u611f](https://cloud.google.com/dialogflow/docs/reference/language?hl=zh-cn) \u5217\u3002 \u5982\u679c\u60a8\u91dd\u5c0d\u4e0d\u53d7\u652f\u6301\u7684\u8a9e\u8a00\u8acb\u6c42\u60c5\u611f\u5206\u6790\uff0c\u5247\u6aa2\u6e2c\u610f\u5716\u8acb\u6c42\u4e0d\u6703\u5931\u6557\uff0c\u4f46 `QueryResult.diagnostic_info` \u5b57\u6bb5\u6703\u5305\u542b\u932f\u8aa4\u4fe1\u606f\u3002\n## \u6e96\u5099\u5de5\u4f5c\n\u6b64\u529f\u80fd\u50c5\u9069\u7528\u65bc\u4f7f\u7528 API [\u8207\u6700\u7d42\u7528\u6236\u4e92\u52d5](https://cloud.google.com/dialogflow/docs/api-overview?hl=zh-cn) \u7684\u60c5\u6cc1\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f [\u96c6\u6210](https://cloud.google.com/dialogflow/docs/integrations?hl=zh-cn) \u670d\u52d9\uff0c\u5247\u53ef\u4ee5\u8df3\u904e\u672c\u6307\u5357\u3002\n\u5728\u95b1\u8b80\u672c\u6307\u5357\u4e4b\u524d\uff0c\u8acb\u5148\u5b8c\u6210\u4ee5\u4e0b\u4e8b\u9805\uff1a\n- \u95b1\u8b80 [Dialogflow \u57fa\u790e\u77e5\u8b58](https://cloud.google.com/dialogflow/docs/basics?hl=zh-cn) \u3002\n- \u57f7\u884c [\u8a2d\u7f6e\u6b65\u9a5f](https://cloud.google.com/dialogflow/docs/quick/setup?hl=zh-cn) \u3002## \u5275\u5efa\u4ee3\u7406\n\u5982\u679c\u5c1a\u672a\u5275\u5efa\u4ee3\u7406\uff0c\u8acb\u7acb\u5373\u5275\u5efa\u4e00\u500b\uff1a- \u8f49\u5230 [Dialogflow ES \u63a7\u5236\u6aaf](https://dialogflow.cloud.google.com?hl=zh-cn) \u3002\n- \u5982\u679c\u7cfb\u7d71\u8981\u6c42\u767b\u9304 Dialogflow \u63a7\u5236\u6aaf\uff0c\u8acb\u767b\u9304\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Dialogflow \u63a7\u5236\u6aaf\u6982\u89bd](https://cloud.google.com/dialogflow/docs/console?hl=zh-cn) \u3002\n- \u9ede\u64ca\u5de6\u5074\u908a\u6b04\u83dc\u55ae\u4e2d\u7684 **\u5275\u5efa\u4ee3\u7406** (Create Agent)\u3002\u5982\u679c\u60a8\u5df2\u6709\u5176\u4ed6\u4ee3\u7406\uff0c\u8acb\u9ede\u64ca\u4ee3\u7406\u540d\u7a31\uff0c\u6efe\u52d5\u5230\u5e95\u90e8\uff0c\u7136\u5f8c\u9ede\u64ca **\u5275\u5efa\u65b0\u4ee3\u7406** (Create new agent)\u3002\n- \u8f38\u5165\u60a8\u7684\u4ee3\u7406\u540d\u7a31\u3001\u9ed8\u8a8d\u8a9e\u8a00\u548c\u9ed8\u8a8d\u6642\u5340\u3002\n- \u5982\u679c\u60a8\u5df2\u7d93\u5275\u5efa\u4e86\u9805\u76ee\uff0c\u8acb\u8f38\u5165\u8a72\u9805\u76ee\u3002\u5982\u679c\u8981\u5141\u8a31 Dialogflow \u63a7\u5236\u6aaf\u5275\u5efa\u9805\u76ee\uff0c\u8acb\u9078\u64c7 **\u5275\u5efa\u65b0 Google \u9805\u76ee** (Create a new Google project)\u3002\n- \u9ede\u64ca **\u5275\u5efa** (Create) \u6309\u9215\u3002## \u5c07\u793a\u4f8b\u6587\u4ef6\u5c0e\u5165\u4ee3\u7406\n\u672c\u6307\u5357\u4e2d\u7684\u6b65\u9a5f\u5c0d\u60a8\u7684\u4ee3\u7406\u9032\u884c\u4e86\u5047\u8a2d\uff0c\u56e0\u6b64\u60a8\u9700\u8981 [import](https://cloud.google.com/dialogflow/docs/agents-settings?hl=zh-cn#export) \u7232\u672c\u6307\u5357\u6e96\u5099\u7684\u4ee3\u7406\u3002 \u5c0e\u5165\u6642\uff0c\u9019\u4e9b\u6b65\u9a5f\u4f7f\u7528 \u201c\u6062\u5fa9\u201d(restore) \u9078\u9805\uff0c\u8a72\u9078\u9805\u6703\u8986\u84cb\u6240\u6709\u4ee3\u7406\u8a2d\u7f6e\u3001\u610f\u5716\u548c\u5be6\u9ad4\u3002\n\u5982\u9700\u5c0e\u5165\u6587\u4ef6\uff0c\u8acb\u6309\u4ee5\u4e0b\u6b65\u9a5f\u64cd\u4f5c\uff1a\n- \u4e0b\u8f09 [room-booking-agent.zip](https://cloud.google.com/static/dialogflow/es/docs/data/room-booking-agent.zip?hl=zh-cn) \u6587\u4ef6\u3002\n- \u8f49\u5230 [Dialogflow ES \u63a7\u5236\u6aaf](https://dialogflow.cloud.google.com?hl=zh-cn) \u3002\n- \u9078\u64c7\u60a8\u7684\u4ee3\u7406\u3002\n- \u9ede\u64ca\u4ee3\u7406\u540d\u7a31\u65c1\u908a\u7684\u8a2d\u7f6e\u6309\u9215\u3002\n- \u9078\u64c7 **\u5c0e\u51fa\u548c\u5c0e\u5165** \u6a19\u7c64\u9801\u3002\n- \u9078\u64c7 **\u5f9e ZIP \u6587\u4ef6\u6062\u5fa9** (Restore from ZIP)\uff0c\u7136\u5f8c\u6309\u7167\u8aaa\u660e\u6062\u5fa9\u4e0b\u8f09\u7684 zip \u6587\u4ef6\u3002## \u7528\u65bc\u60c5\u611f\u5206\u6790\u7684\u4ee3\u7406\u8a2d\u7f6e\n\u60a8\u53ef\u4ee5\u91dd\u5c0d\u6bcf\u500b\u6aa2\u6e2c\u610f\u5716\u8acb\u6c42\u89f8\u767c\u60c5\u611f\u5206\u6790\uff0c\u4e5f\u53ef\u4ee5\u5c07\u4ee3\u7406\u914d\u7f6e\u7232\u59cb\u7d42\u8fd4\u56de\u60c5\u611f\u5206\u6790\u7d50\u679c\u3002\n**\u6ce8\u610f** \uff1a\u5373\u4f7f\u4ee3\u7406\u914d\u7f6e\u7232\u4f7f\u7528\u60c5\u611f\u5206\u6790\uff0c [Actions on Google](https://developers.google.com/actions/dialogflow/?hl=zh-cn) \u8acb\u6c42\u4e5f\u4e0d\u6703\u6536\u5230\u60c5\u611f\u5206\u6790\u7d50\u679c\u3002\n\u8981\u7232\u6240\u6709\u67e5\u8a62\u5553\u7528\u60c5\u611f\u5206\u6790\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u8f49\u5230 [Dialogflow ES \u63a7\u5236\u6aaf](https://dialogflow.cloud.google.com?hl=zh-cn) \u3002\n- \u9078\u64c7\u4e00\u500b\u4ee3\u7406\u3002\n- \u9ede\u64ca\u4ee3\u7406\u540d\u7a31\u65c1\u908a\u7684\u8a2d\u7f6e\u6309\u9215\u3002\n- \u9078\u64c7 **\u9ad8\u7d1a** (Advanced) \u6a19\u7c64\u9801\u3002\n- \u6253\u958b **\u91dd\u5c0d\u7576\u524d\u67e5\u8a62\u5553\u7528\u60c5\u611f\u5206\u6790** (Enable sentiment analysis for the current query)\u3002## \u4f7f\u7528 Dialogflow \u6a21\u64ec\u5668\n\u60a8\u53ef\u4ee5\u901a\u904e [Dialogflow \u6a21\u64ec\u5668](https://cloud.google.com/dialogflow/docs/console?hl=zh-cn#simulator) \u8207\u4ee3\u7406\u9032\u884c\u4ea4\u4e92\u4e26\u63a5\u6536\u60c5\u611f\u5206\u6790\u7d50\u679c\uff1a\n- \u8f38\u5165\u201cThank you for helping me\u201d\u3002\n- \u8acb\u53c3\u95b1\u6a21\u64ec\u5668\u5e95\u90e8\u7684 **\u60c5\u611f** (SENTIMENT) \u90e8\u5206\u3002\u5b83\u61c9\u8a72\u986f\u793a\u7a4d\u6975\u7684\u60c5\u611f\u5f97\u5206\u3002\n- \u63a5\u4e0b\u4f86\uff0c\u5728\u6a21\u64ec\u5668\u4e2d\u8f38\u5165\u201cIt didn't work at all\u201d\u3002\n- \u8acb\u53c3\u95b1\u6a21\u64ec\u5668\u5e95\u90e8\u7684 **\u60c5\u611f** (SENTIMENT) \u90e8\u5206\u3002\u5b83\u61c9\u8a72\u986f\u793a\u6d88\u6975\u7684\u60c5\u611f\u5f97\u5206\u3002\n**\u6ce8\u610f** \uff1a\u5982\u679c\u8fd4\u56de\u7684\u60c5\u611f\u975e\u5e38\u6d88\u6975\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5c07\u4e0d\u6eff\u610f\u7684\u7528\u6236\u8f49\u63a5\u7d66\u5728\u7dda\u5ba2\u670d\u4eba\u54e1\uff0c\u6216\u8005\u66f4\u597d\u5730\u77ad\u89e3\u54ea\u4e9b\u610f\u5716\u7522\u751f\u7684\u5ba2\u6236\u60c5\u7dd2\u6700\u5927\u3002\u60a8\u53ef\u4ee5\u5728 [GitHub](https://github.com/dialogflow/agent-human-handoff-nodejs) \u4e0a\u627e\u5230\u79fb\u4ea4\u5be6\u73fe\u7684\u793a\u4f8b\n## \u6aa2\u6e2c\u610f\u5716\n\u5982\u9700\u6aa2\u6e2c\u610f\u5716\uff0c\u8acb\u5c0d [Sessions](https://cloud.google.com/dialogflow/es/docs/reference/common-types?hl=zh-cn#sessions) \u985e\u578b\u8abf\u7528 `detectIntent` \u65b9\u6cd5\u3002\n\u8abf\u7528\n`detectIntent`\n\u65b9\u6cd5\u4e26\u63d0\u4f9b\n`sentimentAnalysisRequestConfig`\n\u5b57\u6bb5\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u60a8\u7684 Google Cloud \u9805\u76ee ID\n- \uff1a\u6703\u8a71 ID\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://dialogflow.googleapis.com/v2/projects/PROJECT_ID/agent/sessions/SESSION_ID:detectIntent\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"queryParams\": {\n \"sentimentAnalysisRequestConfig\": {\n  \"analyzeQueryTextSentiment\": true\n }\n },\n \"queryInput\": {\n \"text\": {\n  \"text\": \"please reserve an amazing meeting room for six people\",\n  \"languageCode\": \"en-US\"\n }\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"responseId\": \"747ee176-acc5-46be-8d9a-b7ef9c2b9199\",\n \"queryResult\": {\n \"queryText\": \"please reserve an amazing meeting room for six people\",\n \"action\": \"room.reservation\",\n \"parameters\": {\n  \"date\": \"\",\n  \"duration\": \"\",\n  \"guests\": 6,\n  \"location\": \"\",\n  \"time\": \"\"\n },\n \"fulfillmentText\": \"I can help with that. Where would you like to reserve a room?\",\n ...\n \"sentimentAnalysisResult\": {\n  \"queryTextSentiment\": {\n  \"score\": 0.8,\n  \"magnitude\": 0.8\n  }\n }\n }\n}\n```\n\u8acb\u6ce8\u610f\uff0c `sentimentAnalysisResult` \u5b57\u6bb5\u5305\u542b `score` \u548c `magnitude` \u503c\u3002\n\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/dialogflow/snippets/src/main/java/com/example/dialogflow/DetectIntentWithSentimentAnalysis.java) \n```\nimport com.google.api.gax.rpc.ApiException;import com.google.cloud.dialogflow.v2.DetectIntentRequest;import com.google.cloud.dialogflow.v2.DetectIntentResponse;import com.google.cloud.dialogflow.v2.QueryInput;import com.google.cloud.dialogflow.v2.QueryParameters;import com.google.cloud.dialogflow.v2.QueryResult;import com.google.cloud.dialogflow.v2.SentimentAnalysisRequestConfig;import com.google.cloud.dialogflow.v2.SessionName;import com.google.cloud.dialogflow.v2.SessionsClient;import com.google.cloud.dialogflow.v2.TextInput;import com.google.common.collect.Maps;import java.io.IOException;import java.util.List;import java.util.Map;public class DetectIntentWithSentimentAnalysis {\u00a0 public static Map<String, QueryResult> detectIntentSentimentAnalysis(\u00a0 \u00a0 \u00a0 String projectId, List<String> texts, String sessionId, String languageCode)\u00a0 \u00a0 \u00a0 throws IOException, ApiException {\u00a0 \u00a0 Map<String, QueryResult> queryResults = Maps.newHashMap();\u00a0 \u00a0 // Instantiates a client\u00a0 \u00a0 try (SessionsClient sessionsClient = SessionsClient.create()) {\u00a0 \u00a0 \u00a0 // Set the session name using the sessionId (UUID) and projectID (my-project-id)\u00a0 \u00a0 \u00a0 SessionName session = SessionName.of(projectId, sessionId);\u00a0 \u00a0 \u00a0 System.out.println(\"Session Path: \" + session.toString());\u00a0 \u00a0 \u00a0 // Detect intents for each text input\u00a0 \u00a0 \u00a0 for (String text : texts) {\u00a0 \u00a0 \u00a0 \u00a0 // Set the text (hello) and language code (en-US) for the query\u00a0 \u00a0 \u00a0 \u00a0 TextInput.Builder textInput =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 TextInput.newBuilder().setText(text).setLanguageCode(languageCode);\u00a0 \u00a0 \u00a0 \u00a0 // Build the query with the TextInput\u00a0 \u00a0 \u00a0 \u00a0 QueryInput queryInput = QueryInput.newBuilder().setText(textInput).build();\u00a0 \u00a0 \u00a0 \u00a0 //\u00a0 \u00a0 \u00a0 \u00a0 SentimentAnalysisRequestConfig sentimentAnalysisRequestConfig =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 SentimentAnalysisRequestConfig.newBuilder().setAnalyzeQueryTextSentiment(true).build();\u00a0 \u00a0 \u00a0 \u00a0 QueryParameters queryParameters =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 QueryParameters.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setSentimentAnalysisRequestConfig(sentimentAnalysisRequestConfig)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 \u00a0 DetectIntentRequest detectIntentRequest =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 DetectIntentRequest.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setSession(session.toString())\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setQueryInput(queryInput)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setQueryParams(queryParameters)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 \u00a0 // Performs the detect intent request\u00a0 \u00a0 \u00a0 \u00a0 DetectIntentResponse response = sessionsClient.detectIntent(detectIntentRequest);\u00a0 \u00a0 \u00a0 \u00a0 // Display the query result\u00a0 \u00a0 \u00a0 \u00a0 QueryResult queryResult = response.getQueryResult();\u00a0 \u00a0 \u00a0 \u00a0 System.out.println(\"====================\");\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\"Query Text: '%s'\\n\", queryResult.getQueryText());\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Detected Intent: %s (confidence: %f)\\n\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 queryResult.getIntent().getDisplayName(), queryResult.getIntentDetectionConfidence());\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Fulfillment Text: '%s'\\n\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 queryResult.getFulfillmentMessagesCount() > 0\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ? queryResult.getFulfillmentMessages(0).getText()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 : \"Triggered Default Fallback Intent\");\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Sentiment Score: '%s'\\n\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 queryResult.getSentimentAnalysisResult().getQueryTextSentiment().getScore());\u00a0 \u00a0 \u00a0 \u00a0 queryResults.put(text, queryResult);\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 \u00a0 return queryResults;\u00a0 }}\n```\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/nodejs-docs-samples/blob/HEAD/dialogflow/detect-intent-sentiment.v2.js) \n```\n// Imports the Dialogflow client libraryconst dialogflow = require('@google-cloud/dialogflow').v2;// Instantiate a DialogFlow client.const sessionClient = new dialogflow.SessionsClient();/**\u00a0* TODO(developer): Uncomment the following lines before running the sample.\u00a0*/// const projectId = 'ID of GCP project associated with your Dialogflow agent';// const sessionId = `user specific ID of session, e.g. 12345`;// const query = `phrase(s) to pass to detect, e.g. I'd like to reserve a room for six people`;// const languageCode = 'BCP-47 language code, e.g. en-US';// Define session pathconst sessionPath = sessionClient.projectAgentSessionPath(\u00a0 projectId,\u00a0 sessionId);async function detectIntentandSentiment() {\u00a0 // The text query request.\u00a0 const request = {\u00a0 \u00a0 session: sessionPath,\u00a0 \u00a0 queryInput: {\u00a0 \u00a0 \u00a0 text: {\u00a0 \u00a0 \u00a0 \u00a0 text: query,\u00a0 \u00a0 \u00a0 \u00a0 languageCode: languageCode,\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 },\u00a0 \u00a0 queryParams: {\u00a0 \u00a0 \u00a0 sentimentAnalysisRequestConfig: {\u00a0 \u00a0 \u00a0 \u00a0 analyzeQueryTextSentiment: true,\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 },\u00a0 };\u00a0 // Send request and log result\u00a0 const responses = await sessionClient.detectIntent(request);\u00a0 console.log('Detected intent');\u00a0 const result = responses[0].queryResult;\u00a0 console.log(` \u00a0Query: ${result.queryText}`);\u00a0 console.log(` \u00a0Response: ${result.fulfillmentText}`);\u00a0 if (result.intent) {\u00a0 \u00a0 console.log(` \u00a0Intent: ${result.intent.displayName}`);\u00a0 } else {\u00a0 \u00a0 console.log(' \u00a0No intent matched.');\u00a0 }\u00a0 if (result.sentimentAnalysisResult) {\u00a0 \u00a0 console.log('Detected sentiment');\u00a0 \u00a0 console.log(\u00a0 \u00a0 \u00a0 ` \u00a0Score: ${result.sentimentAnalysisResult.queryTextSentiment.score}`\u00a0 \u00a0 );\u00a0 \u00a0 console.log(\u00a0 \u00a0 \u00a0 ` \u00a0Magnitude: ${result.sentimentAnalysisResult.queryTextSentiment.magnitude}`\u00a0 \u00a0 );\u00a0 } else {\u00a0 \u00a0 console.log('No sentiment Analysis Found');\u00a0 }\n```\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/python-docs-samples/blob/HEAD/dialogflow/detect_intent_with_sentiment_analysis.py) \n```\ndef detect_intent_with_sentiment_analysis(project_id, session_id, texts, language_code):\u00a0 \u00a0 \"\"\"Returns the result of detect intent with texts as inputs and analyzes the\u00a0 \u00a0 sentiment of the query text.\u00a0 \u00a0 Using the same `session_id` between requests allows continuation\u00a0 \u00a0 of the conversation.\"\"\"\u00a0 \u00a0 from google.cloud import dialogflow\u00a0 \u00a0 session_client = dialogflow.SessionsClient()\u00a0 \u00a0 session_path = session_client.session_path(project_id, session_id)\u00a0 \u00a0 print(\"Session path: {}\\n\".format(session_path))\u00a0 \u00a0 for text in texts:\u00a0 \u00a0 \u00a0 \u00a0 text_input = dialogflow.TextInput(text=text, language_code=language_code)\u00a0 \u00a0 \u00a0 \u00a0 query_input = dialogflow.QueryInput(text=text_input)\u00a0 \u00a0 \u00a0 \u00a0 # Enable sentiment analysis\u00a0 \u00a0 \u00a0 \u00a0 sentiment_config = dialogflow.SentimentAnalysisRequestConfig(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 analyze_query_text_sentiment=True\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 # Set the query parameters with sentiment analysis\u00a0 \u00a0 \u00a0 \u00a0 query_params = dialogflow.QueryParameters(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sentiment_analysis_request_config=sentiment_config\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 response = session_client.detect_intent(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 request={\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"session\": session_path,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"query_input\": query_input,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"query_params\": query_params,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 print(\"=\" * 20)\u00a0 \u00a0 \u00a0 \u00a0 print(\"Query text: {}\".format(response.query_result.query_text))\u00a0 \u00a0 \u00a0 \u00a0 print(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Detected intent: {} (confidence: {})\\n\".format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 response.query_result.intent.display_name,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 response.query_result.intent_detection_confidence,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 print(\"Fulfillment text: {}\\n\".format(response.query_result.fulfillment_text))\u00a0 \u00a0 \u00a0 \u00a0 # Score between -1.0 (negative sentiment) and 1.0 (positive sentiment).\u00a0 \u00a0 \u00a0 \u00a0 print(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Query Text Sentiment Score: {}\\n\".format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 response.query_result.sentiment_analysis_result.query_text_sentiment.score\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 print(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Query Text Sentiment Magnitude: {}\\n\".format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 response.query_result.sentiment_analysis_result.query_text_sentiment.magnitude\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 )\n```", "guide": "Dialogflow"}