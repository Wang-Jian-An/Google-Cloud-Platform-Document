{"title": "Dialogflow - \u9577\u6642\u9593\u904b\u884c\u7684\u64cd\u4f5c", "url": "https://cloud.google.com/dialogflow/cx/docs/how/long-running-operation?hl=zh-cn", "abstract": "# Dialogflow - \u9577\u6642\u9593\u904b\u884c\u7684\u64cd\u4f5c\nDialogflow API \u7684\u67d0\u4e9b\u65b9\u6cd5\u6703\u8fd4\u56de\u9577\u6642\u9593\u904b\u884c\u7684\u64cd\u4f5c\u3002\u9019\u4e9b\u65b9\u6cd5\u662f\u7570\u6b65\u57f7\u884c\u7684\uff0c\u7576\u65b9\u6cd5\u8fd4\u56de\u97ff\u61c9\u6642\uff0c\u64cd\u4f5c\u53ef\u80fd\u5c1a\u672a\u5b8c\u6210\u3002\u60a8\u53ef\u4ee5\u6aa2\u67e5\u72c0\u614b\u3001\u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\u6216\u53d6\u6d88\u64cd\u4f5c\u3002\n", "content": "## \u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\n\u4e0b\u9762\u4ecb\u7d39\u77ad\u5982\u4f55\u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\u3002\n\u5982\u9700\u8f2a\u8a62\u64cd\u4f5c\u7684\u72c0\u614b\uff0c\u8acb\u91dd\u5c0d [Operations](https://cloud.google.com/dialogflow/cx/docs/reference/rest/v3/projects.locations.operations?hl=zh-cn) \u8cc7\u6e90\u8abf\u7528 `get` \u65b9\u6cd5\u3002\u64cd\u4f5c\u5b8c\u6210\u5f8c\uff0c `done` \u5b57\u6bb5\u8a2d\u7f6e\u7232 true\u3002\n **\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u8981\u6aa2\u67e5\u591a\u9805\u64cd\u4f5c\uff0c\u5247\u61c9\u5c0d\u8abf\u7528\u9032\u884c\u901f\u7387\u9650\u5236\u6216\u6539\u7528 `list` \u65b9\u6cd5\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u60a8\u7684 [\u5340\u57df ID](https://cloud.google.com/dialogflow/cx/docs/concept/region?hl=zh-cn) \n- \uff1a\u60a8\u7684 Google Cloud \u9805\u76ee ID\n- \uff1a\u60a8\u7684\u64cd\u4f5c ID\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nGET https://REGION_ID-dialogflow.googleapis.com/v3/projects/PROJECT_ID/locations/REGION_ID/operations/OPERATION_ID\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n \"name\": \"projects/PROJECT_ID/locations/REGION_ID/operations/OPERATION_ID\",\n \"metadata\": {\n \"@type\": \"type.googleapis.com/google.cloud.dialogflow.v3.SomeOperationType\",\n \"state\": \"DONE\"\n },\n \"done\": true,\n ...\n}\n```\n\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/dialogflow-cx/src/main/java/dialogflow/cx/ExportAgent.java) \n```\nimport com.google.api.gax.longrunning.OperationFuture;import com.google.cloud.dialogflow.cx.v3.AgentName;import com.google.cloud.dialogflow.cx.v3.AgentsClient;import com.google.cloud.dialogflow.cx.v3.AgentsSettings;import com.google.cloud.dialogflow.cx.v3.ExportAgentRequest;import com.google.cloud.dialogflow.cx.v3.ExportAgentResponse;import com.google.protobuf.Struct;import java.io.IOException;import java.util.concurrent.ExecutionException;public class ExportAgent {\u00a0 public static void main(String[] args)\u00a0 \u00a0 \u00a0 throws IOException, InterruptedException, ExecutionException {\u00a0 \u00a0 // TODO(developer): Replace these variables before running the sample.\u00a0 \u00a0 String projectId = \"my-project-id\";\u00a0 \u00a0 String agentId = \"my-agent-id\";\u00a0 \u00a0 String location = \"my-location\";\u00a0 \u00a0 exportAgent(projectId, agentId, location);\u00a0 }\u00a0 public static void exportAgent(String projectId, String agentId, String location)\u00a0 \u00a0 \u00a0 throws IOException, InterruptedException, ExecutionException {\u00a0 \u00a0 // Sets the api endpoint to specified location\u00a0 \u00a0 String apiEndpoint = String.format(\"%s-dialogflow.googleapis.com:443\", location);\u00a0 \u00a0 AgentsSettings agentsSettings = AgentsSettings.newBuilder().setEndpoint(apiEndpoint).build();\u00a0 \u00a0 // Note: close() needs to be called on the AgentsClient object to clean up resources\u00a0 \u00a0 // such as threads. In the example below, try-with-resources is used,\u00a0 \u00a0 // which automatically calls close().\u00a0 \u00a0 try (AgentsClient agentsClient = AgentsClient.create(agentsSettings)) {\u00a0 \u00a0 \u00a0 ExportAgentRequest request =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ExportAgentRequest.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setName(AgentName.of(projectId, location, agentId).toString())\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 // Returns a future of the operation\u00a0 \u00a0 \u00a0 OperationFuture<ExportAgentResponse, Struct> future =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 agentsClient.exportAgentOperationCallable().futureCall(request);\u00a0 \u00a0 \u00a0 // get the export agent response after the operation is completed\u00a0 \u00a0 \u00a0 ExportAgentResponse response = future.get();\u00a0 \u00a0 \u00a0 System.out.println(response);\u00a0 \u00a0 }\u00a0 }}\n```\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/nodejs-docs-samples/blob/HEAD/dialogflow-cx/long-running-operation.js) \n```\nconst {AgentsClient, protos} = require('@google-cloud/dialogflow-cx');const api_endpoint = `${location}-dialogflow.googleapis.com`;const client = new AgentsClient({apiEndpoint: api_endpoint});const exportAgentRequest =\u00a0 new protos.google.cloud.dialogflow.cx.v3.ExportAgentRequest();exportAgentRequest.name = `projects/${projectId}/locations/${location}/agents/${agentId}`;// exportAgent call returns a promise to a long running operationconst [operation] = await client.exportAgent(exportAgentRequest);// Waiting for the long running opporation to finishconst [response] = await operation.promise();// Prints the result of the operation when the operation is doneconsole.log(response);\n```\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/python-docs-samples/blob/HEAD/dialogflow-cx/long_running_operation.py) \n```\nfrom google.cloud.dialogflowcx_v3.services.agents.client import AgentsClientfrom google.cloud.dialogflowcx_v3.types.agent import ExportAgentRequestdef export_long_running_agent(project_id, agent_id, location):\u00a0 \u00a0 api_endpoint = f\"{location}-dialogflow.googleapis.com:443\"\u00a0 \u00a0 client_options = {\"api_endpoint\": api_endpoint}\u00a0 \u00a0 agents_client = AgentsClient(client_options=client_options)\u00a0 \u00a0 export_request = ExportAgentRequest()\u00a0 \u00a0 export_request.name = (\u00a0 \u00a0 \u00a0 \u00a0 f\"projects/{project_id}/locations/{location}/agents/{agent_id}\"\u00a0 \u00a0 )\u00a0 \u00a0 # export_agent returns a long running operation\u00a0 \u00a0 operation = agents_client.export_agent(request=export_request)\u00a0 \u00a0 # Returns the result of the operation when the operation is done\u00a0 \u00a0 return operation.result()\n```", "guide": "Dialogflow"}