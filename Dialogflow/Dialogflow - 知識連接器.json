{"title": "Dialogflow - \u77e5\u8b58\u9023\u63a5\u5668", "url": "https://cloud.google.com/dialogflow/es/docs/knowledge-connectors?hl=zh-cn", "abstract": "# Dialogflow - \u77e5\u8b58\u9023\u63a5\u5668\n**    Beta \u7248     ** \u672c\u7522\u54c1\u6216\u529f\u80fd\u9808\u9075\u5b88 [\u670d\u52d9\u5c08\u7528\u689d\u6b3e](https://cloud.google.com/terms/service-terms?hl=zh-cn#1) \u7684\u201c\u901a\u7528\u670d\u52d9\u689d\u6b3e\u201d\u90e8\u5206\u4e2d\u7684\u201c\u975e\u6b63\u5f0f\u7248\u7522\u54c1\u689d\u6b3e\u201d\u3002 \u6b63\u5f0f\u767c\u4f48\u524d\u7522\u54c1\u548c\u529f\u80fd\u201c\u6309\u539f\u6a23\u201d\u63d0\u4f9b\uff0c\u53ef\u80fd\u50c5\u63d0\u4f9b\u6709\u9650\u652f\u6301\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u767c\u4f48\u968e\u6bb5\u8aaa\u660e](https://cloud.google.com/products?hl=zh-cn#product-launch-stages) \u3002\n\u662f\u5c0d\u6240\u5b9a\u7fa9\u610f\u5716\u7684\u88dc\u5145\uff0c\u53ef\u901a\u904e\u89e3\u6790 \u77e5\u8b58\u6587\u6a94\uff08\u4f8b\u5982\u5e38\u898b\u554f\u984c\u89e3\u7b54\u6216\u6587\u7ae0\uff09\u4f86\u627e\u51fa\u81ea\u52d5\u97ff\u61c9\u3002\u5982\u9700\u914d\u7f6e\u77e5\u8b58\u9023\u63a5\u5668\uff0c\u60a8\u9700\u8981\u5b9a\u7fa9\u4e00\u500b\u6216\u591a\u500b [\u77e5\u8b58\u5eab](https://cloud.google.com/dialogflow/docs/how/knowledge-bases?hl=zh-cn) \uff08\u5373\u77e5\u8b58\u6587\u6a94\u96c6\u5408\uff09\u3002\n\u60a8\u53ef\u4ee5\u7232\u4ee3\u7406\u5553\u7528\u77e5\u8b58\u5eab\uff0c\u8b93\u6240\u6709\u6aa2\u6e2c\u610f\u5716\u8acb\u6c42\u90fd\u80fd\u4f7f\u7528\u60a8\u7684\u77e5\u8b58\u5eab\u627e\u5230\u81ea\u52d5\u97ff\u61c9\u3002\u6216\u8005\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5728\u55ae\u7368\u7684 [\u6aa2\u6e2c\u610f\u5716](https://cloud.google.com/dialogflow/docs/api-overview?hl=zh-cn#detect-intent) \u8acb\u6c42\u4e2d\u6307\u5b9a\u4e00\u500b\u6216\u591a\u500b\u77e5\u8b58\u5eab\u3002\n\u4ee3\u7406\u5e38\u5e38\u6703\u540c\u6642\u4f7f\u7528\u77e5\u8b58\u9023\u63a5\u5668\u548c\u5b9a\u7fa9\u7684\u610f\u5716\u3002\u77e5\u8b58\u9023\u63a5\u5668\u63d0\u4f9b\u7684\u97ff\u61c9\u7cbe\u78ba\u7387\u548c\u63a7\u5236\u6bd4\u4e0d\u4e0a\u610f\u5716\u3002 \u60a8\u61c9\u8a72\u5b9a\u7fa9\u610f\u5716\u4f86\u8655\u7406\u8907\u96dc\u7684\u7528\u6236\u8acb\u6c42\uff0c\u8b93\u77e5\u8b58\u9023\u63a5\u5668\u8655\u7406\u7c21\u55ae\u7684\u8acb\u6c42\u3002\n\u5982\u9700\u77ad\u89e3\u652f\u6301\u7684\u8a9e\u8a00\u5217\u8868\uff0c\u8acb\u53c3\u95b1 [\u8a9e\u8a00\u53c3\u8003](https://cloud.google.com/dialogflow/docs/reference/language?hl=zh-cn) \u4e2d\u7684\u77e5\u8b58\u9023\u63a5\u5668 \u5217\u3002\n", "content": "## \u9650\u5236\n\u77e5\u8b58\u9023\u63a5\u5668\u529f\u80fd\u50c5\u9069\u7528\u65bc `global` [\u5340\u57df](https://cloud.google.com/dialogflow/es/docs/how/region?hl=zh-cn) \u3002\n## \u5553\u7528\u6e2c\u8a66\u7248\u529f\u80fd\n\u78ba\u4fdd\u5df2\u5553\u7528 Beta \u7248\u529f\u80fd\uff1a\n- \u8f49\u5230 [Dialogflow ES \u63a7\u5236\u6aaf](https://dialogflow.cloud.google.com?hl=zh-cn) \u3002\n- \u9078\u64c7\u4e00\u500b\u4ee3\u7406\u3002\n- \u9ede\u64ca\u4ee3\u7406\u540d\u7a31\u65c1\u908a\u7684\u8a2d\u7f6e\u6309\u9215\u3002\n- \u5728 **\u5e38\u898f** (General) \u6a19\u7c64\u9801\u4e2d\u5411\u4e0b\u6efe\u52d5\uff0c\u4e26\u78ba\u4fdd\u5df2\u5553\u7528 **Beta \u7248\u529f\u80fd** (Beta Features)\u3002\n- \u5982\u679c\u60a8\u9032\u884c\u4e86\u66f4\u6539\uff0c\u8acb\u9ede\u64ca **\u4fdd\u5b58** (Save)\u3002## \u5275\u5efa\u77e5\u8b58\u5eab\u548c\u6587\u6a94\n\u6309\u7167 [\u77e5\u8b58\u5eab How-to](https://cloud.google.com/dialogflow/docs/how/knowledge-bases?hl=zh-cn) \u4e2d\u7684\u8aaa\u660e\u5275\u5efa\u77e5\u8b58\u5eab\u548c\u6587\u6a94\u3002\n## \u77e5\u8b58\u9023\u63a5\u5668\u8a2d\u7f6e\n**\u8b66\u544a\uff1a** \u76ee\u524d\uff0c\u77e5\u8b58\u9023\u63a5\u5668\u8a2d\u7f6e\u4e0d\u6703\u96a8\u4ee3\u7406\u4e00\u8d77 [\u5c0e\u51fa\u3001\u5c0e\u5165\u6216\u6062\u5fa9](https://cloud.google.com/dialogflow/docs/agents-settings?hl=zh-cn#export) \u3002\n\u60a8\u53ef\u4ee5\u7232\u4ee3\u7406\u5553\u7528\u6216\u505c\u7528\u77e5\u8b58\u5eab\u3002 \u5c0d\u65bc\u6240\u6709\u672a\u6307\u5b9a\u77e5\u8b58\u5eab\u7684\u610f\u5716\u5339\u914d\u8acb\u6c42\uff0c\u7cfb\u7d71\u5c07\u8003\u616e\u5df2\u5553\u7528\u7684\u77e5\u8b58\u5eab\u3002\u5982\u9700\u5553\u7528\u6216\u505c\u7528\u77e5\u8b58\u5eab\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u8f49\u5230 [Dialogflow ES \u63a7\u5236\u6aaf](https://dialogflow.cloud.google.com?hl=zh-cn) \u3002\n- \u9078\u64c7\u4e00\u500b\u4ee3\u7406\u3002\n- \u9ede\u64ca\u5de6\u5074\u908a\u6b04\u83dc\u55ae\u4e2d\u7684 **\u77e5\u8b58** (Knowledge)\u3002\n- \u5f9e\u5217\u8868\u4e2d\u9078\u64c7\u4e00\u500b\u6216\u591a\u500b\u77e5\u8b58\u5eab\u3002\n- \u9ede\u64ca **\u5553\u7528** \u6216 **\u505c\u7528** \u3002\n\u7576\u6700\u7d42\u7528\u6236\u8868\u9054\u5f0f\u4e5f\u8207\u610f\u5716\u76f8\u5339\u914d\u6642\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u60a8\u504f\u597d\u77e5\u8b58\u7d50\u679c\u7684\u5f37\u5ea6\uff1a\n- \u5411\u4e0b\u6efe\u52d5\u5230 **\u8abf\u6574\u77e5\u8b58\u7d50\u679c\u9996\u9078\u9805** \u90e8\u5206\u3002\n- \u5f9e\u5f31\uff08\u504f\u5411\u610f\u5716\uff09\u5230\u5f37\uff08\u504f\u5411\u77e5\u8b58\uff09\u8abf\u6574\u6ed1\u584a\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1\u4e0b\u9762\u7684 [\u6aa2\u6e2c\u610f\u5716\u97ff\u61c9](#response) \u3002## \u914d\u7f6e\u97ff\u61c9\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u77e5\u8b58\u5eab\u914d\u7f6e\u7232\u55ae\u500b\u9ed8\u8a8d\u6587\u672c\u97ff\u61c9\uff0c\u5176\u4e2d\u586b\u5145\u4e86\u6700\u5339\u914d\u7684\u77e5\u8b58\u7b54\u6848\u3002\u60a8\u53ef\u4ee5\u66f4\u6539\u6b64\u97ff\u61c9\u4e26\u6dfb\u52a0 [\u5bcc\u97ff\u61c9\u6d88\u606f](https://cloud.google.com/dialogflow/docs/intents-rich-messages?hl=zh-cn) \u3002\u77e5\u8b58\u97ff\u61c9\u6700\u591a\u53ef\u5305\u542b\u6bcf\u500b\u77e5\u8b58\u5eab\u7684\u4e09\u500b\u7b54\u6848\uff0c\u60a8\u53ef\u4ee5\u5728\u914d\u7f6e\u7684\u97ff\u61c9\u4e2d\u5f15\u7528\u9019\u4e9b\u7b54\u6848\u3002\u5982\u9700\u6dfb\u52a0\u97ff\u61c9\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5728 **\u77e5\u8b58** (Knowledge) \u9801\u9762\uff0c\u9ede\u64ca\u60a8\u7684\u77e5\u8b58\u5eab\u540d\u7a31\u3002\n- \u5411\u4e0b\u6efe\u52d5\u5230 **\u97ff\u61c9** (Responses) \u90e8\u5206\uff0c\u7136\u5f8c\u6839\u64da\u9700\u8981\u6dfb\u52a0\u97ff\u61c9\uff1a\n- \u5b9a\u7fa9\u7b2c\u4e00\u500b\u97ff\u61c9\u6642\uff0c\u8acb\u5728\u60a8\u5e0c\u671b\u63d0\u4f9b\u554f\u984c\u548c\u7b54\u6848\u7684\u4f4d\u7f6e\u4f7f\u7528`$Knowledge.Question[1]`\u548c`$Knowledge.Answer[1]`\u3002\n- `$Knowledge.Question`\u548c`$Knowledge.Answer`\u7684\u7d22\u5f15\u5f9e 1 \u958b\u59cb\uff0c\u56e0\u6b64\u5728\u6dfb\u52a0\u66f4\u591a\u97ff\u61c9\u6642\uff0c\u8acb\u76f8\u61c9\u589e\u52a0\u6b64\u7d22\u5f15\u7684\u503c\u3002\n- \u4fee\u6539\u5b8c\u7562\u5f8c\uff0c\u9ede\u64ca **\u4fdd\u5b58** (Save)\u3002\n\u5728\u5b9a\u7fa9\u97ff\u61c9\u6642\uff0c\u61c9\u8003\u616e\u4ee5\u4e0b\u5e7e\u9ede\uff1a\n- \u5982\u679c\u5b9a\u7fa9\u7684\u97ff\u61c9\u6578\u91cf\u5927\u65bc\u77e5\u8b58\u9023\u63a5\u5668\u97ff\u61c9\u6240\u5339\u914d\u7684\u6578\u91cf N\uff0c\u5247\u53ea\u6703\u8fd4\u56de N \u689d\u97ff\u61c9\u3002\n- \u8207\u5339\u914d\u660e\u78ba\u5b9a\u7fa9\u7684 intent \u76f8\u6bd4\uff0c\u6e96\u78ba\u6027\u53ef\u80fd\u8f03\u4f4e\uff0c\u56e0\u6b64\u6211\u5011\u5efa\u8b70\u5118\u53ef\u80fd\u5411\u7528\u6236\u8fd4\u56de\u4e09\u689d\u97ff\u61c9\u3002\n**\u8b66\u544a\uff1a** \uff1a\u5728\u5b9a\u7fa9\u591a\u500b\u97ff\u61c9\u8b8a\u9ad4\u6642\uff0c\u76ee\u524d\u7684\u884c\u7232\u662f\u4e00\u500b\u5df2\u77e5\u554f\u984c\u3002\u66f4\u6b63\u4ee5\u5f8c\uff0c\u5247\u8868\u73fe\u7232\u4ee5\u4e0b\u884c\u7232\uff1a\n- \u5982\u679c\u5728\u55ae\u500b\u201c\u6587\u672c\u97ff\u61c9\u201d\u6846\u6216 Google \u52a9\u7406\u7684\u201c\u7c21\u55ae\u97ff\u61c9\u201d\u6846\u4e2d\u5b9a\u7fa9\u4e86\u591a\u500b\u97ff\u61c9\u8b8a\u9ad4\uff0cDialogflow \u6703\u96a8\u6a5f\u9078\u64c7\u4e00\u500b\u3002\n- \u5982\u679c\u5b9a\u7fa9\u4e86\u591a\u500b\u5bcc\u97ff\u61c9\u6846\uff0cDialogflow \u6703\u5f9e\u6bcf\u500b\u6846\u4e2d\u9078\u64c7\u4e00\u500b\u97ff\u61c9\u8b8a\u9ad4\u3002\n\u793a\u4f8b\uff1a\n## \u7528\u77e5\u8b58\u5eab\u6aa2\u6e2c\u610f\u5716\n\u5728\u57f7\u884c [\u6aa2\u6e2c\u610f\u5411\u8acb\u6c42](https://cloud.google.com/dialogflow/docs/api-overview?hl=zh-cn#detect-intent) \u6642\uff0c\u60a8\u53ef\u4ee5\u7232\u53ef\u80fd\u7684\u97ff\u61c9\u6307\u5b9a\u4e00\u500b\u6216\u591a\u500b\u77e5\u8b58\u5eab\u3002\u5728\u8acb\u6c42\u4e2d\u660e\u78ba\u63d0\u4f9b\u77e5\u8b58\u5eab\u6703\u8986\u84cb\u5553\u7528\u548c\u505c\u7528\u77e5\u8b58\u5eab\u7684\u8a2d\u7f6e\u3002\n\u4e0b\u9762\u7684\u793a\u4f8b\u5c55\u793a\u60a8\u5982\u4f55\u4f7f\u7528 Dialogflow \u63a7\u5236\u6aaf\u3001REST API\uff08\u5305\u62ec\u547d\u4ee4\u884c\uff09\u6216\u5ba2\u6236\u7aef\u5eab\u4f86\u6aa2\u6e2c\u610f\u5716\u3002\u5982\u9700\u4f7f\u7528 API\uff0c\u8acb\u8abf\u7528 [Sessions](https://cloud.google.com/dialogflow/docs/reference/common-types?hl=zh-cn#sessions) \u985e\u578b\u7684 `detectIntent` \u65b9\u6cd5\u3002\n\u60a8\u53ef\u4ee5\u901a\u904e\n [Dialogflow \u6a21\u64ec\u5668](https://cloud.google.com/dialogflow/docs/console?hl=zh-cn#simulator) \n\u8207\u4ee3\u7406\u9032\u884c\u4ea4\u4e92\u4e26\u63a5\u6536\u77e5\u8b58\u9023\u63a5\u5668\u97ff\u61c9\uff1a\n- \u6309\u7167 [\u4e0a\u8ff0\u6b65\u9a5f\u5553\u7528\u77e5\u8b58\u5eab](#settings) \u3002\n- \u6309\u7167 [\u4e0a\u8ff0\u6b65\u9a5f\u5b9a\u7fa9\u97ff\u61c9](#response-config) \u3002\n- \u5728\u6a21\u64ec\u5668\u4e2d\u8f38\u5165\u201c\u5982\u4f55\u8a3b\u518a\uff1f\u201d\u3002\u5c0d\n [Sessions](https://cloud.google.com/dialogflow/docs/reference/common-types?hl=zh-cn#sessions) \n\u985e\u578b\u8abf\u7528\n`detectIntent`\n\u65b9\u6cd5\uff0c\u4e26\u5728\n`queryParams`\n\u5b57\u6bb5\u4e2d\u6307\u5b9a\u77e5\u8b58\u5eab\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- \uff1a\u60a8\u7684 GCP \u9805\u76ee ID\n- \uff1a\u60a8\u7684\u77e5\u8b58\u5eab ID\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://dialogflow.googleapis.com/v2beta1/projects/PROJECT_ID/agent/sessions/123456789:detectIntent\n```\n\u8acb\u6c42 JSON \u6b63\u6587\uff1a\n```\n{\n \"queryInput\": {\n \"text\": {\n  \"text\": \"How do I sign up?\",\n  \"languageCode\": \"en-US\"\n }\n },\n \"queryParams\": {\n \"knowledgeBaseNames\": [\"projects/PROJECT_ID/knowledgeBases/KNOWLEDGE_BASE_ID\"]\n }\n}\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\n\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n ...\n \"queryResult\": {\n \"queryText\": \"How do I sign up?\",\n \"parameters\": {},\n \"allRequiredParamsPresent\": true,\n \"fulfillmentText\": \"Sign up for Cloud Storage by turning on the Cloud Storage service in the Google Cloud Platform Console.\",\n \"intent\": {\n  \"name\": \"projects/my-gcp-project/agent/intents/487c7242-a769-408a-a339-47b95e10dac4\",\n  \"displayName\": \"Knowledge.KnowledgeBase.MzkzNTAyMDE3NDQxNDk3MDg4MA\"\n },\n \"intentDetectionConfidence\": 0.99371547,\n \"languageCode\": \"en-us\",\n \"knowledgeAnswers\": {\n  \"answers\": [  {\n   \"answer\": \"Sign up for Cloud Storage by turning on the Cloud Storage service in the Google Cloud Platform Console.\",\n   \"matchConfidenceLevel\": \"HIGH\",\n   \"matchConfidence\": 0.99371547\n  },\n  {\n   \"answer\": \"Certain types of content are not allowed on this service; please refer to the Terms of Services and Platform Policies for details. If you believe a piece of content is in violation of our policies, report it here (select See more products, then Google Cloud Storage and Cloud Bigtable).\",\n   \"matchConfidenceLevel\": \"LOW\",\n   \"matchConfidence\": 0.0012244871\n  },\n  {\n   \"answer\": \"From the Cloud Storage documentation click \\\"Send feedback\\\" near the top right of the page. This will open a feedback form. Your comments will be reviewed by the Cloud Storage team.\",\n   \"matchConfidenceLevel\": \"LOW\",\n   \"matchConfidence\": 0.0011537358\n  }\n  ]\n }\n }\n}\n```\n\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/dialogflow/snippets/src/main/java/com/example/dialogflow/DetectIntentKnowledge.java) \n```\nimport com.google.api.gax.rpc.ApiException;import com.google.cloud.dialogflow.v2beta1.DetectIntentRequest;import com.google.cloud.dialogflow.v2beta1.DetectIntentResponse;import com.google.cloud.dialogflow.v2beta1.KnowledgeAnswers;import com.google.cloud.dialogflow.v2beta1.KnowledgeAnswers.Answer;import com.google.cloud.dialogflow.v2beta1.QueryInput;import com.google.cloud.dialogflow.v2beta1.QueryParameters;import com.google.cloud.dialogflow.v2beta1.QueryResult;import com.google.cloud.dialogflow.v2beta1.SessionName;import com.google.cloud.dialogflow.v2beta1.SessionsClient;import com.google.cloud.dialogflow.v2beta1.TextInput;import com.google.common.collect.Maps;import java.io.IOException;import java.util.List;import java.util.Map;public class DetectIntentKnowledge {\u00a0 // DialogFlow API Detect Intent sample with querying knowledge connector.\u00a0 public static Map<String, KnowledgeAnswers> detectIntentKnowledge(\u00a0 \u00a0 \u00a0 String projectId,\u00a0 \u00a0 \u00a0 String knowledgeBaseName,\u00a0 \u00a0 \u00a0 String sessionId,\u00a0 \u00a0 \u00a0 String languageCode,\u00a0 \u00a0 \u00a0 List<String> texts)\u00a0 \u00a0 \u00a0 throws IOException, ApiException {\u00a0 \u00a0 // Instantiates a client\u00a0 \u00a0 Map<String, KnowledgeAnswers> allKnowledgeAnswers = Maps.newHashMap();\u00a0 \u00a0 try (SessionsClient sessionsClient = SessionsClient.create()) {\u00a0 \u00a0 \u00a0 // Set the session name using the sessionId (UUID) and projectID (my-project-id)\u00a0 \u00a0 \u00a0 SessionName session = SessionName.of(projectId, sessionId);\u00a0 \u00a0 \u00a0 System.out.println(\"Session Path: \" + session.toString());\u00a0 \u00a0 \u00a0 // Detect intents for each text input\u00a0 \u00a0 \u00a0 for (String text : texts) {\u00a0 \u00a0 \u00a0 \u00a0 // Set the text and language code (en-US) for the query\u00a0 \u00a0 \u00a0 \u00a0 TextInput.Builder textInput =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 TextInput.newBuilder().setText(text).setLanguageCode(languageCode);\u00a0 \u00a0 \u00a0 \u00a0 // Build the query with the TextInput\u00a0 \u00a0 \u00a0 \u00a0 QueryInput queryInput = QueryInput.newBuilder().setText(textInput).build();\u00a0 \u00a0 \u00a0 \u00a0 QueryParameters queryParameters =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 QueryParameters.newBuilder().addKnowledgeBaseNames(knowledgeBaseName).build();\u00a0 \u00a0 \u00a0 \u00a0 DetectIntentRequest detectIntentRequest =\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 DetectIntentRequest.newBuilder()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setSession(session.toString())\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setQueryInput(queryInput)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .setQueryParams(queryParameters)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 \u00a0 \u00a0 \u00a0 // Performs the detect intent request\u00a0 \u00a0 \u00a0 \u00a0 DetectIntentResponse response = sessionsClient.detectIntent(detectIntentRequest);\u00a0 \u00a0 \u00a0 \u00a0 // Display the query result\u00a0 \u00a0 \u00a0 \u00a0 QueryResult queryResult = response.getQueryResult();\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\"Knowledge results:\\n\");\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\"====================\\n\");\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\"Query Text: '%s'\\n\", queryResult.getQueryText());\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Detected Intent: %s (confidence: %f)\\n\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 queryResult.getIntent().getDisplayName(), queryResult.getIntentDetectionConfidence());\u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Fulfillment Text: '%s'\\n\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 queryResult.getFulfillmentMessagesCount() > 0\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ? queryResult.getFulfillmentMessages(0).getText()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 : \"Triggered Default Fallback Intent\");\u00a0 \u00a0 \u00a0 \u00a0 KnowledgeAnswers knowledgeAnswers = queryResult.getKnowledgeAnswers();\u00a0 \u00a0 \u00a0 \u00a0 for (Answer answer : knowledgeAnswers.getAnswersList()) {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\" - Answer: '%s'\\n\", answer.getAnswer());\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 System.out.format(\" - Confidence: '%s'\\n\", answer.getMatchConfidence());\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 KnowledgeAnswers answers = queryResult.getKnowledgeAnswers();\u00a0 \u00a0 \u00a0 \u00a0 allKnowledgeAnswers.put(text, answers);\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 \u00a0 return allKnowledgeAnswers;\u00a0 }}\n```\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/nodejs-docs-samples/blob/HEAD/dialogflow/detect.v2beta1.js) \n```\n// Imports the Dialogflow client libraryconst dialogflow = require('@google-cloud/dialogflow').v2beta1;// Instantiate a DialogFlow client.const sessionClient = new dialogflow.SessionsClient();/**\u00a0* TODO(developer): Uncomment the following lines before running the sample.\u00a0*/// const projectId = 'ID of GCP project associated with your Dialogflow agent';// const sessionId = `user specific ID of session, e.g. 12345`;// const languageCode = 'BCP-47 language code, e.g. en-US';// const knowledgeBaseId = `the ID of your KnowledgeBase`;// const query = `phrase(s) to pass to detect, e.g. I'd like to reserve a room for six people`;// Define session pathconst sessionPath = sessionClient.projectAgentSessionPath(\u00a0 projectId,\u00a0 sessionId);const knowledgeBasePath =\u00a0 'projects/' + projectId + '/knowledgeBases/' + knowledgeBaseId + '';// The audio query requestconst request = {\u00a0 session: sessionPath,\u00a0 queryInput: {\u00a0 \u00a0 text: {\u00a0 \u00a0 \u00a0 text: query,\u00a0 \u00a0 \u00a0 languageCode: languageCode,\u00a0 \u00a0 },\u00a0 },\u00a0 queryParams: {\u00a0 \u00a0 knowledgeBaseNames: [knowledgeBasePath],\u00a0 },};const responses = await sessionClient.detectIntent(request);const result = responses[0].queryResult;console.log(`Query text: ${result.queryText}`);console.log(`Detected Intent: ${result.intent.displayName}`);console.log(`Confidence: ${result.intentDetectionConfidence}`);console.log(`Query Result: ${result.fulfillmentText}`);if (result.knowledgeAnswers && result.knowledgeAnswers.answers) {\u00a0 const answers = result.knowledgeAnswers.answers;\u00a0 console.log(`There are ${answers.length} answer(s);`);\u00a0 answers.forEach(a => {\u00a0 \u00a0 console.log(` \u00a0 answer: ${a.answer}`);\u00a0 \u00a0 console.log(` \u00a0 confidence: ${a.matchConfidence}`);\u00a0 \u00a0 console.log(` \u00a0 match confidence level: ${a.matchConfidenceLevel}`);\u00a0 });}\n```\u8981\u5411 Dialogflow \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/python-docs-samples/blob/HEAD/dialogflow/detect_intent_knowledge.py) \n```\ndef detect_intent_knowledge(\u00a0 \u00a0 project_id, session_id, language_code, knowledge_base_id, texts):\u00a0 \u00a0 \"\"\"Returns the result of detect intent with querying Knowledge Connector.\u00a0 \u00a0 Args:\u00a0 \u00a0 project_id: The GCP project linked with the agent you are going to query.\u00a0 \u00a0 session_id: Id of the session, using the same `session_id` between requests\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 allows continuation of the conversation.\u00a0 \u00a0 language_code: Language of the queries.\u00a0 \u00a0 knowledge_base_id: The Knowledge base's id to query against.\u00a0 \u00a0 texts: A list of text queries to send.\u00a0 \u00a0 \"\"\"\u00a0 \u00a0 from google.cloud import dialogflow_v2beta1 as dialogflow\u00a0 \u00a0 session_client = dialogflow.SessionsClient()\u00a0 \u00a0 session_path = session_client.session_path(project_id, session_id)\u00a0 \u00a0 print(\"Session path: {}\\n\".format(session_path))\u00a0 \u00a0 for text in texts:\u00a0 \u00a0 \u00a0 \u00a0 text_input = dialogflow.TextInput(text=text, language_code=language_code)\u00a0 \u00a0 \u00a0 \u00a0 query_input = dialogflow.QueryInput(text=text_input)\u00a0 \u00a0 \u00a0 \u00a0 knowledge_base_path = dialogflow.KnowledgeBasesClient.knowledge_base_path(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 project_id, knowledge_base_id\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 query_params = dialogflow.QueryParameters(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 knowledge_base_names=[knowledge_base_path]\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 request = dialogflow.DetectIntentRequest(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 session=session_path, query_input=query_input, query_params=query_params\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 response = session_client.detect_intent(request=request)\u00a0 \u00a0 \u00a0 \u00a0 print(\"=\" * 20)\u00a0 \u00a0 \u00a0 \u00a0 print(\"Query text: {}\".format(response.query_result.query_text))\u00a0 \u00a0 \u00a0 \u00a0 print(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"Detected intent: {} (confidence: {})\\n\".format(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 response.query_result.intent.display_name,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 response.query_result.intent_detection_confidence,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 )\u00a0 \u00a0 \u00a0 \u00a0 print(\"Fulfillment text: {}\\n\".format(response.query_result.fulfillment_text))\u00a0 \u00a0 \u00a0 \u00a0 print(\"Knowledge results:\")\u00a0 \u00a0 \u00a0 \u00a0 knowledge_answers = response.query_result.knowledge_answers\u00a0 \u00a0 \u00a0 \u00a0 for answers in knowledge_answers.answers:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 print(\" - Answer: {}\".format(answers.answer))\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 print(\" - Confidence: {}\".format(answers.match_confidence))\n```\n## \u6aa2\u6e2c\u610f\u5716\u97ff\u61c9\n[Sessions](https://cloud.google.com/dialogflow/docs/reference/common-types?hl=zh-cn#sessions) \u985e\u578b `detectIntent` \u65b9\u6cd5\u7684\u97ff\u61c9\u7232 `DetectIntentResponse` \u3002 \u6709\u591a\u500b\u56e0\u7d20\u6703\u5f71\u97ff\u97ff\u61c9\u5b57\u6bb5\u7684\u586b\u5145\u65b9\u5f0f\u3002\n\u5982\u679c\u5b9a\u7fa9\u7684\u610f\u5716\u548c\u77e5\u8b58\u5eab\u90fd\u662f\u6f5b\u5728\u5339\u914d\u9805\uff0c\u5247\u7cfb\u7d71\u6703\u6839\u64da\u8a72\u610f\u5716\u548c\u77e5\u8b58\u5eab\u7684\u5339\u914d\u7f6e\u4fe1\u5ea6\u4ee5\u53ca\u201c\u77e5\u8b58\u7d50\u679c\u504f\u597d\u8a2d\u7f6e\u201d \uff08\u8acb\u53c3\u95b1 [\u77e5\u8b58\u9023\u63a5\u5668\u8a2d\u7f6e](#settings) \uff09\u4f86\u78ba\u5b9a\u9078\u64c7\u54ea\u500b\u5339\u914d\u9805\u3002 \u6240\u9078\u5339\u914d\u9805\u5c07\u586b\u5145\u5728 `DetectIntentResponse.queryResult` \u5b57\u6bb5\uff0c\u800c\u5176\u4ed6\u6f5b\u5728\u5339\u914d\u9805\u5c07\u586b\u5145\u5728 `DetectIntentResponse.alternativeQueryResults` \u5b57\u6bb5\u3002 \u9019\u5169\u500b\u5b57\u6bb5\u90fd\u5305\u542b `QueryResult` \u6d88\u606f\u3002\n\u5982\u679c\u77e5\u8b58\u5eab\u63d0\u4f9b\u4e86\u6f5b\u5728\u5339\u914d\u9805\uff1a\n- `QueryResult.knowledgeAnswers`\u6703\u586b\u5145\u4e00\u7cfb\u5217\u6f5b\u5728\u77e5\u8b58\u7b54\u6848\uff0c\u4e26\u6309\u5339\u914d\u7f6e\u4fe1\u5ea6\u964d\u5e8f\u6392\u5217\u3002\n- \u5982\u679c\u5df2\u7232\u77e5\u8b58\u5eab\u5b9a\u7fa9\u4e86\u5bcc\u97ff\u61c9\uff0c\u5247`QueryResult.fulfillmentMessages`\u6703\u586b\u5145\u5bcc\u97ff\u61c9\u6d88\u606f\u3002\n\u57f7\u884c\u6aa2\u6e2c\u610f\u5716\u8acb\u6c42\u6642\uff0c\u77e5\u8b58\u67e5\u8a62\u53ef\u80fd\u6703\u5931\u6557\u3002 \u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u7cfb\u7d71\u5c07\u9078\u64c7\u5b9a\u7fa9\u7684\u610f\u5716\uff0c\u56e0\u6b64\u7e3d\u9ad4\u6aa2\u6e2c\u610f\u5716\u8acb\u6c42\u4e0d\u6703\u5931\u6557\u3002 \u60a8\u53ef\u4ee5\u5728 `DetectIntentResponse.alternativeQueryResults[i].diagnosticInfo` \u5b57\u6bb5\u4e2d\u627e\u5230\u77e5\u8b58\u67e5\u8a62\u932f\u8aa4\u4fe1\u606f\u3002\n## \u7ba1\u7406\u77e5\u8b58\u5eab\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u7ba1\u7406\u77e5\u8b58\u5eab\uff0c\u8acb\u53c3\u95b1 [\u7ba1\u7406\u77e5\u8b58\u5eab](https://cloud.google.com/dialogflow/docs/how/knowledge-bases?hl=zh-cn) \u3002", "guide": "Dialogflow"}