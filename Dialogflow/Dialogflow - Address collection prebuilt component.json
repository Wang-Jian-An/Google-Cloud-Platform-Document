{"title": "Dialogflow - Address collection prebuilt component", "url": "https://cloud.google.com/dialogflow/cx/docs/concept/prebuilt-component/address-collection", "abstract": "# Dialogflow - Address collection prebuilt component\nThe address collection [prebuilt component](/dialogflow/cx/docs/concept/prebuilt-component) collects an address from the end-user, and it uses the [Google Address Validation API](https://mapsplatform.google.com/maps-products/address-validation/) to validate addresses.\n", "content": "## Limitations\nIn addition to the [common prebuilt component limitations](/dialogflow/cx/docs/concept/prebuilt-component#limits) , this prebuilt component has the following limitations:\n- Only supports addresses from countries listed at [Address Validation API coverage details](https://developers.google.com/maps/documentation/address-validation/coverage) .## Additional functionalities\nThe following additional functionalities are provided by this prebuilt component:\n- [Repeat](/dialogflow/cx/docs/concept/prebuilt-component#repeat-functionality) \n- [Waiting room](/dialogflow/cx/docs/concept/prebuilt-component#waiting-room-functionality) \n- [Playback](/dialogflow/cx/docs/concept/prebuilt-component#playback-functionality) ## Sample dialogs\nThe following sample dialogs demonstrate common scenarios handled by this prebuilt component. The sample dialogs demonstrate behavior when the component is called via telephony, which triggers the Default Welcome Intent and the first agent response at the start of the conversation.\n### Full valid address\nEnd-user provides a complete address and the address collection component successfully verifies it.\n| User input             | Agent response                                                         |\n|:-------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| nan               | Please tell me your full address to start.                                                  |\n| 1600 Amphitheatre Parkway, Mountain View, CA 94043-1351, USA | nan                                                            |\n| nan               | I have collected the final address; the street number is 1600, the route is Amphitheatre Parkway, the city is Mountain View, the administrative area is CA, the postal code is 94043, the country is USA. Is that correct? Please say yes or no. |\n| yes               | nan                                                            |\n| nan               | Fantastic, I've collected the address.                                                   |\n### Partial valid address with inferred elements\nEnd-user provides a partial address; agent guesses the missing part and successfully verifies it after confirmation from the end-user.\n| User input    | Agent response                                                                                          |\n|:--------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| nan      | Please tell me your full address to start.                                                                                   |\n| 1600 Amphitheatre Parkway | nan                                                                                             |\n| nan      | I have guessed some part of the address, the city is Mountain View, postal code is 94043, administrative area is CA, country is USA. I have collected the final address; the street number is 1600, the route is Amphitheatre Parkway, the city is Mountain View, the administrative area is CA, the postal code is 94043, the country is USA. Is that correct? Please say yes or no. |\n| Yes      | nan                                                                                             |\n| nan      | Fantastic, I've collected the address.                                                                                    |\n### Partial valid address with user-provided elements\nEnd-user provides a partial address; agent guesses the missing part but the end-user provides their own input after saying \"no\", and the agent successfully accepts the address.\n| User input    | Agent response                                                                                          |\n|:--------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| nan      | Please tell me your full address to start.                                                                                   |\n| 1600 Amphitheatre Parkway | nan                                                                                             |\n| nan      | I have guessed some part of the address, the city is Mountain View, postal code is 94043, administrative area is CA, country is USA. I have collected the final address; the street number is 1600, the route is Amphitheatre Parkway, the city is Mountain View, the administrative area is CA, the postal code is 94043, the country is USA. Is that correct? Please say yes or no. |\n| No      | nan                                                                                             |\n| nan      | Okay. Please tell me which part of the address needs to be changed.                                                                             |\n| Postal code    | nan                                                                                             |\n| nan      | Can you please share the postal code?                                                                                     |\n| 94044      | nan                                                                                             |\n| nan      | I'm done with this update. Is there anything else to be changed? Please say yes or no.                                                                        |\n| no      | nan                                                                                             |\n| nan      | After validation I have replaced the postal code as 94043. I have collected the final address; the street number is 1600, the route is Amphitheatre Parkway, the city is Mountain View, the administrative area is CA, the postal code is 94043, the country is USA. Is that correct? Please say yes or no.                   |\n| yes      | nan                                                                                             |\n| nan      | Fantastic, I've collected the address.                                                                                    |\n### Unrecognized input\nComponent exits the flow after the end-user provides unrecognized input three times.\n| User input | Agent response                 |\n|:-------------|:---------------------------------------------------------------------------------|\n| nan   | Please tell me your full address to start.          |\n| It's fine | nan                    |\n| nan   | Sorry, I didn't get that. Please tell me your full address to start.    |\n| nice   | nan                    |\n| nan   | Hmm, I still wasn't able to get that. Please tell me your full address to start. |\n| great  | nan                    |\n| nan   | Sorry, I'm having difficulty understanding your response.      |\n### Unsupported address\nComponent exits the flow after the end-user provides an address not currently supported by the Address Validation API.\n| User input | Agent response               |\n|:-------------|:--------------------------------------------------------------------------|\n| nan   | Please tell me your full address to start.        |\n| India  | nan                  |\n| nan   | I'm sorry, but I'm currently unable to validate addresses in that region. |\n## Address validation\nTo understand how the address collection component validates addresses, see [Address Validation API Overview](https://developers.google.com/maps/documentation/address-validation/overview) .\nThe address collection component captures end-user input using the [@sys.address system entity](/dialogflow/cx/docs/reference/system-entities) and sends the captured address to the Address Validation API to extract address elements for further processing.\nThe following address elements are returned by the Address Validation API and are used by the component to collect and validate a complete address:\nYou can try the [Google Address Validation Demo](https://developers.google.com/maps/documentation/address-validation/demo) with any address from a [supported region](https://developers.google.com/maps/documentation/address-validation/coverage) .\n## Naming conventions\nThis prebuilt component uses the following naming conventions:\n| Feature     | Format            | Example             |\n|:--------------------------|:------------------------------------------------------|:----------------------------------------------------------|\n| Flow      | [Component Name]          | Address Collection          |\n| Component Specific Intent | prebuilt_components_[component_name]_[intent_name] | prebuilt_components_address_collection_locality   |\n| Parameter     | [param_name]           | user_provided_address          |\n| Webhook     | prebuilt_components_[component_name]:[webhook_action] | prebuilt_components_address_collection:address_validation |\n## Input parameters\nInput parameters are parameters that are used to configure certain behaviors of the component. The parameters will be used by one or more conditions within the flow to determine how the component should behave. Flow-scoped parameters must be set on the start page of the component as described below. Session-scoped parameters may be set either by a calling flow, or on the start page of this component.\nYou can configure which address elements are required by this component by modifying [parameter presets](/dialogflow/cx/docs/concept/fulfillment#param-preset) in the [flow's start page](/dialogflow/cx/docs/concept/flow#data) .\nThis prebuilt component accepts the following input parameters:\n| Parameter Name  | Description                   | Input Format |\n|:--------------------|:-------------------------------------------------------------------------------------|:---------------|\n| $flow.zip_code  | If the zip code address element is required then set as true, else false.   | boolean  |\n| $flow.city   | If the city address element is required then set as true, else false.    | boolean  |\n| $flow.admin_area | If the administrative area address element is required then set as true, else false. | boolean  |\n| $flow.street_number | If the street number address element is required then set as true, else false.  | boolean  |\n| $flow.route   | If the route address element is required then set as true, else false.    | boolean  |\n| $flow.country  | If the country address element is required then set as true, else false.    | boolean  |\n| $flow.island  | If the island address element is required then set as true, else false.    | boolean  |\n| $flow.retry_num  | Sets the maximum retry limit for Maps Address Validation API webhook calls   | integer  |\n## Output parameters\nOutput parameters are session parameters that will remain active after exiting the component. These parameters contain important information collected by the component. This prebuilt component provides values for the following output parameters:\n| Parameter Name    | Description                                                                                                                                                           | Output Format                                  |\n|:---------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------|\n| address_collection_address | This parameter returns the address object if an address was captured by the component                                                                                                                                        | { \"admin-area\": string, \"city\": string, \"country\": string, \"island\": string, \"route\": string, \"zip-code\": string, \"street-number\": string } |\n| address_collection_status | This parameter returns the status of the collected address. The returned value is one of: VALID_ADDRESS: address was collected and validated by the Address Validation API. INVALID_ADDRESS: address was confirmed by the end-user but one or more elements were not validated or marked as UNCONFIRMED_BUT_PLAUSIBLE by the Address Validation API. MAPS_API_ERROR: address was not collected due to Address Validation API error. COUNTRY_NOT_SUPPORTED: address was not collected because the Address Validation API doesn't support that region. NO_USER_CONFIRMATION: address was not confirmed because the end-user didn't confirm an address. | string                                    |\n## Basic setup\nTo set up this prebuilt component:\n- [Import the prebuilt component](/dialogflow/cx/docs/concept/prebuilt-component#import) .\n- [Enable](/service-usage/docs/enable-disable) the Address Validation API.\n- Configure the provided [flexible webhook](/dialogflow/cx/docs/concept/webhook#flexible) with your Maps API key, see Webhook setup below.## Webhook setup\nIn order to use the Address Validation API to validate addresses, you will need to configure the provided flexible webhook with the correct credentials.\n### Address Validation webhook\nThis webhook performs the following actions:\n- Processes captured Dialogflow parameters, forms request, and verifies the address using the [Address Validation API](https://developers.google.com/maps/documentation/address-validation) .\n- Extracts confirmed, unconfirmed, missing, and inferred address elements from the [Google Address Validation API response](https://developers.google.com/maps/documentation/address-validation/demo) .\nTo configure the webhook for this component, you'll need to update the webhook settings with your Maps API key.\n- To retrieve your API Key: go to [Google Cloud Platform Console > APIs & Services > Credentials](https://console.cloud.google.com/apis/credentials) , select your Maps API key, copy the API Key field.\nTo configure the webhook:\n- Open the [Dialogflow CX Console](https://dialogflow.cloud.google.com/cx/projects) .\n- Choose your Google Cloud project.\n- Select your agent.\n- Select the **Manage** tab.\n- Click **Webhooks** .\n- Select the prebuilt_components_address_collection:address_validation webhook.\n- Replace the URL in the Dialogflow **Webhook URL** field with the URL including your Maps API Key: https://addressvalidation.googleapis.com/v1:validateAddress?key=\n- In the **Authentication** settings, configure the Username as`key`and set the Password to your Maps API key.\n- Click **Save** .\n### Complete\nYour agent and its webhook should now be set up and ready to test.", "guide": "Dialogflow"}