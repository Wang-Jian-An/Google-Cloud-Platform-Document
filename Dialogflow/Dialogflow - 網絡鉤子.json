{"title": "Dialogflow - \u7db2\u7d61\u9264\u5b50", "url": "https://cloud.google.com/dialogflow/cx/docs/concept/webhook?hl=zh-cn", "abstract": "# Dialogflow - \u7db2\u7d61\u9264\u5b50\nCX \u7db2\u7d61\u9264\u5b50\u8207 [ES \u7db2\u7d61\u9264\u5b50](https://cloud.google.com/dialogflow/docs/fulfillment-webhook?hl=zh-cn) \u985e\u4f3c\uff0c\u4e0d\u540c\u4e4b\u8655\u5728\u65bc\u8acb\u6c42\u548c\u97ff\u61c9\u5b57\u6bb5\u9032\u884c\u4e86\u66f4\u6539\u4ee5\u652f\u6301 CX \u529f\u80fd\u3002\n", "content": "## \u7db2\u7d61\u9264\u5b50\u670d\u52d9\u8981\u6c42\n\u60a8\u7684\u7db2\u7d61\u9264\u5b50\u670d\u52d9\u5fc5\u9808\u6eff\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a\n- \u5b83\u5fc5\u9808\u8655\u7406 HTTPS \u8acb\u6c42\u3002\u4e0d\u652f\u6301 HTTP\u3002\u5982\u679c\u60a8\u4f7f\u7528 [\u8a08\u7b97](https://cloud.google.com/products/compute?hl=zh-cn) \u6216 [\u7121\u670d\u52d9\u5668\u8a08\u7b97](https://cloud.google.com/serverless?hl=zh-cn) \u89e3\u6c7a\u65b9\u6848\u5728 Google Cloud Platform \u4e0a\u8a17\u7ba1\u60a8\u7684 webhook \u670d\u52d9\uff0c\u8acb\u53c3\u95b1\u4f7f\u7528 HTTPS \u63d0\u4f9b\u670d\u52d9\u7684\u7522\u54c1\u6587\u6a94\u3002 \u5982\u9700\u77ad\u89e3\u5176\u4ed6\u8a17\u7ba1\u9078\u9805\uff0c\u8acb\u53c3\u95b1 [\u7232\u60a8\u7684\u7db2\u57df\u7372\u53d6 SSL \u8b49\u66f8](https://support.google.com/domains/answer/7630973?hl=zh-cn) \u3002\n- \u8acb\u6c42\u7684\u7db2\u5740\u5fc5\u9808\u53ef\u516c\u958b\u8a2a\u554f\u3002\n- \u5b83\u5fc5\u9808\u4f7f\u7528 JSON [WebhookRequest](#webhook-request) \u6b63\u6587\u8655\u7406 POST \u8acb\u6c42\u3002\n- \u5b83\u5fc5\u9808\u4f7f\u7528 JSON [WebhookResponse](#webhook-response) \u6b63\u6587\u97ff\u61c9`WebhookRequest`\u8acb\u6c42\u3002\n- \u5982\u679c\u4ee3\u7406\u672a\u8207 [Service Directory \u5c08\u7528\u7db2\u7d61\u8a2a\u554f\u901a\u9053](https://cloud.google.com/dialogflow/cx/docs/concept/webhook?hl=zh-cn#sd) \u96c6\u6210\uff0c\u5247\u7db2\u7d61\u9264\u5b50\u8abf\u7528\u6703\u88ab\u8996\u7232\u5728\u670d\u52d9\u908a\u754c\u5916\u9032\u884c\uff0c\u4e26\u5728\u5553\u7528 VPC Service Controls \u6642\u88ab\u5c4f\u853d\u3002 **Service Directory** \u652f\u6301\u6709\u9650\u7684\u7aef\u9ede\uff1b\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [Service Directory](https://cloud.google.com/service-directory/docs/private-network-access-overview?hl=zh-cn) \u3002## \u8eab\u4efd\u9a57\u8b49\n\u8acb\u52d9\u5fc5\u4fdd\u8b77\u60a8\u7684\u7db2\u7d61\u9264\u5b50\u670d\u52d9\uff0c\u4ee5\u4fbf\u53ea\u6709\u60a8\u6216 Dialogflow \u4ee3\u7406\u6709\u6b0a\u767c\u51fa\u8acb\u6c42\u3002\u9019\u662f\u5728 [\u5275\u5efa Webhook \u8cc7\u6e90](#create) \u6642\u914d\u7f6e\u7684\u3002Dialogflow CX \u652f\u6301\u4ee5\u4e0b\u8eab\u4efd\u9a57\u8b49\u6a5f\u5236\uff1a\n- \u4f7f\u7528\u8eab\u4efd\u9a57\u8b49\u6a19\u982d\u9032\u884c\u8eab\u4efd\u9a57\u8b49\n- [\u4f7f\u7528 Cloud Functions](#gcf) \n- [\u670d\u52d9\u8eab\u4efd\u4ee4\u724c](#id-token) \n- [\u96d9\u5411 TLS \u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/dialogflow/cx/docs/concept/mtls?hl=zh-cn) \n**\u6ce8\u610f** \uff1aDialogflow \u7121\u6cd5\u91dd\u5c0d\u767c\u9001 webhook \u8acb\u6c42\u7684\u6a5f\u5668\u63d0\u4f9b\u4efb\u4f55 IP \u7bc4\u570d\u4fdd\u8b49\u3002\u60a8\u61c9\u8a72\u4f7f\u7528\u4e0a\u9762\u5217\u51fa\u7684\u8eab\u4efd\u9a57\u8b49\u65b9\u6cd5\u4e4b\u4e00\uff0c\u800c\u4e0d\u662f\u901a\u904e IP \u7bc4\u570d\u9650\u5236\u8a2a\u554f\u6b0a\u9650\u3002\n## HTTPS \u8b49\u66f8\u9a57\u8b49\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cDialogflow \u4f7f\u7528 Google \u7684\u9ed8\u8a8d\u4fe1\u4efb\u5eab\u4f86\u9a57\u8b49 HTTPS \u8b49\u66f8\u3002\u5982\u679c\u60a8\u6253\u7b97\u5c07 HTTPS \u670d\u52d9\u5668\u7121\u6cd5\u8b58\u5225\u7684 Google \u9ed8\u8a8d\u8b49\u66f8\u5b58\u5132\u5340\uff08\u4f8b\u5982\u81ea\u7c3d\u540d\u8b49\u66f8\u6216\u81ea\u5b9a\u7fa9\u6839\u8b49\u66f8\uff09\u4f7f\u7528\uff0c\u8acb\u53c3\u95b1 [\u81ea\u5b9a\u7fa9 CA \u8b49\u66f8](https://cloud.google.com/dialogflow/cx/docs/concept/custom-ca?hl=zh-cn) \u3002\n## \u7db2\u7d61\u9264\u5b50\u8acb\u6c42\n\u8abf\u7528\u5177\u6709\u7db2\u7d61\u9264\u5b50\u7684 [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment?hl=zh-cn) \u6642\uff0cDialogflow \u6703\u5411\u60a8\u7684\u7db2\u7d61\u9264\u5b50\u670d\u52d9\u767c\u9001 HTTPS POST \u7db2\u7d61\u9264\u5b50\u8acb\u6c42\u3002\u6b64\u8acb\u6c42\u7684\u6b63\u6587\u662f\u4e00\u500b JSON \u5c0d\u8c61\uff0c\u5176\u4e2d\u5305\u542b\u6709\u95dc\u5339\u914d intent \u7684\u4fe1\u606f\u3002\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [WebhookRequest(V3)](https://cloud.google.com/dialogflow/cx/docs/reference/rest/v3/WebhookRequest?hl=zh-cn) \u6216 [WebhookRequest(V3Beta1)](https://cloud.google.com/dialogflow/cx/docs/reference/rest/v3beta1/WebhookRequest?hl=zh-cn) \u53c3\u8003\u6587\u6a94\u3002\n## \u7db2\u7d61\u9264\u5b50\u97ff\u61c9\n\u7db2\u7d61\u9264\u5b50\u670d\u52d9\u6536\u5230\u7db2\u7d61\u9264\u5b50\u8acb\u6c42\u5f8c\uff0c\u9700\u8981\u767c\u9001\u7db2\u7d61\u9264\u5b50\u97ff\u61c9\u3002\u60a8\u7684\u97ff\u61c9\u6703\u53d7\u5230\u4ee5\u4e0b\u9650\u5236\uff1a\n- \u97ff\u61c9\u5fc5\u9808\u5728\u60a8\u5728 [\u5275\u5efa\u7db2\u7d61\u9264\u5b50\u8cc7\u6e90](#create) \u6642\u914d\u7f6e\u7684\u8d85\u6642\u6642\u9593\u5167\u9032\u884c\uff0c\u5426\u5247\u8acb\u6c42\u6703\u8d85\u6642\u3002\n- \u97ff\u61c9\u5927\u5c0f\u5fc5\u9808\u5c0f\u65bc\u6216\u7b49\u65bc 64 KiB\u3002\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [WebhookResponse(V3)](https://cloud.google.com/dialogflow/cx/docs/reference/rest/v3/WebhookResponse?hl=zh-cn) \u6216 [WebhookResponse(V3Beta1)](https://cloud.google.com/dialogflow/cx/docs/reference/rest/v3beta1/WebhookResponse?hl=zh-cn) \u53c3\u8003\u6587\u6a94\u3002\n## \u5275\u5efa\u7db2\u7d61\u9264\u5b50\u8cc7\u6e90\n\u5728\u904b\u884c \u5f8c\uff0c\u60a8\u9700\u8981\u5728\u4ee3\u7406\u4e2d\u5275\u5efa\u5177\u6709\u9023\u63a5\u548c\u8eab\u4efd\u9a57\u8b49\u4fe1\u606f\u7684 \u3002\u5982\u9700\u5275\u5efa\u7db2\u7d61\u9264\u5b50\u8cc7\u6e90\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u6253\u958b [Dialogflow CX \u63a7\u5236\u6aaf](https://dialogflow.cloud.google.com/cx/projects?hl=zh-cn) \u3002\n- \u9078\u64c7\u60a8\u7684 GCP \u9805\u76ee\u3002\n- \u9078\u64c7\u60a8\u7684\u4ee3\u7406\u3002\n- \u9078\u64c7 **\u7ba1\u7406** \u6a19\u7c64\u9801\u3002\n- \u9ede\u64ca **Webhook** \u3002\n- \u9ede\u64ca **\u5275\u5efa** \u3002\n- \u8f38\u5165\u7db2\u7d61\u9264\u5b50\u6578\u64da\u3002\n- \u9ede\u64ca **\u4fdd\u5b58** \u3002\n\u8acb\u53c3\u95b1 `Webhook` \u985e\u578b\u7684 `create` \u65b9\u6cd5\u3002\n## \u7db2\u7d61\u9264\u5b50\u932f\u8aa4\n\u5982\u679c\u60a8\u7684\u7db2\u7d61\u9264\u5b50\u670d\u52d9\u5728\u8655\u7406\u7db2\u7d61\u9264\u5b50\u8acb\u6c42\u6642\u9047\u5230\u932f\u8aa4\uff0c\u90a3\u9ebc\u60a8\u7684\u7db2\u7d61\u9264\u5b50\u4ee3\u78bc\u61c9\u8fd4\u56de\u4ee5\u4e0b\u67d0\u500b HTTP \u72c0\u614b\u4ee3\u78bc\uff1a\n- `400`\u8acb\u6c42\u6709\u8aa4\n- `401`\u672a\u7d93\u6388\u6b0a\n- `403`\u5df2\u7981\u6b62\n- \u627e\u4e0d\u5230\u201c`404`\u201d\n- `500`\u670d\u52d9\u5668\u6545\u969c\n- `503`\u670d\u52d9\u4e0d\u53ef\u7528\n\u5728\u4ee5\u4e0b\u4efb\u4f55\u4e00\u7a2e\u932f\u8aa4\u60c5\u6cc1\u4e0b\uff0cDialogflow \u90fd\u6703\u8abf\u7528\u7db2\u7d61\u9264\u5b50\u932f\u8aa4\u6216\u8d85\u6642 [\u5167\u7f6e\u4e8b\u4ef6](https://cloud.google.com/dialogflow/cx/docs/concept/handler?hl=zh-cn#event-built-in) \uff0c\u4e26\u7167\u5e38\u8655\u7406\uff1a\n- \u97ff\u61c9\u8d85\u6642\u3002\n- \u5df2\u6536\u5230\u932f\u8aa4\u72c0\u614b\u4ee3\u78bc\u3002\n- \u97ff\u61c9\u7121\u6548\u3002\n- \u7db2\u7d61\u9264\u5b50\u670d\u52d9\u4e0d\u53ef\u7528\u3002\n\u6b64\u5916\uff0c\u5982\u679c\u6aa2\u6e2c\u610f\u5716 API \u8abf\u7528\u89f8\u767c\u4e86\u7db2\u7d61\u9264\u5b50\u670d\u52d9\u8abf\u7528\uff0c\u5247\u6aa2\u6e2c\u610f\u5716\u97ff\u61c9\u4e2d\u7684 `queryResult.webhookStatuses` \u5b57\u6bb5\u5c07\u5305\u542b\u7db2\u7d61\u9264\u5b50\u72c0\u614b\u4fe1\u606f\u3002\n## \u4f7f\u7528 Cloud Functions\nDialogflow \u8207 [Cloud Functions](https://cloud.google.com/functions/docs?hl=zh-cn) \u76f8\u96c6\u6210\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u8f15\u9b06\u5275\u5efa\u5b89\u5168\u7684\u7121\u670d\u52d9\u5668 Webhook\u3002 \u5982\u679c\u60a8\u5275\u5efa\u7684\u51fd\u6578\u8207\u4ee3\u7406\u4f4d\u65bc\u540c\u4e00\u9805\u76ee\u4e2d\uff0c\u5247\u4ee3\u7406\u53ef\u4ee5\u5b89\u5168\u5730\u8abf\u7528\u7db2\u7d61\u9264\u5b50\uff0c\u800c\u7121\u9700\u4efb\u4f55\u7279\u6b8a\u914d\u7f6e\u3002\n\u4e0d\u904e\uff0c\u5728\u4ee5\u4e0b\u5169\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u60a8\u5fc5\u9808\u624b\u52d5\u8a2d\u7f6e\u6b64\u96c6\u6210\uff1a\n- \u60a8\u7684\u4ee3\u7406\u9805\u76ee\u5fc5\u9808\u5b58\u5728\u5177\u6709\u4ee5\u4e0b\u5730\u5740\u7684 **Dialogflow Service Agent** [\u670d\u52d9\u5e33\u865f](https://cloud.google.com/iam/docs/understanding-service-accounts?hl=zh-cn) \uff1a```\nservice-agent-project-number@gcp-sa-dialogflow.iam.gserviceaccount.com\n```\u7576\u60a8\u7232\u9805\u76ee\u5275\u5efa\u7b2c\u4e00\u500b\u4ee3\u7406\u6642\uff0c\u7cfb\u7d71\u6703\u81ea\u52d5\u5275\u5efa\u6b64\u7279\u6b8a\u670d\u52d9\u5e33\u865f\u548c\u95dc\u806f\u7684\u5bc6\u9470\u3002\u5982\u679c\u4ee3\u7406\u662f\u5728 2020 \u5e74 11 \u6708 1 \u65e5\u4e4b\u524d\u5275\u5efa\u7684\uff0c\u5247\u53ef\u4ee5\u89f8\u767c\u6b64\u7279\u6b8a\u670d\u52d9\u5e33\u865f\u7684\u5275\u5efa\uff1a\n- \u7232\u9805\u76ee\u5275\u5efa\u65b0\u7684\u4ee3\u7406\u3002\n- \u57f7\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a```\ngcloud beta services identity create --service=dialogflow.googleapis.com --project=agent-project-id\n```\n- \u5982\u679c\u60a8\u7684\u7db2\u7d61\u9264\u5b50\u51fd\u6578\u8207\u4ee3\u7406\u4f4d\u65bc\u4e0d\u540c\u7684\u9805\u76ee\u4e2d\uff0c\u5247\u60a8\u5fc5\u9808\u5411\u51fd\u6578\u9805\u76ee\u4e2d\u7684 **Dialogflow Service Agent** \u670d\u52d9\u5e33\u865f\u63d0\u4f9b **Cloud Functions Invoker** [IAM \u89d2\u8272](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn) \u3002## \u4f7f\u7528 Service Directory \u9032\u884c\u5c08\u7528\u7db2\u7d61\u8a2a\u554f\nDialogflow \u8207 [Service Directory \u5c08\u7528\u7db2\u7d61\u8a2a\u554f\u901a\u9053](https://cloud.google.com/service-directory/docs/private-network-access-overview?hl=zh-cn) \u96c6\u6210\uff0c\u56e0\u6b64\u53ef\u4ee5\u9023\u63a5\u5230 VPC \u7db2\u7d61\u5167\u7684 Webhook \u76ee\u6a19\u3002\u9019\u6a23\u53ef\u4ee5\u5c07\u6d41\u91cf\u4fdd\u7559\u5728 Google Cloud \u7db2\u7d61\u4e2d\uff0c\u4e26\u5be6\u65bd [IAM](https://cloud.google.com/iam/docs/overview?hl=zh-cn) \u548c [VPC Service Controls](https://cloud.google.com/vpc-service-controls/docs/overview?hl=zh-cn) \u3002\n**\u6ce8\u610f** \uff1aVPC Service Controls \u908a\u754c\u76ee\u524d\u4e0d\u652f\u6301 Cloud Functions\u3002\n\u5982\u9700\u8a2d\u7f6e\u4ee5\u5c08\u7528\u7db2\u7d61\u7232\u76ee\u6a19\u7684\u7db2\u7d61\u9264\u5b50\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u6309\u7167 [Service Directory \u5c08\u7528\u7db2\u7d61\u914d\u7f6e](https://cloud.google.com/service-directory/docs/configuring-private-network-access?hl=zh-cn) \uff0c\u914d\u7f6e\u60a8\u7684 VPC \u7db2\u7d61\u548c Service Directory \u7aef\u9ede\u3002\n- \u60a8\u7684\u4ee3\u7406\u9805\u76ee\u5fc5\u9808\u5b58\u5728\u5177\u6709\u4ee5\u4e0b\u5730\u5740\u7684 **Dialogflow Service Agent** [\u670d\u52d9\u5e33\u865f](https://cloud.google.com/iam/docs/understanding-service-accounts?hl=zh-cn) \uff1a```\nservice-agent-project-number@gcp-sa-dialogflow.iam.gserviceaccount.com\n```\u5411 **Dialogflow Service Agent** \u670d\u52d9\u5e33\u865f\u6388\u4e88\u4ee5\u4e0b IAM \u89d2\u8272\uff1a- Service Directory \u9805\u76ee\u7684`servicedirectory.viewer`\n- \u7db2\u7d61\u9805\u76ee\u7684`servicedirectory.pscAuthorizedService`\n- \u5728\u5275\u5efa\u7db2\u7d61\u9264\u5b50\u6642\uff0c\u63d0\u4f9b Service Directory Service \u4ee5\u53ca\u7db2\u5740\u548c\u53ef\u9078\u7684\u8eab\u4efd\u9a57\u8b49\u4fe1\u606f\u3002\n\u8acb\u53c3\u95b1 `Webhook` \u985e\u578b\u7684 `serviceDirectory` \u5b57\u6bb5\u3002 \n## \u670d\u52d9\u8eab\u4efd\u4ee4\u724c\nDialogflow \u8abf\u7528\u7db2\u7d61\u9264\u5b50\u6642\uff0c\u6703\u5728\u8acb\u6c42\u4e2d\u63d0\u4f9b [Google \u8eab\u4efd\u4ee4\u724c](https://developers.google.com/identity/sign-in/web/backend-auth?hl=zh-cn) \u3002\u4efb\u4f55\u7db2\u7d61\u9264\u5b50\u90fd\u53ef\u4ee5\u9078\u64c7\u6027\u5730\u4f7f\u7528 Google \u5ba2\u6236\u7aef\u5eab\u6216 [github.com/googleapis/google-auth-library-nodejs](https://github.com/googleapis/google-auth-library-nodejs) \u7b49\u958b\u6e90\u5eab\u4f86\u9a57\u8b49\u4ee4\u724c\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u6309\u4ee5\u4e0b\u5f62\u5f0f\u9a57\u8b49 ID \u4ee4\u724c\u7684 `email` \uff1a\n```\nservice-agent-project-number@gcp-sa-dialogflow.iam.gserviceaccount.com\n```\n## \u793a\u4f8b\n\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u77ad\u5982\u4f55\u63a5\u6536 WebhookRequest \u548c\u767c\u9001 WebhookResponse\u3002\n[\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/dialogflow/basic-webhook/src/main/java/com/example/dialogflow/cx/BasicWebhook.java) \n```\n// TODO: Change class name to Example// TODO: add GSON dependency to Pom file// (https://mvnrepository.com/artifact/com.google.code.gson/gson/2.8.5)// TODO: Uncomment the line bellow before running cloud function// package com.example;import com.google.cloud.functions.HttpFunction;import com.google.cloud.functions.HttpRequest;import com.google.cloud.functions.HttpResponse;import com.google.gson.Gson;import com.google.gson.GsonBuilder;import com.google.gson.JsonObject;import com.google.gson.JsonParser;import java.io.BufferedWriter;public class BasicWebhook implements HttpFunction {\u00a0 @Override\u00a0 public void service(HttpRequest request, HttpResponse response) throws Exception {\u00a0 \u00a0 JsonParser parser = new JsonParser();\u00a0 \u00a0 Gson gson = new GsonBuilder().create();\u00a0 \u00a0 JsonObject parsedRequest = gson.fromJson(request.getReader(), JsonObject.class);\u00a0 \u00a0 // For more information on the structure of this object https://cloud.google.com/dialogflow/cx/docs/reference/rest/v3/Fulfillment\u00a0 \u00a0 String requestTag = parsedRequest.getAsJsonObject(\"fulfillmentInfo\")\u00a0 \u00a0 \u00a0 \u00a0 .getAsJsonPrimitive(\"tag\").toString();\u00a0 \u00a0 JsonObject responseObject = null;\u00a0 \u00a0 String defaultIntent = \"\\\"Default Welcome Intent\\\"\";\u00a0 \u00a0 String secondIntent = \"\\\"get-agent-name\\\"\";\u00a0 \u00a0 String responseText = \"\";\u00a0 \u00a0 // Compares the Intent Tag to provide the correct response\u00a0 \u00a0 if (requestTag.equals(defaultIntent)) {\u00a0 \u00a0 \u00a0 responseText = \"\\\"Hello from a Java GCF Webhook\\\"\";\u00a0 \u00a0 } else if (requestTag.equals(secondIntent)) {\u00a0 \u00a0 \u00a0 responseText = \"\\\"My name is Flowhook\\\"\";\u00a0 \u00a0 } else {\u00a0 \u00a0 \u00a0 responseText = \"\\\"Sorry I didn't get that\\\"\";\u00a0 \u00a0 }\u00a0 \u00a0 // Constructing the response jsonObject\u00a0 \u00a0 responseObject =\u00a0 \u00a0 \u00a0 \u00a0 parser\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .parse(\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"{ \\\"fulfillment_response\\\": { \\\"messages\\\": [ { \\\"text\\\": { \\\"text\\\": [\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 + responseText\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 + \"] } } ] } }\")\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .getAsJsonObject();\u00a0 \u00a0 BufferedWriter writer = response.getWriter();\u00a0 \u00a0 //Sends the responseObject\u00a0 \u00a0 writer.write(responseObject.toString());\u00a0 }}\n``` [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/googleapis/nodejs-dialogflow-cx/blob/HEAD/samples/webhooks.js) \n```\n// TODO: change entry point to exports.handleWebhook in cloud functionexports.handleWebhook = (request, response) => {\u00a0 const tag = request.body.fulfillmentInfo.tag;\u00a0 let text = '';\u00a0 if (tag === 'Default Welcome Intent') {\u00a0 \u00a0 text = 'Hello from a GCF Webhook';\u00a0 } else if (tag === 'get-name') {\u00a0 \u00a0 text = 'My name is Flowhook';\u00a0 } else {\u00a0 \u00a0 text = `There are no fulfillment responses defined for \"${tag}\"\" tag`;\u00a0 }\u00a0 const jsonResponse = {\u00a0 \u00a0 fulfillment_response: {\u00a0 \u00a0 \u00a0 messages: [\u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text: {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 //fulfillment text response to be sent to the agent\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text: [text],\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 },\u00a0 };\u00a0 response.send(jsonResponse);};\n``` [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/googleapis/python-dialogflow-cx/blob/HEAD/samples/snippets/webhook.py) \n```\n# TODO(developer): change entry point to handle_webhook in cloud functiondef handle_webhook(request):\u00a0 \u00a0 req = request.get_json()\u00a0 \u00a0 tag = req[\"fulfillmentInfo\"][\"tag\"]\u00a0 \u00a0 if tag == \"Default Welcome Intent\":\u00a0 \u00a0 \u00a0 \u00a0 # You can also use the google.cloud.dialogflowcx_v3.types.WebhookRequest protos instead of manually writing the json object\u00a0 \u00a0 \u00a0 \u00a0 # Please see https://googleapis.dev/python/dialogflow/latest/dialogflow_v2/types.html?highlight=webhookresponse#google.cloud.dialogflow_v2.types.WebhookResponse for an overview\u00a0 \u00a0 \u00a0 \u00a0 res = {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fulfillment_response\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"messages\": [{\"text\": {\"text\": [\"Hi from a GCF Webhook\"]}}]\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 elif tag == \"get-name\":\u00a0 \u00a0 \u00a0 \u00a0 res = {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fulfillment_response\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"messages\": [{\"text\": {\"text\": [\"My name is Phlowhook\"]}}]\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 else:\u00a0 \u00a0 \u00a0 \u00a0 res = {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fulfillment_response\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"messages\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"text\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"text\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 f\"There are no fulfillment responses defined for {tag} tag\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 # Returns json\u00a0 \u00a0 return res\n```", "guide": "Dialogflow"}