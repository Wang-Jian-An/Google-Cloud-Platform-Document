{"title": "Document AI - Create a Custom Document Extractor in the Google Cloud console", "url": "https://cloud.google.com/document-ai/docs/workbench/build-custom-processor?hl=zh-cn", "abstract": "# Document AI - Create a Custom Document Extractor in the Google Cloud console\n# Create a Custom Document Extractor in the Google Cloud console\nYou can create Custom Document Extractors (CDE) that are specifically suited to your documents, and trained and evaluated with your data. This processor identifies and extracts entities from your documents. You can then use this trained processor on additional documents. You typically would use a CDE on documents that are all of one type, such as your institution's enrollment forms.\nThis guide describes how to use Document AI Workbench to create and train a Custom Document Extractor that processes W-2 (US tax form) documents. Most of the document preparation work has been done so that you can focus on the other mechanics of creating a CDE.\nThe dataset used in these examples comes from [Kaggle](https://www.kaggle.com/datasets/mcvishnu1/fake-w2-us-tax-form-dataset) with a CC0: Public Domain License.\nA typical workflow to create and use a CDE is as follows:- Create a Custom Document Extractor in Document AI Workbench.\n- Define and create the processor schema.\n- Import documents.\n- Assign documents to the Training and Test sets.\n- Annotate documents manually in Document AI Workbench or with Labeling Tasks.\n- Train the processor.\n- Evaluate the processor.\n- Deploy the processor.\n- Test the processor.\n- Use the processor on your documents.\nYou can make your own configuration choices that suit your workflow.To follow step-by-step guidance for this task directly in the Google Cloud console, click **Guide me** :\n [Guide me](https://console.cloud.google.com/ai/document-ai?tutorial=document-ai--documentai-workbench_custom_extractor_console) ", "content": "## Before you begin\n## Create a processor\n- In the Google Cloud console, in the Document AI section, go to the **Workbench** page. [Workbench](https://console.cloud.google.com/ai/document-ai/workbench) \n- For **Custom Document Extractor** , click . \n- In the **Create processor** menu, enter a name for your processor, such as `my-custom-document-extractor` . \n- Select the region closest to you.\n- Optional: Open **Advanced Options** - You have the option to let Google create a Cloud Storage bucket for you, or you can [create your own](/storage/docs/creating-buckets) . For this tutorial, select **Google-managed storage** .\n- You also have the option to use Google-managed or [Customer-managed encryption keys (CMEK)](/kms/docs/cmek) . For this tutorial, select **Google-managed encryption key** .\n- Click **Create** to create your processor.\n## Define processor fieldsYou are now on the **Processor overview** page of the processor you just created.You can specify the fields you want the processor to extract and begin labeling documents.- Click the tab. The **Fields** menu appears.\n- Click **Create New Field** .\n- Enter the name for the field. Select the **Data type** and the **Occurrence** . Click **Create** . Refer to [Define processor schema](/document-ai/docs/workbench/label-documents#define_processor_schema) for detailed instructions on creating and editing a schema.\n- Create each of the following labels for the processor schema.| Name        | Data Type | Occurrence  |\n|:------------------------------------|:------------|:------------------|\n| control_number      | Number  | Optional multiple |\n| employees_social_security_number | Number  | Required multiple |\n| employer_identification_number  | Number  | Required multiple |\n| employers_name_address_and_zip_code | Address  | Required multiple |\n| federal_income_tax_withheld   | Money  | Required multiple |\n| social_security_tax_withheld  | Money  | Required multiple |\n| social_security_wages    | Money  | Required multiple |\n| wages_tips_other_compensation  | Money  | Required multiple |You can also create and use [other types of labels](/document-ai/docs/workbench/label-documents#labeling_options) in your processor schema, such as checkboxes and [tabular entities](/document-ai/docs/workbench/create-dataset#parent-child) . For example, the W-2 forms contain a **Statutory employee** , **Retirement plan** , and **Third party sick pay** check boxes that you could also add to the schema. \n## Upload a sample documentNext, you upload a sample W-2 PDF and label it.- Click **Upload Sample Document** .\n- In the sidebar, click **Import documents from Google Cloud Storage** .\n- For this example, enter this bucket name in . This links directly to one document.```\ncloud-samples-data/documentai/Custom/W2/PDF/W2_XL_input_clean_2950.pdf\n```\n- Click **Import** .\nYou are redirected to the labeling console.## Label a documentThe process of selecting text in a document, and applying labels is known as .- When you're at the labeling console, notice that many of the labels are already populated.Note: Your results might look slightly different than the sample image. \n- To use the suggested labels, hold the pointer over each in the side panel, and click the check mark to confirm the label is correct. You can edit the values if they don't match the document text.\n- In this example, the values at the bottom of the document were not identified automatically, so you will need to label them manually.\n- Use the tool by default, or the tool for multi-line values, to select the content and apply the label. **Note:** The **Select text** tool does not work for all text values, so use the **Bounding box** if appropriate. You can also select non-text fields such as checkboxes using the **Bounding box** tool.\n- In this example, the value of `wages_tips_other_compensation` was selected with the Bounding box tool, and that label is applied. \n- Review the detected text values to ensure that they reflect the correct text from the document.The labeled W-2 document should look like this when complete: \n- If needed, you can click to add a new field to the schema from this page.\n- Click when you have finished annotating the document.You are redirected to the **Get started** tab.\n## Build processor version using foundation modelAfter labeling a single document, you can create a processor version using the pretrained foundation model to extract entities.- Click the tab. \n- Under **Call foundation model** , click **Create New Version** .\n- Enter a name for your processor version, such as `w2-foundation-model` .\n- Click **Create Version** . It takes a few minutes to create. **Note:** Once you create a processor version, you cannot delete fields you have created. You can disable them on the fields page if you no longer need them.\n- Optional: Click the tab. On this page, you can view the available processor versions and the deployment status of the new version.\nYou test and evaluate this version later in the tutorial.## Use generative AI to auto-label documentsThe foundation model can accurately extract fields for a variety of document types, but you can also provide additional training data to improve the accuracy of the model for specific document structures.\nDocument AI Workbench uses the label names you define and previous annotations to make it quicker and easier to label documents at scale with [auto-labeling](/document-ai/docs/workbench/label-documents#auto-label) .- Go to the page.\n- Click .\n- In the sidebar, click **Import documents from Google Cloud Storage** .\n- Enter this bucket name in . This contains unlabeled W-2 PDF files.```\ncloud-samples-data/documentai/Custom/W2/AutoLabel\n```\n- From the **Data split** list, select **Auto-split** . This automatically splits the documents to have 80% in the training set and 20% in the test set.\n- In the **Auto-labeling** section, select the checkbox.\n- Select the foundation model processor version to label the documents.\n- Click **Import** and wait for the documents to import. You can leave this page and return later.\n- You must verify the auto-labeled documents before you can use them for training or testing. Click to view the auto-labeled documents.\n- To use the suggested labels, hold the pointer over each , and click the check mark to confirm the label is correct. You can edit the values if they do not match the document text.\n- Click when you have finished annotating the document.\n- Repeat for each auto-labeled document. For this tutorial, you can skip any documents that were not successfully auto-labeled.\n## Import prelabeled training documentsIn this guide, you are provided with prelabeled data. If working on your own project, you have to determine how to label your data. Refer to [Labeling options](/document-ai/docs/workbench/label-documents#labeling_options) for more details. In general, more training data produces higher accuracy.- Go to the page.\n- Click .\n- In the sidebar, click **Import documents from Google Cloud Storage** .\n- Enter the following path in **Source path** . This bucket contains prelabeled documents in the [Document JSON](/document-ai/docs/reference/rest/v1/Document) format.```\ncloud-samples-data/documentai/Custom/W2/JSON-2\n```\n- From the **Data split** list, select **Auto-split** . This automatically splits the documents to have 80% in the training set, and 20% in the test set. Leave **Import with auto-labeling** unchecked.\n- Click **Import** . Import takes several minutes.\n## Optional: View and manage dataset\n- From the **Build** page, you can access theconsole to view and edit all documents and labels in the dataset.\n## Train the processorNow that you have sufficient training and test data, you can train the processor. Because training might take several hours, make sure you have set up the processor with the appropriate data and labels before you begin training.- For information about the dataset requirements, under **Train a custom model** , click **Create New Version** or **View Full Requirements** .\n- In the **Version name** field, enter a name for this processor version, such as `w2-custom-model` .\n- Optional: Click **View Label Stats** to find information about the document labels. That can help determine your coverage. Click **Close** to return to the training setup.\n- Under **Model training method** , select **Model based** .\n- Click **Start training** . Training takes a few hours. You can close this page and come back later.\n- Optional: Click the tab. On this page, you can view the available processor versions and the training status of the new version.\n## Deploy the processor version\n- After training is complete, click the tab.\n- Click the checkbox on the left of the version you want to deploy, and select **Deploy** .\n- Select **Deploy** from the dialog window. Deployment takes a few minutes.\n- When the version is deployed, you can set it as the or you can provide the version id when processing documents with the API.\n## Evaluate and test the processor\n- Click the tab to test the processor version.On this page, you can view evaluation metrics including the F1 score, Precision and Recall for the full document, and individual labels. For more information about evaluation and statistics, refer to [Evaluate processor](/document-ai/docs/workbench/evaluate) .\n- Click the selector and select the version using the foundation model.\n- Download a document that has not been involved in previous training or testing so that you can use it to evaluate the processor version. If using your own data, you would use a document set aside for this purpose. [file_downloadDownload PDF](https://storage.googleapis.com/cloud-samples-data/documentai/LendingDocAI/W2Parser/W2_XL_input_clean_1000.pdf) \n- Click and select the document you just downloaded.The **Custom Document Extractor analysis** page opens. The screen output demonstrates how well the document was extracted.\n- Test the document again using the version with a custom trained model.\n## Use the processorYou have successfully created and trained a Custom Document Extractor processor.\nYou can manage your custom trained processor versions just like any other processor version. For more information, refer to [Managing processor versions](/document-ai/docs/manage-processor-versions) .\nTo use the Document AI API:- Follow the code samples in [send a processing request](/document-ai/docs/send-request) to use online or batch processing.- Refer to [Quotas and limits](/document-ai/quotas#processor_limits) for the number of pages supported for online and batch processing.\n- Follow the Custom Document Extractor code sample in [Handle the processing response](/document-ai/docs/handle-response#cde) to get the extracted entities from the processor.\n## Clean upTo avoid incurring charges to your Google Cloud account for   the resources used on this page, follow these steps.\nTo avoid unnecessary Google Cloud charges, use the [Google Cloud console](https://console.cloud.google.com/) to delete your processor and project if you do not need them.\nIf you created a new project to learn about Document AI and you no longer need the project, [delete the project](https://console.cloud.google.com/cloud-resource-manager) .\nIf you used an existing Google Cloud project, delete the resources you created to avoid incurring charges to your account:- In the Google Cloud console navigation menu, click **Document AI** and select **My Processors** .\n- Click in the same row as the processor you want to delete.\n- Click **Delete processor** , type the processor name, then click **Delete** again to confirm.\n## What's next\n- [Creating and using a Custom Document Classifier](/document-ai/docs/workbench/build-custom-classification-processor) \n- [Creating and using a Custom Document Splitter](/document-ai/docs/workbench/build-custom-splitter-processor)", "guide": "Document AI"}