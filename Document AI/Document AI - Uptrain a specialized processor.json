{"title": "Document AI - Uptrain a specialized processor", "url": "https://cloud.google.com/document-ai/docs/workbench/uptrain-processor?hl=zh-cn", "abstract": "# Document AI - Uptrain a specialized processor\n# Uptrain a specialized processor\nThis page shows you how to uptrain a specialized processor to improve accuracy.\nUptraining means that you begin with a pre-made model, and then train this model with your own data to improve its accuracy and add custom fields.\nThis topic focuses on the [InvoiceParser](/document-ai/docs/processors-list#processor_invoice-processor) . Invoice formats are diverse, and uptraining a generic Invoice Parser with your own specific invoice data can improve its accuracy on specific formats and allow the parser to extract other fields that aren't supported by the pre-trained model.\nFor this guide, sample data is provided. You can follow the same procedures to use your own data.To follow step-by-step guidance for this task directly in the Google Cloud console, click **Guide me** :\n [Guide me](https://console.cloud.google.com/ai/document-ai?tutorial=document-ai--documentai-workbench_uptraining_console) ", "content": "## Before you begin\n## Create a processor\n- In the Google Cloud console navigation menu, click **Document AI** and select **Processor Gallery** . [ProcessorGallery](https://console.cloud.google.com/ai/document-ai/processor-library) \n- In the **Processor Gallery** , **Invoice Parser** and select **Create** . \n- Enter a **Processor name** , such as `invoice-parser-for-uptraining` .\n- Select the region closest to you.\n- Click **Create** . The **Processor Details** tab appears. \n## Create a Cloud Storage bucket for the datasetIn order to train this new processor, you must create a dataset with training and testing data to help the processor identify the entities that you want to extract.\nThis dataset requires a new [Cloud Storage bucket](/storage) . Do not use the same bucket where your documents are currently stored.- Go to your processor's tab.\n- Click . You are prompted to select or create an empty Cloud Storage bucket or folder. \n- Click to open **Select folder** .\n- Click the icon and follow the prompts to create a new bucket. For more information on creating a Cloud Storage bucket, refer [Cloud Storagebuckets](/storage/docs/creating-buckets) . **Note:** A bucket is the top-level storage entity, in which you can nest folders. Instead of creating and selecting a bucket, you could also create and select an empty folder inside an existing bucket, if you prefer. Refer to [simulated folders](/storage/docs/objects#simulated-folders) .After you create the bucket, the **Select folder** page appears for that bucket.\n- On the **Select folder** page for your bucket, click the button at the bottom of the dialog box. \n- Make sure the **destination path** is populated with the bucket name you selected. Click . The dataset might take up to several minutes to create. \nYou can decide whether you want to proceed directly to uptraining documents, or whether you want to create a sample labeled document from your dataset that will then be used in the uptraining process.\nTo proceed directly to uptraining, go to [Import pre-labeleddata](#import-prelabeled-data) . You then skip the steps of importing a sample document, using tools to manually label the fields, and adding the document to the training data.\nIf you want to manually label a sample document and add it to the training set before you proceed with uptraining, continue to [Import a sample document formanual labeling](#import-sample) and proceed through all of the sections in this topic.## Import a sample document for manual labelingNext, import a sample invoice PDF file into your dataset. You will label the fields in this document to assist the subsequent uptraining process.\nIn this guide, you are provided with a representative file to be the sample document.- On the **Train** tab, click . \n- For this example, enter this bucket name in . This links directly to one document.```\ncloud-samples-data/documentai/codelabs/uptraining/pdfs\n```\n- For **Data split** , select **Unassigned** . The document in this folder will not be assigned to either the testing or training set. Leave **Import withauto-labeling** unchecked.\n- Click **Import** . Document AI reads the documents from the bucket into the dataset. It does not modify the import bucket or read from the bucket after the import is complete.\nWhen you import documents, you can optionally assign the documents to the **Training** or **Test** set when imported, or wait to assign them later.\nIf you want to delete a document or documents that you have imported, select them on the **Train** tab, and click **Delete** .\nFor more information about preparing your data for import, refer to the [Datapreparation guide](/document-ai/docs/workbench/create-dataset) .## Define processor schemaYour dataset might not contain all of the labels supported by the Invoice Parser. If so, you must mark the labels that aren't used as `Inactive` before you begin uptraining. You can also add one or more custom labels before you begin uptraining.- On the **Train** tab, click in the lower left. The **Manage labels** page opens.\n- To disable unused labels, select the for the fields that are **not** on the following list, and then click **Disable** . The following fields should remain enabled:```\ninvoice_date\nline_item\n amount\n description\nreceiver_address\nreceiver_name\nsupplier_address\nsupplier_name\ntotal_amount\n``` **Note:** Labels cannot be deleted. Instead, you can disable any label you do not want to use.\n- Click when the labels are complete. \n- Click the to return to the **Train** page.\n## Label a documentThe process of selecting text in a document, and applying labels is known as .- Return to the **Train** tab, and click to open the **Label management** console.\n- Next, you will click on the schema label in the left hand panel that corresponds to the value you want to annotate, and apply the label.\n- Use the tool by default, or the tool for multi-line values, to select the content and apply the label.For example, in this invoice, the text \"McWilliam Piping International Piping Company\" should be assigned the label `supplier_name` . You can use the text filter to search for label names. **Note:** The **Select text** tool does not work for all text values, so use the **Bounding box** if appropriate. You can also select non-text fields such as checkboxes using the **Bounding box** tool.\n- Review the detected text values to ensure that they reflect the correct text from the document.- When you select text that corresponds to a label, make sure you include only the relevant text. For example, for an `invoice_id` label, do not include characters like `#` that often precede the numeric value. Do not include currency symbols like `$` for money.- Make sure you annotate all instances of an entity. For example,`supplier_name`or`invoice_id`might occur multiple times in the document, and each instance should be annotated.\n- Repeat for each field that you want to label.\nHere is an example of the full set of labels with corresponding text.\n| Label Name   | Text           |\n|:----------------------|:----------------------------------------------|\n| supplier_name   | McWilliam Piping International Piping Company |\n| supplier_address  | 14368 Pipeline Ave Chino, CA 91710   |\n| invoice_id   | 10001           |\n| due_date    | 2020-01-02         |\n| line_item/description | Knuckle Couplers        |\n| line_item/quantity | 9            |\n| line_item/unit_price | 74.43           |\n| line_item/amount  | 669.87          |\n| line_item/description | PVC Pipe 12 Inch        |\n| line_item/quantity | 7            |\n| line_item/unit_price | 15.90           |\n| line_item/amount  | 111.30          |\n| line_item/description | Copper Pipe         |\n| line_item/quantity | 7            |\n| line_item/unit_price | 91.20           |\n| line_item/amount  | 638.40          |\n| net_amount   | 1419.57          |\n| total_tax_amount  | 113.57          |\n| total_amount   | 1533.14          |\n| currency    | $            |- Click when you have finished annotating the document.On the **Train** tab, the left-hand panel shows that 1 document has been labeled.\n## Assign annotated document to the training setNow that you have labeled this example document, you can assign it to the training set.- On the **Train** tab, select the checkbox.\n- From the list, select **Training** .\nIn the left-hand panel, you can find that 1 document has been assigned to the training set.## Import pre-labeled data to the training and test setsDocument AI Uptraining requires a minimum of 10 documents in both the training and test sets, along with 10 instances of each label in each set.\nIt's recommended that you have at least 50 documents in each set, with 50 instances of each label, for best performance. More training data generally equates to higher accuracy.\nIn this guide, you are provided with pre-labeled data. If working on your own project, you will have to determine how to label your data. Refer to [Labelingoptions](/document-ai/docs/workbench/label-documents#labeling_options) .- Click .\n- Enter the following path in . This bucket contains pre-labeled documents in the [Document JSON](/document-ai/docs/reference/rest/v1/Document) format.```\ncloud-samples-data/documentai/Custom/Invoices/JSON\n```\n- From the **Data split** list, select **Auto-split** . This automatically splits the documents to have 80% in the training set, and 20% in the test set. Leave **Import with auto-labeling** unchecked.\n- Click **Import** . The import might take several minutes to complete.\nWhen the import is finished, you will find the documents on the **Train** tab.## Optional: Auto-label newly imported documentsWhen importing unlabeled documents for a processor with an existing deployed processor version, you can use [Auto-labeling](/document-ai/docs/workbench/label-documents#auto-label) to save time on labeling.- On the **Train** page, .\n- Copy and paste the following Cloud Storage path. This directory contains 5 unlabeled invoice PDFs. From the **Data split** dropdown list, select **Training** .```\ncloud-samples-data/documentai/Custom/Invoices/PDF_Unlabeled\n```\n- In the **Auto-labeling** section, select the checkbox.\n- Select an existing processor version to label the documents.- For example:`pretrained-invoice-v1.3-2022-07-15`\n- Click **Import** and wait for the documents to import. You can leave this page and return later.- When complete, the documents appear in the **Train** page in the **Auto-labeled** section.\n- You cannot use auto-labeled documents for training or testing without marking them as labeled. Go to the section to view the auto-labeled documents.\n- Select the first document to enter the labeling console.\n- Verify the label to ensure it is correct. Adjust if it is incorrect.\n- Select when finished.\n- Repeat the label verification for each auto-labeled document, then return to the **Train** page to use the data for training.\n## Train the processorNow that you have imported the training and test data, you can train the processor. Because training might take several hours, make sure you have set up the processor with the appropriate data and labels before you begin training.- Click .\n- In the field, enter a name for this processor version, such as `invoice-uptrain-1` .\n- (Optional) Click **View Label Stats** to find information about the document labels. That can help determine your coverage. Click **Close** to return to the training setup.\n- Click You can check the status on the right-hand panel.The **Dataset management** page opens. You can view the training status on the right side. Training will likely take a few hours to complete, depending on the size of your dataset. You can leave this page and return later.\n## Deploy the processor version\n- After training is complete, navigate to the tab. You can view details about the version you just trained.\n- Click the on the right of the version you want to deploy, and select **Deploy version** .\n- Select from the popup window.Deployment takes a few minutes to complete.\n## Evaluate and test the processor\n- After deployment is complete, navigate to the tab.On this page, you can view evaluation metrics including the F1 score, Precision and Recall for the full document, and individual labels. For more information about evaluation and statistics, refer to [Evaluateprocessor](/document-ai/docs/workbench/evaluate) .\n- Download a document that has not been involved in previous training or testing so that you can use it to evaluate the processor version. If using your own data, you would use a document set aside for this purpose. [file_downloadDownload PDF](https://storage.googleapis.com/cloud-samples-data/documentai/Custom/Invoices/ams.pdf) \n- Click and select the document you just downloaded.The **Invoice Parser analysis** page opens. The screen output will demonstrate how well the document was classified.You can also re-run the evaluation against a different test set or processor version.\n## Use the processorYou have successfully created and uptrained an Invoice Parser processor.\nYou can manage your custom-trained processor versions just like any other processor version. For more information, refer to [Managing processorversions](/document-ai/docs/manage-processor-versions) .\nYou can [Send a processing request](/document-ai/docs/send-request) to your custom processor, and the [response can be handled the same as other entityextractionprocessors](/document-ai/docs/handle-response#entities_nested_entities_and_normalized_values) .## Clean upTo avoid incurring charges to your Google Cloud account for   the resources used on this page, follow these steps.\nTo avoid unnecessary Google Cloud charges, use the [Google Cloud console](https://console.cloud.google.com/) to delete your processor and project if you do not need them.\nIf you created a new project to learn about Document AI and you no longer need the project, [delete the project](https://console.cloud.google.com/cloud-resource-manager) .\nIf you used an existing Google Cloud project, delete the resources you created to avoid incurring charges to your account:- In the Google Cloud console navigation menu, click **Document AI** and select **My Processors** .\n- Click in the same row as the processor you want to delete.\n- Click **Delete processor** , type the processor name, then click **Delete** again to confirm.\n## What's next\n- [The Future of Documents - YouTube Playlist](https://www.youtube.com/playlist?list=PLIivdWyY5sqIR88BxIK-3w14Vm-jTH1id) \n- [Document AI Documentation](https://cloud.google.com/document-ai/docs/overview) \n- [Document AI Python Client Library](/python/docs/reference/documentai/latest) \n- [Document AI Samples](https://github.com/GoogleCloudPlatform/document-ai-samples) \n- [Creating and using a Custom Document Extractor](/document-ai/docs/workbench/build-custom-processor)", "guide": "Document AI"}