{"title": "IAM - Troubleshoot workload identity federation", "url": "https://cloud.google.com/iam/docs/troubleshooting-workload-identity-federation", "abstract": "# IAM - Troubleshoot workload identity federation\nThis page describes resolutions for common [workload identityfederation](/iam/docs/workload-identity-federation) errors.\n", "content": "## Google Cloud API does not accept the credential issued from SecurityTokenService\nIf you encounter the following error, you might be attempting to access a Google Cloud API directly using a credential issued from `SecurityTokenService` instead of exchanging it for a service account credential first.\n```\n{\u00a0 \"error\": {\u00a0 \u00a0 \"code\": 401,\u00a0 \u00a0 \"message\": \"Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or other valid authentication credential. See https://developers.google.com/identity/sign-in/web/devconsole-project.\",\u00a0 \u00a0 \"status\": \"UNAUTHENTICATED\",\u00a0 }}\n```\nTo resolve this error, exchange the credential minted from the `SecurityTokenService` for a service account token by calling [GenerateAccessToken](/iam/docs/reference/credentials/rest/v1/projects.serviceAccounts/generateAccessToken) . For more information, see [Obtaining short-lived credentials with identityfederation](/iam/docs/using-workload-identity-federation) .\n## Allowlist an identity provider for use with workload identity federation\nIf you attempt to configure a disallowed identity provider as a workload identity pool provider, you encounter the following error:\n```\nFAILED_PRECONDITION: Precondition check failed.- '@type': type.googleapis.com/google.rpc.PreconditionFailure\u00a0 violations:\u00a0 - description: \"Org Policy violated for value: '{PROVIDER}'.\"\u00a0 \u00a0 subject: orgpolicy:projects/{PROJECT}/locations/global/workloadIdentityPools/{POOL}\u00a0 \u00a0 type: constraints/iam.workloadIdentityPoolProviders\n```\nTo resolve this issue, follow the directions on [Restrict identity provider configuration](/iam/docs/manage-workload-identity-pools-providers#restrict) to allowlist the identity provider for use with workload identity federation.\n## Error connecting to the given credential's issuer\nIf you receive the following error, it might be because Google Cloud is unable to fetch your IdP's OIDC metadata document or JWKS:\n```\n{\u00a0 \"error\": \"invalid_grant\",\u00a0 \"error_description\":\"Error connecting to the given credential's issuer.\"\u00a0}\n```\nThis error usually occurs because the endpoints aren't configured to be reachable from the public internet. To resolve this error, check that the OIDC endpoint is publicly available and compliant with the OIDC specification. For more information, see [Preparing the external identity provider](/iam/docs/configuring-workload-identity-federation#oidc) .\nIf you still receive the error, check that the token issuer, the `iss` claim in the token correct.", "guide": "IAM"}