{"title": "IAM - \u505c\u7528\u548c\u5553\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470", "url": "https://cloud.google.com/iam/docs/keys-disable-enable?hl=zh-cn", "abstract": "# IAM - \u505c\u7528\u548c\u5553\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\n\u672c\u9801\u9762\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u3001 [Google Cloud CLI](https://cloud.google.com/sdk/gcloud?hl=zh-cn) \u3001 [Identity and Access Management API](https://cloud.google.com/iam/docs/reference/rest?hl=zh-cn) \u6216\u67d0\u500b [Google Cloud \u5ba2\u6236\u7aef\u5eab](https://cloud.google.com/apis/docs/cloud-client-libraries?hl=zh-cn) \u4f86\u505c\u7528\u548c\u5553\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\n**\u6ce8\u610f** \uff1a\u5982\u679c\u60a8\u9700\u8981\u5f9e Google Cloud \u5916\u90e8\uff08\u4f8b\u5982 Amazon Web Services (AWS) \u6216 Microsoft Azure\uff09\u904b\u884c\u7684\u5de5\u4f5c\u8ca0\u8f09\u8a2a\u554f\u8cc7\u6e90\uff0c\u8acb\u8003\u616e\u4f7f\u7528 [\u5de5\u4f5c\u8ca0\u8f09\u8eab\u4efd\u806f\u5408](https://cloud.google.com/iam/docs/workload-identity-federation?hl=zh-cn) \uff0c\u800c\u4e0d\u662f\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\u85c9\u52a9\u806f\u5408\uff0c\u60a8\u7684\u5de5\u4f5c\u8ca0\u8f09\u4fbf\u53ef\u4ee5\u4f7f\u7528\u77ed\u671f\u6709\u6548\u7684\u8a2a\u554f\u4ee4\u724c\u76f4\u63a5\u8a2a\u554f\u8cc7\u6e90\uff0c\u800c\u8207\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u76f8\u95dc\u806f\u7684\u7dad\u8b77\u548c\u5b89\u5168\u8ca0\u64d4\u4e5f\u5f97\u4ee5\u6d88\u9664\u3002\n", "content": "## \u6e96\u5099\u5de5\u4f5c\n-   Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them   \u5553\u7528 IAM API\u3002 [\u5553\u7528 API](https://console.cloud.google.com/flows/enableapi?apiid=iam.googleapis.com&%3Bredirect=https%3A%2F%2Fconsole.cloud.google.com&hl=zh-cn) \n- \u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49\u3002  Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them   \u9078\u64c7\u6a19\u7c64\u9801\u4ee5\u77ad\u89e3\u60a8\u6253\u7b97\u5982\u4f55\u4f7f\u7528\u672c\u9801\u9762\u4e0a\u7684\u793a\u4f8b\uff1a\n\u60a8\u53ef\u4ee5\u5f9e\u4ee5\u4e0b\u4efb\u4e00\u958b\u767c\u74b0\u5883\u4f7f\u7528\u672c\u9801\u9762\u4e0a\u7684 gcloud CLI \u793a\u4f8b\uff1a- **Cloud Shell** \uff1a\u5982\u9700\u4f7f\u7528\u5df2\u8a2d\u7f6e gcloud CLI \u7684\u5728\u7dda\u7d42\u7aef\uff0c\u8acb\u6fc0\u6d3b Cloud Shell\u3002Cloud Shell \u6703\u8a71\u6703\u5728\u9801\u9762\u5e95\u90e8\u5553\u52d5\uff0c\u4e26\u986f\u793a\u547d\u4ee4\u884c\u63d0\u793a\u7b26\u3002\u8a72\u6703\u8a71\u53ef\u80fd\u9700\u8981\u5e7e\u79d2\u9418\u4f86\u5b8c\u6210\u521d\u59cb\u5316\u3002\n- **\u672c\u5730 shell** \uff1a\u5982\u9700\u5728\u672c\u5730\u958b\u767c\u74b0\u5883\u4e2d\u4f7f\u7528 gcloud CLI\uff0c\u8acb [\u5b89\u88dd](https://cloud.google.com/sdk/docs/install?hl=zh-cn) \u4e26 [\u521d\u59cb\u5316](https://cloud.google.com/sdk/docs/initializing?hl=zh-cn) gcloud CLI\u3002\n\u5982\u9700\u5f9e\u672c\u5730\u958b\u767c\u74b0\u5883\u4f7f\u7528\u672c\u9801\u9762\u4e0a\u7684 Java \u793a\u4f8b\uff0c\u8acb\u5b89\u88dd\u4e26\u521d\u59cb\u5316 gcloud CLI\uff0c\u7136\u5f8c\u4f7f\u7528\u7528\u6236\u6191\u64da\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- [\u5b89\u88dd](https://cloud.google.com/sdk/docs/install?hl=zh-cn) Google Cloud CLI\u3002\n- \u5982\u9700 [\u521d\u59cb\u5316](https://cloud.google.com/sdk/docs/initializing?hl=zh-cn) gcloud CLI\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a```\ngcloud init\n```\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u7232\u60a8\u7684 Google \u8cec\u865f\u5275\u5efa\u672c\u5730\u8eab\u4efd\u9a57\u8b49\u6191\u64da\uff1a```\ngcloud auth application-default login\n```\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 Google Cloud \u8eab\u4efd\u9a57\u8b49\u6587\u6a94\u4e2d\u7684 [\u7232\u672c\u5730\u958b\u767c\u74b0\u5883\u8a2d\u7f6e\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#local-dev) \u3002\u5982\u9700\u5728\u672c\u5730\u958b\u767c\u74b0\u5883\u4e2d\u4f7f\u7528\u672c\u9801\u9762\u4e0a\u7684 REST API \u793a\u4f8b\uff0c\u8acb\u4f7f\u7528\u60a8\u63d0\u4f9b\u7d66 gcloud CLI \u7684\u6191\u64da\u3002- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- [\u5b89\u88dd](https://cloud.google.com/sdk/docs/install?hl=zh-cn) Google Cloud CLI\uff0c\u7136\u5f8c\u901a\u904e\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4 [\u521d\u59cb\u5316](https://cloud.google.com/sdk/docs/initializing?hl=zh-cn) Google Cloud CLI\uff1a\n- ```\ngcloud init\n```\n- \u77ad\u89e3 [\u670d\u52d9\u8cec\u865f\u6191\u64da](https://cloud.google.com/iam/docs/service-account-creds?hl=zh-cn) \u3002\n### \u6240\u9700\u7684\u89d2\u8272\n\u5982\u9700\u7372\u5f97\u505c\u7528\u548c\u5553\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u6240\u9700\u7684\u6b0a\u9650\uff0c\u8acb\u8b93\u7ba1\u7406\u54e1\u5411\u60a8\u6388\u4e88\u9805\u76ee\u6216\u8005\u60a8\u8981\u7ba1\u7406\u5176\u5bc6\u9470\u7684\u670d\u52d9\u8cec\u865f\u7684 [Service Account Key Admin](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#iam.serviceAccountKeyAdmin) ( `roles/iam.serviceAccountKeyAdmin` ) IAM \u89d2\u8272\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u6388\u4e88\u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [\u7ba1\u7406\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/iam/docs/granting-changing-revoking-access?hl=zh-cn) \u3002\n\u60a8\u4e5f\u53ef\u4ee5\u901a\u904e [\u81ea\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/creating-custom-roles?hl=zh-cn) \u6216\u5176\u4ed6 [\u9810\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn) \u4f86\u7372\u53d6\u6240\u9700\u7684\u6b0a\u9650\u3002\n\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u670d\u52d9\u8cec\u865f\u89d2\u8272](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#service-accounts-roles) \u3002\nIAM \u57fa\u672c\u89d2\u8272\u9084\u5305\u542b\u7ba1\u7406\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u7684\u6b0a\u9650\u3002\u60a8\u4e0d\u61c9\u5728\u751f\u7522\u74b0\u5883\u4e2d\u6388\u4e88\u57fa\u672c\u89d2\u8272\uff0c\u4f46\u53ef\u4ee5\u5728\u958b\u767c\u6216\u6e2c\u8a66\u74b0\u5883\u4e2d\u6388\u4e88\u9019\u4e9b\u89d2\u8272\u3002\n## \u505c\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\n\u505c\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u6703\u5c0e\u81f4\u60a8\u7121\u6cd5\u4f7f\u7528\u8a72\u5bc6\u9470\u5411 Google API \u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002\u60a8\u53ef\u4ee5\u96a8\u6642 [\u5553\u7528\u5df2\u505c\u7528\u7684\u5bc6\u9470](#enabling) \u3002\n**\u91cd\u8981\u63d0\u793a** \uff1a\u505c\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u4e0d\u6703\u64a4\u6d88\u6839\u64da\u5bc6\u9470\u9812\u767c\u7684\u77ed\u671f\u6709\u6548\u6191\u64da\u3002\u5982\u9700\u64a4\u6d88\u5df2\u88ab\u7834\u89e3\u7684\u77ed\u671f\u6709\u6548\u6191\u64da\uff0c\u60a8\u5fc5\u9808 [\u505c\u7528\u6216\u522a\u9664\u6191\u64da\u4ee3\u8868\u7684\u670d\u52d9\u8cec\u865f](https://cloud.google.com/iam/docs/service-accounts-disable-enable?hl=zh-cn#disabling) \u3002\u5982\u679c\u60a8\u9019\u6a23\u505a\uff0c\u5247\u4f7f\u7528\u8a72\u670d\u52d9\u8cec\u865f\u7684\u4efb\u4f55\u5de5\u4f5c\u8ca0\u8f09\u90fd\u5c07\u7acb\u5373\u5931\u53bb\u60a8\u7684\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\u3002\n\u5728 [\u522a\u9664\u670d\u52d9\u8cec\u865f\u5bc6\u9470](https://cloud.google.com/iam/docs/keys-create-delete?hl=zh-cn#deleting) \u4e4b\u524d\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u5148\u505c\u7528\u5bc6\u9470\uff0c\u7b49\u5230\u60a8\u78ba\u5b9a\u4e0d\u518d\u9700\u8981\u8a72\u5bc6\u9470\u6642\uff0c\u5373\u53ef\u5c07\u5176\u522a\u9664\u3002\n\u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u67e5\u770b\u5df2\u505c\u7528\u7684\u5bc6\u9470\uff0c\u4f46\u7121\u6cd5\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u505c\u7528\u5bc6\u9470\u3002\u8acb\u6539\u7528 gcloud CLI \u6216 REST API\u3002\n\u57f7\u884c [gcloud iam service-accounts keys disable](https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/keys/disable?hl=zh-cn) \u547d\u4ee4\u53ef\u505c\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\n\u66ff\u63db\u4ee5\u4e0b\u503c\uff1a- ``\uff1a\u8981\u505c\u7528\u7684\u5bc6\u9470\u7684 ID\u3002 \u5982\u9700\u67e5\u627e\u5bc6\u9470\u7684 ID\uff0c\u8acb [\u5217\u51fa\u670d\u52d9\u8cec\u865f\u7684\u6240\u6709\u5bc6\u9470](https://cloud.google.com/iam/docs/keys-list-get?hl=zh-cn#list-keys) \uff0c\u627e\u5230\u8981\u505c\u7528\u7684\u5bc6\u9470\uff0c\u7136\u5f8c\u8907\u88fd\u5176 ID\u3002\n- ``\uff1a\u5bc6\u9470\u6240\u5c6c\u670d\u52d9\u8cec\u865f\u7684\u540d\u7a31\u3002\n- ``\uff1a\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\n```\ngcloud iam service-accounts keys disable KEY_ID \\\u00a0 \u00a0 --iam-account=SA_NAME@PROJECT_ID.iam.gserviceaccount.com \\\u00a0 \u00a0 --project=PROJECT_ID\n```\n\u8f38\u51fa\u5982\u4e0b\uff1a\n```\nDisabled key [KEY_ID] for service account\n[SA_NAME@PROJECT_ID.iam.gserviceaccount.com]\n```\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u548c\u4f7f\u7528 IAM \u5ba2\u6236\u7aef\u5eab\uff0c\u8acb\u53c3\u95b1 [IAM \u5ba2\u6236\u7aef\u5eab](https://cloud.google.com/iam/docs/reference/libraries?hl=zh-cn) \u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [IAM Java API \u53c3\u8003\u6587\u6a94](https://developers.google.com/api-client-library/java/apis/iam/v1?hl=zh-cn) \u3002\n\u5982\u9700\u5411 IAM \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e96\u5099\u5de5\u4f5c](#before-you-begin) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/iam/api-client/src/main/java/iam/snippets/DisableServiceAccountKey.java) \n```\nimport com.google.api.client.googleapis.javanet.GoogleNetHttpTransport;import com.google.api.client.json.gson.GsonFactory;import com.google.api.services.iam.v1.Iam;import com.google.api.services.iam.v1.IamScopes;import com.google.api.services.iam.v1.model.DisableServiceAccountKeyRequest;import com.google.auth.http.HttpCredentialsAdapter;import com.google.auth.oauth2.GoogleCredentials;import java.io.IOException;import java.security.GeneralSecurityException;import java.util.Collections;public class DisableServiceAccountKey {\u00a0 public static void main(String[] args) throws IOException {\u00a0 \u00a0 // TODO(Developer): Replace the below variables before running.\u00a0 \u00a0 String projectId = \"gcloud-project-id\";\u00a0 \u00a0 String serviceAccountName = \"service-account-name\";\u00a0 \u00a0 String serviceAccountKeyName = \"service-account-key-name\";\u00a0 \u00a0 disableServiceAccountKey(projectId, serviceAccountName, serviceAccountKeyName);\u00a0 }\u00a0 // Disables a service account key.\u00a0 public static void disableServiceAccountKey(String projectId, String serviceAccountName,\u00a0 \u00a0 \u00a0 String serviceAccountKeyName) {\u00a0 \u00a0 // Initialize the IAM service.\u00a0 \u00a0 Iam service = null;\u00a0 \u00a0 try {\u00a0 \u00a0 \u00a0 service = initService();\u00a0 \u00a0 } catch (IOException | GeneralSecurityException e) {\u00a0 \u00a0 \u00a0 System.out.println(\"Unable to initialize service: \\n\" + e);\u00a0 \u00a0 \u00a0 return;\u00a0 \u00a0 }\u00a0 \u00a0 // Construct the service account email.\u00a0 \u00a0 // You can modify the \".iam.gserviceaccount.com\" to match the service account name in which\u00a0 \u00a0 // you want to disable the key.\u00a0 \u00a0 // See, https://cloud.google.com/iam/docs/creating-managing-service-account-keys?hl=en#disabling\u00a0 \u00a0 String serviceAccountEmail = serviceAccountName + \"@\" + projectId + \".iam.gserviceaccount.com\";\u00a0 \u00a0 try {\u00a0 \u00a0 \u00a0 DisableServiceAccountKeyRequest\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 disableServiceAccountKeyRequest = new DisableServiceAccountKeyRequest();\u00a0 \u00a0 \u00a0 // Use the IAM service to disable the service account key.\u00a0 \u00a0 \u00a0 service\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .projects()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .serviceAccounts()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .keys()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .disable(String\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .format(\"projects/%s/serviceAccounts/%s/keys/%s\", projectId, serviceAccountEmail,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 serviceAccountKeyName), disableServiceAccountKeyRequest)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .execute();\u00a0 \u00a0 \u00a0 System.out.println(\"Disabled service account key: \" + serviceAccountKeyName);\u00a0 \u00a0 } catch (IOException e) {\u00a0 \u00a0 \u00a0 System.out.println(\"Failed to disable service account key: \\n\" + e);\u00a0 \u00a0 }\u00a0 }\u00a0 private static Iam initService() throws GeneralSecurityException, IOException {\u00a0 \u00a0 /* Use the Application Default Credentials strategy for authentication. For more info, see:\u00a0 \u00a0 \u00a0https://cloud.google.com/docs/authentication/production#finding_credentials_automatically */\u00a0 \u00a0 GoogleCredentials credential =\u00a0 \u00a0 \u00a0 \u00a0 GoogleCredentials.getApplicationDefault()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .createScoped(Collections.singleton(IamScopes.CLOUD_PLATFORM));\u00a0 \u00a0 // Initialize the IAM service, which can be used to send requests to the IAM API.\u00a0 \u00a0 return new Iam.Builder(\u00a0 \u00a0 \u00a0 \u00a0 GoogleNetHttpTransport.newTrustedTransport(),\u00a0 \u00a0 \u00a0 \u00a0 GsonFactory.getDefaultInstance(),\u00a0 \u00a0 \u00a0 \u00a0 new HttpCredentialsAdapter(credential))\u00a0 \u00a0 \u00a0 \u00a0 .setApplicationName(\"service-accounts\")\u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 }}\n``` ` [projects.serviceAccounts.keys.disable](https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts.keys/disable?hl=zh-cn) ` \u65b9\u6cd5\u53ef\u505c\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- ``\uff1a\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\u9805\u76ee ID \u662f\u5b57\u6bcd\u6578\u5b57\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982`my-project`\u3002\n- ``\uff1a\u60a8\u8981\u505c\u7528\u5176\u5bc6\u9470\u7684\u670d\u52d9\u8cec\u865f\u7684\u540d\u7a31\u3002\n- ``\uff1a\u60a8\u8981\u505c\u7528\u7684\u5bc6\u9470\u7684 ID\u3002 \u5982\u9700\u67e5\u627e\u5bc6\u9470\u7684 ID\uff0c\u8acb [\u5217\u51fa\u670d\u52d9\u8cec\u865f\u7684\u6240\u6709\u5bc6\u9470](#list-keys) \uff0c\u627e\u5230\u8981\u505c\u7528\u7684\u5bc6\u9470\uff0c\u7136\u5f8c\u5f9e`name`\u5b57\u6bb5\u7684\u672b\u5c3e\u8907\u88fd\u5176 ID\u3002\u5bc6\u9470\u7684 ID \u662f`keys/`\u4e4b\u5f8c\u7684\u6240\u6709\u5167\u5bb9\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://iam.googleapis.com/v1/projects/PROJECT_ID/serviceAccounts/SA_NAME@PROJECT_ID.iam.gserviceaccount.com/keys/KEY_ID:disable\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\n\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n}\n```\n## \u5553\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\n\u505c\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u5f8c\uff0c\u60a8\u53ef\u4ee5\u96a8\u6642\u5553\u7528\u8a72\u5bc6\u9470\uff0c\u7136\u5f8c\u4f7f\u7528\u8a72\u5bc6\u9470\u5411 Google API \u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002\n\u60a8\u4e0d\u80fd\u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u4f86\u5553\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\u8acb\u6539\u7528 gcloud CLI \u6216 REST API\u3002\n\u57f7\u884c [gcloud iam service-accounts keys enable](https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/keys/enable?hl=zh-cn) \u547d\u4ee4\u53ef\u5553\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\n\u66ff\u63db\u4ee5\u4e0b\u503c\uff1a- ``\uff1a\u8981\u5553\u7528\u7684\u5bc6\u9470\u7684 ID\u3002 \u5982\u9700\u67e5\u627e\u5bc6\u9470\u7684 ID\uff0c\u8acb [\u5217\u51fa\u670d\u52d9\u8cec\u865f\u7684\u6240\u6709\u5bc6\u9470](https://cloud.google.com/iam/docs/keys-list-get?hl=zh-cn#list-keys) \uff0c\u627e\u5230\u8981\u5553\u7528\u7684\u5bc6\u9470\uff0c\u7136\u5f8c\u8907\u88fd\u5176 ID\u3002\n- ``\uff1a\u5bc6\u9470\u6240\u5c6c\u670d\u52d9\u8cec\u865f\u7684\u540d\u7a31\u3002\n- ``\uff1a\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\n```\ngcloud iam service-accounts keys enable KEY_ID \\\u00a0 \u00a0 --iam-account=SA_NAME@PROJECT_ID.iam.gserviceaccount.com\\\u00a0 \u00a0 --project=PROJECT_ID\n```\n\u8f38\u51fa\u5982\u4e0b\uff1a\n```\nEnabled key [KEY_ID] for service account\n[SA_NAME@PROJECT_ID.iam.gserviceaccount.com]\n```\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5b89\u88dd\u548c\u4f7f\u7528 IAM \u5ba2\u6236\u7aef\u5eab\uff0c\u8acb\u53c3\u95b1 [IAM \u5ba2\u6236\u7aef\u5eab](https://cloud.google.com/iam/docs/reference/libraries?hl=zh-cn) \u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [IAM Java API \u53c3\u8003\u6587\u6a94](https://developers.google.com/api-client-library/java/apis/iam/v1?hl=zh-cn) \u3002\n\u5982\u9700\u5411 IAM \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u8acb\u8a2d\u7f6e\u61c9\u7528\u9ed8\u8a8d\u6191\u64da\u3002  \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u6e96\u5099\u5de5\u4f5c](#before-you-begin) \u3002\n [\u5728 GitHub \u4e0a\u67e5\u770b](https://github.com/GoogleCloudPlatform/java-docs-samples/blob/HEAD/iam/api-client/src/main/java/iam/snippets/EnableServiceAccountKey.java) \n```\nimport com.google.api.client.googleapis.javanet.GoogleNetHttpTransport;import com.google.api.client.json.gson.GsonFactory;import com.google.api.services.iam.v1.Iam;import com.google.api.services.iam.v1.IamScopes;import com.google.api.services.iam.v1.model.EnableServiceAccountKeyRequest;import com.google.auth.http.HttpCredentialsAdapter;import com.google.auth.oauth2.GoogleCredentials;import java.io.IOException;import java.security.GeneralSecurityException;import java.util.Collections;public class EnableServiceAccountKey {\u00a0 public static void main(String[] args) {\u00a0 \u00a0 // TODO(Developer): Replace the below variables before running.\u00a0 \u00a0 String projectId = \"gcloud-project-id\";\u00a0 \u00a0 String serviceAccountName = \"service-account-name\";\u00a0 \u00a0 String serviceAccountKeyName = \"service-account-key-name\";\u00a0 \u00a0 enableServiceAccountKey(projectId, serviceAccountName, serviceAccountKeyName);\u00a0 }\u00a0 // Enables a service account key.\u00a0 public static void enableServiceAccountKey(String projectId, String serviceAccountName,\u00a0 \u00a0 \u00a0 String serviceAccountKeyName) {\u00a0 \u00a0 // Initialize the IAM service.\u00a0 \u00a0 Iam service = null;\u00a0 \u00a0 try {\u00a0 \u00a0 \u00a0 service = initService();\u00a0 \u00a0 } catch (IOException | GeneralSecurityException e) {\u00a0 \u00a0 \u00a0 System.out.println(\"Unable to initialize service: \\n\" + e);\u00a0 \u00a0 \u00a0 return;\u00a0 \u00a0 }\u00a0 \u00a0 // Construct the service account email.\u00a0 \u00a0 // You can modify the \".iam.gserviceaccount.com\" to match the service account name in which\u00a0 \u00a0 // you want to enable the key.\u00a0 \u00a0 // See, https://cloud.google.com/iam/docs/creating-managing-service-account-keys?hl=en#enabling\u00a0 \u00a0 String serviceAccountEmail = serviceAccountName + \"@\" + projectId + \".iam.gserviceaccount.com\";\u00a0 \u00a0 try {\u00a0 \u00a0 \u00a0 EnableServiceAccountKeyRequest\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 enableServiceAccountKeyRequest = new EnableServiceAccountKeyRequest();\u00a0 \u00a0 \u00a0 // Use the IAM service to enable the service account key.\u00a0 \u00a0 \u00a0 service\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .projects()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .serviceAccounts()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .keys()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .enable(String\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .format(\"projects/%s/serviceAccounts/%s/keys/%s\", projectId, serviceAccountEmail,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 serviceAccountKeyName), enableServiceAccountKeyRequest)\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .execute();\u00a0 \u00a0 \u00a0 System.out.println(\"Enabled service account key: \" + serviceAccountKeyName);\u00a0 \u00a0 } catch (IOException e) {\u00a0 \u00a0 \u00a0 System.out.println(\"Failed to enable service account key: \\n\" + e);\u00a0 \u00a0 }\u00a0 }\u00a0 private static Iam initService() throws GeneralSecurityException, IOException {\u00a0 \u00a0 /* Use the Application Default Credentials strategy for authentication. For more info, see:\u00a0 \u00a0 \u00a0https://cloud.google.com/docs/authentication/production#finding_credentials_automatically */\u00a0 \u00a0 GoogleCredentials credential =\u00a0 \u00a0 \u00a0 \u00a0 GoogleCredentials.getApplicationDefault()\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 .createScoped(Collections.singleton(IamScopes.CLOUD_PLATFORM));\u00a0 \u00a0 // Initialize the IAM service, which can be used to send requests to the IAM API.\u00a0 \u00a0 return new Iam.Builder(\u00a0 \u00a0 \u00a0 \u00a0 GoogleNetHttpTransport.newTrustedTransport(),\u00a0 \u00a0 \u00a0 \u00a0 GsonFactory.getDefaultInstance(),\u00a0 \u00a0 \u00a0 \u00a0 new HttpCredentialsAdapter(credential))\u00a0 \u00a0 \u00a0 \u00a0 .setApplicationName(\"service-accounts\")\u00a0 \u00a0 \u00a0 \u00a0 .build();\u00a0 }}\n``` ` [projects.serviceAccounts.keys.enable](https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts.keys/enable?hl=zh-cn) ` \u65b9\u6cd5\u53ef\u5553\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\n\u5728\u4f7f\u7528\u4efb\u4f55\u8acb\u6c42\u6578\u64da\u4e4b\u524d\uff0c\u8acb\u5148\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- ``\uff1a\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\u9805\u76ee ID \u662f\u5b57\u6bcd\u6578\u5b57\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982`my-project`\u3002\n- ``\uff1a\u60a8\u8981\u5553\u7528\u5176\u5bc6\u9470\u7684\u670d\u52d9\u8cec\u865f\u7684\u540d\u7a31\u3002\n- ``\uff1a\u60a8\u8981\u5553\u7528\u7684\u5bc6\u9470\u7684 ID\u3002 \u5982\u9700\u67e5\u627e\u5bc6\u9470\u7684 ID\uff0c\u8acb [\u5217\u51fa\u670d\u52d9\u8cec\u865f\u7684\u6240\u6709\u5bc6\u9470](#list-keys) \uff0c\u627e\u5230\u8981\u5553\u7528\u7684\u5bc6\u9470\uff0c\u7136\u5f8c\u5f9e`name`\u5b57\u6bb5\u7684\u672b\u5c3e\u8907\u88fd\u5176 ID\u3002\u5bc6\u9470\u7684 ID \u662f`keys/`\u4e4b\u5f8c\u7684\u6240\u6709\u5167\u5bb9\u3002\nHTTP \u65b9\u6cd5\u548c\u7db2\u5740\uff1a\n```\nPOST https://iam.googleapis.com/v1/projects/PROJECT_ID/serviceAccounts/SA_NAME@PROJECT_ID.iam.gserviceaccount.com/keys/KEY_ID:enable\n```\n\u5982\u9700\u767c\u9001\u60a8\u7684\u8acb\u6c42\uff0c\u8acb\u5c55\u958b\u4ee5\u4e0b\u9078\u9805\u4e4b\u4e00\uff1a\n\u60a8\u61c9\u8a72\u6536\u5230\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\u7684 JSON \u97ff\u61c9\uff1a\n```\n{\n}\n```\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3\u5982\u4f55 [\u522a\u9664\u670d\u52d9\u8cec\u865f\u5bc6\u9470](https://cloud.google.com/iam/docs/keys-create-delete?hl=zh-cn#deleting) \u3002\n- \u77ad\u89e3\u5982\u4f55 [\u5217\u51fa\u548c\u7372\u53d6\u670d\u52d9\u8cec\u865f\u5bc6\u9470](https://cloud.google.com/iam/docs/keys-list-get?hl=zh-cn) \u3002\n- \u77ad\u89e3\u5982\u4f55\u4f7f\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u9032\u884c [\u670d\u52d9\u8cec\u865f\u8eab\u4efd\u9a57\u8b49](https://cloud.google.com/docs/authentication/provide-credentials-adc?hl=zh-cn#wlif-key) \u3002\n- \u77ad\u89e3 [\u4f7f\u7528\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u7684\u66ff\u4ee3\u65b9\u6848](https://cloud.google.com/docs/authentication?hl=zh-cn#auth-decision-tree) \u3002\n- \u77ad\u89e3 [\u7ba1\u7406\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u7684\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/iam/docs/best-practices-for-managing-service-account-keys?hl=zh-cn) \u3002", "guide": "IAM"}