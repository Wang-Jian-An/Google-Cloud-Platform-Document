{"title": "Apigee - Step 8: Enable Synchronizer access", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - Step 8: Enable Synchronizer access\nYou are currently viewing version 1.5 of the Apigee hybrid documentation. **This version is end of life.** You should upgrade to a newer version. For more information, see [Supported versions](/apigee/docs/hybrid/supported-platforms#supported-versions) .\n", "content": "## \n Get an authorization token\nTo make the Apigee API calls described later in this topic, you need to get an authorization token that has the Apigee Organization Admin role.\n- If you are not the owner of the Google Cloud project that is associated with your Apigee hybrid  organization, be sure that your Google Cloud user account has the **roles/apigee.admin** (Apigee  Organization Admin) role. You can check the roles assigned to you with this command:```\ngcloud projects get-iam-policy $PROJECT_ID \\\n--flatten=\"bindings[].members\" \\\n--format='table(bindings.role)' \\\n--filter=\"bindings.members:your_account_email\"\n```For example:```\ngcloud projects get-iam-policy my-project \\\n--flatten=\"bindings[].members\" \\\n--format='table(bindings.role)' \\\n--filter=\"bindings.members:myusername@example.com\"\n```The output should look something like:```\nROLE\nroles/apigee.admin\nroles/compute.admin\nroles/container.admin\nroles/gkehub.admin\nroles/iam.serviceAccountAdmin\nroles/iam.serviceAccountKeyAdmin\nroles/meshconfig.admin\nroles/owner\nroles/resourcemanager.projectIamAdmin\nroles/servicemanagement.admin\nroles/serviceusage.serviceUsageAdmin\n```\n- If you do not have`roles/apigee.admin`in your roles, add the **Apigee\n Organization Admin** role to your user account. Use the following command to add the  role to your user account:```\ngcloud projects add-iam-policy-binding $PROJECT_ID \\\n --member user:your_account_email \\\n --role roles/apigee.admin\n```For example:```\ngcloud projects add-iam-policy-binding my-project \\\n --member user:myusername@example.com \\\n --role roles/apigee.admin\n```\n- Get an authorization token for your user account:```\nexport TOKEN=$(gcloud auth print-access-token)\n```You can check the environment variable with the following command:```\necho $TOKEN\n```## \n Enable synchronizer access\nTo enable synchronizer access:\n- Get the email address for the service account to which you are granting synchronizer access.  For non production environments (as suggested in this tutorial) it should be`apigee-non-prod`. For production environments, it shoudl be`apigee-synchronizer`. Use the following command:```\ngcloud iam service-accounts list --filter \"apigee-non-prod\"\n```If it matches the pattern `apigee-non-prod@` ` **$ORG_NAME** ` `.iam.gserviceaccount.com` , you  can use that pattern in the next step.\n- Call the [setSyncAuthorization](/apigee/docs/reference/apis/apigee/rest/v1/organizations/setSyncAuthorization) API to enable the required permissions for Synchronizer using the following command:```\ncurl -X POST -H \"Authorization: Bearer $TOKEN\" \\\n -H \"Content-Type:application/json\" \\\n \"https://apigee.googleapis.com/v1/organizations/$ORG_NAME:setSyncAuthorization\" \\\n -d '{\"identities\":[\"'\"serviceAccount:apigee-non-prod@$ORG_NAME.iam.gserviceaccount.com\"'\"]}'\n```Where:- **$ORG_NAME** : The name of your hybrid organization.\n- **apigee-non-prod$ORG_NAME.iam.gserviceaccount.com** : The email   address of the service account.\n **Tip:** Some shells may return an error like`bad substitution`. In this case, replacewith the name of  your organization and replace the`\"'\"`with`\"`as follows:```\ncurl -X POST -H \"Authorization: Bearer $TOKEN\" \\\n -H \"Content-Type:application/json\" \\\n \"https://apigee.googleapis.com/v1/organizations/YOUR_ORG_NAME:setSyncAuthorization\" \\\n -d '{\"identities\":[\"serviceAccount:apigee-non-prod@YOUR_ORG_NAME.iam.gserviceaccount.com\"]}'\n \n```\n- To verify that the service account was set, use the following command to call the API to get a list of service accounts:```\ncurl -X POST -H \"Authorization: Bearer $TOKEN\" \\\n -H \"Content-Type:application/json\" \\\n \"https://apigee.googleapis.com/v1/organizations/$ORG_NAME:getSyncAuthorization\" \\\n -d ''\n```The output looks similar to the following:```\n{\n \"identities\":[  \"serviceAccount:apigee-non-prod@my_project_id.iam.gserviceaccount.com\"\n ],\n \"etag\":\"BwWJgyS8I4w=\"\n}\n```\nYou have now made it possible for your Apigee hybrid runtime and management planes to  communicate. Next, let's apply your configuration to the hybrid runtime and complete your  installation of Apigee hybrid.\n## Next step\nstepper_buttons is defined in localvars Iterate over all the buttons in the data dictionary If the button's step matches the current step in the process, make the button disabled [1](/apigee/docs/hybrid/v1.5/install-create-cluster) If the button's step matches the current step in the process, make the button disabled [2](/apigee/docs/hybrid/v1.5/install-cert-manager) If the button's step matches the current step in the process, make the button disabled [3](/apigee/docs/hybrid/v1.5/install-asm) If the button's step matches the current step in the process, make the button disabled [4](/apigee/docs/hybrid/v1.5/install-apigeectl) If the button's step matches the current step in the process, make the button disabled [5](/apigee/docs/hybrid/v1.5/install-service-accounts) If the button's step matches the current step in the process, make the button disabled [6](/apigee/docs/hybrid/v1.5/install-create-tls-certificates) If the button's step matches the current step in the process, make the button disabled [7](/apigee/docs/hybrid/v1.5/install-configure-cluster) If the button's step matches the current step in the process, make the button disabled If the button's step matches the next step [8](/apigee/docs/hybrid/v1.5/install-enable-synchronizer-access) If the button's step matches the current step in the process, make the button disabled In all other cases (previous buttons or future buttons (after the next one), make them links [(NEXT) Step 9: Install the hybrid runtime](/apigee/docs/hybrid/v1.5/install-hybrid-runtime)", "guide": "Apigee"}