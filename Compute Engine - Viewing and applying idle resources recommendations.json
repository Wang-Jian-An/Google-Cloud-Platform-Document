{"title": "Compute Engine - Viewing and applying idle resources recommendations", "url": "https://cloud.google.com/compute/docs/instances", "abstract": "# Compute Engine - Viewing and applying idle resources recommendations\nCompute Engine provides recommendations to help you identify resources like persistent disks (PDs), IP addresses, and custom disk images that aren't used. You can use idle resource recommendations to help minimize waste of resources and reduce your compute bill. For PDs that are not actively used, you can create a backup snapshot then delete the resource. For unused PDs, images, and IP addresses, you can delete them if you don't need them.\nIf you're interested in idle VM recommendations, see [Viewing and applying idle VM recommendations](/compute/docs/instances/viewing-and-applying-idle-vm-recommendations) .\n", "content": "## Before you begin\n- If you haven't already, set up authentication. [Authentication](/compute/docs/authentication) is the process by which your identity is verified for access to Google Cloud services and APIs. To run code or samples from a local development environment, you can authenticate to Compute Engine as follows.Select the tab for how you plan to use the samples on this page:\nWhen you use the Google Cloud console to access Google Cloud services and   APIs, you don't need to set up authentication.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:```\ngcloud init\n``` **Note:** If you installed the gcloud CLI  previously, make sure you have the latest version by running`gcloud components  update`.\n- [ Set a default region and zone](/compute/docs/gcloud-compute#set_default_zone_and_region_in_your_local_client) .\nTo use the REST API samples on this page in a local development environment, you use the credentials you provide to the gcloud CLI.- [Install](/sdk/docs/install) the Google Cloud CLI, then [initialize](/sdk/docs/initializing) it by running the following command:\n- ```\ngcloud init\n```## Pricing\nIdle resources recommendations are available free of charge.\n## Recommendation generation\nIf a resource has not been attached to a VM or other resource for 15 days, the Recommender classifies that resource as idle.\nOne of the following conditions must be met in order to classify a resource as idle and generate the corresponding recommended action:\n| Resource  | Condition for resource to be classified as idle          | Recommended action   | Savings                 |\n|:-------------|:-------------------------------------------------------------------------------------|:---------------------------|:--------------------------------------------------------------------------|\n| PD   | Created at least 15 days ago AND Never attached to a VM AND Is blank     | Delete      | Save 100% of the cost of that disk (see disk pricing)      |\n| PD   | Detached for at least 15 days              | Create snapshot and delete | Reduce the maintenance cost of that disk by 35% to 92% (see disk pricing) |\n| Custom image | Not used to create a disk for at least 15 days AND Not used in any instance template | Delete      | Save 100% of the cost of that image (see image pricing)     |\n| IP address | Not attached to any resource for at least 15 days         | Delete      | Save 100% of the cost of that IP address (see IP pricing)     |\n## Recommendation frequency\nIdle resource recommendations begin 15 days after resource creation, and they are updated once every 24 hours.\n## Viewing recommendations\nTo view recommendations about idle resources, use the gcloud CLI or REST.\nIn the Google Cloud console, go to the **Recommendations** page.\n [Go to Recommendations](https://console.cloud.google.com/home/recommendations) \nAll idle resources are listed under **Unused Compute Engine resources** .\nUse the [gcloud recommender recommendations list command](/sdk/gcloud/reference/recommender/recommendations/list) with the `--recommender=` [RECOMMENDER_ID](/recommender/docs/recommenders) flag:\n```\ngcloud recommender recommendations list \\\n --project=PROJECT_ID \\\n --location=LOCATION \\\n --recommender=RECOMMENDER_ID \\\n --format=yaml\n```\nReplace the following:- ``: the ID of your project.\n- ``: the location that contains the resources for which you want recommendations.- For PDs specify a zone or region, for example,`us-central1-c`.\n- For IPs:- To list regional IPs, you must specify a region.\n- To list global IPs, specify`global`. For more information about regional and global IP address resources, see [IP addresses](/compute/docs/ip-addresses#reservedaddress) .\n- For custom images specify`global`.\n- ``: the id of [recommender](/recommender/docs/recommenders) - For disks, specify`google.compute.disk.IdleResourceRecommender`.\n- For images, specify`google.compute.image.IdleResourceRecommender`.\n- For IPs, specify`google.compute.address.IdleResourceRecommender`.\nFor example, the following command lists idle PD recommendations in `us-central1-c` for `test-project` :\n```\ngcloud recommender recommendations list \\\n --project=test-project \\\n --location=us-central1-c \\\n --recommender=google.compute.disk.IdleResourceRecommender \\\n --format=yaml\n--content:\n operationGroups:\n - operations:\n  - action: add\n  resource: //compute.googleapis.com/projects/test-project/global/snapshots/$snapshot-name\n  resourceType: compute.googleapis.com/Disk\n  path: /\n  value:\n  - name: $snapshot-name\n   sourceDisk: projects/test-project/locations/us-central1-c/disks/pd-name\n   storageLocations: us-central1\n  - action: remove\n  resource: //compute.googleapis.com/projects/test-project/zones/us-central1-c/disks/pd-name\n  resourceType: compute.googleapis.com/Disk\n  path: /\ndescription: Save cost by snapshotting and then deleting idle persistent disk 'pd-name'\nname: projects/test-project/locations/us-central1-c/recommenders/google.compute.disk.IdleResourceRecommender/recommendations/0fd31b24-cc05-4132-8431-ed54a22dd4f1\nrecommenderSubtype: SNAPSHOT_AND_DELETE_DISK\nlastRefreshTime:\n seconds: 1543912652\nprimaryImpact:\n category: COST\n costProjection:\n cost:\n  currencyCode: USD\n  units: '-50'\n duration:\n  seconds: 2592000\nstateInfo: ACTIVE\netag: \"cb0e6ac2cfc0b591\"\n```\nLearn more about using gcloud CLI to work with [recommendations](/recommender/docs/using-api) .\nCall the [recommendations.list method](/recommender/docs/reference/rest/v1/projects.locations.recommenders.recommendations/list) and specify the [recommender id](/recommender/docs/recommenders) , for example `google.compute.disk.IdleResourceRecommender` :\n```\nGET https://recommender.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/recommenders/RECOMMENDER_ID/recommendations\n```\nReplace the following:- ``: the ID of your project.\n- ``: the location that contains the resources for which you want recommendations.- For PDs specify a zone or region, for example,`us-central1-c`.\n- For IPs:- To list regional IPs, you must specify a region.\n- To list global IPs, specify`global`. For more information about regional and global IP address resources, see [IP addresses](/compute/docs/ip-addresses#reservedaddress) .\n- For custom images specify`global`.\n- ``: the id of [recommender](/recommender/docs/recommenders) - For disks, specify`google.compute.disk.IdleResourceRecommender`.\n- For images, specify`google.compute.image.IdleResourceRecommender`.\n- For IPs, specify`google.compute.address.IdleResourceRecommender`.\nThe following example shows out to send a request with `curl` , and the associated sample response.\n```\nPROJECT_ID=test-project\nLOCATION=us-central1-c\nRECOMMENDER_ID=google.compute.disk.IdleResourceRecommender\ncurl -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \\\n https://recommender.googleapis.com/v1/projects/$PROJECT_ID/locations/$LOCATION/recommenders/$RECOMMENDER_ID/recommendations\n```\nExample JSON response for idle PD recommendation:\n```\n{\n \"description\" : \"Save cost by deleting idle persistent disk 'pd-name'\",\n \"name\": \"projects/test-project/locations/us-central1-c/recommenders/\"\n   \"google.compute.disk.IdleResourceRecommender/\"\n   \"recommendations/0fd31b24-cc05-4132-8431-ed54a22dd4f1\",\n \"recommenderSubtype\" : \"SNAPSHOT_AND_DELETE_DISK\",\n \"lastRefreshTime\": {\n \"seconds\": 1543912652\n },\n \"primaryImpact\": {\n \"category\": COST,\n \"costProjection\": {\n \"cost\": {\"currencyCode\": \"USD\", \"units\": -50},\n \"duration\": { \"seconds\": 2592000 }\n }\n },\n \"stateInfo\": ACTIVE,\n \"content\": {\n \"operationGroups\" : [ {\n  \"operations\" : [  {\n   \"action\": \"add\",\n   \"resourceType\": \"compute.googleapis.com/Disk\",\n   \"resource\" : \"//compute.googleapis.com/projects/test-project/global/snapshots/$snapshot-name\",\n   \"value\": {\n   \"name\": \"$snapshot-name\",\n   \"sourceDisk\": \"projects/test-project/zones/us-central1-c/disks/pd-name\",\n   \"storageLocations\": [\"us-central1\"],\n   }\n  },\n  {\n   \"action\": \"remove\",\n   \"resourceType\": \"compute.googleapis/Disk\",\n   \"resource\": \"//compute.googleapis.com/projects/test-project/\"\n      \"zones/us-central1-c/disks/pd-name\"\n  }\n  ]\n }\n ]\n },\n \"associatedInsights\": [ {\n  \"insight\": \"projects/test-project/locations/us-central1-c/insightTypes/google.compute.disk.IdleResourceInsight/insights/31326443-bcc3-4776-9b86-48879fddb656\"\n }\n ],\n \"etag\": \"cb0e6ac2cfc0b591\"\n}\n```\n### Interpreting the recommendation response\nEach recommendation that you receive through the gcloud CLI or REST contains operation groups, with operations that you can perform in serial to apply the recommendation. For example, idle PD recommendation operation groups include one or two operations:\n- If your idle PD has data on it, the recommendation includes an `add` operation to create a snapshot to back up the PD. For example:```\n {\n  \"action\": \"add\",\n  \"resourceType\": \"compute.googleapis.com/Disk\",\n  \"resource\" : \"//compute.googleapis.com/projects/test-project/global/snapshots/$snapshot-name\",\n  \"path\": \"/\",\n  \"value\": {\n  \"name\": \"$snapshot-name\",\n  \"sourceDisk\": \"projects/test-project/zones/us-central1-c/disks/pd-name\",\n  \"storageLocations\": [\"us-central1\"]\n  }\n }\n```\n- A `remove` operation to permanently delete the idle PD. For example:```\n {\n  \"action\": \"remove\",\n  \"resourceType\": \"compute.googleapis.com/Disk\",\n  \"resource\" : \"//compute.googleapis.com/projects/test-project/zones/us-central1-c/disks/pd-name\",\n  \"path\": \"/\"\n }\n```\nSee [Applying idle PD recommendations](#applying_idle_pd_recommendations) to create a snapshot of and to delete a PD, [deleting idle IPs](#deleting_idle_ips) to remove unused IP addresses, and [deleting idle custom images](#deleting_idle_custom_images) to remove unused custom disk images.\n### Viewing insights for idle resource recommendations\nThe Recommender generates recommendations based on resource [insights](/recommender/docs/insights/using-insights) . By viewing insights on resources you can learn more about those resources, such as how long a resource has been detached from a VM or whether a PD is blank.\nIf you want to view the [insight](/recommender/docs/insights/using-insights) that generated the recommendation, you can use the gcloud CLI or REST.\nUse the [insights list command](/sdk/gcloud/reference/beta/recommender/insights/list) \n```\ngcloud beta recommender insights list --project=PROJECT_NAME \\\n --location=LOCATION --insight-type=INSIGHT_TYPE\n```\nReplace the following:- ``: the location that contains the resources for which you want insights.- For PDs specify a zone or region, for example,`us-central1-c`.\n- For IPs:- To list regional IPs, you must specify a region.\n- To list global IPs, specify`global`. For more information about regional and global IP address resources, see [IP addresses](/compute/docs/ip-addresses#reservedaddress) .\n- For custom images specify`global`.\n- ``: the id of the [insight type](/recommender/docs/insights/insight-types) - For disks, specify`google.compute.disk.IdleResourceInsight`.\n- For images, specify`google.compute.image.IdleResourceInsight`.\n- For IPs, specify`google.compute.address.IdleResourceInsight`.\nUse the [insights.list method](/recommender/docs/reference/rest/v1beta1/projects.locations.insightTypes.insights/list) .\n```\nGET https://recommender.googleapis.com/v1beta1/projects/PROJECT_ID/locations/LOCATION/insightTypes/INSIGHT_TYPE/insights\n```\nReplace the following:- ``: the ID of your project.\n- ``: the location that contains the resources for which you want insights.- For PDs specify a zone or region, for example,`us-central1-c`.\n- For IPs:- To list regional IPs, you must specify a region.\n- To list global IPs, specify`global`. For more information about regional and global IP address resources, see [IP addresses](/compute/docs/ip-addresses#reservedaddress) .\n- For custom images specify`global`.\n- ``: the id of the [insight type](/recommender/docs/insights/insight-types) - For disks, specify`google.compute.disk.IdleResourceInsight`.\n- For images, specify`google.compute.image.IdleResourceInsight`.\n- For IPs, specify`google.compute.address.IdleResourceInsight`.\nHere is an example response of an insight on an idle PD resource:\n```\n{\n \"name\": \"projects/test-project/locations/us-central1-c/insightTypes/google.compute.disk.IdleResourceInsight/insights/0ec21a13-bb04-3121-7321-dc43a11cc3e2\",\n \"description\": \"Disk 'pd-name' in zone 'us-central1-c' was last used 17 days ago. Consider taking snapshot and delete it.\",\n \"targetResources\": [ \"//compute.googleapis.com/projects/test-project/zones/us-central1-c/disks/pd-name\"\n ],\n \"insightSubtype\": \"IDLE_DISK\",\n \"content\": {\n \"diskLastUseTime\": \"2019-10-01 13:00:00\",\n \"isBlank\": false,\n },\n \"lastRefreshTime\": \"2019-10-10 13:00:00\",\n \"observationPeriod\": \"15 days\",\n \"stateInfo\": {\n \"state\": \"ACTIVE\"\n },\n \"category\": \"COST\",\n \"etag\": \"fds421j2349\",\n \"associatedRecommendations\": [ {\n  \"projects/test-project/locations/us-central1-c/recommenders/\"\n  \"google.compute.disk.IdleResourceRecommender/\"\n  \"recommendations/0fd31b24-cc05-4132-8431-ed54a22dd4f1\"\n }\n ]\n}\n```\nThe example response includes the following fields:- `diskLastUseTime`: The last time when the disk was attached to a VM. If the disk was never attached to a VM this is set to the disk's creation time.\n- `isBlank`: This field is set to`true`if disk is blank and was never attached to VM. Otherwise it is`false`.\nFor more information about insights, see the [reference docs](/recommender/docs/reference/rest/v1beta1/projects.locations.insightTypes.insights) .\n## Applying idle resource recommendations\nIf you receive a recommendation about an idle resource and you decide that you want to follow the recommendation, follow the instructions below.\n### Deleting idle IP address\nSee the [addresses.delete method](/compute/docs/reference/rest/v1/addresses/delete) , [gcloud compute addresses delete command](/sdk/gcloud/reference/compute/addresses/delete) , or the [Releasing a static external IP address](/compute/docs/ip-addresses/reserve-static-external-ip-address#release_ip) documentation.\n### Deleting idle custom images\nSee the [images.delete method](/compute/docs/reference/rest/v1/images/delete) , [gcloud compute images delete command](/sdk/gcloud/reference/compute/images/delete) , or the [Deleting an image](/compute/docs/images/create-delete-deprecate-private-images#deleting_an_image) documentation.\n### Applying idle PD recommendations\nIf you need to create a snapshot of a PD prior to deleting it, see [Creating persistent disk snapshots](/compute/docs/disks/create-snapshots) .\nTo delete an idle PD, see the [gcloud compute disks delete command](/sdk/gcloud/reference/compute/disks/delete) .\nFor information about how to recover data from a snapshot and recreate your PD, see [Restoring snapshots](/compute/docs/disks/restore-snapshot) .", "guide": "Compute Engine"}