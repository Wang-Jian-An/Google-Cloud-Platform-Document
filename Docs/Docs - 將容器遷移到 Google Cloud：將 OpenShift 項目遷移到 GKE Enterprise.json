{"title": "Docs - \u5c07\u5bb9\u5668\u9077\u79fb\u5230 Google Cloud\uff1a\u5c07 OpenShift \u9805\u76ee\u9077\u79fb\u5230 GKE Enterprise", "url": "https://cloud.google.com/architecture/migrating-containers-openshift-anthos-projects?hl=zh-cn", "abstract": "# Docs - \u5c07\u5bb9\u5668\u9077\u79fb\u5230 Google Cloud\uff1a\u5c07 OpenShift \u9805\u76ee\u9077\u79fb\u5230 GKE Enterprise\nLast reviewed 2022-01-24 UTC\n\u672c\u6587\u6a94\u53ef\u5e6b\u52a9\u60a8\u898f\u5283\u3001\u8a2d\u8a08\u548c\u5be6\u73fe\u5c07\u9805\u76ee\u5f9e [OpenShift](https://www.openshift.com/) \u9077\u79fb\u5230 [GKE Enterprise](https://cloud.google.com/anthos?hl=zh-cn) \u7684\u904e\u7a0b\u3002\u5982\u679c\u64cd\u4f5c\u4e0d\u7576\uff0c\u90a3\u9ebc\u5c07\u5de5\u4f5c\u8ca0\u8f09\u5f9e\u4e00\u500b\u74b0\u5883\u9077\u79fb\u5230\u53e6\u4e00\u500b\u74b0\u5883\u53ef\u80fd\u6703\u906d\u9047\u6311\u6230\uff0c\u56e0\u6b64\u8acb\u8b39\u614e\u898f\u5283\u548c\u57f7\u884c\u9077\u79fb\u3002\n\u672c\u6587\u6a94\u662f\u95dc\u65bc\u9077\u79fb\u5230 Google Cloud \u7684\u7cfb\u5217\u6587\u7ae0\u4e2d\u7684\u4e00\u7bc7\u3002\u5982\u679c\u60a8\u60f3\u8981\u4e86\u89e3\u8a72\u7cfb\u5217\u6587\u7ae0\uff0c\u8acb\u53c3\u95b1 [\u9077\u79fb\u5230 Google Cloud\uff1a\u9078\u64c7\u9077\u79fb\u8def\u5f91](https://cloud.google.com/architecture/migration-to-gcp-choosing-your-path?hl=zh-cn) \u3002\n\u672c\u6587\u6a94\u662f\u4e00\u7cfb\u5217\u6587\u7ae0\u4e2d\u7684\u4e00\u7bc7\uff0c\u4ecb\u7d39\u77ad\u5982\u4f55\u5c07 [\u5bb9\u5668](https://wikipedia.org/wiki/OS-level_virtualization) \u9077\u79fb\u5230 Google Cloud\uff1a\n- [\u5c07\u5bb9\u5668\u9077\u79fb\u5230 Google Cloud\uff1a\u5c07 Kubernetes \u9077\u79fb\u5230 Google Kubernetes Engine (GKE)](https://cloud.google.com/architecture/migrating-containers-kubernetes-gke?hl=zh-cn) \n- [\u5c07\u5bb9\u5668\u9077\u79fb\u5230 Google Cloud\uff1a\u5f9e OpenShift \u9077\u79fb\u5230 GKE Enterprise](https://cloud.google.com/architecture/migrating-containers-openshift-anthos?hl=zh-cn) \n- \u5c07\u5bb9\u5668\u9077\u79fb\u5230 Google Cloud\uff1a\u5c07 OpenShift \u9805\u76ee\u9077\u79fb\u5230 GKE Enterprise\uff08\u672c\u6587\u6a94\uff09\n- [\u5f9e OpenShift \u9077\u79fb\u5230 GKE Enterprise\uff1a\u5c07 OpenShift SCC \u9077\u79fb\u5230 Policy Controller \u9650\u5236\u689d\u4ef6](https://cloud.google.com/architecture/migrating-containers-openshift-anthos-scc?hl=zh-cn) \n\u5982\u679c\u60a8\u8a08\u5283\u5c07 [OpenShift \u9805\u76ee](https://docs.openshift.com/container-platform/latest/applications/projects/working-with-projects.html) \u9077\u79fb\u5230 [GKE Enterprise](https://cloud.google.com/anthos?hl=zh-cn) \uff0c\u5247\u672c\u6587\u6a94\u975e\u5e38\u6709\u7528\u3002\u5982\u679c\u60a8\u6b63\u5728\u8a55\u4f30\u9077\u79fb\u7684\u6642\u6a5f\u4e26\u5e0c\u671b\u77ad\u89e3\u6f5b\u5728\u7684\u60c5\u6cc1\uff0c\u672c\u6587\u6a94\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u5e6b\u52a9\u3002\n\u672c\u6587\u6a94\u6d89\u53ca [\u9077\u79fb\u5230 Google Cloud\uff1a\u4f7f\u7528\u5165\u9580](https://cloud.google.com/architecture/migration-to-gcp-getting-started?hl=zh-cn) \u3001 [\u5c07\u5bb9\u5668\u9077\u79fb\u5230 Google Cloud\uff1a\u5c07 Kubernetes \u9077\u79fb\u5230 GKE](https://cloud.google.com/architecture/migrating-containers-kubernetes-gke?hl=zh-cn) \u3001 [\u5c07\u5bb9\u5668\u9077\u79fb\u5230 Google Cloud\uff1a\u5f9e OpenShift \u9077\u79fb\u5230 GKE Enterprise](https://cloud.google.com/architecture/migrating-containers-openshift-anthos?hl=zh-cn) \u548c [GKE \u7db2\u7d61\u7684\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/kubernetes-engine/docs/best-practices/networking?hl=zh-cn) \u4e2d\u4ecb\u7d39\u7684\u6982\u5ff5\u3002\u672c\u6587\u6a94\u6703\u9069\u6642\u63d0\u4f9b\u4e0a\u8ff0\u6587\u6a94\u7684\u93c8\u63a5\u3002\n\u672c\u6587\u6a94\u4e2d\u7684\u6307\u5c0e\u5047\u8a2d\u60a8\u8981\u57f7\u884c\u5de5\u4f5c\u8ca0\u8f09\u7684 [\u76f4\u63a5\u539f\u6a23\u9077\u79fb](https://cloud.google.com/architecture/migration-to-gcp-getting-started?hl=zh-cn#lift_and_shift) \u3002\u5728\u76f4\u63a5\u539f\u6a23\u9077\u79fb\u4e2d\uff0c\u60a8\u53ea\u9700\u61c9\u7528\u5de5\u4f5c\u8ca0\u8f09\u5728\u76ee\u6a19 GKE Enterprise \u74b0\u5883\u4e2d\u904b\u884c\u6240\u9700\u7684\u6700\u5c0f\u66f4\u6539\u3002\n\u5982\u9700\u5c07 OpenShift \u8cc7\u6e90\u9077\u79fb\u5230 GKE Enterprise\uff0c\u60a8\u9700\u8981\u5c07\u5b83\u5011\u6620\u5c04\u4e26\u8f49\u63db\u7232\u5176 Kubernetes \u7b49\u6548\u8cc7\u6e90\u3002\u672c\u6587\u6a94\u4ecb\u7d39\u77ad\u5982\u4f55\u9077\u79fb\u5c07\u5de5\u4f5c\u8ca0\u8f09\u90e8\u7f72\u5230 GKE Enterprise \u4e26\u9032\u884c\u64cd\u4f5c\u6240\u9700\u7684\u4ee5\u4e0b OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\uff1a\n- [OpenShift \u9805\u76ee](https://docs.openshift.com/container-platform/latest/applications/projects/working-with-projects.html) \n- [\u6bcf\u500b OpenShift \u9805\u76ee\u7684\u8cc7\u6e90\u914d\u984d](https://docs.openshift.com/container-platform/latest/applications/quotas/quotas-setting-per-project.html) \u548c [\u591a\u500b OpenShift \u9805\u76ee\u7684\u8cc7\u6e90\u914d\u984d](https://docs.openshift.com/container-platform/latest/applications/quotas/quotas-setting-across-multiple-projects.html) \n- [Role](https://docs.openshift.com/container-platform/latest/authentication/using-rbac.html#viewing-local-roles_using-rbac) \u548c [ClusterRole](https://docs.openshift.com/container-platform/latest/authentication/using-rbac.html#viewing-cluster-roles_using-rbac) \n- [RoleBinding](https://docs.openshift.com/container-platform/latest/authentication/using-rbac.html#viewing-local-roles_using-rbac) \u548c [ClusterRoleBinding](https://docs.openshift.com/container-platform/latest/authentication/using-rbac.html#viewing-cluster-roles_using-rbac) \n- [OpenShift \u7db2\u7d61\u547d\u540d\u7a7a\u9593\u914d\u7f6e](https://docs.openshift.com/container-platform/latest/networking/openshift_sdn/multitenant-isolation.html) \u548c [NetworkPolicy](https://docs.openshift.com/container-platform/latest/networking/network_policy/about-network-policy.html) \n\u5982\u9700\u5c07 OpenShift \u9805\u76ee\u914d\u7f6e\u548c\u76f8\u95dc\u8cc7\u6e90\u9077\u79fb\u5230 GKE Enterprise\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5c0e\u51fa OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u63cf\u8ff0\u7b26\u3002\n- \u5c07 OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u6620\u5c04\u5230 Kubernetes \u8cc7\u6e90\u3002\n- \u5275\u5efa\u6620\u5c04\u5230 OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u7684 Kubernetes \u8cc7\u6e90\u3002\n- \u4f7f\u7528 [Config Sync](https://cloud.google.com/anthos-config-management/docs/config-sync-overview?hl=zh-cn) \u7ba1\u7406 Kubernetes \u8cc7\u6e90\u3002\n\u672c\u6587\u6a94\u63d0\u4f9b\u77ad\u5982\u4f55\u5b8c\u6210\u9077\u79fb\u6b65\u9a5f\u7684\u793a\u4f8b\u3002\n", "content": "## \u5c0e\u51fa OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u63cf\u8ff0\u7b26\n\u5982\u9700\u5c0e\u51fa OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5c0e\u51fa OpenShift \u9805\u76ee\u63cf\u8ff0\u7b26\u3002\n- \u5c0e\u51fa\u96c6\u7fa3\u7d1a\u8cc7\u6e90\u63cf\u8ff0\u7b26\u3002\n- \u5c0e\u51fa\u9805\u76ee\u7d1a\u8cc7\u6e90\u63cf\u8ff0\u7b26\u3002\n\u5f9e OpenShift \u96c6\u7fa3\u4e2d\u5c0e\u51fa\u7684\u63cf\u8ff0\u7b26\u5305\u62ec [\u63cf\u8ff0\u8cc7\u6e90\u914d\u7f6e\u548c\u72c0\u614b\u7684\u5b57\u6bb5](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status) \uff0c\u4f8b\u5982 `spec` \u548c `status` \u5b57\u6bb5\u3002\u63cf\u8ff0\u7b26\u9084\u5305\u542b [\u4fdd\u5b58\u8cc7\u6e90\u72c0\u614b\u4fe1\u606f\u7684\u5b57\u6bb5](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata) \uff0c\u4f8b\u5982 `metadata.managedFields` \u5b57\u6bb5\u3002Kubernetes \u548c OpenShift \u7232\u60a8\u7ba1\u7406\u5305\u542b\u8cc7\u6e90\u72c0\u614b\u4fe1\u606f\u53ca\u5176\u503c\u7684\u5b57\u6bb5\u3002\u7232\u4e86\u7c21\u5316 OpenShift \u8cc7\u6e90\u63cf\u8ff0\u7b26\u7684\u8a55\u4f30\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u5c0d\u6bcf\u500b\u8cc7\u6e90\u63cf\u8ff0\u7b26\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u8a18\u9304\u4fdd\u5b58\u52d5\u614b\u751f\u6210\u7684\u8cc7\u6e90\u72c0\u614b\u4fe1\u606f\u53ca\u5176\u503c\u7684\u5b57\u6bb5\uff0c\u5982\u4e0b\u6240\u793a\uff1a- \u5d4c\u5957\u5728`metadata.annotations`\u4e0b\u4e14\u4ee5`openshift.io`\u524d\u7db4\u958b\u982d\u7684\u4efb\u4f55\u5b57\u6bb5\n- `metadata.creationTimestamp`\n- `metadata.generation`\n- `metadata.managedFields`\n- `metadata.resourceVersion`\n- `metadata.selfLink`\n- `metadata.uid`\n- `status`\n- \u5f9e\u8cc7\u6e90\u63cf\u8ff0\u7b26\u4e2d\u79fb\u9664\u5305\u542b\u52d5\u614b\u751f\u6210\u7684\u8cc7\u6e90\u72c0\u614b\u4fe1\u606f\u7684\u5b57\u6bb5\u3002\n\u5982\u9700\u5c0e\u51fa OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u63cf\u8ff0\u7b26\uff0c\u8acb\u4f7f\u7528 [OpenShift \u547d\u4ee4\u884c\u754c\u9762 (oc CLI)](https://docs.openshift.com/container-platform/latest/cli_reference/openshift_cli/getting-started-cli.html) \u3002\u5982\u9700\u5728 `oc` CLI \u4e2d\u5c0e\u51fa\u8cc7\u6e90\u63cf\u8ff0\u7b26\uff0c\u60a8\u9700\u8981\u4f7f\u7528 [cluster-admin \u89d2\u8272](https://docs.openshift.com/container-platform/latest/authentication/using-rbac.html#default-roles_using-rbac) \u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002\u5982\u9700\u67e5\u770b `oc` CLI \u652f\u6301\u7684\u6240\u6709 OpenShift \u8cc7\u6e90\u7684\u5217\u8868\uff0c\u8acb\u904b\u884c [oc api-resources](https://docs.openshift.com/container-platform/latest/cli_reference/openshift_cli/developer-cli-commands.html#api-resources) \u547d\u4ee4\u3002\n### \u5c0e\u51fa OpenShift \u9805\u76ee\u63cf\u8ff0\u7b26\n\u672c\u90e8\u5206\u4ecb\u7d39\u5982\u4f55\u5c0e\u51fa\u9805\u76ee\u63cf\u8ff0\u7b26\u3002\u6211\u5011\u5efa\u8b70\u60a8\u6392\u9664\u904b\u884c\u7cfb\u7d71\u7d44\u4ef6\uff08\u4f8b\u5982 `istio-system` \u7d44\u4ef6\uff09\u7684 OpenShift \u9805\u76ee\uff0c\u4e26\u6392\u9664\u540d\u7a31\u4ee5 `openshift-` \u3001 `kube-` \u6216 `knative-` \u958b\u982d\u7684 OpenShift \u9805\u76ee\u3002 [OpenShift](https://docs.openshift.com/container-platform/latest/applications/projects/working-with-projects.html#creating-a-project-using-the-CLI_projects) \u6703\u7232\u60a8\u7ba1\u7406\u9019\u4e9b OpenShift \u9805\u76ee\uff0c\u5b83\u5011\u4e0d\u5728\u9077\u79fb\u7bc4\u570d\u5167\uff0c\u56e0\u7232\u60a8\u4e0d\u4f7f\u7528\u5b83\u5011\u4f86\u90e8\u7f72\u5de5\u4f5c\u8ca0\u8f09\u3002\u5982\u9700\u5c0e\u51fa OpenShift \u9805\u76ee\u63cf\u8ff0\u7b26\uff0c\u8acb\u5c0d\u6bcf\u500b OpenShift \u96c6\u7fa3\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5728\u6709\u6b0a\u8a2a\u554f OpenShift \u96c6\u7fa3\u7684\u7d42\u7aef\u4e2d\uff0c\u4f7f\u7528 [oc get](https://docs.openshift.com/container-platform/latest/cli_reference/openshift_cli/developer-cli-commands.html#get) \u547d\u4ee4\u7372\u53d6 [OpenShift \u9805\u76ee](https://docs.openshift.com/container-platform/latest/rest_api/project_apis/project-project-openshift-io-v1.html) \u7684\u5217\u8868\uff1a```\noc get projects\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 DISPLAY NAME \u00a0 \u00a0 \u00a0STATUSexample-project \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Active...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u8a2d\u7f6e\u7684 OpenShift \u9805\u76ee\u5217\u8868\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b OpenShift \u9805\u76ee\uff0c\u4ee5 [YAML](https://yaml.org/) \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\uff0c\u4e26\u4f7f\u7528 `tee` \u547d\u4ee4\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u4f9b\u65e5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `example-project` OpenShift \u9805\u76ee\u7684\u63cf\u8ff0\u7b26\uff1a```\noc get project example-project -o yaml | tee project-example-project.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\napiVersion: project.openshift.io/v1kind: Projectmetadata:\u00a0 annotations:\u00a0 name: example-projectspec:\u00a0 finalizers:\u00a0 - kubernetes\n```\u8f38\u51fa\u6703\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u986f\u793a `example-project` OpenShift \u9805\u76ee\u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `project-example-project.yaml` \u6587\u4ef6\u4e2d\u3002\n### \u5c0e\u51fa\u96c6\u7fa3\u7d1a\u8cc7\u6e90\u63cf\u8ff0\u7b26\n\u672c\u90e8\u5206\u4ecb\u7d39\u5982\u4f55\u5c0e\u51fa\u5177\u6709\u96c6\u7fa3\u7bc4\u570d\u7684\u8cc7\u6e90\u7684\u63cf\u8ff0\u7b26\uff0c\u4e0d\u5305\u62ec\u5b89\u5168\u4e0a\u4e0b\u6587\u9650\u5236\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u9077\u79fb\u5b89\u5168\u653f\u7b56\uff0c\u8acb\u53c3\u95b1 [\u5f9e OpenShift \u9077\u79fb\u5230 GKE Enterprise\uff1a\u5c07 OpenShift SCC \u9077\u79fb\u5230 Policy Controller \u9650\u5236\u689d\u4ef6](https://cloud.google.com/architecture/migrating-containers-openshift-anthos-scc?hl=zh-cn) \u3002\u5982\u9700\u5c0e\u51fa\u5176\u4ed6\u8cc7\u6e90\u63cf\u8ff0\u7b26\uff0c\u8acb\u5c0d\u6bcf\u500b OpenShift \u96c6\u7fa3\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u5728\u7d42\u7aef\u4e2d\uff0c\u7372\u53d6 [ClusterResourceQuota](https://docs.openshift.com/container-platform/latest/rest_api/schedule_and_quota_apis/clusterresourcequota-quota-openshift-io-v1.html) \u5217\u8868\uff1a```\noc get clusterresourcequotas\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0 AGEfor-name \u00a0 6m15sfor-user \u00a0 4s...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u8a2d\u7f6e\u7684 ClusterResourceQuota \u5217\u8868\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b ClusterResourceQuota\uff0c\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `for-name` ClusterResourceQuota \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get clusterresourcequota for-name -o yaml | tee clusterresourcequota-for-name.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\napiVersion: quota.openshift.io/v1kind: ClusterResourceQuotametadata:\u00a0 name: for-namespec:\u00a0 quota:\u00a0 \u00a0 hard:\u00a0 \u00a0 \u00a0 pods: \"10\"\u00a0 \u00a0 \u00a0 secrets: \"20\"\u00a0 selector:\u00a0 \u00a0 annotations: null\u00a0 \u00a0 labels:\u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 name: frontend\n```\u8f38\u51fa\u6703\u4ee5 YAML \u683c\u5f0f\u986f\u793a `for-name` ClusterResourceQuota \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `clusterresourcequota-for-name.yaml` \u6587\u4ef6\u4e2d\u3002\n- \u7372\u53d6 [ClusterRole](https://docs.openshift.com/container-platform/latest/rest_api/role_apis/clusterrole-authorization-openshift-io-v1.html) \u5217\u8868\uff1a```\noc get clusterroles\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 CREATED ATadmin \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a02021-02-02T06:17:02Zaggregate-olm-edit \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 2021-02-02T06:17:59Zaggregate-olm-view \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 2021-02-02T06:18:01Zalertmanager-main \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a02021-02-02T06:48:26Zbasic-user \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 2021-02-02T06:26:42Z...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u8a2d\u7f6e\u7684 ClusterRole \u5217\u8868\u3002ClusterRole \u5217\u8868\u5305\u62ec [OpenShift \u9ed8\u8a8d ClusterRole](https://docs.openshift.com/container-platform/latest/authentication/using-rbac.html#default-roles_using-rbac) \uff0c\u4ee5\u53ca\u5f15\u7528 OpenShift \u7cfb\u7d71\u7d44\u4ef6\u7684 ClusterRole\u3002\u6211\u5011\u5efa\u8b70\u60a8\u8a55\u4f30\u5217\u8868\u4e2d\u7684\u6240\u6709 ClusterRole\uff0c\u4ee5\u8a55\u4f30\u60a8\u9700\u8981\u9077\u79fb\u54ea\u4e9b\u89d2\u8272\u4ee5\u53ca\u54ea\u4e9b\u89d2\u8272\u4e0d\u9069\u7528\u65bc\u76ee\u6a19 GKE Enterprise \u74b0\u5883\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b ClusterRole\uff0c\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `admin` ClusterRole \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get clusterrole admin -o yaml | tee clusterrole-admin.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\naggregationRule:\u00a0 clusterRoleSelectors:\u00a0 - matchLabels:\u00a0 \u00a0 \u00a0 rbac.authorization.k8s.io/aggregate-to-admin: \"true\"apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRolemetadata:\u00a0 annotations:\u00a0 \u00a0 rbac.authorization.kubernetes.io/autoupdate: \"true\"\u00a0 labels:\u00a0 \u00a0 kubernetes.io/bootstrapping: rbac-defaults\u00a0 name: adminrules:- apiGroups:\u00a0 - operators.coreos.com\u00a0 resources:\u00a0 - subscriptions\u00a0 verbs:\u00a0 - create\u00a0 - update\u00a0 - patch\u00a0 - delete...\n```\u8f38\u51fa\u6703\u4ee5 YAML \u683c\u5f0f\u986f\u793a `admin` ClusterRole \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `clusterrole-admin.yaml` \u6587\u4ef6\u4e2d\u3002\n- \u7372\u53d6 [ClusterRoleBinding](https://docs.openshift.com/container-platform/latest/rest_api/role_apis/clusterrolebinding-authorization-openshift-io-v1.html) \u5217\u8868\uff1a```\noc get clusterrolebindings\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0ROLE \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 AGEalertmanager-main \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ClusterRole/alertmanager-main \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a021dbasic-users \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ClusterRole/basic-user \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 21dcloud-credential-operator-rolebinding \u00a0 \u00a0 \u00a0 ClusterRole/cloud-credential-operator-role \u00a0 \u00a0 \u00a0 21dcluster-admin \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ClusterRole/cluster-admin \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a021dcluster-admins \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0ClusterRole/cluster-admin \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a021dcluster-autoscaler \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0ClusterRole/cluster-autoscaler \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 21dcluster-autoscaler-operator \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ClusterRole/cluster-autoscaler-operator \u00a0 \u00a0 \u00a0 \u00a0 \u00a021dcluster-monitoring-operator \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ClusterRole/cluster-monitoring-operator \u00a0 \u00a0 \u00a0 \u00a0 \u00a021d...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u8a2d\u7f6e\u7684 ClusterRoleBinding \u5217\u8868\u3002ClusterRoleBinding \u5217\u8868\u5305\u542b\u5f15\u7528 OpenShift \u7cfb\u7d71\u7d44\u4ef6\u7684 ClusterRoleBinding\u3002\u6211\u5011\u5efa\u8b70\u60a8\u8a55\u4f30\u5217\u8868\u4e2d\u7684\u6240\u6709 ClusterRoleBinding\uff0c\u4ee5\u8a55\u4f30\u60a8\u9700\u8981\u9077\u79fb\u54ea\u4e9b\u7d81\u5b9a\u4ee5\u53ca\u54ea\u4e9b\u7d81\u5b9a\u4e0d\u9069\u7528\u65bc\u76ee\u6a19 GKE Enterprise \u74b0\u5883\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b ClusterRoleBinding\uff0c\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `cluster-admin` ClusterRoleBinding \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get clusterrolebinding cluster-admin -o yaml | tee clusterrolebinding-cluster-admin.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\napiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata:\u00a0 annotations:\u00a0 \u00a0 rbac.authorization.kubernetes.io/autoupdate: \"true\"\u00a0 labels:\u00a0 \u00a0 kubernetes.io/bootstrapping: rbac-defaults\u00a0 name: cluster-adminroleRef:\u00a0 apiGroup: rbac.authorization.k8s.io\u00a0 kind: ClusterRole\u00a0 name: cluster-adminsubjects:- apiGroup: rbac.authorization.k8s.io\u00a0 kind: Group\u00a0 name: system:masters\n```\u8f38\u51fa\u6703\u4ee5 YAML \u683c\u5f0f\u986f\u793a `cluster-admin` ClusterRoleBinding \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `clusterrolebinding-cluster-admin.yaml` \u6587\u4ef6\u4e2d\u3002\u672c\u90e8\u5206\u4ecb\u7d39\u5982\u4f55\u8a55\u4f30 [\u591a\u79df\u6236\u9694\u96e2](https://docs.openshift.com/container-platform/latest/networking/openshift_sdn/multitenant-isolation.html) \u7684\u914d\u7f6e\u3002\u5982\u679c\u60a8\u7232\u96c6\u7fa3\u4e2d\u7684\u4efb\u4f55 OpenShift \u9805\u76ee\u5275\u5efa\u4e86\u81ea\u5b9a\u7fa9 [NetNamespace](https://docs.openshift.com/container-platform/latest/rest_api/network_apis/netnamespace-network-openshift-io-v1.html) \u4ee5\u9694\u96e2\u6216\u52a0\u5165\u7db2\u7d61\u547d\u540d\u7a7a\u9593\uff0c\u5247\u672c\u90e8\u5206\u9069\u7528\u3002\u5982\u679c\u60a8\u672a\u5275\u5efa\u81ea\u5b9a\u7fa9 NetNamespace\uff0c\u8acb\u8df3\u5230 [\u5c0e\u51fa\u9805\u76ee\u7d1a\u8cc7\u6e90\u63cf\u8ff0\u7b26](#export-project-scoped-resource-descriptors) \u3002\nOpenShift \u6703\u81ea\u52d5\u7232\u4ee3\u7ba1\u5f0f OpenShift \u9805\u76ee\u5275\u5efa\u548c\u7ba1\u7406 NetNamespace\u3002\u7531 OpenShift \u7ba1\u7406\u7684\u9805\u76ee\u7684 NetNamespace \u4e0d\u5728\u6b64\u6b21\u9077\u79fb\u7bc4\u570d\u4e4b\u5167\u3002\n\u5982\u9700\u5c0e\u51fa\u81ea\u5b9a\u7fa9 NetNamespace\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u7372\u53d6 NetNamespace \u5217\u8868\uff1a```\noc get netnamespaces\n```\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0NETID \u00a0 \u00a0 \u00a0EGRESS IPSdefault \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0kube-node-lease \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 13240579kube-public \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 15463168kube-system \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 16247265openshift \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 9631477openshift-apiserver \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 12186643openshift-apiserver-operator \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a06097417openshift-authentication \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a02862939openshift-authentication-operator \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 723750openshift-cloud-credential-operator \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 11544971openshift-cluster-csi-drivers \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 7650297openshift-cluster-machine-approver \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a07836750openshift-cluster-node-tuning-operator \u00a0 \u00a0 \u00a0 \u00a07531826...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u8a2d\u7f6e\u7684 NetNamespace \u5217\u8868\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b NetNamespace\uff0c\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `default` `NetNamespace` \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get netnamespace example-project -o yaml | tee netnamespace-example-project.yaml\n```\u5c0d\u65bc\u6c92\u6709\u76f8\u540c `netid` \u503c\u7684 NetNamespace\uff0c\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\napiVersion: network.openshift.io/v1kind: NetNamespacemetadata:\u00a0 name: example-projectnetid: 1234netname: example-project\n```\u8f38\u51fa\u6703\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u986f\u793a `example-project` NetNamespace \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `netnamespace-example-project.yaml` \u6587\u4ef6\u4e2d\u3002\u5c0d\u65bc\u5177\u6709\u76f8\u540c `netid` \u503c\u7684 NetNamespace\uff0c\u8f38\u51fa\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a```\napiVersion: network.openshift.io/v1kind: NetNamespacemetadata:\u00a0 name: example-projectnetid: 1234netname: example-projectapiVersion: network.openshift.io/v1kind: NetNamespacemetadata:\u00a0 name: example-project-2netid: 1234netname: example-project-2\n```\n### \u5c0e\u51fa\u9805\u76ee\u7d1a\u8cc7\u6e90\u63cf\u8ff0\u7b26\n\u5982\u9700\u5c0e\u51fa\u5177\u6709\u9805\u76ee\u7bc4\u570d\u7684\u8cc7\u6e90\u7684\u63cf\u8ff0\u7b26\uff0c\u8acb\u7232\u6bcf\u500b OpenShift \u9805\u76ee\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u3002\n- \u5728\u60a8\u7684\u7d42\u7aef\u4e2d\uff0c\u9078\u64c7\u8981\u8a55\u4f30\u7684 OpenShift \u9805\u76ee\u3002\u4f8b\u5982\uff0c\u9078\u64c7 `example-project` OpenShift \u9805\u76ee\uff1a```\noc project example-project\n```\n- \u7372\u53d6 [ResourceQuota](https://docs.openshift.com/container-platform/latest/rest_api/schedule_and_quota_apis/resourcequota-v1.html) \u5217\u8868\uff1a```\noc get resourcequotas\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0AGE \u00a0 REQUEST \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0LIMITgpu-quota \u00a0 6s \u00a0 \u00a0requests.nvidia.com/gpu: 1/1...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u7232\u6240\u9078 OpenShift \u9805\u76ee\u8a2d\u7f6e\u7684 `ResourceQuotas` \u5217\u8868\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b ResourceQuota\uff0c\u4ee5 YAML \u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `gpu-quota` ResourceQuota \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get resourcequota gpu-quota -o yaml | tee resourcequota-gpu-quota.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\napiVersion: v1kind: ResourceQuotametadata:\u00a0 name: gpu-quota\u00a0 namespace: example-projectspec:\u00a0 hard:\u00a0 \u00a0 requests.nvidia.com/gpu: \"1\"\n```\u8f38\u51fa\u6703\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u986f\u793a `gpu-quota` ResourceQuota \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `resourcequota-gpu-quota.yaml` \u6587\u4ef6\u4e2d\u3002\n- \u7372\u53d6 [Role](https://docs.openshift.com/container-platform/latest/rest_api/role_apis/role-authorization-openshift-io-v1.html) \u5217\u8868\uff1a```\noc get roles\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 CREATED ATexample \u00a0 \u00a0 \u00a0 \u00a0 \u00a02021-02-02T06:48:27Z...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u7232\u6240\u9078 OpenShift \u9805\u76ee\u8a2d\u7f6e\u7684 Role \u5217\u8868\u3002Role \u5217\u8868\u5305\u62ec\u5f15\u7528 OpenShift \u7cfb\u7d71\u7d44\u4ef6\u7684 Role\u3002\u6211\u5011\u5efa\u8b70\u60a8\u8a55\u4f30\u5217\u8868\u4e2d\u7684\u6240\u6709 Role\uff0c\u4ee5\u8a55\u4f30\u60a8\u9700\u8981\u9077\u79fb\u54ea\u4e9b\u89d2\u8272\u4ee5\u53ca\u54ea\u4e9b\u89d2\u8272\u4e0d\u9069\u7528\u65bc\u76ee\u6a19 GKE Enterprise \u74b0\u5883\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b Role\uff0c\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `example` Role \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get role example -o yaml | tee role-example.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\napiVersion: rbac.authorization.k8s.io/v1kind: Rolemetadata:\u00a0 name: example\u00a0 namespace: example-projectrules:- apiGroups:\u00a0 - \"\"\u00a0 resources:\u00a0 - services\u00a0 - endpoints\u00a0 - pods\u00a0 verbs:\u00a0 - get\u00a0 - list\u00a0 - watch\n```\u8f38\u51fa\u6703\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u986f\u793a `example` Role \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `role-example.yaml` \u6587\u4ef6\u4e2d\u3002\n- \u7372\u53d6 [RoleBinding](https://docs.openshift.com/container-platform/latest/rest_api/role_apis/rolebinding-authorization-openshift-io-v1.html) \u5217\u8868\uff1a```\noc get rolebindings\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ROLE \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 AGEmachine-config-controller-events \u00a0 ClusterRole/machine-config-controller-events \u00a0 21dmachine-config-daemon-events \u00a0 \u00a0 \u00a0 ClusterRole/machine-config-daemon-events \u00a0 \u00a0 \u00a0 21dexample \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Role/example \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 21dsystem:deployers \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ClusterRole/system:deployer \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a021dsystem:image-builders \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0ClusterRole/system:image-builder \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 21dsystem:image-pullers \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ClusterRole/system:image-puller \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a021d...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7232\u6240\u9078 OpenShift \u9805\u76ee\u8a2d\u7f6e\u7684 RoleBinding \u5217\u8868\u3002RoleBinding \u5217\u8868\u5305\u62ec\u5f15\u7528 OpenShift \u7cfb\u7d71\u7d44\u4ef6\u7684 RoleBinding\u3002\u6211\u5011\u5efa\u8b70\u60a8\u8a55\u4f30\u5217\u8868\u4e2d\u7684\u6240\u6709 RoleBinding\uff0c\u4ee5\u8a55\u4f30\u60a8\u9700\u8981\u9077\u79fb\u54ea\u4e9b\u7d81\u5b9a\u4ee5\u53ca\u54ea\u4e9b\u7d81\u5b9a\u4e0d\u9069\u7528\u65bc\u76ee\u6a19 GKE Enterprise \u74b0\u5883\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b RoleBinding\uff0c\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `example` RoleBinding \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get rolebinding example -o yaml | tee rolebinding-example.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\napiVersion: rbac.authorization.k8s.io/v1kind: RoleBindingmetadata:\u00a0 name: example\u00a0 namespace: example-projectroleRef:\u00a0 apiGroup: rbac.authorization.k8s.io\u00a0 kind: Role\u00a0 name: examplesubjects:- kind: ServiceAccount\u00a0 name: example\u00a0 namespace: example-ns\n```\u8f38\u51fa\u6703\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u986f\u793a `example` RoleBinding \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `rolebinding-example.yaml` \u6587\u4ef6\u4e2d\u3002\n- \u7372\u53d6 [EgressNetworkPolicy](https://docs.openshift.com/container-platform/latest/rest_api/network_apis/egressnetworkpolicy-network-openshift-io-v1.html) \u5217\u8868\uff1a```\noc get egressnetworkpolicies\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0AGEdefault \u00a0 2m2s...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u7232\u6240\u9078 OpenShift \u9805\u76ee\u8a2d\u7f6e\u7684 EgressNetworkPolicy \u5217\u8868\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b EgressNetworkPolicy\uff0c\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `default` EgressNetworkPolicy \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get egressnetworkpolicy default -o yaml | tee egressnetworkpolicy-default.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\napiVersion: network.openshift.io/v1kind: EgressNetworkPolicymetadata:\u00a0 name: default\u00a0 namespace: example-projectspec:\u00a0 egress:\u00a0 - to:\u00a0 \u00a0 \u00a0 cidrSelector: 1.2.3.0/24\u00a0 \u00a0 type: Allow\u00a0 - to:\u00a0 \u00a0 \u00a0 dnsName: www.example.com\u00a0 \u00a0 type: Allow\u00a0 - to:\u00a0 \u00a0 \u00a0 cidrSelector: 0.0.0.0/0\u00a0 \u00a0 type: Deny\n```\u8f38\u51fa\u6703\u4ee5 YAML \u683c\u5f0f\u986f\u793a `default` EgressNetworkPolicy \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u9084\u5c07\u4fdd\u5b58\u5230 `egressnetworkpolicy-default.yaml` \u6587\u4ef6\u4e2d\u3002\n- \u7372\u53d6 [NetworkPolicy](https://docs.openshift.com/container-platform/latest/rest_api/network_apis/networkpolicy-networking-k8s-io-v1.html) \u5217\u8868\uff1a```\noc get networkpolicies\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\nNAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0POD-SELECTOR \u00a0 AGEtest-policy \u00a0 app=mongodb \u00a0 \u00a03s...\n```\u8f38\u51fa\u6703\u986f\u793a OpenShift \u96c6\u7fa3\u4e2d\u7576\u524d\u7232\u6240\u9078 OpenShift \u9805\u76ee\u8a2d\u7f6e\u7684 NetworkPolicy \u5217\u8868\u3002\n- \u5c0d\u65bc\u5217\u8868\u4e2d\u7684\u6bcf\u500b NetworkPolicy\uff0c\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u5c0e\u51fa\u5176\u63cf\u8ff0\u7b26\uff0c\u986f\u793a\u8f38\u51fa\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u4ee5\u4f9b\u4ee5\u5f8c\u8655\u7406\u3002\u4f8b\u5982\uff0c\u5c0e\u51fa `test-policy` NetworkPolicy \u7684\u63cf\u8ff0\u7b26\uff1a```\noc get networkpolicy test-policy -o yaml | tee networkpolicy-test-policy.yaml\n```\u8f38\u51fa\u5167\u5bb9\u985e\u4f3c\u5982\u4e0b\uff1a```\napiVersion: networking.k8s.io/v1kind: NetworkPolicymetadata:\u00a0 name: test-policy\u00a0 namespace: example-projectspec:\u00a0 ingress:\u00a0 - from:\u00a0 \u00a0 - podSelector:\u00a0 \u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 app: app\u00a0 \u00a0 ports:\u00a0 \u00a0 - port: 27017\u00a0 \u00a0 \u00a0 protocol: TCP\u00a0 podSelector:\u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 app: mongodb\u00a0 policyTypes:\u00a0 - Ingress\n```\u8f38\u51fa\u6703\u4ee5 YAML \u6587\u4ef6\u683c\u5f0f\u986f\u793a `test-policy` NetworkPolicy \u7684\u63cf\u8ff0\u7b26\u3002\u8f38\u51fa\u5c07\u4fdd\u5b58\u5230 `networkpolicy-test-policy.yaml` \u6587\u4ef6\u4e2d\u3002## \u5c07 OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u6620\u5c04\u5230 Kubernetes \u8cc7\u6e90\n\u5b8c\u6210 OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u7684\u6e05\u55ae\u5f8c\uff0c\u60a8\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8a55\u4f30\u9019\u4e9b\u8cc7\u6e90\uff1a\n- \u8a55\u4f30\u6e05\u55ae\u4e2d\u7684\u54ea\u4e9b\u8cc7\u6e90\u662f Kubernetes \u8cc7\u6e90\uff0c\u54ea\u4e9b\u662f OpenShift \u8cc7\u6e90\u3002\n- \u5c07 OpenShift \u8cc7\u6e90\u6620\u5c04\u5230\u5176 Kubernetes\u3001GKE \u548c GKE Enterprise \u7b49\u6548\u8cc7\u6e90\u3002\n\u4ee5\u4e0b\u5217\u8868\u53ef\u5e6b\u52a9\u60a8\u8a55\u4f30 OpenShift \u96c6\u7fa3\u4e2d\u9810\u914d\u7684\u54ea\u4e9b\u8cc7\u6e90\u662f Kubernetes \u8cc7\u6e90\uff0c\u4ee5\u53ca\u54ea\u4e9b\u8cc7\u6e90\u50c5\u5728 OpenShift \u4e2d\u53ef\u7528\uff1a\n- OpenShift \u9805\u76ee\u662f\u5177\u6709\u5176\u4ed6\u8a3b\u91cb\u7684 [Kubernetes Namespace](https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/) \u3002\n- Role\u3001ClusterRole\u3001RoleBinding \u548c ClusterRoleBinding \u662f [Kubernetes \u8cc7\u6e90](https://kubernetes.io/docs/reference/access-authn-authz/rbac/) \u3002\n- ResourceQuota \u662f [Kubernetes \u8cc7\u6e90](https://kubernetes.io/docs/concepts/policy/resource-quotas/) \u3002\n- NetworkPolicy \u662f [Kubernetes \u8cc7\u6e90](https://kubernetes.io/docs/concepts/services-networking/network-policies/) \u3002\n- ClusterResourceQuota \u4e0d\u662f Kubernetes \u8cc7\u6e90\uff1b\u5b83\u5011\u50c5\u5728 OpenShift \u4e2d\u53ef\u7528\u3002\n- NetNamespace \u548c EgressNetworkPolicy \u4e0d\u662f Kubernetes \u8cc7\u6e90\uff1b\u5b83\u5011\u50c5\u5728 OpenShift \u4e2d\u53ef\u7528\u3002\n\u4e0b\u8868\u7e3d\u7d50\u4e86\u5982\u4f55\u5c07 OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u6620\u5c04\u5230 GKE Enterprise \u4e2d\u4f7f\u7528\u7684\u8cc7\u6e90\u3002\n| OpenShift           | GKE Enterprise       |\n|:-----------------------------------------------------|:------------------------------------------|\n| \u9805\u76ee             | \u8f49\u63db\u7232\u5177\u6709\u5176\u4ed6\u8a3b\u91cb\u7684 Kubernetes Namespace |\n| Role\u3001ClusterRole\u3001RoleBinding \u548c ClusterRoleBinding | Kubernetes RBAC \u8cc7\u6e90      |\n| ResourceQuota          | Kubernetes RBAC \u8cc7\u6e90      |\n| ClusterResourceQuota         | \u8f49\u63db\u7232 ResourceQuota \u6216\u4f7f\u7528\u5206\u5c64\u8cc7\u6e90\u914d\u984d |\n| NetworkPolicy          | Kubernetes \u7db2\u7d61\u8cc7\u6e90      |\n| NetNamespace\u3001EgressNetworkPolicy     | \u8f49\u63db\u7232 NetworkPolicy      |\n\u8a55\u4f30 OpenShift \u74b0\u5883\u4e2d\u7684\u8cc7\u6e90\u5f8c\uff0c\u8acb\u5c07 OpenShift \u8cc7\u6e90\u6620\u5c04\u5230\u60a8\u53ef\u4ee5\u5728 GKE \u548c GKE Enterprise \u4e2d\u9810\u914d\u548c\u914d\u7f6e\u7684\u8cc7\u6e90\u3002\u60a8\u7121\u9700\u6620\u5c04\u5728 OpenShift \u96c6\u7fa3\u4e2d\u4f7f\u7528\u7684 Kubernetes \u8cc7\u6e90\uff0c\u56e0\u7232 GKE Enterprise \u76f4\u63a5\u652f\u6301\u9019\u4e9b\u8cc7\u6e90\u3002\u5982 [OpenShift \u5230 GKE Enterprise \u529f\u80fd\u6620\u5c04\u6458\u8981](https://cloud.google.com/architecture/migrating-containers-openshift-anthos?hl=zh-cn#summary_of_openshift_to_anthos_capability_mapping) \u4e2d\u6240\u8ff0\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u57f7\u884c\u4ee5\u4e0b\u6620\u5c04\uff1a\n- \u5c07 OpenShift \u9805\u76ee\u6620\u5c04\u5230 Kubernetes Namespace\u3002\n- \u5c07 ClusterResourceQuota \u6620\u5c04\u5230 ResourceQuota\u3002\n- \u5c07 NetNamespace \u548c EgressNetworkPolicy \u6620\u5c04\u5230 NetworkPolicy\u3002## \u5275\u5efa\u6620\u5c04\u5230 OpenShift \u9805\u76ee\u914d\u7f6e\u8cc7\u6e90\u7684 Kubernetes \u8cc7\u6e90\n\u5b8c\u6210 [\u6620\u5c04](#map-openshift-project-configuration-resources-to-kubernetes-resources) \u5f8c\uff0c\u60a8\u9700\u8981\u5275\u5efa\u6620\u5c04\u5230 OpenShift \u8cc7\u6e90\u7684 Kubernetes \u8cc7\u6e90\u3002\u6211\u5011\u5efa\u8b70\u60a8\u5275\u5efa\u4ee5\u4e0b\u5167\u5bb9\uff1a\n- \u6bcf\u500b OpenShift \u9805\u76ee\u90fd\u6709\u4e00\u500b Kubernetes Namespace\u3002\n- ClusterResourceQuota \u9650\u5236\u7684\u6bcf\u500b Kubernetes Namespace \u90fd\u6709\u4e00\u500b ResourceQuota\u3002\n- \u7528\u4ee5\u5339\u914d NetNamespace \u548c EgressNetworkPolicy \u7684 NetworkPolicy\u3002\n### \u5275\u5efa Kubernetes Namespace\nOpenShift \u9805\u76ee\u662f [\u5177\u6709\u5176\u4ed6\u8a3b\u91cb\u7684 Kubernetes Namespace](https://cloud.google.com/architecture/migrating-containers-openshift-anthos?hl=zh-cn#openshift_projects) \u3002 [OpenShift \u9805\u76ee API](https://docs.openshift.com/container-platform/latest/rest_api/project_apis/project-project-openshift-io-v1.html) \u8207 [Kubernetes Namespace API](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19/#namespace-v1-core) \u975e\u5e38\u5339\u914d\u3002\u5982\u9700\u9077\u79fb OpenShift \u9805\u76ee\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u7232\u6bcf\u500b OpenShift \u9805\u76ee\u5275\u5efa\u4e00\u500b Kubernetes Namespace\u3002\u9019\u4e9b API \u517c\u5bb9\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5f9e OpenShift \u9805\u76ee\u5275\u5efa Kubernetes Namespace\u3002\n\u5982\u9700\u901a\u904e OpenShift \u9805\u76ee\u5275\u5efa Kubernetes Namespace\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u5c07 OpenShift \u9805\u76ee\u63cf\u8ff0\u7b26\u4e2d\u7684\u503c\u66f4\u6539\u7232\u6bcf\u500b OpenShift \u9805\u76ee\u5c0d\u61c9\u7684 Kubernetes Namespace API \u7248\u672c\u3002\u7232\u6b64\uff0c\u60a8\u5c07 OpenShift \u9805\u76ee\u63cf\u8ff0\u7b26\u4e2d\u7684 `apiVersion` \u5b57\u6bb5\u503c\u5f9e OpenShift \u9805\u76ee\u5c0d\u8c61 API \u7248\u672c\u548c `kind` \u5b57\u6bb5\u503c\u66f4\u6539\u7232\u76f8\u61c9\u7684 [Kubernetes Namespace \u5c0d\u8c61 API \u7248\u672c](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19/#namespace-v1-core) \u3002\u4f8b\u5982\uff0c\u60a8\u5728\u4e0a\u4e00\u90e8\u5206\u4e2d\u8a55\u4f30\u7684 OpenShift \u9805\u76ee\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5167\u5bb9\uff1a\n```\napiVersion: project.openshift.io/v1kind: Projectmetadata:\u00a0 annotations:\u00a0 name: defaultspec:\u00a0 finalizers:\u00a0 - kubernetes\n```\n\u5982\u9700\u9077\u79fb\u9805\u76ee\uff0c\u8acb\u5c07 `apiVersion` \u5b57\u6bb5\u503c\u5f9e `project.openshift.io/v1` \u66f4\u6539\u7232 `v1` \uff0c\u4e26\u5c07 `kind` \u5b57\u6bb5\u503c\u5f9e `Project` \u66f4\u6539\u7232 `Namespace` \uff1a\n```\napiVersion: v1kind: NamespaceMetadata:\u00a0 annotations:\u00a0 name: defaultspec:\u00a0 finalizers:\u00a0 - kubernetes\n```\n### \u5275\u5efa Kubernetes ResourceQuota\nOpenShift ClusterResourceQuota \u53ef\u8b93\u60a8 [\u8de8\u591a\u500b OpenShift \u9805\u76ee\u5171\u4eab\u914d\u984d](https://docs.openshift.com/container-platform/latest/applications/quotas/quotas-setting-across-multiple-projects.html) \u3002\u5275\u5efa ClusterResourceQuota \u6642\uff0c\u60a8\u53ef\u4ee5\u5b9a\u7fa9\u914d\u984d\u4e26\u5b9a\u7fa9\u9078\u64c7\u5668\u4ee5\u5339\u914d\u8981\u5f37\u5236\u57f7\u884c\u8a72\u914d\u984d\u7684 OpenShift \u9805\u76ee\u3002\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u9700\u8981\u5c07 OpenShift ClusterResourceQuota \u9077\u79fb\u5230\u60a8\u4e4b\u524d\u5275\u5efa\u7684 Namespace \u4e2d\u7684 Kubernetes ResourceQuota\u3002\n\u5982\u9700\u9077\u79fb ClusterResourceQuota\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u7232\u6bcf\u500b ClusterResourceQuota \u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u901a\u904e\u8a55\u4f30 ClusterResourceQuota \u7684 `spec.quota` \u5b57\u6bb5\u548c `spec.selector` \u5b57\u6bb5\uff0c\u5c07 ClusterResourceQuota \u6620\u5c04\u5230 OpenShift \u9805\u76ee\u3002\u4f8b\u5982\uff0c\u60a8\u5728\u4e0a\u4e00\u90e8\u5206\u5c0e\u51fa\u7684 `for-name` ClusterResourceQuota \u5982\u4e0b\u6240\u793a\uff1a```\napiVersion: quota.openshift.io/v1kind: ClusterResourceQuotametadata:\u00a0 name: for-namespec:\u00a0 quota:\u00a0 \u00a0 hard:\u00a0 \u00a0 \u00a0 pods: \"10\"\u00a0 \u00a0 \u00a0 secrets: \"20\"\u00a0 selector:\u00a0 \u00a0 annotations: null\u00a0 \u00a0 labels:\u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 name: frontend\n````for-name` ClusterResourceQuota \u6703\u5f37\u5236\u57f7\u884c Pod \u548c Secret \u914d\u984d\u9650\u5236\u3002 `spec.selector` \u5b57\u6bb5\u5c0d `frontend` OpenShift \u9805\u76ee\u5f37\u5236\u57f7\u884c\u9019\u4e9b\u9650\u5236\u3002\n- \u5728\u524d\u9762\u7684 [\u5275\u5efa Kubernetes Namespace](#create-kubernetes-namespaces) \u4e2d\uff0c\u60a8\u5275\u5efa\u4e86\u8207\u60a8\u7684 OpenShift \u9805\u76ee\u76f8\u5c0d\u61c9\u7684 Kubernetes Namespace\u3002\u4f7f\u7528\u8a72\u4fe1\u606f\u5c07 ClusterResourceQuota \u6620\u5c04\u5230\u65b0\u7684 Kubernetes Namespace\u3002\u4f8b\u5982\uff0c `frontend` OpenShift \u9805\u76ee\u5305\u542b `for-name` ClusterResourceQuota\u3002\u8a72\u9805\u76ee\u5c0d\u61c9\u65bc `frontend` Kubernetes Namespace\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5c07 `for-name` ClusterResourceQuota \u6620\u5c04\u5230 `frontend` Kubernetes Namespace\u3002\n- \u5c0d\u65bc ClusterResourceQuota \u7684 `quota` \u5b57\u6bb5\u4e2d\u7684\u6bcf\u500b\u914d\u984d\u5b9a\u7fa9\uff0c\u8acb\u6839\u64da\u76f8\u95dc\u689d\u4ef6\u5c07 ClusterResourceQuota \u6620\u5c04\u5230\u7684 Kubernetes Namespace \u4e4b\u9593\u5283\u5206\u914d\u984d\u91cf\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5728 `frontend` Kubernetes Namespace \u4e2d\u5e73\u5747\u5206\u914d `for-name` ClusterResourceQuota \u8a2d\u7f6e\u7684\u914d\u984d\u91cf\u3002\n- \u5c0d\u65bc\u6620\u5c04\u5230 ClusterResourceQuota \u7684\u6bcf\u500b Kubernetes Namespace\uff0c\u60a8\u5275\u5efa\u4e00\u500b Kubernetes [ResourceQuota](https://kubernetes.io/docs/concepts/policy/resource-quotas/) \u5c0d Namespace \u5be6\u65bd\u914d\u984d\u3002\u6839\u64da\u5728\u4e0a\u4e00\u6b65\u4e2d\u6536\u96c6\u7684\u4fe1\u606f\u8a2d\u7f6e\u914d\u984d\u6578\u91cf\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u7232 `frontend` Kubernetes Namespace \u5275\u5efa ResourceQuota\uff1a```\napiVersion: v1kind: ResourceQuotametadata:\u00a0 name: pods-secrets\u00a0 namespace: frontendspec:\u00a0 hard:\u00a0 \u00a0 pods: \"10\"\u00a0 \u00a0 secrets: \"20\"\n```\u518d\u8209\u4e00\u4f8b\uff0c\u60a8\u9700\u8981\u5c07 `for-name` ClusterResourceQuota \u6620\u5c04\u5230\u5169\u500b\u4e0d\u540c\u7684 Kubernetes Namespace\uff1a `example-1` \u548c `example-2` \u3002\u5982\u9700\u5b8c\u6210\u6620\u5c04\uff0c\u8acb\u901a\u904e\u7232 Kubernetes Namespace \u5275\u5efa ResourceQuota \u4ee5\u5728\u9019\u4e9b\u8cc7\u6e90\u4e4b\u9593\u5e73\u5747\u5206\u914d\u8cc7\u6e90\u3002\u5206\u914d ResourceQuota \u7684\u524d\u534a\u90e8\u5206\uff1a```\napiVersion: v1kind: ResourceQuotametadata:\u00a0 name: pods-secrets\u00a0 namespace: example-1spec:\u00a0 hard:\u00a0 \u00a0 pods: \"5\"\u00a0 \u00a0 secrets: \"10\"\n```\u5206\u914d ResourceQuota \u7684\u524d\u534a\u90e8\u5206\u5f8c\uff0c\u518d\u5206\u914d ResourceQuota \u7684\u5f8c\u534a\u90e8\u5206\uff1a```\napiVersion: v1kind: ResourceQuotametadata:\u00a0 name: pods-secrets\u00a0 namespace: example-2spec:\u00a0 hard:\u00a0 \u00a0 pods: \"5\"\u00a0 \u00a0 secrets: \"10\"\n```\u9019\u7a2e\u65b9\u6cd5\u5141\u8a31\u60a8\u5c0d\u5275\u5efa ResourceQuota \u7684\u6bcf\u500b Kubernetes Namespace \u5f37\u5236\u57f7\u884c\u9650\u5236\uff0c\u800c\u4e0d\u662f\u7232\u591a\u500b Kubernetes Namespace \u8a2d\u7f6e\u55ae\u500b\u9650\u5236\u3002\n\u4f7f\u7528 ResourceQuota \u5c0d Kubernetes Namespace \u5f37\u5236\u57f7\u884c\u914d\u984d\u8207\u4f7f\u7528 ClusterResourceQuota \u5c0d\u6240\u6709 Kubernetes Namespace \u5f37\u5236\u57f7\u884c\u914d\u984d\u4e0d\u540c\u3002\u5728\u4e0d\u540c\u7684 Kubernetes Namespace \u4e4b\u9593\u5283\u5206\u96c6\u7fa3\u7bc4\u570d\u7684\u914d\u984d\u53ef\u80fd\u4e0d\u662f\u6700\u7406\u60f3\u7684\uff1a\u9019\u7a2e\u5283\u5206\u53ef\u80fd\u6703\u7232\u67d0\u4e9b Kubernetes Namespace \u9810\u914d\u904e\u591a\u7684\u914d\u984d\uff0c\u800c\u7232\u5176\u4ed6 Kubernetes Namespace \u9810\u914d\u4e0d\u8db3\u7684\u914d\u984d\u3002\n\u6211\u5011\u5efa\u8b70\u60a8\u6839\u64da\u76f8\u61c9\u7684 ClusterResourceQuota \u5efa\u7acb\u7684\u7e3d\u914d\u984d\u91cf\u4f86\u52d5\u614b\u8abf\u6574 Kubernetes Namespace \u4e2d\u7684 ResourceQuota \u7684\u914d\u7f6e\uff0c\u4ee5\u512a\u5316\u914d\u984d\u5206\u914d\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u52d5\u614b\u589e\u52a0\u6216\u6e1b\u5c11\u7531 `pods-secrets` ResourceQuota \u5f37\u5236\u57f7\u884c\u7684\u914d\u984d\u91cf\uff0c\u4ee5\u907f\u514d\u904e\u5ea6\u9810\u914d\u6216\u9810\u914d\u4e0d\u8db3\u7684 `example-1` \u548c `example-2` Kubernetes Namespace\u3002 `pods-secrets` ResourceQuota \u7684\u7e3d\u914d\u984d\u91cf\u4e0d\u61c9\u8d85\u904e\u5c0d\u61c9ClusterResourceQuota \u4e2d\u7684\u914d\u984d\u91cf\u3002\n\u914d\u7f6e ResourceQuota \u6642\uff0c\u8acb\u8003\u616e [GKE \u914d\u984d\u548c\u9650\u5236](https://cloud.google.com/kubernetes-engine/quotas?hl=zh-cn) \u4ee5\u53ca [GKE on VMware \u914d\u984d\u548c\u9650\u5236](https://cloud.google.com/anthos/clusters/docs/on-prem/1.6/quotas?hl=zh-cn) \u3002\u9019\u4e9b\u914d\u984d\u548c\u9650\u5236\u53ef\u80fd\u6703\u5f37\u5236\u57f7\u884c\u6bd4\u60a8\u7684 ResourceQuota \u66f4\u4f4e\u7684\u9650\u5236\u3002\u4f8b\u5982\uff0c\u7121\u8ad6\u60a8\u5982\u4f55\u914d\u7f6e ResourceQuota\uff0cGKE \u90fd\u6703\u9650\u5236 [\u6bcf\u500b\u7bc0\u9ede\u7684\u6700\u5927 Pod \u6578](https://cloud.google.com/kubernetes-engine/quotas?hl=zh-cn#limits_per_cluster) \u3002\n### \u5275\u5efa NetworkPolicy\nOpenShift NetNamespace \u53ef\u8b93\u60a8 [\u914d\u7f6e OpenShift \u9805\u76ee\u4e4b\u9593\u7684\u7db2\u7d61\u9694\u96e2](https://docs.openshift.com/container-platform/latest/networking/openshift_sdn/multitenant-isolation.html) \u3002OpenShift EgressNetworkPolicy [\u53ef\u8b93\u60a8\u63a7\u5236\u96e2\u958b OpenShift \u96c6\u7fa3\u7684\u51fa\u7ad9\u6d41\u91cf](https://docs.openshift.com/container-platform/latest/networking/openshift_sdn/configuring-egress-firewall.html) \u3002\u672c\u90e8\u5206\u4f9d\u8cf4\u65bc\u6d41\u91cf\u9650\u5236\u6982\u5ff5\u3002\n\u5982\u9700\u9077\u79fb NetNamespace \u548c EgressNetworkPolicy\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u8a55\u4f30\u60a8\u7684 NetNamespace \u548c EgressNetworkPolicy\uff0c\u4ee5\u77ad\u89e3\u5b83\u5011\u5982\u4f55\u8abf\u7bc0 OpenShift \u9805\u76ee\u4e4b\u9593\u7684\u7db2\u7d61\u6d41\u91cf\u4ee5\u53ca\u96e2\u958b OpenShift \u96c6\u7fa3\u7684\u51fa\u7ad9\u6d41\u91cf\u3002\u4f8b\u5982\uff0c\u8acb\u8a55\u4f30\u60a8\u5728\u4e0a\u4e00\u90e8\u5206\u4e2d\u5c0e\u51fa\u7684 NetNamespace \u548c EgressNetworkPolicy\uff1a```\napiVersion: network.openshift.io/v1kind: NetNamespacemetadata:\u00a0 name: example-projectnetid: 1234netname: example-projectapiVersion: network.openshift.io/v1kind: NetNamespacemetadata:\u00a0 name: example-project-2netid: 1234netname: example-project-2apiVersion: network.openshift.io/v1kind: EgressNetworkPolicymetadata:\u00a0 name: default\u00a0 namespace: example-projectspec:\u00a0 egress:\u00a0 - to:\u00a0 \u00a0 \u00a0 cidrSelector: 1.2.3.0/24\u00a0 \u00a0 type: Allow\u00a0 - to:\u00a0 \u00a0 \u00a0 cidrSelector: 0.0.0.0/0\u00a0 \u00a0 type: Deny\n````example-project` \u548c `example-project-2` NetNamespace \u5b9a\u7fa9\u4e86\u5177\u6709\u76f8\u540c `netid` \u503c `1234` \u7684\u758a\u52a0\u7db2\u7d61\u3002\u56e0\u6b64\uff0c `example-project` OpenShift \u9805\u76ee\u4e2d\u7684 Pod \u53ef\u4ee5\u8207 `example-project-2` OpenShift \u9805\u76ee\u4e2d\u7684 Pod \u901a\u4fe1\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002`default` EgressNetworkPolicy \u5b9a\u7fa9\u4e86\u4ee5\u4e0b\u51fa\u7ad9\u7db2\u7d61\u6d41\u91cf\u898f\u5247\uff1a- \u5141\u8a31\u51fa\u7ad9\u6d41\u91cf\u767c\u9001\u5230`1.2.3.0/24`\u5b50\u7db2\u3002\n- \u62d2\u7d55\u8207\u5176\u4ed6\u898f\u5247\u4e0d\u5339\u914d\u7684\u51fa\u7ad9\u6d41\u91cf\u3002\n- \u5275\u5efa NetworkPolicy \u548c OPA \u653f\u7b56\uff0c\u4ee5\u7b26\u5408\u7db2\u7d61\u6d41\u91cf\u9650\u5236\u8981\u6c42\u3002\u4f8b\u5982\uff0c `default-np` \u548c `default-np-2` \u5be6\u73fe\u4e86\u4ee5\u4e0b\u653f\u7b56\uff1a- \u7531`default`EgressNetworkPolicy \u5f37\u5236\u57f7\u884c\u7684\u653f\u7b56\u3002\n- \u7531\u5c07`netid`\u6a19\u7c64\u8a2d\u7f6e\u7232`example-project`\u548c`example-project-2`\u7684 Namespace \u4e2d\u7684`example-project`\u548c`example-project-2`NetNamespace \u5f37\u5236\u57f7\u884c\u7684\u653f\u7b56\uff1a\n\u9019\u4e9b\u653f\u7b56\u5982\u4e0b\u6240\u793a\uff1a```\n---kind: NetworkPolicyapiVersion: networking.k8s.io/v1metadata:\u00a0 name: default-np\u00a0 namespace: example-projectspec:\u00a0 policyTypes:\u00a0 - Ingress\u00a0 - Egress\u00a0 podSelector: {}\u00a0 egress:\u00a0 \u00a0 - to:\u00a0 \u00a0 \u00a0 - namespaceSelector:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 netid: example-project-2\u00a0 \u00a0 \u00a0 - podSelector: {}\u00a0 \u00a0 \u00a0 - ipBlock:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cidr: 1.2.3.0/24\u00a0 ingress:\u00a0 \u00a0 - from:\u00a0 \u00a0 \u00a0 - namespaceSelector:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 netname: example-project-2---kind: NetworkPolicyapiVersion: networking.k8s.io/v1metadata:\u00a0 name: default-np-2\u00a0 namespace: example-project-2spec:\u00a0 policyTypes:\u00a0 - Ingress\u00a0 - Egress\u00a0 podSelector: {}\u00a0 egress:\u00a0 \u00a0 - to:\u00a0 \u00a0 \u00a0 - namespaceSelector:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 netid: example-project-2\u00a0 \u00a0 \u00a0 - podSelector: {}\u00a0 \u00a0 \u00a0 - ipBlock:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cidr: 1.2.3.0/24\u00a0 ingress:\u00a0 \u00a0 - from:\u00a0 \u00a0 \u00a0 - namespaceSelector:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 matchLabels:\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 netname: example-project\n```## \u4f7f\u7528 Config Sync \u7ba1\u7406 Kubernetes \u8cc7\u6e90\n\u5982\u9700\u7ba1\u7406 GKE \u96c6\u7fa3\u7684 Kubernetes \u8cc7\u6e90\u548c\u914d\u7f6e\uff0c\u6211\u5011\u5efa\u8b70\u60a8\u4f7f\u7528 [Config Sync](https://cloud.google.com/anthos-config-management/docs/config-sync-overview?hl=zh-cn) \u3002\n\u5982\u9700\u77ad\u89e3\u5982\u4f55\u5728 GKE \u96c6\u7fa3\u4e0a\u5553\u7528 Config Sync\uff0c\u8acb\u53c3\u95b1 [\u5b89\u88dd Config Sync](https://cloud.google.com/anthos-config-management/docs/how-to/installing-config-sync?hl=zh-cn) \u3002\n\u5728 GKE Enterprise \u74b0\u5883\u4e2d\u9810\u914d\u548c\u914d\u7f6e Config Sync \u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83 [\u5275\u5efa\u914d\u7f6e\u4e26\u5c07\u914d\u7f6e\u81ea\u52d5\u61c9\u7528\u65bc GKE \u96c6\u7fa3](https://cloud.google.com/kubernetes-engine/docs/add-on/config-sync/how-to/configs?hl=zh-cn) \u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u77ad\u89e3\u5982\u4f55 [\u958b\u59cb\u9077\u79fb\u5230 Google Cloud](https://cloud.google.com/architecture/migration-to-gcp-getting-started?hl=zh-cn) \u3002\n- \u77ad\u89e3 [\u69cb\u5efa](https://cloud.google.com/architecture/best-practices-for-building-containers?hl=zh-cn) \u548c [\u64cd\u4f5c](https://cloud.google.com/architecture/best-practices-for-operating-containers?hl=zh-cn) \u5bb9\u5668\u7684\u6700\u4f73\u5be6\u8e10\u3002\n- \u77ad\u89e3 [GKE \u7db2\u7d61\u7684\u6700\u4f73\u505a\u6cd5](https://cloud.google.com/kubernetes-engine/docs/best-practices/networking?hl=zh-cn) \u3002\n- \u77ad\u89e3\u5982\u4f55 [\u5f37\u5316\u96c6\u7fa3\u7684\u5b89\u5168\u6027](https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster?hl=zh-cn) \u3002\n- [\u95b1\u8b80 GKE \u5b89\u5168\u6982\u89bd](https://cloud.google.com/kubernetes-engine/docs/concepts/security-overview?hl=zh-cn) \u3002\n- \u63a2\u7d22\u6709\u95dc Google Cloud \u7684\u53c3\u8003\u67b6\u69cb\u3001\u5716\u8868\u548c\u6700\u4f73\u5be6\u8e10\u3002\u67e5\u770b\u6211\u5011\u7684 [Cloud Architecture Center](https://cloud.google.com/architecture?hl=zh-cn) \u3002", "guide": "Docs"}