{"title": "Docs - \u5728 Compute Engine \u4e0a\u90e8\u7f72 Active Directory \u6797", "url": "https://cloud.google.com/architecture/deploy-an-active-directory-forest-on-compute-engine?hl=zh-cn", "abstract": "# Docs - \u5728 Compute Engine \u4e0a\u90e8\u7f72 Active Directory \u6797\nLast reviewed 2023-05-10 UTC\n\u672c\u6587\u6a94\u4ecb\u7d39\u77ad\u5982\u4f55\u6309\u7167 [\u5728 Google Cloud \u4e0a\u904b\u884c Active Directory \u7684\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/managed-microsoft-ad/docs/best-practices?hl=zh-cn#shared-vpc) \u4e2d\u6240\u8ff0\u7684\u6700\u4f73\u5be6\u8e10\u5728 [Compute Engine](https://cloud.google.com/compute?hl=zh-cn) \u4e0a\u90e8\u7f72 Active Directory \u6797\u3002\n\u672c\u6307\u5357\u9069\u7528\u65bc\u7ba1\u7406\u54e1\u548c DevOps \u5de5\u7a0b\u5e2b\u3002\u5b83\u5047\u5b9a\u60a8\u719f\u6089 Active Directory\uff0c\u4e26\u4e14\u57fa\u672c\u77ad\u89e3 Google Cloud \u7db2\u7d61\u548c\u5b89\u5168\u6027\u3002", "content": "## \u67b6\u69cb\u90e8\u7f72\u5305\u542b\u5169\u500b\u9805\u76ee\uff1a- \u4e00\u500b\u5305\u542b [\u5171\u4eab VPC](https://cloud.google.com/vpc/docs/shared-vpc?hl=zh-cn) \u7db2\u7d61\u3001 [\u5c08\u7528 DNS \u8f49\u767c\u53ef\u7528\u5340](https://cloud.google.com/dns/docs/zones/forwarding-zones?hl=zh-cn) \u548c Active Directory [\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/firewall/docs/firewalls?hl=zh-cn) \u7684\u5bbf\u4e3b\u9805\u76ee\u3002\n- \u4e00\u500b\u670d\u52d9\u9805\u76ee\uff0c\u5305\u542b\u5169\u500b\u90e8\u7f72\u5728\u5169\u500b\u53ef\u7528\u5340\u7684\u7db2\u57df\u63a7\u5236\u5668\u3002\n\u6b64\u67b6\u69cb\u5141\u8a31\u60a8\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5728\u55ae\u7368\u7684\u9805\u76ee\u4e2d\u90e8\u7f72\u5176\u4ed6 Windows \u5de5\u4f5c\u8ca0\u8f09\uff0c\u8b93\u5b83\u5011\u4f7f\u7528\u5171\u4eab VPC \u7db2\u7d61\u548c Active Directory \u6797\u3002\n- \u5c07 Active Directory \u6797\u8207\u73fe\u6709\u672c\u5730\u6797\u96c6\u6210\u4ee5\u5be6\u73fe [\u8cc7\u6e90\u6797\u6a21\u5f0f](https://cloud.google.com/solutions/patterns-for-using-active-directory-in-a-hybrid-environment?hl=zh-cn#resource_forest) \u3002\n **\u6ce8\u610f** \uff1a\u672c\u6307\u5357\u4ecb\u7d39\u5982\u4f55\u90e8\u7f72\u60a8\u81ea\u884c\u7ba1\u7406\u5176\u7db2\u57df\u63a7\u5236\u5668\u7684 Active Directory \u6797\u3002\u8003\u616e\u4f7f\u7528\u4ee3\u7ba1\u5f0f AD \u4f86\u90e8\u7f72\u5168\u4ee3\u7ba1\u5f0f Active Directory \u6797\uff0c\u9664\u975e\u60a8\u7684\u67d0\u4e9b\u8981\u6c42\u7121\u6cd5\u4f7f\u7528\u4ee3\u7ba1\u5f0f AD \u4f86\u6eff\u8db3\u3002## \u6e96\u5099\u5de5\u4f5c\u8981\u6309\u7167\u672c\u6307\u5357\u4e2d\u7684\u8aaa\u660e\u9032\u884c\u64cd\u4f5c\uff0c\u8acb\u78ba\u4fdd\u6eff\u8db3\u4ee5\u4e0b\u689d\u4ef6\uff1a- \u5169\u500b\u5b50\u7db2\u7684\u5b50\u7db2 CIDR \u7bc4\u570d\uff1a- **\u7db2\u57df\u63a7\u5236\u5668\u5b50\u7db2** \u3002\u6b64\u5b50\u7db2\u5305\u542b\u7db2\u57df\u63a7\u5236\u5668\u3002\u5728\u7ba1\u7406\u9632\u706b\u7246\u898f\u5247\u6216\u5206\u6790\u7db2\u7d61\u65e5\u8a8c\u6642\uff0c\u7232\u7db2\u57df\u63a7\u5236\u5668\u4f7f\u7528\u5c08\u7528\u5b50\u7db2\u6709\u52a9\u65bc\u5340\u5206\u7db2\u57df\u63a7\u5236\u5668\u6d41\u91cf\u8207\u5176\u4ed6\u670d\u52d9\u5668\u6d41\u91cf\u3002\u5efa\u8b70\u4f7f\u7528\u5927\u5c0f\u7232 `/28` \u6216 `/29` \u7684\u5b50\u7db2 CIDR \u7bc4\u570d\u3002\n- **\u8cc7\u6e90\u5b50\u7db2** \u3002\u6b64\u5b50\u7db2\u5305\u542b\u670d\u52d9\u5668\u548c\u7ba1\u7406\u5de5\u4f5c\u7ad9\u3002 \u4f7f\u7528\u8db3\u5920\u5927\u7684\u5b50\u7db2 CIDR \u7bc4\u570d\uff0c\u4ee5\u5bb9\u7d0d\u60a8\u8a08\u5283\u90e8\u7f72\u7684\u6240\u6709\u670d\u52d9\u5668\u3002\n\u78ba\u4fdd\u60a8\u7684\u5b50\u7db2\u4e0d\u8207\u4efb\u4f55\u672c\u5730\u5b50\u7db2\u91cd\u758a\uff0c\u4e26\u7559\u51fa\u8db3\u5920\u7684\u589e\u9577\u7a7a\u9593\u3002\n- Active Directory \u6797\u6839\u7db2\u57df\u7684 DNS \u57df\u540d\u548c NetBIOS \u57df\u540d\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u9078\u64c7\u540d\u7a31\uff0c\u8acb\u53c3\u95b1 [Microsoft \u547d\u540d\u6163\u4f8b](https://support.microsoft.com/en-us/help/909264/naming-conventions-in-active-directory-for-computers-domains-sites-and) \u3002\n## \u90e8\u7f72\u5171\u4eab\u7db2\u7d61\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u4e00\u500b\u65b0\u9805\u76ee\uff0c\u4e26\u4f7f\u7528\u8a72\u9805\u76ee\u90e8\u7f72\u5171\u4eab VPC \u7db2\u7d61\u3002\u7a0d\u5f8c\uff0c\u60a8\u5c07\u4f7f\u7528\u6b64\u7db2\u7d61\u90e8\u7f72 Active Directory \u7db2\u57df\u63a7\u5236\u5668\u3002\n### \u5275\u5efa\u9805\u76ee\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa\u4e00\u500b\u65b0\u9805\u76ee\u4e26\u4f7f\u7528\u5b83\u4f86\u90e8\u7f72\u5171\u4eab VPC \u7db2\u7d61\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud Console \u4e2d\u7684\u9805\u76ee\u9078\u64c7\u5668\u9801\u9762\u4e0a\uff0c\u9078\u64c7\u6216 [\u5275\u5efa\u4e00\u500b Google Cloud \u9805\u76ee](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn) \u3002 [\u8f49\u5230\u201c\u9805\u76ee\u9078\u64c7\u5668\u201d](https://console.cloud.google.com/projectselector2/home/dashboard?hl=zh-cn) \n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- [\u78ba\u4fdd\u60a8\u7684 Google Cloud \u9805\u76ee\u5df2\u5553\u7528\u7d50\u7b97\u529f\u80fd](https://cloud.google.com/billing/docs/how-to/verify-billing-enabled?hl=zh-cn#console) \u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5553\u7528 Compute Engine and Cloud DNS API\u3002 [\u5553\u7528 API](https://console.cloud.google.com/flows/enableapi?apiid=compute.googleapis.com%2Cdns.googleapis.com&hl=zh-cn) \u5982\u9700\u7372\u5f97\u90e8\u7f72\u5171\u4eab\u7db2\u7d61\u6240\u9700\u7684\u6b0a\u9650\uff0c\u8acb\u8b93\u60a8\u7684\u7ba1\u7406\u54e1\u7232\u60a8\u6388\u4e88\u9805\u76ee\u6216\u7236\u7d1a\u6587\u4ef6\u593e\u7684\u4ee5\u4e0b IAM \u89d2\u8272\uff1a- [Compute Network Admin](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#compute.networkAdmin) (`roles/compute.networkAdmin`)\n- [Compute Security Admin](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#compute.securityAdmin) (`roles/compute.securityAdmin`)\n- [Compute Shared VPC Admin](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#compute.xpnAdmin) (`roles/compute.xpnAdmin`)\n- [DNS Administrator](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#dns.admin) (`roles/dns.admin`)\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u6388\u4e88\u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [\u7ba1\u7406\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/iam/docs/granting-changing-revoking-access?hl=zh-cn) \u3002\n\u60a8\u4e5f\u53ef\u4ee5\u901a\u904e [\u81ea\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/creating-custom-roles?hl=zh-cn) \u6216\u5176\u4ed6 [\u9810\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn) \u4f86\u7372\u53d6\u6240\u9700\u7684\u6b0a\u9650\u3002\n### \u522a\u9664\u9ed8\u8a8d VPC\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cCompute Engine \u6703\u5728\u60a8\u5275\u5efa\u7684\u6bcf\u500b\u65b0\u9805\u76ee\u4e2d\u5275\u5efa\u9ed8\u8a8d\u7db2\u7d61\u3002\u6b64\u7db2\u7d61\u63a1\u7528 [\u81ea\u52d5\u6a21\u5f0f](https://cloud.google.com/vpc/docs/vpc?hl=zh-cn#subnet-ranges) \u9032\u884c\u914d\u7f6e\uff0c\u9019\u610f\u5473\u7740\u7cfb\u7d71\u7232\u6bcf\u500b\u5340\u57df\u9810\u5148\u5206\u914d\u4e00\u500b\u5b50\u7db2\uff0c\u4e26\u81ea\u52d5\u5206\u914d CIDR \u7bc4\u570d\u3002\n\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u9700\u8981\u5c07\u6b64 VPC \u7db2\u7d61\u66ff\u63db\u7232\u5305\u542b\u5169\u500b\u5b50\u7db2\u4e26\u4f7f\u7528\u81ea\u5b9a\u7fa9 CIDR \u7bc4\u570d\u7684 [\u81ea\u5b9a\u7fa9\u6a21\u5f0f](https://cloud.google.com/vpc/docs/vpc?hl=zh-cn#subnet-ranges) \u7db2\u7d61\u3002- \u5728 [Google Cloud \u63a7\u5236\u6aaf](https://console.cloud.google.com?hl=zh-cn) \u4e2d\uff0c\u6253\u958b [Cloud Shell](https://cloud.google.com/shell/docs/overview?hl=zh-cn) \u3002 [\u6fc0\u6d3b Cloud Shell](https://console.cloud.google.com/?cloudshell=true&hl=zh-cn) \n- \u5553\u52d5 PowerShell\uff1a```\npwsh\n```\n- \u914d\u7f6e gcloud CLI \u4ee5\u4f7f\u7528\u65b0\u9805\u76ee\uff1a```\ngcloud config set project PROJECT_ID\n```\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\n- \u522a\u9664\u8207\u9ed8\u8a8d VPC \u95dc\u806f\u7684\u6240\u6709\u9632\u706b\u7246\u898f\u5247\uff1a```\n$ProjectId = gcloud config get-value core/project\n& gcloud compute firewall-rules list `\n --filter \"network=default\" `\n --format \"value(name)\" |\n % { gcloud compute firewall-rules delete --quiet $_ --project $ProjectId }\n```\n- \u522a\u9664\u9ed8\u8a8d VPC\uff1a```\n& gcloud compute networks list --format \"value(name)\" |\n % { gcloud compute networks delete $_ --quiet }\n```\n### \u5275\u5efa\u4e00\u500b\u81ea\u5b9a\u7fa9\u6a21\u5f0f VPC \u7db2\u7d61\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u5728 VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u5275\u5efa [\u81ea\u5b9a\u7fa9\u6a21\u5f0f](https://cloud.google.com/vpc/docs/vpc?hl=zh-cn#subnet-ranges) VPC \u7db2\u7d61\u3002- \u5728 PowerShell \u4e2d\uff0c\u521d\u59cb\u5316\u4ee5\u4e0b\u8b8a\u91cf\uff1a```\n$VpcName = \"VPC_NAME\"\n$Region = \"REGION\"\n$SubnetRangeDomainControllers = \"DC_CIDR\"\n$SubnetRangeResources = \"RESOURCES_CIDR\"\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1aVPC \u7684\u540d\u7a31\u3002\n- ``\uff1a\u8981\u5728\u5176\u4e2d\u90e8\u7f72 Active Directory \u7db2\u57df\u63a7\u5236\u5668\u7684\u5340\u57df\u3002\n- ``\uff1a\u7528\u65bc\u7db2\u57df\u63a7\u5236\u5668\u5b50\u7db2\u7684\u5b50\u7db2\u7bc4\u570d\u3002\n- ``\uff1a\u8cc7\u6e90\u5b50\u7db2\u7684\u5b50\u7db2\u7bc4\u570d\u3002\n\u793a\u4f8b\uff1a```\n$VpcName = \"ad\"\n$Region = \"us-central1\"\n$SubnetRangeDomainControllers = \"10.0.0.0/28\"\n$SubnetRangeResources = \"10.0.1.0/24\"\n```\n- \u5275\u5efa VPC \u4e26\u5c07\u5176\u914d\u7f6e\u7232\u7528\u4f5c [\u5171\u4eab VPC](https://cloud.google.com/vpc/docs/shared-vpc?hl=zh-cn) \u7db2\u7d61\uff1a```\n$ProjectId = gcloud config get-value core/project\n& gcloud compute networks create $VpcName --subnet-mode custom\n& gcloud compute shared-vpc enable $ProjectId\n```\n- \u5275\u5efa\u5b50\u7db2\u4e26\u5553\u7528 [\u5c08\u7528 Google \u8a2a\u554f\u901a\u9053](https://cloud.google.com/vpc/docs/configure-private-google-access?hl=zh-cn) \uff0c\u4ee5\u4fbf Windows \u53ef\u4ee5\u5728\u6c92\u6709\u9023\u63a5\u4e92\u806f\u7db2\u7684\u60c5\u6cc1\u4e0b [\u6fc0\u6d3b](https://cloud.google.com/compute/docs/instances/windows/creating-managing-windows-instances?hl=zh-cn#internal_ip_activation) \u3002```\n& gcloud compute networks subnets create domain-controllers `\n --network $VpcName `\n --range $SubnetRangeDomainControllers `\n --region $Region `\n --enable-private-ip-google-access\n& gcloud compute networks subnets create resources `\n --network $VpcName `\n --range $SubnetRangeResources `\n --region $Region `\n --enable-private-ip-google-access\n```\n### \u90e8\u7f72\u5b50\u7db2\u548c\u9632\u706b\u7246\u898f\u5247\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa\u9632\u706b\u7246\u898f\u5247\u4ee5\u5141\u8a31\u5728 VPC \u5167\u9032\u884c Active Directory \u901a\u4fe1\u3002- \u5141\u8a31\u901a\u904e [Cloud IAP TCP \u8f49\u767c](https://cloud.google.com/iap/docs/using-tcp-forwarding?hl=zh-cn#create-firewall-rule) \u8207\u6240\u6709\u865b\u64ec\u6a5f\u5be6\u4f8b\u5efa\u7acb RDP \u9023\u63a5\uff1a```\n& gcloud compute firewall-rules create allow-rdp-ingress-from-iap `\n --direction INGRESS `\n --action allow `\n --rules tcp:3389 `\n --enable-logging `\n --source-ranges 35.235.240.0/20 `\n --network $VpcName `\n --priority 10000\n```\n- \u5141\u8a31\u5f9e Cloud DNS \u5230\u7db2\u57df\u63a7\u5236\u5668\u7684 DNS \u67e5\u8a62\u3002```\n& gcloud compute firewall-rules create allow-dns-ingress-from-clouddns `\n --direction INGRESS `\n --action=allow `\n --rules udp:53,tcp:53 `\n --enable-logging `\n --source-ranges 35.199.192.0/19 `\n --target-tags ad-domaincontroller `\n --network $VpcName `\n --priority 10000\n```\u8981\u4f7f\u5c08\u7528 DNS \u8f49\u767c\u53ef\u7528\u5340\u6b63\u5e38\u5de5\u4f5c\uff0c\u5fc5\u9808\u4f7f\u7528\u6b64\u9632\u706b\u7246\u898f\u5247\u3002\n- \u5141\u8a31\u5728\u7db2\u57df\u63a7\u5236\u5668\u4e4b\u9593\u8907\u88fd Active Directory\uff1a```\n& gcloud compute firewall-rules create allow-replication-between-addc `\n --direction INGRESS `\n --action allow `\n --rules \"icmp,tcp:53,udp:53,tcp:88,udp:88,udp:123,tcp:135,tcp:389,udp:389,tcp:445,udp:445,tcp:49152-65535\" `\n --enable-logging `\n --source-tags ad-domaincontroller `\n --target-tags ad-domaincontroller `\n --network $VpcName `\n --priority 10000\n```\n- \u5141\u8a31 Active Directory \u5f9e\u8cc7\u6e90\u5b50\u7db2\u4e2d\u7684\u865b\u64ec\u6a5f\u767b\u9304\u7db2\u57df\u63a7\u5236\u5668\uff1a```\n& gcloud compute firewall-rules create allow-logon-ingress-to-addc `\n --direction INGRESS `\n --action allow `\n --rules \"icmp,tcp:53,udp:53,tcp:88,udp:88,udp:123,tcp:135,tcp:389,udp:389,tcp:445,udp:445,tcp:464,udp:464,tcp:3268,udp:3268,tcp:9389,tcp:49152-65535\" `\n --enable-logging `\n --source-ranges $SubnetRangeResources `\n --target-tags ad-domaincontroller `\n --network $VpcName `\n --priority 10000\n```\n- \u5982\u679c\u60a8\u6253\u7b97\u914d\u7f6e\u5b89\u5168 LDAP\uff0c\u8acb\u5141\u8a31\u5f9e\u8cc7\u6e90\u5b50\u7db2\u4e2d\u7684\u865b\u64ec\u6a5f\u5230\u7db2\u57df\u63a7\u5236\u5668\u7684\u5b89\u5168 LDAP \u9023\u63a5\uff1a```\n& gcloud compute firewall-rules create allow-ldaps-ingress-to-addc `\n --direction INGRESS `\n --action allow `\n --rules tcp:636 `\n --enable-logging `\n --source-ranges $SubnetRangeResources `\n --target-tags ad-domaincontroller `\n --network $VpcName `\n --priority 10000\n```\u53ea\u6709\u5728\u60a8\u8a08\u5283\u914d\u7f6e\u5b89\u5168 LDAP \u6642\uff0c\u624d\u9700\u8981\u6b64\u9632\u706b\u7246\u898f\u5247\u3002\n- \uff08\u53ef\u9078\uff09\u5275\u5efa\u8a18\u9304\u6240\u6709\u5931\u6557\u8a2a\u554f\u5617\u8a66\u7684\u9632\u706b\u7246\u898f\u5247\u3002\u9019\u4e9b\u65e5\u8a8c\u53ef\u7528\u65bc\u8a3a\u65b7\u9023\u63a5\u554f\u984c\uff0c\u4f46\u53ef\u80fd\u6703\u7522\u751f\u5927\u91cf\u65e5\u8a8c\u6578\u64da\u3002```\n& gcloud compute firewall-rules create deny-ingress-from-all `\n --direction INGRESS `\n --action deny `\n --rules tcp:0-65535,udp:0-65535 `\n --enable-logging `\n --source-ranges 0.0.0.0/0 `\n --network $VpcName `\n --priority 65000\n```\n## \u90e8\u7f72 Active Directory \u6797\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u4e00\u500b\u65b0\u7684\u670d\u52d9\u9805\u76ee\uff0c\u4e26\u5c07\u5176\u95dc\u806f\u5230\u60a8\u4e4b\u524d\u5275\u5efa\u7684\u5171\u4eab VPC \u5bbf\u4e3b\u9805\u76ee\u3002\u7136\u5f8c\uff0c\u4f7f\u7528\u670d\u52d9\u9805\u76ee\u90e8\u7f72\u5177\u6709\u5169\u500b\u7db2\u57df\u63a7\u5236\u5668\u7684\u65b0 Active Directory \u6797\u3002\n### \u5275\u5efa\u9805\u76ee\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa\u4e00\u500b\u65b0\u9805\u76ee\u4e26\u4f7f\u7528\u5b83\u4f86\u90e8\u7f72 Active Directory \u57df\u63a7\u5236\u5668\u865b\u64ec\u6a5f\u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud Console \u4e2d\u7684\u9805\u76ee\u9078\u64c7\u5668\u9801\u9762\u4e0a\uff0c\u9078\u64c7\u6216 [\u5275\u5efa\u4e00\u500b Google Cloud \u9805\u76ee](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn) \u3002 [\u8f49\u5230\u201c\u9805\u76ee\u9078\u64c7\u5668\u201d](https://console.cloud.google.com/projectselector2/home/dashboard?hl=zh-cn) \n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- [\u78ba\u4fdd\u60a8\u7684 Google Cloud \u9805\u76ee\u5df2\u5553\u7528\u7d50\u7b97\u529f\u80fd](https://cloud.google.com/billing/docs/how-to/verify-billing-enabled?hl=zh-cn#console) \u3002\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5553\u7528 Compute Engine and Secret Manager API\u3002 [\u5553\u7528 API](https://console.cloud.google.com/flows/enableapi?apiid=compute.googleapis.com%2Csecretmanager.googleapis.com&hl=zh-cn) \u5982\u9700\u7372\u5f97\u90e8\u7f72 Active Directory \u6797\u6240\u9700\u7684\u6b0a\u9650\uff0c\u8acb\u8b93\u60a8\u7684\u7ba1\u7406\u54e1\u7232\u60a8\u6388\u4e88\u9805\u76ee\u7684\u4ee5\u4e0b IAM \u89d2\u8272\uff1a- [Compute Instance Admin (v1) ](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#compute.instanceAdmin.v1) (`roles/compute.instanceAdmin.v1`)\n- [Service Account Admin](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#iam.serviceAccountAdmin) (`roles/iam.serviceAccountAdmin`)\n- [Service Account User ](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#iam.serviceAccountUser) (`roles/iam.serviceAccountUser`)\n- [Secret Manager Admin ](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#secretmanager.admin) (`roles/secretmanager.admin`)\n- [IAP-secured Tunnel User](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn#iap.tunnelResourceAccessor) (`roles/iap.tunnelResourceAccessor`)\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u6388\u4e88\u89d2\u8272\uff0c\u8acb\u53c3\u95b1 [\u7ba1\u7406\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/iam/docs/granting-changing-revoking-access?hl=zh-cn) \u3002\n\u60a8\u4e5f\u53ef\u4ee5\u901a\u904e [\u81ea\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/creating-custom-roles?hl=zh-cn) \u6216\u5176\u4ed6 [\u9810\u5b9a\u7fa9\u89d2\u8272](https://cloud.google.com/iam/docs/understanding-roles?hl=zh-cn) \u4f86\u7372\u53d6\u6240\u9700\u7684\u6b0a\u9650\u3002\n### \u6e96\u5099\u914d\u7f6e\u4e0b\u4e00\u6b65\u662f\u6e96\u5099 Active Directory \u90e8\u7f72\u7684\u914d\u7f6e\u3002- \u5982\u679c\u60a8\u4e4b\u524d\u95dc\u9589\u4e86 PowerShell \u6703\u8a71\uff0c\u8acb\u6253\u958b [Cloud Shell](https://cloud.google.com/shell/docs/overview?hl=zh-cn) \u3002 [\u6fc0\u6d3b Cloud Shell](https://console.cloud.google.com/?cloudshell=true&hl=zh-cn) \n- \u5553\u52d5 PowerShell\uff1a```\npwsh\n```\n- \u914d\u7f6e gcloud CLI \u4ee5\u4f7f\u7528\u65b0\u9805\u76ee\uff1a```\ngcloud config set project DC_PROJECT_ID\n```\u5c07 \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\u3002\n- \u4f7f\u7528 PowerShell \u5275\u5efa\u4ee5\u4e0b\u8b8a\u91cf\uff1a```\n$AdDnsDomain = \"DNS_DOMAIN\"\n$AdNetbiosDomain = \"NETBIOS_DOMAIN\"\n$VpcProjectId = \"VPCHOST_PROJECT_ID\"\n$VpcName = \"VPC_NAME\"\n$Region = \"REGION\"\n$Zones = \"REGION-a\", \"REGION-b\"\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1aActive Directory \u6797\u7684\u6797\u6839\u57df\u540d\uff0c\u4f8b\u5982`cloud.example.com`\u3002\n- ``\uff1a\u6797\u6839\u7db2\u57df\u7684 NetBIOS \u57df\u540d\uff0c\u4f8b\u5982`CLOUD`\u3002\n- ``\uff1a\u60a8\u4e4b\u524d\u5275\u5efa\u7684 VPC \u5bbf\u4e3b\u9805\u76ee\u7684 ID\u3002\n- ``\uff1a\u60a8\u4e4b\u524d\u5275\u5efa\u7684\u5171\u4eab VPC \u7db2\u7d61\u7684\u540d\u7a31\u3002\n- ``\uff1a\u8981\u5728\u5176\u4e2d\u90e8\u7f72 Active Directory \u7db2\u57df\u63a7\u5236\u5668\u7684\u5340\u57df\u3002\u8acb\u6ce8\u610f\uff0c\u53ef\u7528\u5340\u7684\u540d\u7a31\u57fa\u65bc\u60a8\u6307\u5b9a\u7684\u5340\u57df\u7684\u540d\u7a31\u3002\u60a8\u53ef\u4ee5\u96a8\u6642\u64f4\u5c55 VPC \u548c\u7db2\u57df\u4ee5\u8986\u84cb\u5176\u4ed6\u5340\u57df\u3002\n\u793a\u4f8b\uff1a```\n$AdDnsDomain = \"cloud.example.com\"\n$AdNetbiosDomain = \"CLOUD\"\n$VpcProjectId = \"vpc-project-123\"\n$VpcName = \"ad\"\n$Region = \"us-west1\"\n$Zones = \"us-west1-a\", \"us-west1-b\"\n```\n### \u5275\u5efa\u5c08\u7528 DNS \u8f49\u767c\u53ef\u7528\u5340\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u7232\u7db2\u57df\u63a7\u5236\u5668\u9810\u7559\u5169\u500b\u975c\u614b IP \u5730\u5740\uff0c\u4e26\u5275\u5efa\u4e00\u500b [\u5c08\u7528 DNS \u8f49\u767c\u53ef\u7528\u5340](https://cloud.google.com/dns/docs/overview?hl=zh-cn#dns-forwarding-zones) \uff0c\u4ee5\u5c07 Active Directory \u7db2\u57df\u7684\u6240\u6709 DNS \u67e5\u8a62\u8f49\u767c\u5230\u9019\u4e9b IP \u5730\u5740\u3002- \u5c07\u9805\u76ee\u9023\u63a5\u5230\u5171\u4eab VPC \u7db2\u7d61\uff1a```\n$ProjectId = gcloud config get-value core/project\n& gcloud compute shared-vpc associated-projects add $ProjectId --host-project $VpcProjectId\n```\n- \u5728\u7db2\u57df\u63a7\u5236\u5668\u5b50\u7db2\u4e2d\u9810\u7559\u5169\u500b\u975c\u614b\u5167\u90e8 IP \u5730\u5740\uff1a```\n$AddressOfDc1 = gcloud compute addresses create dc-1 `\n --region $Region `\n --subnet \"projects/$VpcProjectId/regions/$Region/subnetworks/domain-controllers\" `\n --format value`(address`)\n$AddressOfDc2 = gcloud compute addresses create dc-2 `\n --region $Region `\n --subnet \"projects/$VpcProjectId/regions/$Region/subnetworks/domain-controllers\" `\n --format value`(address`)\n```\n- \u5728 VPC \u5bbf\u4e3b\u9805\u76ee\u4e2d\u5275\u5efa Cloud DNS [\u5c08\u7528\u8f49\u767c\u53ef\u7528\u5340](https://cloud.google.com/dns/docs/overview?hl=zh-cn#dns-forwarding) \uff0c\u4e26\u5c07\u53ef\u7528\u5340\u914d\u7f6e\u7232\u5c07 DNS \u67e5\u8a62\u8f49\u767c\u5230\u5169\u500b\u9810\u7559\u7684 IP \u5730\u5740\uff1a```\n& gcloud dns managed-zones create $AdDnsDomain.Replace(\".\", \"-\") `\n --project $VpcProjectId `\n --dns-name $AdDnsDomain `\n --description \"Active Directory forwarding zone\" `\n --networks $VpcName `\n --visibility private `\n --forwarding-targets \"$AddressOfDc1,$AddressOfDc2\"\n```\n### \u5275\u5efa DSRM \u5bc6\u78bc\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u5b9a\u7fa9 [Directory Service Restore Mode](https://support.microsoft.com/en-us/help/322672/how-to-reset-the-directory-services-restore-mode-administrator-account) (DSRM) \u5bc6\u78bc\uff0c\u4e26\u5c07\u5176\u5b58\u5132\u5728 [Secret Manager](https://cloud.google.com/secret-manager?hl=zh-cn) \u4e2d\u3002\u7136\u5f8c\uff0c\u5411\u7db2\u57df\u63a7\u5236\u5668\u865b\u64ec\u6a5f\u6388\u4e88\u5c0d\u6b64 Secret \u7684\u81e8\u6642\u8a2a\u554f\u6b0a\u9650\uff0c\u4ee5\u4fbf\u4ed6\u5011\u53ef\u4ee5\u4f7f\u7528\u5b83\u4f86\u90e8\u7f72 Active Directory \u6797\u3002- \u751f\u6210\u96a8\u6a5f\u5bc6\u78bc\u4e26\u5c07\u5176\u5b58\u5132\u5728 Secret Manager Secret \u4e2d\uff1a```\n# Generate a random password.\n$DsrmPassword = [Guid]::NewGuid().ToString()+\"-\"+[Guid]::NewGuid().ToString()\n$TempFile = New-TemporaryFile\nSet-Content $TempFile \"$DsrmPassword\" -NoNewLine\n& gcloud secrets create ad-password --data-file $TempFile\nRemove-Item $TempFile\n```\n- \u7232\u7db2\u57df\u63a7\u5236\u5668\u865b\u64ec\u6a5f\u5be6\u4f8b\u5275\u5efa\u670d\u52d9\u8cec\u865f\uff1a```\n$DcServiceAccount = gcloud iam service-accounts create ad-domaincontroller `\n --display-name \"AD Domain Controller\" `\n --format \"value(email)\"\n```\n- \u6388\u4e88\u670d\u52d9\u8cec\u865f\u8b80\u53d6\u4e0b\u4e00\u500b\u5c0f\u6642\u5167\u7684 Secret \u7684\u6b0a\u9650\uff1a```\n$Expiry = [DateTime]::UtcNow.AddHours(1).ToString(\"o\")\n& gcloud secrets add-iam-policy-binding ad-password `\n --member=serviceAccount:$($DcServiceAccount) `\n --role=roles/secretmanager.secretAccessor `\n --condition=\"title=Expires after 1h,expression=request.time < timestamp('$Expiry')\"\n```\n### \u90e8\u7f72\u7db2\u57df\u63a7\u5236\u5668\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u90e8\u7f72\u5169\u500b\u865b\u64ec\u6a5f\u5be6\u4f8b\u4e26\u5275\u5efa\u65b0\u7684 Active Directory \u6797\u548c\u7db2\u57df\u3002\u8981\u6700\u5927\u9650\u5ea6\u5730\u6e1b\u5c11\u624b\u52d5\u6b65\u9a5f\uff0c\u8acb\u4f7f\u7528 [\u5553\u52d5\u8173\u672c](https://cloud.google.com/compute/docs/startupscript?hl=zh-cn) \u3002- \u5728 PowerShell \u4e2d\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u751f\u6210\u5553\u52d5\u8173\u672c\uff1a```\n'\n$ErrorActionPreference = \"Stop\"\n#\n# Only run the script if the VM is not a domain controller already.\n#\nif ((Get-CimInstance -ClassName Win32_OperatingSystem).ProductType -eq 2) {\n exit\n}\n#\n# Read configuration from metadata.\n#\nImport-Module \"${Env:ProgramFiles}\\Google\\Compute Engine\\sysprep\\gce_base.psm1\"\n$ActiveDirectoryDnsDomain  = Get-MetaData -Property \"attributes/ActiveDirectoryDnsDomain\" -instance_only\n$ActiveDirectoryNetbiosDomain = Get-MetaData -Property \"attributes/ActiveDirectoryNetbiosDomain\" -instance_only\n$ActiveDirectoryFirstDc  = Get-MetaData -Property \"attributes/ActiveDirectoryFirstDc\" -instance_only\n$ProjectId     = Get-MetaData -Property \"project-id\" -project_only\n$Hostname      = Get-MetaData -Property \"hostname\" -instance_only\n$AccessToken     = (Get-MetaData -Property \"service-accounts/default/token\" | ConvertFrom-Json).access_token\n#\n# Read the DSRM password from secret manager.\n#\n$Secret = (Invoke-RestMethod `\n -Headers @{\n  \"Metadata-Flavor\" = \"Google\";\n  \"x-goog-user-project\" = $ProjectId;\n  \"Authorization\" = \"Bearer $AccessToken\"} `\n -Uri \"https://secretmanager.googleapis.com/v1/projects/$ProjectId/secrets/ad-password/versions/latest:access\")\n$DsrmPassword = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($Secret.payload.data))\n$DsrmPassword = ConvertTo-SecureString -AsPlainText $DsrmPassword -force\n#\n# Promote.\n#\nWrite-Host \"Setting administrator password...\"\nSet-LocalUser -Name Administrator -Password $DsrmPassword\nif ($ActiveDirectoryFirstDc -eq $env:COMPUTERNAME) {\n Write-Host \"Creating a new forest $ActiveDirectoryDnsDomain ($ActiveDirectoryNetbiosDomain)...\"\n Install-ADDSForest `\n  -DomainName $ActiveDirectoryDnsDomain `\n  -DomainNetbiosName $DomainNetbiosName `\n  -SafeModeAdministratorPassword $DsrmPassword `\n  -DomainMode Win2008R2 `\n  -ForestMode Win2008R2 `\n  -InstallDns `\n  -CreateDnsDelegation:$False `\n  -NoRebootOnCompletion:$True `\n  -Confirm:$false\n}\nelse {\n do {\n  Write-Host \"Waiting for domain to become available...\"\n  Start-Sleep -s 60\n  & ipconfig /flushdns | Out-Null\n  & nltest /dsgetdc:$ActiveDirectoryDnsDomain | Out-Null\n } while ($LASTEXITCODE -ne 0)\n Write-Host \"Adding DC to $ActiveDirectoryDnsDomain ($ActiveDirectoryNetbiosDomain)...\"\n Install-ADDSDomainController `\n  -DomainName $ActiveDirectoryDnsDomain `\n  -SafeModeAdministratorPassword $DsrmPassword `\n  -InstallDns `\n  -Credential (New-Object System.Management.Automation.PSCredential (\"Administrator@$ActiveDirectoryDnsDomain\", $DsrmPassword)) `\n  -NoRebootOnCompletion:$true `\n  -Confirm:$false\n}\n#\n# Configure DNS.\n#\nWrite-Host \"Configuring DNS settings...\"\nGet-Netadapter| Disable-NetAdapterBinding -ComponentID ms_tcpip6\nSet-DnsClientServerAddress `\n -InterfaceIndex (Get-NetAdapter -Name Ethernet).InterfaceIndex `\n -ServerAddresses 127.0.0.1\n#\n# Enable LSA protection.\n#\nNew-ItemProperty `\n -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\" `\n -Name \"RunAsPPL\" `\n -Value 1 `\n -PropertyType DWord\nWrite-Host \"Restarting to apply all settings...\"\nRestart-Computer\n' | Out-File dc-startup.ps1 -Encoding ASCII\n```\u8a72\u8173\u672c\u5c07\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5f9e Secret Manager \u8b80\u53d6 DSRM \u5bc6\u78bc\u3002\n- \u5c07\u865b\u64ec\u6a5f\u5347\u7d1a\u7232\u7db2\u57df\u63a7\u5236\u5668\u3002\n- \u914d\u7f6e DNS \u8a2d\u7f6e\uff0c\u4ee5\u4f7f\u6bcf\u500b\u7db2\u57df\u63a7\u5236\u5668 [\u4f7f\u7528\u74b0\u56de\u5730\u5740](https://cloud.google.com/managed-microsoft-ad/docs/best-practices?hl=zh-cn#use_cloud_dns_private_forwarding_zones) \u4f5c\u7232 DNS \u670d\u52d9\u5668\u3002\n- \u505c\u7528 IPv6\u3002\n- \u5553\u7528 [LSA \u4fdd\u8b77](https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/configuring-additional-lsa-protection) \u3002\n- \u7232\u7b2c\u4e00\u500b\u7db2\u57df\u63a7\u5236\u5668\u5275\u5efa\u4e00\u500b\u865b\u64ec\u6a5f\u5be6\u4f8b\uff1a```\n$Subnet = \"projects/$VpcProjectId/regions/$Region/subnetworks/domain-controllers\"\n$Metadata = `\n \"ActiveDirectoryDnsDomain=$AdDnsDomain\",\n \"ActiveDirectoryNetbiosDomain=$AdNetbiosDomain\",\n \"ActiveDirectoryFirstDc=dc-1\",\n \"sysprep-specialize-script-ps1=Install-WindowsFeature AD-Domain-Services; Install-WindowsFeature DNS\",\n \"disable-account-manager=true\" -join \",\"\n& gcloud compute instances create dc-1 `\n --image-family windows-2022 `\n --image-project windows-cloud `\n --machine-type n2-standard-8 `\n --tags ad-domaincontroller `\n --metadata \"$Metadata\" `\n --metadata-from-file windows-startup-script-ps1=dc-startup.ps1 `\n --no-address `\n --network-interface \"no-address,private-network-ip=$AddressOfDc1,subnet=$Subnet\" `\n --service-account $DcServiceAccount `\n --scopes cloud-platform `\n --zone $Zones[0] `\n --shielded-integrity-monitoring `\n --shielded-secure-boot `\n --shielded-vtpm `\n --deletion-protection\n```\u6b64\u547d\u4ee4\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5275\u5efa [\u5b89\u5168\u5f37\u5316\u578b](https://cloud.google.com/shielded-vm?hl=zh-cn) Windows Server 2022 \u865b\u64ec\u6a5f\u3002\n- \u5c07`ad-domaincontroller`\u670d\u52d9\u8cec\u865f\u5206\u914d\u7d66\u865b\u64ec\u6a5f\uff0c\u4ee5\u4fbf\u5b83\u53ef\u4ee5\u8a2a\u554f DSRM \u5bc6\u78bc\u3002\n- \u914d\u7f6e\u5ba2\u6a5f\u4ee3\u7406\u4ee5\u505c\u7528\u8cec\u865f\u7ba1\u7406\u5668\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u914d\u7f6e\u5ba2\u6a5f\u4ee3\u7406\uff0c\u8acb\u53c3\u95b1 [\u5553\u7528\u548c\u505c\u7528 Windows \u5be6\u4f8b\u529f\u80fd](https://cloud.google.com/compute/docs/instances/windows/creating-managing-windows-instances?hl=zh-cn#configure-windows-features) \u3002\n- \u5728 sysprep \u5c08\u7528\u968e\u6bb5\u4e2d\uff0c\u8b93\u865b\u64ec\u6a5f\u5b89\u88dd Windows \u529f\u80fd`AD-Domain-Services`\u548c`DNS`\u3002\n- \u8b93\u865b\u64ec\u6a5f\u904b\u884c\u60a8\u4e4b\u524d\u5275\u5efa\u7684\u5553\u52d5\u8173\u672c\u3002\n- \u7232\u7b2c\u4e8c\u500b\u7db2\u57df\u63a7\u5236\u5668\u5275\u5efa\u53e6\u4e00\u500b\u865b\u64ec\u6a5f\u5be6\u4f8b\uff0c\u4e26\u5c07\u5176\u653e\u7f6e\u5728\u5176\u4ed6\u53ef\u7528\u5340\u4e2d\uff1a```\n& gcloud compute instances create dc-2 `\n --image-family windows-2022 `\n --image-project windows-cloud `\n --machine-type n2-standard-8 `\n --tags ad-domaincontroller `\n --metadata \"$Metadata\" `\n --metadata-from-file windows-startup-script-ps1=dc-startup.ps1 `\n --no-address `\n --network-interface \"no-address,private-network-ip=$AddressOfDc2,subnet=$Subnet\" `\n --service-account $DcServiceAccount `\n --scopes cloud-platform `\n --zone $Zones[1] `\n --shielded-integrity-monitoring `\n --shielded-secure-boot `\n --shielded-vtpm `\n --deletion-protection\n```\n- \u901a\u904e\u67e5\u770b\u7b2c\u4e00\u500b\u7db2\u57df\u63a7\u5236\u5668\u7684\u4e32\u884c\u7aef\u53e3\u8f38\u51fa\u4f86\u76e3\u63a7\u5176\u521d\u59cb\u5316\u904e\u7a0b\uff1a```\n& gcloud compute instances tail-serial-port-output dc-1 --zone $Zones[0]\n```\u7b49\u5f85\u5927\u7d04 10 \u5206\u9418\uff0c\u76f4\u5230\u60a8\u770b\u5230\u6d88\u606f `Restarting to apply all settings...` \uff0c\u7136\u5f8c\u6309 `Ctrl+C` \u3002\n- \u901a\u904e\u67e5\u770b\u7b2c\u4e8c\u500b\u7db2\u57df\u63a7\u5236\u5668\u7684\u4e32\u884c\u7aef\u53e3\u8f38\u51fa\u4f86\u76e3\u63a7\u5176\u521d\u59cb\u5316\u904e\u7a0b\uff1a```\n& gcloud compute instances tail-serial-port-output dc-2 --zone $Zones[1]\n```\u7b49\u5f85\u5927\u7d04 10 \u5206\u9418\uff0c\u76f4\u5230\u60a8\u770b\u5230\u6d88\u606f `Restarting to apply all settings...` \uff0c\u7136\u5f8c\u6309 `Ctrl+C` \u3002\nActive Directory \u6797\u548c\u7db2\u57df\u73fe\u5728\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002\n### \u9023\u63a5\u5230\u7db2\u57df\u63a7\u5236\u5668\u73fe\u5728\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u9023\u63a5\u5230\u5176\u4e2d\u4e00\u500b\u7db2\u57df\u63a7\u5236\u5668\u4f86\u81ea\u5b9a\u7fa9 Active Directory \u6797\u3002- \u5728 PowerShell \u4e2d\uff0c\u8a2a\u554f `Administrator` \u7528\u6236\u7684\u5bc6\u78bc\uff1a```\ngcloud secrets versions access latest --secret ad-password\n```\n- [\u4f7f\u7528 RDP \u9023\u63a5\u5230 dc-1](https://cloud.google.com/compute/docs/instances/connecting-to-windows?hl=zh-cn) \uff0c\u7136\u5f8c\u4ee5 `Administrator` \u7528\u6236\u8eab\u4efd\u767b\u9304\u3002\u7531\u65bc\u865b\u64ec\u6a5f\u5be6\u4f8b\u6c92\u6709\u516c\u5171 IP \u5730\u5740\uff0c\u56e0\u6b64\u60a8\u5fc5\u9808\u901a\u904e [Identity-Aware Proxy TCP \u8f49\u767c](https://cloud.google.com/iap/docs/tcp-forwarding-overview?hl=zh-cn) \u9032\u884c\u9023\u63a5\u3002\n## \u5f8c\u7e8c\u6b65\u9a5f\n- \u8a73\u7d30\u77ad\u89e3 [\u5728\u6df7\u5408\u74b0\u5883\u4e2d\u4f7f\u7528 Active Directory \u7684\u6a21\u5f0f](https://cloud.google.com/architecture/patterns-for-using-active-directory-in-a-hybrid-environment?hl=zh-cn) \u3002\n- \u914d\u7f6e [Active Directory \u4ee5\u4f7f\u865b\u64ec\u6a5f\u81ea\u52d5\u52a0\u5165\u7db2\u57df](https://cloud.google.com/solutions/configuring-active-directory-for-vms-to-automatically-join-the-domain?hl=zh-cn) \u3002\n- \u8a73\u7d30\u77ad\u89e3\u5982\u4f55 [\u8de8\u9632\u706b\u7246\u4f7f\u7528 Active Directory](https://cloud.google.com/managed-microsoft-ad/docs/firewalls?hl=zh-cn) \u3002", "guide": "Docs"}