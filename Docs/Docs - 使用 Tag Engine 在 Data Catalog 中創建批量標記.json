{"title": "Docs - \u4f7f\u7528 Tag Engine \u5728 Data Catalog \u4e2d\u5275\u5efa\u6279\u91cf\u6a19\u8a18", "url": "https://cloud.google.com/architecture/tag-engine-and-data-catalog?hl=zh-cn", "abstract": "# Docs - \u4f7f\u7528 Tag Engine \u5728 Data Catalog \u4e2d\u5275\u5efa\u6279\u91cf\u6a19\u8a18\nLast reviewed 2022-11-17 UTC\n\u672c\u6307\u5357\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528 Tag Engine \u5728 [Data Catalog](https://cloud.google.com/data-catalog?hl=zh-cn) \u4e2d\u5275\u5efa\u6279\u91cf\u6a19\u8a18\u3002 \u6279\u91cf\u6a19\u8a18\u662f\u4e00\u8d77\u5275\u5efa\u548c\u66f4\u65b0\u7684\u985e\u4f3c\u6a19\u8a18\u7684\u96c6\u5408\u3002\u6279\u91cf\u5275\u5efa\u6a19\u8a18\u53ef\u4ee5\u6e1b\u5c11\u6a19\u8a18\u7d44\u7e54\u6578\u64da\u8cc7\u7522\u6240\u9700\u7684\u6642\u9593\u548c\u7cbe\u529b\u3002\u672c\u6587\u6a94\u4ecb\u7d39\u4e86 Tag Engine\uff0c\u4e26\u5c55\u793a\u77ad\u5982\u4f55\u4f7f\u7528\u8a72\u5de5\u5177\u5728\u8cc7\u7522\u5177\u6709\u5171\u540c\u5143\u6578\u64da\u5c6c\u6027\u6642\u6a19\u8a18\u8cc7\u7522\u96c6\u5408\u3002\nTag Engine \u662f\u4e00\u7a2e\u958b\u6e90\u5de5\u5177\uff0c\u53ef\u5e6b\u52a9\u60a8\u5275\u5efa [BigQuery](https://cloud.google.com/bigquery?hl=zh-cn) \u548c [Cloud Storage](https://cloud.google.com/storage?hl=zh-cn) \u8cc7\u7522\u7684\u5143\u6578\u64da\u3002\u8a72\u5de5\u5177\u652f\u6301\u586b\u5145\u5177\u6709\u975c\u614b\u5143\u6578\u64da\u6216\u52d5\u614b\u5143\u6578\u64da\u7684\u6a19\u8a18\u3002Tag Engine \u9084\u652f\u6301\u81ea\u52d5\u6a19\u8a18\u65b0\u8cc7\u7522\u4ee5\u53ca\u5728\u5e95\u5c64\u6578\u64da\u8cc7\u7522\u767c\u751f\u8b8a\u5316\u6642\u5237\u65b0\u73fe\u6709\u6a19\u8a18\u3002\n\u672c\u6587\u6a94\u9069\u7528\u65bc\u6578\u64da\u7ba1\u7406\u54e1\uff0c\u5176\u8ca0\u8cac\u5275\u5efa\u6e96\u78ba\u63cf\u8ff0\u7d44\u7e54\u7684\u6578\u64da\u8cc7\u7522\u7684\u5143\u6578\u64da\u3002\n\u672c\u6587\u6a94\u4ecb\u7d39 Tag Engine \u7684\u521d\u59cb\u8a2d\u7f6e\uff0c\u5305\u62ec\u904b\u884c\u4e00\u4e9b [Terraform](https://www.terraform.io/) \u8173\u672c\u3002\u5b83\u4f7f\u7528\u5169\u500b\u793a\u4f8b\u4f86\u8aaa\u660e\u5982\u4f55\u6279\u91cf\u6a19\u8a18 BigQuery \u8cc7\u7522\u3002\u9019\u5169\u500b\u793a\u4f8b\u90fd\u9996\u5148\u5728 BigQuery \u4e2d\u5275\u5efa\u5c0f\u578b\u6578\u64da\u96c6\u3002 A subsequent document illustrates similar concepts for Cloud Storage.\n", "content": "## Tag Engine \u67b6\u69cb\nTag Engine \u90e8\u7f72\u5728\u4ee5\u4e0b\u914d\u7f6e\u4e0b\uff1a\n- \u90e8\u7f72\u5230\u8207 Data Catalog \u548c BigQuery \u76f8\u540c\u7684\u9805\u76ee\uff0c\u9069\u7528\u65bc\u6982\u5ff5\u9a57\u8b49\u548c\u958b\u767c\u74b0\u5883\u3002\n- \u8207 Data Catalog \u9805\u76ee\u5171\u4eab\uff0c\u4f46\u653e\u5728\u4e0d\u540c\u7684 BigQuery \u9805\u76ee\u4e2d\uff0c\u9069\u7528\u65bc\u66f4\u9ad8\u7d1a\u5225\u7684\u74b0\u5883\uff08\u4f8b\u5982\u751f\u7522\u74b0\u5883\uff09\u3002\n- \u90e8\u7f72\u5230\u5176\u81ea\u5df1\u7684\u9805\u76ee\u4e2d\uff0c\u4e5f\u9069\u7528\u65bc\u66f4\u9ad8\u7d1a\u5225\u7684\u74b0\u5883\u3002\u4e0a\u5716\u5c55\u793a\u4e86\u5171\u4eab\u90e8\u7f72\u6a21\u5f0f\uff0c\u5373\u672c\u6587\u6a94\u4f7f\u7528\u7684\u6a21\u5f0f\u3002\n## \u76ee\u6a19\n- \u4ee5\u6578\u64da\u7ba1\u7406\u54e1\u7684\u8eab\u4efd\u4f7f\u7528 Tag Engine \u7232 BigQuery \u8cc7\u7522\u5275\u5efa\u6279\u91cf\u5143\u6578\u64da\u3002\n- \u4ee5\u6578\u64da\u5de5\u7a0b\u5e2b\u7684\u8eab\u4efd\u4f7f\u7528 Tag Engine API \u7232 BigQuery \u8cc7\u7522\u5275\u5efa\u6279\u91cf\u5143\u6578\u64da\u3002\n- \u4f7f\u7528 Tag Engine \u754c\u9762\u6216\u5176 API \u5275\u5efa\u975c\u614b\u6a19\u8a18\u914d\u7f6e\u3002\n- \u4f7f\u7528 Tag Engine \u754c\u9762\u6216\u5176 API \u5275\u5efa\u52d5\u614b\u6a19\u8a18\u914d\u7f6e\u3002\n- \u5728 BigQuery \u4e2d\u4fdd\u7559\u6a19\u8a18\u7684\u66f4\u6539\u6b77\u53f2\u8a18\u9304\u3002\n- \u5c07\u5be6\u6642\u6a19\u8a18\u66f4\u65b0\u767c\u5e03\u5230 Pub/Sub \u4e26\u5728\u51fa\u73fe\u91cd\u5927\u66f4\u6539\u6642\u767c\u51fa\u63d0\u9192\u3002\n- \u4f7f\u7528 Tag Engine \u8986\u84cb\u7387\u5831\u544a\u67e5\u770b\u6578\u64da\u8cc7\u7522\uff0c\u4e26\u78ba\u5b9a\u6a19\u8a18\u4efb\u52d9\u7684\u512a\u5148\u9806\u5e8f\u3002## \u8cbb\u7528\n- [App Engine](https://cloud.google.com/appengine/pricing?hl=zh-cn) \n- [Firestore](https://cloud.google.com/firestore/pricing?hl=zh-cn) \n- [BigQuery](https://cloud.google.com/bigquery/pricing?hl=zh-cn) \n- [Data Catalog](https://cloud.google.com/data-catalog/pricing?hl=zh-cn) \n- [Pub/Sub\uff08\u53ef\u9078\uff09](https://cloud.google.com/pubsub/pricing?hl=zh-cn) ## \u6e96\u5099\u5de5\u4f5c\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- Titles in dynamic includes are not used anywhere, and we should avoid paying to translate them\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u6fc0\u6d3b Cloud Shell\u3002 [\u6fc0\u6d3b Cloud Shell](https://console.cloud.google.com/?cloudshell=true&hl=zh-cn)  [Cloud Shell](https://cloud.google.com/shell/docs/how-cloud-shell-works?hl=zh-cn) \u6703\u8a71\u96a8\u5373\u6703\u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u5e95\u90e8\u5553\u52d5\uff0c\u4e26\u986f\u793a\u547d\u4ee4\u884c\u63d0\u793a\u7b26\u3002Cloud Shell \u662f\u4e00\u500b\u5df2\u5b89\u88dd Google Cloud CLI \u4e14\u5df2\u7232\u7576\u524d\u9805\u76ee\u8a2d\u7f6e\u503c\u7684 Shell \u74b0\u5883\u3002\u8a72\u6703\u8a71\u53ef\u80fd\u9700\u8981\u5e7e\u79d2\u9418\u6642\u9593\u4f86\u5b8c\u6210\u521d\u59cb\u5316\u3002\u672c\u6587\u6a94\u4ecb\u7d39\u4e86\u5169\u500b Google Cloud \u9805\u76ee\uff0c\u4e00\u500b\u7528\u65bc\u904b\u884c Tag Engine\uff0c\u53e6\u4e00\u500b\u7528\u65bc\u5728 BigQuery \u4e2d\u5b58\u5132\u6578\u64da\u3002\u5728\u672c\u6587\u6a94\u7684\u5176\u9918\u90e8\u5206\uff0c\u7b2c\u4e00\u500b Google Cloud \u9805\u76ee\u7a31\u7232 Tag Engine \u9805\u76ee\u3002\u7b2c\u4e8c\u500b Google Cloud \u9805\u76ee\u7a31\u7232 BigQuery \u9805\u76ee\u3002\n\u5982\u679c\u60a8\u4e0d\u6253\u7b97\u4fdd\u7559\u5728\u672c\u6587\u6a94\u4e2d\u5275\u5efa\u7684\u8cc7\u7522\uff0c\u8acb\u5275\u5efa\u5169\u500b\u9805\u76ee\uff0c\u800c\u4e0d\u662f\u9078\u64c7\u73fe\u6709\u9805\u76ee\u3002\n## \u90e8\u7f72\u548c\u914d\u7f6e Tag Engine\n\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u5728 Google Cloud \u4e0a\u90e8\u7f72 Tag Engine\u3002\u9996\u5148\uff0c\u5728 Firestore \u4e0a\u5275\u5efa Tag Engine \u6578\u64da\u5eab\uff0c\u4e26\u4f7f\u7528 Google Cloud CLI \u547d\u4ee4\u5728 App Engine \u4e0a\u90e8\u7f72 Tag Engine \u61c9\u7528\u3002\u7136\u5f8c\uff0c\u4f7f\u7528 Terraform \u914d\u7f6e Tag Engine\u3002\n**\u6ce8\u610f** \uff1aTag Engine \u6709\u5169\u7a2e\u7248\u672c\u3002Tag Engine v1 \u8a17\u7ba1\u5728 App Engine \u4e0a\uff0c\u9019\u662f\u672c\u6559\u7a0b\u7684\u91cd\u9ede\u3002Tag Engine v2 \u8a17\u7ba1\u5728 Cloud Run \u4e0a\uff0c\u4e26\u4e14\u53ef\u4ee5\u5728\u4ee3\u78bc\u5eab\u7684 `cloud-run` \u5206\u652f\u4e2d\u627e\u5230\u3002\n\u5728 Google Cloud \u4e0a\u90e8\u7f72 Tag Engine \u4e4b\u524d\uff0c\u8acb\u4e0b\u8f09\u4e26\u5b89\u88dd [Terraform](https://learn.hashicorp.com/tutorials/terraform/install-cli) \u3002Terraform \u8173\u672c\u6703\u6388\u4e88 IAM \u6b0a\u9650\u3001\u5275\u5efa\u6578\u64da\u5eab\u7d22\u5f15\u4ee5\u53ca\u914d\u7f6e\u96f2\u7aef\u4efb\u52d9\u548c\u8abf\u5ea6\u5668\u689d\u76ee\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u8a2d\u7f6e\u6240\u9700\u7684\u74b0\u5883\u8b8a\u91cf\uff1a```\nexport TAG_ENGINE_PROJECT=PROJECT_ID1export TAG_ENGINE_REGION=us-centralexport TAG_ENGINE_SUB_REGION=us-central1export BQ_PROJECT=PROJECT_ID2export BQ_REGION=us-central1export TAG_ENGINE_SA=${TAG_ENGINE_PROJECT}@appspot.gserviceaccount.comgcloud config set project ${TAG_ENGINE_PROJECT}\n```\u57f7\u884c\u4ee5\u4e0b\u8b8a\u91cf\u66ff\u63db\u64cd\u4f5c\uff1a- = Tag Engine \u9805\u76ee\u7684 ID\n- = BigQuery \u9805\u76ee\u7684 ID\n- \u514b\u9686 GitHub Tag Engine \u4ee3\u78bc\u5eab\uff1a```\ngit clone https://github.com/GoogleCloudPlatform/datacatalog-tag-engine.git\n```\n- \u901a\u904e\u5275\u5efa `variables.tfvars` \u6587\u4ef6\u4f86\u8a2d\u7f6e Terraform \u8b8a\u91cf\uff1a```\ncd datacatalog-tag-enginecat > deploy/variables.tfvars << EOLtag_engine_project=\"${TAG_ENGINE_PROJECT}\"bigquery_project=\"${BQ_PROJECT}\"app_engine_region=\"${TAG_ENGINE_REGION}\"app_engine_subregion=\"${TAG_ENGINE_SUB_REGION}\"EOL\n```\n- \u5275\u5efa Tag Engine \u914d\u7f6e\u6587\u4ef6 ( `tagengine.ini` )\uff1a```\ncat > tagengine.ini << EOL\\[DEFAULT]\\TAG_ENGINE_PROJECT = ${TAG_ENGINE_PROJECT}\\QUEUE_REGION = ${TAG_ENGINE_SUB_REGION}\\INJECTOR_QUEUE = tag-engine-injector-queue\\WORK_QUEUE = tag-engine-work-queue\\BIGQUERY_REGION = ${BQ_REGION}\\EOL\n```\n- \u7232 Tag Engine \u5275\u5efa App Engine \u61c9\u7528\uff1a```\ngcloud app create \\\u00a0 --project=${TAG_ENGINE_PROJECT} \\\u00a0 --region=${TAG_ENGINE_REGION}\n```\n- \u5275\u5efa\u6578\u64da\u5eab\uff1a```\ngcloud firestore databases create \\\u00a0 --project=${TAG_ENGINE_PROJECT} \\\u00a0 --region=${TAG_ENGINE_REGION}\n```\n- \u4f7f\u7528\u9ed8\u8a8d App Engine \u670d\u52d9\u8cec\u865f\u90e8\u7f72 Tag Engine\uff1a```\ngcloud app deploy app.yaml\n```\u78ba\u4fdd\u60a8\u7684\u670d\u52d9\u8cec\u865f\u64c1\u6709 Tag Engine \u9805\u76ee\u7684 Editor \u89d2\u8272\u3002\n- \uff08\u53ef\u9078\uff09\u4f7f\u7528\u7528\u6236\u7ba1\u7406\u7684\u670d\u52d9\u8cec\u865f\u90e8\u7f72 Tag Engine\uff1a```\nexport TAG_ENGINE_SA=SERVICE_ACCOUNTgcloud beta app deploy --service-account=$TAG_ENGINE_SA app.yaml\n```\u57f7\u884c\u4ee5\u4e0b\u8b8a\u91cf\u66ff\u63db\u64cd\u4f5c\uff1a- = \u7528\u6236\u7ba1\u7406\u7684\u670d\u52d9\u8cec\u865f\u7684\u96fb\u5b50\u90f5\u4ef6\n\u7232\u7528\u6236\u7ba1\u7406\u7684\u670d\u52d9\u8cec\u865f\u6388\u4e88 Tag Engine \u9805\u76ee\u7684 Editor \u89d2\u8272\u3002\n- \u4f7f\u7528\u9632\u706b\u7246\u898f\u5247\u4fdd\u8b77 App Engine\uff1a```\ngcloud app firewall-rules create 100 --action ALLOW --source-range[IP_RANGE]gcloud app firewall-rules update default --action deny\n```\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cApp Engine \u5141\u8a31\u4f86\u81ea\u516c\u5171\u4e92\u806f\u7db2\u7684\u6d41\u91cf\u3002\u4f7f\u7528 App Engine [\u9632\u706b\u7246\u898f\u5247](https://cloud.google.com/appengine/docs/flexible/go/application-security?hl=zh-cn#app_engine_firewall) \u5c07\u7db2\u7d61\u6d41\u91cf\u9650\u5236\u7232\u67d0\u500b IP \u5730\u5740\u7bc4\u570d\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 [Identity-Aware Proxy (IAP)](https://cloud.google.com/iap/docs/concepts-overview?hl=zh-cn) \u548c IAM \u7ba1\u7406\u8a2a\u554f\u6b0a\u9650\u3002\u8981\u8a2d\u7f6e IAP \u4ee5\u8a2a\u554f Tag Engine\uff0c\u8acb [\u914d\u7f6e OAuth \u548c IAP \u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/iap/docs/authenticate-users-google-accounts?hl=zh-cn) \u3002\n- \u904b\u884c\u4ee5\u4e0b Terraform \u547d\u4ee4\u3002\u51fa\u73fe\u63d0\u793a\u6642\u8f38\u5165 `yes` \u3002```\ncd deployterraform initterraform apply -var-file variables.tfvars\n```\n- \u5728\u700f\u89bd\u5668\u4e2d\u5553\u52d5 Tag Engine\uff1a```\ngcloud app browse\n```\nTag Engine \u700f\u89bd\u5668\u754c\u9762\u4e3b\u8981\u4ecb\u7d39\u6578\u64da\u7ba1\u7406\u54e1\u5275\u5efa\u6279\u91cf\u5143\u6578\u64da\u6a19\u8a18\u7684\u65b9\u5f0f\u3002\u7232\u4e86\u5275\u5efa\u6240\u6709\u5143\u6578\u64da\u6a19\u8a18\uff0cTag Engine \u6703\u4f7f\u7528\u6a19\u8a18\u914d\u7f6e\u3002\n## \u5275\u5efa\u793a\u4f8b\u6578\u64da\u96c6\n\u5728\u6b64\u5834\u666f\u4e2d\uff0c\u5169\u500b\u793a\u4f8b\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u6578\u64da\u96c6\u5305\u542b\u4e09\u500b\u8868\u3002\u9019\u4e9b\u8868\u5305\u542b\u611b\u8377\u83ef\u3001\u7d10\u7d04\u548c\u820a\u91d1\u5c71\u5e02\u7684\u516c\u958b\u670d\u52d9\u8acb\u6c42\u8a18\u9304\uff0c\u9019\u4e9b\u8a18\u9304\u5206\u5225\u4f86\u81ea\u6bcf\u500b\u57ce\u5e02\u7684\u975e\u7dca\u6025\u5e02\u6c11\u670d\u52d9 [311](https://en.wikipedia.org/wiki/3-1-1) \u96fb\u8a71\u865f\u78bc\u3002\u9019\u4e9b\u8868\u4f4d\u65bc `us` \u5340\u57df\u4e2d\uff0c\u6211\u5011\u5e0c\u671b\u5f9e `us-central1` \u5340\u57df\u4e2d\u67e5\u8a62\u5b83\u5011\u3002\u7232\u6b64\uff0c\u6211\u5011\u6703\u5c07\u5b83\u5011\u5c0e\u51fa\u5230 Cloud Storage\uff0c\u7136\u5f8c\u5728 BigQuery \u4e2d\u5c07\u5b83\u5011\u5c0e\u5165\u5230\u6b63\u78ba\u5340\u57df\u4e2d\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u5728 `us-central1` \u5340\u57df\u4e2d\u5275\u5efa\u4e00\u500b Cloud Storage \u5b58\u5132\u6876\uff1a```\nexport BUCKET=cities-311gsutil mb -l ${BQ_REGION} gs://${BUCKET}\n```\n- \u5c07\u4e09\u500b `311_service_requests` \u8868\u5c0e\u51fa\u5230 Cloud Storage \u5b58\u5132\u6876\uff1a```\nbq extract --destination_format=AVRO \\\u00a0 bigquery-public-data:austin_311.311_service_requests \\\u00a0 gs://${BUCKET}/austin/311_service_requests*.avrobq extract --destination_format=AVRO \\\u00a0 bigquery-public-data:new_york_311.311_service_requests \\\u00a0 gs://${BUCKET}/new_york/311_service_requests*.avrobq extract --destination_format=AVRO \\\u00a0 bigquery-public-data:san_francisco_311.311_service_requests \\\u00a0 gs://${BUCKET}/san_francisco/311_service_requests*.avro\n```\n- \u5728 Cloud Shell \u4e2d\u5275\u5efa\u793a\u4f8b\u6578\u64da\u96c6\uff1a```\nbq --location=${BQ_REGION} mk --dataset ${BQ_PROJECT}:cities_311\n```\n- \u5c07\u6587\u4ef6\u52a0\u8f09\u5230 BigQuery \u4e2d\uff1a```\n\u00a0bq load --source_format=AVRO ${BQ_PROJECT}:cities_311.austin_311_service_requests \\\u00a0 \u00a0gs://${BUCKET}/austin/*.avro\u00a0bq load --source_format=AVRO ${BQ_PROJECT}:cities_311.new_york_311_service_requests \\\u00a0 \u00a0gs://${BUCKET}/new_york/*.avro\u00a0bq load --source_format=AVRO ${BQ_PROJECT}:cities_311.san_francisco_311_service_requests \\\u00a0 \u00a0gs://${BUCKET}/san_francisco/*.avro\u00a0```\n```\n- \u5f9e Cloud Storage \u4e2d\u522a\u9664\u57ce\u5e02 311 \u6587\u4ef6\u548c\u5b58\u5132\u6876\uff1a```\ngsutil -m rm -r gs://${BUCKET}\n```## \u5275\u5efa Data Catalog \u6a19\u8a18\u6a21\u677f\n\u5728 Tag Engine \u4e2d\u5275\u5efa\u6a19\u8a18\u914d\u7f6e\u4e4b\u524d\uff0c\u60a8\u5fc5\u9808\u5148\u5275\u5efa\u4e00\u500b\u6216\u591a\u500b Data Catalog [\u6a19\u8a18\u6a21\u677f](https://cloud.google.com/data-catalog/docs/tags-and-tag-templates?hl=zh-cn#tag-templates) \u3002\u6a19\u8a18\u6a21\u677f\u662f Data Catalog \u6982\u5ff5\uff0c\u7528\u65bc\u5b9a\u7fa9\u4e00\u500b\u6216\u591a\u500b\u76f8\u540c\u985e\u578b\u6a19\u8a18\u7684\u67b6\u69cb\u3002\u67b6\u69cb\u6307\u5b9a\u4e00\u7d44\u5b57\u6bb5\u540d\u7a31\u3001\u5176\u6578\u64da\u985e\u578b\u53ca\u5176\u5728\u6a21\u677f\u4e2d\u7684\u5e8f\u5217\u3002\u6bcf\u500b Data Catalog \u6a19\u8a18\u90fd\u662f\u6839\u64da\u6a19\u8a18\u6a21\u677f\u9032\u884c\u5be6\u4f8b\u5316\u7684\u3002\n\u5982\u9700\u4f7f\u7528\u95dc\u9375\u6027\u80fd\u6307\u6a19\u7232\u5404\u500b 311 \u670d\u52d9\u8acb\u6c42\u8868\u6dfb\u52a0\u8a3b\u91cb\uff0c\u8acb\u5275\u5efa\u6a19\u8a18\u6a21\u677f\uff1a\n- \u5728 Cloud Shell \u4e2d\uff0c\u514b\u9686 GitHub `datacatalog-templates.git` \u4ee3\u78bc\u5eab\u4e26\u5207\u63db\u5230 `datacatalog-templates` \u6587\u4ef6\u593e\uff1a```\ngit clone https://github.com/GoogleCloudPlatform/datacatalog-templates.gitcd datacatalog-templates\n```\n- \u5275\u5efa\u4e26\u6fc0\u6d3b\u865b\u64ec\u74b0\u5883\uff0c\u7136\u5f8c\u5b89\u88dd Python \u4f9d\u8cf4\u9805\uff1a```\npython -m venv venvsource venv/bin/activatepip install -r requirements.txt\n```\n- \u5275\u5efa `cities_311` \u6a19\u8a18\u6a21\u677f\uff1a```\npython create_template.py $TAG_ENGINE_PROJECT $TAG_ENGINE_SUB_REGION \\\u00a0 cities_311.yaml\n````create_template.py` \u8173\u672c\u6703\u6839\u64da `cities_311.yaml` \u6587\u4ef6\u7684\u5167\u5bb9\u5275\u5efa\u6a19\u8a18\u6a21\u677f\u3002 `cities_311` \u6a19\u8a18\u6a21\u677f\u5305\u542b 11 \u500b\u5b57\u6bb5\uff0c\u5176\u4e2d\u5169\u500b\u5b57\u6bb5\u7232\u5fc5\u586b\u5b57\u6bb5\u3002\u6839\u64da\u6b64\u6a19\u8a18\u6a21\u677f\u5275\u5efa\u6a19\u8a18\u6642\uff0c\u5fc5\u9808\u63d0\u4f9b\u9019\u5169\u500b\u5fc5\u586b\u5b57\u6bb5\u3002| \u5b57\u6bb5\u540d\u7a31     | \u5b57\u6bb5\u985e\u578b | \u5fc5\u586b\u5b57\u6bb5 |\n|:---------------------------|:-----------|:-----------|\n| avg_daily_total_requests | \u96d9\u7cbe\u5ea6  | False  |\n| avg_daily_open_requests | \u96d9\u7cbe\u5ea6  | False  |\n| avg_daily_closed_requests | \u96d9\u7cbe\u5ea6  | False  |\n| avg_daily_unknown_requests | \u96d9\u7cbe\u5ea6  | False  |\n| sum_total_requests   | \u96d9\u7cbe\u5ea6  | True  |\n| unique_total_requests  | \u96d9\u7cbe\u5ea6  | False  |\n| closed_total_requests  | \u96d9\u7cbe\u5ea6  | False  |\n| open_total_requests  | \u96d9\u7cbe\u5ea6  | False  |\n| unknown_total_requests  | \u96d9\u7cbe\u5ea6  | False  |\n| unique_total_complaints | \u96d9\u7cbe\u5ea6  | False  |\n| tag_snapshot_time   | \u65e5\u671f\u6642\u9593 | True  |\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u6253\u958b [Data Catalog](https://console.cloud.google.com/datacatalog/templates?hl=zh-cn) \u4ee5\u67e5\u770b **\u5404\u57ce\u5e02 311 \u670d\u52d9\u8acb\u6c42** \u6a19\u8a18\u6a21\u677f\u3002\u5b83\u61c9\u8a72\u5982\u4ee5\u4e0b\u5c4f\u5e55\u622a\u5716\u6240\u793a\uff1a \n- \u5275\u5efa `data_governance` \u6a19\u8a18\u6a21\u677f\uff1a```\npython create_template.py ${TAG_ENGINE_PROJECT} ${TAG_ENGINE_SUB_REGION} \\\u00a0 \u00a0 data_governance.yaml\n````data_governance` \u6a21\u677f\u9084\u5305\u542b 11 \u500b\u5b57\u6bb5\uff0c\u5176\u4e2d 2 \u500b\u662f\u5fc5\u586b\u5b57\u6bb5\u3002\u6839\u64da\u6b64\u6a21\u677f\u5275\u5efa\u6a19\u8a18\u6642\uff0c\u5fc5\u9808\u63d0\u4f9b\u9019\u5169\u500b\u5fc5\u586b\u5b57\u6bb5\u3002| \u5b57\u6bb5\u540d\u7a31     | \u985e\u578b  | \u5fc5\u586b |\n|:-------------------------|:---------|:-------|\n| data_domain    | enum  | True |\n| broad_data_category  | enum  | True |\n| environment    | enum  | False |\n| data_origin    | enum  | False |\n| data_creation   | datetime | False |\n| data_ownership   | string | False |\n| data_asset_owner   | string | False |\n| data_asset_expert  | string | False |\n| data_confidentiality  | enum  | False |\n| data_retention   | enum  | False |\n| data_asset_documentation | string | False |\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u6253\u958b [Data Catalog](https://console.cloud.google.com/datacatalog/templates?hl=zh-cn) \u4ee5\u67e5\u770b `data_governance` \u6a19\u8a18\u6a21\u677f\u3002\u5b83\u61c9\u8a72\u5982\u4ee5\u4e0b\u5c4f\u5e55\u622a\u5716\u6240\u793a\uff1a ## Tag Engine \u504f\u597d\u8a2d\u7f6e\n\u7232\u65b9\u4fbf\u8d77\u898b\uff0cTag Engine \u7232\u60a8\u63d0\u4f9b\u4e86\u4fdd\u5b58\u9ed8\u8a8d\u6a19\u8a18\u6a21\u677f\u7684\u9078\u9805\u3002\u9084\u63d0\u4f9b\u4e86\u5c07\u6bcf\u500b\u6a19\u8a18\u7684\u526f\u672c\u4fdd\u5b58\u5230 BigQuery \u548c Pub/Sub \u7684\u9078\u9805\u3002\u672c\u90e8\u5206\u8a73\u7d30\u4ecb\u7d39\u4e86\u6bcf\u500b\u4e3b\u984c\u3002\u96d6\u7136\u60a8\u53ef\u4ee5\u5728\u672a\u8a2d\u7f6e\u9019\u4e9b\u9078\u9805\u7684\u60c5\u6cc1\u4e0b\u958b\u59cb\u6a19\u8a18\uff0c\u4f46\u7121\u6cd5\u5c07\u9019\u4e9b\u6a19\u8a18\u8907\u88fd\u5230 BigQuery \u6216\u767c\u4f48\u5230 Pub/Sub\u3002\u5982\u679c\u8981\u8df3\u904e\u9019\u4e9b\u9078\u9805\uff0c\u60a8\u53ef\u4ee5\u76f4\u63a5\u8f49\u5230 [\u6a19\u8a18\u6982\u89bd](#tagging_overview) \u90e8\u5206\u3002\n### \u4fdd\u5b58\u9ed8\u8a8d\u6a19\u8a18\u6a21\u677f\n\u7232\u907f\u514d\u6bcf\u6b21\u5275\u5efa\u6216\u4fee\u6539\u6a19\u8a18\u6642\u8f38\u5165\u6a19\u8a18\u6a21\u677f ID\u3001\u9805\u76ee ID \u548c\u5340\u57df\uff0cTag Engine \u5141\u8a31\u60a8\u4fdd\u5b58\u9ed8\u8a8d\u6a19\u8a18\u6a21\u677f\u3002\n\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u8a2d\u7f6e\u9ed8\u8a8d\u6a19\u8a18\u6a21\u677f\uff1a\n- \u9ede\u64ca Tag Engine \u9996\u9801\u4e0a\u7684 **\u8a2d\u7f6e\u9ed8\u8a8d\u6a19\u8a18\u6a21\u677f** \u93c8\u63a5\u3002\n- \u8f38\u5165\u4ee5\u4e0b\u8a73\u7d30\u4fe1\u606f\uff1a- **\u6a21\u677f ID** \uff1a`cities_311`\n- **\u6a21\u677f\u9805\u76ee** \uff1a\n- **\u6a21\u677f\u5340\u57df** \uff1a`us-central1`\n\u5c07 \u66ff\u63db\u7232\u60a8\u7684 Tag Engine \u9805\u76ee\u7684 ID\u3002\n- \u9ede\u64ca **Save Settings** \uff08\u4fdd\u5b58\u8a2d\u7f6e\uff09\u3002\u9996\u9801\u4e0a\u7684\u53c3\u6578\u73fe\u5728\u5df2\u9810\u5148\u586b\u5145\u4e86\u9ed8\u8a8d\u6a19\u8a18\u6a21\u677f\u8a73\u7d30\u4fe1\u606f\u3002\n### \u9078\u64c7\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u9078\u9805\n\u901a\u904e\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u9078\u9805\uff0c\u60a8\u53ef\u4ee5\u5c07 Tag Engine \u5275\u5efa\u7684\u6bcf\u500b\u6a19\u8a18\u7684\u526f\u672c\u4fdd\u5b58\u5230 BigQuery \u8868\u4e2d\u3002\u901a\u904e\u6b64\u64cd\u4f5c\uff0c\u60a8\u53ef\u4ee5\u4fdd\u7559\u6240\u6709\u6a19\u8a18\u7684\u66f4\u6539\u6b77\u53f2\u8a18\u9304\u3002\u6bcf\u500b\u6a19\u8a18\u90fd\u5c07\u5728 BigQuery \u4e2d\u4f5c\u7232\u65b0\u7684\u8868\u8a18\u9304\u5beb\u5165\uff0c\u4e00\u500b\u6a19\u8a18\u6a21\u677f\u4e2d\u7684\u6240\u6709\u6a19\u8a18\u503c\u90fd\u5b58\u5132\u5728\u540c\u4e00\u500b\u8868\u4e2d\u3002\u8868\u67b6\u69cb\u5305\u62ec\u6a19\u8a18\u7684\u5275\u5efa\u6642\u9593\u3001\u8cc7\u7522\u540d\u7a31\u548c\u6a19\u8a18\u6a21\u677f\u4e2d\u7684\u6bcf\u500b\u5b57\u6bb5\u3002 `cities_311` \u6a21\u677f\u7684\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u8868\u4f7f\u7528\u4ee5\u4e0b\u5b57\u6bb5\u5275\u5efa\uff1a\n| \u5b57\u6bb5\u540d\u7a31     | \u5b57\u6bb5\u985e\u578b | \u8aaa\u660e                        |\n|:---------------------------|:-----------|:----------------------------------------------------------------------------------------------------|\n| event_time     | datetime | \u6a19\u8a18\u64cd\u4f5c\u7684\u6642\u9593\u6233                     |\n| asset_name     | string  | BigQuery \u4e2d\u7684\u8cc7\u7522\u540d\u7a31\uff0c\u4f8b\u5982 warehouse-337221/dataset/cities_311/table/new_york_311_service_requests |\n| avg_daily_total_requests | numeric | \u5b57\u6bb5 avg_daily_total_requests \u7684\u503c                 |\n| avg_daily_open_requests | numeric | \u5b57\u6bb5 avg_daily_open_requests \u7684\u503c                 |\n| avg_daily_closed_requests | numeric | \u5b57\u6bb5 avg_daily_closed_requests \u7684\u503c                 |\n| avg_daily_unknown_requests | numeric | \u5b57\u6bb5 avg_daily_unknown_requests \u7684\u503c                |\n| sum_total_requests   | numeric | \u5b57\u6bb5 sum_total_requests \u7684\u503c                  |\n| unique_total_requests  | numeric | \u5b57\u6bb5 unique_total_requests \u7684\u503c                  |\n| closed_total_requests  | numeric | \u5b57\u6bb5 closed_total_requests \u7684\u503c                  |\n| open_total_requests  | numeric | \u5b57\u6bb5 open_total_requests \u7684\u503c                  |\n| unknown_total_requests  | numeric | \u5b57\u6bb5 unknown_total_requests \u7684\u503c                 |\n| unique_total_complaints | numeric | \u5b57\u6bb5 unique_total_complaints \u7684\u503c                 |\n| tag_snapshot_time   | datetime | \u5b57\u6bb5 tag_snapshot_time \u7684\u503c                   |\n\u6b64\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u8868\u540d\u7232 `tag_history.cities_311` \u3002\u5b58\u5132\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u8868\u7684\u6578\u64da\u96c6\u7531 `tag_history` \u6a19\u8b58\u3002\n- \u5982\u9700\u5553\u7528\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u529f\u80fd\uff0c\u8acb\u5275\u5efa\u4e00\u500b BigQuery \u6578\u64da\u96c6\u4ee5\u7528\u65bc\u5b58\u5132\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u8868\uff1a```\nbq mk --project_id ${BQ_PROJECT} tag_history\n```\n- \u5411 Tag Engine \u670d\u52d9\u8cec\u865f\u6388\u4e88\u5c0d\u6578\u64da\u96c6\u7684\u4fee\u6539\u6b0a\u9650\uff1a```\n\u00a0bq query --nouse_legacy_sql \\\"GRANT \\`roles/bigquery.dataEditor\\` ON SCHEMA \\`${BQ_PROJECT}.tag_history\\`TO 'serviceAccount:${TAG_ENGINE_PROJECT}@appspot.gserviceaccount.com'\"\n```\n- \u5728 Tag Engine \u4e2d\uff0c\u9ede\u64ca\u9996\u9801\u4e0a\u7684 **\u958b\u5553/\u95dc\u9589\u6a19\u8a18\u6b77\u53f2\u8a18\u9304** \u3002 \u8f38\u5165\u4ee5\u4e0b\u8a73\u7d30\u4fe1\u606f\uff1a- **\u5553\u7528\u6a19\u8a18\u6b77\u53f2\u8a18\u9304** \uff1a\u958b\u5553\n- **BigQuery \u9805\u76ee ID** \uff1a\n- **BigQuery \u5340\u57df** \uff1a`us-central1`\n- **BigQuery \u6578\u64da\u96c6** \uff1a`tag_history`\n\u66ff\u63db\u4ee5\u4e0b\u8b8a\u91cf\uff1a = BigQuery \u9805\u76ee\u7684 ID\u3002\n- \u9ede\u64ca **Save Settings** \uff08\u4fdd\u5b58\u8a2d\u7f6e\uff09\u3002 **\u6ce8\u610f** \uff1aTag Engine \u4e0d\u6703\u5275\u5efa BigQuery \u6578\u64da\u96c6\u4f86\u8a17\u7ba1\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u8868\u3002\u60a8\u5fc5\u9808\u5148\u5728 Tag Engine \u4e4b\u5916\u5275\u5efa\u5b83\uff0c\u7136\u5f8c\u624d\u80fd\u5553\u7528\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u3002\n- \uff08\u53ef\u9078\uff09\u8981\u95dc\u9589\u6b64\u529f\u80fd\uff0c\u8acb\u8f49\u5230 **\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u8a2d\u7f6e** \u9801\u9762\uff0c\u7136\u5f8c\u9078\u64c7 **\u5553\u7528\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\uff1a\u95dc\u9589** \u4e26\u4fdd\u5b58\u66f4\u6539\u3002\n### \u9078\u64c7\u6a19\u8a18\u6d41\u9078\u9805\n\u901a\u904e\u6a19\u8a18\u6d41\u9078\u9805\uff0cTag Engine \u6703\u5c07\u60a8\u5275\u5efa\u7684\u6bcf\u500b\u6a19\u8a18\u7684\u526f\u672c\u767c\u4f48\u5230 Pub/Sub \u4e3b\u984c\u4e2d\u3002\u901a\u904e\u6b64\u64cd\u4f5c\uff0c\u60a8\u53ef\u4ee5\u8a02\u95b1\u548c\u97ff\u61c9\u6a19\u8a18\u503c\u7684\u8b8a\u5316\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u5275\u5efa Pub/Sub \u4e3b\u984c\uff1a```\ngcloud pubsub topics create tag-stream \\\u00a0 --project=${BQ_PROJECT}\n```\n- \u5275\u5efa\u5c0d Pub/Sub \u4e3b\u984c\u7684\u8a02\u95b1\uff1a```\ngcloud pubsub subscriptions create tag-stream-sub \\\u00a0 --topic=tag-stream \\\u00a0 --topic-project=${BQ_PROJECT}\n```\n- \u5411 Tag Engine \u670d\u52d9\u8cec\u865f\u6388\u4e88\u5c0d Pub/Sub \u4e3b\u984c\u7684\u6b0a\u9650\uff1a```\ngcloud pubsub topics add-iam-policy-binding tag-stream \\\u00a0 --project=${BQ_PROJECT} \\\u00a0 --member=\"serviceAccount:${TAG_ENGINE_PROJECT}@appspot.gserviceaccount.com\" \\\u00a0 \u00a0--role=\"roles/editor\"\n```\n- \u9ede\u64ca\u201c\u6a19\u8a18\u6d41\u201d\u9996\u9801\u4e0a\u7684 **\u958b\u5553/\u95dc\u9589\u6a19\u8a18\u6d41** \u93c8\u63a5\u3002\u8f38\u5165\u4ee5\u4e0b\u8a73\u7d30\u4fe1\u606f\uff1a- **\u5553\u7528\u6a19\u8a18\u6d41** \uff1a\u958b\u5553\n- **Pub/Sub \u9805\u76ee ID** \uff1a\n- **Pub/Sub \u4e3b\u984c** \uff1a`tag-stream`\n\u5c07 \u66ff\u63db\u7232\u60a8\u7684 BigQuery \u9805\u76ee\u7684 ID\u3002\n- \u9ede\u64ca **Save Settings** \uff08\u4fdd\u5b58\u8a2d\u7f6e\uff09\u3002\n- \uff08\u53ef\u9078\uff09\u5982\u9700\u95dc\u9589\u6a19\u8a18\u6d41\u5f0f\u50b3\u8f38\uff0c\u8acb\u5f9e **\u5553\u7528\u6a19\u8a18\u6d41** \u83dc\u55ae\u4e2d\u9078\u64c7 **\u95dc\u9589** \uff0c\u7136\u5f8c\u4fdd\u5b58\u66f4\u6539\u3002## \u6a19\u8a18\u6982\u89bd\nTag Engine \u4e2d\u6709\u5169\u7a2e\u4e3b\u8981\u6a19\u8a18\u914d\u7f6e\uff1a\u52d5\u614b \u548c \u975c\u614b\u3002\n\u52d5\u614b\u914d\u7f6e\u6703\u7232\u6bcf\u500b\u6a19\u8a18\u6a21\u677f\u5b57\u6bb5\u5206\u914d\u4e00\u500b\u67e5\u8a62\u8868\u9054\u5f0f\u3002\u67e5\u8a62\u8868\u9054\u5f0f\u5728 SQL \u4e2d\u4ee5\u67d0\u4e9b\u7279\u6b8a\u8b8a\u91cf\u7684\u5f62\u5f0f\u63d0\u4f9b\u3002\u52d5\u614b\u914d\u7f6e\u9084\u5305\u62ec\u6709\u95dc\u4f55\u6642\u66f4\u65b0\u6a19\u8a18\u4ee5\u53ca\u5982\u4f55\u66f4\u65b0\u6a19\u8a18\u7684\u4fe1\u606f\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u52d5\u614b\u914d\u7f6e\u4f7f\u7528\u4f86\u81ea BigQuery \u7684\u5143\u6578\u64da\u5c6c\u6027\uff08\u4f8b\u5982\u64cd\u4f5c\u5143\u6578\u64da\uff09\u4f86\u586b\u5145\u6a19\u8a18\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5169\u7a2e\u985e\u578b\u7684\u52d5\u614b\u914d\u7f6e\uff1a\u52d5\u614b\u8868\u914d\u7f6e \uff08\u7528\u65bc\u6a19\u8a18 BigQuery \u4e2d\u7684\u8868\u548c\u8996\u5716\uff09\u6216\u52d5\u614b\u5217\u914d\u7f6e \uff08\u7528\u65bc\u6a19\u8a18 BigQuery \u4e2d\u7684\u5b57\u6bb5\uff09\u3002\n\u975c\u614b\u914d\u7f6e\u6703\u7232\u6a19\u8a18\u4e2d\u7684\u6bcf\u500b\u6a19\u8a18\u6a21\u677f\u5b57\u6bb5\u5206\u914d\u5e38\u91cf\u503c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u975c\u614b\u914d\u7f6e\u4f86\u6a19\u8a18\u5177\u6709\u5f88\u5c11\u9032\u884c\u66f4\u6539\u7684\u63cf\u8ff0\u6027\u5143\u6578\u64da\u7684\u8cc7\u7522\uff0c\u4f8b\u5982\u6578\u64da\u6240\u6709\u6b0a\u548c\u6578\u64da\u7db2\u57df\u4fe1\u606f\u3002\u8cc7\u7522\u53ef\u4ee5\u662f BigQuery \u6578\u64da\u96c6\u3001\u8868\u548c\u8996\u5716\uff0c\u4e5f\u53ef\u4ee5\u662f Cloud Storage \u5b58\u5132\u6876\u3001\u6587\u4ef6\u593e\u548c\u6587\u4ef6\u3002\u6b64\u914d\u7f6e\u53ea\u6709\u4e00\u500b\u9078\u9805\uff0c\u5373\u201c\u975c\u614b\u8cc7\u6e90\u914d\u7f6e\u201d \u3002\nTag Engine \u5141\u8a31\u60a8\u901a\u904e\u7db2\u9801\u754c\u9762\u6216 API \u5275\u5efa\u914d\u7f6e\u3002\u6578\u64da\u7ba1\u7406\u54e1\u901a\u5e38\u9996\u9078\u4f7f\u7528\u7db2\u9801\u754c\u9762\u3002\u4f7f\u7528\u7db2\u9801\u754c\u9762\u6642\uff0c\u6578\u64da\u7ba1\u7406\u54e1\u7121\u9700\u5beb\u5165\u6578\u64da\u6d41\u6c34\u7dda\u3002 \u6b64\u5916\uff0c\u7db2\u9801\u754c\u9762\u9084\u7232\u4ed6\u5011\u63d0\u4f9b\u4e86\u4f7f\u7528 SQL \u958b\u767c\u65b0\u6a19\u8a18\u7684\u81ea\u4e3b\u6027\u548c\u654f\u6377\u6027\u3002\u6578\u64da\u5de5\u7a0b\u5e2b\u901a\u5e38\u9996\u9078\u4f7f\u7528 API\uff0c\u5c24\u5176\u662f\u5728\u751f\u7522\u74b0\u5883\u4e2d\u3002\u901a\u904e\u4f7f\u7528 API\uff0c\u4ed6\u5011\u53ef\u4ee5\u5c07\u6a19\u8a18\u4efb\u52d9\u96c6\u6210\u5230\u6578\u64da\u6d41\u6c34\u7dda\u4e2d\uff0c\u4e26\u53ef\u4ee5\u66f4\u597d\u5730\u63a7\u5236\u6a19\u8a18\u66f4\u65b0\u7684\u6642\u9593\u3002\n\u5275\u5efa\u914d\u7f6e\u6642\uff0c\u8acb\u9078\u64c7\u9069\u5408\u60a8\u7684\u4f7f\u7528\u5834\u666f\u548c\u5718\u968a\u7684\u65b9\u6cd5\uff08\u7db2\u9801\u754c\u9762\u6216 API\uff09\u3002\u4ee5\u4e0b\u90e8\u5206\u8a73\u7d30\u4ecb\u7d39\u77ad\u5982\u4f55\u4f7f\u7528\u9019\u5169\u7a2e\u65b9\u6cd5\uff0c\u9996\u5148\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528\u7db2\u9801\u754c\u9762\u3002\n## \u5275\u5efa\u52d5\u614b\u6a19\u8a18\u914d\u7f6e\n\u52d5\u614b\u914d\u7f6e\u6703\u751f\u6210\u4e00\u7d44 Data Catalog \u6a19\u8a18\u3002\u6bcf\u500b\u6a19\u8a18\u90fd\u8207\u552f\u4e00\u7684\u6a19\u8a18\u6a21\u677f\u548c BigQuery \u8cc7\u6e90\u7d44\u5408\u76f8\u95dc\u806f\u3002\u5c07\u5176\u7a31\u7232\u201c\u52d5\u614b\u201d \uff0c\u56e0\u7232\u6a19\u8a18\u7684\u5167\u5bb9\u662f\u4f7f\u7528\u67e5\u8a62\u8868\u9054\u5f0f\u7684\u7d50\u679c\u9032\u884c\u586b\u5145\u7684\u3002\n\u5982\u524d\u6240\u8ff0\uff0c\u52d5\u614b\u914d\u7f6e\u6703\u751f\u6210\u8868\u7d1a\u5c64\u6a19\u8a18\u6216\u5217\u7d1a\u5c64\u6a19\u8a18\uff0c\u4f46\u4e0d\u80fd\u540c\u6642\u751f\u6210\u5169\u8005\u3002\u8981\u5275\u5efa\u8868\u7d1a\u5c64\u6a19\u8a18\uff0c\u8acb\u9078\u64c7\u52d5\u614b\u8868\u914d\u7f6e\u985e\u578b\u3002\u8981\u5275\u5efa\u5217\u7d1a\u5c64\u6a19\u8a18\uff0c\u61c9\u4f7f\u7528\u52d5\u614b\u5217\u914d\u7f6e\u985e\u578b\u3002\n\u7121\u8ad6\u60a8\u9078\u64c7\u54ea\u7a2e\u985e\u578b\uff0c\u52d5\u614b\u914d\u7f6e\u90fd\u5305\u542b\u4ee5\u4e0b\u4e09\u500b\u90e8\u5206\uff1a\n- **\u67e5\u8a62\u8868\u9054\u5f0f** \uff1a\u6307\u5b9a\u5982\u4f55\u7232\u4e00\u500b\u6216\u591a\u500b\u6a19\u8a18\u6a21\u677f\u5b57\u6bb5\u751f\u6210\u503c\n- **URI \u8868\u9054\u5f0f** \uff1a\u6307\u5b9a\u4e00\u500b\u6216\u591a\u500b BigQuery \u8cc7\u6e90\uff08\u8868\u3001\u8996\u5716\u3001\u6578\u64da\u96c6\uff09\u7684\u8def\u5f91\n- **\u6642\u9593\u5b89\u6392\u8a2d\u7f6e** \uff1a\u6307\u5b9a\u66f4\u65b0\u8207\u7576\u524d\u914d\u7f6e\u95dc\u806f\u7684 Data Catalog \u6a19\u8a18\u7684\u983b\u7387\n\u7cfb\u7d71\u6703\u81ea\u52d5\u9078\u64c7\u6a19\u8a18\u6a21\u677f\u7684\u5fc5\u586b\u5b57\u6bb5\uff0c\u4f8b\u5982 `sum_total_requests` \u548c `tag_snapshot_time` \u3002\u5728\u6bcf\u500b\u6a19\u8a18\u6a21\u677f\u5b57\u6bb5\u65c1\u908a\uff0c\u8f38\u5165\u67e5\u8a62\u8868\u9054\u5f0f\u3002\u6bcf\u500b\u5b57\u6bb5\u7684\u9810\u671f\u985e\u578b\u5217\u5728\u62ec\u865f\u4e2d\u3002\u5728 BigQuery \u4e2d\uff0c\u67e5\u8a62\u8868\u9054\u5f0f\u5fc5\u9808\u662f\u6709\u6548\u7684 `SELECT` \u8a9e\u53e5\u3002 `SELECT` \u5b50\u53e5\u662f\u5fc5\u9700\u7684\u3002 `FROM` \u548c `WHERE` \u5b50\u53e5\u662f\u53ef\u9078\u7684\uff0c\u4f46\u7d93\u5e38\u4f7f\u7528\u3002 `SELECT` \u8a9e\u53e5\u4e2d\u7684\u5176\u4ed6\u5b50\u53e5\uff08\u5982 `JOIN` \u548c `GROUP BY` \uff09\u4e5f\u5141\u8a31\u4f7f\u7528\u3002\n\u5728 `SELECT` \u8a9e\u53e5\u7684\u5404\u7a2e\u5b50\u53e5\u4e2d\uff0c\u67e5\u8a62\u8868\u9054\u5f0f\u53ef\u4ee5\u5f15\u7528\u5e7e\u500b\u8b8a\u91cf\uff0c\u4f8b\u5982 `$table` \u548c `$column` \u3002\u4ee5\u4e0b\u5217\u8868\u5305\u542b\u60a8\u53ef\u4ee5\u5f15\u7528\u7684\u6240\u6709\u8b8a\u91cf\uff1a\n- `$project`\uff1a\u8981\u6a19\u8a18\u7684 BigQuery \u8cc7\u6e90\u7684\u9805\u76ee ID\u3002\n- `$dataset`\uff1a\u8981\u6a19\u8a18\u7684 BigQuery \u8cc7\u6e90\u7684\u6578\u64da\u96c6\u540d\u7a31\u3002\n- `$table`\uff1a\u8981\u6a19\u8a18\u7684 BigQuery \u8cc7\u6e90\u7684\u8868\u540d\u7a31\u3002\u5b83\u5728\u67e5\u8a62\u8868\u9054\u5f0f\u7684`FROM`\u5b50\u53e5\u4e2d\u4f7f\u7528\u6642\uff0c\u6703\u89e3\u6790\u7232\u8981\u6a19\u8a18\u7684\u8868\u7684\u5b8c\u5168\u9650\u5b9a\u8def\u5f91\u3002\u4f8b\u5982`warehouse-337221.cities_311.austin_311_service_requests`\u3002\u5b83\u5728\u67e5\u8a62\u8868\u9054\u5f0f\u7684`WHERE`\u5b50\u53e5\u4e2d\u4f7f\u7528\u6642\uff0c\u6703\u89e3\u6790\u7232\u8868\u540d\u7a31\uff0c\u4f8b\u5982`austin_311_service_requests`\u3002\n- `$column`\uff1a\u8981\u6a19\u8a18\u7684 BigQuery \u8cc7\u6e90\u7684\u5217\u540d\u7a31\u3002\u8acb\u6ce8\u610f\uff0c\u6b64\u8b8a\u91cf\u50c5\u5728\u5275\u5efa\u5217\u7d1a\u5c64\u6a19\u8a18\u6642\u53ef\u7528\u3002\n\u9664\u4e86\u5f15\u7528\u9019\u4e9b\u7279\u6b8a\u8b8a\u91cf\u4e4b\u5916\uff0c\u67e5\u8a62\u8868\u9054\u5f0f\u9084\u53ef\u4ee5\u5f15\u7528\u4efb\u4f55\u5167\u7f6e\u7684 BigQuery \u51fd\u6578\uff0c\u4f8b\u5982 `round` \u3001 `cast` \u3001 `extract` \u7b49\u3002\n### \u4f7f\u7528 cities_311 \u6a19\u8a18\u6a21\u677f\u5275\u5efa\u52d5\u614b\u8868\u914d\u7f6e\n\u5728\u672c\u90e8\u5206\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 `cities_311` \u6a19\u8a18\u6a21\u677f\u5275\u5efa\u52d5\u614b\u914d\u7f6e\u3002\n- \u5728 Tag Engine \u9996\u9801\u4e0a\uff0c\u8f38\u5165\u6a19\u8a18\u6a21\u677f ID\u3001\u9805\u76ee ID \u548c\u5340\u57df\uff08\u5982\u679c\u5c1a\u672a\u8a2d\u7f6e\uff09\uff0c\u7136\u5f8c\u9ede\u64ca **\u641c\u7d22\u6a21\u677f** \u3002\n- \u5728 **\u6a19\u8a18\u6a21\u677f\u8a73\u7d30\u4fe1\u606f** \u9801\u9762\u4e0a\uff0c\u9ede\u64ca **\u5275\u5efa\u52d5\u614b\u8868\u6a19\u8a18** \u3002 \u914d\u7f6e\u7684\u67e5\u8a62\u8868\u9054\u5f0f\u90e8\u5206\u73fe\u5728\u986f\u793a\u5728 **\u7528\u65bc\u5275\u5efa\u52d5\u614b\u8868\u6a19\u8a18\u7684\u914d\u7f6e** \u9801\u9762\u4e0a\u3002\u8acb\u6ce8\u610f\uff0c\u8a72\u9801\u9762\u6703\u81ea\u52d5\u9078\u64c7\u6a19\u8a18\u6a21\u677f\u7684\u5fc5\u586b\u5b57\u6bb5\uff08\u5728\u672c\u4f8b\u4e2d\u7232 `sum_total_requests` \u548c `tag_snapshot_time` \uff09\u3002 \u7cfb\u7d71\u6703\u81ea\u52d5\u9078\u64c7\u6a19\u8a18\u6a21\u677f\u7684\u5fc5\u586b\u5b57\u6bb5\uff0c\u5728\u672c\u4f8b\u4e2d\u7232 `sum_total_requests` \u548c `tag_snapshot_time` \u3002\n- \u5728\u6bcf\u500b\u6a19\u8a18\u6a21\u677f\u5b57\u6bb5\u65c1\u908a\u7684\u6587\u672c\u5b57\u6bb5\u4e2d\uff0c\u8f38\u5165\u67e5\u8a62\u8868\u9054\u5f0f\u3002\u67e5\u8a62\u8868\u9054\u5f0f\u5fc5\u9808\u662f BigQuery \u4e2d\u7684\u6709\u6548 `SELECT` \u8a9e\u53e5\u3002 `SELECT` \u5b50\u53e5\u662f\u5fc5\u9700\u7684\u3002FROM \u548c `WHERE` \u5b50\u53e5\u662f\u53ef\u9078\u7684\uff0c\u4f46\u7d93\u5e38\u4f7f\u7528\u3002\u6b64\u5916\uff0c\u9084\u5141\u8a31\u4f7f\u7528 `SELECT` \u8a9e\u53e5\u4e2d\u7684\u5176\u4ed6\u5b50\u53e5\uff0c\u4f8b\u5982 `JOIN` \u548c `GROUP BY` \u3002\u6bcf\u500b\u67e5\u8a62\u8868\u9054\u5f0f\u90fd\u5fc5\u9808\u8fd4\u56de\u8207\u5176\u5c0d\u61c9\u7684\u6a19\u8a18\u6a21\u677f\u5b57\u6bb5\u985e\u578b\u517c\u5bb9\u7684\u503c\u3002\u4f8b\u5982\uff0c\u8207 `sum_total_requests` \u5b57\u6bb5\u95dc\u806f\u7684\u8868\u9054\u5f0f\u5fc5\u9808\u8fd4\u56de `numeric` \u503c\u3002\u8207 `tag_snapshot_time` \u5b57\u6bb5\u95dc\u806f\u7684\u8868\u9054\u5f0f\u5fc5\u9808\u8fd4\u56de `datetime` \u503c\u3002\u6bcf\u500b\u5b57\u6bb5\u7684\u9810\u671f\u985e\u578b\u5df2\u5217\u51fa\u3002\u5728 `SELECT` \u8a9e\u53e5\u7684\u5404\u7a2e\u5b50\u53e5\u4e2d\uff0c\u67e5\u8a62\u8868\u9054\u5f0f\u53ef\u4ee5\u5f15\u7528\u4e00\u4e9b\u7279\u6b8a\u8b8a\u91cf\uff0c\u5982 `$table` \u548c `$column` \u3002\u4ee5\u4e0b\u5217\u8868\u5305\u542b\u60a8\u53ef\u4ee5\u5f15\u7528\u7684\u6240\u6709\u8b8a\u91cf\uff1a- `$project`\uff1a\u8981\u6a19\u8a18\u7684 BigQuery \u8cc7\u6e90\u7684\u9805\u76ee ID\u3002\n- `$dataset`\uff1a\u8981\u6a19\u8a18\u7684 BigQuery \u8cc7\u6e90\u7684\u6578\u64da\u96c6\u540d\u7a31\u3002\n- `$table`\uff1a\u8981\u6a19\u8a18\u7684 BigQuery \u8cc7\u6e90\u7684\u8868\u540d\u7a31\u3002`$table`\u5728\u67e5\u8a62\u8868\u9054\u5f0f\u7684 FROM \u5b50\u53e5\u4e2d\u4f7f\u7528\u6642\uff0c\u6703\u89e3\u6790\u7232\u8981\u6a19\u8a18\u7684\u8868\u7684\u5b8c\u5168\u9650\u5b9a\u8def\u5f91\u3002\u4f8b\u5982`warehouse-337221.cities_311.austin_311_service_requests`\u3002\u5b83\u5728\u67e5\u8a62\u8868\u9054\u5f0f\u7684`WHERE`\u5b50\u53e5\u4e2d\u4f7f\u7528\u6642\uff0c\u6703\u89e3\u6790\u7232\u8868\u540d\u7a31\uff0c\u4f8b\u5982`austin_311_service_requests`\u3002\n- `$column`\uff1a\u8981\u6a19\u8a18\u7684 BigQuery \u8cc7\u6e90\u7684\u5217\u540d\u7a31\u3002\u8acb\u6ce8\u610f\uff0c\u6b64\u8b8a\u91cf\u50c5\u9069\u7528\u65bc\u5217\u7d1a\u5c64\u6a19\u8a18\uff0c\u4e0d\u9069\u7528\u65bc\u6b64 city_311 \u793a\u4f8b\u3002\n\u9664\u4e86\u5f15\u7528\u9019\u4e9b\u7279\u6b8a\u8b8a\u91cf\u4e4b\u5916\uff0c\u67e5\u8a62\u8868\u9054\u5f0f\u9084\u53ef\u4ee5\u5f15\u7528\u4efb\u4f55\u5167\u7f6e\u7684 BigQuery \u51fd\u6578\uff0c\u4f8b\u5982 `round` \u3001 `cast` \u3001 `extract` \u7b49\u3002\n- \u5728\u76f8\u61c9\u5b57\u6bb5\u4e2d\u8f38\u5165\u4ee5\u4e0b\u67e5\u8a62\uff1a| \u5b57\u6bb5\u540d\u7a31     | \u67e5\u8a62\u8868\u9054\u5f0f                                                               |\n|:---------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| avg_daily_total_requests | select ifnull(round(avg(daily_requests), 2), 0) from (select date_created, count(*) as daily_requests from (select extract(date from timestamp_micros(created_date)) as date_created from $table) group by date_created)           |\n| avg_daily_open_requests | select ifnull(round(avg(daily_requests), 2), 0) from (select date_created, count(*) as daily_requests from (select extract(date from timestamp_micros(created_date)) as date_created from $table where status = 'Open') group by date_created)     |\n| avg_daily_closed_requests | select ifnull(round(avg(daily_requests), 2), 0) from (select date_created, count(*) as daily_requests from (select extract(date from timestamp_micros(created_date)) as date_created from $table where status = 'Closed') group by date_created)    |\n| avg_daily_unknown_requests | select ifnull(round(avg(daily_requests), 2), 0) from (select date_created, count(*) as daily_requests from (select extract(date from timestamp_micros(created_date)) as date_created from $table where status not in ('Open', 'Closed')) group by date_created) |\n| sum_total_requests   | select count(*) from $table                                                           |\n| unique_total_requests  | select count(distinct unique_key) from $table                                                      |\n| closed_total_requests  | select count(*) from $table where status = 'Closed'                                                     |\n| open_total_requests  | select count(*) from $table where status = 'Open'                                                     |\n| unknown_total_requests  | select count(*) from $table where status not in ('Closed', 'Open')                                                 |\n| unique_total_complaints | select count(distinct complaint_type) from $table                                                     |\n| tag_snapshot_time   | select current_datetime                                                            | **\u6ce8\u610f** \uff1a\u5728\u67e5\u8a62\u8868\u9054\u5f0f\u4e2d\u4f7f\u7528\u7e2e\u9032\u662f\u7232\u4e86\u4fbf\u65bc\u95b1\u8b80\u3002Tag Engine \u4e0d\u9700\u8981\u7e2e\u9032\u4ee3\u78bc\u3002\n- \u9078\u4e2d\u76f8\u61c9\u8907\u9078\u6846\u4ee5\u5305\u542b\u6a19\u8a18\u6a21\u677f\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u3002 \n### \u5b8c\u6210\u914d\u7f6e\u6587\u4ef6\n\u914d\u7f6e\u6587\u4ef6\u7684\u4e0b\u4e00\u90e8\u5206\u5c07\u4ecb\u7d39 BigQuery \u8cc7\u6e90\u7684 URI\u3002\u672c\u7bc0\u5305\u542b\u4ee5\u4e0b\u5169\u500b\u90e8\u5206\uff1a\n- \u7b2c\u4e00\u90e8\u5206\u662f **\u5305\u542b\u7684\u8868 URI** \u5b57\u6bb5\u3002\u6b64\u5b57\u6bb5\u5305\u542b\u4e00\u500b\u6216\u591a\u500b BigQuery \u8cc7\u6e90\u7684\u8def\u5f91\u3002\u6bcf\u500b\u6a19\u8a18\u914d\u7f6e\u90fd\u81f3\u5c11\u9700\u8981\u4e00\u500b\u5305\u542b\u7684\u8868 URI \u8def\u5f91\u3002 **\u5305\u542b\u7684 URI** \u5b57\u6bb5\u4e2d\u7684 URI \u63a1\u7528\u4ee5\u4e0b\u683c\u5f0f\uff1a `bigquery/project/{project}/dataset/{dataset}/{table}/{column}` \u3002URI \u7684 `{dataset}` \u53ca\u4e4b\u524d\u7684\u7d44\u6210\u90e8\u5206\u5fc5\u9808\u63d0\u4f9b\u3002\u5176\u9918\u7d44\u6210\u90e8\u5206\u662f\u53ef\u9078\u7684\u3002\u5982\u9700\u6a19\u8a18\u6574\u500b\u9805\u76ee\uff0c\u8acb\u4f7f\u7528 `bigquery/project/{project}/*;` \u3002\u5982\u9700\u6a19\u8a18\u6574\u500b\u6578\u64da\u96c6\uff0c\u8acb\u4f7f\u7528 `bigquery/project/{project}/dataset/{dataset}/*` \u3002\u6578\u64da\u96c6\u548c\u8868\u540d\u7a31\u4e2d\u5141\u8a31\u4f7f\u7528\u901a\u914d\u7b26\u3002\u4f8b\u5982\uff0c `bigquery/project/warehouse-337221/dataset/cities_311/austin*` \u8207 `cities_311` \u6578\u64da\u96c6\u4e2d\u7684\u6bcf\u500b\u8868\u548c\u8996\u5716\u5339\u914d\uff0c\u5f9e\u5b57\u7b26\u4e32 `austin*` \u958b\u59cb\u3002\n- \u7b2c\u4e8c\u90e8\u5206\u662f **\u6392\u9664\u7684 URI** \u5b57\u6bb5\u3002\u6b64\u53ef\u9078\u5b57\u6bb5\u5141\u8a31\u60a8\u6392\u9664\u8207\u4e00\u500b\u6216\u591a\u500b\u5305\u542b\u7684\u8868 URI \u8def\u5f91\u5339\u914d\u7684\u8cc7\u6e90\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 **\u6392\u9664\u7684\u8868 URI** \u5b57\u6bb5\u4f86\u6392\u9664\u6a19\u8a18\u81e8\u6642\u8868\u548c\u66ab\u5b58\u8868\u3002\u6b64\u5b57\u6bb5\u9075\u5faa\u8207 **\u5305\u542b\u7684\u8868 URI** \u5b57\u6bb5\u76f8\u540c\u7684\u683c\u5f0f\u898f\u5247\u3002\n**\u6ce8\u610f** \uff1a\u52d5\u614b\u5217\u914d\u7f6e\u9084\u6709\u4e00\u500b\u9644\u52a0\u53c3\u6578\uff0c\u5373\u5217\u67e5\u8a62\u53c3\u6578\uff0c\u7528\u65bc\u63d0\u4f9b\u8981\u6a19\u8a18\u7684 BigQuery \u5b57\u6bb5\u5217\u8868\u3002\u96d6\u7136\u672c\u6307\u5357\u672a\u986f\u793a\u52d5\u614b\u5217\u914d\u7f6e\uff0c\u4f46\u60a8\u53ef\u4ee5\u5728\u4ee3\u78bc\u5eab\u7684 `/examples` \u6587\u4ef6\u593e\u4e2d\u67e5\u770b\u6b64\u914d\u7f6e\u985e\u578b\u7684\u4e00\u4e9b\u793a\u4f8b\u3002\n\u5982\u9700\u5b8c\u6210\u914d\u7f6e\u6587\u4ef6\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a\n- \u5728 **\u5305\u542b\u7684\u8868 URI** \u5b57\u6bb5\u4e2d\u8f38\u5165\u4ee5\u4e0b\u503c\uff1a `bigquery/project/` `` `/dataset/cities_311/*`\u5c07 \u66ff\u63db\u7232\u60a8\u7684 BigQuery \u9805\u76ee\u7684 ID\u3002\n- \u5c07 **\u6392\u9664\u7684\u8868 URI** \u5b57\u6bb5\u7559\u7a7a\u3002 \n- \u9078\u64c7 **\u81ea\u52d5** \u4ee5\u5b89\u6392\u6a19\u8a18\u5237\u65b0\u983b\u7387\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5237\u65b0\u6a21\u5f0f\u9078\u9805\uff1a- **\u81ea\u52d5** \uff1a\u8868\u793a Tag Engine \u61c9\u6839\u64da\u60a8\u9078\u64c7\u7684\u5237\u65b0\u983b\u7387\u89f8\u767c\u5c0d\u6a19\u8a18\u7684\u66f4\u65b0\u3002\n- **\u6309\u9700** \uff1a\u505c\u7528 Tag Engine \u81ea\u52d5\u66f4\u65b0\u3002\u5982\u679c\u66f4\u65b0\u4f9d\u8cf4\u65bc\u5176\u4ed6\u6578\u64da\u8655\u7406\u4efb\u52d9\uff0c\u4e26\u4e14\u60a8\u5e0c\u671b\u901a\u904e API \u89f8\u767c\u9019\u4e9b\u66f4\u65b0\uff0c\u8acb\u9078\u64c7\u201c\u6309\u9700\u201d\u3002\n \n- \uff08\u53ef\u9078\uff09\u8a2d\u7f6e\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u548c\u6a19\u8a18\u6d41\u9078\u9805\u3002\u901a\u904e\u9078\u4e2d\u9019\u5169\u500b\u8907\u9078\u6846\uff0c\u63a5\u53d7\u9ed8\u8a8d\u503c\u3002\u50c5\u7576\u60a8\u5728\u5275\u5efa\u52d5\u614b\u8868\u914d\u7f6e\u4e4b\u524d\u5553\u7528\u4e86\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u548c\u6d41\u9078\u9805\u6642\uff0c\u9019\u4e9b\u9078\u9805\u7e94\u6703\u986f\u793a\u3002\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u9078\u9805\u6703\u5c07\u6b64\u914d\u7f6e\u4e2d\u6bcf\u500b\u65b0\u6a19\u8a18\u548c\u66f4\u65b0\u5f8c\u7684\u6a19\u8a18\u7684\u526f\u672c\u4fdd\u5b58\u5230 BigQuery \u8868\u4e2d\u3002\u6a19\u8a18\u6d41\u9078\u9805\u5c07\u6b64\u914d\u7f6e\u4e2d\u6bcf\u500b\u65b0\u6a19\u8a18\u548c\u66f4\u65b0\u5f8c\u7684\u6a19\u8a18\u7684\u526f\u672c\u767c\u4f48\u5230 Pub/Sub \u4e3b\u984c\u3002\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u6309\u6a19\u8a18\u6a21\u677f\u9032\u884c\u6574\u7406\u3002\u6a19\u8a18\u6d41\u6d88\u606f\u653e\u7f6e\u5728\u540c\u4e00\u4e3b\u984c\u4e2d\u3002 \n- \u9ede\u64ca **\u63d0\u4ea4\u6a19\u8a18\u914d\u7f6e** \u3002\u6b64\u6642\u6703\u986f\u793a\u4e00\u500b\u78ba\u8a8d\u9801\u9762\uff0c\u6307\u793a Tag Engine \u6b63\u5728\u8655\u7406\u52d5\u614b\u914d\u7f6e\u3002 \n- \u5982\u9700\u5237\u65b0\u914d\u7f6e\u9801\u9762\u7684\u72c0\u614b\uff0c\u8acb\u9ede\u64ca\u63d0\u4f9b\u7684\u93c8\u63a5\u3002\u5982\u9700\u67e5\u770b\u986f\u793a\u914d\u7f6e\u72c0\u614b\u7684 **\u67e5\u770b\u914d\u7f6e** \u9801\u9762\uff0c\u8acb\u9ede\u64ca **\u6b64\u8655** \u93c8\u63a5\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e\u72c0\u614b\uff1a- **\u5f85\u8655\u7406** \uff1a\u914d\u7f6e\u5df2\u63d0\u4ea4\uff0c\u4e26\u4e14\u6b63\u5728\u5275\u5efa\u6279\u91cf\u6a19\u8a18\u4f5c\u696d\u3002\n- **\u6b63\u5728\u904b\u884c** \uff1a\u6279\u91cf\u6a19\u8a18\u4f5c\u696d\u6b63\u5728\u904b\u884c\u3002\u7cfb\u7d71\u9084\u6703\u986f\u793a\u5b8c\u6210\u767e\u5206\u6bd4\u3002\n- **\u6d3b\u8e8d** \uff1a\u6279\u91cf\u6a19\u8a18\u4f5c\u696d\u5df2\u5b8c\u6210\uff0c\u4e14\u914d\u7f6e\u8655\u65bc\u6d3b\u8e8d\u72c0\u614b\u3002\n- **\u932f\u8aa4** \uff1a\u6279\u91cf\u6a19\u8a18\u4f5c\u696d\u751f\u6210\u4e86\u4e00\u500b\u6216\u591a\u500b\u932f\u8aa4\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u67e5\u770b App Engine \u65e5\u8a8c\u3002\n- \u7576 `cities_311` \u914d\u7f6e\u6587\u4ef6\u7684\u72c0\u614b\u8b8a\u7232\u201c\u6d3b\u52d5\u201d \u6642\uff0c\u6253\u958b [Data Catalog](https://console.cloud.google.com/datacatalog?hl=zh-cn) \u754c\u9762\u3002\n- \u5728 Data Catalog \u754c\u9762\u4e2d\uff0c\u9ede\u64ca **\u6a19\u8a18\u6a21\u677f** \u9801\u9762\uff0c\u7136\u5f8c\u9078\u64c7 `cities_311` \u6a21\u677f\u3002\n- \u5728\u6a21\u677f\u8a73\u7d30\u4fe1\u606f\u9801\u9762\u4e0a\uff0c\u9ede\u64ca **\u641c\u7d22\u8207\u6a21\u677f\u5339\u914d\u7684\u689d\u76ee** \u3002\u641c\u7d22\u7d50\u679c\u4e2d\u61c9\u8a72\u6709 3 \u500b\u689d\u76ee\uff0c\u6bcf\u500b\u57ce\u5e02\u5c0d\u61c9\u4e00\u500b\u689d\u76ee\u3002\n- \u9ede\u64ca\u4e09\u500b\u689d\u76ee\u4e2d\u7684\u4efb\u4f55\u4e00\u500b\uff0c\u67e5\u770b `cities_311` \u6a19\u8a18\uff0c\u5176\u4e2d\u5305\u542b\u6a19\u8a18\u6a21\u677f\u5b57\u6bb5\u548c\u67e5\u8a62\u8868\u9054\u5f0f\u7684\u7d50\u679c\u3002\u8a72\u6578\u64da\u96c6\u6bcf\u5929\u5237\u65b0\u4e00\u6b21\u3002 \n### \u9a57\u8b49\u5b89\u6392\u7684\u6a19\u8a18\u66f4\u65b0\n\u60a8\u53ef\u4ee5\u901a\u904e\u4e09\u7a2e\u65b9\u5f0f\u9a57\u8b49 Tag Engine \u662f\u5426\u81ea\u52d5\u66f4\u65b0\u52d5\u614b\u914d\u7f6e\u751f\u6210\u7684\u6240\u6709\u6a19\u8a18\u3002\n\u7b2c\u4e00\u7a2e\u65b9\u6cd5\u662f\u5728\u6a19\u8a18\u6a21\u677f\u4e2d\u6dfb\u52a0\u4e00\u500b\u5b57\u6bb5\uff0c\u7528\u65bc\u8a18\u9304\u6a19\u8a18\u7684\u6700\u5f8c\u4fee\u6539\u6642\u9593\u3002\u5728 `cities_311` \u793a\u4f8b\u4e2d\uff0c\u8a2d\u7f6e\u7232 `select current_datetime` \u7684 `tag_snapshot_time` \u5b57\u6bb5\u53ef\u63d0\u4f9b\u6b64\u529f\u80fd\u3002\u5275\u5efa\u52d5\u614b\u914d\u7f6e\u5f8c\uff0c\u7b49\u5f85\u4e00\u500b\u5b8c\u6574\u7684\u5237\u65b0\u9031\u671f\uff08\u5728 `cities_311` \u793a\u4f8b\u4e2d\u7232 24 \u5c0f\u6642\uff09\uff0c\u7136\u5f8c\u5728 Data Catalog \u4e2d\u6aa2\u67e5\u6a19\u8a18\u3002 `tag_snapshot_time` \u5b57\u6bb5\u7684\u503c\u61c9\u589e\u52a0\u4e00\u5929\u3002\u5982\u679c\u6b64\u503c\u843d\u5f8c\u8d85\u904e 24 \u5c0f\u6642\uff0c\u5247\u66f4\u65b0\u4e0d\u6703\u6309\u9810\u671f\u904b\u884c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u67e5\u770b App Engine \u65e5\u8a8c\u3002\n\u7b2c\u4e8c\u7a2e\u65b9\u6cd5\u662f\u5728 BigQuery \u4e2d\u67e5\u8a62\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u8868\u3002\u6b64\u65b9\u6cd5\u9700\u8981\u5728\u60a8\u7684\u914d\u7f6e\u4e2d\u5553\u7528\u6a19\u8a18\u6b77\u53f2\u8a18\u9304\u9078\u9805\u3002\u4ee5\u4e0b\u5c4f\u5e55\u622a\u5716\u986f\u793a\uff0c `cities_311` \u6a19\u8a18\u7684\u4e0a\u6b21\u66f4\u65b0\u6642\u9593\u7232 2022 \u5e74 2 \u6708 20 \u65e5\u3002\n\u7b2c\u4e09\u7a2e\u65b9\u6cd5\u662f\u5728 Firestore \u4e2d\u641c\u7d22\u914d\u7f6e\u6587\u6a94\uff0c\u4ee5\u6aa2\u67e5 Tag Engine \u914d\u7f6e\u5b58\u5132\u5340\u3002\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u6aa2\u67e5 Tag Engine \u914d\u7f6e\u5b58\u5132\u5340\uff1a\n- \u6253\u958b [Firestore](https://console.cloud.google.com/firestore?hl=zh-cn) \uff0c\u7136\u5f8c\u5728 `dynamic_table_configs` \u96c6\u5408\u4e2d\u67e5\u627e\u914d\u7f6e\u6587\u6a94\u3002\u5982\u679c\u60a8\u7684\u96c6\u5408\u5305\u542b\u5927\u91cf\u6587\u6a94\uff0c\u60a8\u53ef\u4ee5\u6309 `config_status = ACTIVE` \u6216 `config_type = DYNAMIC_TABLE_TAG` \u904e\u6ffe\u6587\u6a94\u3002\n- \u5728\u5305\u542b\u914d\u7f6e\u7684\u6587\u6a94\u4e2d\uff0c\u627e\u5230\u5b89\u6392\u90e8\u5206\u4e26\u67e5\u627e\u4ee5\u4e0b\u5b57\u6bb5\uff1a\n- `next_run` \uff1a\u8868\u793a\u5141\u8a31 Tag Engine \u66f4\u65b0\u6a19\u8a18\u7684\u6700\u65e9\u6642\u9593\n- `scheduling_status` \uff1a\u8868\u793a\u914d\u7f6e\u662f\u5426\u5df2\u6e96\u5099\u597d\u9032\u884c\u66f4\u65b0\n- `version` \uff1a\u8868\u793a\u5df2\u767c\u751f\u7684\u66f4\u65b0\u6578\n- \u7232\u78ba\u4fdd\u66f4\u65b0\u904b\u884c\uff0c\u8acb\u5c07 `scheduling_status` \u5b57\u6bb5\u8a2d\u7f6e\u7232\u201c\u5c31\u7dd2\u201d\uff0c\u4e26\u78ba\u4fdd `next_run` \u5b57\u6bb5\u7232\u6642\u9593\u6233\u3002## \u5275\u5efa\u975c\u614b\u6a19\u8a18\u914d\u7f6e\n\u8207\u52d5\u614b\u6a19\u8a18\u914d\u7f6e\u4e0d\u540c\uff0c\u975c\u614b\u6a19\u8a18\u914d\u7f6e\u9069\u7528\u65bc\u586b\u5145\u5f88\u5c11\u66f4\u6539\u7684\u5143\u6578\u64da\u5c6c\u6027\uff0c\u4f8b\u5982\u6578\u64da\u8cc7\u7522\u7684\u6240\u6709\u8005\u6216\u6578\u64da\u8cc7\u7522\u7684\u7db2\u57df\u3002 \u8207\u52d5\u614b\u914d\u7f6e\u4e00\u6a23\uff0c\u975c\u614b\u6a19\u8a18\u914d\u7f6e\u6703\u751f\u6210\u591a\u500b Data Catalog \u6a19\u8a18\u3002\u6bcf\u500b\u6a19\u8a18\u90fd\u8207\u552f\u4e00\u7684 BigQuery \u6216 Cloud Storage \u8cc7\u6e90\u76f8\u95dc\u806f\uff0c\u4f8b\u5982\u6578\u64da\u96c6\u3001\u8868\u3001\u8996\u5716\u3001\u5b58\u5132\u6876\u3001\u6587\u4ef6\u593e\u6216\u6587\u4ef6\u3002\u8207\u52d5\u614b\u914d\u7f6e\u4e0d\u540c\uff0c\u975c\u614b\u914d\u7f6e\u6703\u7232\u6a19\u8a18\u4e2d\u5305\u542b\u7684\u6bcf\u500b\u6a21\u677f\u5b57\u6bb5\u5206\u914d\u4e00\u500b\u5e38\u91cf\u503c\u3002\u56e0\u6b64\uff0c\u975c\u614b\u6a19\u8a18\u914d\u7f6e\u751f\u6210\u7684\u6240\u6709\u6a19\u8a18\u90fd\u5305\u542b\u76f8\u540c\u7684\u5143\u6578\u64da\u503c\u3002\u5982\u9700\u5275\u5efa\u975c\u614b\u6a19\u8a18\u4f86\u6a19\u8a18\u4e09\u500b `cities_311` \u8868\uff0c\u8acb\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9a5f\uff1a\n- \u5728 Tag Engine \u7740\u9678\u9801\u4e0a\uff0c\u8f38\u5165\u4ee5\u4e0b `data_governance` \u6a19\u8a18\u6a21\u677f\u8a73\u7d30\u4fe1\u606f\uff1a- **\u6a19\u8a18\u6a21\u677f ID** \uff1a`data_governance`\n- **Google Cloud \u9805\u76ee ID** \uff1a\n- **Google Cloud \u5340\u57df** \uff1a`us-central1`\n\u5c07 \u66ff\u63db\u7232\u60a8\u7684 Tag Engine \u9805\u76ee\u7684 ID\u3002 \n- \u9ede\u64ca **\u641c\u7d22\u6a21\u677f** \u3002\u6b64\u6642\u6703\u986f\u793a **data_governance \u6a19\u8a18\u6a21\u677f\u8a73\u7d30\u4fe1\u606f** \u9801\u9762\u3002\n- \u5728 **data_governance \u6a19\u8a18\u6a21\u677f\u8a73\u7d30\u4fe1\u606f** \u9801\u9762\u4e0a\uff0c\u9ede\u64ca **\u5275\u5efa\u975c\u614b\u8cc7\u7522\u6a19\u8a18** \u3002 \n- \u5728 **\u7528\u65bc\u5275\u5efa\u975c\u614b\u8cc7\u7522\u6a19\u8a18\u7684\u914d\u7f6e** \u9801\u9762\u4e0a\uff0c\u5728 **\u6a21\u677f\u5b57\u6bb5\u503c** \u90e8\u5206\u8f38\u5165\u4ee5\u4e0b\u8a73\u7d30\u4fe1\u606f\uff1a- **data_domain (enum)** \uff1a`GOVERNMENT`\n- **broad_data_category (enum)** \uff1a`CONTENT`\n- **environment (enum)** \uff1a`DEV`\n- **data_origin (enum)** \uff1a`OPEN_DATA`\n- **data_creation (datetime)** \uff1a`2022-11-08 20:40:50`\n- **data_ownership (enum)** \uff1a`PUBLIC_DOMAIN`\n- **data_asset_owner (string)** \uff1a`Emily Doe`\n- **data_asset_expert (string)** \uff1a`John Smith`\n- **data_confidentiality (enum)** \uff1a`PUBLIC`\n- **data_retention (enum)** \uff1a`30_DAYS`\n- **data_asset_documentation (string)** \uff1a [https://support.datasf.org/help/311-case-data-faq](https://support.datasf.org/help/311-case-data-faq) \n **\u6ce8\u610f** \uff1a **data_creating** \u5b57\u6bb5\u7684\u503c\u9ed8\u8a8d\u7232\u7576\u524d\u65e5\u671f\u548c\u6642\u9593\u3002 \n- \u5728\u9801\u9762\u7684 BigQuery \u6216 Google Cloud Storage \u8cc7\u7522\u90e8\u5206\u4e2d\u8f38\u5165\u4ee5\u4e0b\u503c\uff1a- **\u5305\u542b\u7684\u8cc7\u7522 URI** \uff1a`bigquery/project/` `` `/dataset/cities_311/*`\n\u5c07 \u66ff\u63db\u7232\u60a8\u7684 BigQuery \u9805\u76ee\u7684 ID\u3002- **\u6392\u9664\u7684\u8cc7\u7522 URI** \uff1a\u5c07\u6b64\u5b57\u6bb5\u7559\u7a7a\u3002\u6c92\u6709\u8981\u6392\u9664\u7684\u8868\u3002\n \n- \u5728 **\u66f4\u65b0\u9078\u9805** \u90e8\u5206\u4e2d\uff0c\u8f38\u5165\u4ee5\u4e0b\u503c\uff1a- **\u5237\u65b0\u6a21\u5f0f** \uff1a`AUTO`\n- **\u5237\u65b0\u983b\u7387** \uff1a`24 hours`\n **\u6ce8\u610f** \uff1a\u975c\u614b\u914d\u7f6e\u7684\u66f4\u65b0\u9078\u9805\u8207\u52d5\u614b\u914d\u7f6e\u5177\u6709\u4e0d\u540c\u7684\u8a9e\u7fa9\u3002\u5c0d\u65bc\u975c\u614b\u914d\u7f6e\uff0c\u5237\u65b0\u6a21\u5f0f\u7232 `AUTO` \u8868\u793a Tag Engine \u6703\u6309\u6307\u5b9a\u7684\u5237\u65b0\u983b\u7387\u6a19\u8a18\u8207\u5305\u542b\u7684\u8cc7\u7522 URI \u5339\u914d\u7684\u6240\u6709\u65b0\u8cc7\u7522\u3002\u5237\u65b0\u6a21\u5f0f\u7232 `ON-DEMAND` \u8868\u793a\u60a8\u53ef\u4ee5\u5728\u65b9\u4fbf\u6642\u5f9e API \u89f8\u767c\u66f4\u65b0\u3002\u7121\u8ad6\u662f\u54ea\u7a2e\u60c5\u6cc1\uff0c\u5df2\u901a\u904e\u6b64\u914d\u7f6e\u6a19\u8a18\u7684\u8cc7\u7522\u5728\u66f4\u65b0\u671f\u9593\u4e0d\u6703\u88ab\u91cd\u65b0\u6a19\u8a18\u3002\n- \u9078\u4e2d **\u6a19\u8a18\u6b77\u53f2\u8a18\u9304** \u548c **\u6a19\u8a18\u6d41** \u9019\u5169\u500b\u6846\uff0c\u63a5\u53d7\u9ed8\u8a8d\u503c\u3002\n- \u9ede\u64ca **\u63d0\u4ea4\u6a19\u8a18\u914d\u7f6e** \u4ee5\u63d0\u4ea4\u975c\u614b\u6a19\u8a18\u914d\u7f6e\u3002\u6b64\u6642\u6703\u986f\u793a\u4e00\u500b\u78ba\u8a8d\u9801\u9762\uff0c\u8868\u793a\u8a72\u8acb\u6c42\u6b63\u5728\u8655\u7406\u3002\u8981\u67e5\u770b\u914d\u7f6e\u7684\u72c0\u614b\uff0c\u8acb\u9ede\u64ca **\u6b64\u8655** \u93c8\u63a5\u3002\u6a19\u8a18\u5b8c\u6210\u5f8c\uff0c\u72c0\u614b\u61c9\u5728\u5e7e\u79d2\u9418\u5167\u66f4\u6539\u7232 `ACTIVE` \u3002\u8f03\u5927\u7684\u4f5c\u696d\u9700\u8981\u66f4\u9577\u7684\u6642\u9593\u3002\u4f5c\u696d\u5728\u521d\u59cb\u5316\u4e26\u904b\u884c\u6642\u7684\u72c0\u614b\u986f\u793a\u7232 `PENDING` \u548c `PROCESSING` \u3002\n- \u6253\u958b [Data Catalog](https://console.cloud.google.com/datacatalog?hl=zh-cn) \u754c\u9762\u4ee5\u9a57\u8b49\u751f\u6210\u7684\u6a19\u8a18\u3002\n- \u4f7f\u7528 `tag:data_governance` \u641c\u7d22\u689d\u76ee\u3002\u7d50\u679c\u4e2d\u6703\u986f\u793a\u4e09\u500b `cities_311` \u8868\u3002\u6bcf\u500b\u689d\u76ee\u90fd\u5305\u542b\u4e00\u500b `data_governance` \u6a19\u8a18\uff0c\u5176\u4e2d\u5305\u542b\u60a8\u5728\u975c\u614b\u914d\u7f6e\u4e2d\u6307\u5b9a\u7684\u5b57\u6bb5\u540d\u7a31\u548c\u503c\u3002\u7d50\u679c\u61c9\u985e\u4f3c\u65bc\u4ee5\u4e0b\u5c4f\u5e55\u622a\u5716\uff1a ## \u901a\u904e API \u5275\u5efa\u914d\u7f6e\u4e26\u89f8\u767c\u6a19\u8a18\u66f4\u65b0\nTag Engine \u63d0\u4f9b\u4e86\u5404\u7a2e\u7528\u65bc\u5275\u5efa\u975c\u614b\u548c\u52d5\u614b\u914d\u7f6e\u4ee5\u53ca\u89f8\u767c\u6a19\u8a18\u66f4\u65b0\u7684 API \u65b9\u6cd5\u3002\u5c0d\u65bc\u6bcf\u7a2e\u65b9\u6cd5\uff0c\u4ee3\u78bc\u5eab\u7684 `/examples` \u6587\u4ef6\u593e\u90fd\u6709\u5404\u7a2e\u793a\u4f8b\u3002 `static_asset_configs` \u793a\u4f8b\u57fa\u65bc `data_governance` \u6a19\u8a18\u6a21\u677f\uff0c `dynamic_table_configs` \u793a\u4f8b\u57fa\u65bc `cities_311` \u6a19\u8a18\u6a21\u677f\u3002\n- `static_asset_tags` \uff1a\u6839\u64da JSON \u683c\u5f0f\u7684\u914d\u7f6e\u8acb\u6c42\u5275\u5efa\u975c\u614b\u8cc7\u7522\u914d\u7f6e\u3002\u8fd4\u56de\u4f5c\u696d\u6a19\u8b58\u7b26\u3002 [\u793a\u4f8b\u8acb\u6c42](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/blob/main/examples/static_asset_configs/static_asset_create_auto_bq.json) \u3002\n- `dynamic_table_tags` \uff1a\u6839\u64da JSON \u683c\u5f0f\u7684\u914d\u7f6e\u8acb\u6c42\u5275\u5efa\u52d5\u614b\u8868\u914d\u7f6e\u3002\u8fd4\u56de\u4f5c\u696d\u6a19\u8b58\u7b26\u3002 [\u793a\u4f8b\u8acb\u6c42](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/tree/main/examples/dynamic_table_configs) \u3002\n- `dynamic_column_tags` \uff1a\u6839\u64da JSON \u683c\u5f0f\u7684\u914d\u7f6e\u8acb\u6c42\u5275\u5efa\u52d5\u614b\u5217\u914d\u7f6e\u3002\u8fd4\u56de\u4f5c\u696d\u6a19\u8b58\u7b26\u3002 [\u793a\u4f8b\u8acb\u6c42](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/blob/main/examples/dynamic_column_configs/dynamic_column_create_auto.json) \u3002\n- `ondemand_updates` \uff1a\u89f8\u767c\u66f4\u65b0\u8acb\u6c42\u3002\u8a72\u8acb\u6c42\u6703\u66f4\u65b0\u6a19\u8a18\u7684\u5167\u5bb9\uff08\u52d5\u614b\u914d\u7f6e\uff09\uff0c\u6216\u7232\u4efb\u4f55\u65b0\u8cc7\u7522\u5275\u5efa\u6a19\u8a18\uff08\u975c\u614b\u914d\u7f6e\uff09\u3002\u9700\u8981\u5c07 refresh_mode \u8a2d\u7f6e\u7232 `ON_DEMAND` \u7684\u975c\u614b\u6216\u52d5\u614b\u914d\u7f6e\u3002\u8acb\u6c42\u63a1\u7528 JSON \u683c\u5f0f\u3002\u8fd4\u56de\u4f5c\u696d\u6a19\u8b58\u7b26\u3002 [\u793a\u4f8b\u8acb\u6c42\u3002](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/blob/main/examples/dynamic_table_configs/dynamic_table_update_ondemand.json) \n- `get_job_status` \uff1a\u8fd4\u56de\u5275\u5efa\u6216\u66f4\u65b0\u4f5c\u696d\u7684\u4ee5\u4e0b\u72c0\u614b\u3002\u9700\u8981\u4f5c\u696d\u6a19\u8b58\u7b26\u3002- `job_status`\n- `success`\n- `task_count`\n- `tasks_completed`\n- `tasks_failed`\n- `tasks_ran`\n### \u5275\u5efa\u52d5\u614b\u8868\u914d\u7f6e\n\u4ee5\u4e0b\u6b65\u9a5f\u5c55\u793a\u77ad\u5982\u4f55\u4f7f\u7528\u63d0\u4f9b\u7684 `cities_311` \u6a19\u8a18\u6a21\u677f\u7684\u914d\u7f6e\u8acb\u6c42\u8abf\u7528 `dynamic_table_tags` \u65b9\u6cd5\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u4fee\u6539 [examples/dynamic_table_configs/dynamic_table_create_ondemand.json](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/blob/main/examples/dynamic_table_configs/dynamic_table_create_ondemand.json) \u6587\u4ef6\u3002\u5c07 `template_project` \u3001 `template_region` \u548c `included_tables_uris` \u5b57\u6bb5\u7684\u503c\u66ff\u63db\u7232\u60a8\u7684 Tag Engine \u9805\u76ee\u3001Tag Engine \u5340\u57df\u548c BigQuery \u9805\u76ee\u3002\n- \u9032\u884c API \u8abf\u7528\u4ee5\u5275\u5efa\u52d5\u614b\u93c8\u63a5\u914d\u7f6e\uff1a```\nexport TAG_ENGINE_URL=https://${TAG_ENGINE_PROJECT}.uc.r.appspot.comRESPONSE_JSON=$(curl -X POST ${TAG_ENGINE_URL}/dynamic_create -d @examples/dynamic_table_configs/dynamic_table_create_ondemand.json)JOB_ID=$(echo ${RESPONSE_JSON} | jq -r \".job_uuid\")echo \"Job ID: ${JOB_ID}\"\n```\u5982\u679c\u8acb\u6c42\u6210\u529f\uff0cAPI \u65b9\u6cd5\u5c07\u8fd4\u56de\u4f5c\u696d\u6a19\u8b58\u7b26\u3002\u5982\u679c\u8acb\u6c42\u5931\u6557\uff0c\u5247\u8f38\u51fa\u6703\u8a73\u7d30\u8aaa\u660e\u932f\u8aa4\u3002\u60a8\u9084\u53ef\u4ee5\u901a\u904e\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u5728 App Engine \u65e5\u8a8c\u4e2d\u627e\u5230\u5176\u4ed6\u8a73\u7d30\u4fe1\u606f\uff1a `gcloud app logs tail -s default`\n- \u5982\u9700\u8acb\u6c42\u4f5c\u696d\u7684\u72c0\u614b\uff0c\u8acb\u4f7f\u7528\u4e0a\u4e00\u6b65\u4e2d\u7684\u4f5c\u696d\u6a19\u8b58\u7b26\uff1a```\ncurl -X POST ${TAG_ENGINE_URL}/get_job_status \\-d \"{\\\"job_uuid\\\":\\\"${JOB_ID}\\\"}\"\n```\u8f38\u51fa\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\uff1a```\n{\"job_status\":\"COMPLETED\",\"success\":true,\"task_count\":3,\"tasks_completed\":3,\"tasks_failed\":0,\"tasks_ran\":3}\n```\u4f5c\u696d\u5b8c\u6210\u5f8c\uff0c\u5c07\u8fd4\u56de `COMPLETED` \u72c0\u614b\u3002\u5982\u9700\u67e5\u770b\u751f\u6210\u7684\u6a19\u8a18\uff0c\u8acb\u8f49\u5230 Data Catalog\u3002\n### \u901a\u904e API \u89f8\u767c\u6a19\u8a18\u66f4\u65b0\n\u7531\u65bc\u60a8\u5275\u5efa\u4e86\u6309\u9700\u5b89\u6392 ( `refresh_mode: ON_DEMAND` ) \u7684\u914d\u7f6e\uff0c\u56e0\u6b64\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 API \u89f8\u767c\u5176\u6a19\u8a18\u66f4\u65b0\u3002\u6a19\u8a18\u7684\u66f4\u65b0\u5b89\u6392\u6539\u8b8a\u6642\uff0c\u6309\u9700\u5b89\u6392\u5c31\u975e\u5e38\u6709\u7528\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u8acb\u52ff\u4f7f\u7528\u81ea\u52d5\u5b89\u6392\u6a21\u5f0f\u3002\u800c\u662f\u61c9\u8a72\u5c07\u914d\u7f6e\u8a2d\u7f6e\u7232\u6309\u9700\u8abf\u5ea6\uff0c\u4e26\u4f7f\u7528 `ondemand_updates` \u65b9\u6cd5\u89f8\u767c\u6a19\u8a18\u66f4\u65b0\u3002\n### \u5275\u5efa\u52d5\u614b\u8868\u66f4\u65b0\n- \u4fee\u6539\u6587\u4ef6 [examples/dynamic_table_configs/dynamic_table_update_ondemand.json](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/blob/main/examples/dynamic_table_configs/dynamic_table_update_ondemand.json) \u3002 \u66ff\u63db\u4ee5\u4e0b\u503c\uff1a- `template_project`\uff1aTag Engine \u9805\u76ee ID\n- `template_region`\uff1a`us-central1`\n- `included_tables_uris`\uff1aBigQuery \u9805\u76ee URI\n- \u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a```\nRESPONSE_JSON=$(curl -X POST ${TAG_ENGINE_URL}/ondemand_updates -d @examples/dynamic_table_configs/dynamic_table_update_ondemand.json)JOB_ID=$(echo ${RESPONSE_JSON} | jq -r \".job_uuid\")echo \"Job ID: ${JOB_ID}\"\n```\u5982\u679c\u8acb\u6c42\u6210\u529f\uff0c\u5247\u6b64\u65b9\u6cd5\u6703\u8fd4\u56de\u4f5c\u696d\u6a19\u8b58\u7b26\u3002\n- \u8981\u63d0\u53d6\u4f5c\u696d\u7684\u72c0\u614b\uff0c\u8acb\u8abf\u7528 `get_job_status` \u65b9\u6cd5\uff1a```\ncurl -X POST ${TAG_ENGINE_URL}/get_job_status \\-d \"{\\\"job_uuid\\\":\\\"${JOB_ID}\\\"}\"\n```\n### \u5275\u5efa\u975c\u614b\u6a19\u8a18\u914d\u7f6e\u4e26\u89f8\u767c\u66f4\u65b0\nTag Engine \u63d0\u4f9b\u7528\u65bc\u5275\u5efa\u975c\u614b\u8cc7\u7522\u914d\u7f6e\u7684 API \u65b9\u6cd5 `static_asset_tags` \u3002\u6b64\u65b9\u6cd5\u5c07 JSON \u5c0d\u8c61\u4f5c\u7232\u8f38\u5165\u63a5\u6536\u4e26\u8fd4\u56de\u4f5c\u696d\u6a19\u8b58\u7b26\u3002\u4ee5\u4e0b\u6b65\u9a5f\u5c55\u793a\u77ad\u5982\u4f55\u4f7f\u7528\u6578\u64da\u6cbb\u7406\u6a19\u8a18\u6a21\u677f\u5275\u5efa\u975c\u614b\u914d\u7f6e\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u4fee\u6539\u6587\u4ef6 [examples/static_asset_configs/static_asset_create_ondemand_bq.json](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/blob/main/examples/static_asset_configs/static_asset_create_ondemand_bq.json) \u3002\u66ff\u63db\u4ee5\u4e0b\u503c\uff1a- `template_project`\uff1aTag Engine \u9805\u76ee ID\n- `template_region`\uff1a`us-central1`\n- `included_assets_uris`\uff1aBigQuery \u9805\u76ee URI\n- \u9032\u884c API \u8abf\u7528\u4ee5\u5275\u5efa\u975c\u614b\u914d\u7f6e\uff1a```\nRESPONSE_JSON=$(curl -X POST ${TAG_ENGINE_URL}/static_asset_tags -d @examples/static_asset_configs/static_asset_create_ondemand_bq.json)JOB_ID=$(echo ${RESPONSE_JSON} | jq -r \".job_uuid\")echo \"Job ID: ${JOB_ID}\"\n```\n\u5982\u679c\u8acb\u6c42\u6210\u529f\uff0cAPI \u65b9\u6cd5\u5c07\u8fd4\u56de\u4f5c\u696d\u6a19\u8b58\u7b26\u3002\u5982\u679c\u8acb\u6c42\u5931\u6557\uff0c\u5247\u8f38\u51fa\u6703\u8a73\u7d30\u8aaa\u660e\u932f\u8aa4\u3002\n- \uff08\u53ef\u9078\uff09\u901a\u904e\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u5728 App Engine \u65e5\u8a8c\u4e2d\u67e5\u627e\u5176\u4ed6\u8a73\u7d30\u4fe1\u606f\uff1a```\ngcloud app logs tail -s default\n```\n- \u5982\u9700\u8acb\u6c42\u4f5c\u696d\u7684\u72c0\u614b\uff0c\u8acb\u4f7f\u7528\u4e0a\u4e00\u6b65\u4e2d\u7684\u4f5c\u696d\u6a19\u8b58\u7b26\uff1a```\ncurl -X POST ${TAG_ENGINE_URL}/get_job_status \\-d \"{\\\"job_uuid\\\":\\\"${JOB_ID}\\\"}\"\n```\u8f38\u51fa\u985e\u4f3c\u4ee5\u4e0b\u5167\u5bb9\uff1a```\n {\"job_status\":\"RUNNING\",\"success\":true,\"task_count\":3,\"tasks_completed\":0,\"tasks_failed\":0,\"tasks_ran\":0}\n```## \u57f7\u884c\u8ca0\u8f09\u6e2c\u8a66\nTag Engine \u63d0\u4f9b\u5404\u7a2e\u5be6\u7528\u7a0b\u5e8f\u548c\u793a\u4f8b\uff0c\u7528\u65bc\u5c0d\u5176\u6279\u91cf\u6a19\u8a18\u529f\u80fd\u9032\u884c\u8ca0\u8f09\u6e2c\u8a66\u3002 `load_testing` \u6587\u4ef6\u593e\u5305\u542b\u7528\u65bc\u514b\u9686\u548c\u52a0\u8f09 BigQuery \u8868\u7684 Python \u8173\u672c\u3002\u6b64\u6587\u4ef6\u593e\u4e2d\u7684 `*_standalone.py` \u8173\u672c\u5728\u55ae\u81fa\u6a5f\u5668\u4e0a\u904b\u884c\uff0c\u4e26\u6309\u9806\u5e8f\u5275\u5efa BigQuery \u8868\u3002\u540c\u4e00\u6587\u4ef6\u593e\u4e2d\u7684 `*_distributed.py` \u8173\u672c\u4f7f\u7528 Cloud Tasks \u548c Cloud Functions \u4e26\u884c\u5275\u5efa BigQuery \u8868\u3002\u9084\u6709\u4e00\u500b `check_tags.py` \u8173\u672c\uff0c\u7528\u65bc\u8988\u5be6 BigQuery \u6578\u64da\u96c6\u4e2d\u6a19\u8a18\u8cc7\u7522\u7684\u6578\u91cf\u3002\n`examples` \u76ee\u9304\u4e2d\u6709\u9069\u7528\u65bc\u5404\u7a2e\u6279\u6b21\u5927\u5c0f\u7684 JSON \u683c\u5f0f\u7684\u914d\u7f6e\u8acb\u6c42\u6587\u4ef6\uff0c\u91dd\u5c0d\u975c\u614b\u548c\u52d5\u614b\u985e\u578b\u90fd\u6709\u63d0\u4f9b\u3002\u914d\u7f6e\u57fa\u65bc\u672c\u6307\u5357\u4e2d\u4f7f\u7528\u7684 `cities_311` \u548c `data_governance` \u6a19\u8a18\u6a21\u677f\u3002\n\u4e0b\u8868\u63d0\u4f9b\u975c\u614b\u793a\u4f8b\u914d\u7f6e\u53ca\u5176\u5e73\u5747\u904b\u884c\u6642\u7684\u6458\u8981\uff1a\n| \u6279\u6b21\u5927\u5c0f  | \u914d\u7f6e\u6587\u4ef6   | \u904b\u884c\u6642 (HH:MM) |\n|:----------------|:--------------------|:-----------------|\n| 500 \u6b21\u6a19\u8a18\u5beb\u5165 | static create 500 | 00:01   |\n| 5000 \u6b21\u6a19\u8a18\u5beb\u5165 | static create 5k | 00:06   |\n| 5 \u842c\u6b21\u6a19\u8a18\u5beb\u5165 | static create 50k | 01:02   |\n| 50 \u842c\u6b21\u6a19\u8a18\u5beb\u5165 | static create 500k | 14:17   |\n\u7531\u65bc\u67e5\u8a62 BigQuery \u6642\u9700\u8981\u9032\u884c\u984d\u5916\u7684\u8655\u7406\uff0c\u56e0\u6b64\u5c0d\u540c\u4e00\u6279\u6b21\u5927\u5c0f\u800c\u8a00\uff0c\u52d5\u614b\u914d\u7f6e\u901a\u5e38\u6bd4\u975c\u614b\u914d\u7f6e\u5177\u6709\u66f4\u5927\u7684\u904b\u884c\u6642\u548c\u66f4\u9ad8\u7684\u8cbb\u7528\u3002\n## \u5275\u5efa\u8986\u84cb\u7387\u5831\u544a\nTag Engine \u63d0\u4f9b\u7684\u5831\u544a\u5f59\u7e3d\u4e86\u6574\u500b\u6578\u64da\u8cc7\u7522\u4e2d\u7684 Data Catalog \u6a19\u8a18\u3002\u8a72\u5831\u544a\u5217\u51fa\u4e86\u6bcf\u500b\u6578\u64da\u8cc7\u7522\u53ca\u5176\u6a19\u8a18\u7684\u6578\u91cf\u3002\u60a8\u53ef\u4ee5\u5c07\u5831\u544a\u914d\u7f6e\u7232\u5305\u542b\u591a\u500b\u9805\u76ee\u3002\u60a8\u9084\u53ef\u4ee5\u5c07\u5831\u544a\u914d\u7f6e\u7232\u5f9e\u9805\u76ee\u4e2d\u6392\u9664\u67d0\u4e9b\u6578\u64da\u96c6\u548c\u8868\u3002\u8acb\u6309\u7167\u4ee5\u4e0b\u6b65\u9a5f\u914d\u7f6e\u8986\u84cb\u7387\u5831\u544a\u3002\n- \u5728 Tag Engine \u9996\u9801\u4e0a\uff0c\u9ede\u64ca **\u914d\u7f6e\u8986\u84cb\u7387\u5831\u544a** \u3002\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0c\u9805\u76ee\u4e2d\u7684\u6240\u6709\u6578\u64da\u96c6\u90fd\u5305\u542b\u5728\u5831\u544a\u4e2d\u3002\u5982\u679c\u60a8\u60f3\u5f9e\u5831\u544a\u4e2d\u6392\u9664\u67d0\u4e9b\u6578\u64da\u96c6\u548c\u8868\uff0c\u8acb\u5728\u76f8\u61c9\u5b57\u6bb5\u4e2d\u6307\u5b9a\u5b83\u5011\u3002\u4fdd\u5b58\u8986\u84cb\u7387\u5831\u544a\u8a2d\u7f6e\u3002\n- \u5728 **\u8986\u84cb\u7387\u5831\u544a\u8a2d\u7f6e** \u9801\u9762\u4e2d\u586b\u5beb\u9805\u76ee\u8a73\u7d30\u4fe1\u606f\uff0c\u7136\u5f8c\u9ede\u64ca **\u4fdd\u5b58** \u3002\n- \u9ede\u64ca **\u8986\u84cb\u7387\u5831\u544a** \u3002\u5831\u544a\u6703\u66f4\u6539\uff0c\u4ee5\u53cd\u6620\u6bcf\u500b\u8cc7\u7522\u7684\u6a19\u8a18\u6578\u91cf\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5728 `cities_311` \u6a21\u677f\u4e0a\u5275\u5efa\u4e86\u52d5\u614b\u8868\u914d\u7f6e\uff0c\u5728 `data_governance` \u6a21\u677f\u4e0a\u5275\u5efa\u4e86\u975c\u614b\u8cc7\u7522\u914d\u7f6e\uff0c\u60a8\u6703\u5728\u4e09\u500b BigQuery \u8868\u4e2d\u7684\u6bcf\u500b\u8868\u4e0a\u770b\u5230\u5169\u500b\u6a19\u8a18\uff0c\u5982\u4ee5\u4e0b\u5c4f\u5e55\u622a\u5716\u6240\u793a\uff1a ## \u5f8c\u7e8c\u6b65\u9a5f\n- [Tag Engine \u4ee3\u78bc\u5eab](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine) \n- [Cloud Run \u4e0a\u7684 Tag Engine](https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/tree/cloud-run) \n- [\u67e5\u770b\u793a\u4f8b\u6a19\u8a18\u6a21\u677f](https://github.com/GoogleCloudPlatform/datacatalog-templates) \n- [\u5275\u5efa\u6a19\u8a18\u6a21\u677f](https://github.com/GoogleCloudPlatform/datacatalog-templates/blob/master/create_template.py) \n- [\u6539\u9032\u6a19\u8a18\u6a21\u677f](https://github.com/GoogleCloudPlatform/datacatalog-templates/blob/master/evolve_template.py)", "guide": "Docs"}