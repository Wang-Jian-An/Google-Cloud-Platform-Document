{"title": "Docs - Google Cloud \u4e0a\u8eab\u4efd\u548c\u8a2a\u554f\u6b0a\u9650\u6cbb\u7406\u7684\u6a21\u5f0f\u548c\u505a\u6cd5", "url": "https://cloud.google.com/architecture/patterns-practices-identity-access-governance-google-cloud?hl=zh-cn", "abstract": "# Docs - Google Cloud \u4e0a\u8eab\u4efd\u548c\u8a2a\u554f\u6b0a\u9650\u6cbb\u7406\u7684\u6a21\u5f0f\u548c\u505a\u6cd5\nLast reviewed 2022-09-27 UTC\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u591a\u7a2e Google Cloud \u7522\u54c1\u548c\u670d\u52d9\uff0c\u5e6b\u52a9\u60a8\u7684\u7d44\u7e54\u7232\u5728 Google Cloud \u4e0a\u904b\u884c\u7684\u61c9\u7528\u548c\u5de5\u4f5c\u8ca0\u8f09\u958b\u767c\u8eab\u4efd\u6cbb\u7406\u548c\u8a2a\u554f\u6b0a\u9650\u7ba1\u7406\u65b9\u6cd5\u3002\u672c\u6587\u6a94\u9762\u5411\u5728\u5ba2\u6236\u5718\u968a\u4e2d\u5de5\u4f5c\u4ee5\u53ca\u5e0c\u671b\u77ad\u89e3\u9019\u4e9b\u5de5\u5177\u548c\u63a7\u4ef6\u53ca\u5176\u4f7f\u7528\u65b9\u5f0f\u7684\u5b89\u5168\u7ba1\u7406\u54e1\u3001\u904b\u71df\u7ba1\u7406\u54e1\u548c\u4f01\u696d\u67b6\u69cb\u5e2b\u3002\n\u672c\u6587\u6a94\u5047\u5b9a\u60a8\u5177\u5099\u4ee5\u4e0b\u5404\u9805\uff1a\n- Google Cloud \u9805\u76ee\n- \u64c1\u6709\u7ba1\u7406\u54e1\u6b0a\u9650\u7684\u7528\u6236\u8cec\u865f\uff0c\u7528\u65bc\u7ba1\u7406 Cloud Identity \u7fa3\u7d44\u548c\u7528\u6236\u3002\u60a8\u9700\u8981\u6b64\u8a2a\u554f\u6b0a\u9650\u624d\u80fd\u904b\u884c\u672c\u6587\u6a94\u4e2d\u7684\u793a\u4f8b\u904e\u7a0b\u3002\n- \u4e0d\u5177\u5099\u53ef\u7528\u65bc\u7ba1\u7406 Cloud Identity \u7fa3\u7d44\u548c\u7528\u6236\u7684\u7ba1\u7406\u54e1\u6b0a\u9650\u7684\u7528\u6236\u8cec\u865f\u3002\u60a8\u9700\u8981\u4f7f\u7528\u6b64\u8cec\u865f\u6e2c\u8a66\u60a8\u5728\u672c\u6587\u6a94\u7684\u793a\u4f8b\u6b65\u9a5f\u4e2d\u8a2d\u7f6e\u7684\u4e00\u4e9b\u63a7\u5236\u63aa\u65bd\u3002\u5982\u679c\u60a8\u9084\u6c92\u6709\u5c0d Google Cloud \u9805\u76ee\u7684\u8a2a\u554f\u6b0a\u9650\u4ee5\u53ca\u5c0d Cloud Identity \u7684\u7ba1\u7406\u54e1\u6b0a\u9650\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa Google Cloud \u9805\u76ee](https://cloud.google.com/resource-manager/docs/creating-managing-projects?hl=zh-cn) \u548c [\u8a2d\u7f6e Cloud Identity](https://cloud.google.com/identity/docs/set-up-cloud-identity-admin?hl=zh-cn) \u3002", "content": "## \u767c\u73fe\u672a\u4f7f\u7528\u7684\u8cec\u865f\u548c\u6b0a\u9650\n\u7576\u4e0d\u518d\u9700\u8981\u7528\u6236\u8cec\u865f\u6642\uff0c\u6700\u4f73\u505a\u6cd5\u662f\u79fb\u9664\u7528\u6236\u8cec\u865f\uff0c\u56e0\u7232\u672a\u4f7f\u7528\uff08\u5b64\u7acb\u7684\uff09\u7528\u6236\u8cec\u865f\u548c\u670d\u52d9\u8cec\u865f\u6703\u5e36\u4f86\u5b89\u5168\u98a8\u96aa\u3002\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u65b9\u5f0f\u4f7f\u7528 Google Cloud [Policy Intelligence](https://cloud.google.com/policy-intelligence?hl=zh-cn) \u4f86\u5e6b\u52a9\u4f01\u696d\u77ad\u89e3\u4e26\u964d\u4f4e\u98a8\u96aa\uff1a\n- \u5e6b\u52a9\u4f01\u696d\u4e2d\u7684\u7ba1\u7406\u54e1\u767c\u73fe\u4e0d\u518d\u4f7f\u7528\u7684\u8cec\u865f\u548c\u6b0a\u9650\uff0c\u4f8b\u5982\u54e1\u5de5\u96e2\u958b\u516c\u53f8\u6216\u66f4\u6539\u89d2\u8272\u4e4b\u985e\u7684\u539f\u56e0\u3002\n- \u5e6b\u52a9\u8b58\u5225\u5b8c\u6210\u4efb\u52d9\u5f8c\u88ab\u653e\u68c4\u7684\u670d\u52d9\u8cec\u865f\u3002\n### \u67e5\u770b\u548c\u61c9\u7528 IAM \u5efa\u8b70\n[IAM Recommender](https://cloud.google.com/iam/docs/recommender-overview?hl=zh-cn) \u662f Policy Intelligence \u5de5\u5177\u548c\u670d\u52d9\u5957\u4ef6\u7684\u4e00\u90e8\u5206\u3002\u5b83\u4f7f\u7528\u6a5f\u5668\u5b78\u7fd2 (ML) \u4f86\u751f\u6210\u667a\u80fd\u7684\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\u5efa\u8b70\uff0c\u4ee5\u5e6b\u52a9\u60a8\u78ba\u5b9a\u4e0d\u518d\u9700\u8981\u8a2a\u554f Google Cloud \u8cc7\u6e90\u7684\u8cec\u865f\u3002\u7136\u5f8c\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b\u9019\u4e9b\u5efa\u8b70\u4e26\u6c7a\u5b9a\u662f\u5426\u61c9\u7528\u9019\u4e9b\u5efa\u8b70\u3002\u6b64\u5916\uff0cIAM Recommender \u9084\u53ef\u5e6b\u52a9\u60a8\u7dad\u6301\u7d44\u7e54\u5167\u6240\u6709\u6210\u54e1\u7684\u6700\u5c0f\u6b0a\u9650\u539f\u5247\u3002\u9664\u4e86\u63d0\u4f9b\u5efa\u8b70\u4e4b\u5916\uff0c [Recommender](https://cloud.google.com/recommender/docs/overview?hl=zh-cn) \u670d\u52d9\u9084\u6703\u4f7f\u7528\u6a5f\u5668\u5b78\u7fd2 (ML)\u4f86\u63d0\u4f9b\u8a73\u7d30\u7684 [\u6578\u64da\u5206\u6790](https://cloud.google.com/recommender/docs/insights/using-insights?hl=zh-cn) \u3002\u6578\u64da\u5206\u6790\u662f\u7a81\u51fa\u986f\u793a\u8cc7\u6e90\u4f7f\u7528\u60c5\u6cc1\u4e2d\u91cd\u8981\u683c\u5f0f\u7684\u767c\u73fe\u7d50\u679c\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u6536\u96c6\u6709\u95dc\u9805\u76ee\u4e2d\u6b0a\u9650\u4f7f\u7528\u60c5\u6cc1\u7684\u5176\u4ed6\u4fe1\u606f\u3001\u78ba\u5b9a\u672a\u4f7f\u7528\u548c\u4e0d\u518d\u9700\u8981\u7684\u6b0a\u9650\u4ee5\u53ca [\u8b58\u5225\u672a\u4f7f\u7528\u7684\u670d\u52d9\u8cec\u865f](https://cloud.google.com/iam/docs/service-account-overview?hl=zh-cn#identify-unused) \u3002\n\u60a8\u53ef\u4ee5\u5728\u4f01\u696d\u7d1a\u7684 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u67e5\u770b\u548c\u61c9\u7528 IAM \u5efa\u8b70\u3002\u5728\u4ee5\u4e0b\u793a\u4f8b\u904e\u7a0b\u4e2d\uff0c\u60a8\u4f7f\u7528 BigQuery \u5be9\u8988\u7d44\u7e54\u4e2d\u7684\u6b0a\u9650\u4e26\u8abf\u6574\u5176\u5927\u5c0f\u3002\u5982\u9700\u8a2d\u7f6e BigQuery \u96c6\u6210\uff0c\u8acb\u914d\u7f6e\u5c07 IAM Recommender \u63d0\u4f9b\u7684\u5efa\u8b70\u5c0e\u51fa\u5230 BigQuery \u6578\u64da\u96c6\u3002\u7136\u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u53ef\u8996\u5316\u5de5\u5177\uff08\u5982 [Looker \u6578\u64da\u6d1e\u5bdf](https://lookerstudio.google.com/overview?hl=zh-cn) \u548c [Looker](https://cloud.google.com/looker?hl=zh-cn) \uff09\u67e5\u8a62\u548c\u5be9\u8988\u9019\u4e9b\u6578\u64da\u3002\n### \u5be6\u73fe\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u9805\u76ee\u9078\u64c7\u5668\u9801\u9762\u4e0a\uff0c [\u9078\u64c7\u6216\u5275\u5efa\u4e00\u500b Google Cloud \u9805\u76ee](https://console.cloud.google.com/projectselector2/home/dashboard?_ga=2.171331176.996626712.1613379397-1723329357.1612296386&hl=zh-cn) \u3002\n- \u65b0\u9805\u76ee\u4e2d\u6703\u81ea\u52d5\u5553\u7528 BigQuery\u3002\u5982\u9700\u5728\u73fe\u6709\u9805\u76ee\u4e2d\u5553\u7528 BigQuery\uff0c\u8acb\u5553\u7528 BigQuery API\u3002 [ \u5553\u7528 API](https://console.cloud.google.com/flows/enableapi?apiid=bigquery&hl=zh-cn) \n- \u914d\u7f6e BigQuery Data Transfer Service \u4ee5\u5f9e IAM Recommender \u4e2d\u63d0\u53d6\u6578\u64da\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5c07\u5efa\u8b70\u5c0e\u51fa\u5230 BigQuery](https://cloud.google.com/recommender/docs/bq-export/export-recommendations-to-bq?hl=zh-cn) \u3002\n- \u8f49\u5230 BigQuery \u9801\u9762\u3002 [ \u8f49\u81f3 BigQuery](https://console.cloud.google.com/bigquery?hl=zh-cn) \n- \u5c07\u4ee5\u4e0b\u67e5\u8a62\u8907\u88fd\u4e26\u7c98\u8cbc\u5230 **\u7de8\u8f2f\u5668** \u5b57\u6bb5\u4e2d\uff1a```\nSELECT\u00a0 \u00a0recommendation_detailsFROM PROJECT_ID.DATASET.TABLE_NAMEWHERE recommender = \"google.iam.policy.Recommender\"AND recommender_subtype = \"REMOVE_ROLE\"\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u60a8\u8981\u7528\u65bc\u57f7\u884c\u6b64\u793a\u4f8b\u7684 Google Cloud \u9805\u76ee ID\n- ``\uff1a\u60a8\u5728\u8a2d\u7f6e BigQuery Data Transfer Service \u4f5c\u696d\u6642\u9078\u64c7\u7684\u6578\u64da\u96c6\u7684\u540d\u7a31\u3002\n- ``\uff1a\u7531 BigQuery Data Transfer Service \u4f5c\u696d\u5275\u5efa\u7684\u8868\u7684\u540d\u7a31\u3002\n\u60a8\u904b\u884c\u6b64\u67e5\u8a62\u4f86\u8b58\u5225 IAM Recommender `REMOVE_ROLE` \u5efa\u8b70\u7684 `recommender_subtype` \u5b50\u985e\u578b\u3002\n- \u9ede\u64ca **\u904b\u884c** \u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u67e5\u8a62\u7d50\u679c\u4f86\u8b58\u5225\u672a\u4f7f\u7528\u7684\u89d2\u8272\u548c\u8abf\u6574 IAM \u89d2\u8272\u7d81\u5b9a\u3002\u60a8\u53ef\u4ee5\u5c07\u67e5\u8a62\u7d50\u679c\u4fdd\u5b58\u5230\u8868\u683c\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5c07\u67e5\u8a62\u7d50\u679c\u4fdd\u5b58\u5230\u8868\u683c](https://cloud.google.com/bigquery/docs/writing-results?hl=zh-cn#saving-query-results-to-sheets) \u3002## \u4f7f\u7528\u6236\u80fd\u5920\u8acb\u6c42\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\n\u4f01\u696d\u7ba1\u7406\u54e1\u5fc5\u9808\u80fd\u5920\u4f7f\u7528\u6236\u80fd\u5920\u8acb\u6c42\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\u3002\u901a\u5e38\uff0c\u9019\u4e9b\u8acb\u6c42\u9700\u8981\u7d93\u904e\u5be9\u6279\u6d41\u7a0b\uff0c\u5728\u6b64\u6d41\u7a0b\u4e2d\uff0c\u6307\u5b9a\u7684\u5be9\u6279\u8005\u6216\u4e00\u7d44\u5be9\u6279\u8005\u5fc5\u9808\u6279\u51c6\u8acb\u6c42\u624d\u80fd\u63d0\u4f9b\u8a2a\u554f\u6b0a\u9650\u3002\u85c9\u52a9 [Google \u7fa3\u7d44](https://cloud.google.com/iam/docs/overview?hl=zh-cn#google_group) \uff0c\u60a8\u53ef\u4ee5\u5c07\u8a2a\u554f\u6b0a\u9650\u653f\u7b56\u61c9\u7528\u65bc\u4e00\u7d44\u7528\u6236\uff0c\u5f9e\u800c\u4f7f\u60a8\u80fd\u5920\u9075\u5faa\u6839\u64da\u7fa3\u7d44\u6210\u54e1\u63d0\u4f9b\u63d0\u4f9b\u8cc7\u6e90\u8a2a\u554f\u6b0a\u9650\u7684\u653f\u7b56\u7ba1\u7406\u6700\u4f73\u505a\u6cd5\u3002\u6b64\u65b9\u6cd5\u901a\u904e\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u66f4\u6539\u7684\u65b9\u5f0f\u4fdd\u6301\u8207\u52a0\u5165\u3001\u8abf\u5d17\u548c\u96e2\u8077\u4e8b\u4ef6\u76f8\u95dc\u7684\u653f\u7b56\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528 Google \u7fa3\u7d44\u6388\u4e88\u548c\u66f4\u6539\u6574\u500b\u7fa3\u7d44\u7684\u8a2a\u554f\u63a7\u5236\uff0c\u800c\u4e0d\u662f\u4e00\u6b21\u7232\u55ae\u500b\u7528\u6236\u6216\u670d\u52d9\u8cec\u865f\u6388\u4e88\u6216\u66f4\u6539\u8a2a\u554f\u63a7\u5236\u3002\u60a8\u9084\u53ef\u4ee5\u8f15\u9b06\u5730\u5411 Google \u7fa3\u7d44\u4e2d\u6dfb\u52a0\u6210\u54e1\u4ee5\u53ca\u5f9e\u4e2d\u79fb\u9664\u6210\u54e1\uff0c\u800c\u4e0d\u662f\u66f4\u65b0 IAM \u653f\u7b56\u4ee5\u6dfb\u52a0\u6216\u79fb\u9664\u7528\u6236\u3002\n### \u4f7f\u7528 Google \u7fa3\u7d44\u8a2d\u7f6e\u8cc7\u6e90\u8a2a\u554f\u6b0a\u9650\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [Cloud Identity](https://cloud.google.com/identity?hl=zh-cn) \u4f86\u5275\u5efa\u548c\u7ba1\u7406 Google \u7fa3\u7d44\u3002Cloud Identity \u662f\u4e00\u7a2e\u8eab\u4efd\u5373\u670d\u52d9 (IDaaS) \u89e3\u6c7a\u65b9\u6848\uff0c\u53ef\u7ba1\u7406\u7528\u6236\u548c\u7fa3\u7d44\u3002\u60a8\u9084\u53ef\u4ee5\u914d\u7f6e Cloud Identity \u4ee5\u4fbf\u5728 Google \u548c\u5176\u4ed6\u8eab\u4efd\u63d0\u4f9b\u5546\uff08\u4f8b\u5982\uff0c [Active Directory](https://cloud.google.com/architecture/identity/federating-gcp-with-active-directory-introduction?hl=zh-cn) \u548c [Azure Active Directory](https://cloud.google.com/architecture/identity/federating-gcp-with-azure-active-directory?hl=zh-cn) \uff09\u4e4b\u9593\u806f\u5408\u8eab\u4efd\u3002 [Google \u7fa3\u7d44](https://cloud.google.com/iam/docs/overview?hl=zh-cn#google_group) \u9084\u5141\u8a31\u7528\u6236\u8acb\u6c42\u52a0\u5165\u7fa3\u7d44\u3002\u8a72\u8acb\u6c42\u5c07\u6703\u905e\u9001\u7d66\u7fa3\u7d44\u7ba1\u7406\u54e1\uff0c\u7136\u5f8c\u7531\u8a72\u7ba1\u7406\u54e1\u6279\u51c6\u6216\u62d2\u7d55\u8a72\u8acb\u6c42\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5275\u5efa\u7fa3\u7d44\u4e26\u9078\u64c7\u7fa3\u7d44\u8a2d\u7f6e](https://support.google.com/groups/answer/2464926?hl=zh-cn) \u3002\n\u5728\u5275\u5efa\u548c\u7ba1\u7406 Google \u7fa3\u7d44\u4ee5\u6388\u4e88\u5c0d Google Cloud \u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\u6642\uff0c\u8acb\u52d9\u5fc5\u8003\u616e\u6240\u9078\u8a2d\u7f6e\u7684\u5f71\u97ff\u3002\u96d6\u7136\u6211\u5011\u5efa\u8b70\u60a8\u5118\u53ef\u80fd\u6e1b\u5c11\u7ba1\u7406\u7fa3\u7d44\u7684\u7528\u6236\u6578\u91cf\uff0c\u4f46\u6211\u5011\u5efa\u8b70\u60a8\u8a2d\u7f6e\u591a\u500b\u7fa3\u7d44\u7ba1\u7406\u54e1\uff0c\u4ee5\u4fbf\u59cb\u7d42\u5177\u5099\u8a72\u7fa3\u7d44\u7684\u8a2a\u554f\u6b0a\u9650\u3002\u6211\u5011\u9084\u5efa\u8b70\u60a8\u50c5\u5141\u8a31\u7d44\u7e54\u5167\u7684\u7528\u6236\u5177\u5099\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u3002\n### \u5be6\u73fe\n\u5728\u6b64\u793a\u4f8b\u904e\u7a0b\u4e2d\uff0c\u60a8\u5c07\u5275\u5efa\u4e00\u500b Google \u7fa3\u7d44\uff0c\u4e26\u5411\u67e5\u770b\u8005\u7fa3\u7d44\u6388\u4e88\u5c0d\u793a\u4f8b Google Cloud \u9805\u76ee\u7684\u8a2a\u554f\u6b0a\u9650\u3002\u60a8\u6dfb\u52a0\u5230\u6b64\u7fa3\u7d44\uff08\u6216\u6839\u64da\u8acb\u6c42\u6388\u4e88\u8a2a\u554f\u6b0a\u9650\uff09\u7684\u6210\u54e1\u53ef\u4ee5\u67e5\u770b\u793a\u4f8b Google Cloud \u9805\u76ee\u3002\n### \u5275\u5efa\u793a\u4f8b Google \u7fa3\u7d44\n\u4ee5\u4e0b\u6b65\u9a5f\u5047\u5b9a\u60a8\u5df2\u914d\u7f6e Cloud Identity\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u8a2d\u7f6e Cloud Identity](https://cloud.google.com/identity/docs/set-up-cloud-identity-admin?hl=zh-cn) \u3002\u8acb\u78ba\u4fdd\u60a8\u64c1\u6709 [\u7ba1\u7406](https://cloud.google.com/iam/docs/groups-in-cloud-console?hl=zh-cn) \u7fa3\u7d44\u6240\u9700\u7684\u6b0a\u9650\u3002\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **\u7fa3\u7d44** \u9801\u9762\u3002 [\u524d\u5f80\u201c\u7fa3\u7d44\u201d](https://console.cloud.google.com/iam-admin/groups?hl=zh-cn) \n- \u9ede\u64ca **\u5275\u5efa** \u3002\n- \u586b\u5beb\u7fa3\u7d44\u7684\u8a73\u7d30\u4fe1\u606f\u3002\u5982\u9700\u5411\u7fa3\u7d44\u6dfb\u52a0\u6210\u54e1\uff0c\u8acb\u9ede\u64ca **\u6dfb\u52a0\u6210\u54e1** \uff0c\u7136\u5f8c\u8f38\u5165\u6210\u54e1\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\u4e26\u9078\u64c7\u5176 [Google \u7fa3\u7d44\u89d2\u8272](https://support.google.com/groups/answer/2464975?hl=zh-cn) \u3002\u5b8c\u6210\u5f8c\uff0c\u9ede\u64ca **\u63d0\u4ea4** \u4ee5\u5275\u5efa\u7fa3\u7d44\u3002\u7fa3\u7d44\u8a2d\u7f6e\u53ea\u80fd\u5728 Google \u7fa3\u7d44\u4e2d\u9032\u884c\u7ba1\u7406\u3002\u9ede\u64ca [\u5728 Google \u7fa3\u7d44\u4e2d\u7ba1\u7406\u6b64\u7fa3\u7d44](https://groups.google.com/a/google.com/forum/?hl=zh-cn#!forum/test2-payal) \u4ee5\u914d\u7f6e\u7fa3\u7d44\u8a2d\u7f6e\u3002\u82e5\u8981\u9078\u64c7\u8ab0\u53ef\u4ee5\u52a0\u5165\u7fa3\u7d44\uff0c\u8acb\u5728 **\u8ab0\u53ef\u4ee5\u52a0\u5165\u7fa3\u7d44** \u83dc\u55ae\u4e2d\uff0c\u9078\u64c7 **\u50c5\u7d44\u7e54\u7528\u6236** \u3002\n- \u9ede\u64ca **\u5275\u5efa\u7fa3\u7d44** \u3002\n### \u5411\u7fa3\u7d44\u6388\u4e88\u5c0d Google Cloud \u9805\u76ee\u7684\u8a2a\u554f\u6b0a\u9650\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u7684\u9805\u76ee\u9078\u64c7\u5668\u9801\u9762\u4e0a\uff0c [\u9078\u64c7\u6216\u5275\u5efa\u4e00\u500b Google Cloud \u9805\u76ee](https://console.cloud.google.com/projectselector2/home/dashboard?_ga=2.171331176.996626712.1613379397-1723329357.1612296386&hl=zh-cn) \u3002\n- \u6253\u958b Cloud Shell\uff1a [ \u8f49\u5230 Cloud Shell](https://console.cloud.google.com/?cloudshell=true&hl=zh-cn) \n- \u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u7232\u7fa3\u7d44\u63d0\u4f9b\u9805\u76ee\u7684\u67e5\u770b\u8005\u8a2a\u554f\u6b0a\u9650\uff1a```\ngcloud projects add-iam-policy-binding PROJECT_ID \\\u00a0 \u00a0 --member=group:GROUP_EMAIL --role=roles/viewer\n```\u8acb\u66ff\u63db\u4ee5\u4e0b\u5167\u5bb9\uff1a- ``\uff1a\u60a8\u5275\u5efa\u7684\u7fa3\u7d44\u7684\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\n- ``\uff1a\u60a8\u7684 Google Cloud \u9805\u76ee\u7684 ID\n### \u7232\u60a8\u7d44\u7e54\u4e2d\u7684\u7528\u6236\u6e2c\u8a66\u7528\u6236\u8a2a\u554f\u8acb\u6c42\u6d41\u7a0b\n\u5728\u4ee5\u4e0b\u904e\u7a0b\u4e2d\uff0c\u60a8\u4f7f\u7528\u6e2c\u8a66\u7528\u6236\u8cec\u865f\u6f14\u793a\u7d44\u7e54\u4e2d\u7684\u7528\u6236\u7528\u4f86\u8acb\u6c42\u8a2a\u554f Google \u7fa3\u7d44\u7684\u6b65\u9a5f\u3002\n- \u4ee5\u975e\u7ba1\u7406\u54e1\u7528\u6236\u8eab\u4efd\u767b\u9304 [Google \u7fa3\u7d44](http://groups.google.com?hl=zh-cn) \u3002\u60a8\u5728 [\u5275\u5efa\u793a\u4f8b Google \u7fa3\u7d44](#create_a_sample_google_group) \u4e2d\u5275\u5efa\u7684\u7fa3\u7d44\u6703\u986f\u793a\u5728 **\u6240\u6709\u7fa3\u7d44** \u4e0b\u3002\u5982\u679c\u8a72\u7d44\u672a\u986f\u793a\uff0c\u8acb\u901a\u904e\u641c\u7d22\u529f\u80fd\u627e\u5230\u5b83\u3002\n- \u5982\u9700\u8acb\u6c42\u8a2a\u554f\u8a72\u7fa3\u7d44\uff0c\u8acb\u9ede\u64ca **\u8acb\u6c42\u52a0\u5165\u7fa3\u7d44** \u3002\u6388\u4e88\u8a2a\u554f\u6b0a\u9650\u5f8c\uff0c\u60a8\u7528\u65bc\u767c\u51fa\u8acb\u6c42\u7684\u975e\u7ba1\u7406\u7528\u6236\u8cec\u865f\u61c9\u80fd\u5920\u67e5\u770b\u8a72\u7fa3\u7d44\u5177\u6709\u67e5\u770b\u8005\u8a2a\u554f\u6b0a\u9650\u7684 Google Cloud `` \u9805\u76ee\u3002## \u9650\u6642\u8a2a\u554f Google Cloud \u8cc7\u6e90\n\u6709\u6642\uff0c\u60a8\u7684\u4f01\u696d\u4e2d\u7684\u7528\u6236\u53ef\u80fd\u9700\u8981\u5c0d Google Cloud \u8cc7\u6e90\u9032\u884c\u77ed\u671f\u7684\u77ed\u671f\u8a2a\u554f\u3002\u7576\u958b\u767c\u8005\u9700\u8981\u8a2a\u554f Google Cloud \u8cc7\u6e90\u4ee5\u57f7\u884c\u67d0\u4e9b\u4efb\u52d9\u6642\uff0c\u77ed\u671f\u8a2a\u554f\u975e\u5e38\u6709\u7528\u3002\u77ed\u671f\u8a2a\u554f\u9084\u5177\u6709\u4ee5\u4e0b\u512a\u52e2\uff1a\n- \u6e1b\u5c11\u7ba1\u7406\u8cbb\u7528\u3002\n- \u78ba\u4fdd\u9075\u5faa\u6700\u5c0f\u6b0a\u9650\u4e26\u5141\u8a31\u53ca\u6642\u8a2a\u554f\u3002\n\u5728\u9700\u8981\u5feb\u901f\u548c\u76f4\u63a5\u5e72\u9810\u7684\u7dca\u6025\u60c5\u6cc1\u4e0b\uff0c\u7576\u7528\u6236\u9700\u8981\u8a2a\u554f\u8cc7\u6e90\u6642\uff0c\u80fd\u5920\u63d0\u4f9b\u6b64\u985e\u578b\u7684\u8a2a\u554f\u6b0a\u9650\u975e\u5e38\u6709\u7528\u3002\u4f46\u662f\uff0c\u53ef\u80fd\u5f88\u96e3\u624b\u52d5\u8ddf\u8e64\u77ed\u671f\u8a2a\u554f\u6b0a\u9650\u4e26\u78ba\u4fdd\u5176\u88ab\u53ca\u6642\u79fb\u9664\u3002\u85c9\u52a9 dentity and Access Management (IAM) \u689d\u4ef6\u8a2a\u554f\u653f\u7b56\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u689d\u4ef6\u89d2\u8272\u7d81\u5b9a\u4f86\u8a2d\u7f6e\u5c0d Google Cloud \u8cc7\u6e90\u7684\u81e8\u6642\uff08\u904e\u671f\uff09\u8a2a\u554f\u6b0a\u9650\uff0c\u9019\u6709\u52a9\u65bc\u6e1b\u5c11\u7ba1\u7406\u54e1\u7684\u958b\u92b7\u3002\n### \u4f7f\u7528\u689d\u4ef6\u89d2\u8272\u7d81\u5b9a\u548c\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u5230\u671f\u6642\u9593\n\u60a8\u53ef\u4ee5\u5c07\u689d\u4ef6\u89d2\u8272\u7d81\u5b9a\u6dfb\u52a0\u5230\u65b0\u7684\u6216\u73fe\u6709\u7684 IAM \u7b56\u7565\u4e2d\uff0c\u4ee5\u9032\u4e00\u6b65\u63a7\u5236\u5c0d Google Cloud \u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\u3002\u4f55\u6642\u4f7f\u7528\u689d\u4ef6\u89d2\u8272\u7d81\u5b9a\u7232\u7528\u6236\u6216\u7fa3\u7d44\u63d0\u4f9b\u81e8\u6642\u8a2a\u554f\u6b0a\u7684\u4e00\u4e9b\u793a\u4f8b\u5982\u4e0b\uff1a\n- \u5c0d\u9805\u76ee\u7684\u8a2a\u554f\u6b0a\u9650\u5728\u6307\u5b9a\u6642\u9593\u4e4b\u5f8c\u5230\u671f\u3002\n- \u8a2a\u554f\u6bcf\u6708\u6216\u6bcf\u5b63\u5ea6\u91cd\u8907\u767c\u751f\u7684\u9805\u76ee\u3002\n- \u8a2a\u554f Compute Engine \u5be6\u4f8b\u4ee5\u7ba1\u7406\u4efb\u52d9\uff0c\u4f8b\u5982\u505c\u6b62\u5be6\u4f8b\u3002\n\u7576\u60a8\u4f7f\u7528 Google \u7fa3\u7d44\u7232\u7528\u6236\u63d0\u4f9b\u5c0d Google Cloud \u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\u6642\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 [\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u904e\u671f\u529f\u80fd](https://cloud.google.com/identity/docs/how-to/manage-expirations?hl=zh-cn) \u901a\u904e [Cloud Identity Groups API](https://cloud.google.com/identity/docs/how-to/setup?hl=zh-cn) \u8a2d\u7f6e\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u7684\u904e\u671f\u6642\u9593\u3002\u7576\u6307\u5b9a\u6642\u9593\u904e\u53bb\u6642\uff0c\u7cfb\u7d71\u6703\u81ea\u52d5\u5c07\u7528\u6236\u5f9e\u7fa3\u7d44\u4e2d\u79fb\u9664\u3002\n### \u5be6\u73fe\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u689d\u4ef6\u89d2\u8272\u7d81\u5b9a\u5411\u958b\u767c\u8005\u6388\u4e88\u7279\u5b9a Compute Engine \u5be6\u4f8b\u7684\u81e8\u6642\u8a2a\u554f\u6b0a\u9650\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u89d2\u8272\u7d81\u5b9a\u8a2d\u7f6e\u7232\u5728 2021 \u5e74 12 \u6708 31 \u65e5\u904e\u671f\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u8a2d\u7f6e\u4ee5\u4e0b\u74b0\u5883\u8b8a\u91cf\uff1a```\nexport INSTANCE=create example-instance-1export ZONE=us-west1-bexport USER=USER_ID_TO_GIVE_TEMPORARY_ACCESS_TO\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u5e0c\u671b\u7232\u5176\u6388\u4e88\u81e8\u6642\u8a2a\u554f\u6b0a\u9650\u7684\u7528\u6236\u7684\u7528\u6236\u540d\u3002\n- \u5275\u5efa\u793a\u4f8b Compute Engine \u5be6\u4f8b\uff1a```\ngcloud compute instances create $INSTANCE \\\u00a0 \u00a0 --zone $ZONE \\\u00a0 \u00a0 --machine-type g1-small\n```\u60a8\u53ef\u4ee5\u901a\u904e\u4ee5\u4e0b\u6b65\u9a5f\u7232\u7d44\u7e54\u4e2d\u7684\u7528\u6236\u6388\u4e88\u5c0d\u8a72\u5be6\u4f8b\u7684\u81e8\u6642\u8a2a\u554f\u6b0a\u9650\u3002\n- \u7232\u60a8\u9078\u64c7\u7684\u7528\u6236\u6388\u4e88\u81e8\u6642\u8a2a\u554f\u6b0a\u9650\uff1a```\ngcloud compute instances add-iam-policy-binding $INSTANCE \\\u00a0 \u00a0 --zone=$ZONE \\\u00a0 \u00a0 --member=\"user:$USER\" \\\u00a0 \u00a0 --role='roles/compute.instanceAdmin.v1' \\\u00a0 \u00a0 --condition='expression=request.time < timestamp(\"2022-01-01T00:00:00Z\"),title=expires_end_of_2021,description=Expires at midnight on 2021-12-31'\n```\n- \u4fdd\u7559\u60a8\u5275\u5efa\u7684 Compute Engine \u5be6\u4f8b\u3002\u60a8\u7a0d\u5f8c\u6703\u5728\u672c\u6587\u6a94\u7684 [\u7ba1\u7406\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650](#managing_privileged_access) \u4e2d\u4f7f\u7528\u6b64\u5be6\u4f8b\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u901a\u904e\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4f86\u522a\u9664 `example-instance-1` \u5be6\u4f8b\uff1a```\ngcloud compute instances delete $INSTANCE\n```## \u8a18\u9304\u8207\u8eab\u4efd\u76f8\u95dc\u7684\u751f\u547d\u9031\u671f\u4e8b\u4ef6\n\u5982\u679c\u60a8\u9700\u8981\u67e5\u770b\u8981\u5be9\u8988\u7684 IAM \u751f\u547d\u9031\u671f\u4e8b\u4ef6\uff08\u4f8b\u5982\u653f\u7b56\u66f4\u6539\u3001\u670d\u52d9\u8cec\u865f\u5275\u5efa\u548c\u670d\u52d9\u8cec\u865f\u5206\u914d\uff09\uff0c\u5247 [Cloud Audit Logs](https://cloud.google.com/logging/docs/audit?hl=zh-cn) \u53ef\u4ee5\u5e6b\u52a9\u60a8\u3002\u7ba1\u7406\u54e1\u53ef\u4ee5\u4f7f\u7528 Cloud Audit Logs \u67e5\u770b\u7528\u65bc\u53d6\u8b49\u548c\u5206\u6790\u7684\u6b77\u53f2\u6578\u64da\u3002\u5206\u6790\u5be9\u8988\u65e5\u8a8c\u53ef\u5e6b\u52a9\u60a8\u77ad\u89e3\u8a2a\u554f\u6a21\u5f0f\u548c\u8a2a\u554f\u7570\u5e38\u60c5\u6cc1\u3002\u5be9\u8988\u65e5\u8a8c\u5206\u6790\u5c0d\u65bc\u4ee5\u4e0b\u60c5\u6cc1\u4e0b\u4e5f\u5f88\u91cd\u8981\uff1a\n- \u5728\u6578\u64da\u6cc4\u9732\u671f\u9593\u5206\u6790\u5c0d\u8cc7\u6e90\u7684\u6b0a\u9650\u548c\u8a2a\u554f\u6b0a\u9650\u3002\n- \u5206\u6790\u7531 IAM \u653f\u7b56\u66f4\u6539\u5f15\u8d77\u7684\u751f\u7522\u554f\u984c\uff0c\u7279\u5225\u662f\u60a8\u8981\u9a57\u8b49\u54ea\u500b\u7528\u6236\u6216\u54ea\u500b\u6d41\u7a0b\u9032\u884c\u4e86\u66f4\u6539\u6642\uff0c\u5c24\u5176\u5982\u6b64\u3002\nCloud Audit Logs \u53ef\u5b58\u5132\u6709\u95dc\u7528\u6236\u6240\u57f7\u884c\u64cd\u4f5c\u3001\u6d3b\u52d5\u767c\u751f\u7684\u4f4d\u7f6e\u4ee5\u53ca\u6642\u9593\u7684\u4fe1\u606f\u3002\u5be9\u8988\u65e5\u8a8c\u5206\u7232\u4ee5\u4e0b\u5e7e\u7a2e\u985e\u5225\uff1a\n- [\u7ba1\u7406\u54e1\u6d3b\u52d5](https://cloud.google.com/logging/docs/audit?hl=zh-cn#admin-activity) \u5be9\u8988\u65e5\u8a8c\n- [\u6578\u64da\u8a2a\u554f](https://cloud.google.com/logging/docs/audit?hl=zh-cn#data-access) \u5be9\u8988\u65e5\u8a8c\n- [\u7cfb\u7d71\u4e8b\u4ef6](https://cloud.google.com/logging/docs/audit?hl=zh-cn#system-event) \u5be9\u8988\u65e5\u8a8c\n- [\u653f\u7b56\u62d2\u7d55](https://cloud.google.com/logging/docs/audit?hl=zh-cn#policy_denied) \u5be9\u8988\u65e5\u8a8c\n\u6211\u5011\u5efa\u8b70\u60a8\u4f7f\u7528\u4ee5\u4e0b\u5be9\u8988\u65e5\u8a8c\u9032\u884c\u8207\u8eab\u4efd\u548c\u8a2a\u554f\u6b0a\u9650\u76f8\u95dc\u7684\u7ba1\u7406\u65e5\u8a8c\u8a18\u9304\uff1a\n- \u7ba1\u7406\u54e1\u6d3b\u52d5\u5be9\u8988\u65e5\u8a8c\n- \u653f\u7b56\u62d2\u7d55\u5be9\u8988\u65e5\u8a8c\n\u7ba1\u7406\u54e1\u6d3b\u52d5\u5be9\u8988\u65e5\u8a8c\u5b58\u5132\u5c0d Google Cloud \u8cc7\u6e90\uff08\u5982\u9805\u76ee\u3001Compute Engine \u5be6\u4f8b\u548c\u670d\u52d9\u8cec\u865f\uff09\u7684\u66f4\u6539\u3002\u4ee5\u4e0b\u662f\u7ba1\u7406\u54e1\u6d3b\u52d5\u5be9\u8988\u65e5\u8a8c\u5b58\u5132\u7684\u4e8b\u4ef6\u7684\u793a\u4f8b\uff1a\n- \u5275\u5efa\u670d\u52d9\u8cec\u865f\u3002\n- IAM \u653f\u7b56\u66f4\u6539\u3002\n- \u4e0b\u8f09\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\n\u5982\u679c\u7528\u6236\u6216\u670d\u52d9\u8cec\u865f\u56e0\u9055\u53cd\u5b89\u5168\u653f\u7b56\u800c\u88ab\u62d2\u7d55\u8a2a\u554f Google Cloud \u670d\u52d9\uff0c\u5247\u6703\u8a18\u9304\u653f\u7b56\u62d2\u7d55\u5be9\u8988\u65e5\u8a8c\u3002\n### \u7232\u8eab\u4efd\u751f\u547d\u9031\u671f\u4e8b\u4ef6\u8a2d\u7f6e Cloud Audit Logs\n\u60a8\u53ef\u4ee5\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u67e5\u770b\u5be9\u8988\u65e5\u8a8c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 [Cloud Logging API](https://cloud.google.com/logging/docs/reference/v2/rest/v2/entries/list?hl=zh-cn) \u6216 [\u547d\u4ee4\u884c\u754c\u9762](https://cloud.google.com/logging/docs/api/gcloud-logging?hl=zh-cn#v2_api_commands) \u67e5\u8a62\u65e5\u8a8c\u3002\n\u6240\u6709\u5be9\u8988\u65e5\u8a8c\u90fd\u6709 [\u4fdd\u7559\u671f\u9650](https://cloud.google.com/logging/docs/audit?hl=zh-cn#audit_log_retention) \u3002\u5982\u679c\u4f01\u696d\u9700\u8981\u8d85\u904e\u9ed8\u8a8d\u4fdd\u7559\u671f\u9650\u7684\u5be9\u8988\u65e5\u8a8c\u5b58\u5132\u6642\u9593\uff0c\u60a8\u9700\u8981\u901a\u904e\u5275\u5efa [\u65e5\u8a8c\u63a5\u6536\u5668](https://cloud.google.com/logging/docs/audit?hl=zh-cn#exporting_audit_logs) \u5c07\u65e5\u8a8c\u5c0e\u51fa\u5230 BigQuery \u6216\u5176\u4ed6\u63a5\u6536\u5668\u76ee\u6a19\u4f4d\u7f6e\u3002\u901a\u904e\u5c07\u65e5\u8a8c\u5c0e\u51fa\u5230 BigQuery\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b\u4e00\u90e8\u5206\u6578\u64da\u5217\u548c\u9078\u64c7\u7684\u6578\u64da\uff08\u4e00\u6bb5\u6642\u9593\u6216\u5176\u4ed6\u7dad\u5ea6\uff09\uff0c\u4e26\u57f7\u884c [\u805a\u5408\u5206\u6790](https://cloud.google.com/architecture/exporting-stackdriver-logging-for-security-and-access-analytics?hl=zh-cn) \u3002\n### \u5be6\u73fe\n\u4ee5\u4e0b\u793a\u4f8b\u904e\u7a0b\u6f14\u793a\u77ad\u5982\u4f55\u67e5\u8a62 Google Cloud \u9805\u76ee\u65e5\u8a8c\u4ee5\u6aa2\u67e5\u662f\u5426\u767c\u751f\u4e86\u4ee5\u4e0b\u4efb\u4f55\u4e8b\u4ef6\uff1a\n- \u9032\u884c\u4e86 IAM \u653f\u7b56\u66f4\u6539\u3002\n- \u5df2\u5275\u5efa\u65b0\u7684\u670d\u52d9\u8cec\u865f\u3002\n- \u5df2\u751f\u6210\u65b0\u7684\u670d\u52d9\u8cec\u865f\u5bc6\u9470\u3002\n### \u67e5\u770b IAM \u653f\u7b56\u7684\u66f4\u6539\n- \u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\uff0c\u8f49\u5230 **Logging** > **\u65e5\u8a8c\u700f\u89bd\u5668** \u9801\u9762\u3002\n- \u5728 **Logs Explorer** \u9801\u9762\u4e0a\uff0c\u9078\u64c7\u4e00\u500b\u73fe\u6709\u7684 Google Cloud \u9805\u76ee\u3002\n- \u5c07\u4ee5\u4e0b\u67e5\u8a62\u7c98\u8cbc\u5230\u67e5\u8a62\u69cb\u5efa\u5668\u4e2d\uff1a```\nlogName=\"projects/<PROJECT>/logs/cloudaudit.googleapis.com%2Factivity\" AND(resource.type=\"project\" OR resource.type=\"service_account\") ANDresource.labels.project_id=\"<PROJECT>\" AND(protoPayload.methodName=\"SetIamPolicy\" ORprotoPayload.methodName=\"google.iam.admin.v1.CreateServiceAccount\"ORprotoPayload.methodName=\"google.iam.admin.v1.CreateServiceAccountKey\")\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u7684 Google Cloud \u9805\u76ee ID\u3002\n- \u9ede\u64ca **\u904b\u884c\u67e5\u8a62** \u3002\n### \u67e5\u770b\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u7684\u66f4\u6539\n\u5c0d Google \u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u7684\u66f4\u6539\u6703\u8a18\u9304\u5728\u6d3b\u52d5\u65e5\u8a8c\u4e2d\u3002\u5982\u9700\u77ad\u89e3\u5982\u4f55\u8a2a\u554f\u9019\u4e9b\u65e5\u8a8c\uff0c\u8acb\u53c3\u95b1 [\u67e5\u770b\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u66f4\u6539\u65e5\u8a8c](https://cloud.google.com/iam/docs/groups-in-cloud-console?hl=zh-cn#view-logs) \u3002\n## \u8a2a\u554f\u6b0a\u9650\u8b49\u66f8\n\u60a8\u53ef\u4ee5\u4f7f\u7528 [Policy Analyzer](https://cloud.google.com/asset-inventory/docs/analyzing-iam-policy?hl=zh-cn) \u4f86\u5e6b\u52a9\u60a8\u7684\u4f01\u696d\u9010\u500b\u96c6\u5408\u6216\u6642\u9593\u6bb5\u9a57\u8b49\u7528\u6236\u5c0d Google Cloud \u8cc7\u6e90\u96c6\u662f\u5426\u64c1\u6709\u9069\u7576\u7684\u8a2a\u554f\u6b0a\u9650\u3002\u51fa\u65bc\u5408\u898f\u6027\u548c\u5be9\u8988\u76ee\u7684\uff0c\u6b64\u9a57\u8b49\u975e\u5e38\u91cd\u8981\u3002\u6b64\u5916\uff0c\u6b64\u9a57\u8b49\u9084\u53ef\u4ee5\u5e6b\u52a9\u5b89\u5168\u4eba\u54e1\u548c\u5be9\u8988\u4eba\u54e1\u67e5\u770b\u54ea\u4e9b\u7528\u6236\u6709\u6b0a\u8a2a\u554f\u54ea\u4e9b\u8cc7\u6e90\u53ca\u5176\u5bb9\u91cf\u3002Policy Analyzer \u53ef\u5e6b\u52a9\u60a8\u78ba\u5b9a\u54ea\u4e9b\u8eab\u4efd\u6216\u4e3b\u8cec\u865f\uff08\u7528\u6236\u3001\u670d\u52d9\u8cec\u865f\u3001\u7fa3\u7d44\u548c\u7db2\u57df\uff09\u5c0d\u7d44\u7e54\u7684\u8cc7\u6e90\u5c64\u6b21\u7d50\u69cb\u4e2d\u7684\u54ea\u4e9b Google Cloud \u8cc7\u6e90\u5177\u6709\u8a2a\u554f\u6b0a\u9650\u3002\u5b83\u9084\u53ef\u4ee5\u5e6b\u52a9\u78ba\u5b9a\u8a2a\u554f\u6b0a\u9650\u7684\u985e\u578b\u3002Policy Analyzer \u53ef\u4ee5\u5e6b\u52a9\u60a8\u56de\u7b54\u4e00\u4e9b\u793a\u4f8b\u554f\u984c\u5982\u4e0b\uff1a\n- \u54ea\u4e9b\u7528\u6236\u53ef\u4ee5\u8a2a\u554f\u670d\u52d9\u8cec\u865f\u3002\n- \u54ea\u4e9b\u7528\u6236\u53ef\u4ee5\u8b80\u53d6 BigQuery \u6578\u64da\u96c6\u4e2d\u5305\u542b\u500b\u4eba\u8eab\u4efd\u4fe1\u606f (PII) \u7684\u6578\u64da\u3002\nPolicy Analyzer \u53ef\u8207\u4ee5\u4e0b\u65b9\u6cd5\u642d\u914d\u4f7f\u7528\uff1a\n- \u4f7f\u7528 Google Cloud \u63a7\u5236\u6aaf\u3002\n- \u4f7f\u7528 API\u3002\n- [\u5c0e\u51fa Identity and Access Management (IAM) \u653f\u7b56\u6578\u64da](https://cloud.google.com/asset-inventory/docs/analyzing-iam-policy-longrunning-bigquery?hl=zh-cn) \u5230 BigQuery \u4ee5\u9032\u884c\u7570\u6b65\u5206\u6790\u3002\n### \u4f7f\u7528 Policy Analyzer \u6aa2\u67e5\u7528\u6236\u8a2a\u554f\u6b0a\u9650\n\u4ee5\u4e0b\u793a\u4f8b\u67e5\u8a62\u986f\u793a\u60a8\u53ef\u4ee5\u901a\u904e\u653f\u7b56\u5206\u6790\u5668\u7372\u5f97\u7684\u7528\u6236\u8a2a\u554f\u985e\u578b\u65b9\u9762\u7684\u898b\u89e3\uff1a\n- \u4e3b\u8cec\u865f\uff08\u7528\u6236\u3001\u670d\u52d9\u8cec\u865f\u3001\u7fa3\u7d44\u548c\u7db2\u57df\uff09\u5177\u6709\u54ea\u4e9b\u89d2\u8272\u6216\u6b0a\u9650\uff1b\u4f8b\u5982\uff0c\u6aa2\u67e5\u4e00\u4f4d\u524d\u54e1\u5de5\u5c0d\u751f\u7522\u9805\u76ee\u5177\u6709\u54ea\u4e9b\u8a2a\u554f\u6b0a\u9650\u3002\n- \u7528\u6236\u53ef\u4ee5\u8a2a\u554f\u7684\u8cc7\u6e90\uff1b\u4f8b\u5982\uff0c\u524d\u54e1\u5de5\u5c0d\u751f\u7522\u9805\u76ee\u8cc7\u6e90\u591a\u5177\u6709\u7684\u8a2a\u554f\u6b0a\u9650\u3002\n- \u54ea\u4e9b\u4e3b\u8cec\u865f\u5c0d\u8cc7\u6e90\u6709\u4e00\u5b9a\u7a0b\u5ea6\u7684\u8a2a\u554f\u6b0a\u9650\uff1b\u4f8b\u5982\uff0c\u7279\u5b9a\u7528\u6236\u53ef\u4ee5\u5728\u9805\u76ee\u4e2d\u522a\u9664\u54ea\u4e9b\u5b58\u5132\u6876\u3002\n### \u5be6\u73fe\n\u5728\u4ee5\u4e0b\u793a\u4f8b\u904e\u7a0b\u4e2d\uff0c\u60a8\u5c07\u4f7f\u7528 Policy Analyzer \u4f86\u9a57\u8b49\u7528\u6236\u64c1\u6709\u7684\u6b0a\u9650\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u7232\u9805\u76ee\u5553\u7528 Cloud Asset API\uff1a [ \u5553\u7528 API](https://console.cloud.google.com/flows/enableapi?apiid=cloudasset.googleapis.com&hl=zh-cn) \n- \u8f38\u5165\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u77ad\u89e3\u7528\u6236\u53ef\u4ee5\u8a2a\u554f\u7684\u8cc7\u6e90\uff1a```\ngcloud asset analyze-iam-policy --organization=\"YOUR_ORG_ID\" \\\u00a0 \u00a0 --identity=\"user:USERNAME_TO_CERTIFY\"\n```\u9032\u884c\u4ee5\u4e0b\u66ff\u63db\uff1a- ``\uff1a\u60a8\u7684 Google Cloud \u7d44\u7e54 ID\n- ``\uff1a\u60a8\u8981\u9a57\u8b49\u5176 Google Cloud \u8a2a\u554f\u6b0a\u9650\u7684\u7528\u6236\u7684\u7528\u6236\u540d\u3002\n- \u5c07 IAM \u653f\u7b56\u6578\u64da\u63d0\u53d6\u5230 BigQuery\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5c07\u653f\u7b56\u5206\u6790\u5beb\u5165 BigQuery](https://cloud.google.com/asset-inventory/docs/analyzing-iam-policy-longrunning-bigquery?hl=zh-cn) \u3002## \u7ba1\u7406\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\n\u60a8\u7684\u7d44\u7e54\u4e2d\u7684\u67d0\u4e9b\u7528\u6236\u53ef\u80fd\u9700\u8981\u67d0\u4e9b Google Cloud \u8cc7\u6e90\u7684\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u624d\u80fd\u57f7\u884c\u7ba1\u7406\u4efb\u52d9\u3002\u4f8b\u5982\uff0c\u9019\u4e9b\u7528\u6236\u53ef\u80fd\u9700\u8981\u7ba1\u7406\u7279\u5b9a\u7684 Google Cloud \u9805\u76ee\u3001\u8a2d\u7f6e\u9805\u76ee\u7d50\u7b97\u548c\u9810\u7b97\uff0c\u6216\u8005\u7ba1\u7406 Compute Engine \u5be6\u4f8b\u3002\n\u60a8\u53ef\u4ee5 [\u8b93\u7528\u6236\u8acb\u6c42\u5373\u6642\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/architecture/manage-just-in-time-privileged-access-to-project?hl=zh-cn) \uff0c\u800c\u4e0d\u662f\u6c38\u4e45\u6388\u4e88\u7528\u6236\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u3002\u4f7f\u7528\u5373\u6642\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u7ba1\u7406\u53ef\u4ee5\u5e6b\u52a9\u60a8\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- \u964d\u4f4e\u6709\u4eba\u610f\u5916\u4fee\u6539\u6216\u522a\u9664\u8cc7\u6e90\u7684\u98a8\u96aa\u3002\u4f8b\u5982\uff0c\u5982\u679c\u7528\u6236\u50c5\u5728\u9700\u8981\u6642\u5177\u6709\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\uff0c\u5247\u6709\u52a9\u65bc\u9632\u6b62\u4ed6\u5011\u5728\u5176\u4ed6\u6642\u9593\u904b\u884c\u8173\u672c\uff0c\u4ee5\u514d\u7121\u610f\u4e2d\u5f71\u97ff\u4ed6\u5011\u4e0d\u61c9\u80fd\u5920\u66f4\u6539\u7684\u8cc7\u6e90\u3002\n- \u5275\u5efa\u5be9\u8988\u8ddf\u8e64\uff0c\u4ee5\u6307\u660e\u6fc0\u6d3b\u6b0a\u9650\u7684\u539f\u56e0\u3002\n- \u9032\u884c\u5be9\u8988\u548c\u8907\u8988\uff0c\u4ee5\u5206\u6790\u904e\u53bb\u7684\u6d3b\u52d5\u3002\n\u6216\u8005\uff0c\u60a8\u4e5f\u53ef\u4ee5\u6388\u4e88\u5c0d\u670d\u52d9\u8cec\u865f\u7684\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\uff0c\u4e26\u5141\u8a31\u7528\u6236 [\u6a21\u64ec\u8a72\u670d\u52d9\u8cec\u865f](https://cloud.google.com/iam/docs/service-account-impersonation?hl=zh-cn) \u3002\n### \u5411\u7528\u6236\u6388\u4e88\u7279\u6b0a\u8a2a\u554f\n\u6982\u62ec\u5730\u8aaa\uff0c\u5c0d Google Cloud \u4e2d\u5c0d\u4f01\u696d\u7528\u6236\u7684\u7279\u6b0a\u8a2a\u554f\u7684\u7ba1\u7406\u53ef\u4ee5\u6982\u62ec\u5982\u4e0b\uff1a\n- \u4f7f\u4f01\u696d\u4e2d\u7684\u7528\u6236\u80fd\u5920\u8acb\u6c42\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u3002\n- \u67e5\u770b [Cloud Audit Logs](https://cloud.google.com/logging/docs/audit?hl=zh-cn) \u4ee5\u5206\u6790\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u8acb\u6c42\u548c\u8a2a\u554f\u6a21\u5f0f\u3002\u7ba1\u7406\u54e1\u53ef\u4ee5\u67e5\u770b\u7279\u6b0a\u8a2a\u554f\u6a21\u5f0f\uff0c\u4e26\u5229\u7528\u9019\u4e9b\u65e5\u8a8c\u6aa2\u6e2c\u7570\u5e38\u60c5\u6cc1\u3002\u6211\u5011\u5efa\u8b70\u4f01\u696d\u8003\u616e\u5c0e\u51fa\u9019\u4e9b\u65e5\u8a8c\uff0c\u4ee5\u4fbf\u6839\u64da\u9700\u8981\u4e26\u5728\u5408\u9069\u7684\u60c5\u6cc1\u9032\u884c\u4fdd\u7559\uff0c\u4ee5\u4fbf\u7528\u65bc\u5be9\u8988\u3002\n- \u78ba\u4fdd\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u6703\u81ea\u52d5\u904e\u671f\u6216\u5b9a\u671f\u9032\u884c\u5be9\u8988\u3002\n\u7232\u5177\u6709\u8cc7\u6e90\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u7684\u6240\u6709\u7528\u6236 [\u5553\u7528\u5169\u6b65\u9a57\u8b49](https://support.google.com/cloudidentity/answer/9176657?hl=zh-cn) \uff08\u4e5f\u7a31\u7232\u591a\u91cd\u8eab\u4efd\u9a57\u8b49\uff09\u3002\u60a8\u9084\u53ef\u4ee5\u4f7f\u7528 [Access Context Manager](https://cloud.google.com/access-context-manager/docs/overview?hl=zh-cn) \u4f86\u5275\u5efa\u57fa\u65bc\u7279\u6027\u7684\u7cbe\u7d30\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\uff0c\u53ef\u5728\u4f7f\u7528\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u6642\u5f37\u5236\u5be6\u65bd\u4e00\u5c64\u984d\u5916\u7684\u5b89\u5168\u4fdd\u969c\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5275\u5efa\u4e00\u500b\u8a2a\u554f\u6b0a\u9650\u7d1a\u5225\uff0c\u4ee5\u6307\u5b9a\u7528\u6236\u5728\u4f7f\u7528\u5c0d\u8cc7\u6e90\u7684\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u6642\u5fc5\u9808\u4f4d\u65bc\u4f01\u696d\u7db2\u7d61\u4e0a\u3002\n### \u5be6\u73fe\n\u5728\u6b64\u793a\u4f8b\u904e\u7a0b\u4e2d\uff0c\u60a8\uff08\u4f5c\u7232\u7ba1\u7406\u54e1\uff09\u5275\u5efa\u4e00\u500b Google \u7fa3\u7d44\u4ee5\u7372\u5f97\u5c0d Compute Engine \u5be6\u4f8b\u7684\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u3002\u60a8\u5c07\u5728 Google Cloud \u4e2d\u5275\u5efa\u4e00\u500b\u670d\u52d9\u8cec\u865f\u4f75\u7232\u5176\u63d0\u4f9b\u7ba1\u7406 Compute Engine \u5be6\u4f8b\u7684\u8a2a\u554f\u6b0a\u9650\u3002\u60a8\u5c07\u8a72\u7fa3\u7d44\u8207\u8a72\u670d\u52d9\u8cec\u865f\u76f8\u95dc\u806f\uff0c\u4ee5\u4fbf\u7fa3\u7d44\u6210\u54e1\u5728\u64c1\u6709\u7279\u6b0a\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u7684\u6642\u9593\u6bb5\u5167\u80fd\u5920\u6a21\u64ec\u670d\u52d9\u8cec\u865f\u3002\n### \u5275\u5efa Google \u7fa3\u7d44\u4ee5\u7372\u5f97\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\n- \u4f5c\u7232 Google Cloud \u7ba1\u7406\u54e1\uff0c\u9078\u64c7\u6216\u5275\u5efa\u4e00\u500b Google Cloud \u9805\u76ee\u3002 [\u8f49\u5230\u201c\u7ba1\u7406\u8cc7\u6e90\u201d](https://console.cloud.google.com/cloud-resource-manager?hl=zh-cn) \n- \u7232\u60a8\u7684\u9805\u76ee\u5553\u7528\u7d50\u7b97\u529f\u80fd\u3002 [\u5553\u7528\u7d50\u7b97\u529f\u80fd](https://cloud.google.com/billing/docs/how-to/modify-project?hl=zh-cn) \n- \u6309\u7167 [\u4f7f\u7528\u6236\u80fd\u5920\u8acb\u6c42\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650](#giving_users_the_ability_to_request_access_to_resources) \u4e2d\u7684\u6b65\u9a5f\uff0c\u5275\u5efa\u4e00\u500b\u65b0\u7684 Google \u7fa3\u7d44\u3002\u5c07\u8a72\u7d44\u547d\u540d\u5982\u4e0b\uff1a `elevated-compute-access`\n### \u5275\u5efa Google Cloud \u670d\u52d9\u8cec\u865f\n- \u5728 Cloud Shell \u4e2d\uff0c\u7232\u60a8\u5728 [\u5275\u5efa Google \u7fa3\u7d44\u4ee5\u7372\u5f97\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/architecture/patterns-practices-identity-access-governance-google-cloud?hl=zh-cn#create-a-google-group-for-privileged-access) \u4e2d\u5275\u5efa\u7684\u9805\u76ee\u5553\u7528 IAM Service Account Credentials API\u3002 [ \u5553\u7528 API](https://console.cloud.google.com/flows/enableapi?apiid=iamcredentials.googleapis.com&hl=zh-cn) \n- \u8a2d\u7f6e\u4ee5\u4e0b\u8b8a\u91cf\uff1a```\nexport PROJECT_ID=$DEVSHELL_PROJECT_IDexport PRIV_SERVICE_ACCOUNT_NAME=elevated-compute-accessexport DELEGATE_GROUP=GROUP_EMAIL_ADDRESS\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u5275\u5efa\u7684 Google \u7fa3\u7d44\u7684\u5168\u540d\u3002\n- \u5275\u5efa\u670d\u52d9\u8cec\u865f\uff1a```\ngcloud IAMservice-accounts create $PRIV_SERVICE_ACCOUNT_NAME \\\u00a0 \u00a0 --description=\"Elevated compute access\" \\\u00a0 \u00a0 --display-name=\"Elevated compute access\"\n```\n- \u7232\u670d\u52d9\u8cec\u865f\u6388\u4e88\u8a08\u7b97\u7ba1\u7406\u54e1\u89d2\u8272\uff1a```\ngcloud projects add-iam-policy-binding $PROJECT_ID \\\u00a0 \u00a0 --member=\"serviceAccount:$PRIV_SERVICE_ACCOUNT_NAME@$PROJECT_ID.iam.gserviceaccount.com\" \\\u00a0 \u00a0 --role=\"roles/compute.admin\"\n```\n- \u6388\u4e88\u60a8\u7232\u9805\u76ee\u5275\u5efa\u7684\u201c\u670d\u52d9\u4f7f\u7528\u60c5\u6cc1\u201d\u4f7f\u7528\u8005\u7684 Google \u7fa3\u7d44\u8a2a\u554f\u6b0a\u9650\uff1a```\ngcloud projects add-iam-policy-binding $PROJECT_ID \\\u00a0 \u00a0 --member=\"group:$DELEGATE_GROUP\" \\\u00a0 \u00a0 --role=\"roles/serviceusage.serviceUsageConsumer\"\n```\u6b64\u6b0a\u9650\u5141\u8a31 Google \u7fa3\u7d44\u6210\u54e1\u6a21\u64ec\u60a8\u5275\u5efa\u7684\u670d\u52d9\u8cec\u865f\u3002\n- \u4f7f Google \u7fa3\u7d44\u6a21\u80fd\u5920\u64ec\u60a8\u5275\u5efa\u7684\u670d\u52d9\u8cec\u865f\uff1a```\ngcloud IAMservice-accounts add-iam-policy-binding$PRIV_SERVICE_ACCOUNT_NAME@$PROJECT_ID.iam.gserviceaccount.com --member=\"group:$DELEGATE_GROUP\" --role=\"roles/iam.serviceAccountTokenCreator\"\n```\n- \u5982\u679c\u60a8\u7232 [\u9650\u6642\u8a2a\u554f Google Cloud \u8cc7\u6e90](#giving-time-bound-access-to-google-cloud-resources) \u4e2d\u7684\u904e\u7a0b\u5275\u5efa\u4e26\u4fdd\u7559\u4e86\u793a\u4f8b Compute Engine \u5be6\u4f8b\uff0c\u8acb\u8df3\u904e\u6b64\u6b65\u9a5f\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u793a\u4f8b\u5be6\u4f8b\u4f86\u904b\u884c\u672c\u793a\u4f8b\u4e2d\u7684\u6b65\u9a5f\u3002\u6216\u8005\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5275\u5efa\u4e00\u500b\u793a\u4f8b Compute Engine \u5be6\u4f8b\uff1a```\ngcloud compute instances create example-instance-1 \\\u00a0 \u00a0 --zone us-west1-b \\\u00a0 \u00a0 --machine-type g1-small\n```\u5728\u672c\u793a\u4f8b\u4e2d\uff0c\u60a8\u4f7f\u7528\u5be6\u4f8b\u4f86\u9a57\u8b49\u6388\u4e88\u4e86\u7279\u6b0a\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u7684\u7528\u6236\u53ef\u4ee5\u8a2a\u554f\u8a72\u5be6\u4f8b\u3002\n### \u5553\u7528\u5be9\u8988\u65e5\u8a8c\n\u60a8\u4f01\u696d\u4e2d\u7684\u7ba1\u7406\u54e1\u53ef\u4ee5\u5553\u7528 Cloud Audit Logs\uff0c\u4ee5\u78ba\u4fdd\u6703\u8a18\u9304\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u4e26\u53ef\u4ee5\u67e5\u770b\u548c\u5206\u6790\u3002\u672c\u90e8\u5206\u4e2d\u7684\u904e\u7a0b\u4ecb\u7d39\u77ad\u5982\u4f55\u5553\u7528\u5be9\u8988\u65e5\u8a8c\u8a18\u9304\u529f\u80fd\u3002\n- \u7372\u53d6\u9805\u76ee\u7684\u7576\u524d IAM \u653f\u7b56\uff1a```\ngcloud projects get-iam-policy $PROJECT_ID > /tmp/policy.yaml\n```\n- \u4fee\u6539\u653f\u7b56\u6587\u4ef6\uff0c\u4ee5\u4fbf\u7232 Compute Engine API \u5553\u7528\u6578\u64da\u8a2a\u554f\u65e5\u8a8c\uff1a```\ncat <<EOF >> /tmp/policy.yamlauditConfigs:- auditLogConfigs:\u00a0- logType: ADMIN_READ\u00a0- logType: DATA_READ\u00a0- logType: DATA_WRITE\u00a0service: compute.googleapis.comEOF\n```\n- \u8a2d\u7f6e\u65b0\u653f\u7b56\uff1a```\ngcloud projects set-iam-policy $PROJECT_ID /tmp/policy.yaml\n```\n### \u4f7f\u7528\u975e\u7ba1\u7406\u54e1\u7528\u6236\u8cec\u865f\u6e2c\u8a66\u6a21\u64ec\n\u60a8\u53ef\u4ee5\u4f7f\u7528\u975e\u7ba1\u7406\u54e1\u7528\u6236\u8cec\u865f\u6e2c\u8a66\u6210\u54e1\u8cc7\u683c\uff0c\u65b9\u6cd5\u662f\u901a\u904e\u8acb\u6c42\u7fa3\u7d44\u7684\u6210\u54e1\u8cc7\u683c\u4e26\u5728\u7372\u5f97\u6210\u54e1\u8cc7\u683c\u5f8c\u6a21\u64ec\u670d\u52d9\u8cec\u865f\u3002\n\u672c\u90e8\u5206\u4e2d\u7684\u904e\u7a0b\u4ecb\u7d39\u4e86\u4f01\u696d\u7528\u6236\u5982\u4f55\u8acb\u6c42 Google Cloud \u8cc7\u6e90\u7684\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650\u3002\u5728\u6b64\u793a\u4f8b\u904e\u7a0b\u4e2d\uff0cGoogle Cloud \u8cc7\u6e90\u662f Google Cloud \u9805\u76ee\u7684 Compute Engine \u5be6\u4f8b\u3002\u7232\u4e86\u6f14\u793a\u7d44\u7e54\u4e2d\u7684\u7528\u6236\u5728\u7372\u5f97\u7fa3\u7d44\u7684\u6210\u54e1\u8cc7\u683c\u5f8c\u5982\u4f55\u6a21\u64ec\u670d\u52d9\u8cec\u865f\uff0c\u60a8\u53ef\u4ee5\u8acb\u6c42\u76f8\u95dc Google \u7fa3\u7d44\u7684\u6210\u54e1\u8cc7\u683c\u3002\n- \u4f7f\u7528\u975e\u7ba1\u7406\u54e1\u7528\u6236\u8cec\u865f [\u767b\u9304](http://groups.google.com?hl=zh-cn) Google \u7fa3\u7d44\uff0c\u4e26\u8acb\u6c42`elevated-compute-access`\u7fa3\u7d44\u7684\u6210\u54e1\u8cc7\u683c\u3002\n- \u8acb\u4f7f\u7528\u540c\u4e00\u8cec\u865f\u767b\u9304 Google Cloud\u3002\u7ba1\u7406\u54e1\u6279\u51c6\u8acb\u6c42\u5f8c\uff0c\u60a8\u61c9\u8a72\u6709\u6b0a\u8a2a\u554f\u8a72\u7fa3\u7d44\u3002\u5728\u672c\u793a\u4f8b\u904e\u7a0b\u4e2d\uff0c\u5047\u8a2d\u60a8\u7684\u7fa3\u7d44\u6210\u54e1\u8cc7\u683c\u8acb\u6c42\u5df2\u7372\u6279\u51c6\u3002 **\u6ce8\u610f** \uff1a\u6839\u64da\u4f01\u696d\u7684\u7279\u5b9a\u696d\u52d9\u9700\u6c42\uff0c\u7fa3\u7d44\u7ba1\u7406\u54e1\u61c9\u5411\u7528\u6236\u6388\u4e88\u6703\u904e\u671f\u7684\u6210\u54e1\u8cc7\u683c\u3002\u4ed6\u5011\u5fc5\u9808\u9075\u5faa [Cloud Identity API \u6587\u6a94](https://cloud.google.com/identity/docs/reference/rest/v1beta1/groups.memberships?hl=zh-cn#ExpiryDetail) \u4e2d\u4ecb\u7d39\u7684\u6307\u5357\u3002\u5728\u672c\u6587\u6a94\u4e2d\uff0c\u6211\u5011\u5047\u8a2d\u60a8\u5728 [\u5275\u5efa Google \u7fa3\u7d44\u4ee5\u7372\u5f97\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650](https://cloud.google.com/architecture/patterns-practices-identity-access-governance-google-cloud?hl=zh-cn#create-a-google-group-for-privileged-access) \u4e2d\u7528\u65bc\u5275\u5efa Google \u7fa3\u7d44\u7684\u7528\u6236\u8cec\u865f\u662f\u7fa3\u7d44\u7ba1\u7406\u54e1\u3002\n- \u5728 Cloud Shell \u4e2d\uff0c\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u8a2d\u7f6e\u9ed8\u8a8d\u9805\u76ee\uff1a```\ngcloud config set project PROJECT_ID\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u4e4b\u524d\u5728 [\u5275\u5efa Google \u7fa3\u7d44\u4ee5\u7372\u5f97\u7279\u6b0a\u8a2a\u554f\u6b0a\u9650](#create-a-google-group-for-privileged-access) \u90e8\u5206\u4e2d\u5275\u5efa\u7684\u9805\u76ee ID\u3002\n- \u5617\u8a66\u5217\u51fa\u6b64\u9805\u76ee\u4e2d\u7684 Compute Engine \u5be6\u4f8b\uff1a```\ngcloud compute instances list\n```\u7cfb\u7d71\u6703\u986f\u793a\u932f\u8aa4\u6d88\u606f\uff0c\u901a\u77e5\u60a8 Google Cloud \u7528\u6236\u7121\u6b0a\u8a2a\u554f Compute Engine \u8cc7\u6e90\u3002\n- \u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a```\ngcloud compute instances list--impersonate-service-account=elevated-compute-access@$PROJECT_ID.iam.gserviceaccount.com\n```\u6b64\u547d\u4ee4\u901a\u904e\u6a21\u64ec\u60a8\u7372\u5f97 `elevated-compute-access` Google \u7fa3\u7d44\u6210\u54e1\u8eab\u4efd\u6642\u53ef\u4ee5\u8a2a\u554f\u7684\u670d\u52d9\u8cec\u865f\uff0c\u5217\u51fa\u9805\u76ee\u4e2d\u7684 Compute Engine \u5be6\u4f8b\u3002\u60a8\u6703\u770b\u5230\u60a8\u4f7f\u7528\u7ba1\u7406\u54e1\u8cec\u865f\u5275\u5efa\u7684 `example-instance-1` Compute Engine \u5be6\u4f8b\u3002\n### \u67e5\u770b\u5be9\u8988\u65e5\u8a8c\n\u4f5c\u7232 Google Cloud \u7ba1\u7406\u54e1\uff0c\u60a8\u53ef\u4ee5\u8a2a\u554f\u548c\u67e5\u770b\u751f\u6210\u7684\u5be9\u8988\u65e5\u8a8c\u3002\n- \u4f7f\u7528\u64c1\u6709\u7ba1\u7406\u54e1\u6b0a\u9650\u7684\u7528\u6236\u8cec\u865f\u767b\u9304 Google Cloud \u63a7\u5236\u6aaf\uff0c\u4ee5\u8a2a\u554f\u5be9\u8988\u65e5\u8a8c\u3002\n- \u5728 Cloud Logging \u4e2d\uff0c\u8f38\u5165\u67e5\u8a62\u4ee5\u67e5\u770b\u6578\u64da\u8a2a\u554f\u65e5\u8a8c\uff1a```\nlogName=\"projects/<PROJECT_ID>/logs/cloudaudit.googleapis.com%2Fdata_access\"ANDprotoPayload.authenticationInfo.principalEmail=\"elevated-compute-access@PROJECT_ID.iam.gserviceaccount.com\"\n```\u5c07 `` \u66ff\u63db\u7232\u60a8\u7684\u9805\u76ee ID\uff0c\u7136\u5f8c\u904b\u884c\u67e5\u8a62\u3002\u6b64\u67e5\u8a62\u6703\u986f\u793a Google \u7fa3\u7d44\u4e2d\u7684\u54ea\u4e9b\u7528\u6236\u66fe\u6a21\u64ec\u670d\u52d9\u8cec\u865f\u8a2a\u554f Compute Engine \u5be6\u4f8b\u3002\u5b83\u9084\u6703\u986f\u793a\u5176\u4ed6\u76f8\u95dc\u8a73\u7d30\u4fe1\u606f\uff0c\u4f8b\u5982\u6a21\u64ec\u670d\u52d9\u8cec\u865f\u7684\u6642\u9593\u4ee5\u53ca\u8acb\u6c42\u6a19\u982d\u7684\u8a73\u7d30\u4fe1\u606f\u3002\n- \u67e5\u770b\u5be9\u8988\u65e5\u8a8c\u8ca0\u8f09\uff0c\u5c24\u5176\u662f\u8f09\u8377\u4e2d\u7684 `protoPayload.authenticationInfo` \u5c0d\u8c61\u3002\u6a21\u64ec\u670d\u52d9\u8cec\u865f\u7684\u7528\u6236\u7684\u7528\u6236\u540d\u6703\u8a18\u9304\u7232 `firstPartyPrincipal` \u5c0d\u8c61\u7684 `principalEmail` \u9375\u7684\u503c\u3002\n- \u4f5c\u7232\u7ba1\u7406\u54e1\uff0c\u60a8\u9084\u53ef\u4ee5\u5728 Security Command Center \u4fe1\u606f\u4e2d\u5fc3\u5167\u67e5\u770b\u4e8b\u4ef6\u5a01\u8105\u767c\u73fe\u7d50\u679c\u3002\u5982\u9700\u8a73\u7d30\u77ad\u89e3 Security Command Center\uff0c\u8acb\u53c3\u95b1 [\u4f7f\u7528 Event Threat Detection](https://cloud.google.com/security-command-center/docs/how-to-use-event-threat-detection?hl=zh-cn) \u3002## \u5f8c\u7e8c\u6b65\u9a5f\n- \u67e5\u770b [\u7ba1\u7406\u8eab\u4efd\u548c\u8a2a\u554f\u6b0a\u9650\u7684\u6700\u4f73\u5be6\u8e10](https://cloud.google.com/architecture/framework/security/identity-access?hl=zh-cn) \u3002\n- \u77ad\u89e3 [Policy Intelligence](https://cloud.google.com/policy-intelligence?hl=zh-cn) \u5982\u4f55\u7232\u60a8\u7684 Google Cloud \u8cc7\u6e90\u63d0\u4f9b\u667a\u80fd\u7684\u8a2a\u554f\u6b0a\u9650\u63a7\u5236\u3002\n- \u77ad\u89e3\u5982\u4f55 [\u6392\u67e5 Google Cloud \u4e0a\u7684\u653f\u7b56\u548c\u8a2a\u554f\u6b0a\u9650\u554f\u984c](https://cloud.google.com/vpc/docs/troubleshooting-policy-and-access-problems?hl=zh-cn) \n- \u77ad\u89e3 [\u5275\u5efa\u548c\u7ba1\u7406 Google Cloud \u670d\u52d9\u8cec\u865f](https://cloud.google.com/iam/docs/understanding-service-accounts?hl=zh-cn#best_practices) \u7684\u6700\u4f73\u505a\u6cd5\u3002\n- \u63a2\u7d22\u6709\u95dc Google Cloud \u7684\u53c3\u8003\u67b6\u69cb\u3001\u5716\u8868\u548c\u6700\u4f73\u505a\u6cd5\u3002\u67e5\u770b\u6211\u5011\u7684 [Cloud Architecture Center](https://cloud.google.com/architecture?hl=zh-cn) \u3002", "guide": "Docs"}