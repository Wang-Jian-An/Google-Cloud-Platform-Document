{"title": "Live Stream API - \u52a0\u5bc6\u76f4\u64ad", "url": "https://cloud.google.com/livestream/docs/how-to/encrypt-content?hl=zh-cn", "abstract": "# Live Stream API - \u52a0\u5bc6\u76f4\u64ad\n\u672c\u9801\u4ecb\u7d39\u77ad\u5982\u4f55\u52a0\u5bc6\u76f4\u64ad\u5167\u5bb9\u3002Live Stream API \u4e0d\u76f4\u63a5\u5275\u5efa\u6216\u7ba1\u7406\u52a0\u5bc6\u5bc6\u9470\u6216\u8a31\u53ef\u3002\u60a8\u5fc5\u9808\u901a\u904e\u7b2c\u4e09\u65b9\u6578\u5b57\u7248\u6b0a\u7ba1\u7406 (DRM) \u63d0\u4f9b\u5546\u624d\u80fd\u4f7f\u7528\u9019\u4e9b\u529f\u80fd\u3002\u7232\u5a92\u9ad4\u5275\u5efa\u52a0\u5bc6\u5bc6\u9470\u5f8c\uff0c\u8acb\u4f7f\u7528 [Secret Manager](https://cloud.google.com/secret-manager?hl=zh-cn) \u5c07\u9019\u4e9b\u5bc6\u9470\u50b3\u905e\u7d66 Live Stream API\u3002\n\u52a0\u5bc6\u8a2d\u7f6e\u5728 [Channel](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels?hl=zh-cn) \u8a2d\u7f6e\u4e2d\u6307\u5b9a\u3002\u76f4\u64ad\u958b\u59cb\u5f8c\uff0cLive Stream API \u8996\u983b\u6d41\u6c34\u7dda\u6703\u958b\u59cb\u52a0\u5bc6\u60a8\u7684\u5167\u5bb9\u3002\u8f38\u51fa\u6e05\u55ae\u5305\u542b\u5728\u60a8\u9078\u64c7\u7684\u5a92\u9ad4\u64ad\u653e\u5668\u4e2d\u89e3\u5bc6\u5167\u5bb9\u6240\u9700\u7684\u4fe1\u606f\u3002\n", "content": "## \u53d7\u652f\u6301\u7684\u914d\u7f6e\n| \u6d41\u5f0f\u50b3\u8f38\u5354\u8b70 | \u5bb9\u5668 | DRM \u7cfb\u7d71 | \u52a0\u5bc6\u67b6\u69cb    |\n|:---------------|:-------|:-----------|:----------------------|\n| HLS   | TS  | ClearKey | aes128    |\n| HLS   | TS  | ClearKey | sampleAes    |\n| HLS   | TS  | FairPlay | sampleAes    |\n| HLS   | fMP4 | FairPlay | \u50c5\u9650 mpegCenc cbcs |\n| MPEG-DASH  | fMP4 | ClearKey | mpegCenc cenc \u6216 cbcs |\n| MPEG-DASH  | fMP4 | Widevine | mpegCenc cenc \u6216 cbcs |\n| HLS   | fMP4 | Widevine | mpegCenc cenc \u6216 cbcs |\n| MPEG-DASH  | fMP4 | PlayReady | mpegCenc cenc \u6216 cbcs |\n| HLS   | fMP4 | PlayReady | mpegCenc cenc \u6216 cbcs |\n## \u5c07\u52a0\u5bc6\u5bc6\u9470\u6dfb\u52a0\u5230 Secret Manager\n\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u4f7f\u7528\u60a8\u9078\u64c7\u7684\u7b2c\u4e09\u65b9 DRM \u63d0\u4f9b\u5546\u5275\u5efa\u52a0\u5bc6\u5bc6\u9470\u3002\nLive Stream API \u8981\u6c42\u60a8\u7684 Secret \u5305\u542b\u5982\u4e0b JSON \u683c\u5f0f\u7684\u52a0\u5bc6\u5bc6\u9470\u4ee5\u53ca\u5176\u4ed6\u5fc5\u8981\u4fe1\u606f\u3002\n\u5982\u9700\u67e5\u770b\u5c0d\u5404\u500b\u5b57\u6bb5\u7684\u8aaa\u660e\uff0c\u8acb\u53c3\u95b1 [DRM \u5354\u8b70\u6587\u6a94](https://cloud.google.com/livestream/docs/reference/drm?hl=zh-cn) \u3002\u8acb\u6ce8\u610f\uff0c\u5c0d\u65bc JSON \u683c\u5f0f\uff0c\u60a8\u9700\u8981\u5f9e\u86c7\u5f62\u547d\u540d\u6cd5\u8f49\u63db\u7232\u99dd\u5cef\u5f0f\u5927\u5c0f\u5beb\u3002\n```\n{\u00a0 \"encryptionKeys\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 // Key for FairPlay configuration.\u00a0 \u00a0 \u00a0 \"keyId\": \"d569cb35bd0548c7a99d92feb381df13\",\u00a0 \u00a0 \u00a0 \"key\": \"f1967daca83e81f38d80aa741e7b32c2\",\u00a0 \u00a0 \u00a0 \"iv\": \"8d80aa741e7b32c2f1967daca83e81f3\",\u00a0 \u00a0 \u00a0 \"keyUri\": \"skd://d569cb35bd0548c7a99d92feb381df13\",\u00a0 \u00a0 \u00a0 \"matchers\": [\u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"muxStreams\": [\"ts_fairplay\"]\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 // Key for Widevine configurations.\u00a0 \u00a0 \u00a0 \"keyId\": \"44ec248b048c43a6a6ee58a752c6f9f8\",\u00a0 \u00a0 \u00a0 \"key\": \"f1967daca83e81f38d80aa741e7b32c2\",\u00a0 \u00a0 \u00a0 \"keyUri\": \"skd://44ec248b048c43a6a6ee58a752c6f9f8\",\u00a0 \u00a0 \u00a0 \"matchers\": [\u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"muxStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fmp4_widevine_cenc_video\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fmp4_widevine_cenc_audio\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fmp4_widevine_cbcs_video\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fmp4_widevine_cbcs_audio\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 // Key for PlayReady configurations.\u00a0 \u00a0 \u00a0 \"keyId\": \"8beed229709f480bb6004ec0f33e82d1\",\u00a0 \u00a0 \u00a0 \"key\": \"ad20cd838f354dcc8a77c443d08ff09f\",\u00a0 \u00a0 \u00a0 \"keyUri\": \"skd://8beed229709f480bb6004ec0f33e82d1\",\u00a0 \u00a0 \u00a0 \"matchers\": [\u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"muxStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fmp4_playready_cenc_video\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fmp4_playready_cenc_audio\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fmp4_playready_cbcs_video\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"fmp4_playready_cbcs_audio\"\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 // Key for all ClearKey configurations.\u00a0 \u00a0 \u00a0 \"keyId\": \"3d9dccb479c64adbb6e514790caa7822\",\u00a0 \u00a0 \u00a0 \"key\": \"f1967daca83e81f38d80aa741e7b32c2\",\u00a0 \u00a0 \u00a0 \"keyUri\": \"https://example.com/keys/3d9dccb479c64adbb6e514790caa7822.bin\",\u00a0 \u00a0 \u00a0 \"iv\": \"8d80aa741e7b32c2f1967daca83e81f3\"\u00a0 \u00a0 \u00a0 // No `matchers` field. This is the default key to use when none of the keys above match.\u00a0 \u00a0 }\u00a0 ]}\n```\n\u5982\u679c\u60a8\u7684\u52a0\u5bc6\u914d\u7f6e\uff08\u4f8b\u5982 FairPlay\uff09\u9700\u8981\u986f\u5f0f\u521d\u59cb\u5316\u77e2\u91cf (IV)\uff0c\u4f46\u8a72\u77e2\u91cf\u4e26\u672a\u5305\u542b\u5728\u5167\uff0c\u5247 API \u5c07\u4f7f\u7528 `keyId` \u7684\u503c\u4f5c\u7232 `iv` \u7684\u503c\u3002\n\u5982\u9700\u6dfb\u52a0\u52a0\u5bc6\u5bc6\u9470\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u4efb\u4e00\u64cd\u4f5c\uff1a\n- \u624b\u52d5\u6dfb\u52a0\u548c\u914d\u7f6e\u5bc6\u9470\u3002\u4f7f\u7528\u4e0a\u8ff0 JSON \u6578\u64da\uff0c\u6309\u7167 [\u5275\u5efa Secret](https://cloud.google.com/secret-manager/docs/creating-and-accessing-secrets?hl=zh-cn) \u4e2d\u7684\u6b65\u9a5f\u5c07\u52a0\u5bc6\u5bc6\u9470\u6dfb\u52a0\u5230 Secret Manager\u3002\n- \u5be6\u73fe `key publisher` \uff0c\u5b83\u6703\u7372\u53d6\u6240\u9700\u7684\u4efb\u4f55\u52a0\u5bc6\u5bc6\u9470\uff0c\u4e26\u5c07\u5176\u4f5c\u7232 Secret \u7248\u672c\u5beb\u5165 Secret Manager\u3002\u8acb\u53c3\u95b1 [\u4f5c\u7232 Cloud Functions \u51fd\u6578\u904b\u884c\u7684\u793a\u4f8b\u5be6\u73fe](https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/cloud-media-livestream/keypublisher) \u3002 **\u6ce8\u610f** \uff1a\u5be6\u73fe Secret Manager \u53ef\u80fd\u6703\u7522\u751f\u4e00\u4e9b [\u984d\u5916\u8cbb\u7528](https://cloud.google.com/secret-manager/pricing?hl=zh-cn) \u3002\n\u7136\u5f8c\uff0c\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\u4f86\u914d\u7f6e\u52a0\u5bc6\u5bc6\u9470\uff1a\n- \u914d\u7f6e\u6709\u95dc Secret \u7684 IAM \u6b0a\u9650\uff0c\u4ee5\u4fbf Live Stream API \u53ef\u4ee5\u8a2a\u554f Secret \u5167\u5bb9\u3002\u7232\u6b64\uff0c\u8acb\u5c07`secretmanager.secretAccessor`\u89d2\u8272\u6388\u4e88`service-` `` `@gcp-sa-livestream.iam.gserviceaccount.com`\u670d\u52d9\u5e33\u865f\uff08\u9019\u8207 [\u670d\u52d9\u5e33\u865f\u8a2a\u554f\u60a8\u7684 Cloud Storage \u5b58\u5132\u5206\u5340](https://cloud.google.com/livestream/docs/access-control?hl=zh-cn#access_to_gcs) \u985e\u4f3c\uff09\u3002\n- \u67e5\u627e\u60a8\u5275\u5efa\u7684 Secret \u7248\u672c\u7684\u8cc7\u6e90\u540d\u7a31\uff08\u4f8b\u5982`projects/` `` `/secrets/` `` `/versions/` ``\uff09\u3002\u60a8\u9700\u8981\u6b64\u540d\u7a31\u4f86\u914d\u7f6e\u6e20\u9053\u3002## \u914d\u7f6e\u6e20\u9053\n\u52a0\u5bc6\u8a2d\u7f6e\u4f7f\u7528 `Channel` \u7d1a\u5225\u7684 [encryptions](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels?hl=zh-cn#Channel.FIELDS.encryptions) \u6578\u7d44\u4e2d\u7684\u5c0d\u8c61\u6307\u5b9a\u3002\u7cfb\u7d71\u6703\u7232\u6bcf\u500b\u4e0d\u540c\u7684\u914d\u7f6e\u5206\u914d\u4e00\u500b\u552f\u4e00\u6a19\u8b58\u7b26 ( [id](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels?hl=zh-cn#encryption) )\u3002\u6bcf\u500b `muxStream` \u5747\u4f7f\u7528\u6a19\u8b58\u7b26\u4f86\u6307\u793a\u8981\u4f7f\u7528\u7684\u52a0\u5bc6\u914d\u7f6e\uff0c\u6216\u7701\u7565\u8a72\u5b57\u6bb5\u4ee5\u4fdd\u6301\u672a\u52a0\u5bc6\u72c0\u614b\u3002\n```\n{\u00a0 // other channel settings \u2026\u00a0 \"encryptions\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 // Identifier for this encryption configuration, to be specified in muxStream(s).\u00a0 \u00a0 \u00a0 \"id\": string,\u00a0 \u00a0 \u00a0 // Configuration for secrets stored in Google Secret Manager.\u00a0 \u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \u00a0 // The name of the Secret Version containing the encryption key.\u00a0 \u00a0 \u00a0 \u00a0 // `projects/{project}/secrets/{secret_id}/versions/{version_number}`\u00a0 \u00a0 \u00a0 \u00a0 // Using {version_number} of `latest` is not supported.\u00a0 \u00a0 \u00a0 \u00a0 \"secretVersion\": string\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 // DRM system(s) that will be used. At least one must be specified. If a DRM system\u00a0 \u00a0 \u00a0 // is omitted, it will be considered disabled.\u00a0 \u00a0 \u00a0 \"drmSystems\": {\u00a0 \u00a0 \u00a0 \u00a0 // Widevine configuration.\u00a0 \u00a0 \u00a0 \u00a0 \"widevine\": {},\u00a0 \u00a0 \u00a0 \u00a0 // FairPlay configuration.\u00a0 \u00a0 \u00a0 \u00a0 \"fairplay\": {},\u00a0 \u00a0 \u00a0 \u00a0 // PlayReady configuration.\u00a0 \u00a0 \u00a0 \u00a0 \"playready\": {},\u00a0 \u00a0 \u00a0 \u00a0 // ClearKey configuration.\u00a0 \u00a0 \u00a0 \u00a0 \"clearkey\": {}\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 \u00a0 // Union field encryption_mode can be only one of the following:\u00a0 \u00a0 \u00a0 // Configuration for HLS AES-128 encryption.\u00a0 \u00a0 \u00a0 \"aes128\": {},\u00a0 \u00a0 \u00a0 // Configuration for HLS SAMPLE-AES encryption.\u00a0 \u00a0 \u00a0 \"sampleAes\": {},\u00a0 \u00a0 \u00a0 // Configuration for MPEG-DASH Common Encryption (MPEG-CENC).\u00a0 \u00a0 \u00a0 \"mpegCenc\": {\u00a0 \u00a0 \u00a0 \u00a0 // Specify the encryption scheme. Supported schemes:\u00a0 \u00a0 \u00a0 \u00a0 // - `cenc` - AES-CTR subsample\u00a0 \u00a0 \u00a0 \u00a0 // - `cbcs`- AES-CBC subsample pattern\u00a0 \u00a0 \u00a0 \u00a0 \"scheme\": string\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 // End of list of possible types for union field encryption_mode.\u00a0 \u00a0 }\u00a0 \u00a0 // Any other encryption configurations.\u00a0 ],\u00a0 \"muxStreams\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 // Unique identifier for the muxStream.\u00a0 \u00a0 \u00a0 \"key\": string,\u00a0 \u00a0 \u00a0 // Identifier of the encryption configuration for the muxStream.\u00a0 \u00a0 \u00a0 \"encryptionId\": string\u00a0 \u00a0 \u00a0 // \u2026 other muxStream settings.\u00a0 \u00a0 }\u00a0 \u00a0 // Other muxStreams.\u00a0 ],\u00a0 // Other channel settings.}\n```\n\u4ee5\u4e0b\u793a\u4f8b\u5728 HLS \u6e05\u55ae\u4e2d\u914d\u7f6e AES-128 \u548c SAMPLE-AES \u591a\u8def\u8907\u7528\u6d41\uff0c\u4e26\u5728 DASH \u6e05\u55ae\u4e2d\u914d\u7f6e MPEG-CENC muxStream\uff08cenc \u548c cbcs\uff09\uff1a\n```\n\"elementaryStreams\": [\u00a0 {\u00a0 \u00a0 \"key\": \"es_video\",\u00a0 \u00a0 \"videoStream\": {\u00a0 \u00a0 \u00a0 \"h264\": {\u00a0 \u00a0 \u00a0 \u00a0 \"profile\": \"main\",\u00a0 \u00a0 \u00a0 \u00a0 \"heightPixels\": 600,\u00a0 \u00a0 \u00a0 \u00a0 \"widthPixels\": 800,\u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 1000000,\u00a0 \u00a0 \u00a0 \u00a0 \"frameRate\": 60,\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 },\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"es_audio\",\u00a0 \u00a0 \"audioStream\": {\u00a0 \u00a0 \u00a0 \"codec\": \"aac\",\u00a0 \u00a0 \u00a0 \"channelCount\": 2,\u00a0 \u00a0 \u00a0 \"bitrateBps\": 160000\u00a0 \u00a0 }\u00a0 }],\"encryptions\": [\u00a0 {\u00a0 \u00a0 \"id\": \"aes-128\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"clearkey\": {}},\u00a0 \u00a0 \"aes128\": {}\u00a0 },\u00a0 {\u00a0 \u00a0 \"id\": \"sample-aes\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"clearkey\": {}},\u00a0 \u00a0 \"sampleAes\": {}\u00a0 },\u00a0 {\u00a0 \u00a0 \"id\": \"cenc\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"clearkey\": {}},\u00a0 \u00a0 \"mpegCenc\": {\u00a0 \u00a0 \u00a0 \"scheme\": \"cenc\"\u00a0 \u00a0 }\u00a0 },\u00a0 {\u00a0 \u00a0 \"id\": \"cbcs\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"clearkey\": {}},\u00a0 \u00a0 \"mpegCenc\": {\u00a0 \u00a0 \u00a0 \"scheme\": \"cbcs\"\u00a0 \u00a0 }\u00a0 }],\"muxStreams\": [\u00a0 {\u00a0 \u00a0 \"key\": \"ts_aes128\",\u00a0 \u00a0 \"container\": \"ts\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\", \"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"aes-128\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"ts_sampleaes\",\u00a0 \u00a0 \"container\": \"ts\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\", \"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"sample-aes\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_cenc_video\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"cenc\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_cenc_audio\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"cenc\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_cbcs_video\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"cbcs\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_cbcs_audio\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"cbcs\"\u00a0 }],\"manifests\": [\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_aes128.m3u8\",\u00a0 \u00a0 \"type\": \"HLS\",\u00a0 \u00a0 \"muxStreams\": [\"ts_aes128\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_sampleaes.m3u8\",\u00a0 \u00a0 \"type\": \"HLS\",\u00a0 \u00a0 \"muxStreams\": [\"ts_sampleaes\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_cenc.mpd\",\u00a0 \u00a0 \"type\": \"DASH\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_cenc_video\", \"fmp4_cenc_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_cbcs.mpd\",\u00a0 \u00a0 \"type\": \"DASH\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_cbcs_video\", \"fmp4_cbcs_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 }]\n```\n\u4ee5\u4e0b\u793a\u4f8b\u914d\u7f6e\u4e86 FairPlay/SAMPLE-AES\u3001Widevine/MPEG-CENC\uff08cenc \u548c cbcs\uff09\u548c PlayReady/MPEG-CENC\uff08cenc \u548c cbcs\uff09\u591a\u8def\u6d41\u3002Widevine \u548c PlayReady muxStream \u90fd\u5305\u542b\u5728 HLS \u548c DASH \u6e05\u55ae\u4e2d\u3002\n```\n\"elementaryStreams\": [\u00a0 {\u00a0 \u00a0 \"key\": \"es_video\",\u00a0 \u00a0 \"videoStream\": {\u00a0 \u00a0 \u00a0 \"h264\": {\u00a0 \u00a0 \u00a0 \u00a0 \"profile\": \"main\",\u00a0 \u00a0 \u00a0 \u00a0 \"heightPixels\": 600,\u00a0 \u00a0 \u00a0 \u00a0 \"widthPixels\": 800,\u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 1000000,\u00a0 \u00a0 \u00a0 \u00a0 \"frameRate\": 60,\u00a0 \u00a0 \u00a0 },\u00a0 \u00a0 },\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"es_audio\",\u00a0 \u00a0 \"audioStream\": {\u00a0 \u00a0 \u00a0 \"codec\": \"aac\",\u00a0 \u00a0 \u00a0 \"channelCount\": 2,\u00a0 \u00a0 \u00a0 \"bitrateBps\": 160000\u00a0 \u00a0 }\u00a0 }],\"encryptions\": [\u00a0 {\u00a0 \u00a0 \"id\": \"fairplay\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"fairplay\": {}},\u00a0 \u00a0 \"sampleAes\": {}\u00a0 },\u00a0 {\u00a0 \u00a0 \"id\": \"widevine-cenc\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"widevine\": {}},\u00a0 \u00a0 \"mpegCenc\": {\u00a0 \u00a0 \u00a0 \"scheme\": \"cenc\"\u00a0 \u00a0 }\u00a0 },\u00a0 {\u00a0 \u00a0 \"id\": \"widevine-cbcs\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"widevine\": {}},\u00a0 \u00a0 \"mpegCenc\": {\u00a0 \u00a0 \u00a0 \"scheme\": \"cbcs\"\u00a0 \u00a0 }\u00a0 },\u00a0 {\u00a0 \u00a0 \"id\": \"playready-cenc\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"playready\": {}},\u00a0 \u00a0 \"mpegCenc\": {\u00a0 \u00a0 \u00a0 \"scheme\": \"cenc\"\u00a0 \u00a0 }\u00a0 },\u00a0 {\u00a0 \u00a0 \"id\": \"playready-cbcs\",\u00a0 \u00a0 \"secretManagerKeySource\": {\u00a0 \u00a0 \u00a0 \"secretVersion\": \"projects/12345/secrets/key-1/versions/1\"\u00a0 \u00a0 },\u00a0 \u00a0 \"drmSystems\": {\"playready\": {}},\u00a0 \u00a0 \"mpegCenc\": {\u00a0 \u00a0 \u00a0 \"scheme\": \"cbcs\"\u00a0 \u00a0 }\u00a0 }],\"muxStreams\": [\u00a0 {\u00a0 \u00a0 \"key\": \"ts_fairplay\",\u00a0 \u00a0 \"container\": \"ts\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\", \"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"fairplay\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_widevine_cenc_video\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"widevine-cenc\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_widevine_cenc_audio\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"widevine-cenc\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_widevine_cbcs_video\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"widevine-cbcs\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_widevine_cbcs_audio\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"widevine-cbcs\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_playready_cenc_video\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"playready-cenc\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_playready_cenc_audio\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"playready-cenc\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_playready_cbcs_video\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_video\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"playready-cbcs\"\u00a0 },\u00a0 {\u00a0 \u00a0 \"key\": \"fmp4_playready_cbcs_audio\",\u00a0 \u00a0 \"container\": \"fmp4\",\u00a0 \u00a0 \"elementaryStreams\": [\"es_audio\"],\u00a0 \u00a0 \"segmentSettings\": {\"segmentDuration\": \"2s\"},\u00a0 \u00a0 \"encryptionId\": \"playready-cbcs\"\u00a0 }],\"manifests\": [\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_fairplay.m3u8\",\u00a0 \u00a0 \"type\": \"HLS\",\u00a0 \u00a0 \"muxStreams\": [\"ts_fairplay\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_widevine_cenc.m3u8\",\u00a0 \u00a0 \"type\": \"HLS\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_widevine_cenc_video\", \"fmp4_widevine_cenc_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_widevine_cbcs.m3u8\",\u00a0 \u00a0 \"type\": \"HLS\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_widevine_cbcs_video\", \"fmp4_widevine_cbcs_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_widevine_cenc.mpd\",\u00a0 \u00a0 \"type\": \"DASH\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_widevine_cenc_video\", \"fmp4_widevine_cenc_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_widevine_cbcs.mpd\",\u00a0 \u00a0 \"type\": \"DASH\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_widevine_cbcs_video\", \"fmp4_widevine_cbcs_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_playready_cenc.m3u8\",\u00a0 \u00a0 \"type\": \"HLS\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_playready_cenc_video\", \"fmp4_playready_cenc_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_playready_cbcs.m3u8\",\u00a0 \u00a0 \"type\": \"HLS\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_playready_cbcs_video\", \"fmp4_playready_cbcs_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_playready_cenc.mpd\",\u00a0 \u00a0 \"type\": \"DASH\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_playready_cenc_video\", \"fmp4_playready_cenc_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 },\u00a0 {\u00a0 \u00a0 \"fileName\": \"manifest_playready_cbcs.mpd\",\u00a0 \u00a0 \"type\": \"DASH\",\u00a0 \u00a0 \"muxStreams\": [\"fmp4_playready_cbcs_video\", \"fmp4_playready_cbcs_audio\"],\u00a0 \u00a0 \"maxSegmentCount\": 10\u00a0 }]\n```\n\u77e5\u9053\u8981\u4f7f\u7528\u7684 JSON \u914d\u7f6e\u5f8c\uff0c\u8acb\u7167\u5e38 [\u5275\u5efa\u6e20\u9053](https://cloud.google.com/livestream/docs/how-to/create-channels?hl=zh-cn#create_channel) \u3002\n## \u958b\u59cb\u76f4\u64ad\n\u5275\u5efa\u983b\u9053\u5f8c\uff0c [\u5553\u52d5\u8a72\u983b\u9053](https://cloud.google.com/livestream/docs/how-to/create-channels?hl=zh-cn#start_channel) \u4e26 [\u767c\u9001\u8f38\u5165\u6d41](https://cloud.google.com/livestream/docs/quickstarts/quickstart-dash?hl=zh-cn#send_input_stream) \u3002\n\u983b\u9053\u5553\u52d5\u6642\uff0cLive Stream API \u6703\u5f9e Secret Manager \u4e2d\u63d0\u53d6 `secretVersion` \u6a19\u8b58\u7684\u52a0\u5bc6\u5bc6\u9470\u3002\u5982\u679c Live Stream API \u7121\u6cd5\u63d0\u53d6\u5bc6\u9470\uff0c\u6216\u8005\u5bc6\u9470\u7684\u683c\u5f0f\u7121\u6cd5\u8b58\u5225\uff0c\u5247\u983b\u9053\u72c0\u614b\u6703\u8b8a\u7232 `STREAMING_ERROR` \u3002\u5982\u679c\u6210\u529f\u63d0\u53d6\u4e86\u5bc6\u9470\uff0c\u5247\u6e20\u9053\u7684\u72c0\u614b\u6703\u7167\u5e38\u8b8a\u7232 `AWAITING_INPUT` \u3002\n\u76f4\u64ad\u958b\u59cb\u5f8c\uff0cLive Stream API \u6703\u6839\u64da\u5275\u5efa\u6642\u63d0\u4f9b\u7684\u914d\u7f6e\u958b\u59cb\u52a0\u5bc6\u8f38\u51fa\u5167\u5bb9\u3002\n## \u76e3\u63a7\u8f38\u51fa\n\u52a0\u5bc6\u8f38\u51fa\u6d41\u5305\u542b\u7d93\u904e\u4fee\u6539\u7684\u6e05\u55ae\uff0c\u5176\u4e2d\u5305\u542b\u89e3\u5bc6\u64ad\u653e\u5167\u5bb9\u6240\u9700\u7684\u4fe1\u606f\u3002\n### \u6e05\u55ae\u793a\u4f8b\n\u4ee5\u4e0b\u6e05\u55ae\u986f\u793a\u77ad\u89e3\u5bc6\u95dc\u806f\u5167\u5bb9\u6240\u9700\u7684\u4fe1\u606f\u3002\n```\n#EXTM3U#EXT-X-VERSION:7#EXT-X-TARGETDURATION:4#EXT-X-MEDIA-SEQUENCE:0#EXT-X-DISCONTINUITY-SEQUENCE:0#EXT-X-KEY:METHOD=AES-128,URI=\"https://example.com/keys/3d9dccb479c64adbb6e514790caa7822.bin\",IV=0x8d80aa741e7b32c2f1967daca83e81f3#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:22.870Z#EXTINF:2.576778segment-0000000000.ts#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:25.447Z#EXTINF:2.000000segment-0000000001.ts#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:27.447Z#EXTINF:2.000000segment-0000000002.ts#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:29.447Z#EXTINF:2.000000segment-0000000003.ts\n```\n```\n#EXTM3U#EXT-X-VERSION:7#EXT-X-TARGETDURATION:4#EXT-X-MEDIA-SEQUENCE:0#EXT-X-DISCONTINUITY-SEQUENCE:0#EXT-X-KEY:METHOD=SAMPLE-AES,URI=\"skd://d569cb35bd0548c7a99d92feb381df13\",KEYFORMAT=\"com.apple.streamingkeydelivery\",KEYFORMATVERSIONS=\"1\"#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:22.870Z#EXTINF:2.576778segment-0000000000.ts#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:25.447Z#EXTINF:2.000000segment-0000000001.ts#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:27.447Z#EXTINF:2.000000segment-0000000002.ts#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:29.447Z#EXTINF:2.000000segment-0000000003.ts\n```\n```\n#EXTM3U#EXT-X-VERSION:7#EXT-X-TARGETDURATION:4#EXT-X-MEDIA-SEQUENCE:0#EXT-X-DISCONTINUITY-SEQUENCE:0#EXT-X-KEY:METHOD=SAMPLE-AES-CTR,URI=\"data:text/plain;base64,AAAAOHBzc2gAAAAA7e+LqXnWSs6jyCfSEAB3Gcrj/8kFtioyiVbJMh9I49yVmwY=\",KEYFORMAT=\"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed\",KEYFORMATVERSIONS=\"1\"#EXT-X-MAP:URI=\"segment-initialization_segment_0000000000.m4s\"#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:22.870Z#EXTINF:2.576778segment-0000000000.m4s#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:25.447Z#EXTINF:2.000000segment-0000000001.m4s#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:27.447Z#EXTINF:2.000000segment-0000000002.m4s#EXT-X-PROGRAM-DATE-TIME:2022-10-12T20:08:29.447Z#EXTINF:2.000000segment-0000000003.m4s\n```\n```\n<AdaptationSet segmentAlignment=\"true\" maxWidth=\"800\" maxHeight=\"600\">\u00a0 <Representation mimeType=\"video/mp4\" id=\"fmp4_widevine_cenc_video\" codecs=\"avc1.4d001f\">\u00a0 \u00a0 <ContentProtection value=\"cenc\" schemeIdUri=\"urn:mpeg:dash:mp4protection:2011\" cenc:default_KID=\"44ec248b-048c-43a6-a6ee-58a752c6f9f8\"/>\u00a0 \u00a0 <ContentProtection schemeIdUri=\"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed\" value=\"Widevine\">\u00a0 \u00a0 \u00a0 <cenc:pssh>AAAAOHBzc2gAAAAA7e+LqXnWSs6jCfc1R0h7QAAABgSEAB3Gcrj/8kFklokiVbJMh9VmwY=</cenc:pssh>\u00a0 \u00a0 </ContentProtection>\u00a0 </Representation></AdaptationSet><AdaptationSet segmentAlignment=\"true\" mimeType=\"audio/mp4\" id=\"1\" label=\"fmp4_widevine_cenc_audio\">\u00a0 <Representation id=\"fmp4_widevine_cenc_audio\" codecs=\"mp4a.40.2\">\u00a0 \u00a0 <ContentProtection value=\"cenc\" schemeIdUri=\"urn:mpeg:dash:mp4protection:2011\" cenc:default_KID=\"44ec248b-048c-43a6-a6ee-58a752c6f9f8\"/>\u00a0 \u00a0 <ContentProtection schemeIdUri=\"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed\" value=\"Widevine\">\u00a0 \u00a0 \u00a0 <cenc:pssh>AAAAOHBzc2gAAAAA7e+LqXnWSs6jCfc1R0h7QAAABgSEAB3Gcrj/8kFklokiVbJMh9VmwY=</cenc:pssh>\u00a0 \u00a0 </ContentProtection>\u00a0 </Representation></AdaptationSet>\n```\n### \u63a8\u85a6\u7684\u7403\u54e1\n\u5efa\u8b70\u4f7f\u7528\u57fa\u65bc [HLS.js](https://github.com/video-dev/hls.js) \u7684\u64ad\u653e\u5668\u9032\u884c HLS/TS \u89e3\u5bc6\u3002\u5efa\u8b70\u4f7f\u7528\u57fa\u65bc [Shaka Player](https://github.com/shaka-project/shaka-player) \u7684\u64ad\u653e\u5668\u9032\u884c DASH/fMP4 \u89e3\u5bc6\u3002\nPlayReady\u201ccenc\u201d\u65b9\u6848\u9069\u7528\u65bc\u904b\u884c Windows 10\u3001Microsoft Edge \u700f\u89bd\u5668\u3001Xbox One\uff081703 \u6216\u66f4\u4f4e\u7248\u672c\uff09\u7684\u5be6\u9ad4\u8a08\u7b97\u6a5f\uff0c\u4ee5\u53ca\u4e00\u4e9b\u975e Windows \u8a2d\u5099\uff08\u4f8b\u5982\u667a\u80fd\u96fb\u8996\uff09\u3002\u53ea\u6709 Xbox One \u7248\u672c 1709 \u6216\u66f4\u9ad8\u7248\u672c\u652f\u6301 PlayReady\u201ccbcs\u201d\u65b9\u6848\u3002\u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [PlayReady \u5167\u5bb9\u52a0\u5bc6\u6a21\u5f0f](https://learn.microsoft.com/en-us/playready/packaging/content-encryption-modes) \u3002\n## \u66f4\u65b0\u52a0\u5bc6\u5bc6\u9470\n\u5982\u9700\u7232\u6e20\u9053\u6539\u7528\u65b0\u7684\u52a0\u5bc6\u5bc6\u9470\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n- [\u505c\u6b62\u983b\u9053](https://cloud.google.com/livestream/docs/how-to/create-channels?hl=zh-cn#stop_channel) \u3002\n- [\u66f4\u65b0\u901a\u9053\u7684\u52a0\u5bc6\u8a2d\u7f6e](#configure-channel) \u3002\n- [\u5553\u52d5\u6e20\u9053](https://cloud.google.com/livestream/docs/how-to/create-channels?hl=zh-cn#start_channel) \u3002", "guide": "Live Stream API"}