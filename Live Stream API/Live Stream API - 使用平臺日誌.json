{"title": "Live Stream API - \u4f7f\u7528\u5e73\u81fa\u65e5\u8a8c", "url": "https://cloud.google.com/livestream/docs/how-to/logging?hl=zh-cn", "abstract": "# Live Stream API - \u4f7f\u7528\u5e73\u81fa\u65e5\u8a8c\n\u672c\u9801\u9762\u4ecb\u7d39\u5982\u4f55\u5c07 Live Stream API \u751f\u6210\u7684\u5e73\u81fa\u65e5\u8a8c\u7528\u4f5c [Cloud Logging](https://cloud.google.com/logging/docs?hl=zh-cn) \u7684\u4e00\u90e8\u5206\u3002Live Stream API \u4f7f\u7528 Logging API \u670d\u52d9\u540d\u7a31 [livestream.googleapis.com](https://cloud.google.com/logging/docs/api/platform-logs?hl=zh-cn#live_stream_api) \u4f86\u8a18\u9304\u8207\u983b\u9053\u76f8\u95dc\u7684\u6d3b\u52d5\u3002\n", "content": "## \u6e96\u5099\u5de5\u4f5c\n- \u78ba\u4fdd\u60a8\u64c1\u6709\u67e5\u770b\u548c\u7ba1\u7406\u65e5\u8a8c\u6240\u9700\u7684 [IAM \u6b0a\u9650\u548c\u89d2\u8272](https://cloud.google.com/logging/docs/access-control?hl=zh-cn#permissions_and_roles) \u3002## \u5553\u7528\u5e73\u81fa\u65e5\u8a8c\u8a18\u9304\n\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\uff0cLive Stream API \u7684 `livestream.googleapis.com/channel_activities` \u5e73\u81fa\u65e5\u8a8c\u8655\u65bc\u505c\u7528\u72c0\u614b\u3002\u5982\u9700\u6fc0\u6d3b\u9019\u4e9b\u65e5\u8a8c\uff0c\u60a8\u9700\u8981\u5728\u5275\u5efa\u6216\u66f4\u65b0\u6e20\u9053\u8cc7\u6e90\u6642\u6307\u5b9a\u56b4\u91cd\u7d1a\u5225\u3002\n**\u8b66\u544a** \uff1a\u4f7f\u7528 Cloud Logging [\u6703\u5c0d\u9805\u76ee\u7522\u751f\u8cbb\u7528](https://cloud.google.com/stackdriver/pricing?hl=zh-cn) \u3002\u8acb\u50c5\u5728\u5fc5\u8981\u6642\u5553\u7528\u5e73\u81fa\u65e5\u8a8c\uff0c\u4ee5\u4fbf\u8abf\u8a66\u548c\u6392\u67e5\u554f\u984c\uff1b\u5728\u4e0d\u518d\u9700\u8981\u5e73\u81fa\u65e5\u8a8c\u6642\u5c07\u5176\u505c\u7528\u3002\n\u5982\u9700\u6fc0\u6d3b\u65e5\u8a8c\uff0c\u8acb\u5c07\u4ee5\u4e0b\u5b57\u6bb5\u6dfb\u52a0\u5230 [projects.locations.channels.create](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels/create?hl=zh-cn) \u6216 [projects.locations.channels.patch](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels/patch?hl=zh-cn) \u65b9\u6cd5\u7684\u8acb\u6c42 JSON \u6b63\u6587\u4e2d\uff1a\n```\n \"logConfig\": {\n  \"logSeverity\": \"SEVERITY_LEVEL\"\n },\n \n```\n\u5176\u4e2d `` \u662f\u4ee5\u4e0b\u503c\u4e4b\u4e00\uff1a\n- `OFF`\n- `DEBUG`\n- `INFO`\n- `WARNING`\n- `ERROR`\n\u7232\u6e20\u9053\u9078\u64c7\u65e5\u8a8c\u56b4\u91cd\u7d1a\u5225\u5f8c\uff0c\u53ea\u6709\u56b4\u91cd\u7d1a\u5225\u4e0d\u4f4e\u65bc\u6240\u9078\u56b4\u91cd\u7d1a\u5225\u7684\u5e73\u81fa\u65e5\u8a8c\u7e94\u6703\u88ab\u8a18\u9304\u3002\u4f8b\u5982\uff0c\u5982\u679c\u56b4\u91cd\u7d1a\u5225\u7232 `WARNING` \uff0c\u5247\u50c5\u8a18\u9304\u56b4\u91cd\u7d1a\u5225\u7232 `WARNING` \u548c `ERROR` \u7684\u65e5\u8a8c\u3002\u5982\u679c\u56b4\u91cd\u7d1a\u5225\u7232 `INFO` \uff0c\u7cfb\u7d71\u6703\u8a18\u9304\u9664 `DEBUG` \u4ee5\u5916\u7684\u6240\u6709\u56b4\u91cd\u7d1a\u5225\u7684\u65e5\u8a8c\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u65e5\u8a8c\u56b4\u91cd\u7d1a\u5225\uff0c\u8acb\u53c3\u95b1 [LogSeverity](https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry?hl=zh-cn#logseverity) \u3002\n## \u67e5\u770b\u5e73\u81fa\u65e5\u8a8c\n\u5982\u9700\u67e5\u770b\u5e73\u81fa\u65e5\u8a8c\uff0c\u8acb\u6309\u7167\u4ee5\u4e0b\u8aaa\u660e\u64cd\u4f5c\uff1a\n\u5982\u9700\u5728 Google Cloud \u63a7\u5236\u6aaf\u4e2d\u67e5\u770b\u5e73\u81fa\u65e5\u8a8c\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a- \u5c0e\u822a\u5230\u65e5\u8a8c\u700f\u89bd\u5668\uff1a [\u524d\u5f80\u65e5\u8a8c\u700f\u89bd\u5668](https://console.cloud.google.com/logs/query?hl=zh-cn) \n- \u9078\u64c7\u76f8\u61c9\u7684 Google Cloud \u9805\u76ee\u3002\n- \u5728 **\u67e5\u8a62** \u5b57\u6bb5\u4e2d\uff0c\u8f38\u5165\u4ee5\u4e0b\u67e5\u8a62\u547d\u4ee4\uff1a```\nresource.labels.channel_id=CHANNEL_ID\nresource.labels.location=LOCATION\nlogName=\"projects/PROJECT_ID/logs/livestream.googleapis.com%2Fchannel_activities\"\n```\u5176\u4e2d\uff1a- `` \u662f\u60a8\u8981\u8abf\u8a66\u6216\u76e3\u63a7\u7684\u6e20\u9053\u7684 ID\u3002\u4f8b\u5982 `my-channel` \u3002\n- `` \u662f\u60a8\u8981\u8abf\u8a66\u6216\u76e3\u63a7\u7684\u983b\u9053\u7684\u4f4d\u7f6e\u3002\u4f8b\u5982 `us-central1` \u3002\n- `` \u662f\u5305\u542b\u8981\u8abf\u8a66\u6216\u76e3\u63a7\u7684\u6e20\u9053\u7684\u9805\u76ee\u7684 ID\u3002\u4f8b\u5982 `my-project` \u3002\n- \u9ede\u64ca **\u904b\u884c\u67e5\u8a62** \u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u65e5\u8a8c\u700f\u89bd\u5668\uff0c\u8acb\u53c3\u95b1 [\u65e5\u8a8c\u700f\u89bd\u5668\u6982\u89bd](https://cloud.google.com/logging/docs/view/logs-explorer-summary?hl=zh-cn) \u548c [\u4f7f\u7528\u65e5\u8a8c\u700f\u89bd\u5668](https://cloud.google.com/logging/docs/view/logs-explorer-interface?hl=zh-cn) \u3002\ngcloud \u547d\u4ee4\u884c\u5de5\u5177\u63d0\u4f9b\u4e86\u7528\u65bc Cloud Logging \u7684\u547d\u4ee4\u884c\u754c\u9762\u3002\n\u5982\u9700\u67e5\u770b\u9805\u76ee\u7684 `channel_activities` \u65e5\u8a8c\uff0c\u8acb\u904b\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\n```\ngcloud logging read \"logName:projects/PROJECT_ID/logs/livestream.googleapis.com%2Fchannel_activities\" --project=PROJECT_ID\n```\n\u5176\u4e2d `` \u662f\u60a8\u7684 Google Cloud \u9805\u76ee\u7684 ID\u3002\n\u5982\u9700\u8a73\u7d30\u77ad\u89e3\u5982\u4f55\u5c07 gcloud \u5de5\u5177\u8207 Cloud Logging \u642d\u914d\u4f7f\u7528\uff0c\u8acb\u53c3\u95b1 [gcloud logging](https://cloud.google.com/sdk/gcloud/reference/logging?hl=zh-cn) \u3002\n## \u4f7f\u7528\u5e73\u81fa\u65e5\u8a8c\n\u672c\u90e8\u5206\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528\u548c\u89e3\u8b80 Live Stream API \u7684\u7279\u5b9a\u5e73\u81fa\u65e5\u8a8c\u3002\n### StreamingStateChange\n\u7576\u983b\u9053\u7684\u6d41\u5f0f\u50b3\u8f38\u72c0\u614b\u767c\u751f\u66f4\u6539\u6642\uff0c\u7cfb\u7d71\u6703\u751f\u6210 `StreamingStateChange` \u65e5\u8a8c\u3002\u7576\u6e20\u9053\u7684\u65b0\u72c0\u614b\u7232 `STREAMING_ERROR` \u6642\uff0c `StreamingStateChange` \u65e5\u8a8c\u7684\u56b4\u91cd\u7d1a\u5225\u7232 `ERROR` \u3002\u5426\u5247\uff0c `StreamingStateChange` \u65e5\u8a8c\u7684\u56b4\u91cd\u7d1a\u5225\u7232 `INFO` \u3002\n\u4ee5\u4e0b\u662f `StreamingStateChange` \u65e5\u8a8c\u7684\u793a\u4f8b\uff0c\u5176\u4e2d\u5148\u524d\u72c0\u614b\u7232 `STREAMING_ERROR` \uff0c\u65b0\u72c0\u614b\u7232 `STREAMING` \uff1a\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n message: \"streaming state of channel \"CHANNEL_ID\" changes from \"STREAMING_ERROR\" to \"STREAMING\"\"\n streamingStateChange: {\n  newState: \"STREAMING\"\n  previousState: \"STREAMING_ERROR\"\n  ...\n type: \"livestream.googleapis.com/Channel\"\n }\n severity: \"INFO\"\n ...\n}\n```\n\u60a8\u53ef\u4ee5\u5728\u65e5\u8a8c\u700f\u89bd\u5668 **\u67e5\u8a62** \u5b57\u6bb5\u4e2d\u6dfb\u52a0\u5176\u4ed6\u547d\u4ee4\uff0c\u4ee5\u7e2e\u5c0f\u986f\u793a\u7684\u65e5\u8a8c\u7bc4\u570d\u3002\n\u6dfb\u52a0\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4ee5\u986f\u793a\u65b0\u72c0\u614b\u7232 `STREAMING` \u7684\u6240\u6709 `StreamingStateChange` \u65e5\u8a8c\uff1a\n```\njsonPayload.streamingStateChange.newState=\"STREAMING\"\n```\n\u6dfb\u52a0\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4ee5\u4fbf\u50c5\u986f\u793a `StreamingStateChange` \u65e5\u8a8c\uff1a\n```\njsonPayload.streamingStateChange.newState:*\n```\n### StreamingError\n\u7576\u983b\u9053\u9047\u5230\u8207\u5728\u7dda\u64ad\u653e\u76f8\u95dc\u7684\u932f\u8aa4\u6642\uff0c\u7cfb\u7d71\u6703\u751f\u6210 `StreamingError` \u65e5\u8a8c\u3002 `StreamingError` \u65e5\u8a8c\u7684\u65e5\u8a8c\u56b4\u91cd\u7d1a\u5225\u7232 [ERROR](https://cloud.google.com/apis/design/errors?hl=zh-cn) \u3002\n\u4ee5\u4e0b\u662f\u4e00\u500b `StreamingError` \u65e5\u8a8c\u793a\u4f8b\uff0c\u5176\u4e2d Live Stream API \u88ab\u62d2\u7d55\u4e86\u5c07\u8f38\u51fa\u6587\u4ef6\u4e0a\u50b3\u5230\u6307\u5b9a Cloud Storage \u5b58\u5132\u6876\u7684\u6b0a\u9650\uff1a\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n message: \"A live streaming encounters an error.\"\n streamingError: {\n  error: {\n  ...\n  message: \"Permission denied to access the GCS bucket \"STORAGE_BUCKET_NAME\"\"\n ...\n severity: \"ERROR\"\n ...\n}\n```\n\u5982\u679c\u6307\u5b9a\u7684 Cloud Storage \u5b58\u5132\u6876\u4e0d\u5b58\u5728\uff0c\u4e5f\u53ef\u80fd\u6703\u767c\u751f\u6b64\u932f\u8aa4\u3002\n\u5982\u679c `streamingError.message` \u986f\u793a `This is due to an internal error. If the error persists, please contact support team` \u6d88\u606f\uff0c\u8acb\u8907\u88fd\u65e5\u8a8c\u7684\u5167\u5bb9\u4e26\u5c07\u5176\u767c\u9001\u7d66 [\u652f\u6301\u5718\u968a](https://cloud.google.com/support-hub?hl=zh-cn) \u9032\u884c\u554f\u984c\u6392\u67e5\u3002\n### InputAccept\n\u8f38\u5165\u6d41\u6210\u529f\u9023\u63a5\u5230 Live Stream API \u8f38\u5165\u7aef\u9ede\u6642\uff0c\u7cfb\u7d71\u6703\u751f\u6210 `InputAccept` \u65e5\u8a8c\u3002 `InputAccept` \u65e5\u8a8c\u7684\u56b4\u91cd\u7d1a\u5225\u7232 `INFO` \u3002\n`InputAccept` \u65e5\u8a8c\u4e2d\u7684 `InputStreamProperty` \u5b57\u6bb5\u5305\u542b\u6709\u95dc\u8f38\u5165\u6d41\u7684\u8996\u983b\u548c\u97f3\u983b\u5b50\u6d41\u7684\u4ee5\u4e0b\u4fe1\u606f\uff1a\n| 0  | 1         |\n|:-------|:-----------------------------------|\n| \u8996\u983b\u6d41 | index \u7de8\u89e3\u78bc\u5668 \u5e40\u901f\u7387 \u5206\u8fa8\u7387  |\n| \u97f3\u983b\u6d41 | index \u983b\u9053\u6578 \u983b\u9053\u4f48\u5c40 \u7de8\u89e3\u78bc\u5668\u4fe1\u606f |\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `InputAccept` \u65e5\u8a8c\u4f86\u9a57\u8b49\u8f38\u5165\u6d41\u7684\u683c\u5f0f\u548c\u63a5\u53d7\u72c0\u614b\uff1a\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n inputAccept: {\n  inputAttachment: \"input-primary\"\n  inputStreamProperty: {\n  audioStreams: [   0: {\n   audioFormat: {\n    channelCount: 2\n    channelLayout: [    0: \"fl\"\n    1: \"fr\"\n    ]\n    codec: \"aac\"\n   }\n   index: 1\n   }\n  ]\n  videoStreams: [   0: {\n   videoFormat: {\n    codec: \"h264\"\n    frameRate: 60\n    heightPixels: 720\n    widthPixels: 1280\n  ...\n  streamId: \"STREAM_ID\"\n }\n message: \"Input stream \"STREAM_ID\" is accepted by channel \"CHANNEL_ID\" for input attachment \"input-primary\"\"\n }\n ...\n severity: \"INFO\"\n ...\n}\n```\n\u5728\u65e5\u8a8c\u700f\u89bd\u5668 **\u67e5\u8a62** \u5b57\u6bb5\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4ee5\u50c5\u986f\u793a\u7279\u5b9a\u6578\u64da\u6d41\u7684 `InputAccept` \u65e5\u8a8c\uff1a\n```\njsonPayload.inputAccept.streamId=\"STREAM_ID\"\n```\n\u5176\u4e2d\uff0c \u662f [\u8f38\u5165\u7aef\u9ede URI](https://cloud.google.com/livestream/docs/overview?hl=zh-cn#input_endpoints) \u4e2d\u5305\u542b\u7684\u6578\u64da\u6d41\u7684\u552f\u4e00\u6a19\u8b58\u7b26\u3002\n### InputError\n\u7576 Live Stream API \u62d2\u7d55\u8f38\u5165\u6d41\u6642\uff0c\u7cfb\u7d71\u6703\u751f\u6210 `InputError` \u65e5\u8a8c\u3002 `InputError` \u65e5\u8a8c\u7684\u56b4\u91cd\u7d1a\u5225\u7232 [ERROR](https://cloud.google.com/apis/design/errors?hl=zh-cn) \u3002\n\u4ee5\u4e0b\u662f `InputError` \u65e5\u8a8c\u7684\u793a\u4f8b\uff0c\u5176\u4e2d\u8f38\u5165\u6d41\u5df2\u767c\u9001\u5230\u5c1a\u672a\u5553\u52d5\u7684\u901a\u9053\uff1a\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n inputError: {\n  error: {\n  ...\n  message: \"The channel has not been started yet\"\n  }\n  streamId: \"STREAM_ID\"\n ...\n severity: \"ERROR\"\n ...\n}\n```\n\u4ee5\u4e0b\u662f `InputError` \u65e5\u8a8c\u793a\u4f8b\uff0c\u5176\u4e2d\u91cd\u8907\u7684\u8f38\u5165\u6d41\u767c\u9001\u5230\u4e86\u6b63\u5728\u6d41\u5f0f\u50b3\u8f38\u7684\u983b\u9053\uff1a\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n inputError: {\n  error: {\n  code: 9\n  message: \"input stream \"STREAM_ID\" has been accepted. Please verify if another input stream has been streaming to the same endpoint.\"\n  }\n  streamId: \"STREAM_ID\"\n ...\n severity: \"ERROR\"\n ...\n}\n```\n\u5728\u65e5\u8a8c\u700f\u89bd\u5668 **\u67e5\u8a62** \u5b57\u6bb5\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4ee5\u50c5\u986f\u793a\u7279\u5b9a\u6578\u64da\u6d41\u7684 `InputError` \u65e5\u8a8c\uff1a\n```\njsonPayload.inputError.streamId=\"STREAM_ID\"\n```\n\u5176\u4e2d\uff0c \u662f [\u8f38\u5165\u7aef\u9ede URI](https://cloud.google.com/livestream/docs/overview?hl=zh-cn#input_endpoints) \u4e2d\u5305\u542b\u7684\u6578\u64da\u6d41\u7684\u552f\u4e00\u6a19\u8b58\u7b26\u3002\n### InputDisconnect\n\u5982\u679c\u8f38\u5165\u6d41\u8207 Live Stream API \u65b7\u958b\u9023\u63a5\uff0c\u7cfb\u7d71\u6703\u751f\u6210 `InputDisconnect` \u65e5\u8a8c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 `InputDisconnect` \u65e5\u8a8c\u4f86\u6aa2\u67e5\u662f\u5426\u5b58\u5728\u610f\u5916\u7684\u76f4\u64ad\u9023\u63a5\u65b7\u958b\u3002 `InputDisconnect` \u65e5\u8a8c\u7684\u56b4\u91cd\u7d1a\u5225\u7232 `INFO` \u3002\n\u4ee5\u4e0b\u662f `InputDisconnect` \u65e5\u8a8c\u7684\u793a\u4f8b\uff1a\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n inputDisconnect: {\n  inputAttachment: \"input-primary\"\n  streamId: \"STREAM_ID\"\n }\n message: \"Input stream \"STREAM_ID\" is disconnected by channel \"CHANNEL_ID\" for input attachment \"input-primary\"\"\n ...\n severity: \"INFO\"\n ...\n}\n```", "guide": "Live Stream API"}