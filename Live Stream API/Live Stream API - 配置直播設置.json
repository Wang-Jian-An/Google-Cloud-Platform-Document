{"title": "Live Stream API - \u914d\u7f6e\u76f4\u64ad\u8a2d\u7f6e", "url": "https://cloud.google.com/livestream/docs/how-to/livestream-configurations?hl=zh-cn", "abstract": "# Live Stream API - \u914d\u7f6e\u76f4\u64ad\u8a2d\u7f6e\n\u672c\u9801\u4ecb\u7d39\u77ad\u5982\u4f55\u5728\u8f38\u5165\u7aef\u9ede\u6216\u983b\u9053\u5275\u5efa\u671f\u9593\u7232\u591a\u500b\u97f3\u8ecc\u3001\u5b57\u5e55\u548c\u7cbe\u9748\u8868\u7b49\u76f4\u64ad\u529f\u80fd\u914d\u7f6e\u8a2d\u7f6e\u3002\n", "content": "## \u901a\u904e\u5275\u5efa\u8f38\u5165\u7aef\u9ede\u9032\u884c\u914d\u7f6e\n\u60a8\u53ef\u4ee5\u5728 [\u5275\u5efa\u8f38\u5165\u7aef\u9ede](https://cloud.google.com/livestream/docs/how-to/create-input-endpoints?hl=zh-cn) \u671f\u9593\u7232\u4ee5\u4e0b\u529f\u80fd\u6307\u5b9a\u914d\u7f6e\uff1a\n### \u5236\u5b9a IP \u8a31\u53ef\u540d\u55ae\n\u60a8\u53ef\u4ee5\u6307\u5b9a\u8f38\u5165\u6d41\u61c9\u6e90\u81ea\u7684 IP \u7bc4\u570d\uff08\u4f8b\u5982\u7de8\u78bc\u5668\u7684 IP \u5730\u5740\uff09\uff0c\u5f9e\u800c\u9650\u5236\u5c0d\u8f38\u5165\u7aef\u9ede\u7684\u8a2a\u554f\u3002\u8996\u983b\u6d41\u6c34\u7dda\u50c5\u63a5\u53d7\u4f86\u81ea\u9019\u4e9b\u7bc4\u570d\u5167\u7684 IP \u5730\u5740\u7684\u6d41\u91cf\u3002IP \u7bc4\u570d\u5fc5\u9808\u63a1\u7528 CIDR \u5730\u5740\u584a\u683c\u5f0f\u3002\n\u5728 `Input` \u8cc7\u6e90\u4e2d\u914d\u7f6e [securityRules](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.inputs?hl=zh-cn#SecurityRule) \u5b57\u6bb5\uff1a\n```\n{\u00a0 \"type\": \"RTMP_PUSH\",\u00a0 \"securityRules\": {\u00a0 \u00a0 \"ipRanges\": [\"1.2.3.4/32\"]\u00a0 }}\n```\n## \u901a\u904e\u5275\u5efa\u6e20\u9053\u9032\u884c\u914d\u7f6e\n\u60a8\u53ef\u4ee5\u5728 [\u5275\u5efa\u983b\u9053](https://cloud.google.com/livestream/docs/how-to/create-channels?hl=zh-cn) \u671f\u9593\u7232\u4ee5\u4e0b\u529f\u80fd\u6307\u5b9a\u914d\u7f6e\uff1a\n### \u591a\u7a2e\u6bd4\u7279\u7387\u8996\u983b\u6d41\n\u60a8\u53ef\u4ee5\u5275\u5efa\u652f\u6301\u591a\u7a2e\u6bd4\u7279\u7387\u3001\u5206\u8fa8\u7387\u548c\u5e40\u901f\u7387\u7684\u9ad8\u7d1a\u8072\u9053\u914d\u7f6e\u3002\u4ee5\u4e0b\u914d\u7f6e\u5728\u8f38\u51fa\u4e2d\u5305\u542b\u5169\u500b `muxStream` \uff0c\u4e00\u500b\u662f 360p\uff0c\u5e40\u901f\u7387\u7232 30 FPS ( `mux_video_360p30` )\uff0c\u53e6\u4e00\u500b\u662f 720p\uff0c\u5e40\u901f\u7387\u7232 60 FPS ( `mux_video_720p60` )\u3002\u6b64\u914d\u7f6e\u9084\u652f\u6301\u591a\u7a2e\u97f3\u983b\u6bd4\u7279\u7387\u3002 \u5982\u9700\u77ad\u89e3\u8a73\u60c5\uff0c\u8acb\u53c3\u95b1 [\u5efa\u8b70\u7684\u6bd4\u7279\u7387](https://cloud.google.com/livestream/docs/best-practices?hl=zh-cn#recommended-bitrates) \u3002\n```\n{\u00a0 \"inputAttachments\":[\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\":\"input-primary\",\u00a0 \u00a0 \u00a0 \"input\": \"projects/PROJECT_NUMBER/locations/LOCATION/inputs/INPUT_ID\"\u00a0 \u00a0 }\u00a0 ],\u00a0 \"output\":{\u00a0 \u00a0 \"uri\": \"gs://BUCKET_NAME\"\u00a0 },\u00a0 \"elementaryStreams\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"es_video_720p60\",\u00a0 \u00a0 \u00a0 \"videoStream\": {\u00a0 \u00a0 \u00a0 \u00a0 \"h264\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"profile\": \"high\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"heightPixels\": 720,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"widthPixels\": 1280,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 5500000,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"frameRate\": 60\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"es_video_360p30\",\u00a0 \u00a0 \u00a0 \"videoStream\": {\u00a0 \u00a0 \u00a0 \u00a0 \"h264\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"profile\": \"high\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"heightPixels\": 360,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"widthPixels\": 640,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 400000,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"frameRate\": 30\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"es_audio_160k\",\u00a0 \u00a0 \u00a0 \"audioStream\": {\u00a0 \u00a0 \u00a0 \u00a0 \"codec\": \"aac\",\u00a0 \u00a0 \u00a0 \u00a0 \"channelCount\": 2,\u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 160000\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"es_audio_64k\",\u00a0 \u00a0 \u00a0 \"audioStream\": {\u00a0 \u00a0 \u00a0 \u00a0 \"codec\": \"aac\",\u00a0 \u00a0 \u00a0 \u00a0 \"channelCount\": 2,\u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 64000\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 ],\u00a0 \"muxStreams\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"mux_video_720p60\",\u00a0 \u00a0 \u00a0 \"elementaryStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \"es_video_720p60\"\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \"segmentSettings\": {\u00a0 \u00a0 \u00a0 \u00a0 \"segmentDuration\": \"2s\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"mux_video_360p30\",\u00a0 \u00a0 \u00a0 \"elementaryStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \"es_video_360p30\"\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \"segmentSettings\": {\u00a0 \u00a0 \u00a0 \u00a0 \"segmentDuration\": \"2s\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"mux_audio_160k\",\u00a0 \u00a0 \u00a0 \"elementaryStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \"es_audio_160k\"\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \"segmentSettings\": {\u00a0 \u00a0 \u00a0 \u00a0 \"segmentDuration\": \"2s\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"mux_audio_64k\",\u00a0 \u00a0 \u00a0 \"elementaryStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \"es_audio_64k\"\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \"segmentSettings\": {\u00a0 \u00a0 \u00a0 \u00a0 \"segmentDuration\": \"2s\"\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 ],\u00a0 \"manifests\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"fileName\": \"main.mpd\",\u00a0 \u00a0 \u00a0 \"type\": \"DASH\",\u00a0 \u00a0 \u00a0 \"muxStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \"mux_video_720p60\",\u00a0 \u00a0 \u00a0 \u00a0 \"mux_video_360p30\",\u00a0 \u00a0 \u00a0 \u00a0 \"mux_audio_160k\",\u00a0 \u00a0 \u00a0 \u00a0 \"mux_audio_64k\"\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \"maxSegmentCount\": 5\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"fileName\": \"main.m3u8\",\u00a0 \u00a0 \u00a0 \"type\": \"HLS\",\u00a0 \u00a0 \u00a0 \"muxStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \"mux_video_720p60\",\u00a0 \u00a0 \u00a0 \u00a0 \"mux_video_360p30\",\u00a0 \u00a0 \u00a0 \u00a0 \"mux_audio_160k\",\u00a0 \u00a0 \u00a0 \u00a0 \"mux_audio_64k\"\u00a0 \u00a0 \u00a0 ],\u00a0 \u00a0 \u00a0 \"maxSegmentCount\": 5\u00a0 \u00a0 }\u00a0 ]}\n```\n### \u591a\u500b\u97f3\u8ecc\n\u5982\u679c\u8f38\u5165\u6d41\u5305\u542b\u591a\u500b\u97f3\u8ecc\uff0c\u8acb\u4f7f\u7528 [AudioMapping](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels?hl=zh-cn#AudioMapping) \u5c0d\u8c61\u7232\u6bcf\u500b [AudioStream](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels?hl=zh-cn#audiostream) \u9078\u64c7\u97f3\u8ecc\u3002\n```\n{\u00a0 \"inputAttachments\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"MY-INPUT\",\u00a0 \u00a0 \u00a0 \"input\": \"/projects/PROJECT-ID/locations/LOCATION/inputs/MY-INPUT\",\u00a0 \u00a0 }\u00a0 ],\u00a0 \"output\": {\u00a0 \u00a0 \"uri\": \"gs://BUCKET_NAME/outputs/\"\u00a0 },\u00a0 \"elementaryStreams\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"es_video\",\u00a0 \u00a0 \u00a0 \"videoStream\": {\u00a0 \u00a0 \u00a0 \u00a0 \"h264\": {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"heightPixels\": 720,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"widthPixels\": 1280,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 3000000,\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"frameRate\": 30\u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"es_first_audio\",\u00a0 \u00a0 \u00a0 \"audioStream\": {\u00a0 \u00a0 \u00a0 \u00a0 \"codec\": \"aac\",\u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 160000,\u00a0 \u00a0 \u00a0 \u00a0 \"mapping\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"inputKey\": \"MY-INPUT\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"inputTrack\": 1\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"es_second_audio\",\u00a0 \u00a0 \u00a0 \"audioStream\": {\u00a0 \u00a0 \u00a0 \u00a0 \"codec\": \"aac\",\u00a0 \u00a0 \u00a0 \u00a0 \"bitrateBps\": 160000,\u00a0 \u00a0 \u00a0 \u00a0 \"mapping\": [\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"inputKey\": \"MY-INPUT\",\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"inputTrack\": 2\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 \u00a0 }\u00a0 \u00a0 }\u00a0 ],\u00a0 \"muxStreams\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"mux_video\",\u00a0 \u00a0 \u00a0 \"elementaryStreams\": [\"es_video\"],\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"mux_first_audio\",\u00a0 \u00a0 \u00a0 \"elementaryStreams\": [\"es_first_audio\"],\u00a0 \u00a0 },\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"key\": \"mux_second_audio\",\u00a0 \u00a0 \u00a0 \"elementaryStreams\": [\"es_second_audio\"],\u00a0 \u00a0 }\u00a0 ],\u00a0 \"manifests\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"type\": \"DASH\",\u00a0 \u00a0 \u00a0 \"muxStreams\": [\u00a0 \u00a0 \u00a0 \u00a0 \"mux_video\",\u00a0 \u00a0 \u00a0 \u00a0 \"mux_first_audio\",\u00a0 \u00a0 \u00a0 \u00a0 \"mux_second_audio\",\u00a0 \u00a0 \u00a0 ]\u00a0 \u00a0 }\u00a0 ]}\n```\n\u8acb\u6ce8\u610f\uff0c\u5c0d\u65bc\u5305\u542b\u591a\u500b\u97f3\u8ecc\u7684 HLS \u6d41\uff0c [Shaka \u64ad\u653e\u5668](https://shaka-player-demo.appspot.com/demo/?hl=zh-cn) \u4e0d\u652f\u6301\u4ee5\u4e0b\u529f\u80fd\uff1a\n- \u4f7f\u7528 TS \u7247\u6bb5\u66ff\u4ee3\u97f3\u8ecc\u64ad\u653e\u3002\n- \u4f7f\u7528 fMP4 \u7247\u6bb5\u9078\u64c7\u6b21\u8981\u548c\u5099\u7528\u97f3\u8ecc\u3002\n### \u76f4\u901a\u5f0f CEA 608/708 \u5b57\u5e55\n\u5982\u679c\u8f38\u5165\u6d41\u5305\u542b CEA 608/708 \u5b57\u5e55\uff0c\u60a8\u53ef\u4ee5\u5c07\u5b57\u5e55\u8f49\u767c\u5230\u8f38\u51fa\u6d41\u3002\u5275\u5efa `Channel` \u6642\uff0c\u8acb\u5c07\u4ee5\u4e0b [textStream](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels?hl=zh-cn#textstream) \u6dfb\u52a0\u5230 [elementaryStreams](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels?hl=zh-cn#elementarystream) \u3002\u6b64 `textStream` \u6703\u5728\u6240\u6709\u8f38\u51fa\u8996\u983b\u6d41\u548c\u5448\u73fe\u5167\u5bb9\u4e2d\u5d4c\u5165 CEA 608/708 \u5b57\u5e55\u3002\n```\n{\u00a0 \"key\": \"captions\",\u00a0 \"textStream\": {\u00a0 \u00a0 \"codec\": \"cea608\"\u00a0 }}\n```\n### \u7cbe\u9748\u8868\n\u5982\u9700\u751f\u6210\u7cbe\u9748\u8868\uff0c\u8acb\u914d\u7f6e `Channel` \u8cc7\u6e90\u4e2d\u7684 [spriteSheets](https://cloud.google.com/livestream/docs/reference/rest/v1/projects.locations.channels?hl=zh-cn#spritesheet) \u5b57\u6bb5\u3002\n```\n{\u00a0 \"spriteSheets\": [\u00a0 \u00a0 {\u00a0 \u00a0 \u00a0 \"format\": \"jpeg\",\u00a0 \u00a0 \u00a0 \"filePrefix\": \"sprite\",\u00a0 \u00a0 \u00a0 \"interval\": \"2s\",\u00a0 \u00a0 \u00a0 \"spriteWidthPixels\": 320,\u00a0 \u00a0 \u00a0 \"spriteHeightPixels\": 240,\u00a0 \u00a0 \u00a0 \"columnCount\": 3,\u00a0 \u00a0 \u00a0 \"rowCount\": 3,\u00a0 \u00a0 \u00a0 \"quality\": 80\u00a0 \u00a0 }\u00a0 ]}\n```", "guide": "Live Stream API"}