{"title": "Live Stream API - Using platform logs", "url": "https://cloud.google.com/livestream/docs/how-to/logging", "abstract": "# Live Stream API - Using platform logs\nThis page describes how to use platform logs generated by Live Stream API as part of [Cloud Logging](/logging/docs) . Live Stream API uses the Logging API service name [livestream.googleapis.com](/logging/docs/api/platform-logs#live_stream_api) to log channel-related activity.\n", "content": "## Before you begin\n- Make sure you have the correct [IAM permissions and roles](/logging/docs/access-control#permissions_and_roles) to view and manage logs.## Activate platform logging\nBy default, the `livestream.googleapis.com/channel_activities` platform logs for Live Stream API are deactivated. To activate the logs, you need to specify a severity level when creating or updating the channel resource.\n**Warning:** Using Cloud Logging [incurs charges to your project](/stackdriver/pricing) . Enable platform logs only when necessary to debug and troubleshoot issues, and disable platform logs when you no longer need them.\nTo activate the logs, add the following field to the request JSON body of the [projects.locations.channels.create](/livestream/docs/reference/rest/v1/projects.locations.channels/create) or the [projects.locations.channels.patch](/livestream/docs/reference/rest/v1/projects.locations.channels/patch) method:\n```\n \"logConfig\": {\n  \"logSeverity\": \"SEVERITY_LEVEL\"\n },\n \n```\nwhere `` is one of the following:\n- `OFF`\n- `DEBUG`\n- `INFO`\n- `WARNING`\n- `ERROR`\nOnce you choose a log severity level for a channel, only the platform logs with a severity level higher than or equal to the chosen severity level are logged. For example, if the severity level is `WARNING` , only logs with severity level `WARNING` and `ERROR` are logged. If the severity level is `INFO` , logs of all severity levels except for `DEBUG` are logged.\nFor more information about log severity levels, see [LogSeverity](/logging/docs/reference/v2/rest/v2/LogEntry#logseverity) .\n## View platform logs\nTo view platform logs, follow the instructions below:\nTo view platform logs in the Google Cloud console:- Navigate to the Logs Explorer: [Go to the Logs Explorer](https://console.cloud.google.com/logs/query) \n- Select the appropriate Google Cloud project.\n- In the **Query** field, enter the following query command:```\nresource.labels.channel_id=CHANNEL_ID\nresource.labels.location=LOCATION\nlogName=\"projects/PROJECT_ID/logs/livestream.googleapis.com%2Fchannel_activities\"\n```where:- `` is the ID of the channel you want to debug or monitor. For example, `my-channel` .\n- `` is the location of the channel you want to debug or monitor. For example, `us-central1` .\n- `` is the ID of the project containing the channel you want to debug or monitor. For example, `my-project` .\n- Click **Run query** .\nFor more information about the Logs Explorer, see [Logs Explorer Overview](/logging/docs/view/logs-explorer-summary) and [Using the Logs Explorer](/logging/docs/view/logs-explorer-interface) .\nThe gcloud command-line tool provides a command-line interface to Cloud Logging.\nTo view the `channel_activities` logs for your project, run the following command:\n```\ngcloud logging read \"logName:projects/PROJECT_ID/logs/livestream.googleapis.com%2Fchannel_activities\" --project=PROJECT_ID\n```\nwhere `` is the ID for your Google Cloud project.\nFor more information about using the gcloud tool with Cloud Logging, see [gcloud logging](/sdk/gcloud/reference/logging) .\n## Use platform logs\nThis section describes how to use and interpret specific platform logs for Live Stream API.\n### StreamingStateChange\n`StreamingStateChange` logs are generated when a channel's streaming state changes. The severity level of a `StreamingStateChange` log is `ERROR` when the channel's new state is `STREAMING_ERROR` . Otherwise, the severity level of a `StreamingStateChange` log is `INFO` .\nThe following is an example of a `StreamingStateChange` log where the previous state is `STREAMING_ERROR` and the new state is `STREAMING` :\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n message: \"streaming state of channel \"CHANNEL_ID\" changes from \"STREAMING_ERROR\" to \"STREAMING\"\"\n streamingStateChange: {\n  newState: \"STREAMING\"\n  previousState: \"STREAMING_ERROR\"\n  ...\n type: \"livestream.googleapis.com/Channel\"\n }\n severity: \"INFO\"\n ...\n}\n```\nYou can add additional commands in the Logs Explorer **Query** field to narrow down the displayed logs.\nAdd the following command to display all `StreamingStateChange` logs where the new state is `STREAMING` :\n```\njsonPayload.streamingStateChange.newState=\"STREAMING\"\n```\nAdd the following command to display only `StreamingStateChange` logs:\n```\njsonPayload.streamingStateChange.newState:*\n```\n### StreamingError\n`StreamingError` logs are generated when a channel encounters a streaming-related error. The log severity level of a `StreamingError` log is [ERROR](/apis/design/errors) .\nThe following is an example of a `StreamingError` log where Live Stream API was denied permission to upload output files to the specified Cloud Storage bucket:\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n message: \"A live streaming encounters an error.\"\n streamingError: {\n  error: {\n  ...\n  message: \"Permission denied to access the GCS bucket \"STORAGE_BUCKET_NAME\"\"\n ...\n severity: \"ERROR\"\n ...\n}\n```\nThis error may also occur if the specified Cloud Storage bucket does not exist.\nIf `streamingError.message` displays the message `This is due to an internal error. If the error persists, please contact support team` , copy the log's contents and send it to the [support team](/support-hub) for troubleshooting.\n### InputAccept\n`InputAccept` logs are generated when an input stream is successfully connected to the Live Stream API input endpoint. The severity level of `InputAccept` logs is `INFO` .\nThe `InputStreamProperty` field in an `InputAccept` log includes the following information about the video and audio sub-streams of the input stream:\n| 0    | 1             |\n|:--------------|:-----------------------------------------------------|\n| Video streams | index codec frame rate resolution     |\n| Audio streams | index channel count channel layout codec information |\nYou can use `InputAccept` logs to verify the format and acceptance status of the input stream:\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n inputAccept: {\n  inputAttachment: \"input-primary\"\n  inputStreamProperty: {\n  audioStreams: [   0: {\n   audioFormat: {\n    channelCount: 2\n    channelLayout: [    0: \"fl\"\n    1: \"fr\"\n    ]\n    codec: \"aac\"\n   }\n   index: 1\n   }\n  ]\n  videoStreams: [   0: {\n   videoFormat: {\n    codec: \"h264\"\n    frameRate: 60\n    heightPixels: 720\n    widthPixels: 1280\n  ...\n  streamId: \"STREAM_ID\"\n }\n message: \"Input stream \"STREAM_ID\" is accepted by channel \"CHANNEL_ID\" for input attachment \"input-primary\"\"\n }\n ...\n severity: \"INFO\"\n ...\n}\n```\nAdd the following command in the Logs Explorer **Query** field to display only `InputAccept` logs for a specific stream:\n```\njsonPayload.inputAccept.streamId=\"STREAM_ID\"\n```\nwhere is the unique identifier for a stream included in the [inputendpoint URI](/livestream/docs/overview#input_endpoints) .\n### InputError\n`InputError` logs are generated when an input stream is rejected by the Live Stream API. The severity level for an `InputError` log is [ERROR](/apis/design/errors) .\nThe following is an example of a `InputError` log where an input stream was sent to a channel that has not started yet:\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n inputError: {\n  error: {\n  ...\n  message: \"The channel has not been started yet\"\n  }\n  streamId: \"STREAM_ID\"\n ...\n severity: \"ERROR\"\n ...\n}\n```\nThe following is an example of a `InputError` log where a duplicate input stream was sent to a channel that is already streaming:\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n inputError: {\n  error: {\n  code: 9\n  message: \"input stream \"STREAM_ID\" has been accepted. Please verify if another input stream has been streaming to the same endpoint.\"\n  }\n  streamId: \"STREAM_ID\"\n ...\n severity: \"ERROR\"\n ...\n}\n```\nAdd the following command in the Logs Explorer **Query** field to display only `InputError` logs for a specific stream:\n```\njsonPayload.inputError.streamId=\"STREAM_ID\"\n```\nwhere is the unique identifier for a stream included in the [inputendpoint URI](/livestream/docs/overview#input_endpoints) .\n### InputDisconnect\n`InputDisconnect` logs are generated when the input streams are disconnected from the Live Stream API. You can use `InputDisconnect` logs to check for unexpected live stream disconnections. The severity level for an `InputDisconnect` log is `INFO` .\nThe following is an example of an `InputDisconnect` log:\n```\n{\n jsonPayload: {\n @type: \"type.googleapis.com/google.cloud.video.livestream.logging.v1.ChannelActivity\"\n inputDisconnect: {\n  inputAttachment: \"input-primary\"\n  streamId: \"STREAM_ID\"\n }\n message: \"Input stream \"STREAM_ID\" is disconnected by channel \"CHANNEL_ID\" for input attachment \"input-primary\"\"\n ...\n severity: \"INFO\"\n ...\n}\n```", "guide": "Live Stream API"}