{"title": "Apigee - Configure ports and set up firewalls", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - Configure ports and set up firewalls\nYou are currently viewing version 1.1 of the Apigee hybrid documentation. **This version is end of life.** You should upgrade to a newer version. For more information, see [Supported versions](/apigee/docs/hybrid/supported-platforms#supported-versions) .\nUnderstanding which ports the hybrid runtime plane uses is important for enterprise implementations. This section describes the ports used for secure communications within the runtime plane as well as external ports used for communications with external services.\n", "content": "## Internal connections\nCommunication between the runtime plane and management plane is secured with TLS 1-way and OAuth 2.0. Individual services use different protocols, depending on which service they are communicating with.\nThe following image shows the ports and communications channels within the hybrid runtime plane:\nThe following table describes the ports and communications channels within the hybrid runtime plane:\n| ('Internal Connections', 'Source') | ('Internal Connections', 'Unnamed: 1_level_1') | ('Internal Connections', 'Destination') | ('Internal Connections', 'Protocol/Port(s)') | ('Internal Connections', 'Security Protocol') | ('Internal Connections', 'Description')                              |\n|:-------------------------------------|:-------------------------------------------------|:------------------------------------------|:-----------------------------------------------|:------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| MART         | arrow_right_alt         | Cassandra         | TCP/9042 TCP/9142        | mTLS           | Sends data for persistence                                 |\n| MART Istio Ingress     | arrow_right_alt         | MART          | TCP/8443          | TLS            | Requests from the management plane go through the MART Istio Ingress                       |\n| Default\u00a0Istio\u00a0Ingress    | arrow_right_alt         | Message Processor       | TCP/8443          | TLS (Apigee-generated, self-signed cert)  | Processes incoming API requests                                |\n| Message Processor     | arrow_right_alt         | Cassandra         | TCP/9042 TCP/9142        | mTLS           | Sends data for persistence                                 |\n| Message Processor     | arrow_right_alt         | fluentd (Analytics)      | TCP/20001          | mTLS           | Streams data to the data collection pod                              |\n| Cassandra       | compare_arrows         | Cassandra         | TCP/7001          | mTLS           | Intra-node cluster communications. Note that you can also leave port 7000 open for firewall configuration as a backup option for potential troubleshooting. |\n| Prometheus       | arrow_right_alt         | Cassandra         | TCP/7070 (HTTPS)        | TLS            | Scrapes metrics data from various services                             |\n| Prometheus       | arrow_right_alt         | MART          | TCP/8843\u00a0(HTTPS)        | TLS            | Scrapes metrics data from various services                             |\n| Prometheus       | arrow_right_alt         | Message\u00a0Processor       | TCP/8843 (HTTPS)        | TLS            | Scrapes metrics data from various services                             |\n| Prometheus       | arrow_right_alt         | Synchronizer        | TCP/8843 (HTTPS)        | TLS            | Scrapes metrics data from various services                             |\n| Prometheus       | arrow_right_alt         | UDCA          | TCP/7070 (HTTPS)        | TLS            | Scrapes metrics data from various services                             |\n## External connections\nTo appropriately configure your network firewall, you should know the inbound and outbound ports used by hybrid to communicate with external services.\nThe following image shows the ports used for external communications with the hybrid runtime plane:\nThe following table describes the ports used for external communications with the hybrid runtime plane:\n| ('External Connections', 'Source')          | ('External Connections', 'Unnamed: 1_level_1')       | ('External Connections', 'Destination')         | ('External Connections', 'Protocol/Port(s)')       | ('External Connections', 'Security Protocol')       | ('External Connections', 'Description')                    |\n|:------------------------------------------------------------------------|:------------------------------------------------------------------------|:------------------------------------------------------------------------|:------------------------------------------------------------------------|:------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------|\n| Inbound Connections (exposed externally)        | Inbound Connections (exposed externally)        | Inbound Connections (exposed externally)        | Inbound Connections (exposed externally)        | Inbound Connections (exposed externally)        | Inbound Connections (exposed externally)                   |\n| Apigee Services               | arrow_right_alt               | MART Istio Ingress              | TCP/443                 | OAuth over TLS 1.2              | Hybrid API calls from the management plane                   |\n| Client Apps                | arrow_right_alt               | Default Istio Ingress             | TCP/*                 | None/OAuth over TLS 1.2/mTLS           | API requests from external apps                      |\n| Outbound Connections             | Outbound Connections             | Outbound Connections             | Outbound Connections             | Outbound Connections             | Outbound Connections                        |\n| Message\u00a0Processor              | arrow_right_alt               | Backend services              | TCP/* UDP/*                | None/OAuth over TLS 1.2             | Sends requests to customer-defined hosts                   |\n| Synchronizer               | arrow_right_alt               | Apigee Services               | TCP/443                 | OAuth over TLS 1.2              | Fetches configuration data; connects to apigee.googleapis.com              |\n| Synchronizer               | arrow_right_alt               | GCP                  | TCP/443                 | OAuth over TLS 1.2              | Connects to iamcredentials.googleapis.com for authorization               |\n| UDCA (Analytics)              | arrow_right_alt               | Apigee\u00a0Services\u00a0(UAP)             | TCP/443                 | OAuth over TLS 1.2              | Sends data to UAP in the management plane and to GCP; connects to apigee.googleapis.com and storage.googleapis.com |\n| Prometheus (Metrics)             | arrow_right_alt               | GCP (Stackdriver)              | TCP/443                 | TLS                  | Sends data to Stackdriver in the management plane; connects to monitoring.googleapis.com       |\n| fluentd (Logging)              | arrow_right_alt               | GCP (Stackdriver)              | TCP/443                 | TLS                  | Sends data to Stackdriver in the management plane; connects to logging.googleapis.com        |\n| MART                 | arrow_right_alt               | GCP                  | TCP/443                 | OAuth over TLS 1.2              | Connects to iamcredentials.googleapis.com for authorization               |\n| * indicates that the port is configurable. Apigee recommends using 443. | * indicates that the port is configurable. Apigee recommends using 443. | * indicates that the port is configurable. Apigee recommends using 443. | * indicates that the port is configurable. Apigee recommends using 443. | * indicates that the port is configurable. Apigee recommends using 443. | * indicates that the port is configurable. Apigee recommends using 443.            |\nYou should not allow external connections for any specific IP addresses associated with `*.googleapis.com` . The IP addresses can change since the domain currently resolves to multiple addresses.", "guide": "Apigee"}