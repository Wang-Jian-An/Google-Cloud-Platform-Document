{"title": "Apigee - Configuring Kubernetes network policies", "url": "https://cloud.google.com/apigee/docs/api-platform/get-started/what-apigee", "abstract": "# Apigee - Configuring Kubernetes network policies\nYou are currently viewing version 1.9 of the Apigee hybrid documentation. For more information, see [Supported versions](/apigee/docs/hybrid/supported-platforms#supported-versions) .\nThis topic explains how to use Kubernetes network policies to secure Cassandra and Redis pods within an Apigee Hybrid Cluster .\n", "content": "## \n Overview\nWhen you want to control traffic flow at the IP address or port level (OSI layer 3 or 4), then you can use Kubernetes Network Policies for applications in your cluster. Network Policies are an application-centric construct you can use to specify how a pod is allowed to communicate with other pods in your cluster.\nIn Apigee hybrid you can use Kubernetes Network Policies to isolate Cassandra pods so that only pods that are intended to communicate with Cassandra are allowed to, such as the Runtime, Synchronizer, and Mart pods. Other pods in the cluster like Ingres and Watcher pods that do not need to communicate with Cassandra are blocked from doing so.\nIf you have no restrictions on which pods can interact within your cluster, you do not need to use Kubernetes network policies.\n## \n Prerequisites\n- Enable network policies in your cluster.- **GKE** : See [Enabling    network policy enforcement](https://cloud.google.com/kubernetes-engine/docs/how-to/network-policy#enabling_network_policy_enforcement) .\n- **EKS** : See [Installing   the Calico network policy engine add-on](https://docs.aws.amazon.com/eks/latest/userguide/calico.html) .\n- **AKS** : See [Secure   traffic between pods using network policies in Azure Kubernetes Service (AKS)  ](https://docs.microsoft.com/en-us/azure/aks/use-network-policies) .\n- Other platforms: look for instructions to enable network policies on your cluster from your   specific platform vendor.\n- A currently running Apigee hybrid cluster, version 1.8 or newer.## Procedure\nIf you are running hybrid version 1.8.x, download and extract the newest Apigee release  package.\n```\ncurl -LO \\\n https://storage.googleapis.com/apigee-release/hybrid/apigee-hybrid-setup/1.9.4/apigeectl_linux_64.tar.gz\n``````\ncurl -LO \\\n https://storage.googleapis.com/apigee-release/hybrid/apigee-hybrid-setup/1.9.4/apigeectl_mac_64.tar.gz\n``````\ncurl -LO ^\n https://storage.googleapis.com/apigee-release/hybrid/apigee-hybrid-setup/1.9.4/apigeectl_windows_64.zip\n```\nThe configuration files for the Kubernetes network policies for Cassandra and Redis are in the following directory structure within your `$APIGEECTL_HOME` directory:\n```\n\u00a0 \u2514\u2500\u2500 apigeectl\u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 examples\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 network-policies\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 securing-cassandra-redis-pods\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u251c\u2500\u2500 README.md\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u251c\u2500\u2500 base\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u2514\u2500\u2500 cluster-scoped-communication\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u251c\u2500\u2500 cassandra\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u251c\u2500\u2500 kustomization.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u251c\u2500\u2500 networkpolicy-cassandra-allow-controller.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u251c\u2500\u2500 networkpolicy-cassandra-allow-intranode.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u251c\u2500\u2500 networkpolicy-cassandra-allow-mart.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u251c\u2500\u2500 networkpolicy-cassandra-allow-runtime.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u251c\u2500\u2500 networkpolicy-cassandra-alow-sync.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u251c\u2500\u2500 networkpolicy-cassandra-create-user.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u251c\u2500\u2500 networkpolicy-cassandra-monitoring.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u2514\u2500\u2500 networkpolicy-cassandra-remove-dc.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 redis\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u251c\u2500\u2500 kustomization.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u251c\u2500\u2500 networkpolicy-redis-envoy.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2502 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 networkpolicy-redis.yaml\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 overlays\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 ORG_NAME\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 kustomization.yaml\n```\nWhere `` is the name of your Apigee organization.\n- Label the namespaces with the following command:```\nkubectl label namespace apigee app=apigee\nkubectl label namespace apigee-system app=apigee-system\n```\n- Apply the network policies with the following command:```\nkubectl apply -k ${APIGEECTL_HOME}/examples/network-policies/securing-cassandra-redis-pods/overlays/ORG_NAME\n```\n- Validate that the network policies were applied with the following command:```\nkubectl get netpol -n apigee\n```The following network policies should be created in the `apigee` namespace:```\n\u00a0 \u00a0 \u00a0 NAME \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0POD-SELECTOR \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0AGE\u00a0 \u00a0 \u00a0 cassandra-from-mart \u00a0 \u00a0 \u00a0 \u00a0 app=apigee-cassandra \u00a0 \u00a0 \u00a04d5h\u00a0 \u00a0 \u00a0 cassandra-from-runtime \u00a0 \u00a0 \u00a0app=apigee-cassandra \u00a0 \u00a0 \u00a04d5h\u00a0 \u00a0 \u00a0 cassandra-from-sync \u00a0 \u00a0 \u00a0 \u00a0 app=apigee-cassandra \u00a0 \u00a0 \u00a04d5h\u00a0 \u00a0 \u00a0 cassandra-to-cassandra \u00a0 \u00a0 \u00a0app=apigee-cassandra \u00a0 \u00a0 \u00a04d5h\u00a0 \u00a0 \u00a0 controller-to-cassandra \u00a0 \u00a0 app=apigee-cassandra \u00a0 \u00a0 \u00a04d5h\u00a0 \u00a0 \u00a0 redis-from-redisenvoy \u00a0 \u00a0 \u00a0 app=apigee-redis \u00a0 \u00a0 \u00a0 \u00a0 \u00a03d18h\u00a0 \u00a0 \u00a0 redisenvoy-from-runtime \u00a0 \u00a0 app=apigee-redis-envoy \u00a0 \u00a03d18h\u00a0 \u00a0 \n```", "guide": "Apigee"}